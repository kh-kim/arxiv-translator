<html lang="en" data-theme="light"><head>
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<title>Direct Preference Optimization: Your Language Model is Secretly a Reward Model</title>
<!--Generated on Wed Feb  7 20:07:11 2024 by LaTeXML (version 0.8.7) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/static/browse/0.3.4/css/ar5iv_0.7.4.min.css" rel="stylesheet" type="text/css">
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2305.18290v2/"><link rel="stylesheet" href="https://use.typekit.net/rwr5zpx.css"><link rel="icon" type="image/png" href="https://static.arxiv.org/static/browse/0.3.4/images/icons/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="https://static.arxiv.org/static/browse/0.3.4/images/icons/favicon-32x32.png" sizes="32x32"></head>
<body><header class="mob_header">
    <div class="html-header-logo">
      <a href="https://arxiv.org/">
        <img alt="logo" class="logomark" role="presentation" width="100" src="https://services.dev.arxiv.org/html/static/arxiv-logomark-small-white.svg">
        <span class="sr-only">Back to arXiv</span>
      </a>
    </div>

    <!--TOC, dark mode, links-->
    <div class="html-header-nav">
      <!--back to abstract-->
      
        <a class="nav-link ar5iv-footer-button hover-effect" aria-label="Back to abstract page" href="https://arxiv.org/abs/2305.18290v2">
        <svg xmlns="http://www.w3.org/2000/svg" height="1.25em" viewBox="0 0 512 512" fill="#ffffff" aria-hidden="true">
            <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z"></path>
        </svg>
        </a>
      <!--dark mode-->
      <a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle dark/light mode">
        <span class="color-scheme-icon" aria-label="Light mode"></span>
      </a>
      <!--nav-->
      <button class="navbar-toggler ar5iv-footer-button" type="button" data-bs-theme="dark" data-bs-toggle="collapse" aria-expanded="false" data-bs-target=".ltx_page_main >.ltx_TOC.mobile" aria-controls="navbarSupportedContent" aria-label="Toggle navigation" style="border:none; margin-right: 0em;">
        <svg xmlns="http://www.w3.org/2000/svg" height="1.25em" viewBox="0 0 448 512" aria-hidden="true" role="img" fill="#ffffff"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path></svg>
      </button>
    </div>
    </header><header class="desktop_header">
    <div class="html-header-logo">
      <a href="https://arxiv.org/">
          <img alt="logo" class="logo" role="presentation" width="100" src="https://services.dev.arxiv.org/html/static/arxiv-logo-one-color-white.svg">
          <span class="sr-only">Back to arXiv</span>
      </a>
    </div>
    <div class="html-header-message" role="banner">
        <p>This is <strong>experimental HTML</strong> to improve accessibility. We invite you to report rendering errors. <span class="sr-only">Use Alt+Y to toggle on accessible reporting links and Alt+Shift+Y to toggle off.</span> Learn more <a href="https://info.arxiv.org/about/accessible_HTML.html" target="_blank">about this project</a> and <a href="https://info.arxiv.org/help/submit_latex_best_practices.html" target="_blank">help improve conversions</a>.
        </p>
    </div>
    <nav class="html-header-nav">
      <a class="ar5iv-footer-button hover-effect" href="https://info.arxiv.org/about/accessible_HTML.html" target="_blank">Why HTML?</a>
      <a class="ar5iv-footer-button hover-effect" target="_blank" href="#myForm" onclick="event.preventDefault(); var modal = document.getElementById('myForm'); modal.style.display = 'block'; bugReportState.setInitiateWay('Header');">Report Issue</a>
      <a class="ar5iv-footer-button hover-effect" href="https://arxiv.org/abs/2305.18290v2">Back to Abstract</a>
      <a class="ar5iv-footer-button hover-effect" href="https://arxiv.org/pdf/2305.18290v2" target="_blank">Download PDF</a>
      <a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle dark/light mode">
          <span class="color-scheme-icon"></span>
      </a>
    </nav></header>

<div class="ltx_page_main" id="main">
<nav class="ltx_TOC active" aria-labelledby="toc_header"><h2 id="toc_header" class="sr-only">Table of Contents</h2>

      <div id="listIcon" type="button" class="hide">
          <svg width="17px" height="17px" viewBox="0 0 512 512" style="pointer-events: none;">
          <path d="M40 48C26.7 48 16 58.7 16 72v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V72c0-13.3-10.7-24-24-24H40zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zM16 232v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V232c0-13.3-10.7-24-24-24H40c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V392c0-13.3-10.7-24-24-24H40z"></path>
          </svg>
      </div>
      <div id="arrowIcon" type="button">
          <svg width="17px" height="17px" viewBox="0 0 448 512" style="pointer-events: none;">
          <path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path>
          </svg>
      </div><ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S1" title="1 Introduction ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S2" title="2 Related Work ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3" title="3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Preliminaries</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4" title="4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Direct Preference Optimization</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5" title="5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Theoretical Analysis of DPO</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5.SS1" title="5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Your Language Model Is Secretly a Reward Model</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5.SS2" title="5.2 Instability of Actor-Critic Algorithms ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Instability of Actor-Critic Algorithms</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6" title="6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS1" title="6.1 How well can DPO optimize the RLHF objective? ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.1 </span>How well can DPO optimize the RLHF objective?</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS2" title="6.2 Can DPO scale to real preference datasets? ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.2 </span>Can DPO scale to real preference datasets?</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS3" title="6.3 Generalization to a new input distribution ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.3 </span>Generalization to a new input distribution</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS4" title="6.4 Validating GPT-4 judgments with human judgments ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6.4 </span>Validating GPT-4 judgments with human judgments</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S7" title="7 Discussion ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Discussion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1" title="Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Mathematical Derivations</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS1" title="A.1 Deriving the Optimum of the KL-Constrained Reward Maximization Objective ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1 </span>Deriving the Optimum of the KL-Constrained Reward Maximization Objective</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS2" title="A.2 Deriving the DPO Objective Under the Bradley-Terry Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2 </span>Deriving the DPO Objective Under the Bradley-Terry Model</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS3" title="A.3 Deriving the DPO Objective Under the Plackett-Luce Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.3 </span>Deriving the DPO Objective Under the Plackett-Luce Model</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS4" title="A.4 Deriving the Gradient of the DPO Objective ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.4 </span>Deriving the Gradient of the DPO Objective</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS5" title="A.5 Proof of Lemma 1 and 2 ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.5 </span>Proof of Lemma 1 and 2</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS6" title="A.6 Proof of Theorem 1 ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.6 </span>Proof of Theorem 1</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A2" title="Appendix B DPO Implementation Details and Hyperparameters ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>DPO Implementation Details and Hyperparameters</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3" title="Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>Further Details on the Experimental Set-Up</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3.SS1" title="C.1 IMDb Sentiment Experiment and Baseline Details ‣ Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C.1 </span>IMDb Sentiment Experiment and Baseline Details</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3.SS2" title="C.2 GPT-4 prompts for computing summarization and dialogue win rates ‣ Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C.2 </span>GPT-4 prompts for computing summarization and dialogue win rates</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3.SS3" title="C.3 Unlikelihood baseline ‣ Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C.3 </span>Unlikelihood baseline</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4" title="Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D </span>Additional Empirical Results</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.SS1" title="D.1 Performance of Best of 𝑁 baseline for Various 𝑁 ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D.1 </span>Performance of Best of <math alttext="N" class="ltx_Math" display="inline"><semantics><mi>N</mi><annotation-xml encoding="MathML-Content"><ci>𝑁</ci></annotation-xml><annotation encoding="application/x-tex">N</annotation><annotation encoding="application/x-llamapun">italic_N</annotation></semantics></math> baseline for Various <math alttext="N" class="ltx_Math" display="inline"><semantics><mi>N</mi><annotation-xml encoding="MathML-Content"><ci>𝑁</ci></annotation-xml><annotation encoding="application/x-tex">N</annotation><annotation encoding="application/x-llamapun">italic_N</annotation></semantics></math></span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.SS2" title="D.2 Sample Responses and GPT-4 Judgments ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D.2 </span>Sample Responses and GPT-4 Judgments</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.SS3" title="D.3 Human study details ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D.3 </span>Human study details</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.SS3.SSS0.Px1" title="Participants. ‣ D.3 Human study details ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_title">Participants.</span></a></li>
</ol>
</li>
</ol>
</li>
</ol></nav>

<div class="ltx_page_content"><div class="section" id="target-section"><div id="license-tr">License: CC BY 4.0</div><div id="watermark-tr">arXiv:2305.18290v2 [cs.LG] 13 Dec 2023</div></div>
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Direct Preference Optimization:
<br class="ltx_break">Your Language Model is Secretly a Reward Model</h1><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Rafael Rafailov  <span class="ltx_note ltx_role_footnotemark" id="footnotex1"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span> &amp;Archit Sharma<span class="ltx_note ltx_role_footnotemark" id="footnotex2"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">1</span></span></span></span>  <span class="ltx_note ltx_role_footnotemark" id="footnotex3"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span> &amp;Eric Mitchell<span class="ltx_note ltx_role_footnotemark" id="footnotex4"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">1</span></span></span></span>  <span class="ltx_note ltx_role_footnotemark" id="footnotex5"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span>
<br class="ltx_break">Stefano Ermon<span class="ltx_note ltx_role_footnotemark" id="footnotex6"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span>  <span class="ltx_note ltx_role_footnotemark" id="footnotex7"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">3</span></span></span></span> &amp;Christopher D. Manning<span class="ltx_note ltx_role_footnotemark" id="footnotex8"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span> &amp;Chelsea Finn<span class="ltx_note ltx_role_footnotemark" id="footnotex9"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span>
<br class="ltx_break"><span class="ltx_note ltx_role_footnotemark" id="footnotex10"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">2</span></span></span></span>  Stanford University <span class="ltx_note ltx_role_footnotemark" id="footnotex11"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_note_type">footnotemark: </span><span class="ltx_tag ltx_tag_note">3</span></span></span></span>  CZ Biohub 
<br class="ltx_break"><span class="ltx_text ltx_font_typewriter" id="id1.1.id1">{rafailov,architsh,eric.mitchell}@cs.stanford.edu</span>
</span><span class="ltx_author_notes">Equal contribution; more junior authors listed earlier.</span></span>
</div><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="id2.id1">While large-scale unsupervised language models (LMs) learn broad world knowledge and some reasoning skills, achieving precise control of their behavior is difficult due to the completely unsupervised nature of their training.
Existing methods for gaining such steerability collect human labels of the relative quality of model generations and fine-tune the unsupervised LM to align with these preferences, often with reinforcement learning from human feedback (RLHF).
However, RLHF is a complex and often unstable procedure, first fitting a reward model that reflects the human preferences, and then fine-tuning the large unsupervised LM using reinforcement learning to maximize this estimated reward without drifting too far from the original model.
In this paper we introduce a new parameterization of the reward model in RLHF that enables extraction of the corresponding optimal policy in closed form, allowing us to solve the standard RLHF problem with only a simple classification loss.
The resulting algorithm, which we call <span class="ltx_text ltx_font_italic" id="id2.id1.1">Direct Preference Optimization</span> (DPO), is stable, performant, and computationally lightweight, eliminating the need for  sampling from the LM during fine-tuning or performing significant hyperparameter tuning.
Our experiments show that DPO can fine-tune LMs to align with human preferences as well as or better than existing methods. Notably, fine-tuning with DPO exceeds PPO-based RLHF in ability to control sentiment of generations, and matches or improves response quality in summarization and single-turn dialogue while being substantially simpler to implement and train.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large unsupervised language models (LMs) trained on very large datasets
acquire surprising capabilities&nbsp;<cite class="ltx_cite ltx_citemacro_citep">(Chowdhery et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib11" title="">2022</a>; Brown et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib7" title="">2020b</a>; Touvron et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib40" title="">2023</a>; Bubeck et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib8" title="">2023</a>)</cite>. However, these models are trained on data generated by humans with a wide variety of goals, priorities, and skillsets. Some of these goals and skillsets may not be desirable to imitate; for example, while we may want our AI coding assistant to <span class="ltx_text ltx_font_italic" id="S1.p1.1.1">understand</span> common programming mistakes in order to correct them, nevertheless, when generating code, we would like to bias our model toward the (potentially rare) high-quality coding ability present in its training data. Similarly, we might want our language model to be <span class="ltx_text ltx_font_italic" id="S1.p1.1.2">aware</span> of a common misconception believed by 50% of people, but we certainly do not want the model to claim this misconception to be true in 50% of queries about it! In other words, selecting the model’s <em class="ltx_emph ltx_font_italic" id="S1.p1.1.3">desired responses and behavior</em> from its very wide <span class="ltx_text ltx_font_italic" id="S1.p1.1.4">knowledge and abilities</span> is crucial to building AI systems that are safe, performant, and controllable <cite class="ltx_cite ltx_citemacro_citep">(Ouyang et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib26" title="">2022</a>)</cite>. While existing methods typically steer LMs to match human preferences using reinforcement learning (RL), we will show that the RL-based objective used by existing methods can be optimized exactly with a simple binary cross-entropy objective, greatly simplifying the preference learning pipeline.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="120" id="S1.F1.g1" src="extracted/5293438/figures/diagrams/teaser.png" width="598">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span><span class="ltx_text ltx_font_bold" id="S1.F1.3.1">DPO optimizes for human preferences while avoiding reinforcement learning.</span> Existing methods for fine-tuning language models with human feedback first fit a reward model to a dataset of prompts and human preferences over pairs of responses, and then use RL to find a policy that maximizes the learned reward. In contrast, DPO directly optimizes for the policy best satisfying the preferences with a simple classification objective, fitting an <span class="ltx_text ltx_font_italic" id="S1.F1.4.2">implicit</span> reward model whose corresponding optimal policy can be extracted in closed form.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">At a high level, existing methods instill the desired behaviors into a language model using curated sets of human preferences representing the types of behaviors that humans find safe and helpful. This preference learning stage occurs after an initial stage of large-scale unsupervised pre-training on a large text dataset. While the most straightforward approach to preference learning is supervised fine-tuning on human demonstrations of high quality responses, the most successful class of methods is reinforcement learning from human (or AI) feedback (RLHF/RLAIF; <cite class="ltx_cite ltx_citemacro_citep">(Christiano et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib12" title="">2017</a>; Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib2" title="">2022b</a>)</cite>). RLHF methods fit a reward model to a dataset of human preferences and then use RL to optimize a language model policy to produce responses assigned high reward without drifting excessively far from the original model. While RLHF produces models with impressive conversational and coding abilities, the RLHF pipeline is considerably more complex than supervised learning, involving training multiple LMs and sampling from the LM policy in the loop of training, incurring significant computational costs.
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">In this paper, we show how to directly optimize a language model to adhere to human preferences, without explicit reward modeling or reinforcement learning.
We propose
<span class="ltx_text ltx_font_italic" id="S1.p3.1.1">Direct Preference Optimization (DPO)</span>, an algorithm that implicitly optimizes the same objective as existing RLHF algorithms (reward maximization with a KL-divergence constraint) but is simple to implement and straightforward to train. Intuitively, the DPO update increases the relative log probability of preferred to dispreferred responses, but it incorporates a dynamic, per-example importance weight that prevents the model degeneration that we find occurs with a naive probability ratio objective. Like existing algorithms, DPO relies on a theoretical preference model (such as the Bradley-Terry model; <cite class="ltx_cite ltx_citemacro_cite">Bradley and Terry (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib5" title="">1952</a>)</cite>) that measures how well a given reward function aligns with empirical preference data. However, while existing methods use the preference model to define a preference loss to train a reward model and then train a policy that optimizes the learned reward model, DPO uses a change of variables to define the preference loss as a function of the policy directly. Given a dataset of human preferences over model responses, DPO can therefore optimize a policy using a simple binary cross entropy objective, producing the optimal policy to an implicit reward function fit to the preference data.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">Our main contribution is Direct Preference Optimization (DPO), a simple RL-free algorithm for training language models from preferences. Our experiments show that DPO is at least as effective as existing methods, including PPO-based RLHF, for learning from preferences in tasks such as sentiment modulation, summarization, and dialogue, using language models with up to 6B parameters.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S2.p1">
<p class="ltx_p" id="S2.p1.1">Self-supervised language models of increasing scale learn to complete some tasks zero-shot <cite class="ltx_cite ltx_citemacro_citep">(Radford et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib31" title="">2019</a>)</cite> or with few-shot prompts <cite class="ltx_cite ltx_citemacro_citep">(Brown et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib6" title="">2020a</a>; Narayanan et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib25" title="">2021</a>; Chowdhery et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib11" title="">2022</a>)</cite>. However, their performance on downstream tasks and alignment with user intent can be significantly improved by fine-tuning on datasets of instructions and human-written completions <cite class="ltx_cite ltx_citemacro_citep">(Mishra et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib23" title="">2022</a>; Sanh et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib36" title="">2022</a>; Chung et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib13" title="">2022</a>; Thoppilan et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib39" title="">2022</a>)</cite>. This ‘instruction-tuning’ procedure
enables LLMs to generalize to instructions outside of the instruction-tuning set and generally increase their usability <cite class="ltx_cite ltx_citemacro_citep">(Chung et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib13" title="">2022</a>)</cite>. Despite the success of instruction tuning, <span class="ltx_text ltx_font_italic" id="S2.p1.1.1">relative</span> human judgments of response quality are often easier to collect than expert demonstrations, and thus subsequent works have fine-tuned LLMs with datasets of human preferences, improving proficiency in translation <cite class="ltx_cite ltx_citemacro_citep">(Kreutzer et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib18" title="">2018</a>)</cite>, summarization <cite class="ltx_cite ltx_citemacro_citep">(Stiennon et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">2022</a>; Ziegler et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib49" title="">2020</a>)</cite>, story-telling <cite class="ltx_cite ltx_citemacro_citep">(Ziegler et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib49" title="">2020</a>)</cite>, and instruction-following <cite class="ltx_cite ltx_citemacro_citep">(Ouyang et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib26" title="">2022</a>; Ramamurthy et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib32" title="">2023</a>)</cite>. These methods first optimize a neural network reward function for compatibility with the dataset of preferences under a preference model such as the Bradley-Terry model <cite class="ltx_cite ltx_citemacro_citep">(Bradley and Terry, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib5" title="">1952</a>)</cite>, then fine-tune a language model to maximize the given reward using reinforcement learning algorithms, commonly REINFORCE <cite class="ltx_cite ltx_citemacro_citep">(Williams, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib45" title="">1992</a>)</cite>, proximal policy optimization (PPO; <cite class="ltx_cite ltx_citemacro_cite">Schulman et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib37" title="">2017</a>)</cite>), or variants <cite class="ltx_cite ltx_citemacro_citep">(Ramamurthy et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib32" title="">2023</a>)</cite>. A closely-related line of work leverages LLMs fine-tuned for instruction following with human feedback to generate additional synthetic preference data for targeted attributes such as safety or harmlessness <cite class="ltx_cite ltx_citemacro_citep">(Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib2" title="">2022b</a>)</cite>, using only weak supervision from humans in the form of a text rubric for the LLM’s annotations. These methods represent a convergence of two bodies of work: one body of work on training language models with reinforcement learning for a variety of objectives&nbsp;<cite class="ltx_cite ltx_citemacro_citep">(Ranzato et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib33" title="">2015</a>; Paulus et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib27" title="">2018</a>; Wu and Hu, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib46" title="">2018</a>)</cite> and another body of work on general methods for learning from human preferences <cite class="ltx_cite ltx_citemacro_citep">(Christiano et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib12" title="">2017</a>; Kupcsik et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib19" title="">2018</a>)</cite>.
Despite the appeal of using relative human preferences, fine-tuning large language models with reinforcement learning remains a major practical challenge; this work provides a theoretically-justified approach to optimizing relative preferences without RL.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S2.p2">
<p class="ltx_p" id="S2.p2.1">Outside of the context of language, learning policies from preferences has been studied in both bandit and reinforcement learning settings, and several approaches have been proposed. Contextual bandit learning using preferences or rankings of actions, rather than rewards, is known as a contextual dueling bandit (CDB; <cite class="ltx_cite ltx_citemacro_cite">Yue et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib48" title="">2012</a>); Dudík et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib14" title="">2015</a>)</cite>). In the absence of absolute rewards, theoretical analysis of CDBs substitutes the notion of an optimal policy with a <span class="ltx_text ltx_font_italic" id="S2.p2.1.1">von Neumann winner</span>, a policy whose expected win rate against <span class="ltx_text ltx_font_italic" id="S2.p2.1.2">any</span> other policy is at least 50% <cite class="ltx_cite ltx_citemacro_citep">(Dudík et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib14" title="">2015</a>)</cite>. However, in the CDB setting, preference labels are given online, while in learning from human preferences, we typically learn from a fixed batch of offline preference-annotated action pairs <cite class="ltx_cite ltx_citemacro_citep">(Yan et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib47" title="">2022</a>)</cite>. Similarly, <span class="ltx_text ltx_font_italic" id="S2.p2.1.3">preference-based RL</span> (PbRL) learns from binary preferences generated by an <span class="ltx_text ltx_font_italic" id="S2.p2.1.4">unknown</span> ‘scoring’ function rather than rewards <cite class="ltx_cite ltx_citemacro_citep">(Busa-Fekete et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib9" title="">2014</a>; Saha et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib35" title="">2023</a>)</cite>. Various algorithms for PbRL exist, including methods that can reuse off-policy preference data, but generally involve first explicitly estimating the latent scoring function (i.e. the reward model) and subsequently optimizing it <cite class="ltx_cite ltx_citemacro_citep">(Jain et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib16" title="">2013</a>; Busa-Fekete et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib9" title="">2014</a>; Christiano et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib12" title="">2017</a>; Sadigh et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib34" title="">2017</a>; Kupcsik et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib19" title="">2018</a>)</cite>. We instead present a single stage policy learning approach that directly optimizes a policy to satisfy preferences.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Preliminaries</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">We review the RLHF pipeline in <cite class="ltx_cite ltx_citemacro_citeauthor"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib49" title="">Ziegler et&nbsp;al.</a></cite> (and later <cite class="ltx_cite ltx_citemacro_citep">(Stiennon et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">2022</a>; Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib1" title="">2022a</a>; Ouyang et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib26" title="">2022</a>)</cite>). It usually includes three phases: 1) supervised fine-tuning (SFT); 2) preference sampling and reward learning and 3) RL optimization.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S3.p2">
<p class="ltx_p" id="S3.p2.1"><span class="ltx_text ltx_font_bold" id="S3.p2.1.1">SFT</span>: RLHF typically begins by fine-tuning a pre-trained LM with supervised learning on high-quality data for the downstream task(s) of interest (dialogue, summarization, etc.), to obtain a model <math alttext="\pi^{\text{SFT}}" class="ltx_Math" display="inline" id="S3.p2.1.m1.1"><semantics id="S3.p2.1.m1.1a"><msup id="S3.p2.1.m1.1.1" xref="S3.p2.1.m1.1.1.cmml"><mi id="S3.p2.1.m1.1.1.2" xref="S3.p2.1.m1.1.1.2.cmml">π</mi><mtext id="S3.p2.1.m1.1.1.3" xref="S3.p2.1.m1.1.1.3a.cmml">SFT</mtext></msup><annotation-xml encoding="MathML-Content" id="S3.p2.1.m1.1b"><apply id="S3.p2.1.m1.1.1.cmml" xref="S3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.p2.1.m1.1.1.1.cmml" xref="S3.p2.1.m1.1.1">superscript</csymbol><ci id="S3.p2.1.m1.1.1.2.cmml" xref="S3.p2.1.m1.1.1.2">𝜋</ci><ci id="S3.p2.1.m1.1.1.3a.cmml" xref="S3.p2.1.m1.1.1.3"><mtext id="S3.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="S3.p2.1.m1.1.1.3">SFT</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.1.m1.1c">\pi^{\text{SFT}}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.1.m1.1d">italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT</annotation></semantics></math>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S3.p3">
<p class="ltx_p" id="S3.p3.8"><span class="ltx_text ltx_font_bold" id="S3.p3.8.1">Reward Modelling Phase</span>: In the second phase the SFT model is prompted with prompts <math alttext="x" class="ltx_Math" display="inline" id="S3.p3.1.m1.1"><semantics id="S3.p3.1.m1.1a"><mi id="S3.p3.1.m1.1.1" xref="S3.p3.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.p3.1.m1.1b"><ci id="S3.p3.1.m1.1.1.cmml" xref="S3.p3.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.1.m1.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.p3.1.m1.1d">italic_x</annotation></semantics></math> to produce pairs of answers <math alttext="(y_{1},y_{2})\sim\pi^{\text{SFT}}(y\mid x)" class="ltx_Math" display="inline" id="S3.p3.2.m2.3"><semantics id="S3.p3.2.m2.3a"><mrow id="S3.p3.2.m2.3.3" xref="S3.p3.2.m2.3.3.cmml"><mrow id="S3.p3.2.m2.2.2.2.2" xref="S3.p3.2.m2.2.2.2.3.cmml"><mo id="S3.p3.2.m2.2.2.2.2.3" stretchy="false" xref="S3.p3.2.m2.2.2.2.3.cmml">(</mo><msub id="S3.p3.2.m2.1.1.1.1.1" xref="S3.p3.2.m2.1.1.1.1.1.cmml"><mi id="S3.p3.2.m2.1.1.1.1.1.2" xref="S3.p3.2.m2.1.1.1.1.1.2.cmml">y</mi><mn id="S3.p3.2.m2.1.1.1.1.1.3" xref="S3.p3.2.m2.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.p3.2.m2.2.2.2.2.4" xref="S3.p3.2.m2.2.2.2.3.cmml">,</mo><msub id="S3.p3.2.m2.2.2.2.2.2" xref="S3.p3.2.m2.2.2.2.2.2.cmml"><mi id="S3.p3.2.m2.2.2.2.2.2.2" xref="S3.p3.2.m2.2.2.2.2.2.2.cmml">y</mi><mn id="S3.p3.2.m2.2.2.2.2.2.3" xref="S3.p3.2.m2.2.2.2.2.2.3.cmml">2</mn></msub><mo id="S3.p3.2.m2.2.2.2.2.5" stretchy="false" xref="S3.p3.2.m2.2.2.2.3.cmml">)</mo></mrow><mo id="S3.p3.2.m2.3.3.4" xref="S3.p3.2.m2.3.3.4.cmml">∼</mo><mrow id="S3.p3.2.m2.3.3.3" xref="S3.p3.2.m2.3.3.3.cmml"><msup id="S3.p3.2.m2.3.3.3.3" xref="S3.p3.2.m2.3.3.3.3.cmml"><mi id="S3.p3.2.m2.3.3.3.3.2" xref="S3.p3.2.m2.3.3.3.3.2.cmml">π</mi><mtext id="S3.p3.2.m2.3.3.3.3.3" xref="S3.p3.2.m2.3.3.3.3.3a.cmml">SFT</mtext></msup><mo id="S3.p3.2.m2.3.3.3.2" xref="S3.p3.2.m2.3.3.3.2.cmml">⁢</mo><mrow id="S3.p3.2.m2.3.3.3.1.1" xref="S3.p3.2.m2.3.3.3.1.1.1.cmml"><mo id="S3.p3.2.m2.3.3.3.1.1.2" stretchy="false" xref="S3.p3.2.m2.3.3.3.1.1.1.cmml">(</mo><mrow id="S3.p3.2.m2.3.3.3.1.1.1" xref="S3.p3.2.m2.3.3.3.1.1.1.cmml"><mi id="S3.p3.2.m2.3.3.3.1.1.1.2" xref="S3.p3.2.m2.3.3.3.1.1.1.2.cmml">y</mi><mo id="S3.p3.2.m2.3.3.3.1.1.1.1" xref="S3.p3.2.m2.3.3.3.1.1.1.1.cmml">∣</mo><mi id="S3.p3.2.m2.3.3.3.1.1.1.3" xref="S3.p3.2.m2.3.3.3.1.1.1.3.cmml">x</mi></mrow><mo id="S3.p3.2.m2.3.3.3.1.1.3" stretchy="false" xref="S3.p3.2.m2.3.3.3.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.2.m2.3b"><apply id="S3.p3.2.m2.3.3.cmml" xref="S3.p3.2.m2.3.3"><csymbol cd="latexml" id="S3.p3.2.m2.3.3.4.cmml" xref="S3.p3.2.m2.3.3.4">similar-to</csymbol><interval closure="open" id="S3.p3.2.m2.2.2.2.3.cmml" xref="S3.p3.2.m2.2.2.2.2"><apply id="S3.p3.2.m2.1.1.1.1.1.cmml" xref="S3.p3.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p3.2.m2.1.1.1.1.1.1.cmml" xref="S3.p3.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S3.p3.2.m2.1.1.1.1.1.2.cmml" xref="S3.p3.2.m2.1.1.1.1.1.2">𝑦</ci><cn id="S3.p3.2.m2.1.1.1.1.1.3.cmml" type="integer" xref="S3.p3.2.m2.1.1.1.1.1.3">1</cn></apply><apply id="S3.p3.2.m2.2.2.2.2.2.cmml" xref="S3.p3.2.m2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p3.2.m2.2.2.2.2.2.1.cmml" xref="S3.p3.2.m2.2.2.2.2.2">subscript</csymbol><ci id="S3.p3.2.m2.2.2.2.2.2.2.cmml" xref="S3.p3.2.m2.2.2.2.2.2.2">𝑦</ci><cn id="S3.p3.2.m2.2.2.2.2.2.3.cmml" type="integer" xref="S3.p3.2.m2.2.2.2.2.2.3">2</cn></apply></interval><apply id="S3.p3.2.m2.3.3.3.cmml" xref="S3.p3.2.m2.3.3.3"><times id="S3.p3.2.m2.3.3.3.2.cmml" xref="S3.p3.2.m2.3.3.3.2"></times><apply id="S3.p3.2.m2.3.3.3.3.cmml" xref="S3.p3.2.m2.3.3.3.3"><csymbol cd="ambiguous" id="S3.p3.2.m2.3.3.3.3.1.cmml" xref="S3.p3.2.m2.3.3.3.3">superscript</csymbol><ci id="S3.p3.2.m2.3.3.3.3.2.cmml" xref="S3.p3.2.m2.3.3.3.3.2">𝜋</ci><ci id="S3.p3.2.m2.3.3.3.3.3a.cmml" xref="S3.p3.2.m2.3.3.3.3.3"><mtext id="S3.p3.2.m2.3.3.3.3.3.cmml" mathsize="70%" xref="S3.p3.2.m2.3.3.3.3.3">SFT</mtext></ci></apply><apply id="S3.p3.2.m2.3.3.3.1.1.1.cmml" xref="S3.p3.2.m2.3.3.3.1.1"><csymbol cd="latexml" id="S3.p3.2.m2.3.3.3.1.1.1.1.cmml" xref="S3.p3.2.m2.3.3.3.1.1.1.1">conditional</csymbol><ci id="S3.p3.2.m2.3.3.3.1.1.1.2.cmml" xref="S3.p3.2.m2.3.3.3.1.1.1.2">𝑦</ci><ci id="S3.p3.2.m2.3.3.3.1.1.1.3.cmml" xref="S3.p3.2.m2.3.3.3.1.1.1.3">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.2.m2.3c">(y_{1},y_{2})\sim\pi^{\text{SFT}}(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="S3.p3.2.m2.3d">( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ∼ italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT ( italic_y ∣ italic_x )</annotation></semantics></math>. These are then presented to human labelers who express preferences for one answer, denoted as <math alttext="y_{w}\succ y_{l}\mid x" class="ltx_Math" display="inline" id="S3.p3.3.m3.1"><semantics id="S3.p3.3.m3.1a"><mrow id="S3.p3.3.m3.1.1" xref="S3.p3.3.m3.1.1.cmml"><msub id="S3.p3.3.m3.1.1.2" xref="S3.p3.3.m3.1.1.2.cmml"><mi id="S3.p3.3.m3.1.1.2.2" xref="S3.p3.3.m3.1.1.2.2.cmml">y</mi><mi id="S3.p3.3.m3.1.1.2.3" xref="S3.p3.3.m3.1.1.2.3.cmml">w</mi></msub><mo id="S3.p3.3.m3.1.1.1" xref="S3.p3.3.m3.1.1.1.cmml">≻</mo><mrow id="S3.p3.3.m3.1.1.3" xref="S3.p3.3.m3.1.1.3.cmml"><msub id="S3.p3.3.m3.1.1.3.2" xref="S3.p3.3.m3.1.1.3.2.cmml"><mi id="S3.p3.3.m3.1.1.3.2.2" xref="S3.p3.3.m3.1.1.3.2.2.cmml">y</mi><mi id="S3.p3.3.m3.1.1.3.2.3" xref="S3.p3.3.m3.1.1.3.2.3.cmml">l</mi></msub><mo id="S3.p3.3.m3.1.1.3.1" xref="S3.p3.3.m3.1.1.3.1.cmml">∣</mo><mi id="S3.p3.3.m3.1.1.3.3" xref="S3.p3.3.m3.1.1.3.3.cmml">x</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.3.m3.1b"><apply id="S3.p3.3.m3.1.1.cmml" xref="S3.p3.3.m3.1.1"><csymbol cd="latexml" id="S3.p3.3.m3.1.1.1.cmml" xref="S3.p3.3.m3.1.1.1">succeeds</csymbol><apply id="S3.p3.3.m3.1.1.2.cmml" xref="S3.p3.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.p3.3.m3.1.1.2.1.cmml" xref="S3.p3.3.m3.1.1.2">subscript</csymbol><ci id="S3.p3.3.m3.1.1.2.2.cmml" xref="S3.p3.3.m3.1.1.2.2">𝑦</ci><ci id="S3.p3.3.m3.1.1.2.3.cmml" xref="S3.p3.3.m3.1.1.2.3">𝑤</ci></apply><apply id="S3.p3.3.m3.1.1.3.cmml" xref="S3.p3.3.m3.1.1.3"><csymbol cd="latexml" id="S3.p3.3.m3.1.1.3.1.cmml" xref="S3.p3.3.m3.1.1.3.1">conditional</csymbol><apply id="S3.p3.3.m3.1.1.3.2.cmml" xref="S3.p3.3.m3.1.1.3.2"><csymbol cd="ambiguous" id="S3.p3.3.m3.1.1.3.2.1.cmml" xref="S3.p3.3.m3.1.1.3.2">subscript</csymbol><ci id="S3.p3.3.m3.1.1.3.2.2.cmml" xref="S3.p3.3.m3.1.1.3.2.2">𝑦</ci><ci id="S3.p3.3.m3.1.1.3.2.3.cmml" xref="S3.p3.3.m3.1.1.3.2.3">𝑙</ci></apply><ci id="S3.p3.3.m3.1.1.3.3.cmml" xref="S3.p3.3.m3.1.1.3.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.3.m3.1c">y_{w}\succ y_{l}\mid x</annotation><annotation encoding="application/x-llamapun" id="S3.p3.3.m3.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ≻ italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_x</annotation></semantics></math> where <math alttext="y_{w}" class="ltx_Math" display="inline" id="S3.p3.4.m4.1"><semantics id="S3.p3.4.m4.1a"><msub id="S3.p3.4.m4.1.1" xref="S3.p3.4.m4.1.1.cmml"><mi id="S3.p3.4.m4.1.1.2" xref="S3.p3.4.m4.1.1.2.cmml">y</mi><mi id="S3.p3.4.m4.1.1.3" xref="S3.p3.4.m4.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p3.4.m4.1b"><apply id="S3.p3.4.m4.1.1.cmml" xref="S3.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S3.p3.4.m4.1.1.1.cmml" xref="S3.p3.4.m4.1.1">subscript</csymbol><ci id="S3.p3.4.m4.1.1.2.cmml" xref="S3.p3.4.m4.1.1.2">𝑦</ci><ci id="S3.p3.4.m4.1.1.3.cmml" xref="S3.p3.4.m4.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.4.m4.1c">y_{w}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.4.m4.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="y_{l}" class="ltx_Math" display="inline" id="S3.p3.5.m5.1"><semantics id="S3.p3.5.m5.1a"><msub id="S3.p3.5.m5.1.1" xref="S3.p3.5.m5.1.1.cmml"><mi id="S3.p3.5.m5.1.1.2" xref="S3.p3.5.m5.1.1.2.cmml">y</mi><mi id="S3.p3.5.m5.1.1.3" xref="S3.p3.5.m5.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p3.5.m5.1b"><apply id="S3.p3.5.m5.1.1.cmml" xref="S3.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S3.p3.5.m5.1.1.1.cmml" xref="S3.p3.5.m5.1.1">subscript</csymbol><ci id="S3.p3.5.m5.1.1.2.cmml" xref="S3.p3.5.m5.1.1.2">𝑦</ci><ci id="S3.p3.5.m5.1.1.3.cmml" xref="S3.p3.5.m5.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.5.m5.1c">y_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.5.m5.1d">italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math> denotes the preferred and dispreferred completion amongst <math alttext="(y_{1},y_{2})" class="ltx_Math" display="inline" id="S3.p3.6.m6.2"><semantics id="S3.p3.6.m6.2a"><mrow id="S3.p3.6.m6.2.2.2" xref="S3.p3.6.m6.2.2.3.cmml"><mo id="S3.p3.6.m6.2.2.2.3" stretchy="false" xref="S3.p3.6.m6.2.2.3.cmml">(</mo><msub id="S3.p3.6.m6.1.1.1.1" xref="S3.p3.6.m6.1.1.1.1.cmml"><mi id="S3.p3.6.m6.1.1.1.1.2" xref="S3.p3.6.m6.1.1.1.1.2.cmml">y</mi><mn id="S3.p3.6.m6.1.1.1.1.3" xref="S3.p3.6.m6.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.p3.6.m6.2.2.2.4" xref="S3.p3.6.m6.2.2.3.cmml">,</mo><msub id="S3.p3.6.m6.2.2.2.2" xref="S3.p3.6.m6.2.2.2.2.cmml"><mi id="S3.p3.6.m6.2.2.2.2.2" xref="S3.p3.6.m6.2.2.2.2.2.cmml">y</mi><mn id="S3.p3.6.m6.2.2.2.2.3" xref="S3.p3.6.m6.2.2.2.2.3.cmml">2</mn></msub><mo id="S3.p3.6.m6.2.2.2.5" stretchy="false" xref="S3.p3.6.m6.2.2.3.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.6.m6.2b"><interval closure="open" id="S3.p3.6.m6.2.2.3.cmml" xref="S3.p3.6.m6.2.2.2"><apply id="S3.p3.6.m6.1.1.1.1.cmml" xref="S3.p3.6.m6.1.1.1.1"><csymbol cd="ambiguous" id="S3.p3.6.m6.1.1.1.1.1.cmml" xref="S3.p3.6.m6.1.1.1.1">subscript</csymbol><ci id="S3.p3.6.m6.1.1.1.1.2.cmml" xref="S3.p3.6.m6.1.1.1.1.2">𝑦</ci><cn id="S3.p3.6.m6.1.1.1.1.3.cmml" type="integer" xref="S3.p3.6.m6.1.1.1.1.3">1</cn></apply><apply id="S3.p3.6.m6.2.2.2.2.cmml" xref="S3.p3.6.m6.2.2.2.2"><csymbol cd="ambiguous" id="S3.p3.6.m6.2.2.2.2.1.cmml" xref="S3.p3.6.m6.2.2.2.2">subscript</csymbol><ci id="S3.p3.6.m6.2.2.2.2.2.cmml" xref="S3.p3.6.m6.2.2.2.2.2">𝑦</ci><cn id="S3.p3.6.m6.2.2.2.2.3.cmml" type="integer" xref="S3.p3.6.m6.2.2.2.2.3">2</cn></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.6.m6.2c">(y_{1},y_{2})</annotation><annotation encoding="application/x-llamapun" id="S3.p3.6.m6.2d">( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT )</annotation></semantics></math> respectively. The preferences are assumed to be generated by some latent reward model <math alttext="r^{*}(y,x)" class="ltx_Math" display="inline" id="S3.p3.7.m7.2"><semantics id="S3.p3.7.m7.2a"><mrow id="S3.p3.7.m7.2.3" xref="S3.p3.7.m7.2.3.cmml"><msup id="S3.p3.7.m7.2.3.2" xref="S3.p3.7.m7.2.3.2.cmml"><mi id="S3.p3.7.m7.2.3.2.2" xref="S3.p3.7.m7.2.3.2.2.cmml">r</mi><mo id="S3.p3.7.m7.2.3.2.3" xref="S3.p3.7.m7.2.3.2.3.cmml">*</mo></msup><mo id="S3.p3.7.m7.2.3.1" xref="S3.p3.7.m7.2.3.1.cmml">⁢</mo><mrow id="S3.p3.7.m7.2.3.3.2" xref="S3.p3.7.m7.2.3.3.1.cmml"><mo id="S3.p3.7.m7.2.3.3.2.1" stretchy="false" xref="S3.p3.7.m7.2.3.3.1.cmml">(</mo><mi id="S3.p3.7.m7.1.1" xref="S3.p3.7.m7.1.1.cmml">y</mi><mo id="S3.p3.7.m7.2.3.3.2.2" xref="S3.p3.7.m7.2.3.3.1.cmml">,</mo><mi id="S3.p3.7.m7.2.2" xref="S3.p3.7.m7.2.2.cmml">x</mi><mo id="S3.p3.7.m7.2.3.3.2.3" stretchy="false" xref="S3.p3.7.m7.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.7.m7.2b"><apply id="S3.p3.7.m7.2.3.cmml" xref="S3.p3.7.m7.2.3"><times id="S3.p3.7.m7.2.3.1.cmml" xref="S3.p3.7.m7.2.3.1"></times><apply id="S3.p3.7.m7.2.3.2.cmml" xref="S3.p3.7.m7.2.3.2"><csymbol cd="ambiguous" id="S3.p3.7.m7.2.3.2.1.cmml" xref="S3.p3.7.m7.2.3.2">superscript</csymbol><ci id="S3.p3.7.m7.2.3.2.2.cmml" xref="S3.p3.7.m7.2.3.2.2">𝑟</ci><times id="S3.p3.7.m7.2.3.2.3.cmml" xref="S3.p3.7.m7.2.3.2.3"></times></apply><interval closure="open" id="S3.p3.7.m7.2.3.3.1.cmml" xref="S3.p3.7.m7.2.3.3.2"><ci id="S3.p3.7.m7.1.1.cmml" xref="S3.p3.7.m7.1.1">𝑦</ci><ci id="S3.p3.7.m7.2.2.cmml" xref="S3.p3.7.m7.2.2">𝑥</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.7.m7.2c">r^{*}(y,x)</annotation><annotation encoding="application/x-llamapun" id="S3.p3.7.m7.2d">italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y , italic_x )</annotation></semantics></math>, which we do not have access to. There are a number of approaches used to model preferences, the Bradley-Terry (BT) <cite class="ltx_cite ltx_citemacro_cite">Bradley and Terry (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib5" title="">1952</a>)</cite> model being a popular choice (although more general Plackett-Luce ranking models <cite class="ltx_cite ltx_citemacro_citep">(Plackett, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib30" title="">1975</a>; Luce, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib21" title="">2012</a>)</cite> are also compatible with the framework if we have access to several ranked answers). The BT model stipulates that the human preference distribution <math alttext="p^{*}" class="ltx_Math" display="inline" id="S3.p3.8.m8.1"><semantics id="S3.p3.8.m8.1a"><msup id="S3.p3.8.m8.1.1" xref="S3.p3.8.m8.1.1.cmml"><mi id="S3.p3.8.m8.1.1.2" xref="S3.p3.8.m8.1.1.2.cmml">p</mi><mo id="S3.p3.8.m8.1.1.3" xref="S3.p3.8.m8.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p3.8.m8.1b"><apply id="S3.p3.8.m8.1.1.cmml" xref="S3.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S3.p3.8.m8.1.1.1.cmml" xref="S3.p3.8.m8.1.1">superscript</csymbol><ci id="S3.p3.8.m8.1.1.2.cmml" xref="S3.p3.8.m8.1.1.2">𝑝</ci><times id="S3.p3.8.m8.1.1.3.cmml" xref="S3.p3.8.m8.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.8.m8.1c">p^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.8.m8.1d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> can be written as:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p^{*}(y_{1}\succ y_{2}\mid x)=\frac{\exp\left(r^{*}(x,y_{1})\right)}{\exp\left%
(r^{*}(x,y_{1})\right)+\exp\left(r^{*}(x,y_{2})\right)}." class="ltx_Math" display="block" id="S3.E1.m1.10"><semantics id="S3.E1.m1.10a"><mrow id="S3.E1.m1.10.10.1" xref="S3.E1.m1.10.10.1.1.cmml"><mrow id="S3.E1.m1.10.10.1.1" xref="S3.E1.m1.10.10.1.1.cmml"><mrow id="S3.E1.m1.10.10.1.1.1" xref="S3.E1.m1.10.10.1.1.1.cmml"><msup id="S3.E1.m1.10.10.1.1.1.3" xref="S3.E1.m1.10.10.1.1.1.3.cmml"><mi id="S3.E1.m1.10.10.1.1.1.3.2" xref="S3.E1.m1.10.10.1.1.1.3.2.cmml">p</mi><mo id="S3.E1.m1.10.10.1.1.1.3.3" xref="S3.E1.m1.10.10.1.1.1.3.3.cmml">*</mo></msup><mo id="S3.E1.m1.10.10.1.1.1.2" xref="S3.E1.m1.10.10.1.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.10.10.1.1.1.1.1" xref="S3.E1.m1.10.10.1.1.1.1.1.1.cmml"><mo id="S3.E1.m1.10.10.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.10.10.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.10.10.1.1.1.1.1.1" xref="S3.E1.m1.10.10.1.1.1.1.1.1.cmml"><msub id="S3.E1.m1.10.10.1.1.1.1.1.1.2" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2.cmml"><mi id="S3.E1.m1.10.10.1.1.1.1.1.1.2.2" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2.2.cmml">y</mi><mn id="S3.E1.m1.10.10.1.1.1.1.1.1.2.3" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S3.E1.m1.10.10.1.1.1.1.1.1.1" xref="S3.E1.m1.10.10.1.1.1.1.1.1.1.cmml">≻</mo><mrow id="S3.E1.m1.10.10.1.1.1.1.1.1.3" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.cmml"><msub id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.cmml"><mi id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.2" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.2.cmml">y</mi><mn id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.3" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.3.cmml">2</mn></msub><mo id="S3.E1.m1.10.10.1.1.1.1.1.1.3.1" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.1.cmml">∣</mo><mi id="S3.E1.m1.10.10.1.1.1.1.1.1.3.3" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="S3.E1.m1.10.10.1.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.10.10.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.10.10.1.1.2" xref="S3.E1.m1.10.10.1.1.2.cmml">=</mo><mfrac id="S3.E1.m1.9.9" xref="S3.E1.m1.9.9.cmml"><mrow id="S3.E1.m1.3.3.3.3" xref="S3.E1.m1.3.3.3.4.cmml"><mi id="S3.E1.m1.2.2.2.2" xref="S3.E1.m1.2.2.2.2.cmml">exp</mi><mo id="S3.E1.m1.3.3.3.3a" xref="S3.E1.m1.3.3.3.4.cmml">⁡</mo><mrow id="S3.E1.m1.3.3.3.3.1" xref="S3.E1.m1.3.3.3.4.cmml"><mo id="S3.E1.m1.3.3.3.3.1.2" xref="S3.E1.m1.3.3.3.4.cmml">(</mo><mrow id="S3.E1.m1.3.3.3.3.1.1" xref="S3.E1.m1.3.3.3.3.1.1.cmml"><msup id="S3.E1.m1.3.3.3.3.1.1.3" xref="S3.E1.m1.3.3.3.3.1.1.3.cmml"><mi id="S3.E1.m1.3.3.3.3.1.1.3.2" xref="S3.E1.m1.3.3.3.3.1.1.3.2.cmml">r</mi><mo id="S3.E1.m1.3.3.3.3.1.1.3.3" xref="S3.E1.m1.3.3.3.3.1.1.3.3.cmml">*</mo></msup><mo id="S3.E1.m1.3.3.3.3.1.1.2" xref="S3.E1.m1.3.3.3.3.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.3.3.3.3.1.1.1.1" xref="S3.E1.m1.3.3.3.3.1.1.1.2.cmml"><mo id="S3.E1.m1.3.3.3.3.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.3.3.3.3.1.1.1.2.cmml">(</mo><mi id="S3.E1.m1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.cmml">x</mi><mo id="S3.E1.m1.3.3.3.3.1.1.1.1.3" xref="S3.E1.m1.3.3.3.3.1.1.1.2.cmml">,</mo><msub id="S3.E1.m1.3.3.3.3.1.1.1.1.1" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1.cmml"><mi id="S3.E1.m1.3.3.3.3.1.1.1.1.1.2" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1.2.cmml">y</mi><mn id="S3.E1.m1.3.3.3.3.1.1.1.1.1.3" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.E1.m1.3.3.3.3.1.1.1.1.4" stretchy="false" xref="S3.E1.m1.3.3.3.3.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.3.3.3.3.1.3" xref="S3.E1.m1.3.3.3.4.cmml">)</mo></mrow></mrow><mrow id="S3.E1.m1.9.9.9" xref="S3.E1.m1.9.9.9.cmml"><mrow id="S3.E1.m1.8.8.8.5.1" xref="S3.E1.m1.8.8.8.5.2.cmml"><mi id="S3.E1.m1.5.5.5.2" xref="S3.E1.m1.5.5.5.2.cmml">exp</mi><mo id="S3.E1.m1.8.8.8.5.1a" xref="S3.E1.m1.8.8.8.5.2.cmml">⁡</mo><mrow id="S3.E1.m1.8.8.8.5.1.1" xref="S3.E1.m1.8.8.8.5.2.cmml"><mo id="S3.E1.m1.8.8.8.5.1.1.2" xref="S3.E1.m1.8.8.8.5.2.cmml">(</mo><mrow id="S3.E1.m1.8.8.8.5.1.1.1" xref="S3.E1.m1.8.8.8.5.1.1.1.cmml"><msup id="S3.E1.m1.8.8.8.5.1.1.1.3" xref="S3.E1.m1.8.8.8.5.1.1.1.3.cmml"><mi id="S3.E1.m1.8.8.8.5.1.1.1.3.2" xref="S3.E1.m1.8.8.8.5.1.1.1.3.2.cmml">r</mi><mo id="S3.E1.m1.8.8.8.5.1.1.1.3.3" xref="S3.E1.m1.8.8.8.5.1.1.1.3.3.cmml">*</mo></msup><mo id="S3.E1.m1.8.8.8.5.1.1.1.2" xref="S3.E1.m1.8.8.8.5.1.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.8.8.8.5.1.1.1.1.1" xref="S3.E1.m1.8.8.8.5.1.1.1.1.2.cmml"><mo id="S3.E1.m1.8.8.8.5.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.8.8.8.5.1.1.1.1.2.cmml">(</mo><mi id="S3.E1.m1.4.4.4.1" xref="S3.E1.m1.4.4.4.1.cmml">x</mi><mo id="S3.E1.m1.8.8.8.5.1.1.1.1.1.3" xref="S3.E1.m1.8.8.8.5.1.1.1.1.2.cmml">,</mo><msub id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.2" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.2.cmml">y</mi><mn id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.3" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.E1.m1.8.8.8.5.1.1.1.1.1.4" stretchy="false" xref="S3.E1.m1.8.8.8.5.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.8.8.8.5.1.1.3" xref="S3.E1.m1.8.8.8.5.2.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.9.9.9.7" xref="S3.E1.m1.9.9.9.7.cmml">+</mo><mrow id="S3.E1.m1.9.9.9.6.1" xref="S3.E1.m1.9.9.9.6.2.cmml"><mi id="S3.E1.m1.7.7.7.4" xref="S3.E1.m1.7.7.7.4.cmml">exp</mi><mo id="S3.E1.m1.9.9.9.6.1a" xref="S3.E1.m1.9.9.9.6.2.cmml">⁡</mo><mrow id="S3.E1.m1.9.9.9.6.1.1" xref="S3.E1.m1.9.9.9.6.2.cmml"><mo id="S3.E1.m1.9.9.9.6.1.1.2" xref="S3.E1.m1.9.9.9.6.2.cmml">(</mo><mrow id="S3.E1.m1.9.9.9.6.1.1.1" xref="S3.E1.m1.9.9.9.6.1.1.1.cmml"><msup id="S3.E1.m1.9.9.9.6.1.1.1.3" xref="S3.E1.m1.9.9.9.6.1.1.1.3.cmml"><mi id="S3.E1.m1.9.9.9.6.1.1.1.3.2" xref="S3.E1.m1.9.9.9.6.1.1.1.3.2.cmml">r</mi><mo id="S3.E1.m1.9.9.9.6.1.1.1.3.3" xref="S3.E1.m1.9.9.9.6.1.1.1.3.3.cmml">*</mo></msup><mo id="S3.E1.m1.9.9.9.6.1.1.1.2" xref="S3.E1.m1.9.9.9.6.1.1.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.9.9.9.6.1.1.1.1.1" xref="S3.E1.m1.9.9.9.6.1.1.1.1.2.cmml"><mo id="S3.E1.m1.9.9.9.6.1.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.9.9.9.6.1.1.1.1.2.cmml">(</mo><mi id="S3.E1.m1.6.6.6.3" xref="S3.E1.m1.6.6.6.3.cmml">x</mi><mo id="S3.E1.m1.9.9.9.6.1.1.1.1.1.3" xref="S3.E1.m1.9.9.9.6.1.1.1.1.2.cmml">,</mo><msub id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.cmml"><mi id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.2" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.2.cmml">y</mi><mn id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.3" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.3.cmml">2</mn></msub><mo id="S3.E1.m1.9.9.9.6.1.1.1.1.1.4" stretchy="false" xref="S3.E1.m1.9.9.9.6.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.9.9.9.6.1.1.3" xref="S3.E1.m1.9.9.9.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow><mo id="S3.E1.m1.10.10.1.2" lspace="0em" xref="S3.E1.m1.10.10.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.10b"><apply id="S3.E1.m1.10.10.1.1.cmml" xref="S3.E1.m1.10.10.1"><eq id="S3.E1.m1.10.10.1.1.2.cmml" xref="S3.E1.m1.10.10.1.1.2"></eq><apply id="S3.E1.m1.10.10.1.1.1.cmml" xref="S3.E1.m1.10.10.1.1.1"><times id="S3.E1.m1.10.10.1.1.1.2.cmml" xref="S3.E1.m1.10.10.1.1.1.2"></times><apply id="S3.E1.m1.10.10.1.1.1.3.cmml" xref="S3.E1.m1.10.10.1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.10.10.1.1.1.3.1.cmml" xref="S3.E1.m1.10.10.1.1.1.3">superscript</csymbol><ci id="S3.E1.m1.10.10.1.1.1.3.2.cmml" xref="S3.E1.m1.10.10.1.1.1.3.2">𝑝</ci><times id="S3.E1.m1.10.10.1.1.1.3.3.cmml" xref="S3.E1.m1.10.10.1.1.1.3.3"></times></apply><apply id="S3.E1.m1.10.10.1.1.1.1.1.1.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1"><csymbol cd="latexml" id="S3.E1.m1.10.10.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.1">succeeds</csymbol><apply id="S3.E1.m1.10.10.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E1.m1.10.10.1.1.1.1.1.1.2.1.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.E1.m1.10.10.1.1.1.1.1.1.2.2.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2.2">𝑦</ci><cn id="S3.E1.m1.10.10.1.1.1.1.1.1.2.3.cmml" type="integer" xref="S3.E1.m1.10.10.1.1.1.1.1.1.2.3">1</cn></apply><apply id="S3.E1.m1.10.10.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3"><csymbol cd="latexml" id="S3.E1.m1.10.10.1.1.1.1.1.1.3.1.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.1">conditional</csymbol><apply id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2">subscript</csymbol><ci id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.2.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.2">𝑦</ci><cn id="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.3.cmml" type="integer" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.2.3">2</cn></apply><ci id="S3.E1.m1.10.10.1.1.1.1.1.1.3.3.cmml" xref="S3.E1.m1.10.10.1.1.1.1.1.1.3.3">𝑥</ci></apply></apply></apply><apply id="S3.E1.m1.9.9.cmml" xref="S3.E1.m1.9.9"><divide id="S3.E1.m1.9.9.10.cmml" xref="S3.E1.m1.9.9"></divide><apply id="S3.E1.m1.3.3.3.4.cmml" xref="S3.E1.m1.3.3.3.3"><exp id="S3.E1.m1.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2"></exp><apply id="S3.E1.m1.3.3.3.3.1.1.cmml" xref="S3.E1.m1.3.3.3.3.1.1"><times id="S3.E1.m1.3.3.3.3.1.1.2.cmml" xref="S3.E1.m1.3.3.3.3.1.1.2"></times><apply id="S3.E1.m1.3.3.3.3.1.1.3.cmml" xref="S3.E1.m1.3.3.3.3.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3.3.1.1.3.1.cmml" xref="S3.E1.m1.3.3.3.3.1.1.3">superscript</csymbol><ci id="S3.E1.m1.3.3.3.3.1.1.3.2.cmml" xref="S3.E1.m1.3.3.3.3.1.1.3.2">𝑟</ci><times id="S3.E1.m1.3.3.3.3.1.1.3.3.cmml" xref="S3.E1.m1.3.3.3.3.1.1.3.3"></times></apply><interval closure="open" id="S3.E1.m1.3.3.3.3.1.1.1.2.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1.1"><ci id="S3.E1.m1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1">𝑥</ci><apply id="S3.E1.m1.3.3.3.3.1.1.1.1.1.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.3.3.3.3.1.1.1.1.1.1.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.3.3.3.3.1.1.1.1.1.2.cmml" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1.2">𝑦</ci><cn id="S3.E1.m1.3.3.3.3.1.1.1.1.1.3.cmml" type="integer" xref="S3.E1.m1.3.3.3.3.1.1.1.1.1.3">1</cn></apply></interval></apply></apply><apply id="S3.E1.m1.9.9.9.cmml" xref="S3.E1.m1.9.9.9"><plus id="S3.E1.m1.9.9.9.7.cmml" xref="S3.E1.m1.9.9.9.7"></plus><apply id="S3.E1.m1.8.8.8.5.2.cmml" xref="S3.E1.m1.8.8.8.5.1"><exp id="S3.E1.m1.5.5.5.2.cmml" xref="S3.E1.m1.5.5.5.2"></exp><apply id="S3.E1.m1.8.8.8.5.1.1.1.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1"><times id="S3.E1.m1.8.8.8.5.1.1.1.2.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.2"></times><apply id="S3.E1.m1.8.8.8.5.1.1.1.3.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.8.8.8.5.1.1.1.3.1.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.3">superscript</csymbol><ci id="S3.E1.m1.8.8.8.5.1.1.1.3.2.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.3.2">𝑟</ci><times id="S3.E1.m1.8.8.8.5.1.1.1.3.3.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.3.3"></times></apply><interval closure="open" id="S3.E1.m1.8.8.8.5.1.1.1.1.2.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1"><ci id="S3.E1.m1.4.4.4.1.cmml" xref="S3.E1.m1.4.4.4.1">𝑥</ci><apply id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.2">𝑦</ci><cn id="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.3.cmml" type="integer" xref="S3.E1.m1.8.8.8.5.1.1.1.1.1.1.3">1</cn></apply></interval></apply></apply><apply id="S3.E1.m1.9.9.9.6.2.cmml" xref="S3.E1.m1.9.9.9.6.1"><exp id="S3.E1.m1.7.7.7.4.cmml" xref="S3.E1.m1.7.7.7.4"></exp><apply id="S3.E1.m1.9.9.9.6.1.1.1.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1"><times id="S3.E1.m1.9.9.9.6.1.1.1.2.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.2"></times><apply id="S3.E1.m1.9.9.9.6.1.1.1.3.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.9.9.9.6.1.1.1.3.1.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.3">superscript</csymbol><ci id="S3.E1.m1.9.9.9.6.1.1.1.3.2.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.3.2">𝑟</ci><times id="S3.E1.m1.9.9.9.6.1.1.1.3.3.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.3.3"></times></apply><interval closure="open" id="S3.E1.m1.9.9.9.6.1.1.1.1.2.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1"><ci id="S3.E1.m1.6.6.6.3.cmml" xref="S3.E1.m1.6.6.6.3">𝑥</ci><apply id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.2">𝑦</ci><cn id="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.3.cmml" type="integer" xref="S3.E1.m1.9.9.9.6.1.1.1.1.1.1.3">2</cn></apply></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.10c">p^{*}(y_{1}\succ y_{2}\mid x)=\frac{\exp\left(r^{*}(x,y_{1})\right)}{\exp\left%
(r^{*}(x,y_{1})\right)+\exp\left(r^{*}(x,y_{2})\right)}.</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.10d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ≻ italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∣ italic_x ) = divide start_ARG roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ) end_ARG start_ARG roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ) + roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ) end_ARG .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p3.11">Assuming access to a static dataset of comparisons <math alttext="\mathcal{D}=\bigl{\{}x^{(i)},y_{w}^{(i)},y_{l}^{(i)}\bigr{\}}_{i=1}^{N}" class="ltx_Math" display="inline" id="S3.p3.9.m1.6"><semantics id="S3.p3.9.m1.6a"><mrow id="S3.p3.9.m1.6.6" xref="S3.p3.9.m1.6.6.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p3.9.m1.6.6.5" xref="S3.p3.9.m1.6.6.5.cmml">𝒟</mi><mo id="S3.p3.9.m1.6.6.4" xref="S3.p3.9.m1.6.6.4.cmml">=</mo><msubsup id="S3.p3.9.m1.6.6.3" xref="S3.p3.9.m1.6.6.3.cmml"><mrow id="S3.p3.9.m1.6.6.3.3.3.3" xref="S3.p3.9.m1.6.6.3.3.3.4.cmml"><mo id="S3.p3.9.m1.6.6.3.3.3.3.4" maxsize="120%" minsize="120%" xref="S3.p3.9.m1.6.6.3.3.3.4.cmml">{</mo><msup id="S3.p3.9.m1.4.4.1.1.1.1.1" xref="S3.p3.9.m1.4.4.1.1.1.1.1.cmml"><mi id="S3.p3.9.m1.4.4.1.1.1.1.1.2" xref="S3.p3.9.m1.4.4.1.1.1.1.1.2.cmml">x</mi><mrow id="S3.p3.9.m1.1.1.1.3" xref="S3.p3.9.m1.4.4.1.1.1.1.1.cmml"><mo id="S3.p3.9.m1.1.1.1.3.1" stretchy="false" xref="S3.p3.9.m1.4.4.1.1.1.1.1.cmml">(</mo><mi id="S3.p3.9.m1.1.1.1.1" xref="S3.p3.9.m1.1.1.1.1.cmml">i</mi><mo id="S3.p3.9.m1.1.1.1.3.2" stretchy="false" xref="S3.p3.9.m1.4.4.1.1.1.1.1.cmml">)</mo></mrow></msup><mo id="S3.p3.9.m1.6.6.3.3.3.3.5" xref="S3.p3.9.m1.6.6.3.3.3.4.cmml">,</mo><msubsup id="S3.p3.9.m1.5.5.2.2.2.2.2" xref="S3.p3.9.m1.5.5.2.2.2.2.2.cmml"><mi id="S3.p3.9.m1.5.5.2.2.2.2.2.2.2" xref="S3.p3.9.m1.5.5.2.2.2.2.2.2.2.cmml">y</mi><mi id="S3.p3.9.m1.5.5.2.2.2.2.2.2.3" xref="S3.p3.9.m1.5.5.2.2.2.2.2.2.3.cmml">w</mi><mrow id="S3.p3.9.m1.2.2.1.3" xref="S3.p3.9.m1.5.5.2.2.2.2.2.cmml"><mo id="S3.p3.9.m1.2.2.1.3.1" stretchy="false" xref="S3.p3.9.m1.5.5.2.2.2.2.2.cmml">(</mo><mi id="S3.p3.9.m1.2.2.1.1" xref="S3.p3.9.m1.2.2.1.1.cmml">i</mi><mo id="S3.p3.9.m1.2.2.1.3.2" stretchy="false" xref="S3.p3.9.m1.5.5.2.2.2.2.2.cmml">)</mo></mrow></msubsup><mo id="S3.p3.9.m1.6.6.3.3.3.3.6" xref="S3.p3.9.m1.6.6.3.3.3.4.cmml">,</mo><msubsup id="S3.p3.9.m1.6.6.3.3.3.3.3" xref="S3.p3.9.m1.6.6.3.3.3.3.3.cmml"><mi id="S3.p3.9.m1.6.6.3.3.3.3.3.2.2" xref="S3.p3.9.m1.6.6.3.3.3.3.3.2.2.cmml">y</mi><mi id="S3.p3.9.m1.6.6.3.3.3.3.3.2.3" xref="S3.p3.9.m1.6.6.3.3.3.3.3.2.3.cmml">l</mi><mrow id="S3.p3.9.m1.3.3.1.3" xref="S3.p3.9.m1.6.6.3.3.3.3.3.cmml"><mo id="S3.p3.9.m1.3.3.1.3.1" stretchy="false" xref="S3.p3.9.m1.6.6.3.3.3.3.3.cmml">(</mo><mi id="S3.p3.9.m1.3.3.1.1" xref="S3.p3.9.m1.3.3.1.1.cmml">i</mi><mo id="S3.p3.9.m1.3.3.1.3.2" stretchy="false" xref="S3.p3.9.m1.6.6.3.3.3.3.3.cmml">)</mo></mrow></msubsup><mo id="S3.p3.9.m1.6.6.3.3.3.3.7" maxsize="120%" minsize="120%" xref="S3.p3.9.m1.6.6.3.3.3.4.cmml">}</mo></mrow><mrow id="S3.p3.9.m1.6.6.3.3.5" xref="S3.p3.9.m1.6.6.3.3.5.cmml"><mi id="S3.p3.9.m1.6.6.3.3.5.2" xref="S3.p3.9.m1.6.6.3.3.5.2.cmml">i</mi><mo id="S3.p3.9.m1.6.6.3.3.5.1" xref="S3.p3.9.m1.6.6.3.3.5.1.cmml">=</mo><mn id="S3.p3.9.m1.6.6.3.3.5.3" xref="S3.p3.9.m1.6.6.3.3.5.3.cmml">1</mn></mrow><mi id="S3.p3.9.m1.6.6.3.5" xref="S3.p3.9.m1.6.6.3.5.cmml">N</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.9.m1.6b"><apply id="S3.p3.9.m1.6.6.cmml" xref="S3.p3.9.m1.6.6"><eq id="S3.p3.9.m1.6.6.4.cmml" xref="S3.p3.9.m1.6.6.4"></eq><ci id="S3.p3.9.m1.6.6.5.cmml" xref="S3.p3.9.m1.6.6.5">𝒟</ci><apply id="S3.p3.9.m1.6.6.3.cmml" xref="S3.p3.9.m1.6.6.3"><csymbol cd="ambiguous" id="S3.p3.9.m1.6.6.3.4.cmml" xref="S3.p3.9.m1.6.6.3">superscript</csymbol><apply id="S3.p3.9.m1.6.6.3.3.cmml" xref="S3.p3.9.m1.6.6.3"><csymbol cd="ambiguous" id="S3.p3.9.m1.6.6.3.3.4.cmml" xref="S3.p3.9.m1.6.6.3">subscript</csymbol><set id="S3.p3.9.m1.6.6.3.3.3.4.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3"><apply id="S3.p3.9.m1.4.4.1.1.1.1.1.cmml" xref="S3.p3.9.m1.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p3.9.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.p3.9.m1.4.4.1.1.1.1.1">superscript</csymbol><ci id="S3.p3.9.m1.4.4.1.1.1.1.1.2.cmml" xref="S3.p3.9.m1.4.4.1.1.1.1.1.2">𝑥</ci><ci id="S3.p3.9.m1.1.1.1.1.cmml" xref="S3.p3.9.m1.1.1.1.1">𝑖</ci></apply><apply id="S3.p3.9.m1.5.5.2.2.2.2.2.cmml" xref="S3.p3.9.m1.5.5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p3.9.m1.5.5.2.2.2.2.2.1.cmml" xref="S3.p3.9.m1.5.5.2.2.2.2.2">superscript</csymbol><apply id="S3.p3.9.m1.5.5.2.2.2.2.2.2.cmml" xref="S3.p3.9.m1.5.5.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p3.9.m1.5.5.2.2.2.2.2.2.1.cmml" xref="S3.p3.9.m1.5.5.2.2.2.2.2">subscript</csymbol><ci id="S3.p3.9.m1.5.5.2.2.2.2.2.2.2.cmml" xref="S3.p3.9.m1.5.5.2.2.2.2.2.2.2">𝑦</ci><ci id="S3.p3.9.m1.5.5.2.2.2.2.2.2.3.cmml" xref="S3.p3.9.m1.5.5.2.2.2.2.2.2.3">𝑤</ci></apply><ci id="S3.p3.9.m1.2.2.1.1.cmml" xref="S3.p3.9.m1.2.2.1.1">𝑖</ci></apply><apply id="S3.p3.9.m1.6.6.3.3.3.3.3.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.p3.9.m1.6.6.3.3.3.3.3.1.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3.3">superscript</csymbol><apply id="S3.p3.9.m1.6.6.3.3.3.3.3.2.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3.3"><csymbol cd="ambiguous" id="S3.p3.9.m1.6.6.3.3.3.3.3.2.1.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3.3">subscript</csymbol><ci id="S3.p3.9.m1.6.6.3.3.3.3.3.2.2.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3.3.2.2">𝑦</ci><ci id="S3.p3.9.m1.6.6.3.3.3.3.3.2.3.cmml" xref="S3.p3.9.m1.6.6.3.3.3.3.3.2.3">𝑙</ci></apply><ci id="S3.p3.9.m1.3.3.1.1.cmml" xref="S3.p3.9.m1.3.3.1.1">𝑖</ci></apply></set><apply id="S3.p3.9.m1.6.6.3.3.5.cmml" xref="S3.p3.9.m1.6.6.3.3.5"><eq id="S3.p3.9.m1.6.6.3.3.5.1.cmml" xref="S3.p3.9.m1.6.6.3.3.5.1"></eq><ci id="S3.p3.9.m1.6.6.3.3.5.2.cmml" xref="S3.p3.9.m1.6.6.3.3.5.2">𝑖</ci><cn id="S3.p3.9.m1.6.6.3.3.5.3.cmml" type="integer" xref="S3.p3.9.m1.6.6.3.3.5.3">1</cn></apply></apply><ci id="S3.p3.9.m1.6.6.3.5.cmml" xref="S3.p3.9.m1.6.6.3.5">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.9.m1.6c">\mathcal{D}=\bigl{\{}x^{(i)},y_{w}^{(i)},y_{l}^{(i)}\bigr{\}}_{i=1}^{N}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.9.m1.6d">caligraphic_D = { italic_x start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT</annotation></semantics></math> sampled from <math alttext="p^{*}" class="ltx_Math" display="inline" id="S3.p3.10.m2.1"><semantics id="S3.p3.10.m2.1a"><msup id="S3.p3.10.m2.1.1" xref="S3.p3.10.m2.1.1.cmml"><mi id="S3.p3.10.m2.1.1.2" xref="S3.p3.10.m2.1.1.2.cmml">p</mi><mo id="S3.p3.10.m2.1.1.3" xref="S3.p3.10.m2.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p3.10.m2.1b"><apply id="S3.p3.10.m2.1.1.cmml" xref="S3.p3.10.m2.1.1"><csymbol cd="ambiguous" id="S3.p3.10.m2.1.1.1.cmml" xref="S3.p3.10.m2.1.1">superscript</csymbol><ci id="S3.p3.10.m2.1.1.2.cmml" xref="S3.p3.10.m2.1.1.2">𝑝</ci><times id="S3.p3.10.m2.1.1.3.cmml" xref="S3.p3.10.m2.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.10.m2.1c">p^{*}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.10.m2.1d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math>, we can parametrize a reward model <math alttext="r_{\phi}(x,y)" class="ltx_Math" display="inline" id="S3.p3.11.m3.2"><semantics id="S3.p3.11.m3.2a"><mrow id="S3.p3.11.m3.2.3" xref="S3.p3.11.m3.2.3.cmml"><msub id="S3.p3.11.m3.2.3.2" xref="S3.p3.11.m3.2.3.2.cmml"><mi id="S3.p3.11.m3.2.3.2.2" xref="S3.p3.11.m3.2.3.2.2.cmml">r</mi><mi id="S3.p3.11.m3.2.3.2.3" xref="S3.p3.11.m3.2.3.2.3.cmml">ϕ</mi></msub><mo id="S3.p3.11.m3.2.3.1" xref="S3.p3.11.m3.2.3.1.cmml">⁢</mo><mrow id="S3.p3.11.m3.2.3.3.2" xref="S3.p3.11.m3.2.3.3.1.cmml"><mo id="S3.p3.11.m3.2.3.3.2.1" stretchy="false" xref="S3.p3.11.m3.2.3.3.1.cmml">(</mo><mi id="S3.p3.11.m3.1.1" xref="S3.p3.11.m3.1.1.cmml">x</mi><mo id="S3.p3.11.m3.2.3.3.2.2" xref="S3.p3.11.m3.2.3.3.1.cmml">,</mo><mi id="S3.p3.11.m3.2.2" xref="S3.p3.11.m3.2.2.cmml">y</mi><mo id="S3.p3.11.m3.2.3.3.2.3" stretchy="false" xref="S3.p3.11.m3.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.11.m3.2b"><apply id="S3.p3.11.m3.2.3.cmml" xref="S3.p3.11.m3.2.3"><times id="S3.p3.11.m3.2.3.1.cmml" xref="S3.p3.11.m3.2.3.1"></times><apply id="S3.p3.11.m3.2.3.2.cmml" xref="S3.p3.11.m3.2.3.2"><csymbol cd="ambiguous" id="S3.p3.11.m3.2.3.2.1.cmml" xref="S3.p3.11.m3.2.3.2">subscript</csymbol><ci id="S3.p3.11.m3.2.3.2.2.cmml" xref="S3.p3.11.m3.2.3.2.2">𝑟</ci><ci id="S3.p3.11.m3.2.3.2.3.cmml" xref="S3.p3.11.m3.2.3.2.3">italic-ϕ</ci></apply><interval closure="open" id="S3.p3.11.m3.2.3.3.1.cmml" xref="S3.p3.11.m3.2.3.3.2"><ci id="S3.p3.11.m3.1.1.cmml" xref="S3.p3.11.m3.1.1">𝑥</ci><ci id="S3.p3.11.m3.2.2.cmml" xref="S3.p3.11.m3.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.11.m3.2c">r_{\phi}(x,y)</annotation><annotation encoding="application/x-llamapun" id="S3.p3.11.m3.2d">italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y )</annotation></semantics></math> and estimate the parameters via maximum likelihood. Framing the problem as a binary classification we have the negative log-likelihood loss:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{R}(r_{\phi},\mathcal{D})=-\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal%
{D}}\bigl{[}\log\sigma(r_{\phi}(x,y_{w})-r_{\phi}(x,y_{l}))\bigr{]}" class="ltx_Math" display="block" id="S3.E2.m1.8"><semantics id="S3.E2.m1.8a"><mrow id="S3.E2.m1.8.8" xref="S3.E2.m1.8.8.cmml"><mrow id="S3.E2.m1.7.7.1" xref="S3.E2.m1.7.7.1.cmml"><msub id="S3.E2.m1.7.7.1.3" xref="S3.E2.m1.7.7.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.7.7.1.3.2" xref="S3.E2.m1.7.7.1.3.2.cmml">ℒ</mi><mi id="S3.E2.m1.7.7.1.3.3" xref="S3.E2.m1.7.7.1.3.3.cmml">R</mi></msub><mo id="S3.E2.m1.7.7.1.2" xref="S3.E2.m1.7.7.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.7.7.1.1.1" xref="S3.E2.m1.7.7.1.1.2.cmml"><mo id="S3.E2.m1.7.7.1.1.1.2" stretchy="false" xref="S3.E2.m1.7.7.1.1.2.cmml">(</mo><msub id="S3.E2.m1.7.7.1.1.1.1" xref="S3.E2.m1.7.7.1.1.1.1.cmml"><mi id="S3.E2.m1.7.7.1.1.1.1.2" xref="S3.E2.m1.7.7.1.1.1.1.2.cmml">r</mi><mi id="S3.E2.m1.7.7.1.1.1.1.3" xref="S3.E2.m1.7.7.1.1.1.1.3.cmml">ϕ</mi></msub><mo id="S3.E2.m1.7.7.1.1.1.3" xref="S3.E2.m1.7.7.1.1.2.cmml">,</mo><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.4.4" xref="S3.E2.m1.4.4.cmml">𝒟</mi><mo id="S3.E2.m1.7.7.1.1.1.4" stretchy="false" xref="S3.E2.m1.7.7.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.8.8.3" xref="S3.E2.m1.8.8.3.cmml">=</mo><mrow id="S3.E2.m1.8.8.2" xref="S3.E2.m1.8.8.2.cmml"><mo id="S3.E2.m1.8.8.2a" xref="S3.E2.m1.8.8.2.cmml">−</mo><mrow id="S3.E2.m1.8.8.2.1" xref="S3.E2.m1.8.8.2.1.cmml"><msub id="S3.E2.m1.8.8.2.1.3" xref="S3.E2.m1.8.8.2.1.3.cmml"><mi id="S3.E2.m1.8.8.2.1.3.2" xref="S3.E2.m1.8.8.2.1.3.2.cmml">𝔼</mi><mrow id="S3.E2.m1.3.3.3" xref="S3.E2.m1.3.3.3.cmml"><mrow id="S3.E2.m1.3.3.3.3.2" xref="S3.E2.m1.3.3.3.3.3.cmml"><mo id="S3.E2.m1.3.3.3.3.2.3" stretchy="false" xref="S3.E2.m1.3.3.3.3.3.cmml">(</mo><mi id="S3.E2.m1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.cmml">x</mi><mo id="S3.E2.m1.3.3.3.3.2.4" xref="S3.E2.m1.3.3.3.3.3.cmml">,</mo><msub id="S3.E2.m1.2.2.2.2.1.1" xref="S3.E2.m1.2.2.2.2.1.1.cmml"><mi id="S3.E2.m1.2.2.2.2.1.1.2" xref="S3.E2.m1.2.2.2.2.1.1.2.cmml">y</mi><mi id="S3.E2.m1.2.2.2.2.1.1.3" xref="S3.E2.m1.2.2.2.2.1.1.3.cmml">w</mi></msub><mo id="S3.E2.m1.3.3.3.3.2.5" xref="S3.E2.m1.3.3.3.3.3.cmml">,</mo><msub id="S3.E2.m1.3.3.3.3.2.2" xref="S3.E2.m1.3.3.3.3.2.2.cmml"><mi id="S3.E2.m1.3.3.3.3.2.2.2" xref="S3.E2.m1.3.3.3.3.2.2.2.cmml">y</mi><mi id="S3.E2.m1.3.3.3.3.2.2.3" xref="S3.E2.m1.3.3.3.3.2.2.3.cmml">l</mi></msub><mo id="S3.E2.m1.3.3.3.3.2.6" stretchy="false" xref="S3.E2.m1.3.3.3.3.3.cmml">)</mo></mrow><mo id="S3.E2.m1.3.3.3.4" xref="S3.E2.m1.3.3.3.4.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.3.3.3.5" xref="S3.E2.m1.3.3.3.5.cmml">𝒟</mi></mrow></msub><mo id="S3.E2.m1.8.8.2.1.2" xref="S3.E2.m1.8.8.2.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.8.8.2.1.1.1" xref="S3.E2.m1.8.8.2.1.1.2.cmml"><mo id="S3.E2.m1.8.8.2.1.1.1.2" maxsize="120%" minsize="120%" xref="S3.E2.m1.8.8.2.1.1.2.1.cmml">[</mo><mrow id="S3.E2.m1.8.8.2.1.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.cmml"><mrow id="S3.E2.m1.8.8.2.1.1.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.3.cmml"><mi id="S3.E2.m1.8.8.2.1.1.1.1.3.1" xref="S3.E2.m1.8.8.2.1.1.1.1.3.1.cmml">log</mi><mo id="S3.E2.m1.8.8.2.1.1.1.1.3a" lspace="0.167em" xref="S3.E2.m1.8.8.2.1.1.1.1.3.cmml">⁡</mo><mi id="S3.E2.m1.8.8.2.1.1.1.1.3.2" xref="S3.E2.m1.8.8.2.1.1.1.1.3.2.cmml">σ</mi></mrow><mo id="S3.E2.m1.8.8.2.1.1.1.1.2" xref="S3.E2.m1.8.8.2.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.8.8.2.1.1.1.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.cmml"><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.cmml"><mrow id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.cmml"><msub id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.2.cmml">r</mi><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.3.cmml">ϕ</mi></msub><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.2.cmml">(</mo><mi id="S3.E2.m1.5.5" xref="S3.E2.m1.5.5.cmml">x</mi><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.3.cmml">w</mi></msub><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.3.cmml">−</mo><mrow id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.cmml"><msub id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.cmml"><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.2.cmml">r</mi><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.3.cmml">ϕ</mi></msub><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.2.cmml">⁢</mo><mrow id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.2.cmml"><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.2" stretchy="false" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.2.cmml">(</mo><mi id="S3.E2.m1.6.6" xref="S3.E2.m1.6.6.cmml">x</mi><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.2.cmml">,</mo><msub id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.cmml"><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.2" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.2.cmml">y</mi><mi id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.3" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.3.cmml">l</mi></msub><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.4" stretchy="false" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E2.m1.8.8.2.1.1.1.1.1.1.3" stretchy="false" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.8.8.2.1.1.1.3" maxsize="120%" minsize="120%" xref="S3.E2.m1.8.8.2.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.8b"><apply id="S3.E2.m1.8.8.cmml" xref="S3.E2.m1.8.8"><eq id="S3.E2.m1.8.8.3.cmml" xref="S3.E2.m1.8.8.3"></eq><apply id="S3.E2.m1.7.7.1.cmml" xref="S3.E2.m1.7.7.1"><times id="S3.E2.m1.7.7.1.2.cmml" xref="S3.E2.m1.7.7.1.2"></times><apply id="S3.E2.m1.7.7.1.3.cmml" xref="S3.E2.m1.7.7.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.7.7.1.3.1.cmml" xref="S3.E2.m1.7.7.1.3">subscript</csymbol><ci id="S3.E2.m1.7.7.1.3.2.cmml" xref="S3.E2.m1.7.7.1.3.2">ℒ</ci><ci id="S3.E2.m1.7.7.1.3.3.cmml" xref="S3.E2.m1.7.7.1.3.3">𝑅</ci></apply><interval closure="open" id="S3.E2.m1.7.7.1.1.2.cmml" xref="S3.E2.m1.7.7.1.1.1"><apply id="S3.E2.m1.7.7.1.1.1.1.cmml" xref="S3.E2.m1.7.7.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.7.7.1.1.1.1.1.cmml" xref="S3.E2.m1.7.7.1.1.1.1">subscript</csymbol><ci id="S3.E2.m1.7.7.1.1.1.1.2.cmml" xref="S3.E2.m1.7.7.1.1.1.1.2">𝑟</ci><ci id="S3.E2.m1.7.7.1.1.1.1.3.cmml" xref="S3.E2.m1.7.7.1.1.1.1.3">italic-ϕ</ci></apply><ci id="S3.E2.m1.4.4.cmml" xref="S3.E2.m1.4.4">𝒟</ci></interval></apply><apply id="S3.E2.m1.8.8.2.cmml" xref="S3.E2.m1.8.8.2"><minus id="S3.E2.m1.8.8.2.2.cmml" xref="S3.E2.m1.8.8.2"></minus><apply id="S3.E2.m1.8.8.2.1.cmml" xref="S3.E2.m1.8.8.2.1"><times id="S3.E2.m1.8.8.2.1.2.cmml" xref="S3.E2.m1.8.8.2.1.2"></times><apply id="S3.E2.m1.8.8.2.1.3.cmml" xref="S3.E2.m1.8.8.2.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.8.8.2.1.3.1.cmml" xref="S3.E2.m1.8.8.2.1.3">subscript</csymbol><ci id="S3.E2.m1.8.8.2.1.3.2.cmml" xref="S3.E2.m1.8.8.2.1.3.2">𝔼</ci><apply id="S3.E2.m1.3.3.3.cmml" xref="S3.E2.m1.3.3.3"><csymbol cd="latexml" id="S3.E2.m1.3.3.3.4.cmml" xref="S3.E2.m1.3.3.3.4">similar-to</csymbol><vector id="S3.E2.m1.3.3.3.3.3.cmml" xref="S3.E2.m1.3.3.3.3.2"><ci id="S3.E2.m1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1">𝑥</ci><apply id="S3.E2.m1.2.2.2.2.1.1.cmml" xref="S3.E2.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.2.2.2.2.1.1.1.cmml" xref="S3.E2.m1.2.2.2.2.1.1">subscript</csymbol><ci id="S3.E2.m1.2.2.2.2.1.1.2.cmml" xref="S3.E2.m1.2.2.2.2.1.1.2">𝑦</ci><ci id="S3.E2.m1.2.2.2.2.1.1.3.cmml" xref="S3.E2.m1.2.2.2.2.1.1.3">𝑤</ci></apply><apply id="S3.E2.m1.3.3.3.3.2.2.cmml" xref="S3.E2.m1.3.3.3.3.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.3.3.3.3.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.2.2">subscript</csymbol><ci id="S3.E2.m1.3.3.3.3.2.2.2.cmml" xref="S3.E2.m1.3.3.3.3.2.2.2">𝑦</ci><ci id="S3.E2.m1.3.3.3.3.2.2.3.cmml" xref="S3.E2.m1.3.3.3.3.2.2.3">𝑙</ci></apply></vector><ci id="S3.E2.m1.3.3.3.5.cmml" xref="S3.E2.m1.3.3.3.5">𝒟</ci></apply></apply><apply id="S3.E2.m1.8.8.2.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1"><csymbol cd="latexml" id="S3.E2.m1.8.8.2.1.1.2.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.2">delimited-[]</csymbol><apply id="S3.E2.m1.8.8.2.1.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1"><times id="S3.E2.m1.8.8.2.1.1.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.2"></times><apply id="S3.E2.m1.8.8.2.1.1.1.1.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.3"><log id="S3.E2.m1.8.8.2.1.1.1.1.3.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.3.1"></log><ci id="S3.E2.m1.8.8.2.1.1.1.1.3.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.3.2">𝜎</ci></apply><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1"><minus id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.3"></minus><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1"><times id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.2"></times><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.2">𝑟</ci><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.3.3">italic-ϕ</ci></apply><interval closure="open" id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1"><ci id="S3.E2.m1.5.5.cmml" xref="S3.E2.m1.5.5">𝑥</ci><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.1.1.1.1.3">𝑤</ci></apply></interval></apply><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2"><times id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.2"></times><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3"><csymbol cd="ambiguous" id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3">subscript</csymbol><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.2">𝑟</ci><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.3.3">italic-ϕ</ci></apply><interval closure="open" id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1"><ci id="S3.E2.m1.6.6.cmml" xref="S3.E2.m1.6.6">𝑥</ci><apply id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.1.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1">subscript</csymbol><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.2">𝑦</ci><ci id="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.3.cmml" xref="S3.E2.m1.8.8.2.1.1.1.1.1.1.1.2.1.1.1.3">𝑙</ci></apply></interval></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.8c">\mathcal{L}_{R}(r_{\phi},\mathcal{D})=-\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal%
{D}}\bigl{[}\log\sigma(r_{\phi}(x,y_{w})-r_{\phi}(x,y_{l}))\bigr{]}</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.8d">caligraphic_L start_POSTSUBSCRIPT italic_R end_POSTSUBSCRIPT ( italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT , caligraphic_D ) = - blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT [ roman_log italic_σ ( italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ) - italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p3.16">where <math alttext="\sigma" class="ltx_Math" display="inline" id="S3.p3.12.m1.1"><semantics id="S3.p3.12.m1.1a"><mi id="S3.p3.12.m1.1.1" xref="S3.p3.12.m1.1.1.cmml">σ</mi><annotation-xml encoding="MathML-Content" id="S3.p3.12.m1.1b"><ci id="S3.p3.12.m1.1.1.cmml" xref="S3.p3.12.m1.1.1">𝜎</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.12.m1.1c">\sigma</annotation><annotation encoding="application/x-llamapun" id="S3.p3.12.m1.1d">italic_σ</annotation></semantics></math> is the logistic function. In the context of LMs, the network <math alttext="r_{\phi}(x,y)" class="ltx_Math" display="inline" id="S3.p3.13.m2.2"><semantics id="S3.p3.13.m2.2a"><mrow id="S3.p3.13.m2.2.3" xref="S3.p3.13.m2.2.3.cmml"><msub id="S3.p3.13.m2.2.3.2" xref="S3.p3.13.m2.2.3.2.cmml"><mi id="S3.p3.13.m2.2.3.2.2" xref="S3.p3.13.m2.2.3.2.2.cmml">r</mi><mi id="S3.p3.13.m2.2.3.2.3" xref="S3.p3.13.m2.2.3.2.3.cmml">ϕ</mi></msub><mo id="S3.p3.13.m2.2.3.1" xref="S3.p3.13.m2.2.3.1.cmml">⁢</mo><mrow id="S3.p3.13.m2.2.3.3.2" xref="S3.p3.13.m2.2.3.3.1.cmml"><mo id="S3.p3.13.m2.2.3.3.2.1" stretchy="false" xref="S3.p3.13.m2.2.3.3.1.cmml">(</mo><mi id="S3.p3.13.m2.1.1" xref="S3.p3.13.m2.1.1.cmml">x</mi><mo id="S3.p3.13.m2.2.3.3.2.2" xref="S3.p3.13.m2.2.3.3.1.cmml">,</mo><mi id="S3.p3.13.m2.2.2" xref="S3.p3.13.m2.2.2.cmml">y</mi><mo id="S3.p3.13.m2.2.3.3.2.3" stretchy="false" xref="S3.p3.13.m2.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.13.m2.2b"><apply id="S3.p3.13.m2.2.3.cmml" xref="S3.p3.13.m2.2.3"><times id="S3.p3.13.m2.2.3.1.cmml" xref="S3.p3.13.m2.2.3.1"></times><apply id="S3.p3.13.m2.2.3.2.cmml" xref="S3.p3.13.m2.2.3.2"><csymbol cd="ambiguous" id="S3.p3.13.m2.2.3.2.1.cmml" xref="S3.p3.13.m2.2.3.2">subscript</csymbol><ci id="S3.p3.13.m2.2.3.2.2.cmml" xref="S3.p3.13.m2.2.3.2.2">𝑟</ci><ci id="S3.p3.13.m2.2.3.2.3.cmml" xref="S3.p3.13.m2.2.3.2.3">italic-ϕ</ci></apply><interval closure="open" id="S3.p3.13.m2.2.3.3.1.cmml" xref="S3.p3.13.m2.2.3.3.2"><ci id="S3.p3.13.m2.1.1.cmml" xref="S3.p3.13.m2.1.1">𝑥</ci><ci id="S3.p3.13.m2.2.2.cmml" xref="S3.p3.13.m2.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.13.m2.2c">r_{\phi}(x,y)</annotation><annotation encoding="application/x-llamapun" id="S3.p3.13.m2.2d">italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y )</annotation></semantics></math> is often initialized from the SFT model <math alttext="\pi^{\text{SFT}}(y\mid x)" class="ltx_Math" display="inline" id="S3.p3.14.m3.1"><semantics id="S3.p3.14.m3.1a"><mrow id="S3.p3.14.m3.1.1" xref="S3.p3.14.m3.1.1.cmml"><msup id="S3.p3.14.m3.1.1.3" xref="S3.p3.14.m3.1.1.3.cmml"><mi id="S3.p3.14.m3.1.1.3.2" xref="S3.p3.14.m3.1.1.3.2.cmml">π</mi><mtext id="S3.p3.14.m3.1.1.3.3" xref="S3.p3.14.m3.1.1.3.3a.cmml">SFT</mtext></msup><mo id="S3.p3.14.m3.1.1.2" xref="S3.p3.14.m3.1.1.2.cmml">⁢</mo><mrow id="S3.p3.14.m3.1.1.1.1" xref="S3.p3.14.m3.1.1.1.1.1.cmml"><mo id="S3.p3.14.m3.1.1.1.1.2" stretchy="false" xref="S3.p3.14.m3.1.1.1.1.1.cmml">(</mo><mrow id="S3.p3.14.m3.1.1.1.1.1" xref="S3.p3.14.m3.1.1.1.1.1.cmml"><mi id="S3.p3.14.m3.1.1.1.1.1.2" xref="S3.p3.14.m3.1.1.1.1.1.2.cmml">y</mi><mo id="S3.p3.14.m3.1.1.1.1.1.1" xref="S3.p3.14.m3.1.1.1.1.1.1.cmml">∣</mo><mi id="S3.p3.14.m3.1.1.1.1.1.3" xref="S3.p3.14.m3.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.p3.14.m3.1.1.1.1.3" stretchy="false" xref="S3.p3.14.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.14.m3.1b"><apply id="S3.p3.14.m3.1.1.cmml" xref="S3.p3.14.m3.1.1"><times id="S3.p3.14.m3.1.1.2.cmml" xref="S3.p3.14.m3.1.1.2"></times><apply id="S3.p3.14.m3.1.1.3.cmml" xref="S3.p3.14.m3.1.1.3"><csymbol cd="ambiguous" id="S3.p3.14.m3.1.1.3.1.cmml" xref="S3.p3.14.m3.1.1.3">superscript</csymbol><ci id="S3.p3.14.m3.1.1.3.2.cmml" xref="S3.p3.14.m3.1.1.3.2">𝜋</ci><ci id="S3.p3.14.m3.1.1.3.3a.cmml" xref="S3.p3.14.m3.1.1.3.3"><mtext id="S3.p3.14.m3.1.1.3.3.cmml" mathsize="70%" xref="S3.p3.14.m3.1.1.3.3">SFT</mtext></ci></apply><apply id="S3.p3.14.m3.1.1.1.1.1.cmml" xref="S3.p3.14.m3.1.1.1.1"><csymbol cd="latexml" id="S3.p3.14.m3.1.1.1.1.1.1.cmml" xref="S3.p3.14.m3.1.1.1.1.1.1">conditional</csymbol><ci id="S3.p3.14.m3.1.1.1.1.1.2.cmml" xref="S3.p3.14.m3.1.1.1.1.1.2">𝑦</ci><ci id="S3.p3.14.m3.1.1.1.1.1.3.cmml" xref="S3.p3.14.m3.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.14.m3.1c">\pi^{\text{SFT}}(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="S3.p3.14.m3.1d">italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT ( italic_y ∣ italic_x )</annotation></semantics></math> with the addition of a linear layer on top of the final transformer layer that produces a single scalar prediction for the reward value <cite class="ltx_cite ltx_citemacro_cite">Ziegler et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib49" title="">2020</a>)</cite>. To ensure a reward function with lower variance, prior works normalize the rewards, such that <math alttext="\mathbb{E}_{x,y\sim\mathcal{D}}\left[r_{\phi}(x,y)\right]=0" class="ltx_Math" display="inline" id="S3.p3.15.m4.5"><semantics id="S3.p3.15.m4.5a"><mrow id="S3.p3.15.m4.5.5" xref="S3.p3.15.m4.5.5.cmml"><mrow id="S3.p3.15.m4.5.5.1" xref="S3.p3.15.m4.5.5.1.cmml"><msub id="S3.p3.15.m4.5.5.1.3" xref="S3.p3.15.m4.5.5.1.3.cmml"><mi id="S3.p3.15.m4.5.5.1.3.2" xref="S3.p3.15.m4.5.5.1.3.2.cmml">𝔼</mi><mrow id="S3.p3.15.m4.2.2.2" xref="S3.p3.15.m4.2.2.2.cmml"><mrow id="S3.p3.15.m4.2.2.2.4.2" xref="S3.p3.15.m4.2.2.2.4.1.cmml"><mi id="S3.p3.15.m4.1.1.1.1" xref="S3.p3.15.m4.1.1.1.1.cmml">x</mi><mo id="S3.p3.15.m4.2.2.2.4.2.1" xref="S3.p3.15.m4.2.2.2.4.1.cmml">,</mo><mi id="S3.p3.15.m4.2.2.2.2" xref="S3.p3.15.m4.2.2.2.2.cmml">y</mi></mrow><mo id="S3.p3.15.m4.2.2.2.3" xref="S3.p3.15.m4.2.2.2.3.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.p3.15.m4.2.2.2.5" xref="S3.p3.15.m4.2.2.2.5.cmml">𝒟</mi></mrow></msub><mo id="S3.p3.15.m4.5.5.1.2" xref="S3.p3.15.m4.5.5.1.2.cmml">⁢</mo><mrow id="S3.p3.15.m4.5.5.1.1.1" xref="S3.p3.15.m4.5.5.1.1.2.cmml"><mo id="S3.p3.15.m4.5.5.1.1.1.2" xref="S3.p3.15.m4.5.5.1.1.2.1.cmml">[</mo><mrow id="S3.p3.15.m4.5.5.1.1.1.1" xref="S3.p3.15.m4.5.5.1.1.1.1.cmml"><msub id="S3.p3.15.m4.5.5.1.1.1.1.2" xref="S3.p3.15.m4.5.5.1.1.1.1.2.cmml"><mi id="S3.p3.15.m4.5.5.1.1.1.1.2.2" xref="S3.p3.15.m4.5.5.1.1.1.1.2.2.cmml">r</mi><mi id="S3.p3.15.m4.5.5.1.1.1.1.2.3" xref="S3.p3.15.m4.5.5.1.1.1.1.2.3.cmml">ϕ</mi></msub><mo id="S3.p3.15.m4.5.5.1.1.1.1.1" xref="S3.p3.15.m4.5.5.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.p3.15.m4.5.5.1.1.1.1.3.2" xref="S3.p3.15.m4.5.5.1.1.1.1.3.1.cmml"><mo id="S3.p3.15.m4.5.5.1.1.1.1.3.2.1" stretchy="false" xref="S3.p3.15.m4.5.5.1.1.1.1.3.1.cmml">(</mo><mi id="S3.p3.15.m4.3.3" xref="S3.p3.15.m4.3.3.cmml">x</mi><mo id="S3.p3.15.m4.5.5.1.1.1.1.3.2.2" xref="S3.p3.15.m4.5.5.1.1.1.1.3.1.cmml">,</mo><mi id="S3.p3.15.m4.4.4" xref="S3.p3.15.m4.4.4.cmml">y</mi><mo id="S3.p3.15.m4.5.5.1.1.1.1.3.2.3" stretchy="false" xref="S3.p3.15.m4.5.5.1.1.1.1.3.1.cmml">)</mo></mrow></mrow><mo id="S3.p3.15.m4.5.5.1.1.1.3" xref="S3.p3.15.m4.5.5.1.1.2.1.cmml">]</mo></mrow></mrow><mo id="S3.p3.15.m4.5.5.2" xref="S3.p3.15.m4.5.5.2.cmml">=</mo><mn id="S3.p3.15.m4.5.5.3" xref="S3.p3.15.m4.5.5.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.p3.15.m4.5b"><apply id="S3.p3.15.m4.5.5.cmml" xref="S3.p3.15.m4.5.5"><eq id="S3.p3.15.m4.5.5.2.cmml" xref="S3.p3.15.m4.5.5.2"></eq><apply id="S3.p3.15.m4.5.5.1.cmml" xref="S3.p3.15.m4.5.5.1"><times id="S3.p3.15.m4.5.5.1.2.cmml" xref="S3.p3.15.m4.5.5.1.2"></times><apply id="S3.p3.15.m4.5.5.1.3.cmml" xref="S3.p3.15.m4.5.5.1.3"><csymbol cd="ambiguous" id="S3.p3.15.m4.5.5.1.3.1.cmml" xref="S3.p3.15.m4.5.5.1.3">subscript</csymbol><ci id="S3.p3.15.m4.5.5.1.3.2.cmml" xref="S3.p3.15.m4.5.5.1.3.2">𝔼</ci><apply id="S3.p3.15.m4.2.2.2.cmml" xref="S3.p3.15.m4.2.2.2"><csymbol cd="latexml" id="S3.p3.15.m4.2.2.2.3.cmml" xref="S3.p3.15.m4.2.2.2.3">similar-to</csymbol><list id="S3.p3.15.m4.2.2.2.4.1.cmml" xref="S3.p3.15.m4.2.2.2.4.2"><ci id="S3.p3.15.m4.1.1.1.1.cmml" xref="S3.p3.15.m4.1.1.1.1">𝑥</ci><ci id="S3.p3.15.m4.2.2.2.2.cmml" xref="S3.p3.15.m4.2.2.2.2">𝑦</ci></list><ci id="S3.p3.15.m4.2.2.2.5.cmml" xref="S3.p3.15.m4.2.2.2.5">𝒟</ci></apply></apply><apply id="S3.p3.15.m4.5.5.1.1.2.cmml" xref="S3.p3.15.m4.5.5.1.1.1"><csymbol cd="latexml" id="S3.p3.15.m4.5.5.1.1.2.1.cmml" xref="S3.p3.15.m4.5.5.1.1.1.2">delimited-[]</csymbol><apply id="S3.p3.15.m4.5.5.1.1.1.1.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1"><times id="S3.p3.15.m4.5.5.1.1.1.1.1.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1.1"></times><apply id="S3.p3.15.m4.5.5.1.1.1.1.2.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.p3.15.m4.5.5.1.1.1.1.2.1.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1.2">subscript</csymbol><ci id="S3.p3.15.m4.5.5.1.1.1.1.2.2.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1.2.2">𝑟</ci><ci id="S3.p3.15.m4.5.5.1.1.1.1.2.3.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1.2.3">italic-ϕ</ci></apply><interval closure="open" id="S3.p3.15.m4.5.5.1.1.1.1.3.1.cmml" xref="S3.p3.15.m4.5.5.1.1.1.1.3.2"><ci id="S3.p3.15.m4.3.3.cmml" xref="S3.p3.15.m4.3.3">𝑥</ci><ci id="S3.p3.15.m4.4.4.cmml" xref="S3.p3.15.m4.4.4">𝑦</ci></interval></apply></apply></apply><cn id="S3.p3.15.m4.5.5.3.cmml" type="integer" xref="S3.p3.15.m4.5.5.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.15.m4.5c">\mathbb{E}_{x,y\sim\mathcal{D}}\left[r_{\phi}(x,y)\right]=0</annotation><annotation encoding="application/x-llamapun" id="S3.p3.15.m4.5d">blackboard_E start_POSTSUBSCRIPT italic_x , italic_y ∼ caligraphic_D end_POSTSUBSCRIPT [ italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y ) ] = 0</annotation></semantics></math> for all <math alttext="x" class="ltx_Math" display="inline" id="S3.p3.16.m5.1"><semantics id="S3.p3.16.m5.1a"><mi id="S3.p3.16.m5.1.1" xref="S3.p3.16.m5.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.p3.16.m5.1b"><ci id="S3.p3.16.m5.1.1.cmml" xref="S3.p3.16.m5.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.16.m5.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.p3.16.m5.1d">italic_x</annotation></semantics></math>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S3.p4">
<p class="ltx_p" id="S3.p4.7"><span class="ltx_text ltx_font_bold" id="S3.p4.7.1">RL Fine-Tuning Phase</span>: During the RL phase, we use the learned reward function to provide feedback to the language model. In particular, we formulate the following optimization problem</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\pi_{\theta}}\mathbb{E}_{x\sim\mathcal{D},y\sim\pi_{\theta}(y\mid x)}%
\bigl{[}r_{\phi}(x,y)\bigr{]}-\beta\mathbb{D}_{\textrm{KL}}\bigl{[}\pi_{\theta%
}(y\mid x)\mid\mid\pi_{\text{ref}}(y\mid x)\bigr{]}" class="ltx_math_unparsed" display="block" id="S3.E3.m1.4"><semantics id="S3.E3.m1.4a"><mrow id="S3.E3.m1.4b"><munder id="S3.E3.m1.4.5"><mi id="S3.E3.m1.4.5.2">max</mi><msub id="S3.E3.m1.4.5.3"><mi id="S3.E3.m1.4.5.3.2">π</mi><mi id="S3.E3.m1.4.5.3.3">θ</mi></msub></munder><msub id="S3.E3.m1.4.6"><mi id="S3.E3.m1.4.6.2">𝔼</mi><mrow id="S3.E3.m1.2.2.2.2"><mrow id="S3.E3.m1.1.1.1.1.1"><mi id="S3.E3.m1.1.1.1.1.1.2">x</mi><mo id="S3.E3.m1.1.1.1.1.1.1">∼</mo><mi class="ltx_font_mathcaligraphic" id="S3.E3.m1.1.1.1.1.1.3">𝒟</mi></mrow><mo id="S3.E3.m1.2.2.2.2.3">,</mo><mrow id="S3.E3.m1.2.2.2.2.2"><mi id="S3.E3.m1.2.2.2.2.2.3">y</mi><mo id="S3.E3.m1.2.2.2.2.2.2">∼</mo><mrow id="S3.E3.m1.2.2.2.2.2.1"><msub id="S3.E3.m1.2.2.2.2.2.1.3"><mi id="S3.E3.m1.2.2.2.2.2.1.3.2">π</mi><mi id="S3.E3.m1.2.2.2.2.2.1.3.3">θ</mi></msub><mo id="S3.E3.m1.2.2.2.2.2.1.2">⁢</mo><mrow id="S3.E3.m1.2.2.2.2.2.1.1.1"><mo id="S3.E3.m1.2.2.2.2.2.1.1.1.2" stretchy="false">(</mo><mrow id="S3.E3.m1.2.2.2.2.2.1.1.1.1"><mi id="S3.E3.m1.2.2.2.2.2.1.1.1.1.2">y</mi><mo id="S3.E3.m1.2.2.2.2.2.1.1.1.1.1">∣</mo><mi id="S3.E3.m1.2.2.2.2.2.1.1.1.1.3">x</mi></mrow><mo id="S3.E3.m1.2.2.2.2.2.1.1.1.3" stretchy="false">)</mo></mrow></mrow></mrow></mrow></msub><mrow id="S3.E3.m1.4.7"><mo id="S3.E3.m1.4.7.1" maxsize="120%" minsize="120%">[</mo><msub id="S3.E3.m1.4.7.2"><mi id="S3.E3.m1.4.7.2.2">r</mi><mi id="S3.E3.m1.4.7.2.3">ϕ</mi></msub><mrow id="S3.E3.m1.4.7.3"><mo id="S3.E3.m1.4.7.3.1" stretchy="false">(</mo><mi id="S3.E3.m1.3.3">x</mi><mo id="S3.E3.m1.4.7.3.2">,</mo><mi id="S3.E3.m1.4.4">y</mi><mo id="S3.E3.m1.4.7.3.3" stretchy="false">)</mo></mrow><mo id="S3.E3.m1.4.7.4" maxsize="120%" minsize="120%">]</mo></mrow><mo id="S3.E3.m1.4.8">−</mo><mi id="S3.E3.m1.4.9">β</mi><msub id="S3.E3.m1.4.10"><mi id="S3.E3.m1.4.10.2">𝔻</mi><mtext id="S3.E3.m1.4.10.3">KL</mtext></msub><mrow id="S3.E3.m1.4.11"><mo id="S3.E3.m1.4.11.1" maxsize="120%" minsize="120%">[</mo><msub id="S3.E3.m1.4.11.2"><mi id="S3.E3.m1.4.11.2.2">π</mi><mi id="S3.E3.m1.4.11.2.3">θ</mi></msub><mrow id="S3.E3.m1.4.11.3"><mo id="S3.E3.m1.4.11.3.1" stretchy="false">(</mo><mi id="S3.E3.m1.4.11.3.2">y</mi><mo id="S3.E3.m1.4.11.3.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S3.E3.m1.4.11.3.4">x</mi><mo id="S3.E3.m1.4.11.3.5" stretchy="false">)</mo></mrow><mo id="S3.E3.m1.4.11.4" lspace="0em" rspace="0.0835em">∣</mo><mo id="S3.E3.m1.4.11.5" lspace="0.0835em" rspace="0.167em">∣</mo><msub id="S3.E3.m1.4.11.6"><mi id="S3.E3.m1.4.11.6.2">π</mi><mtext id="S3.E3.m1.4.11.6.3">ref</mtext></msub><mrow id="S3.E3.m1.4.11.7"><mo id="S3.E3.m1.4.11.7.1" stretchy="false">(</mo><mi id="S3.E3.m1.4.11.7.2">y</mi><mo id="S3.E3.m1.4.11.7.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S3.E3.m1.4.11.7.4">x</mi><mo id="S3.E3.m1.4.11.7.5" stretchy="false">)</mo></mrow><mo id="S3.E3.m1.4.11.8" maxsize="120%" minsize="120%">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.E3.m1.4c">\max_{\pi_{\theta}}\mathbb{E}_{x\sim\mathcal{D},y\sim\pi_{\theta}(y\mid x)}%
\bigl{[}r_{\phi}(x,y)\bigr{]}-\beta\mathbb{D}_{\textrm{KL}}\bigl{[}\pi_{\theta%
}(y\mid x)\mid\mid\pi_{\text{ref}}(y\mid x)\bigr{]}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.4d">roman_max start_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D , italic_y ∼ italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_POSTSUBSCRIPT [ italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y ) ] - italic_β blackboard_D start_POSTSUBSCRIPT KL end_POSTSUBSCRIPT [ italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) ∣ ∣ italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p4.6">where <math alttext="\beta" class="ltx_Math" display="inline" id="S3.p4.1.m1.1"><semantics id="S3.p4.1.m1.1a"><mi id="S3.p4.1.m1.1.1" xref="S3.p4.1.m1.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S3.p4.1.m1.1b"><ci id="S3.p4.1.m1.1.1.cmml" xref="S3.p4.1.m1.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.1.m1.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S3.p4.1.m1.1d">italic_β</annotation></semantics></math> is a parameter controlling the deviation from the base reference policy <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S3.p4.2.m2.1"><semantics id="S3.p4.2.m2.1a"><msub id="S3.p4.2.m2.1.1" xref="S3.p4.2.m2.1.1.cmml"><mi id="S3.p4.2.m2.1.1.2" xref="S3.p4.2.m2.1.1.2.cmml">π</mi><mtext id="S3.p4.2.m2.1.1.3" xref="S3.p4.2.m2.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.p4.2.m2.1b"><apply id="S3.p4.2.m2.1.1.cmml" xref="S3.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.p4.2.m2.1.1.1.cmml" xref="S3.p4.2.m2.1.1">subscript</csymbol><ci id="S3.p4.2.m2.1.1.2.cmml" xref="S3.p4.2.m2.1.1.2">𝜋</ci><ci id="S3.p4.2.m2.1.1.3a.cmml" xref="S3.p4.2.m2.1.1.3"><mtext id="S3.p4.2.m2.1.1.3.cmml" mathsize="70%" xref="S3.p4.2.m2.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.2.m2.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.2.m2.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math>, namely the initial SFT model <math alttext="\pi^{\text{SFT}}" class="ltx_Math" display="inline" id="S3.p4.3.m3.1"><semantics id="S3.p4.3.m3.1a"><msup id="S3.p4.3.m3.1.1" xref="S3.p4.3.m3.1.1.cmml"><mi id="S3.p4.3.m3.1.1.2" xref="S3.p4.3.m3.1.1.2.cmml">π</mi><mtext id="S3.p4.3.m3.1.1.3" xref="S3.p4.3.m3.1.1.3a.cmml">SFT</mtext></msup><annotation-xml encoding="MathML-Content" id="S3.p4.3.m3.1b"><apply id="S3.p4.3.m3.1.1.cmml" xref="S3.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S3.p4.3.m3.1.1.1.cmml" xref="S3.p4.3.m3.1.1">superscript</csymbol><ci id="S3.p4.3.m3.1.1.2.cmml" xref="S3.p4.3.m3.1.1.2">𝜋</ci><ci id="S3.p4.3.m3.1.1.3a.cmml" xref="S3.p4.3.m3.1.1.3"><mtext id="S3.p4.3.m3.1.1.3.cmml" mathsize="70%" xref="S3.p4.3.m3.1.1.3">SFT</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.3.m3.1c">\pi^{\text{SFT}}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.3.m3.1d">italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT</annotation></semantics></math>.
In practice, the language model policy <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S3.p4.4.m4.1"><semantics id="S3.p4.4.m4.1a"><msub id="S3.p4.4.m4.1.1" xref="S3.p4.4.m4.1.1.cmml"><mi id="S3.p4.4.m4.1.1.2" xref="S3.p4.4.m4.1.1.2.cmml">π</mi><mi id="S3.p4.4.m4.1.1.3" xref="S3.p4.4.m4.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p4.4.m4.1b"><apply id="S3.p4.4.m4.1.1.cmml" xref="S3.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S3.p4.4.m4.1.1.1.cmml" xref="S3.p4.4.m4.1.1">subscript</csymbol><ci id="S3.p4.4.m4.1.1.2.cmml" xref="S3.p4.4.m4.1.1.2">𝜋</ci><ci id="S3.p4.4.m4.1.1.3.cmml" xref="S3.p4.4.m4.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.4.m4.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.4.m4.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> is also initialized to <math alttext="\pi^{\text{SFT}}" class="ltx_Math" display="inline" id="S3.p4.5.m5.1"><semantics id="S3.p4.5.m5.1a"><msup id="S3.p4.5.m5.1.1" xref="S3.p4.5.m5.1.1.cmml"><mi id="S3.p4.5.m5.1.1.2" xref="S3.p4.5.m5.1.1.2.cmml">π</mi><mtext id="S3.p4.5.m5.1.1.3" xref="S3.p4.5.m5.1.1.3a.cmml">SFT</mtext></msup><annotation-xml encoding="MathML-Content" id="S3.p4.5.m5.1b"><apply id="S3.p4.5.m5.1.1.cmml" xref="S3.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S3.p4.5.m5.1.1.1.cmml" xref="S3.p4.5.m5.1.1">superscript</csymbol><ci id="S3.p4.5.m5.1.1.2.cmml" xref="S3.p4.5.m5.1.1.2">𝜋</ci><ci id="S3.p4.5.m5.1.1.3a.cmml" xref="S3.p4.5.m5.1.1.3"><mtext id="S3.p4.5.m5.1.1.3.cmml" mathsize="70%" xref="S3.p4.5.m5.1.1.3">SFT</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.5.m5.1c">\pi^{\text{SFT}}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.5.m5.1d">italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT</annotation></semantics></math>. The added constraint is important, as it prevents the model from deviating too far from the distribution on which the reward model is accurate, as well as maintaining the generation diversity and preventing mode-collapse to single high-reward answers. Due to the discrete nature of language generation, this objective is not differentiable and is typically optimized with reinforcement learning. The standard approach <cite class="ltx_cite ltx_citemacro_citep">(Ziegler et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib49" title="">2020</a>; Stiennon et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">2022</a>; Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib1" title="">2022a</a>; Ouyang et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib26" title="">2022</a>)</cite> has been to construct the reward function <math alttext="{r(x,y)=r_{\phi}(x,y)-\beta(\log\pi_{\theta}(y\mid x)-\log\pi_{\text{ref}}(y%
\mid x))}" class="ltx_Math" display="inline" id="S3.p4.6.m6.5"><semantics id="S3.p4.6.m6.5a"><mrow id="S3.p4.6.m6.5.5" xref="S3.p4.6.m6.5.5.cmml"><mrow id="S3.p4.6.m6.5.5.3" xref="S3.p4.6.m6.5.5.3.cmml"><mi id="S3.p4.6.m6.5.5.3.2" xref="S3.p4.6.m6.5.5.3.2.cmml">r</mi><mo id="S3.p4.6.m6.5.5.3.1" xref="S3.p4.6.m6.5.5.3.1.cmml">⁢</mo><mrow id="S3.p4.6.m6.5.5.3.3.2" xref="S3.p4.6.m6.5.5.3.3.1.cmml"><mo id="S3.p4.6.m6.5.5.3.3.2.1" stretchy="false" xref="S3.p4.6.m6.5.5.3.3.1.cmml">(</mo><mi id="S3.p4.6.m6.1.1" xref="S3.p4.6.m6.1.1.cmml">x</mi><mo id="S3.p4.6.m6.5.5.3.3.2.2" xref="S3.p4.6.m6.5.5.3.3.1.cmml">,</mo><mi id="S3.p4.6.m6.2.2" xref="S3.p4.6.m6.2.2.cmml">y</mi><mo id="S3.p4.6.m6.5.5.3.3.2.3" stretchy="false" xref="S3.p4.6.m6.5.5.3.3.1.cmml">)</mo></mrow></mrow><mo id="S3.p4.6.m6.5.5.2" xref="S3.p4.6.m6.5.5.2.cmml">=</mo><mrow id="S3.p4.6.m6.5.5.1" xref="S3.p4.6.m6.5.5.1.cmml"><mrow id="S3.p4.6.m6.5.5.1.3" xref="S3.p4.6.m6.5.5.1.3.cmml"><msub id="S3.p4.6.m6.5.5.1.3.2" xref="S3.p4.6.m6.5.5.1.3.2.cmml"><mi id="S3.p4.6.m6.5.5.1.3.2.2" xref="S3.p4.6.m6.5.5.1.3.2.2.cmml">r</mi><mi id="S3.p4.6.m6.5.5.1.3.2.3" xref="S3.p4.6.m6.5.5.1.3.2.3.cmml">ϕ</mi></msub><mo id="S3.p4.6.m6.5.5.1.3.1" xref="S3.p4.6.m6.5.5.1.3.1.cmml">⁢</mo><mrow id="S3.p4.6.m6.5.5.1.3.3.2" xref="S3.p4.6.m6.5.5.1.3.3.1.cmml"><mo id="S3.p4.6.m6.5.5.1.3.3.2.1" stretchy="false" xref="S3.p4.6.m6.5.5.1.3.3.1.cmml">(</mo><mi id="S3.p4.6.m6.3.3" xref="S3.p4.6.m6.3.3.cmml">x</mi><mo id="S3.p4.6.m6.5.5.1.3.3.2.2" xref="S3.p4.6.m6.5.5.1.3.3.1.cmml">,</mo><mi id="S3.p4.6.m6.4.4" xref="S3.p4.6.m6.4.4.cmml">y</mi><mo id="S3.p4.6.m6.5.5.1.3.3.2.3" stretchy="false" xref="S3.p4.6.m6.5.5.1.3.3.1.cmml">)</mo></mrow></mrow><mo id="S3.p4.6.m6.5.5.1.2" xref="S3.p4.6.m6.5.5.1.2.cmml">−</mo><mrow id="S3.p4.6.m6.5.5.1.1" xref="S3.p4.6.m6.5.5.1.1.cmml"><mi id="S3.p4.6.m6.5.5.1.1.3" xref="S3.p4.6.m6.5.5.1.1.3.cmml">β</mi><mo id="S3.p4.6.m6.5.5.1.1.2" xref="S3.p4.6.m6.5.5.1.1.2.cmml">⁢</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.cmml"><mo id="S3.p4.6.m6.5.5.1.1.1.1.2" stretchy="false" xref="S3.p4.6.m6.5.5.1.1.1.1.1.cmml">(</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.cmml"><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.cmml"><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.cmml"><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.1.cmml">log</mi><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3a" lspace="0.167em" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.cmml">⁡</mo><msub id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.cmml"><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.2.cmml">π</mi><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.3.cmml">θ</mi></msub></mrow><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.1.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.3.cmml">−</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.cmml"><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.cmml"><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.1.cmml">log</mi><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3a" lspace="0.167em" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.cmml">⁡</mo><msub id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.cmml"><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.2.cmml">π</mi><mtext id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.3a.cmml">ref</mtext></msub></mrow><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.2.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.2.cmml">⁢</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.cmml"><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.2" stretchy="false" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.cmml">(</mo><mrow id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.cmml"><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.2" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.2.cmml">y</mi><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.1" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.1.cmml">∣</mo><mi id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.3" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.3.cmml">x</mi></mrow><mo id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.3" stretchy="false" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.p4.6.m6.5.5.1.1.1.1.3" stretchy="false" xref="S3.p4.6.m6.5.5.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p4.6.m6.5b"><apply id="S3.p4.6.m6.5.5.cmml" xref="S3.p4.6.m6.5.5"><eq id="S3.p4.6.m6.5.5.2.cmml" xref="S3.p4.6.m6.5.5.2"></eq><apply id="S3.p4.6.m6.5.5.3.cmml" xref="S3.p4.6.m6.5.5.3"><times id="S3.p4.6.m6.5.5.3.1.cmml" xref="S3.p4.6.m6.5.5.3.1"></times><ci id="S3.p4.6.m6.5.5.3.2.cmml" xref="S3.p4.6.m6.5.5.3.2">𝑟</ci><interval closure="open" id="S3.p4.6.m6.5.5.3.3.1.cmml" xref="S3.p4.6.m6.5.5.3.3.2"><ci id="S3.p4.6.m6.1.1.cmml" xref="S3.p4.6.m6.1.1">𝑥</ci><ci id="S3.p4.6.m6.2.2.cmml" xref="S3.p4.6.m6.2.2">𝑦</ci></interval></apply><apply id="S3.p4.6.m6.5.5.1.cmml" xref="S3.p4.6.m6.5.5.1"><minus id="S3.p4.6.m6.5.5.1.2.cmml" xref="S3.p4.6.m6.5.5.1.2"></minus><apply id="S3.p4.6.m6.5.5.1.3.cmml" xref="S3.p4.6.m6.5.5.1.3"><times id="S3.p4.6.m6.5.5.1.3.1.cmml" xref="S3.p4.6.m6.5.5.1.3.1"></times><apply id="S3.p4.6.m6.5.5.1.3.2.cmml" xref="S3.p4.6.m6.5.5.1.3.2"><csymbol cd="ambiguous" id="S3.p4.6.m6.5.5.1.3.2.1.cmml" xref="S3.p4.6.m6.5.5.1.3.2">subscript</csymbol><ci id="S3.p4.6.m6.5.5.1.3.2.2.cmml" xref="S3.p4.6.m6.5.5.1.3.2.2">𝑟</ci><ci id="S3.p4.6.m6.5.5.1.3.2.3.cmml" xref="S3.p4.6.m6.5.5.1.3.2.3">italic-ϕ</ci></apply><interval closure="open" id="S3.p4.6.m6.5.5.1.3.3.1.cmml" xref="S3.p4.6.m6.5.5.1.3.3.2"><ci id="S3.p4.6.m6.3.3.cmml" xref="S3.p4.6.m6.3.3">𝑥</ci><ci id="S3.p4.6.m6.4.4.cmml" xref="S3.p4.6.m6.4.4">𝑦</ci></interval></apply><apply id="S3.p4.6.m6.5.5.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1"><times id="S3.p4.6.m6.5.5.1.1.2.cmml" xref="S3.p4.6.m6.5.5.1.1.2"></times><ci id="S3.p4.6.m6.5.5.1.1.3.cmml" xref="S3.p4.6.m6.5.5.1.1.3">𝛽</ci><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1"><minus id="S3.p4.6.m6.5.5.1.1.1.1.1.3.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.3"></minus><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1"><times id="S3.p4.6.m6.5.5.1.1.1.1.1.1.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.2"></times><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3"><log id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.1"></log><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2">subscript</csymbol><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.2">𝜋</ci><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.3.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.3.2.3">𝜃</ci></apply></apply><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2"><times id="S3.p4.6.m6.5.5.1.1.1.1.1.2.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.2"></times><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3"><log id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.1"></log><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2"><csymbol cd="ambiguous" id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2">subscript</csymbol><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.2">𝜋</ci><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.3a.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.3"><mtext id="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.3.cmml" mathsize="70%" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.3.2.3">ref</mtext></ci></apply></apply><apply id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1"><csymbol cd="latexml" id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.1.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.1">conditional</csymbol><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.2.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.2">𝑦</ci><ci id="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.3.cmml" xref="S3.p4.6.m6.5.5.1.1.1.1.1.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.6.m6.5c">{r(x,y)=r_{\phi}(x,y)-\beta(\log\pi_{\theta}(y\mid x)-\log\pi_{\text{ref}}(y%
\mid x))}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.6.m6.5d">italic_r ( italic_x , italic_y ) = italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y ) - italic_β ( roman_log italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) - roman_log italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) )</annotation></semantics></math>, and maximize using PPO <cite class="ltx_cite ltx_citemacro_cite">Schulman et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib37" title="">2017</a>)</cite>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Direct Preference Optimization</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">Motivated by the challenges of applying reinforcement learning algorithms on large-scale problems such as fine-tuning language models, our goal is to derive a simple approach for policy optimization using preferences directly. Unlike prior RLHF methods, which learn a reward and then optimize it via RL, our approach leverages a particular choice of reward model parameterization that enables extraction of its optimal policy in closed form, without an RL training loop.
As we will describe next in detail, our key insight is to leverage an analytical mapping from reward functions to optimal policies, which enables us to transform a loss function over reward functions into a loss function over policies.
This change-of-variables approach avoids fitting an explicit, standalone reward model, while still optimizing under existing models of human preferences, such as the Bradley-Terry model. In essence, the policy network represents both the language model and the (implicit) reward.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S4.p2">
<p class="ltx_p" id="S4.p2.1"><span class="ltx_text ltx_font_bold" id="S4.p2.1.1">Deriving the DPO objective.</span> We start with the same RL objective as prior work, Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E3" title="3 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a>, under a general reward function <math alttext="r" class="ltx_Math" display="inline" id="S4.p2.1.m1.1"><semantics id="S4.p2.1.m1.1a"><mi id="S4.p2.1.m1.1.1" xref="S4.p2.1.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S4.p2.1.m1.1b"><ci id="S4.p2.1.m1.1.1.cmml" xref="S4.p2.1.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.1.m1.1c">r</annotation><annotation encoding="application/x-llamapun" id="S4.p2.1.m1.1d">italic_r</annotation></semantics></math>. Following prior work&nbsp;<cite class="ltx_cite ltx_citemacro_citep">(Peters and Schaal, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib29" title="">2007</a>; Peng et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib28" title="">2019</a>; Korbak et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib17" title="">2022</a>; Go et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib15" title="">2023</a>)</cite>, it is straightforward to show that the optimal solution to the KL-constrained reward maximization objective in Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E3" title="3 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a> takes the form:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S4.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\pi_{r}(y\mid x)=\frac{1}{Z(x)}\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{%
\beta}r(x,y)\right)," class="ltx_Math" display="block" id="S4.E4.m1.5"><semantics id="S4.E4.m1.5a"><mrow id="S4.E4.m1.5.5.1" xref="S4.E4.m1.5.5.1.1.cmml"><mrow id="S4.E4.m1.5.5.1.1" xref="S4.E4.m1.5.5.1.1.cmml"><mrow id="S4.E4.m1.5.5.1.1.1" xref="S4.E4.m1.5.5.1.1.1.cmml"><msub id="S4.E4.m1.5.5.1.1.1.3" xref="S4.E4.m1.5.5.1.1.1.3.cmml"><mi id="S4.E4.m1.5.5.1.1.1.3.2" xref="S4.E4.m1.5.5.1.1.1.3.2.cmml">π</mi><mi id="S4.E4.m1.5.5.1.1.1.3.3" xref="S4.E4.m1.5.5.1.1.1.3.3.cmml">r</mi></msub><mo id="S4.E4.m1.5.5.1.1.1.2" xref="S4.E4.m1.5.5.1.1.1.2.cmml">⁢</mo><mrow id="S4.E4.m1.5.5.1.1.1.1.1" xref="S4.E4.m1.5.5.1.1.1.1.1.1.cmml"><mo id="S4.E4.m1.5.5.1.1.1.1.1.2" stretchy="false" xref="S4.E4.m1.5.5.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E4.m1.5.5.1.1.1.1.1.1" xref="S4.E4.m1.5.5.1.1.1.1.1.1.cmml"><mi id="S4.E4.m1.5.5.1.1.1.1.1.1.2" xref="S4.E4.m1.5.5.1.1.1.1.1.1.2.cmml">y</mi><mo id="S4.E4.m1.5.5.1.1.1.1.1.1.1" xref="S4.E4.m1.5.5.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S4.E4.m1.5.5.1.1.1.1.1.1.3" xref="S4.E4.m1.5.5.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E4.m1.5.5.1.1.1.1.1.3" stretchy="false" xref="S4.E4.m1.5.5.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E4.m1.5.5.1.1.4" xref="S4.E4.m1.5.5.1.1.4.cmml">=</mo><mrow id="S4.E4.m1.5.5.1.1.3" xref="S4.E4.m1.5.5.1.1.3.cmml"><mfrac id="S4.E4.m1.1.1" xref="S4.E4.m1.1.1.cmml"><mn id="S4.E4.m1.1.1.3" xref="S4.E4.m1.1.1.3.cmml">1</mn><mrow id="S4.E4.m1.1.1.1" xref="S4.E4.m1.1.1.1.cmml"><mi id="S4.E4.m1.1.1.1.3" xref="S4.E4.m1.1.1.1.3.cmml">Z</mi><mo id="S4.E4.m1.1.1.1.2" xref="S4.E4.m1.1.1.1.2.cmml">⁢</mo><mrow id="S4.E4.m1.1.1.1.4.2" xref="S4.E4.m1.1.1.1.cmml"><mo id="S4.E4.m1.1.1.1.4.2.1" stretchy="false" xref="S4.E4.m1.1.1.1.cmml">(</mo><mi id="S4.E4.m1.1.1.1.1" xref="S4.E4.m1.1.1.1.1.cmml">x</mi><mo id="S4.E4.m1.1.1.1.4.2.2" stretchy="false" xref="S4.E4.m1.1.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="S4.E4.m1.5.5.1.1.3.3" xref="S4.E4.m1.5.5.1.1.3.3.cmml">⁢</mo><msub id="S4.E4.m1.5.5.1.1.3.4" xref="S4.E4.m1.5.5.1.1.3.4.cmml"><mi id="S4.E4.m1.5.5.1.1.3.4.2" xref="S4.E4.m1.5.5.1.1.3.4.2.cmml">π</mi><mtext id="S4.E4.m1.5.5.1.1.3.4.3" xref="S4.E4.m1.5.5.1.1.3.4.3a.cmml">ref</mtext></msub><mo id="S4.E4.m1.5.5.1.1.3.3a" xref="S4.E4.m1.5.5.1.1.3.3.cmml">⁢</mo><mrow id="S4.E4.m1.5.5.1.1.2.1.1" xref="S4.E4.m1.5.5.1.1.2.1.1.1.cmml"><mo id="S4.E4.m1.5.5.1.1.2.1.1.2" stretchy="false" xref="S4.E4.m1.5.5.1.1.2.1.1.1.cmml">(</mo><mrow id="S4.E4.m1.5.5.1.1.2.1.1.1" xref="S4.E4.m1.5.5.1.1.2.1.1.1.cmml"><mi id="S4.E4.m1.5.5.1.1.2.1.1.1.2" xref="S4.E4.m1.5.5.1.1.2.1.1.1.2.cmml">y</mi><mo id="S4.E4.m1.5.5.1.1.2.1.1.1.1" xref="S4.E4.m1.5.5.1.1.2.1.1.1.1.cmml">∣</mo><mi id="S4.E4.m1.5.5.1.1.2.1.1.1.3" xref="S4.E4.m1.5.5.1.1.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E4.m1.5.5.1.1.2.1.1.3" stretchy="false" xref="S4.E4.m1.5.5.1.1.2.1.1.1.cmml">)</mo></mrow><mo id="S4.E4.m1.5.5.1.1.3.3b" lspace="0.167em" xref="S4.E4.m1.5.5.1.1.3.3.cmml">⁢</mo><mrow id="S4.E4.m1.5.5.1.1.3.2.1" xref="S4.E4.m1.5.5.1.1.3.2.2.cmml"><mi id="S4.E4.m1.4.4" xref="S4.E4.m1.4.4.cmml">exp</mi><mo id="S4.E4.m1.5.5.1.1.3.2.1a" xref="S4.E4.m1.5.5.1.1.3.2.2.cmml">⁡</mo><mrow id="S4.E4.m1.5.5.1.1.3.2.1.1" xref="S4.E4.m1.5.5.1.1.3.2.2.cmml"><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.2" xref="S4.E4.m1.5.5.1.1.3.2.2.cmml">(</mo><mrow id="S4.E4.m1.5.5.1.1.3.2.1.1.1" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.cmml"><mfrac id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.cmml"><mn id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.2" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.2.cmml">1</mn><mi id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.3" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.1.1" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.1.cmml">⁢</mo><mi id="S4.E4.m1.5.5.1.1.3.2.1.1.1.3" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.3.cmml">r</mi><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.1.1a" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.1.cmml">⁢</mo><mrow id="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.2" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.1.cmml"><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.2.1" stretchy="false" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.1.cmml">(</mo><mi id="S4.E4.m1.2.2" xref="S4.E4.m1.2.2.cmml">x</mi><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.2.2" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.1.cmml">,</mo><mi id="S4.E4.m1.3.3" xref="S4.E4.m1.3.3.cmml">y</mi><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.2.3" stretchy="false" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="S4.E4.m1.5.5.1.1.3.2.1.1.3" xref="S4.E4.m1.5.5.1.1.3.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S4.E4.m1.5.5.1.2" xref="S4.E4.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E4.m1.5b"><apply id="S4.E4.m1.5.5.1.1.cmml" xref="S4.E4.m1.5.5.1"><eq id="S4.E4.m1.5.5.1.1.4.cmml" xref="S4.E4.m1.5.5.1.1.4"></eq><apply id="S4.E4.m1.5.5.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.1"><times id="S4.E4.m1.5.5.1.1.1.2.cmml" xref="S4.E4.m1.5.5.1.1.1.2"></times><apply id="S4.E4.m1.5.5.1.1.1.3.cmml" xref="S4.E4.m1.5.5.1.1.1.3"><csymbol cd="ambiguous" id="S4.E4.m1.5.5.1.1.1.3.1.cmml" xref="S4.E4.m1.5.5.1.1.1.3">subscript</csymbol><ci id="S4.E4.m1.5.5.1.1.1.3.2.cmml" xref="S4.E4.m1.5.5.1.1.1.3.2">𝜋</ci><ci id="S4.E4.m1.5.5.1.1.1.3.3.cmml" xref="S4.E4.m1.5.5.1.1.1.3.3">𝑟</ci></apply><apply id="S4.E4.m1.5.5.1.1.1.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.1.1.1"><csymbol cd="latexml" id="S4.E4.m1.5.5.1.1.1.1.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.1.1.1.1.1">conditional</csymbol><ci id="S4.E4.m1.5.5.1.1.1.1.1.1.2.cmml" xref="S4.E4.m1.5.5.1.1.1.1.1.1.2">𝑦</ci><ci id="S4.E4.m1.5.5.1.1.1.1.1.1.3.cmml" xref="S4.E4.m1.5.5.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.E4.m1.5.5.1.1.3.cmml" xref="S4.E4.m1.5.5.1.1.3"><times id="S4.E4.m1.5.5.1.1.3.3.cmml" xref="S4.E4.m1.5.5.1.1.3.3"></times><apply id="S4.E4.m1.1.1.cmml" xref="S4.E4.m1.1.1"><divide id="S4.E4.m1.1.1.2.cmml" xref="S4.E4.m1.1.1"></divide><cn id="S4.E4.m1.1.1.3.cmml" type="integer" xref="S4.E4.m1.1.1.3">1</cn><apply id="S4.E4.m1.1.1.1.cmml" xref="S4.E4.m1.1.1.1"><times id="S4.E4.m1.1.1.1.2.cmml" xref="S4.E4.m1.1.1.1.2"></times><ci id="S4.E4.m1.1.1.1.3.cmml" xref="S4.E4.m1.1.1.1.3">𝑍</ci><ci id="S4.E4.m1.1.1.1.1.cmml" xref="S4.E4.m1.1.1.1.1">𝑥</ci></apply></apply><apply id="S4.E4.m1.5.5.1.1.3.4.cmml" xref="S4.E4.m1.5.5.1.1.3.4"><csymbol cd="ambiguous" id="S4.E4.m1.5.5.1.1.3.4.1.cmml" xref="S4.E4.m1.5.5.1.1.3.4">subscript</csymbol><ci id="S4.E4.m1.5.5.1.1.3.4.2.cmml" xref="S4.E4.m1.5.5.1.1.3.4.2">𝜋</ci><ci id="S4.E4.m1.5.5.1.1.3.4.3a.cmml" xref="S4.E4.m1.5.5.1.1.3.4.3"><mtext id="S4.E4.m1.5.5.1.1.3.4.3.cmml" mathsize="70%" xref="S4.E4.m1.5.5.1.1.3.4.3">ref</mtext></ci></apply><apply id="S4.E4.m1.5.5.1.1.2.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.2.1.1"><csymbol cd="latexml" id="S4.E4.m1.5.5.1.1.2.1.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.2.1.1.1.1">conditional</csymbol><ci id="S4.E4.m1.5.5.1.1.2.1.1.1.2.cmml" xref="S4.E4.m1.5.5.1.1.2.1.1.1.2">𝑦</ci><ci id="S4.E4.m1.5.5.1.1.2.1.1.1.3.cmml" xref="S4.E4.m1.5.5.1.1.2.1.1.1.3">𝑥</ci></apply><apply id="S4.E4.m1.5.5.1.1.3.2.2.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1"><exp id="S4.E4.m1.4.4.cmml" xref="S4.E4.m1.4.4"></exp><apply id="S4.E4.m1.5.5.1.1.3.2.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1"><times id="S4.E4.m1.5.5.1.1.3.2.1.1.1.1.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.1"></times><apply id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2"><divide id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.1.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2"></divide><cn id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.2.cmml" type="integer" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.2">1</cn><ci id="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.3.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.2.3">𝛽</ci></apply><ci id="S4.E4.m1.5.5.1.1.3.2.1.1.1.3.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.3">𝑟</ci><interval closure="open" id="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.1.cmml" xref="S4.E4.m1.5.5.1.1.3.2.1.1.1.4.2"><ci id="S4.E4.m1.2.2.cmml" xref="S4.E4.m1.2.2">𝑥</ci><ci id="S4.E4.m1.3.3.cmml" xref="S4.E4.m1.3.3">𝑦</ci></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E4.m1.5c">\pi_{r}(y\mid x)=\frac{1}{Z(x)}\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{%
\beta}r(x,y)\right),</annotation><annotation encoding="application/x-llamapun" id="S4.E4.m1.5d">italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) = divide start_ARG 1 end_ARG start_ARG italic_Z ( italic_x ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.p2.8">where <math alttext="Z(x)=\sum_{y}\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{\beta}r(x,y)\right)" class="ltx_Math" display="inline" id="S4.p2.2.m1.6"><semantics id="S4.p2.2.m1.6a"><mrow id="S4.p2.2.m1.6.6" xref="S4.p2.2.m1.6.6.cmml"><mrow id="S4.p2.2.m1.6.6.4" xref="S4.p2.2.m1.6.6.4.cmml"><mi id="S4.p2.2.m1.6.6.4.2" xref="S4.p2.2.m1.6.6.4.2.cmml">Z</mi><mo id="S4.p2.2.m1.6.6.4.1" xref="S4.p2.2.m1.6.6.4.1.cmml">⁢</mo><mrow id="S4.p2.2.m1.6.6.4.3.2" xref="S4.p2.2.m1.6.6.4.cmml"><mo id="S4.p2.2.m1.6.6.4.3.2.1" stretchy="false" xref="S4.p2.2.m1.6.6.4.cmml">(</mo><mi id="S4.p2.2.m1.1.1" xref="S4.p2.2.m1.1.1.cmml">x</mi><mo id="S4.p2.2.m1.6.6.4.3.2.2" stretchy="false" xref="S4.p2.2.m1.6.6.4.cmml">)</mo></mrow></mrow><mo id="S4.p2.2.m1.6.6.3" rspace="0.111em" xref="S4.p2.2.m1.6.6.3.cmml">=</mo><mrow id="S4.p2.2.m1.6.6.2" xref="S4.p2.2.m1.6.6.2.cmml"><msub id="S4.p2.2.m1.6.6.2.3" xref="S4.p2.2.m1.6.6.2.3.cmml"><mo id="S4.p2.2.m1.6.6.2.3.2" xref="S4.p2.2.m1.6.6.2.3.2.cmml">∑</mo><mi id="S4.p2.2.m1.6.6.2.3.3" xref="S4.p2.2.m1.6.6.2.3.3.cmml">y</mi></msub><mrow id="S4.p2.2.m1.6.6.2.2" xref="S4.p2.2.m1.6.6.2.2.cmml"><msub id="S4.p2.2.m1.6.6.2.2.4" xref="S4.p2.2.m1.6.6.2.2.4.cmml"><mi id="S4.p2.2.m1.6.6.2.2.4.2" xref="S4.p2.2.m1.6.6.2.2.4.2.cmml">π</mi><mtext id="S4.p2.2.m1.6.6.2.2.4.3" xref="S4.p2.2.m1.6.6.2.2.4.3a.cmml">ref</mtext></msub><mo id="S4.p2.2.m1.6.6.2.2.3" xref="S4.p2.2.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="S4.p2.2.m1.5.5.1.1.1.1" xref="S4.p2.2.m1.5.5.1.1.1.1.1.cmml"><mo id="S4.p2.2.m1.5.5.1.1.1.1.2" stretchy="false" xref="S4.p2.2.m1.5.5.1.1.1.1.1.cmml">(</mo><mrow id="S4.p2.2.m1.5.5.1.1.1.1.1" xref="S4.p2.2.m1.5.5.1.1.1.1.1.cmml"><mi id="S4.p2.2.m1.5.5.1.1.1.1.1.2" xref="S4.p2.2.m1.5.5.1.1.1.1.1.2.cmml">y</mi><mo id="S4.p2.2.m1.5.5.1.1.1.1.1.1" xref="S4.p2.2.m1.5.5.1.1.1.1.1.1.cmml">∣</mo><mi id="S4.p2.2.m1.5.5.1.1.1.1.1.3" xref="S4.p2.2.m1.5.5.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.p2.2.m1.5.5.1.1.1.1.3" stretchy="false" xref="S4.p2.2.m1.5.5.1.1.1.1.1.cmml">)</mo></mrow><mo id="S4.p2.2.m1.6.6.2.2.3a" lspace="0.167em" xref="S4.p2.2.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="S4.p2.2.m1.6.6.2.2.2.1" xref="S4.p2.2.m1.6.6.2.2.2.2.cmml"><mi id="S4.p2.2.m1.4.4" xref="S4.p2.2.m1.4.4.cmml">exp</mi><mo id="S4.p2.2.m1.6.6.2.2.2.1a" xref="S4.p2.2.m1.6.6.2.2.2.2.cmml">⁡</mo><mrow id="S4.p2.2.m1.6.6.2.2.2.1.1" xref="S4.p2.2.m1.6.6.2.2.2.2.cmml"><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.2" xref="S4.p2.2.m1.6.6.2.2.2.2.cmml">(</mo><mrow id="S4.p2.2.m1.6.6.2.2.2.1.1.1" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.cmml"><mfrac id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.cmml"><mn id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.2" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.2.cmml">1</mn><mi id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.3" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.1.1" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.1.cmml">⁢</mo><mi id="S4.p2.2.m1.6.6.2.2.2.1.1.1.3" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.3.cmml">r</mi><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.1.1a" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.2" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.1.cmml"><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.2.1" stretchy="false" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.1.cmml">(</mo><mi id="S4.p2.2.m1.2.2" xref="S4.p2.2.m1.2.2.cmml">x</mi><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.2.2" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.1.cmml">,</mo><mi id="S4.p2.2.m1.3.3" xref="S4.p2.2.m1.3.3.cmml">y</mi><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.2.3" stretchy="false" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="S4.p2.2.m1.6.6.2.2.2.1.1.3" xref="S4.p2.2.m1.6.6.2.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.2.m1.6b"><apply id="S4.p2.2.m1.6.6.cmml" xref="S4.p2.2.m1.6.6"><eq id="S4.p2.2.m1.6.6.3.cmml" xref="S4.p2.2.m1.6.6.3"></eq><apply id="S4.p2.2.m1.6.6.4.cmml" xref="S4.p2.2.m1.6.6.4"><times id="S4.p2.2.m1.6.6.4.1.cmml" xref="S4.p2.2.m1.6.6.4.1"></times><ci id="S4.p2.2.m1.6.6.4.2.cmml" xref="S4.p2.2.m1.6.6.4.2">𝑍</ci><ci id="S4.p2.2.m1.1.1.cmml" xref="S4.p2.2.m1.1.1">𝑥</ci></apply><apply id="S4.p2.2.m1.6.6.2.cmml" xref="S4.p2.2.m1.6.6.2"><apply id="S4.p2.2.m1.6.6.2.3.cmml" xref="S4.p2.2.m1.6.6.2.3"><csymbol cd="ambiguous" id="S4.p2.2.m1.6.6.2.3.1.cmml" xref="S4.p2.2.m1.6.6.2.3">subscript</csymbol><sum id="S4.p2.2.m1.6.6.2.3.2.cmml" xref="S4.p2.2.m1.6.6.2.3.2"></sum><ci id="S4.p2.2.m1.6.6.2.3.3.cmml" xref="S4.p2.2.m1.6.6.2.3.3">𝑦</ci></apply><apply id="S4.p2.2.m1.6.6.2.2.cmml" xref="S4.p2.2.m1.6.6.2.2"><times id="S4.p2.2.m1.6.6.2.2.3.cmml" xref="S4.p2.2.m1.6.6.2.2.3"></times><apply id="S4.p2.2.m1.6.6.2.2.4.cmml" xref="S4.p2.2.m1.6.6.2.2.4"><csymbol cd="ambiguous" id="S4.p2.2.m1.6.6.2.2.4.1.cmml" xref="S4.p2.2.m1.6.6.2.2.4">subscript</csymbol><ci id="S4.p2.2.m1.6.6.2.2.4.2.cmml" xref="S4.p2.2.m1.6.6.2.2.4.2">𝜋</ci><ci id="S4.p2.2.m1.6.6.2.2.4.3a.cmml" xref="S4.p2.2.m1.6.6.2.2.4.3"><mtext id="S4.p2.2.m1.6.6.2.2.4.3.cmml" mathsize="70%" xref="S4.p2.2.m1.6.6.2.2.4.3">ref</mtext></ci></apply><apply id="S4.p2.2.m1.5.5.1.1.1.1.1.cmml" xref="S4.p2.2.m1.5.5.1.1.1.1"><csymbol cd="latexml" id="S4.p2.2.m1.5.5.1.1.1.1.1.1.cmml" xref="S4.p2.2.m1.5.5.1.1.1.1.1.1">conditional</csymbol><ci id="S4.p2.2.m1.5.5.1.1.1.1.1.2.cmml" xref="S4.p2.2.m1.5.5.1.1.1.1.1.2">𝑦</ci><ci id="S4.p2.2.m1.5.5.1.1.1.1.1.3.cmml" xref="S4.p2.2.m1.5.5.1.1.1.1.1.3">𝑥</ci></apply><apply id="S4.p2.2.m1.6.6.2.2.2.2.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1"><exp id="S4.p2.2.m1.4.4.cmml" xref="S4.p2.2.m1.4.4"></exp><apply id="S4.p2.2.m1.6.6.2.2.2.1.1.1.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1"><times id="S4.p2.2.m1.6.6.2.2.2.1.1.1.1.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.1"></times><apply id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2"><divide id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.1.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2"></divide><cn id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.2.cmml" type="integer" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.2">1</cn><ci id="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.3.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="S4.p2.2.m1.6.6.2.2.2.1.1.1.3.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.1.cmml" xref="S4.p2.2.m1.6.6.2.2.2.1.1.1.4.2"><ci id="S4.p2.2.m1.2.2.cmml" xref="S4.p2.2.m1.2.2">𝑥</ci><ci id="S4.p2.2.m1.3.3.cmml" xref="S4.p2.2.m1.3.3">𝑦</ci></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.2.m1.6c">Z(x)=\sum_{y}\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{\beta}r(x,y)\right)</annotation><annotation encoding="application/x-llamapun" id="S4.p2.2.m1.6d">italic_Z ( italic_x ) = ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) )</annotation></semantics></math> is the partition function. See Appendix <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS1" title="A.1 Deriving the Optimum of the KL-Constrained Reward Maximization Objective ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.1</span></a> for a complete derivation. Even if we use the MLE estimate <math alttext="r_{\phi}" class="ltx_Math" display="inline" id="S4.p2.3.m2.1"><semantics id="S4.p2.3.m2.1a"><msub id="S4.p2.3.m2.1.1" xref="S4.p2.3.m2.1.1.cmml"><mi id="S4.p2.3.m2.1.1.2" xref="S4.p2.3.m2.1.1.2.cmml">r</mi><mi id="S4.p2.3.m2.1.1.3" xref="S4.p2.3.m2.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p2.3.m2.1b"><apply id="S4.p2.3.m2.1.1.cmml" xref="S4.p2.3.m2.1.1"><csymbol cd="ambiguous" id="S4.p2.3.m2.1.1.1.cmml" xref="S4.p2.3.m2.1.1">subscript</csymbol><ci id="S4.p2.3.m2.1.1.2.cmml" xref="S4.p2.3.m2.1.1.2">𝑟</ci><ci id="S4.p2.3.m2.1.1.3.cmml" xref="S4.p2.3.m2.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.3.m2.1c">r_{\phi}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.3.m2.1d">italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT</annotation></semantics></math> of the ground-truth reward function <math alttext="r^{*}" class="ltx_Math" display="inline" id="S4.p2.4.m3.1"><semantics id="S4.p2.4.m3.1a"><msup id="S4.p2.4.m3.1.1" xref="S4.p2.4.m3.1.1.cmml"><mi id="S4.p2.4.m3.1.1.2" xref="S4.p2.4.m3.1.1.2.cmml">r</mi><mo id="S4.p2.4.m3.1.1.3" xref="S4.p2.4.m3.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S4.p2.4.m3.1b"><apply id="S4.p2.4.m3.1.1.cmml" xref="S4.p2.4.m3.1.1"><csymbol cd="ambiguous" id="S4.p2.4.m3.1.1.1.cmml" xref="S4.p2.4.m3.1.1">superscript</csymbol><ci id="S4.p2.4.m3.1.1.2.cmml" xref="S4.p2.4.m3.1.1.2">𝑟</ci><times id="S4.p2.4.m3.1.1.3.cmml" xref="S4.p2.4.m3.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.4.m3.1c">r^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.4.m3.1d">italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math>, it is still expensive to estimate the partition function <math alttext="Z(x)" class="ltx_Math" display="inline" id="S4.p2.5.m4.1"><semantics id="S4.p2.5.m4.1a"><mrow id="S4.p2.5.m4.1.2" xref="S4.p2.5.m4.1.2.cmml"><mi id="S4.p2.5.m4.1.2.2" xref="S4.p2.5.m4.1.2.2.cmml">Z</mi><mo id="S4.p2.5.m4.1.2.1" xref="S4.p2.5.m4.1.2.1.cmml">⁢</mo><mrow id="S4.p2.5.m4.1.2.3.2" xref="S4.p2.5.m4.1.2.cmml"><mo id="S4.p2.5.m4.1.2.3.2.1" stretchy="false" xref="S4.p2.5.m4.1.2.cmml">(</mo><mi id="S4.p2.5.m4.1.1" xref="S4.p2.5.m4.1.1.cmml">x</mi><mo id="S4.p2.5.m4.1.2.3.2.2" stretchy="false" xref="S4.p2.5.m4.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.5.m4.1b"><apply id="S4.p2.5.m4.1.2.cmml" xref="S4.p2.5.m4.1.2"><times id="S4.p2.5.m4.1.2.1.cmml" xref="S4.p2.5.m4.1.2.1"></times><ci id="S4.p2.5.m4.1.2.2.cmml" xref="S4.p2.5.m4.1.2.2">𝑍</ci><ci id="S4.p2.5.m4.1.1.cmml" xref="S4.p2.5.m4.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.5.m4.1c">Z(x)</annotation><annotation encoding="application/x-llamapun" id="S4.p2.5.m4.1d">italic_Z ( italic_x )</annotation></semantics></math> <cite class="ltx_cite ltx_citemacro_citep">(Korbak et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib17" title="">2022</a>; Go et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib15" title="">2023</a>)</cite>, which makes this representation hard to utilize in practice. However, we can rearrange Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a> to express the reward function in terms of its corresponding optimal policy <math alttext="\pi_{r}" class="ltx_Math" display="inline" id="S4.p2.6.m5.1"><semantics id="S4.p2.6.m5.1a"><msub id="S4.p2.6.m5.1.1" xref="S4.p2.6.m5.1.1.cmml"><mi id="S4.p2.6.m5.1.1.2" xref="S4.p2.6.m5.1.1.2.cmml">π</mi><mi id="S4.p2.6.m5.1.1.3" xref="S4.p2.6.m5.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p2.6.m5.1b"><apply id="S4.p2.6.m5.1.1.cmml" xref="S4.p2.6.m5.1.1"><csymbol cd="ambiguous" id="S4.p2.6.m5.1.1.1.cmml" xref="S4.p2.6.m5.1.1">subscript</csymbol><ci id="S4.p2.6.m5.1.1.2.cmml" xref="S4.p2.6.m5.1.1.2">𝜋</ci><ci id="S4.p2.6.m5.1.1.3.cmml" xref="S4.p2.6.m5.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.6.m5.1c">\pi_{r}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.6.m5.1d">italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math>, the reference policy <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S4.p2.7.m6.1"><semantics id="S4.p2.7.m6.1a"><msub id="S4.p2.7.m6.1.1" xref="S4.p2.7.m6.1.1.cmml"><mi id="S4.p2.7.m6.1.1.2" xref="S4.p2.7.m6.1.1.2.cmml">π</mi><mtext id="S4.p2.7.m6.1.1.3" xref="S4.p2.7.m6.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p2.7.m6.1b"><apply id="S4.p2.7.m6.1.1.cmml" xref="S4.p2.7.m6.1.1"><csymbol cd="ambiguous" id="S4.p2.7.m6.1.1.1.cmml" xref="S4.p2.7.m6.1.1">subscript</csymbol><ci id="S4.p2.7.m6.1.1.2.cmml" xref="S4.p2.7.m6.1.1.2">𝜋</ci><ci id="S4.p2.7.m6.1.1.3a.cmml" xref="S4.p2.7.m6.1.1.3"><mtext id="S4.p2.7.m6.1.1.3.cmml" mathsize="70%" xref="S4.p2.7.m6.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.7.m6.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.7.m6.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math>, and the unknown partition function <math alttext="Z(\cdot)" class="ltx_Math" display="inline" id="S4.p2.8.m7.1"><semantics id="S4.p2.8.m7.1a"><mrow id="S4.p2.8.m7.1.2" xref="S4.p2.8.m7.1.2.cmml"><mi id="S4.p2.8.m7.1.2.2" xref="S4.p2.8.m7.1.2.2.cmml">Z</mi><mo id="S4.p2.8.m7.1.2.1" xref="S4.p2.8.m7.1.2.1.cmml">⁢</mo><mrow id="S4.p2.8.m7.1.2.3.2" xref="S4.p2.8.m7.1.2.cmml"><mo id="S4.p2.8.m7.1.2.3.2.1" stretchy="false" xref="S4.p2.8.m7.1.2.cmml">(</mo><mo id="S4.p2.8.m7.1.1" lspace="0em" rspace="0em" xref="S4.p2.8.m7.1.1.cmml">⋅</mo><mo id="S4.p2.8.m7.1.2.3.2.2" stretchy="false" xref="S4.p2.8.m7.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.8.m7.1b"><apply id="S4.p2.8.m7.1.2.cmml" xref="S4.p2.8.m7.1.2"><times id="S4.p2.8.m7.1.2.1.cmml" xref="S4.p2.8.m7.1.2.1"></times><ci id="S4.p2.8.m7.1.2.2.cmml" xref="S4.p2.8.m7.1.2.2">𝑍</ci><ci id="S4.p2.8.m7.1.1.cmml" xref="S4.p2.8.m7.1.1">⋅</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.8.m7.1c">Z(\cdot)</annotation><annotation encoding="application/x-llamapun" id="S4.p2.8.m7.1d">italic_Z ( ⋅ )</annotation></semantics></math>. Specifically, we first take the logarithm of both sides of Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a> and then with some algebra we obtain:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S4.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="r(x,y)=\beta\log\frac{\pi_{r}(y\mid x)}{\pi_{\text{ref}}(y\mid x)}+\beta\log Z%
(x)." class="ltx_Math" display="block" id="S4.E5.m1.6"><semantics id="S4.E5.m1.6a"><mrow id="S4.E5.m1.6.6.1" xref="S4.E5.m1.6.6.1.1.cmml"><mrow id="S4.E5.m1.6.6.1.1" xref="S4.E5.m1.6.6.1.1.cmml"><mrow id="S4.E5.m1.6.6.1.1.2" xref="S4.E5.m1.6.6.1.1.2.cmml"><mi id="S4.E5.m1.6.6.1.1.2.2" xref="S4.E5.m1.6.6.1.1.2.2.cmml">r</mi><mo id="S4.E5.m1.6.6.1.1.2.1" xref="S4.E5.m1.6.6.1.1.2.1.cmml">⁢</mo><mrow id="S4.E5.m1.6.6.1.1.2.3.2" xref="S4.E5.m1.6.6.1.1.2.3.1.cmml"><mo id="S4.E5.m1.6.6.1.1.2.3.2.1" stretchy="false" xref="S4.E5.m1.6.6.1.1.2.3.1.cmml">(</mo><mi id="S4.E5.m1.3.3" xref="S4.E5.m1.3.3.cmml">x</mi><mo id="S4.E5.m1.6.6.1.1.2.3.2.2" xref="S4.E5.m1.6.6.1.1.2.3.1.cmml">,</mo><mi id="S4.E5.m1.4.4" xref="S4.E5.m1.4.4.cmml">y</mi><mo id="S4.E5.m1.6.6.1.1.2.3.2.3" stretchy="false" xref="S4.E5.m1.6.6.1.1.2.3.1.cmml">)</mo></mrow></mrow><mo id="S4.E5.m1.6.6.1.1.1" xref="S4.E5.m1.6.6.1.1.1.cmml">=</mo><mrow id="S4.E5.m1.6.6.1.1.3" xref="S4.E5.m1.6.6.1.1.3.cmml"><mrow id="S4.E5.m1.6.6.1.1.3.2" xref="S4.E5.m1.6.6.1.1.3.2.cmml"><mi id="S4.E5.m1.6.6.1.1.3.2.2" xref="S4.E5.m1.6.6.1.1.3.2.2.cmml">β</mi><mo id="S4.E5.m1.6.6.1.1.3.2.1" lspace="0.167em" xref="S4.E5.m1.6.6.1.1.3.2.1.cmml">⁢</mo><mrow id="S4.E5.m1.6.6.1.1.3.2.3" xref="S4.E5.m1.6.6.1.1.3.2.3.cmml"><mi id="S4.E5.m1.6.6.1.1.3.2.3.1" xref="S4.E5.m1.6.6.1.1.3.2.3.1.cmml">log</mi><mo id="S4.E5.m1.6.6.1.1.3.2.3a" lspace="0.167em" xref="S4.E5.m1.6.6.1.1.3.2.3.cmml">⁡</mo><mfrac id="S4.E5.m1.2.2" xref="S4.E5.m1.2.2.cmml"><mrow id="S4.E5.m1.1.1.1" xref="S4.E5.m1.1.1.1.cmml"><msub id="S4.E5.m1.1.1.1.3" xref="S4.E5.m1.1.1.1.3.cmml"><mi id="S4.E5.m1.1.1.1.3.2" xref="S4.E5.m1.1.1.1.3.2.cmml">π</mi><mi id="S4.E5.m1.1.1.1.3.3" xref="S4.E5.m1.1.1.1.3.3.cmml">r</mi></msub><mo id="S4.E5.m1.1.1.1.2" xref="S4.E5.m1.1.1.1.2.cmml">⁢</mo><mrow id="S4.E5.m1.1.1.1.1.1" xref="S4.E5.m1.1.1.1.1.1.1.cmml"><mo id="S4.E5.m1.1.1.1.1.1.2" stretchy="false" xref="S4.E5.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E5.m1.1.1.1.1.1.1" xref="S4.E5.m1.1.1.1.1.1.1.cmml"><mi id="S4.E5.m1.1.1.1.1.1.1.2" xref="S4.E5.m1.1.1.1.1.1.1.2.cmml">y</mi><mo id="S4.E5.m1.1.1.1.1.1.1.1" xref="S4.E5.m1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S4.E5.m1.1.1.1.1.1.1.3" xref="S4.E5.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E5.m1.1.1.1.1.1.3" stretchy="false" xref="S4.E5.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S4.E5.m1.2.2.2" xref="S4.E5.m1.2.2.2.cmml"><msub id="S4.E5.m1.2.2.2.3" xref="S4.E5.m1.2.2.2.3.cmml"><mi id="S4.E5.m1.2.2.2.3.2" xref="S4.E5.m1.2.2.2.3.2.cmml">π</mi><mtext id="S4.E5.m1.2.2.2.3.3" xref="S4.E5.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="S4.E5.m1.2.2.2.2" xref="S4.E5.m1.2.2.2.2.cmml">⁢</mo><mrow id="S4.E5.m1.2.2.2.1.1" xref="S4.E5.m1.2.2.2.1.1.1.cmml"><mo id="S4.E5.m1.2.2.2.1.1.2" stretchy="false" xref="S4.E5.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="S4.E5.m1.2.2.2.1.1.1" xref="S4.E5.m1.2.2.2.1.1.1.cmml"><mi id="S4.E5.m1.2.2.2.1.1.1.2" xref="S4.E5.m1.2.2.2.1.1.1.2.cmml">y</mi><mo id="S4.E5.m1.2.2.2.1.1.1.1" xref="S4.E5.m1.2.2.2.1.1.1.1.cmml">∣</mo><mi id="S4.E5.m1.2.2.2.1.1.1.3" xref="S4.E5.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E5.m1.2.2.2.1.1.3" stretchy="false" xref="S4.E5.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="S4.E5.m1.6.6.1.1.3.1" xref="S4.E5.m1.6.6.1.1.3.1.cmml">+</mo><mrow id="S4.E5.m1.6.6.1.1.3.3" xref="S4.E5.m1.6.6.1.1.3.3.cmml"><mi id="S4.E5.m1.6.6.1.1.3.3.2" xref="S4.E5.m1.6.6.1.1.3.3.2.cmml">β</mi><mo id="S4.E5.m1.6.6.1.1.3.3.1" lspace="0.167em" xref="S4.E5.m1.6.6.1.1.3.3.1.cmml">⁢</mo><mrow id="S4.E5.m1.6.6.1.1.3.3.3" xref="S4.E5.m1.6.6.1.1.3.3.3.cmml"><mi id="S4.E5.m1.6.6.1.1.3.3.3.1" xref="S4.E5.m1.6.6.1.1.3.3.3.1.cmml">log</mi><mo id="S4.E5.m1.6.6.1.1.3.3.3a" lspace="0.167em" xref="S4.E5.m1.6.6.1.1.3.3.3.cmml">⁡</mo><mi id="S4.E5.m1.6.6.1.1.3.3.3.2" xref="S4.E5.m1.6.6.1.1.3.3.3.2.cmml">Z</mi></mrow><mo id="S4.E5.m1.6.6.1.1.3.3.1a" xref="S4.E5.m1.6.6.1.1.3.3.1.cmml">⁢</mo><mrow id="S4.E5.m1.6.6.1.1.3.3.4.2" xref="S4.E5.m1.6.6.1.1.3.3.cmml"><mo id="S4.E5.m1.6.6.1.1.3.3.4.2.1" stretchy="false" xref="S4.E5.m1.6.6.1.1.3.3.cmml">(</mo><mi id="S4.E5.m1.5.5" xref="S4.E5.m1.5.5.cmml">x</mi><mo id="S4.E5.m1.6.6.1.1.3.3.4.2.2" stretchy="false" xref="S4.E5.m1.6.6.1.1.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S4.E5.m1.6.6.1.2" lspace="0em" xref="S4.E5.m1.6.6.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E5.m1.6b"><apply id="S4.E5.m1.6.6.1.1.cmml" xref="S4.E5.m1.6.6.1"><eq id="S4.E5.m1.6.6.1.1.1.cmml" xref="S4.E5.m1.6.6.1.1.1"></eq><apply id="S4.E5.m1.6.6.1.1.2.cmml" xref="S4.E5.m1.6.6.1.1.2"><times id="S4.E5.m1.6.6.1.1.2.1.cmml" xref="S4.E5.m1.6.6.1.1.2.1"></times><ci id="S4.E5.m1.6.6.1.1.2.2.cmml" xref="S4.E5.m1.6.6.1.1.2.2">𝑟</ci><interval closure="open" id="S4.E5.m1.6.6.1.1.2.3.1.cmml" xref="S4.E5.m1.6.6.1.1.2.3.2"><ci id="S4.E5.m1.3.3.cmml" xref="S4.E5.m1.3.3">𝑥</ci><ci id="S4.E5.m1.4.4.cmml" xref="S4.E5.m1.4.4">𝑦</ci></interval></apply><apply id="S4.E5.m1.6.6.1.1.3.cmml" xref="S4.E5.m1.6.6.1.1.3"><plus id="S4.E5.m1.6.6.1.1.3.1.cmml" xref="S4.E5.m1.6.6.1.1.3.1"></plus><apply id="S4.E5.m1.6.6.1.1.3.2.cmml" xref="S4.E5.m1.6.6.1.1.3.2"><times id="S4.E5.m1.6.6.1.1.3.2.1.cmml" xref="S4.E5.m1.6.6.1.1.3.2.1"></times><ci id="S4.E5.m1.6.6.1.1.3.2.2.cmml" xref="S4.E5.m1.6.6.1.1.3.2.2">𝛽</ci><apply id="S4.E5.m1.6.6.1.1.3.2.3.cmml" xref="S4.E5.m1.6.6.1.1.3.2.3"><log id="S4.E5.m1.6.6.1.1.3.2.3.1.cmml" xref="S4.E5.m1.6.6.1.1.3.2.3.1"></log><apply id="S4.E5.m1.2.2.cmml" xref="S4.E5.m1.2.2"><divide id="S4.E5.m1.2.2.3.cmml" xref="S4.E5.m1.2.2"></divide><apply id="S4.E5.m1.1.1.1.cmml" xref="S4.E5.m1.1.1.1"><times id="S4.E5.m1.1.1.1.2.cmml" xref="S4.E5.m1.1.1.1.2"></times><apply id="S4.E5.m1.1.1.1.3.cmml" xref="S4.E5.m1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E5.m1.1.1.1.3.1.cmml" xref="S4.E5.m1.1.1.1.3">subscript</csymbol><ci id="S4.E5.m1.1.1.1.3.2.cmml" xref="S4.E5.m1.1.1.1.3.2">𝜋</ci><ci id="S4.E5.m1.1.1.1.3.3.cmml" xref="S4.E5.m1.1.1.1.3.3">𝑟</ci></apply><apply id="S4.E5.m1.1.1.1.1.1.1.cmml" xref="S4.E5.m1.1.1.1.1.1"><csymbol cd="latexml" id="S4.E5.m1.1.1.1.1.1.1.1.cmml" xref="S4.E5.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S4.E5.m1.1.1.1.1.1.1.2.cmml" xref="S4.E5.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="S4.E5.m1.1.1.1.1.1.1.3.cmml" xref="S4.E5.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.E5.m1.2.2.2.cmml" xref="S4.E5.m1.2.2.2"><times id="S4.E5.m1.2.2.2.2.cmml" xref="S4.E5.m1.2.2.2.2"></times><apply id="S4.E5.m1.2.2.2.3.cmml" xref="S4.E5.m1.2.2.2.3"><csymbol cd="ambiguous" id="S4.E5.m1.2.2.2.3.1.cmml" xref="S4.E5.m1.2.2.2.3">subscript</csymbol><ci id="S4.E5.m1.2.2.2.3.2.cmml" xref="S4.E5.m1.2.2.2.3.2">𝜋</ci><ci id="S4.E5.m1.2.2.2.3.3a.cmml" xref="S4.E5.m1.2.2.2.3.3"><mtext id="S4.E5.m1.2.2.2.3.3.cmml" mathsize="70%" xref="S4.E5.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="S4.E5.m1.2.2.2.1.1.1.cmml" xref="S4.E5.m1.2.2.2.1.1"><csymbol cd="latexml" id="S4.E5.m1.2.2.2.1.1.1.1.cmml" xref="S4.E5.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="S4.E5.m1.2.2.2.1.1.1.2.cmml" xref="S4.E5.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="S4.E5.m1.2.2.2.1.1.1.3.cmml" xref="S4.E5.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="S4.E5.m1.6.6.1.1.3.3.cmml" xref="S4.E5.m1.6.6.1.1.3.3"><times id="S4.E5.m1.6.6.1.1.3.3.1.cmml" xref="S4.E5.m1.6.6.1.1.3.3.1"></times><ci id="S4.E5.m1.6.6.1.1.3.3.2.cmml" xref="S4.E5.m1.6.6.1.1.3.3.2">𝛽</ci><apply id="S4.E5.m1.6.6.1.1.3.3.3.cmml" xref="S4.E5.m1.6.6.1.1.3.3.3"><log id="S4.E5.m1.6.6.1.1.3.3.3.1.cmml" xref="S4.E5.m1.6.6.1.1.3.3.3.1"></log><ci id="S4.E5.m1.6.6.1.1.3.3.3.2.cmml" xref="S4.E5.m1.6.6.1.1.3.3.3.2">𝑍</ci></apply><ci id="S4.E5.m1.5.5.cmml" xref="S4.E5.m1.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E5.m1.6c">r(x,y)=\beta\log\frac{\pi_{r}(y\mid x)}{\pi_{\text{ref}}(y\mid x)}+\beta\log Z%
(x).</annotation><annotation encoding="application/x-llamapun" id="S4.E5.m1.6d">italic_r ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG + italic_β roman_log italic_Z ( italic_x ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.p2.15">We can apply this reparameterization to the ground-truth reward <math alttext="r^{*}" class="ltx_Math" display="inline" id="S4.p2.9.m1.1"><semantics id="S4.p2.9.m1.1a"><msup id="S4.p2.9.m1.1.1" xref="S4.p2.9.m1.1.1.cmml"><mi id="S4.p2.9.m1.1.1.2" xref="S4.p2.9.m1.1.1.2.cmml">r</mi><mo id="S4.p2.9.m1.1.1.3" xref="S4.p2.9.m1.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S4.p2.9.m1.1b"><apply id="S4.p2.9.m1.1.1.cmml" xref="S4.p2.9.m1.1.1"><csymbol cd="ambiguous" id="S4.p2.9.m1.1.1.1.cmml" xref="S4.p2.9.m1.1.1">superscript</csymbol><ci id="S4.p2.9.m1.1.1.2.cmml" xref="S4.p2.9.m1.1.1.2">𝑟</ci><times id="S4.p2.9.m1.1.1.3.cmml" xref="S4.p2.9.m1.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.9.m1.1c">r^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.9.m1.1d">italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> and corresponding optimal model <math alttext="\pi^{*}" class="ltx_Math" display="inline" id="S4.p2.10.m2.1"><semantics id="S4.p2.10.m2.1a"><msup id="S4.p2.10.m2.1.1" xref="S4.p2.10.m2.1.1.cmml"><mi id="S4.p2.10.m2.1.1.2" xref="S4.p2.10.m2.1.1.2.cmml">π</mi><mo id="S4.p2.10.m2.1.1.3" xref="S4.p2.10.m2.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S4.p2.10.m2.1b"><apply id="S4.p2.10.m2.1.1.cmml" xref="S4.p2.10.m2.1.1"><csymbol cd="ambiguous" id="S4.p2.10.m2.1.1.1.cmml" xref="S4.p2.10.m2.1.1">superscript</csymbol><ci id="S4.p2.10.m2.1.1.2.cmml" xref="S4.p2.10.m2.1.1.2">𝜋</ci><times id="S4.p2.10.m2.1.1.3.cmml" xref="S4.p2.10.m2.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.10.m2.1c">\pi^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.10.m2.1d">italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math>. Fortunately, the Bradley-Terry model depends only on the difference of rewards between two completions, i.e., <math alttext="{p^{*}(y_{1}\succ y_{2}\mid x)=\sigma(r^{*}(x,y_{1})-r^{*}(x,y_{2}))}" class="ltx_Math" display="inline" id="S4.p2.11.m3.4"><semantics id="S4.p2.11.m3.4a"><mrow id="S4.p2.11.m3.4.4" xref="S4.p2.11.m3.4.4.cmml"><mrow id="S4.p2.11.m3.3.3.1" xref="S4.p2.11.m3.3.3.1.cmml"><msup id="S4.p2.11.m3.3.3.1.3" xref="S4.p2.11.m3.3.3.1.3.cmml"><mi id="S4.p2.11.m3.3.3.1.3.2" xref="S4.p2.11.m3.3.3.1.3.2.cmml">p</mi><mo id="S4.p2.11.m3.3.3.1.3.3" xref="S4.p2.11.m3.3.3.1.3.3.cmml">*</mo></msup><mo id="S4.p2.11.m3.3.3.1.2" xref="S4.p2.11.m3.3.3.1.2.cmml">⁢</mo><mrow id="S4.p2.11.m3.3.3.1.1.1" xref="S4.p2.11.m3.3.3.1.1.1.1.cmml"><mo id="S4.p2.11.m3.3.3.1.1.1.2" stretchy="false" xref="S4.p2.11.m3.3.3.1.1.1.1.cmml">(</mo><mrow id="S4.p2.11.m3.3.3.1.1.1.1" xref="S4.p2.11.m3.3.3.1.1.1.1.cmml"><msub id="S4.p2.11.m3.3.3.1.1.1.1.2" xref="S4.p2.11.m3.3.3.1.1.1.1.2.cmml"><mi id="S4.p2.11.m3.3.3.1.1.1.1.2.2" xref="S4.p2.11.m3.3.3.1.1.1.1.2.2.cmml">y</mi><mn id="S4.p2.11.m3.3.3.1.1.1.1.2.3" xref="S4.p2.11.m3.3.3.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S4.p2.11.m3.3.3.1.1.1.1.1" xref="S4.p2.11.m3.3.3.1.1.1.1.1.cmml">≻</mo><mrow id="S4.p2.11.m3.3.3.1.1.1.1.3" xref="S4.p2.11.m3.3.3.1.1.1.1.3.cmml"><msub id="S4.p2.11.m3.3.3.1.1.1.1.3.2" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2.cmml"><mi id="S4.p2.11.m3.3.3.1.1.1.1.3.2.2" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2.2.cmml">y</mi><mn id="S4.p2.11.m3.3.3.1.1.1.1.3.2.3" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2.3.cmml">2</mn></msub><mo id="S4.p2.11.m3.3.3.1.1.1.1.3.1" xref="S4.p2.11.m3.3.3.1.1.1.1.3.1.cmml">∣</mo><mi id="S4.p2.11.m3.3.3.1.1.1.1.3.3" xref="S4.p2.11.m3.3.3.1.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="S4.p2.11.m3.3.3.1.1.1.3" stretchy="false" xref="S4.p2.11.m3.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.p2.11.m3.4.4.3" xref="S4.p2.11.m3.4.4.3.cmml">=</mo><mrow id="S4.p2.11.m3.4.4.2" xref="S4.p2.11.m3.4.4.2.cmml"><mi id="S4.p2.11.m3.4.4.2.3" xref="S4.p2.11.m3.4.4.2.3.cmml">σ</mi><mo id="S4.p2.11.m3.4.4.2.2" xref="S4.p2.11.m3.4.4.2.2.cmml">⁢</mo><mrow id="S4.p2.11.m3.4.4.2.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.cmml"><mo id="S4.p2.11.m3.4.4.2.1.1.2" stretchy="false" xref="S4.p2.11.m3.4.4.2.1.1.1.cmml">(</mo><mrow id="S4.p2.11.m3.4.4.2.1.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.cmml"><mrow id="S4.p2.11.m3.4.4.2.1.1.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.1.cmml"><msup id="S4.p2.11.m3.4.4.2.1.1.1.1.3" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3.cmml"><mi id="S4.p2.11.m3.4.4.2.1.1.1.1.3.2" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3.2.cmml">r</mi><mo id="S4.p2.11.m3.4.4.2.1.1.1.1.3.3" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3.3.cmml">*</mo></msup><mo id="S4.p2.11.m3.4.4.2.1.1.1.1.2" xref="S4.p2.11.m3.4.4.2.1.1.1.1.2.cmml">⁢</mo><mrow id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.2.cmml"><mo id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.2" stretchy="false" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.2.cmml">(</mo><mi id="S4.p2.11.m3.1.1" xref="S4.p2.11.m3.1.1.cmml">x</mi><mo id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.3" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.2.cmml">,</mo><msub id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.cmml"><mi id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.2" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.3" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.4" stretchy="false" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.p2.11.m3.4.4.2.1.1.1.3" xref="S4.p2.11.m3.4.4.2.1.1.1.3.cmml">−</mo><mrow id="S4.p2.11.m3.4.4.2.1.1.1.2" xref="S4.p2.11.m3.4.4.2.1.1.1.2.cmml"><msup id="S4.p2.11.m3.4.4.2.1.1.1.2.3" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3.cmml"><mi id="S4.p2.11.m3.4.4.2.1.1.1.2.3.2" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3.2.cmml">r</mi><mo id="S4.p2.11.m3.4.4.2.1.1.1.2.3.3" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3.3.cmml">*</mo></msup><mo id="S4.p2.11.m3.4.4.2.1.1.1.2.2" xref="S4.p2.11.m3.4.4.2.1.1.1.2.2.cmml">⁢</mo><mrow id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.2.cmml"><mo id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.2" stretchy="false" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.2.cmml">(</mo><mi id="S4.p2.11.m3.2.2" xref="S4.p2.11.m3.2.2.cmml">x</mi><mo id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.3" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.2.cmml">,</mo><msub id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.cmml"><mi id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.2" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.2.cmml">y</mi><mn id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.3" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.3.cmml">2</mn></msub><mo id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.4" stretchy="false" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S4.p2.11.m3.4.4.2.1.1.3" stretchy="false" xref="S4.p2.11.m3.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.11.m3.4b"><apply id="S4.p2.11.m3.4.4.cmml" xref="S4.p2.11.m3.4.4"><eq id="S4.p2.11.m3.4.4.3.cmml" xref="S4.p2.11.m3.4.4.3"></eq><apply id="S4.p2.11.m3.3.3.1.cmml" xref="S4.p2.11.m3.3.3.1"><times id="S4.p2.11.m3.3.3.1.2.cmml" xref="S4.p2.11.m3.3.3.1.2"></times><apply id="S4.p2.11.m3.3.3.1.3.cmml" xref="S4.p2.11.m3.3.3.1.3"><csymbol cd="ambiguous" id="S4.p2.11.m3.3.3.1.3.1.cmml" xref="S4.p2.11.m3.3.3.1.3">superscript</csymbol><ci id="S4.p2.11.m3.3.3.1.3.2.cmml" xref="S4.p2.11.m3.3.3.1.3.2">𝑝</ci><times id="S4.p2.11.m3.3.3.1.3.3.cmml" xref="S4.p2.11.m3.3.3.1.3.3"></times></apply><apply id="S4.p2.11.m3.3.3.1.1.1.1.cmml" xref="S4.p2.11.m3.3.3.1.1.1"><csymbol cd="latexml" id="S4.p2.11.m3.3.3.1.1.1.1.1.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.1">succeeds</csymbol><apply id="S4.p2.11.m3.3.3.1.1.1.1.2.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.p2.11.m3.3.3.1.1.1.1.2.1.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.2">subscript</csymbol><ci id="S4.p2.11.m3.3.3.1.1.1.1.2.2.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.2.2">𝑦</ci><cn id="S4.p2.11.m3.3.3.1.1.1.1.2.3.cmml" type="integer" xref="S4.p2.11.m3.3.3.1.1.1.1.2.3">1</cn></apply><apply id="S4.p2.11.m3.3.3.1.1.1.1.3.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.3"><csymbol cd="latexml" id="S4.p2.11.m3.3.3.1.1.1.1.3.1.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.3.1">conditional</csymbol><apply id="S4.p2.11.m3.3.3.1.1.1.1.3.2.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S4.p2.11.m3.3.3.1.1.1.1.3.2.1.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2">subscript</csymbol><ci id="S4.p2.11.m3.3.3.1.1.1.1.3.2.2.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2.2">𝑦</ci><cn id="S4.p2.11.m3.3.3.1.1.1.1.3.2.3.cmml" type="integer" xref="S4.p2.11.m3.3.3.1.1.1.1.3.2.3">2</cn></apply><ci id="S4.p2.11.m3.3.3.1.1.1.1.3.3.cmml" xref="S4.p2.11.m3.3.3.1.1.1.1.3.3">𝑥</ci></apply></apply></apply><apply id="S4.p2.11.m3.4.4.2.cmml" xref="S4.p2.11.m3.4.4.2"><times id="S4.p2.11.m3.4.4.2.2.cmml" xref="S4.p2.11.m3.4.4.2.2"></times><ci id="S4.p2.11.m3.4.4.2.3.cmml" xref="S4.p2.11.m3.4.4.2.3">𝜎</ci><apply id="S4.p2.11.m3.4.4.2.1.1.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1"><minus id="S4.p2.11.m3.4.4.2.1.1.1.3.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.3"></minus><apply id="S4.p2.11.m3.4.4.2.1.1.1.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1"><times id="S4.p2.11.m3.4.4.2.1.1.1.1.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.2"></times><apply id="S4.p2.11.m3.4.4.2.1.1.1.1.3.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.p2.11.m3.4.4.2.1.1.1.1.3.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3">superscript</csymbol><ci id="S4.p2.11.m3.4.4.2.1.1.1.1.3.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3.2">𝑟</ci><times id="S4.p2.11.m3.4.4.2.1.1.1.1.3.3.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.3.3"></times></apply><interval closure="open" id="S4.p2.11.m3.4.4.2.1.1.1.1.1.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1"><ci id="S4.p2.11.m3.1.1.cmml" xref="S4.p2.11.m3.1.1">𝑥</ci><apply id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.2">𝑦</ci><cn id="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.3.cmml" type="integer" xref="S4.p2.11.m3.4.4.2.1.1.1.1.1.1.1.3">1</cn></apply></interval></apply><apply id="S4.p2.11.m3.4.4.2.1.1.1.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2"><times id="S4.p2.11.m3.4.4.2.1.1.1.2.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.2"></times><apply id="S4.p2.11.m3.4.4.2.1.1.1.2.3.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3"><csymbol cd="ambiguous" id="S4.p2.11.m3.4.4.2.1.1.1.2.3.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3">superscript</csymbol><ci id="S4.p2.11.m3.4.4.2.1.1.1.2.3.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3.2">𝑟</ci><times id="S4.p2.11.m3.4.4.2.1.1.1.2.3.3.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.3.3"></times></apply><interval closure="open" id="S4.p2.11.m3.4.4.2.1.1.1.2.1.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1"><ci id="S4.p2.11.m3.2.2.cmml" xref="S4.p2.11.m3.2.2">𝑥</ci><apply id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1"><csymbol cd="ambiguous" id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.1.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1">subscript</csymbol><ci id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.2.cmml" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.2">𝑦</ci><cn id="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.3.cmml" type="integer" xref="S4.p2.11.m3.4.4.2.1.1.1.2.1.1.1.3">2</cn></apply></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.11.m3.4c">{p^{*}(y_{1}\succ y_{2}\mid x)=\sigma(r^{*}(x,y_{1})-r^{*}(x,y_{2}))}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.11.m3.4d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ≻ italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∣ italic_x ) = italic_σ ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) - italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) )</annotation></semantics></math>. Substituting the reparameterization in Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E5" title="5 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a> for <math alttext="r^{*}(x,y)" class="ltx_Math" display="inline" id="S4.p2.12.m4.2"><semantics id="S4.p2.12.m4.2a"><mrow id="S4.p2.12.m4.2.3" xref="S4.p2.12.m4.2.3.cmml"><msup id="S4.p2.12.m4.2.3.2" xref="S4.p2.12.m4.2.3.2.cmml"><mi id="S4.p2.12.m4.2.3.2.2" xref="S4.p2.12.m4.2.3.2.2.cmml">r</mi><mo id="S4.p2.12.m4.2.3.2.3" xref="S4.p2.12.m4.2.3.2.3.cmml">*</mo></msup><mo id="S4.p2.12.m4.2.3.1" xref="S4.p2.12.m4.2.3.1.cmml">⁢</mo><mrow id="S4.p2.12.m4.2.3.3.2" xref="S4.p2.12.m4.2.3.3.1.cmml"><mo id="S4.p2.12.m4.2.3.3.2.1" stretchy="false" xref="S4.p2.12.m4.2.3.3.1.cmml">(</mo><mi id="S4.p2.12.m4.1.1" xref="S4.p2.12.m4.1.1.cmml">x</mi><mo id="S4.p2.12.m4.2.3.3.2.2" xref="S4.p2.12.m4.2.3.3.1.cmml">,</mo><mi id="S4.p2.12.m4.2.2" xref="S4.p2.12.m4.2.2.cmml">y</mi><mo id="S4.p2.12.m4.2.3.3.2.3" stretchy="false" xref="S4.p2.12.m4.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.12.m4.2b"><apply id="S4.p2.12.m4.2.3.cmml" xref="S4.p2.12.m4.2.3"><times id="S4.p2.12.m4.2.3.1.cmml" xref="S4.p2.12.m4.2.3.1"></times><apply id="S4.p2.12.m4.2.3.2.cmml" xref="S4.p2.12.m4.2.3.2"><csymbol cd="ambiguous" id="S4.p2.12.m4.2.3.2.1.cmml" xref="S4.p2.12.m4.2.3.2">superscript</csymbol><ci id="S4.p2.12.m4.2.3.2.2.cmml" xref="S4.p2.12.m4.2.3.2.2">𝑟</ci><times id="S4.p2.12.m4.2.3.2.3.cmml" xref="S4.p2.12.m4.2.3.2.3"></times></apply><interval closure="open" id="S4.p2.12.m4.2.3.3.1.cmml" xref="S4.p2.12.m4.2.3.3.2"><ci id="S4.p2.12.m4.1.1.cmml" xref="S4.p2.12.m4.1.1">𝑥</ci><ci id="S4.p2.12.m4.2.2.cmml" xref="S4.p2.12.m4.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.12.m4.2c">r^{*}(x,y)</annotation><annotation encoding="application/x-llamapun" id="S4.p2.12.m4.2d">italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y )</annotation></semantics></math> into the preference model Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E1" title="1 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a>, the partition function cancels, and we can express the human preference probability in terms of only the optimal policy <math alttext="\pi^{*}" class="ltx_Math" display="inline" id="S4.p2.13.m5.1"><semantics id="S4.p2.13.m5.1a"><msup id="S4.p2.13.m5.1.1" xref="S4.p2.13.m5.1.1.cmml"><mi id="S4.p2.13.m5.1.1.2" xref="S4.p2.13.m5.1.1.2.cmml">π</mi><mo id="S4.p2.13.m5.1.1.3" xref="S4.p2.13.m5.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S4.p2.13.m5.1b"><apply id="S4.p2.13.m5.1.1.cmml" xref="S4.p2.13.m5.1.1"><csymbol cd="ambiguous" id="S4.p2.13.m5.1.1.1.cmml" xref="S4.p2.13.m5.1.1">superscript</csymbol><ci id="S4.p2.13.m5.1.1.2.cmml" xref="S4.p2.13.m5.1.1.2">𝜋</ci><times id="S4.p2.13.m5.1.1.3.cmml" xref="S4.p2.13.m5.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.13.m5.1c">\pi^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.13.m5.1d">italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> and reference policy <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S4.p2.14.m6.1"><semantics id="S4.p2.14.m6.1a"><msub id="S4.p2.14.m6.1.1" xref="S4.p2.14.m6.1.1.cmml"><mi id="S4.p2.14.m6.1.1.2" xref="S4.p2.14.m6.1.1.2.cmml">π</mi><mtext id="S4.p2.14.m6.1.1.3" xref="S4.p2.14.m6.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p2.14.m6.1b"><apply id="S4.p2.14.m6.1.1.cmml" xref="S4.p2.14.m6.1.1"><csymbol cd="ambiguous" id="S4.p2.14.m6.1.1.1.cmml" xref="S4.p2.14.m6.1.1">subscript</csymbol><ci id="S4.p2.14.m6.1.1.2.cmml" xref="S4.p2.14.m6.1.1.2">𝜋</ci><ci id="S4.p2.14.m6.1.1.3a.cmml" xref="S4.p2.14.m6.1.1.3"><mtext id="S4.p2.14.m6.1.1.3.cmml" mathsize="70%" xref="S4.p2.14.m6.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.14.m6.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.14.m6.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math>. Thus, the optimal RLHF policy <math alttext="\pi^{*}" class="ltx_Math" display="inline" id="S4.p2.15.m7.1"><semantics id="S4.p2.15.m7.1a"><msup id="S4.p2.15.m7.1.1" xref="S4.p2.15.m7.1.1.cmml"><mi id="S4.p2.15.m7.1.1.2" xref="S4.p2.15.m7.1.1.2.cmml">π</mi><mo id="S4.p2.15.m7.1.1.3" xref="S4.p2.15.m7.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S4.p2.15.m7.1b"><apply id="S4.p2.15.m7.1.1.cmml" xref="S4.p2.15.m7.1.1"><csymbol cd="ambiguous" id="S4.p2.15.m7.1.1.1.cmml" xref="S4.p2.15.m7.1.1">superscript</csymbol><ci id="S4.p2.15.m7.1.1.2.cmml" xref="S4.p2.15.m7.1.1.2">𝜋</ci><times id="S4.p2.15.m7.1.1.3.cmml" xref="S4.p2.15.m7.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.15.m7.1c">\pi^{*}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.15.m7.1d">italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> under the Bradley-Terry model satisfies the preference model:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S4.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p^{*}(y_{1}\succ y_{2}\mid x)=\frac{1}{1+\exp\left(\beta\log\frac{\pi^{*}(y_{2%
}\mid x)}{\pi_{\text{ref}}(y_{2}\mid x)}-\beta\log\frac{\pi^{*}(y_{1}\mid x)}{%
\pi_{\text{ref}}(y_{1}\mid x)}\right)}" class="ltx_Math" display="block" id="S4.E6.m1.7"><semantics id="S4.E6.m1.7a"><mrow id="S4.E6.m1.7.7" xref="S4.E6.m1.7.7.cmml"><mrow id="S4.E6.m1.7.7.1" xref="S4.E6.m1.7.7.1.cmml"><msup id="S4.E6.m1.7.7.1.3" xref="S4.E6.m1.7.7.1.3.cmml"><mi id="S4.E6.m1.7.7.1.3.2" xref="S4.E6.m1.7.7.1.3.2.cmml">p</mi><mo id="S4.E6.m1.7.7.1.3.3" xref="S4.E6.m1.7.7.1.3.3.cmml">*</mo></msup><mo id="S4.E6.m1.7.7.1.2" xref="S4.E6.m1.7.7.1.2.cmml">⁢</mo><mrow id="S4.E6.m1.7.7.1.1.1" xref="S4.E6.m1.7.7.1.1.1.1.cmml"><mo id="S4.E6.m1.7.7.1.1.1.2" stretchy="false" xref="S4.E6.m1.7.7.1.1.1.1.cmml">(</mo><mrow id="S4.E6.m1.7.7.1.1.1.1" xref="S4.E6.m1.7.7.1.1.1.1.cmml"><msub id="S4.E6.m1.7.7.1.1.1.1.2" xref="S4.E6.m1.7.7.1.1.1.1.2.cmml"><mi id="S4.E6.m1.7.7.1.1.1.1.2.2" xref="S4.E6.m1.7.7.1.1.1.1.2.2.cmml">y</mi><mn id="S4.E6.m1.7.7.1.1.1.1.2.3" xref="S4.E6.m1.7.7.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S4.E6.m1.7.7.1.1.1.1.1" xref="S4.E6.m1.7.7.1.1.1.1.1.cmml">≻</mo><mrow id="S4.E6.m1.7.7.1.1.1.1.3" xref="S4.E6.m1.7.7.1.1.1.1.3.cmml"><msub id="S4.E6.m1.7.7.1.1.1.1.3.2" xref="S4.E6.m1.7.7.1.1.1.1.3.2.cmml"><mi id="S4.E6.m1.7.7.1.1.1.1.3.2.2" xref="S4.E6.m1.7.7.1.1.1.1.3.2.2.cmml">y</mi><mn id="S4.E6.m1.7.7.1.1.1.1.3.2.3" xref="S4.E6.m1.7.7.1.1.1.1.3.2.3.cmml">2</mn></msub><mo id="S4.E6.m1.7.7.1.1.1.1.3.1" xref="S4.E6.m1.7.7.1.1.1.1.3.1.cmml">∣</mo><mi id="S4.E6.m1.7.7.1.1.1.1.3.3" xref="S4.E6.m1.7.7.1.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="S4.E6.m1.7.7.1.1.1.3" stretchy="false" xref="S4.E6.m1.7.7.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E6.m1.7.7.2" xref="S4.E6.m1.7.7.2.cmml">=</mo><mfrac id="S4.E6.m1.6.6" xref="S4.E6.m1.6.6.cmml"><mn id="S4.E6.m1.6.6.8" xref="S4.E6.m1.6.6.8.cmml">1</mn><mrow id="S4.E6.m1.6.6.6" xref="S4.E6.m1.6.6.6.cmml"><mn id="S4.E6.m1.6.6.6.8" xref="S4.E6.m1.6.6.6.8.cmml">1</mn><mo id="S4.E6.m1.6.6.6.7" xref="S4.E6.m1.6.6.6.7.cmml">+</mo><mrow id="S4.E6.m1.6.6.6.6.1" xref="S4.E6.m1.6.6.6.6.2.cmml"><mi id="S4.E6.m1.5.5.5.5" xref="S4.E6.m1.5.5.5.5.cmml">exp</mi><mo id="S4.E6.m1.6.6.6.6.1a" xref="S4.E6.m1.6.6.6.6.2.cmml">⁡</mo><mrow id="S4.E6.m1.6.6.6.6.1.1" xref="S4.E6.m1.6.6.6.6.2.cmml"><mo id="S4.E6.m1.6.6.6.6.1.1.2" xref="S4.E6.m1.6.6.6.6.2.cmml">(</mo><mrow id="S4.E6.m1.6.6.6.6.1.1.1" xref="S4.E6.m1.6.6.6.6.1.1.1.cmml"><mrow id="S4.E6.m1.6.6.6.6.1.1.1.2" xref="S4.E6.m1.6.6.6.6.1.1.1.2.cmml"><mi id="S4.E6.m1.6.6.6.6.1.1.1.2.2" xref="S4.E6.m1.6.6.6.6.1.1.1.2.2.cmml">β</mi><mo id="S4.E6.m1.6.6.6.6.1.1.1.2.1" lspace="0.167em" xref="S4.E6.m1.6.6.6.6.1.1.1.2.1.cmml">⁢</mo><mrow id="S4.E6.m1.6.6.6.6.1.1.1.2.3" xref="S4.E6.m1.6.6.6.6.1.1.1.2.3.cmml"><mi id="S4.E6.m1.6.6.6.6.1.1.1.2.3.1" xref="S4.E6.m1.6.6.6.6.1.1.1.2.3.1.cmml">log</mi><mo id="S4.E6.m1.6.6.6.6.1.1.1.2.3a" lspace="0.167em" xref="S4.E6.m1.6.6.6.6.1.1.1.2.3.cmml">⁡</mo><mfrac id="S4.E6.m1.2.2.2.2" xref="S4.E6.m1.2.2.2.2.cmml"><mrow id="S4.E6.m1.1.1.1.1.1" xref="S4.E6.m1.1.1.1.1.1.cmml"><msup id="S4.E6.m1.1.1.1.1.1.3" xref="S4.E6.m1.1.1.1.1.1.3.cmml"><mi id="S4.E6.m1.1.1.1.1.1.3.2" xref="S4.E6.m1.1.1.1.1.1.3.2.cmml">π</mi><mo id="S4.E6.m1.1.1.1.1.1.3.3" xref="S4.E6.m1.1.1.1.1.1.3.3.cmml">*</mo></msup><mo id="S4.E6.m1.1.1.1.1.1.2" xref="S4.E6.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S4.E6.m1.1.1.1.1.1.1.1" xref="S4.E6.m1.1.1.1.1.1.1.1.1.cmml"><mo id="S4.E6.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="S4.E6.m1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E6.m1.1.1.1.1.1.1.1.1" xref="S4.E6.m1.1.1.1.1.1.1.1.1.cmml"><msub id="S4.E6.m1.1.1.1.1.1.1.1.1.2" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S4.E6.m1.1.1.1.1.1.1.1.1.2.2" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2.2.cmml">y</mi><mn id="S4.E6.m1.1.1.1.1.1.1.1.1.2.3" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2.3.cmml">2</mn></msub><mo id="S4.E6.m1.1.1.1.1.1.1.1.1.1" xref="S4.E6.m1.1.1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S4.E6.m1.1.1.1.1.1.1.1.1.3" xref="S4.E6.m1.1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E6.m1.1.1.1.1.1.1.1.3" stretchy="false" xref="S4.E6.m1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S4.E6.m1.2.2.2.2.2" xref="S4.E6.m1.2.2.2.2.2.cmml"><msub id="S4.E6.m1.2.2.2.2.2.3" xref="S4.E6.m1.2.2.2.2.2.3.cmml"><mi id="S4.E6.m1.2.2.2.2.2.3.2" xref="S4.E6.m1.2.2.2.2.2.3.2.cmml">π</mi><mtext id="S4.E6.m1.2.2.2.2.2.3.3" xref="S4.E6.m1.2.2.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="S4.E6.m1.2.2.2.2.2.2" xref="S4.E6.m1.2.2.2.2.2.2.cmml">⁢</mo><mrow id="S4.E6.m1.2.2.2.2.2.1.1" xref="S4.E6.m1.2.2.2.2.2.1.1.1.cmml"><mo id="S4.E6.m1.2.2.2.2.2.1.1.2" stretchy="false" xref="S4.E6.m1.2.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S4.E6.m1.2.2.2.2.2.1.1.1" xref="S4.E6.m1.2.2.2.2.2.1.1.1.cmml"><msub id="S4.E6.m1.2.2.2.2.2.1.1.1.2" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2.cmml"><mi id="S4.E6.m1.2.2.2.2.2.1.1.1.2.2" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2.2.cmml">y</mi><mn id="S4.E6.m1.2.2.2.2.2.1.1.1.2.3" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2.3.cmml">2</mn></msub><mo id="S4.E6.m1.2.2.2.2.2.1.1.1.1" xref="S4.E6.m1.2.2.2.2.2.1.1.1.1.cmml">∣</mo><mi id="S4.E6.m1.2.2.2.2.2.1.1.1.3" xref="S4.E6.m1.2.2.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E6.m1.2.2.2.2.2.1.1.3" stretchy="false" xref="S4.E6.m1.2.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="S4.E6.m1.6.6.6.6.1.1.1.1" xref="S4.E6.m1.6.6.6.6.1.1.1.1.cmml">−</mo><mrow id="S4.E6.m1.6.6.6.6.1.1.1.3" xref="S4.E6.m1.6.6.6.6.1.1.1.3.cmml"><mi id="S4.E6.m1.6.6.6.6.1.1.1.3.2" xref="S4.E6.m1.6.6.6.6.1.1.1.3.2.cmml">β</mi><mo id="S4.E6.m1.6.6.6.6.1.1.1.3.1" lspace="0.167em" xref="S4.E6.m1.6.6.6.6.1.1.1.3.1.cmml">⁢</mo><mrow id="S4.E6.m1.6.6.6.6.1.1.1.3.3" xref="S4.E6.m1.6.6.6.6.1.1.1.3.3.cmml"><mi id="S4.E6.m1.6.6.6.6.1.1.1.3.3.1" xref="S4.E6.m1.6.6.6.6.1.1.1.3.3.1.cmml">log</mi><mo id="S4.E6.m1.6.6.6.6.1.1.1.3.3a" lspace="0.167em" xref="S4.E6.m1.6.6.6.6.1.1.1.3.3.cmml">⁡</mo><mfrac id="S4.E6.m1.4.4.4.4" xref="S4.E6.m1.4.4.4.4.cmml"><mrow id="S4.E6.m1.3.3.3.3.1" xref="S4.E6.m1.3.3.3.3.1.cmml"><msup id="S4.E6.m1.3.3.3.3.1.3" xref="S4.E6.m1.3.3.3.3.1.3.cmml"><mi id="S4.E6.m1.3.3.3.3.1.3.2" xref="S4.E6.m1.3.3.3.3.1.3.2.cmml">π</mi><mo id="S4.E6.m1.3.3.3.3.1.3.3" xref="S4.E6.m1.3.3.3.3.1.3.3.cmml">*</mo></msup><mo id="S4.E6.m1.3.3.3.3.1.2" xref="S4.E6.m1.3.3.3.3.1.2.cmml">⁢</mo><mrow id="S4.E6.m1.3.3.3.3.1.1.1" xref="S4.E6.m1.3.3.3.3.1.1.1.1.cmml"><mo id="S4.E6.m1.3.3.3.3.1.1.1.2" stretchy="false" xref="S4.E6.m1.3.3.3.3.1.1.1.1.cmml">(</mo><mrow id="S4.E6.m1.3.3.3.3.1.1.1.1" xref="S4.E6.m1.3.3.3.3.1.1.1.1.cmml"><msub id="S4.E6.m1.3.3.3.3.1.1.1.1.2" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2.cmml"><mi id="S4.E6.m1.3.3.3.3.1.1.1.1.2.2" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2.2.cmml">y</mi><mn id="S4.E6.m1.3.3.3.3.1.1.1.1.2.3" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S4.E6.m1.3.3.3.3.1.1.1.1.1" xref="S4.E6.m1.3.3.3.3.1.1.1.1.1.cmml">∣</mo><mi id="S4.E6.m1.3.3.3.3.1.1.1.1.3" xref="S4.E6.m1.3.3.3.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E6.m1.3.3.3.3.1.1.1.3" stretchy="false" xref="S4.E6.m1.3.3.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S4.E6.m1.4.4.4.4.2" xref="S4.E6.m1.4.4.4.4.2.cmml"><msub id="S4.E6.m1.4.4.4.4.2.3" xref="S4.E6.m1.4.4.4.4.2.3.cmml"><mi id="S4.E6.m1.4.4.4.4.2.3.2" xref="S4.E6.m1.4.4.4.4.2.3.2.cmml">π</mi><mtext id="S4.E6.m1.4.4.4.4.2.3.3" xref="S4.E6.m1.4.4.4.4.2.3.3a.cmml">ref</mtext></msub><mo id="S4.E6.m1.4.4.4.4.2.2" xref="S4.E6.m1.4.4.4.4.2.2.cmml">⁢</mo><mrow id="S4.E6.m1.4.4.4.4.2.1.1" xref="S4.E6.m1.4.4.4.4.2.1.1.1.cmml"><mo id="S4.E6.m1.4.4.4.4.2.1.1.2" stretchy="false" xref="S4.E6.m1.4.4.4.4.2.1.1.1.cmml">(</mo><mrow id="S4.E6.m1.4.4.4.4.2.1.1.1" xref="S4.E6.m1.4.4.4.4.2.1.1.1.cmml"><msub id="S4.E6.m1.4.4.4.4.2.1.1.1.2" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2.cmml"><mi id="S4.E6.m1.4.4.4.4.2.1.1.1.2.2" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2.2.cmml">y</mi><mn id="S4.E6.m1.4.4.4.4.2.1.1.1.2.3" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2.3.cmml">1</mn></msub><mo id="S4.E6.m1.4.4.4.4.2.1.1.1.1" xref="S4.E6.m1.4.4.4.4.2.1.1.1.1.cmml">∣</mo><mi id="S4.E6.m1.4.4.4.4.2.1.1.1.3" xref="S4.E6.m1.4.4.4.4.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E6.m1.4.4.4.4.2.1.1.3" stretchy="false" xref="S4.E6.m1.4.4.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><mo id="S4.E6.m1.6.6.6.6.1.1.3" xref="S4.E6.m1.6.6.6.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S4.E6.m1.7b"><apply id="S4.E6.m1.7.7.cmml" xref="S4.E6.m1.7.7"><eq id="S4.E6.m1.7.7.2.cmml" xref="S4.E6.m1.7.7.2"></eq><apply id="S4.E6.m1.7.7.1.cmml" xref="S4.E6.m1.7.7.1"><times id="S4.E6.m1.7.7.1.2.cmml" xref="S4.E6.m1.7.7.1.2"></times><apply id="S4.E6.m1.7.7.1.3.cmml" xref="S4.E6.m1.7.7.1.3"><csymbol cd="ambiguous" id="S4.E6.m1.7.7.1.3.1.cmml" xref="S4.E6.m1.7.7.1.3">superscript</csymbol><ci id="S4.E6.m1.7.7.1.3.2.cmml" xref="S4.E6.m1.7.7.1.3.2">𝑝</ci><times id="S4.E6.m1.7.7.1.3.3.cmml" xref="S4.E6.m1.7.7.1.3.3"></times></apply><apply id="S4.E6.m1.7.7.1.1.1.1.cmml" xref="S4.E6.m1.7.7.1.1.1"><csymbol cd="latexml" id="S4.E6.m1.7.7.1.1.1.1.1.cmml" xref="S4.E6.m1.7.7.1.1.1.1.1">succeeds</csymbol><apply id="S4.E6.m1.7.7.1.1.1.1.2.cmml" xref="S4.E6.m1.7.7.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.E6.m1.7.7.1.1.1.1.2.1.cmml" xref="S4.E6.m1.7.7.1.1.1.1.2">subscript</csymbol><ci id="S4.E6.m1.7.7.1.1.1.1.2.2.cmml" xref="S4.E6.m1.7.7.1.1.1.1.2.2">𝑦</ci><cn id="S4.E6.m1.7.7.1.1.1.1.2.3.cmml" type="integer" xref="S4.E6.m1.7.7.1.1.1.1.2.3">1</cn></apply><apply id="S4.E6.m1.7.7.1.1.1.1.3.cmml" xref="S4.E6.m1.7.7.1.1.1.1.3"><csymbol cd="latexml" id="S4.E6.m1.7.7.1.1.1.1.3.1.cmml" xref="S4.E6.m1.7.7.1.1.1.1.3.1">conditional</csymbol><apply id="S4.E6.m1.7.7.1.1.1.1.3.2.cmml" xref="S4.E6.m1.7.7.1.1.1.1.3.2"><csymbol cd="ambiguous" id="S4.E6.m1.7.7.1.1.1.1.3.2.1.cmml" xref="S4.E6.m1.7.7.1.1.1.1.3.2">subscript</csymbol><ci id="S4.E6.m1.7.7.1.1.1.1.3.2.2.cmml" xref="S4.E6.m1.7.7.1.1.1.1.3.2.2">𝑦</ci><cn id="S4.E6.m1.7.7.1.1.1.1.3.2.3.cmml" type="integer" xref="S4.E6.m1.7.7.1.1.1.1.3.2.3">2</cn></apply><ci id="S4.E6.m1.7.7.1.1.1.1.3.3.cmml" xref="S4.E6.m1.7.7.1.1.1.1.3.3">𝑥</ci></apply></apply></apply><apply id="S4.E6.m1.6.6.cmml" xref="S4.E6.m1.6.6"><divide id="S4.E6.m1.6.6.7.cmml" xref="S4.E6.m1.6.6"></divide><cn id="S4.E6.m1.6.6.8.cmml" type="integer" xref="S4.E6.m1.6.6.8">1</cn><apply id="S4.E6.m1.6.6.6.cmml" xref="S4.E6.m1.6.6.6"><plus id="S4.E6.m1.6.6.6.7.cmml" xref="S4.E6.m1.6.6.6.7"></plus><cn id="S4.E6.m1.6.6.6.8.cmml" type="integer" xref="S4.E6.m1.6.6.6.8">1</cn><apply id="S4.E6.m1.6.6.6.6.2.cmml" xref="S4.E6.m1.6.6.6.6.1"><exp id="S4.E6.m1.5.5.5.5.cmml" xref="S4.E6.m1.5.5.5.5"></exp><apply id="S4.E6.m1.6.6.6.6.1.1.1.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1"><minus id="S4.E6.m1.6.6.6.6.1.1.1.1.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.1"></minus><apply id="S4.E6.m1.6.6.6.6.1.1.1.2.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.2"><times id="S4.E6.m1.6.6.6.6.1.1.1.2.1.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.2.1"></times><ci id="S4.E6.m1.6.6.6.6.1.1.1.2.2.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.2.2">𝛽</ci><apply id="S4.E6.m1.6.6.6.6.1.1.1.2.3.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.2.3"><log id="S4.E6.m1.6.6.6.6.1.1.1.2.3.1.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.2.3.1"></log><apply id="S4.E6.m1.2.2.2.2.cmml" xref="S4.E6.m1.2.2.2.2"><divide id="S4.E6.m1.2.2.2.2.3.cmml" xref="S4.E6.m1.2.2.2.2"></divide><apply id="S4.E6.m1.1.1.1.1.1.cmml" xref="S4.E6.m1.1.1.1.1.1"><times id="S4.E6.m1.1.1.1.1.1.2.cmml" xref="S4.E6.m1.1.1.1.1.1.2"></times><apply id="S4.E6.m1.1.1.1.1.1.3.cmml" xref="S4.E6.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S4.E6.m1.1.1.1.1.1.3.1.cmml" xref="S4.E6.m1.1.1.1.1.1.3">superscript</csymbol><ci id="S4.E6.m1.1.1.1.1.1.3.2.cmml" xref="S4.E6.m1.1.1.1.1.1.3.2">𝜋</ci><times id="S4.E6.m1.1.1.1.1.1.3.3.cmml" xref="S4.E6.m1.1.1.1.1.1.3.3"></times></apply><apply id="S4.E6.m1.1.1.1.1.1.1.1.1.cmml" xref="S4.E6.m1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="S4.E6.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E6.m1.1.1.1.1.1.1.1.1.1">conditional</csymbol><apply id="S4.E6.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.E6.m1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S4.E6.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2.2">𝑦</ci><cn id="S4.E6.m1.1.1.1.1.1.1.1.1.2.3.cmml" type="integer" xref="S4.E6.m1.1.1.1.1.1.1.1.1.2.3">2</cn></apply><ci id="S4.E6.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E6.m1.1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.E6.m1.2.2.2.2.2.cmml" xref="S4.E6.m1.2.2.2.2.2"><times id="S4.E6.m1.2.2.2.2.2.2.cmml" xref="S4.E6.m1.2.2.2.2.2.2"></times><apply id="S4.E6.m1.2.2.2.2.2.3.cmml" xref="S4.E6.m1.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S4.E6.m1.2.2.2.2.2.3.1.cmml" xref="S4.E6.m1.2.2.2.2.2.3">subscript</csymbol><ci id="S4.E6.m1.2.2.2.2.2.3.2.cmml" xref="S4.E6.m1.2.2.2.2.2.3.2">𝜋</ci><ci id="S4.E6.m1.2.2.2.2.2.3.3a.cmml" xref="S4.E6.m1.2.2.2.2.2.3.3"><mtext id="S4.E6.m1.2.2.2.2.2.3.3.cmml" mathsize="50%" xref="S4.E6.m1.2.2.2.2.2.3.3">ref</mtext></ci></apply><apply id="S4.E6.m1.2.2.2.2.2.1.1.1.cmml" xref="S4.E6.m1.2.2.2.2.2.1.1"><csymbol cd="latexml" id="S4.E6.m1.2.2.2.2.2.1.1.1.1.cmml" xref="S4.E6.m1.2.2.2.2.2.1.1.1.1">conditional</csymbol><apply id="S4.E6.m1.2.2.2.2.2.1.1.1.2.cmml" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2"><csymbol cd="ambiguous" id="S4.E6.m1.2.2.2.2.2.1.1.1.2.1.cmml" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2">subscript</csymbol><ci id="S4.E6.m1.2.2.2.2.2.1.1.1.2.2.cmml" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2.2">𝑦</ci><cn id="S4.E6.m1.2.2.2.2.2.1.1.1.2.3.cmml" type="integer" xref="S4.E6.m1.2.2.2.2.2.1.1.1.2.3">2</cn></apply><ci id="S4.E6.m1.2.2.2.2.2.1.1.1.3.cmml" xref="S4.E6.m1.2.2.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="S4.E6.m1.6.6.6.6.1.1.1.3.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.3"><times id="S4.E6.m1.6.6.6.6.1.1.1.3.1.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.3.1"></times><ci id="S4.E6.m1.6.6.6.6.1.1.1.3.2.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.3.2">𝛽</ci><apply id="S4.E6.m1.6.6.6.6.1.1.1.3.3.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.3.3"><log id="S4.E6.m1.6.6.6.6.1.1.1.3.3.1.cmml" xref="S4.E6.m1.6.6.6.6.1.1.1.3.3.1"></log><apply id="S4.E6.m1.4.4.4.4.cmml" xref="S4.E6.m1.4.4.4.4"><divide id="S4.E6.m1.4.4.4.4.3.cmml" xref="S4.E6.m1.4.4.4.4"></divide><apply id="S4.E6.m1.3.3.3.3.1.cmml" xref="S4.E6.m1.3.3.3.3.1"><times id="S4.E6.m1.3.3.3.3.1.2.cmml" xref="S4.E6.m1.3.3.3.3.1.2"></times><apply id="S4.E6.m1.3.3.3.3.1.3.cmml" xref="S4.E6.m1.3.3.3.3.1.3"><csymbol cd="ambiguous" id="S4.E6.m1.3.3.3.3.1.3.1.cmml" xref="S4.E6.m1.3.3.3.3.1.3">superscript</csymbol><ci id="S4.E6.m1.3.3.3.3.1.3.2.cmml" xref="S4.E6.m1.3.3.3.3.1.3.2">𝜋</ci><times id="S4.E6.m1.3.3.3.3.1.3.3.cmml" xref="S4.E6.m1.3.3.3.3.1.3.3"></times></apply><apply id="S4.E6.m1.3.3.3.3.1.1.1.1.cmml" xref="S4.E6.m1.3.3.3.3.1.1.1"><csymbol cd="latexml" id="S4.E6.m1.3.3.3.3.1.1.1.1.1.cmml" xref="S4.E6.m1.3.3.3.3.1.1.1.1.1">conditional</csymbol><apply id="S4.E6.m1.3.3.3.3.1.1.1.1.2.cmml" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.E6.m1.3.3.3.3.1.1.1.1.2.1.cmml" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2">subscript</csymbol><ci id="S4.E6.m1.3.3.3.3.1.1.1.1.2.2.cmml" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2.2">𝑦</ci><cn id="S4.E6.m1.3.3.3.3.1.1.1.1.2.3.cmml" type="integer" xref="S4.E6.m1.3.3.3.3.1.1.1.1.2.3">1</cn></apply><ci id="S4.E6.m1.3.3.3.3.1.1.1.1.3.cmml" xref="S4.E6.m1.3.3.3.3.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.E6.m1.4.4.4.4.2.cmml" xref="S4.E6.m1.4.4.4.4.2"><times id="S4.E6.m1.4.4.4.4.2.2.cmml" xref="S4.E6.m1.4.4.4.4.2.2"></times><apply id="S4.E6.m1.4.4.4.4.2.3.cmml" xref="S4.E6.m1.4.4.4.4.2.3"><csymbol cd="ambiguous" id="S4.E6.m1.4.4.4.4.2.3.1.cmml" xref="S4.E6.m1.4.4.4.4.2.3">subscript</csymbol><ci id="S4.E6.m1.4.4.4.4.2.3.2.cmml" xref="S4.E6.m1.4.4.4.4.2.3.2">𝜋</ci><ci id="S4.E6.m1.4.4.4.4.2.3.3a.cmml" xref="S4.E6.m1.4.4.4.4.2.3.3"><mtext id="S4.E6.m1.4.4.4.4.2.3.3.cmml" mathsize="50%" xref="S4.E6.m1.4.4.4.4.2.3.3">ref</mtext></ci></apply><apply id="S4.E6.m1.4.4.4.4.2.1.1.1.cmml" xref="S4.E6.m1.4.4.4.4.2.1.1"><csymbol cd="latexml" id="S4.E6.m1.4.4.4.4.2.1.1.1.1.cmml" xref="S4.E6.m1.4.4.4.4.2.1.1.1.1">conditional</csymbol><apply id="S4.E6.m1.4.4.4.4.2.1.1.1.2.cmml" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2"><csymbol cd="ambiguous" id="S4.E6.m1.4.4.4.4.2.1.1.1.2.1.cmml" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2">subscript</csymbol><ci id="S4.E6.m1.4.4.4.4.2.1.1.1.2.2.cmml" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2.2">𝑦</ci><cn id="S4.E6.m1.4.4.4.4.2.1.1.1.2.3.cmml" type="integer" xref="S4.E6.m1.4.4.4.4.2.1.1.1.2.3">1</cn></apply><ci id="S4.E6.m1.4.4.4.4.2.1.1.1.3.cmml" xref="S4.E6.m1.4.4.4.4.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E6.m1.7c">p^{*}(y_{1}\succ y_{2}\mid x)=\frac{1}{1+\exp\left(\beta\log\frac{\pi^{*}(y_{2%
}\mid x)}{\pi_{\text{ref}}(y_{2}\mid x)}-\beta\log\frac{\pi^{*}(y_{1}\mid x)}{%
\pi_{\text{ref}}(y_{1}\mid x)}\right)}</annotation><annotation encoding="application/x-llamapun" id="S4.E6.m1.7d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ≻ italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∣ italic_x ) = divide start_ARG 1 end_ARG start_ARG 1 + roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∣ italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∣ italic_x ) end_ARG ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.p2.16">The derivation is in Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS2" title="A.2 Deriving the DPO Objective Under the Bradley-Terry Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.2</span></a>. While Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E6" title="6 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">6</span></a> uses the Bradley-Terry model, we can similarly derive expressions under the more general Plackett-Luce models&nbsp;<cite class="ltx_cite ltx_citemacro_citep">(Plackett, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib30" title="">1975</a>; Luce, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib21" title="">2012</a>)</cite>, shown in Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS3" title="A.3 Deriving the DPO Objective Under the Plackett-Luce Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.3</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S4.p3">
<p class="ltx_p" id="S4.p3.1">Now that we have
the probability of human preference data in terms of the optimal policy rather than the reward model, we can formulate a maximum likelihood objective for a parametrized policy <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S4.p3.1.m1.1"><semantics id="S4.p3.1.m1.1a"><msub id="S4.p3.1.m1.1.1" xref="S4.p3.1.m1.1.1.cmml"><mi id="S4.p3.1.m1.1.1.2" xref="S4.p3.1.m1.1.1.2.cmml">π</mi><mi id="S4.p3.1.m1.1.1.3" xref="S4.p3.1.m1.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p3.1.m1.1b"><apply id="S4.p3.1.m1.1.1.cmml" xref="S4.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S4.p3.1.m1.1.1.1.cmml" xref="S4.p3.1.m1.1.1">subscript</csymbol><ci id="S4.p3.1.m1.1.1.2.cmml" xref="S4.p3.1.m1.1.1.2">𝜋</ci><ci id="S4.p3.1.m1.1.1.3.cmml" xref="S4.p3.1.m1.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p3.1.m1.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S4.p3.1.m1.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math>. Analogous to the reward modeling approach (i.e. Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E2" title="2 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">2</span></a>), our policy objective becomes:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S4.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=-\mathbb{E}_{(x,y_{w},%
y_{l})\sim\mathcal{D}}\left[\log\sigma\left(\beta\log\frac{\pi_{\theta}(y_{w}%
\mid x)}{\pi_{\text{ref}}(y_{w}\mid x)}-\beta\log\frac{\pi_{\theta}(y_{l}\mid x%
)}{\pi_{\text{ref}}(y_{l}\mid x)}\right)\right]." class="ltx_Math" display="block" id="S4.E7.m1.8"><semantics id="S4.E7.m1.8a"><mrow id="S4.E7.m1.8.8.1" xref="S4.E7.m1.8.8.1.1.cmml"><mrow id="S4.E7.m1.8.8.1.1" xref="S4.E7.m1.8.8.1.1.cmml"><mrow id="S4.E7.m1.8.8.1.1.2" xref="S4.E7.m1.8.8.1.1.2.cmml"><msub id="S4.E7.m1.8.8.1.1.2.4" xref="S4.E7.m1.8.8.1.1.2.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.E7.m1.8.8.1.1.2.4.2" xref="S4.E7.m1.8.8.1.1.2.4.2.cmml">ℒ</mi><mtext id="S4.E7.m1.8.8.1.1.2.4.3" xref="S4.E7.m1.8.8.1.1.2.4.3a.cmml">DPO</mtext></msub><mo id="S4.E7.m1.8.8.1.1.2.3" xref="S4.E7.m1.8.8.1.1.2.3.cmml">⁢</mo><mrow id="S4.E7.m1.8.8.1.1.2.2.2" xref="S4.E7.m1.8.8.1.1.2.2.3.cmml"><mo id="S4.E7.m1.8.8.1.1.2.2.2.3" stretchy="false" xref="S4.E7.m1.8.8.1.1.2.2.3.cmml">(</mo><msub id="S4.E7.m1.8.8.1.1.1.1.1.1" xref="S4.E7.m1.8.8.1.1.1.1.1.1.cmml"><mi id="S4.E7.m1.8.8.1.1.1.1.1.1.2" xref="S4.E7.m1.8.8.1.1.1.1.1.1.2.cmml">π</mi><mi id="S4.E7.m1.8.8.1.1.1.1.1.1.3" xref="S4.E7.m1.8.8.1.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="S4.E7.m1.8.8.1.1.2.2.2.4" xref="S4.E7.m1.8.8.1.1.2.2.3.cmml">;</mo><msub id="S4.E7.m1.8.8.1.1.2.2.2.2" xref="S4.E7.m1.8.8.1.1.2.2.2.2.cmml"><mi id="S4.E7.m1.8.8.1.1.2.2.2.2.2" xref="S4.E7.m1.8.8.1.1.2.2.2.2.2.cmml">π</mi><mtext id="S4.E7.m1.8.8.1.1.2.2.2.2.3" xref="S4.E7.m1.8.8.1.1.2.2.2.2.3a.cmml">ref</mtext></msub><mo id="S4.E7.m1.8.8.1.1.2.2.2.5" stretchy="false" xref="S4.E7.m1.8.8.1.1.2.2.3.cmml">)</mo></mrow></mrow><mo id="S4.E7.m1.8.8.1.1.4" xref="S4.E7.m1.8.8.1.1.4.cmml">=</mo><mrow id="S4.E7.m1.8.8.1.1.3" xref="S4.E7.m1.8.8.1.1.3.cmml"><mo id="S4.E7.m1.8.8.1.1.3a" xref="S4.E7.m1.8.8.1.1.3.cmml">−</mo><mrow id="S4.E7.m1.8.8.1.1.3.1" xref="S4.E7.m1.8.8.1.1.3.1.cmml"><msub id="S4.E7.m1.8.8.1.1.3.1.3" xref="S4.E7.m1.8.8.1.1.3.1.3.cmml"><mi id="S4.E7.m1.8.8.1.1.3.1.3.2" xref="S4.E7.m1.8.8.1.1.3.1.3.2.cmml">𝔼</mi><mrow id="S4.E7.m1.3.3.3" xref="S4.E7.m1.3.3.3.cmml"><mrow id="S4.E7.m1.3.3.3.3.2" xref="S4.E7.m1.3.3.3.3.3.cmml"><mo id="S4.E7.m1.3.3.3.3.2.3" stretchy="false" xref="S4.E7.m1.3.3.3.3.3.cmml">(</mo><mi id="S4.E7.m1.1.1.1.1" xref="S4.E7.m1.1.1.1.1.cmml">x</mi><mo id="S4.E7.m1.3.3.3.3.2.4" xref="S4.E7.m1.3.3.3.3.3.cmml">,</mo><msub id="S4.E7.m1.2.2.2.2.1.1" xref="S4.E7.m1.2.2.2.2.1.1.cmml"><mi id="S4.E7.m1.2.2.2.2.1.1.2" xref="S4.E7.m1.2.2.2.2.1.1.2.cmml">y</mi><mi id="S4.E7.m1.2.2.2.2.1.1.3" xref="S4.E7.m1.2.2.2.2.1.1.3.cmml">w</mi></msub><mo id="S4.E7.m1.3.3.3.3.2.5" xref="S4.E7.m1.3.3.3.3.3.cmml">,</mo><msub id="S4.E7.m1.3.3.3.3.2.2" xref="S4.E7.m1.3.3.3.3.2.2.cmml"><mi id="S4.E7.m1.3.3.3.3.2.2.2" xref="S4.E7.m1.3.3.3.3.2.2.2.cmml">y</mi><mi id="S4.E7.m1.3.3.3.3.2.2.3" xref="S4.E7.m1.3.3.3.3.2.2.3.cmml">l</mi></msub><mo id="S4.E7.m1.3.3.3.3.2.6" stretchy="false" xref="S4.E7.m1.3.3.3.3.3.cmml">)</mo></mrow><mo id="S4.E7.m1.3.3.3.4" xref="S4.E7.m1.3.3.3.4.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S4.E7.m1.3.3.3.5" xref="S4.E7.m1.3.3.3.5.cmml">𝒟</mi></mrow></msub><mo id="S4.E7.m1.8.8.1.1.3.1.2" xref="S4.E7.m1.8.8.1.1.3.1.2.cmml">⁢</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1" xref="S4.E7.m1.8.8.1.1.3.1.1.2.cmml"><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.2" xref="S4.E7.m1.8.8.1.1.3.1.1.2.1.cmml">[</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.cmml"><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.cmml"><mi id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.1.cmml">log</mi><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3a" lspace="0.167em" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.cmml">⁡</mo><mi id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.2" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.2.cmml">σ</mi></mrow><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.2" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.2.cmml">⁢</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.cmml"><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.2" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.cmml"><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.cmml"><mi id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.2" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.2.cmml">β</mi><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.1" lspace="0.167em" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.1.cmml">⁢</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.cmml"><mi id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.1.cmml">log</mi><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3a" lspace="0.167em" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.cmml">⁡</mo><mfrac id="S4.E7.m1.5.5" xref="S4.E7.m1.5.5.cmml"><mrow id="S4.E7.m1.4.4.1" xref="S4.E7.m1.4.4.1.cmml"><msub id="S4.E7.m1.4.4.1.3" xref="S4.E7.m1.4.4.1.3.cmml"><mi id="S4.E7.m1.4.4.1.3.2" xref="S4.E7.m1.4.4.1.3.2.cmml">π</mi><mi id="S4.E7.m1.4.4.1.3.3" xref="S4.E7.m1.4.4.1.3.3.cmml">θ</mi></msub><mo id="S4.E7.m1.4.4.1.2" xref="S4.E7.m1.4.4.1.2.cmml">⁢</mo><mrow id="S4.E7.m1.4.4.1.1.1" xref="S4.E7.m1.4.4.1.1.1.1.cmml"><mo id="S4.E7.m1.4.4.1.1.1.2" stretchy="false" xref="S4.E7.m1.4.4.1.1.1.1.cmml">(</mo><mrow id="S4.E7.m1.4.4.1.1.1.1" xref="S4.E7.m1.4.4.1.1.1.1.cmml"><msub id="S4.E7.m1.4.4.1.1.1.1.2" xref="S4.E7.m1.4.4.1.1.1.1.2.cmml"><mi id="S4.E7.m1.4.4.1.1.1.1.2.2" xref="S4.E7.m1.4.4.1.1.1.1.2.2.cmml">y</mi><mi id="S4.E7.m1.4.4.1.1.1.1.2.3" xref="S4.E7.m1.4.4.1.1.1.1.2.3.cmml">w</mi></msub><mo id="S4.E7.m1.4.4.1.1.1.1.1" xref="S4.E7.m1.4.4.1.1.1.1.1.cmml">∣</mo><mi id="S4.E7.m1.4.4.1.1.1.1.3" xref="S4.E7.m1.4.4.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E7.m1.4.4.1.1.1.3" stretchy="false" xref="S4.E7.m1.4.4.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S4.E7.m1.5.5.2" xref="S4.E7.m1.5.5.2.cmml"><msub id="S4.E7.m1.5.5.2.3" xref="S4.E7.m1.5.5.2.3.cmml"><mi id="S4.E7.m1.5.5.2.3.2" xref="S4.E7.m1.5.5.2.3.2.cmml">π</mi><mtext id="S4.E7.m1.5.5.2.3.3" xref="S4.E7.m1.5.5.2.3.3a.cmml">ref</mtext></msub><mo id="S4.E7.m1.5.5.2.2" xref="S4.E7.m1.5.5.2.2.cmml">⁢</mo><mrow id="S4.E7.m1.5.5.2.1.1" xref="S4.E7.m1.5.5.2.1.1.1.cmml"><mo id="S4.E7.m1.5.5.2.1.1.2" stretchy="false" xref="S4.E7.m1.5.5.2.1.1.1.cmml">(</mo><mrow id="S4.E7.m1.5.5.2.1.1.1" xref="S4.E7.m1.5.5.2.1.1.1.cmml"><msub id="S4.E7.m1.5.5.2.1.1.1.2" xref="S4.E7.m1.5.5.2.1.1.1.2.cmml"><mi id="S4.E7.m1.5.5.2.1.1.1.2.2" xref="S4.E7.m1.5.5.2.1.1.1.2.2.cmml">y</mi><mi id="S4.E7.m1.5.5.2.1.1.1.2.3" xref="S4.E7.m1.5.5.2.1.1.1.2.3.cmml">w</mi></msub><mo id="S4.E7.m1.5.5.2.1.1.1.1" xref="S4.E7.m1.5.5.2.1.1.1.1.cmml">∣</mo><mi id="S4.E7.m1.5.5.2.1.1.1.3" xref="S4.E7.m1.5.5.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E7.m1.5.5.2.1.1.3" stretchy="false" xref="S4.E7.m1.5.5.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.1.cmml">−</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.cmml"><mi id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.2" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.2.cmml">β</mi><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.1" lspace="0.167em" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.cmml"><mi id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.1" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.1.cmml">log</mi><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3a" lspace="0.167em" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.cmml">⁡</mo><mfrac id="S4.E7.m1.7.7" xref="S4.E7.m1.7.7.cmml"><mrow id="S4.E7.m1.6.6.1" xref="S4.E7.m1.6.6.1.cmml"><msub id="S4.E7.m1.6.6.1.3" xref="S4.E7.m1.6.6.1.3.cmml"><mi id="S4.E7.m1.6.6.1.3.2" xref="S4.E7.m1.6.6.1.3.2.cmml">π</mi><mi id="S4.E7.m1.6.6.1.3.3" xref="S4.E7.m1.6.6.1.3.3.cmml">θ</mi></msub><mo id="S4.E7.m1.6.6.1.2" xref="S4.E7.m1.6.6.1.2.cmml">⁢</mo><mrow id="S4.E7.m1.6.6.1.1.1" xref="S4.E7.m1.6.6.1.1.1.1.cmml"><mo id="S4.E7.m1.6.6.1.1.1.2" stretchy="false" xref="S4.E7.m1.6.6.1.1.1.1.cmml">(</mo><mrow id="S4.E7.m1.6.6.1.1.1.1" xref="S4.E7.m1.6.6.1.1.1.1.cmml"><msub id="S4.E7.m1.6.6.1.1.1.1.2" xref="S4.E7.m1.6.6.1.1.1.1.2.cmml"><mi id="S4.E7.m1.6.6.1.1.1.1.2.2" xref="S4.E7.m1.6.6.1.1.1.1.2.2.cmml">y</mi><mi id="S4.E7.m1.6.6.1.1.1.1.2.3" xref="S4.E7.m1.6.6.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S4.E7.m1.6.6.1.1.1.1.1" xref="S4.E7.m1.6.6.1.1.1.1.1.cmml">∣</mo><mi id="S4.E7.m1.6.6.1.1.1.1.3" xref="S4.E7.m1.6.6.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E7.m1.6.6.1.1.1.3" stretchy="false" xref="S4.E7.m1.6.6.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S4.E7.m1.7.7.2" xref="S4.E7.m1.7.7.2.cmml"><msub id="S4.E7.m1.7.7.2.3" xref="S4.E7.m1.7.7.2.3.cmml"><mi id="S4.E7.m1.7.7.2.3.2" xref="S4.E7.m1.7.7.2.3.2.cmml">π</mi><mtext id="S4.E7.m1.7.7.2.3.3" xref="S4.E7.m1.7.7.2.3.3a.cmml">ref</mtext></msub><mo id="S4.E7.m1.7.7.2.2" xref="S4.E7.m1.7.7.2.2.cmml">⁢</mo><mrow id="S4.E7.m1.7.7.2.1.1" xref="S4.E7.m1.7.7.2.1.1.1.cmml"><mo id="S4.E7.m1.7.7.2.1.1.2" stretchy="false" xref="S4.E7.m1.7.7.2.1.1.1.cmml">(</mo><mrow id="S4.E7.m1.7.7.2.1.1.1" xref="S4.E7.m1.7.7.2.1.1.1.cmml"><msub id="S4.E7.m1.7.7.2.1.1.1.2" xref="S4.E7.m1.7.7.2.1.1.1.2.cmml"><mi id="S4.E7.m1.7.7.2.1.1.1.2.2" xref="S4.E7.m1.7.7.2.1.1.1.2.2.cmml">y</mi><mi id="S4.E7.m1.7.7.2.1.1.1.2.3" xref="S4.E7.m1.7.7.2.1.1.1.2.3.cmml">l</mi></msub><mo id="S4.E7.m1.7.7.2.1.1.1.1" xref="S4.E7.m1.7.7.2.1.1.1.1.cmml">∣</mo><mi id="S4.E7.m1.7.7.2.1.1.1.3" xref="S4.E7.m1.7.7.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.E7.m1.7.7.2.1.1.3" stretchy="false" xref="S4.E7.m1.7.7.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.3" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.E7.m1.8.8.1.1.3.1.1.1.3" xref="S4.E7.m1.8.8.1.1.3.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><mo id="S4.E7.m1.8.8.1.2" lspace="0em" xref="S4.E7.m1.8.8.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.E7.m1.8b"><apply id="S4.E7.m1.8.8.1.1.cmml" xref="S4.E7.m1.8.8.1"><eq id="S4.E7.m1.8.8.1.1.4.cmml" xref="S4.E7.m1.8.8.1.1.4"></eq><apply id="S4.E7.m1.8.8.1.1.2.cmml" xref="S4.E7.m1.8.8.1.1.2"><times id="S4.E7.m1.8.8.1.1.2.3.cmml" xref="S4.E7.m1.8.8.1.1.2.3"></times><apply id="S4.E7.m1.8.8.1.1.2.4.cmml" xref="S4.E7.m1.8.8.1.1.2.4"><csymbol cd="ambiguous" id="S4.E7.m1.8.8.1.1.2.4.1.cmml" xref="S4.E7.m1.8.8.1.1.2.4">subscript</csymbol><ci id="S4.E7.m1.8.8.1.1.2.4.2.cmml" xref="S4.E7.m1.8.8.1.1.2.4.2">ℒ</ci><ci id="S4.E7.m1.8.8.1.1.2.4.3a.cmml" xref="S4.E7.m1.8.8.1.1.2.4.3"><mtext id="S4.E7.m1.8.8.1.1.2.4.3.cmml" mathsize="70%" xref="S4.E7.m1.8.8.1.1.2.4.3">DPO</mtext></ci></apply><list id="S4.E7.m1.8.8.1.1.2.2.3.cmml" xref="S4.E7.m1.8.8.1.1.2.2.2"><apply id="S4.E7.m1.8.8.1.1.1.1.1.1.cmml" xref="S4.E7.m1.8.8.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.8.8.1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.8.8.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E7.m1.8.8.1.1.1.1.1.1.2.cmml" xref="S4.E7.m1.8.8.1.1.1.1.1.1.2">𝜋</ci><ci id="S4.E7.m1.8.8.1.1.1.1.1.1.3.cmml" xref="S4.E7.m1.8.8.1.1.1.1.1.1.3">𝜃</ci></apply><apply id="S4.E7.m1.8.8.1.1.2.2.2.2.cmml" xref="S4.E7.m1.8.8.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.8.8.1.1.2.2.2.2.1.cmml" xref="S4.E7.m1.8.8.1.1.2.2.2.2">subscript</csymbol><ci id="S4.E7.m1.8.8.1.1.2.2.2.2.2.cmml" xref="S4.E7.m1.8.8.1.1.2.2.2.2.2">𝜋</ci><ci id="S4.E7.m1.8.8.1.1.2.2.2.2.3a.cmml" xref="S4.E7.m1.8.8.1.1.2.2.2.2.3"><mtext id="S4.E7.m1.8.8.1.1.2.2.2.2.3.cmml" mathsize="70%" xref="S4.E7.m1.8.8.1.1.2.2.2.2.3">ref</mtext></ci></apply></list></apply><apply id="S4.E7.m1.8.8.1.1.3.cmml" xref="S4.E7.m1.8.8.1.1.3"><minus id="S4.E7.m1.8.8.1.1.3.2.cmml" xref="S4.E7.m1.8.8.1.1.3"></minus><apply id="S4.E7.m1.8.8.1.1.3.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1"><times id="S4.E7.m1.8.8.1.1.3.1.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.2"></times><apply id="S4.E7.m1.8.8.1.1.3.1.3.cmml" xref="S4.E7.m1.8.8.1.1.3.1.3"><csymbol cd="ambiguous" id="S4.E7.m1.8.8.1.1.3.1.3.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.3">subscript</csymbol><ci id="S4.E7.m1.8.8.1.1.3.1.3.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.3.2">𝔼</ci><apply id="S4.E7.m1.3.3.3.cmml" xref="S4.E7.m1.3.3.3"><csymbol cd="latexml" id="S4.E7.m1.3.3.3.4.cmml" xref="S4.E7.m1.3.3.3.4">similar-to</csymbol><vector id="S4.E7.m1.3.3.3.3.3.cmml" xref="S4.E7.m1.3.3.3.3.2"><ci id="S4.E7.m1.1.1.1.1.cmml" xref="S4.E7.m1.1.1.1.1">𝑥</ci><apply id="S4.E7.m1.2.2.2.2.1.1.cmml" xref="S4.E7.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.E7.m1.2.2.2.2.1.1.1.cmml" xref="S4.E7.m1.2.2.2.2.1.1">subscript</csymbol><ci id="S4.E7.m1.2.2.2.2.1.1.2.cmml" xref="S4.E7.m1.2.2.2.2.1.1.2">𝑦</ci><ci id="S4.E7.m1.2.2.2.2.1.1.3.cmml" xref="S4.E7.m1.2.2.2.2.1.1.3">𝑤</ci></apply><apply id="S4.E7.m1.3.3.3.3.2.2.cmml" xref="S4.E7.m1.3.3.3.3.2.2"><csymbol cd="ambiguous" id="S4.E7.m1.3.3.3.3.2.2.1.cmml" xref="S4.E7.m1.3.3.3.3.2.2">subscript</csymbol><ci id="S4.E7.m1.3.3.3.3.2.2.2.cmml" xref="S4.E7.m1.3.3.3.3.2.2.2">𝑦</ci><ci id="S4.E7.m1.3.3.3.3.2.2.3.cmml" xref="S4.E7.m1.3.3.3.3.2.2.3">𝑙</ci></apply></vector><ci id="S4.E7.m1.3.3.3.5.cmml" xref="S4.E7.m1.3.3.3.5">𝒟</ci></apply></apply><apply id="S4.E7.m1.8.8.1.1.3.1.1.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1"><csymbol cd="latexml" id="S4.E7.m1.8.8.1.1.3.1.1.2.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.2">delimited-[]</csymbol><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1"><times id="S4.E7.m1.8.8.1.1.3.1.1.1.1.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.2"></times><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3"><log id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.1"></log><ci id="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.3.2">𝜎</ci></apply><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1"><minus id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.1"></minus><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2"><times id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.1"></times><ci id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.2">𝛽</ci><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3"><log id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.2.3.1"></log><apply id="S4.E7.m1.5.5.cmml" xref="S4.E7.m1.5.5"><divide id="S4.E7.m1.5.5.3.cmml" xref="S4.E7.m1.5.5"></divide><apply id="S4.E7.m1.4.4.1.cmml" xref="S4.E7.m1.4.4.1"><times id="S4.E7.m1.4.4.1.2.cmml" xref="S4.E7.m1.4.4.1.2"></times><apply id="S4.E7.m1.4.4.1.3.cmml" xref="S4.E7.m1.4.4.1.3"><csymbol cd="ambiguous" id="S4.E7.m1.4.4.1.3.1.cmml" xref="S4.E7.m1.4.4.1.3">subscript</csymbol><ci id="S4.E7.m1.4.4.1.3.2.cmml" xref="S4.E7.m1.4.4.1.3.2">𝜋</ci><ci id="S4.E7.m1.4.4.1.3.3.cmml" xref="S4.E7.m1.4.4.1.3.3">𝜃</ci></apply><apply id="S4.E7.m1.4.4.1.1.1.1.cmml" xref="S4.E7.m1.4.4.1.1.1"><csymbol cd="latexml" id="S4.E7.m1.4.4.1.1.1.1.1.cmml" xref="S4.E7.m1.4.4.1.1.1.1.1">conditional</csymbol><apply id="S4.E7.m1.4.4.1.1.1.1.2.cmml" xref="S4.E7.m1.4.4.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.E7.m1.4.4.1.1.1.1.2.1.cmml" xref="S4.E7.m1.4.4.1.1.1.1.2">subscript</csymbol><ci id="S4.E7.m1.4.4.1.1.1.1.2.2.cmml" xref="S4.E7.m1.4.4.1.1.1.1.2.2">𝑦</ci><ci id="S4.E7.m1.4.4.1.1.1.1.2.3.cmml" xref="S4.E7.m1.4.4.1.1.1.1.2.3">𝑤</ci></apply><ci id="S4.E7.m1.4.4.1.1.1.1.3.cmml" xref="S4.E7.m1.4.4.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.E7.m1.5.5.2.cmml" xref="S4.E7.m1.5.5.2"><times id="S4.E7.m1.5.5.2.2.cmml" xref="S4.E7.m1.5.5.2.2"></times><apply id="S4.E7.m1.5.5.2.3.cmml" xref="S4.E7.m1.5.5.2.3"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.3.1.cmml" xref="S4.E7.m1.5.5.2.3">subscript</csymbol><ci id="S4.E7.m1.5.5.2.3.2.cmml" xref="S4.E7.m1.5.5.2.3.2">𝜋</ci><ci id="S4.E7.m1.5.5.2.3.3a.cmml" xref="S4.E7.m1.5.5.2.3.3"><mtext id="S4.E7.m1.5.5.2.3.3.cmml" mathsize="70%" xref="S4.E7.m1.5.5.2.3.3">ref</mtext></ci></apply><apply id="S4.E7.m1.5.5.2.1.1.1.cmml" xref="S4.E7.m1.5.5.2.1.1"><csymbol cd="latexml" id="S4.E7.m1.5.5.2.1.1.1.1.cmml" xref="S4.E7.m1.5.5.2.1.1.1.1">conditional</csymbol><apply id="S4.E7.m1.5.5.2.1.1.1.2.cmml" xref="S4.E7.m1.5.5.2.1.1.1.2"><csymbol cd="ambiguous" id="S4.E7.m1.5.5.2.1.1.1.2.1.cmml" xref="S4.E7.m1.5.5.2.1.1.1.2">subscript</csymbol><ci id="S4.E7.m1.5.5.2.1.1.1.2.2.cmml" xref="S4.E7.m1.5.5.2.1.1.1.2.2">𝑦</ci><ci id="S4.E7.m1.5.5.2.1.1.1.2.3.cmml" xref="S4.E7.m1.5.5.2.1.1.1.2.3">𝑤</ci></apply><ci id="S4.E7.m1.5.5.2.1.1.1.3.cmml" xref="S4.E7.m1.5.5.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3"><times id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.1"></times><ci id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.2.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.2">𝛽</ci><apply id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3"><log id="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.1.cmml" xref="S4.E7.m1.8.8.1.1.3.1.1.1.1.1.1.1.3.3.1"></log><apply id="S4.E7.m1.7.7.cmml" xref="S4.E7.m1.7.7"><divide id="S4.E7.m1.7.7.3.cmml" xref="S4.E7.m1.7.7"></divide><apply id="S4.E7.m1.6.6.1.cmml" xref="S4.E7.m1.6.6.1"><times id="S4.E7.m1.6.6.1.2.cmml" xref="S4.E7.m1.6.6.1.2"></times><apply id="S4.E7.m1.6.6.1.3.cmml" xref="S4.E7.m1.6.6.1.3"><csymbol cd="ambiguous" id="S4.E7.m1.6.6.1.3.1.cmml" xref="S4.E7.m1.6.6.1.3">subscript</csymbol><ci id="S4.E7.m1.6.6.1.3.2.cmml" xref="S4.E7.m1.6.6.1.3.2">𝜋</ci><ci id="S4.E7.m1.6.6.1.3.3.cmml" xref="S4.E7.m1.6.6.1.3.3">𝜃</ci></apply><apply id="S4.E7.m1.6.6.1.1.1.1.cmml" xref="S4.E7.m1.6.6.1.1.1"><csymbol cd="latexml" id="S4.E7.m1.6.6.1.1.1.1.1.cmml" xref="S4.E7.m1.6.6.1.1.1.1.1">conditional</csymbol><apply id="S4.E7.m1.6.6.1.1.1.1.2.cmml" xref="S4.E7.m1.6.6.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.E7.m1.6.6.1.1.1.1.2.1.cmml" xref="S4.E7.m1.6.6.1.1.1.1.2">subscript</csymbol><ci id="S4.E7.m1.6.6.1.1.1.1.2.2.cmml" xref="S4.E7.m1.6.6.1.1.1.1.2.2">𝑦</ci><ci id="S4.E7.m1.6.6.1.1.1.1.2.3.cmml" xref="S4.E7.m1.6.6.1.1.1.1.2.3">𝑙</ci></apply><ci id="S4.E7.m1.6.6.1.1.1.1.3.cmml" xref="S4.E7.m1.6.6.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.E7.m1.7.7.2.cmml" xref="S4.E7.m1.7.7.2"><times id="S4.E7.m1.7.7.2.2.cmml" xref="S4.E7.m1.7.7.2.2"></times><apply id="S4.E7.m1.7.7.2.3.cmml" xref="S4.E7.m1.7.7.2.3"><csymbol cd="ambiguous" id="S4.E7.m1.7.7.2.3.1.cmml" xref="S4.E7.m1.7.7.2.3">subscript</csymbol><ci id="S4.E7.m1.7.7.2.3.2.cmml" xref="S4.E7.m1.7.7.2.3.2">𝜋</ci><ci id="S4.E7.m1.7.7.2.3.3a.cmml" xref="S4.E7.m1.7.7.2.3.3"><mtext id="S4.E7.m1.7.7.2.3.3.cmml" mathsize="70%" xref="S4.E7.m1.7.7.2.3.3">ref</mtext></ci></apply><apply id="S4.E7.m1.7.7.2.1.1.1.cmml" xref="S4.E7.m1.7.7.2.1.1"><csymbol cd="latexml" id="S4.E7.m1.7.7.2.1.1.1.1.cmml" xref="S4.E7.m1.7.7.2.1.1.1.1">conditional</csymbol><apply id="S4.E7.m1.7.7.2.1.1.1.2.cmml" xref="S4.E7.m1.7.7.2.1.1.1.2"><csymbol cd="ambiguous" id="S4.E7.m1.7.7.2.1.1.1.2.1.cmml" xref="S4.E7.m1.7.7.2.1.1.1.2">subscript</csymbol><ci id="S4.E7.m1.7.7.2.1.1.1.2.2.cmml" xref="S4.E7.m1.7.7.2.1.1.1.2.2">𝑦</ci><ci id="S4.E7.m1.7.7.2.1.1.1.2.3.cmml" xref="S4.E7.m1.7.7.2.1.1.1.2.3">𝑙</ci></apply><ci id="S4.E7.m1.7.7.2.1.1.1.3.cmml" xref="S4.E7.m1.7.7.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E7.m1.8c">\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=-\mathbb{E}_{(x,y_{w},%
y_{l})\sim\mathcal{D}}\left[\log\sigma\left(\beta\log\frac{\pi_{\theta}(y_{w}%
\mid x)}{\pi_{\text{ref}}(y_{w}\mid x)}-\beta\log\frac{\pi_{\theta}(y_{l}\mid x%
)}{\pi_{\text{ref}}(y_{l}\mid x)}\right)\right].</annotation><annotation encoding="application/x-llamapun" id="S4.E7.m1.8d">caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) = - blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT [ roman_log italic_σ ( italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_x ) end_ARG ) ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.p3.2">This way, we fit an implicit reward using an alternative parameterization, whose optimal policy is simply <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S4.p3.2.m1.1"><semantics id="S4.p3.2.m1.1a"><msub id="S4.p3.2.m1.1.1" xref="S4.p3.2.m1.1.1.cmml"><mi id="S4.p3.2.m1.1.1.2" xref="S4.p3.2.m1.1.1.2.cmml">π</mi><mi id="S4.p3.2.m1.1.1.3" xref="S4.p3.2.m1.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p3.2.m1.1b"><apply id="S4.p3.2.m1.1.1.cmml" xref="S4.p3.2.m1.1.1"><csymbol cd="ambiguous" id="S4.p3.2.m1.1.1.1.cmml" xref="S4.p3.2.m1.1.1">subscript</csymbol><ci id="S4.p3.2.m1.1.1.2.cmml" xref="S4.p3.2.m1.1.1.2">𝜋</ci><ci id="S4.p3.2.m1.1.1.3.cmml" xref="S4.p3.2.m1.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p3.2.m1.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S4.p3.2.m1.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math>. Moreover, since our procedure is equivalent to fitting a reparametrized Bradley-Terry model, it enjoys certain theoretical properties, such as consistencies under suitable assumption of the preference data distribution <cite class="ltx_cite ltx_citemacro_cite">Bong and Rinaldo (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib4" title="">2022</a>)</cite>. In Section&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5" title="5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a>, we further discuss theoretical properties of DPO in relation to other works.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S4.p4">
<p class="ltx_p" id="S4.p4.2"><span class="ltx_text ltx_font_bold" id="S4.p4.2.1">What does the DPO update do?</span> For a mechanistic understanding of DPO, it is useful to analyze the gradient of the loss function <math alttext="\mathcal{L}_{\text{DPO}}" class="ltx_Math" display="inline" id="S4.p4.1.m1.1"><semantics id="S4.p4.1.m1.1a"><msub id="S4.p4.1.m1.1.1" xref="S4.p4.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.p4.1.m1.1.1.2" xref="S4.p4.1.m1.1.1.2.cmml">ℒ</mi><mtext id="S4.p4.1.m1.1.1.3" xref="S4.p4.1.m1.1.1.3a.cmml">DPO</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p4.1.m1.1b"><apply id="S4.p4.1.m1.1.1.cmml" xref="S4.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S4.p4.1.m1.1.1.1.cmml" xref="S4.p4.1.m1.1.1">subscript</csymbol><ci id="S4.p4.1.m1.1.1.2.cmml" xref="S4.p4.1.m1.1.1.2">ℒ</ci><ci id="S4.p4.1.m1.1.1.3a.cmml" xref="S4.p4.1.m1.1.1.3"><mtext id="S4.p4.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.p4.1.m1.1.1.3">DPO</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.1.m1.1c">\mathcal{L}_{\text{DPO}}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.1.m1.1d">caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT</annotation></semantics></math>. The gradient with respect to the parameters <math alttext="\theta" class="ltx_Math" display="inline" id="S4.p4.2.m2.1"><semantics id="S4.p4.2.m2.1a"><mi id="S4.p4.2.m2.1.1" xref="S4.p4.2.m2.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S4.p4.2.m2.1b"><ci id="S4.p4.2.m2.1.1.cmml" xref="S4.p4.2.m2.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.2.m2.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S4.p4.2.m2.1d">italic_θ</annotation></semantics></math> can be written as:
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S4.p4.3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=\\
-\beta\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\bigg{[}\underbrace{\sigma(%
\hat{r}_{\theta}(x,y_{l})-\hat{r}_{\theta}(x,y_{w}))}_{\text{higher weight %
when reward estimate is wrong}}\bigg{[}\underbrace{\nabla_{\theta}\log\pi(y_{w%
}\mid x)}_{\text{increase likelihood of $y_{w}$}}-\underbrace{\nabla_{\theta}%
\log\pi(y_{l}\mid x)}_{\text{decrease likelihood of $y_{l}$}}\bigg{]}\bigg{]}," class="ltx_Math" display="block" id="S4.p4.3.m1.32"><semantics id="S4.p4.3.m1.32a"><mtable displaystyle="true" id="S4.p4.3.m1.32.32.4" rowspacing="0pt"><mtr id="S4.p4.3.m1.32.32.4a"><mtd class="ltx_align_left" columnalign="left" id="S4.p4.3.m1.32.32.4b"><mrow id="S4.p4.3.m1.31.31.3.30.14.14"><mrow id="S4.p4.3.m1.31.31.3.30.14.14.14"><mrow id="S4.p4.3.m1.31.31.3.30.14.14.14.4"><msub id="S4.p4.3.m1.31.31.3.30.14.14.14.4.1"><mo id="S4.p4.3.m1.3.3.3.1.1.1" xref="S4.p4.3.m1.3.3.3.1.1.1.cmml">∇</mo><mi id="S4.p4.3.m1.4.4.4.2.2.2.1" xref="S4.p4.3.m1.4.4.4.2.2.2.1.cmml">θ</mi></msub><msub id="S4.p4.3.m1.31.31.3.30.14.14.14.4.2"><mi class="ltx_font_mathcaligraphic" id="S4.p4.3.m1.5.5.5.3.3.3" xref="S4.p4.3.m1.5.5.5.3.3.3.cmml">ℒ</mi><mtext id="S4.p4.3.m1.6.6.6.4.4.4.1" xref="S4.p4.3.m1.6.6.6.4.4.4.1a.cmml">DPO</mtext></msub></mrow><mo id="S4.p4.3.m1.31.31.3.30.14.14.14.3" xref="S4.p4.3.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S4.p4.3.m1.31.31.3.30.14.14.14.2.2"><mo id="S4.p4.3.m1.7.7.7.5.5.5" stretchy="false" xref="S4.p4.3.m1.29.29.1.1.1.cmml">(</mo><msub id="S4.p4.3.m1.30.30.2.29.13.13.13.1.1.1"><mi id="S4.p4.3.m1.8.8.8.6.6.6" xref="S4.p4.3.m1.8.8.8.6.6.6.cmml">π</mi><mi id="S4.p4.3.m1.9.9.9.7.7.7.1" xref="S4.p4.3.m1.9.9.9.7.7.7.1.cmml">θ</mi></msub><mo id="S4.p4.3.m1.10.10.10.8.8.8" xref="S4.p4.3.m1.29.29.1.1.1.cmml">;</mo><msub id="S4.p4.3.m1.31.31.3.30.14.14.14.2.2.2"><mi id="S4.p4.3.m1.11.11.11.9.9.9" xref="S4.p4.3.m1.11.11.11.9.9.9.cmml">π</mi><mtext id="S4.p4.3.m1.12.12.12.10.10.10.1" xref="S4.p4.3.m1.12.12.12.10.10.10.1a.cmml">ref</mtext></msub><mo id="S4.p4.3.m1.13.13.13.11.11.11" stretchy="false" xref="S4.p4.3.m1.29.29.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.p4.3.m1.14.14.14.12.12.12" xref="S4.p4.3.m1.14.14.14.12.12.12.cmml">=</mo><mi id="S4.p4.3.m1.31.31.3.30.14.14.15" xref="S4.p4.3.m1.29.29.1.1.1.cmml"></mi></mrow></mtd></mtr><mtr id="S4.p4.3.m1.32.32.4c"><mtd class="ltx_align_right" columnalign="right" id="S4.p4.3.m1.32.32.4d"><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17"><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17.1"><mo id="S4.p4.3.m1.32.32.4.31.17.17.17.1a" xref="S4.p4.3.m1.29.29.1.1.1.cmml">−</mo><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1"><mi id="S4.p4.3.m1.16.16.16.4.4.4" xref="S4.p4.3.m1.16.16.16.4.4.4.cmml">β</mi><mo id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.2" xref="S4.p4.3.m1.29.29.1.1.1.cmml">⁢</mo><msub id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.3"><mi id="S4.p4.3.m1.17.17.17.5.5.5" xref="S4.p4.3.m1.17.17.17.5.5.5.cmml">𝔼</mi><mrow id="S4.p4.3.m1.18.18.18.6.6.6.1" xref="S4.p4.3.m1.18.18.18.6.6.6.1.cmml"><mrow id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.3.cmml"><mo id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.3" stretchy="false" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.3.cmml">(</mo><mi id="S4.p4.3.m1.18.18.18.6.6.6.1.1" xref="S4.p4.3.m1.18.18.18.6.6.6.1.1.cmml">x</mi><mo id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.4" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.3.cmml">,</mo><msub id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.cmml"><mi id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.2" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.2.cmml">y</mi><mi id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.3" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.3.cmml">w</mi></msub><mo id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.5" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.3.cmml">,</mo><msub id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.cmml"><mi id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.2" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.2.cmml">y</mi><mi id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.3" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.3.cmml">l</mi></msub><mo id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.6" stretchy="false" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.3.cmml">)</mo></mrow><mo id="S4.p4.3.m1.18.18.18.6.6.6.1.4" xref="S4.p4.3.m1.18.18.18.6.6.6.1.4.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S4.p4.3.m1.18.18.18.6.6.6.1.5" xref="S4.p4.3.m1.18.18.18.6.6.6.1.5.cmml">𝒟</mi></mrow></msub><mo id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.2a" xref="S4.p4.3.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1"><mo id="S4.p4.3.m1.19.19.19.7.7.7" maxsize="210%" minsize="210%" xref="S4.p4.3.m1.29.29.1.1.1.cmml">[</mo><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1"><munder id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1.3"><munder accentunder="true" id="S4.p4.3.m1.20.20.20.8.8.8" xref="S4.p4.3.m1.20.20.20.8.8.8.cmml"><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.cmml"><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.5" xref="S4.p4.3.m1.20.20.20.8.8.8.3.5.cmml">σ</mi><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.4" xref="S4.p4.3.m1.20.20.20.8.8.8.3.4.cmml">⁢</mo><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.cmml"><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.2" stretchy="false" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.cmml">(</mo><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.cmml"><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.cmml"><msub id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.cmml"><mover accent="true" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.cmml"><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.2.cmml">r</mi><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.1.cmml">^</mo></mover><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.3.cmml">θ</mi></msub><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.2.cmml">⁢</mo><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.2.cmml"><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.2" stretchy="false" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.2.cmml">(</mo><mi id="S4.p4.3.m1.20.20.20.8.8.8.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.1.1.cmml">x</mi><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.2.cmml">,</mo><msub id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.cmml"><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.2.cmml">y</mi><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.3.cmml">l</mi></msub><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.4" stretchy="false" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.3.cmml">−</mo><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.cmml"><msub id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.cmml"><mover accent="true" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.cmml"><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.2.cmml">r</mi><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.1.cmml">^</mo></mover><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.3.cmml">θ</mi></msub><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.2.cmml">⁢</mo><mrow id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.2.cmml"><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.2" stretchy="false" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.2.cmml">(</mo><mi id="S4.p4.3.m1.20.20.20.8.8.8.2.2" xref="S4.p4.3.m1.20.20.20.8.8.8.2.2.cmml">x</mi><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.2.cmml">,</mo><msub id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.cmml"><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.2" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.2.cmml">y</mi><mi id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.3" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.3.cmml">w</mi></msub><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.4" stretchy="false" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.3" stretchy="false" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.cmml">)</mo></mrow></mrow><mo id="S4.p4.3.m1.20.20.20.8.8.8.4" xref="S4.p4.3.m1.20.20.20.8.8.8.4.cmml">⏟</mo></munder><mtext id="S4.p4.3.m1.21.21.21.9.9.9.1" xref="S4.p4.3.m1.21.21.21.9.9.9.1a.cmml">higher weight when reward estimate is wrong</mtext></munder><mo id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1.2" xref="S4.p4.3.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1.1.1"><mo id="S4.p4.3.m1.22.22.22.10.10.10" maxsize="210%" minsize="210%" xref="S4.p4.3.m1.29.29.1.1.1.cmml">[</mo><mrow id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1.1.1.1"><munder id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1.1.1.1.1"><munder accentunder="true" id="S4.p4.3.m1.23.23.23.11.11.11" xref="S4.p4.3.m1.23.23.23.11.11.11.cmml"><mrow id="S4.p4.3.m1.23.23.23.11.11.11.1" xref="S4.p4.3.m1.23.23.23.11.11.11.1.cmml"><mrow id="S4.p4.3.m1.23.23.23.11.11.11.1.3" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.cmml"><mrow id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.cmml"><msub id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.cmml"><mo id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.2" rspace="0.167em" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.2.cmml">∇</mo><mi id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.3" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.3.cmml">θ</mi></msub><mi id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.2" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.2.cmml">log</mi></mrow><mo id="S4.p4.3.m1.23.23.23.11.11.11.1.3a" lspace="0.167em" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.cmml">⁡</mo><mi id="S4.p4.3.m1.23.23.23.11.11.11.1.3.2" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.2.cmml">π</mi></mrow><mo id="S4.p4.3.m1.23.23.23.11.11.11.1.2" xref="S4.p4.3.m1.23.23.23.11.11.11.1.2.cmml">⁢</mo><mrow id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.cmml"><mo id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.2" stretchy="false" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.cmml">(</mo><mrow id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.cmml"><msub id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.cmml"><mi id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.2" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.2.cmml">y</mi><mi id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.3" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.3.cmml">w</mi></msub><mo id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.1" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.1.cmml">∣</mo><mi id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.3" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.3" stretchy="false" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.p4.3.m1.23.23.23.11.11.11.2" xref="S4.p4.3.m1.23.23.23.11.11.11.2.cmml">⏟</mo></munder><mrow id="S4.p4.3.m1.1.1.1.1.1.1.1" xref="S4.p4.3.m1.1.1.1.1.1.1.1b.cmml"><mtext id="S4.p4.3.m1.1.1.1.1.1.1.1a" xref="S4.p4.3.m1.1.1.1.1.1.1.1b.cmml">increase likelihood of&nbsp;</mtext><msub id="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1" xref="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml"><mi id="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.2" xref="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.2.cmml">y</mi><mi id="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.3" mathsize="98%" xref="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.3.cmml">w</mi></msub></mrow></munder><mo id="S4.p4.3.m1.24.24.24.12.12.12" xref="S4.p4.3.m1.24.24.24.12.12.12.cmml">−</mo><munder id="S4.p4.3.m1.32.32.4.31.17.17.17.1.1.1.1.1.1.1.1.2"><munder accentunder="true" id="S4.p4.3.m1.25.25.25.13.13.13" xref="S4.p4.3.m1.25.25.25.13.13.13.cmml"><mrow id="S4.p4.3.m1.25.25.25.13.13.13.1" xref="S4.p4.3.m1.25.25.25.13.13.13.1.cmml"><mrow id="S4.p4.3.m1.25.25.25.13.13.13.1.3" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.cmml"><mrow id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.cmml"><msub id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.cmml"><mo id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.2" rspace="0.167em" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.2.cmml">∇</mo><mi id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.3" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.3.cmml">θ</mi></msub><mi id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.2" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.2.cmml">log</mi></mrow><mo id="S4.p4.3.m1.25.25.25.13.13.13.1.3a" lspace="0.167em" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.cmml">⁡</mo><mi id="S4.p4.3.m1.25.25.25.13.13.13.1.3.2" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.2.cmml">π</mi></mrow><mo id="S4.p4.3.m1.25.25.25.13.13.13.1.2" xref="S4.p4.3.m1.25.25.25.13.13.13.1.2.cmml">⁢</mo><mrow id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.cmml"><mo id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.2" stretchy="false" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.cmml">(</mo><mrow id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.cmml"><msub id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.cmml"><mi id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.2" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.2.cmml">y</mi><mi id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.3" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.1" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.1.cmml">∣</mo><mi id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.3" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.3" stretchy="false" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.p4.3.m1.25.25.25.13.13.13.2" xref="S4.p4.3.m1.25.25.25.13.13.13.2.cmml">⏟</mo></munder><mrow id="S4.p4.3.m1.2.2.2.2.2.2.1" xref="S4.p4.3.m1.2.2.2.2.2.2.1b.cmml"><mtext id="S4.p4.3.m1.2.2.2.2.2.2.1a" xref="S4.p4.3.m1.2.2.2.2.2.2.1b.cmml">decrease likelihood of&nbsp;</mtext><msub id="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1" xref="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.cmml"><mi id="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.2" xref="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.2.cmml">y</mi><mi id="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.3" mathsize="98%" xref="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.3.cmml">l</mi></msub></mrow></munder></mrow><mo id="S4.p4.3.m1.26.26.26.14.14.14" maxsize="210%" minsize="210%" xref="S4.p4.3.m1.29.29.1.1.1.cmml">]</mo></mrow></mrow><mo id="S4.p4.3.m1.27.27.27.15.15.15" maxsize="210%" minsize="210%" xref="S4.p4.3.m1.29.29.1.1.1.cmml">]</mo></mrow></mrow></mrow><mo id="S4.p4.3.m1.28.28.28.16.16.16" xref="S4.p4.3.m1.29.29.1.1.1.cmml">,</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S4.p4.3.m1.32b"><apply id="S4.p4.3.m1.29.29.1.1.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><eq id="S4.p4.3.m1.14.14.14.12.12.12.cmml" xref="S4.p4.3.m1.14.14.14.12.12.12"></eq><apply id="S4.p4.3.m1.29.29.1.1.1.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><times id="S4.p4.3.m1.29.29.1.1.1.2.3.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"></times><apply id="S4.p4.3.m1.29.29.1.1.1.2.4.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><apply id="S4.p4.3.m1.29.29.1.1.1.2.4.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.2.4.1.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><ci id="S4.p4.3.m1.3.3.3.1.1.1.cmml" xref="S4.p4.3.m1.3.3.3.1.1.1">∇</ci><ci id="S4.p4.3.m1.4.4.4.2.2.2.1.cmml" xref="S4.p4.3.m1.4.4.4.2.2.2.1">𝜃</ci></apply><apply id="S4.p4.3.m1.29.29.1.1.1.2.4.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.2.4.2.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><ci id="S4.p4.3.m1.5.5.5.3.3.3.cmml" xref="S4.p4.3.m1.5.5.5.3.3.3">ℒ</ci><ci id="S4.p4.3.m1.6.6.6.4.4.4.1a.cmml" xref="S4.p4.3.m1.6.6.6.4.4.4.1"><mtext id="S4.p4.3.m1.6.6.6.4.4.4.1.cmml" mathsize="70%" xref="S4.p4.3.m1.6.6.6.4.4.4.1">DPO</mtext></ci></apply></apply><list id="S4.p4.3.m1.29.29.1.1.1.2.2.3.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><apply id="S4.p4.3.m1.29.29.1.1.1.1.1.1.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.1.1.1.1.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><ci id="S4.p4.3.m1.8.8.8.6.6.6.cmml" xref="S4.p4.3.m1.8.8.8.6.6.6">𝜋</ci><ci id="S4.p4.3.m1.9.9.9.7.7.7.1.cmml" xref="S4.p4.3.m1.9.9.9.7.7.7.1">𝜃</ci></apply><apply id="S4.p4.3.m1.29.29.1.1.1.2.2.2.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.2.2.2.2.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><ci id="S4.p4.3.m1.11.11.11.9.9.9.cmml" xref="S4.p4.3.m1.11.11.11.9.9.9">𝜋</ci><ci id="S4.p4.3.m1.12.12.12.10.10.10.1a.cmml" xref="S4.p4.3.m1.12.12.12.10.10.10.1"><mtext id="S4.p4.3.m1.12.12.12.10.10.10.1.cmml" mathsize="70%" xref="S4.p4.3.m1.12.12.12.10.10.10.1">ref</mtext></ci></apply></list></apply><apply id="S4.p4.3.m1.29.29.1.1.1.3.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><minus id="S4.p4.3.m1.15.15.15.3.3.3.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"></minus><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><times id="S4.p4.3.m1.29.29.1.1.1.3.1.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"></times><ci id="S4.p4.3.m1.16.16.16.4.4.4.cmml" xref="S4.p4.3.m1.16.16.16.4.4.4">𝛽</ci><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.4.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.3.1.4.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><ci id="S4.p4.3.m1.17.17.17.5.5.5.cmml" xref="S4.p4.3.m1.17.17.17.5.5.5">𝔼</ci><apply id="S4.p4.3.m1.18.18.18.6.6.6.1.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1"><csymbol cd="latexml" id="S4.p4.3.m1.18.18.18.6.6.6.1.4.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.4">similar-to</csymbol><vector id="S4.p4.3.m1.18.18.18.6.6.6.1.3.3.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2"><ci id="S4.p4.3.m1.18.18.18.6.6.6.1.1.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.1">𝑥</ci><apply id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1"><csymbol cd="ambiguous" id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.1.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1">subscript</csymbol><ci id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.2.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.2">𝑦</ci><ci id="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.3.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.2.1.1.3">𝑤</ci></apply><apply id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2"><csymbol cd="ambiguous" id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.1.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2">subscript</csymbol><ci id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.2.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.2">𝑦</ci><ci id="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.3.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.3.2.2.3">𝑙</ci></apply></vector><ci id="S4.p4.3.m1.18.18.18.6.6.6.1.5.cmml" xref="S4.p4.3.m1.18.18.18.6.6.6.1.5">𝒟</ci></apply></apply><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="latexml" id="S4.p4.3.m1.29.29.1.1.1.3.1.1.2.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">delimited-[]</csymbol><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><times id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"></times><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.3.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.3.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><apply id="S4.p4.3.m1.20.20.20.8.8.8.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8"><ci id="S4.p4.3.m1.20.20.20.8.8.8.4.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.4">⏟</ci><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3"><times id="S4.p4.3.m1.20.20.20.8.8.8.3.4.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.4"></times><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.5.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.5">𝜎</ci><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1"><minus id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.3"></minus><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1"><times id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.2"></times><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3">subscript</csymbol><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2"><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.1">^</ci><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.2.2">𝑟</ci></apply><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.3.3">𝜃</ci></apply><interval closure="open" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1"><ci id="S4.p4.3.m1.20.20.20.8.8.8.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.1.1">𝑥</ci><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1">subscript</csymbol><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.2">𝑦</ci><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.1.1.1.1.3">𝑙</ci></apply></interval></apply><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2"><times id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.2"></times><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3">subscript</csymbol><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2"><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.1">^</ci><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.2.2">𝑟</ci></apply><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.3.3">𝜃</ci></apply><interval closure="open" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1"><ci id="S4.p4.3.m1.20.20.20.8.8.8.2.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.2.2">𝑥</ci><apply id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1"><csymbol cd="ambiguous" id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.1.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1">subscript</csymbol><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.2.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.2">𝑦</ci><ci id="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.3.cmml" xref="S4.p4.3.m1.20.20.20.8.8.8.3.3.1.1.2.1.1.1.3">𝑤</ci></apply></interval></apply></apply></apply></apply><ci id="S4.p4.3.m1.21.21.21.9.9.9.1a.cmml" xref="S4.p4.3.m1.21.21.21.9.9.9.1"><mtext id="S4.p4.3.m1.21.21.21.9.9.9.1.cmml" mathsize="70%" xref="S4.p4.3.m1.21.21.21.9.9.9.1">higher weight when reward estimate is wrong</mtext></ci></apply><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="latexml" id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.2.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">delimited-[]</csymbol><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.1.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><minus id="S4.p4.3.m1.24.24.24.12.12.12.cmml" xref="S4.p4.3.m1.24.24.24.12.12.12"></minus><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.1.1.2.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.1.1.2.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><apply id="S4.p4.3.m1.23.23.23.11.11.11.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11"><ci id="S4.p4.3.m1.23.23.23.11.11.11.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.2">⏟</ci><apply id="S4.p4.3.m1.23.23.23.11.11.11.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1"><times id="S4.p4.3.m1.23.23.23.11.11.11.1.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.2"></times><apply id="S4.p4.3.m1.23.23.23.11.11.11.1.3.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3"><apply id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1"><apply id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1"><csymbol cd="ambiguous" id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1">subscript</csymbol><ci id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.2">∇</ci><ci id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.3.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.1.3">𝜃</ci></apply><log id="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.1.2"></log></apply><ci id="S4.p4.3.m1.23.23.23.11.11.11.1.3.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.3.2">𝜋</ci></apply><apply id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1"><csymbol cd="latexml" id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.1">conditional</csymbol><apply id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.1.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2">subscript</csymbol><ci id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.2.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.2">𝑦</ci><ci id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.3.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.2.3">𝑤</ci></apply><ci id="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.3.cmml" xref="S4.p4.3.m1.23.23.23.11.11.11.1.1.1.1.3">𝑥</ci></apply></apply></apply><ci id="S4.p4.3.m1.1.1.1.1.1.1.1b.cmml" xref="S4.p4.3.m1.1.1.1.1.1.1.1"><mrow id="S4.p4.3.m1.1.1.1.1.1.1.1.cmml" xref="S4.p4.3.m1.1.1.1.1.1.1.1"><mtext id="S4.p4.3.m1.1.1.1.1.1.1.1a.cmml" mathsize="70%" xref="S4.p4.3.m1.1.1.1.1.1.1.1">increase likelihood of&nbsp;</mtext><msub id="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1"><mi id="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.2.cmml" mathsize="70%" xref="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.2">y</mi><mi id="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.p4.3.m1.1.1.1.1.1.1.1.1.1.m1.1.1.3">w</mi></msub></mrow></ci></apply><apply id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.1.1.3.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3"><csymbol cd="ambiguous" id="S4.p4.3.m1.29.29.1.1.1.3.1.1.1.1.1.1.1.3.1.cmml" xref="S4.p4.3.m1.31.31.3.30.14.14.14.3">subscript</csymbol><apply id="S4.p4.3.m1.25.25.25.13.13.13.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13"><ci id="S4.p4.3.m1.25.25.25.13.13.13.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.2">⏟</ci><apply id="S4.p4.3.m1.25.25.25.13.13.13.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1"><times id="S4.p4.3.m1.25.25.25.13.13.13.1.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.2"></times><apply id="S4.p4.3.m1.25.25.25.13.13.13.1.3.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3"><apply id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1"><apply id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1"><csymbol cd="ambiguous" id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1">subscript</csymbol><ci id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.2">∇</ci><ci id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.3.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.1.3">𝜃</ci></apply><log id="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.1.2"></log></apply><ci id="S4.p4.3.m1.25.25.25.13.13.13.1.3.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.3.2">𝜋</ci></apply><apply id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1"><csymbol cd="latexml" id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.1">conditional</csymbol><apply id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.1.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2">subscript</csymbol><ci id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.2.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.2">𝑦</ci><ci id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.3.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.2.3">𝑙</ci></apply><ci id="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.3.cmml" xref="S4.p4.3.m1.25.25.25.13.13.13.1.1.1.1.3">𝑥</ci></apply></apply></apply><ci id="S4.p4.3.m1.2.2.2.2.2.2.1b.cmml" xref="S4.p4.3.m1.2.2.2.2.2.2.1"><mrow id="S4.p4.3.m1.2.2.2.2.2.2.1.cmml" xref="S4.p4.3.m1.2.2.2.2.2.2.1"><mtext id="S4.p4.3.m1.2.2.2.2.2.2.1a.cmml" mathsize="70%" xref="S4.p4.3.m1.2.2.2.2.2.2.1">decrease likelihood of&nbsp;</mtext><msub id="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.cmml" xref="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1"><mi id="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.2.cmml" mathsize="70%" xref="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.2">y</mi><mi id="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.3.cmml" mathsize="70%" xref="S4.p4.3.m1.2.2.2.2.2.2.1.1.1.m1.1.1.3">l</mi></msub></mrow></ci></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.3.m1.32c">\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=\\
-\beta\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\bigg{[}\underbrace{\sigma(%
\hat{r}_{\theta}(x,y_{l})-\hat{r}_{\theta}(x,y_{w}))}_{\text{higher weight %
when reward estimate is wrong}}\bigg{[}\underbrace{\nabla_{\theta}\log\pi(y_{w%
}\mid x)}_{\text{increase likelihood of $y_{w}$}}-\underbrace{\nabla_{\theta}%
\log\pi(y_{l}\mid x)}_{\text{decrease likelihood of $y_{l}$}}\bigg{]}\bigg{]},</annotation><annotation encoding="application/x-llamapun" id="S4.p4.3.m1.32d">start_ROW start_CELL ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) = end_CELL end_ROW start_ROW start_CELL - italic_β blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT [ under⏟ start_ARG italic_σ ( over^ start_ARG italic_r end_ARG start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) - over^ start_ARG italic_r end_ARG start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ) ) end_ARG start_POSTSUBSCRIPT higher weight when reward estimate is wrong end_POSTSUBSCRIPT [ under⏟ start_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT roman_log italic_π ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_x ) end_ARG start_POSTSUBSCRIPT increase likelihood of italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT end_POSTSUBSCRIPT - under⏟ start_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT roman_log italic_π ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_x ) end_ARG start_POSTSUBSCRIPT decrease likelihood of italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT end_POSTSUBSCRIPT ] ] , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.p4.11">where <math alttext="\hat{r}_{\theta}(x,y)=\beta\log\frac{\pi_{\theta}(y\mid x)}{\pi_{\text{ref}}(y%
\mid x)}" class="ltx_Math" display="inline" id="S4.p4.4.m1.4"><semantics id="S4.p4.4.m1.4a"><mrow id="S4.p4.4.m1.4.5" xref="S4.p4.4.m1.4.5.cmml"><mrow id="S4.p4.4.m1.4.5.2" xref="S4.p4.4.m1.4.5.2.cmml"><msub id="S4.p4.4.m1.4.5.2.2" xref="S4.p4.4.m1.4.5.2.2.cmml"><mover accent="true" id="S4.p4.4.m1.4.5.2.2.2" xref="S4.p4.4.m1.4.5.2.2.2.cmml"><mi id="S4.p4.4.m1.4.5.2.2.2.2" xref="S4.p4.4.m1.4.5.2.2.2.2.cmml">r</mi><mo id="S4.p4.4.m1.4.5.2.2.2.1" xref="S4.p4.4.m1.4.5.2.2.2.1.cmml">^</mo></mover><mi id="S4.p4.4.m1.4.5.2.2.3" xref="S4.p4.4.m1.4.5.2.2.3.cmml">θ</mi></msub><mo id="S4.p4.4.m1.4.5.2.1" xref="S4.p4.4.m1.4.5.2.1.cmml">⁢</mo><mrow id="S4.p4.4.m1.4.5.2.3.2" xref="S4.p4.4.m1.4.5.2.3.1.cmml"><mo id="S4.p4.4.m1.4.5.2.3.2.1" stretchy="false" xref="S4.p4.4.m1.4.5.2.3.1.cmml">(</mo><mi id="S4.p4.4.m1.3.3" xref="S4.p4.4.m1.3.3.cmml">x</mi><mo id="S4.p4.4.m1.4.5.2.3.2.2" xref="S4.p4.4.m1.4.5.2.3.1.cmml">,</mo><mi id="S4.p4.4.m1.4.4" xref="S4.p4.4.m1.4.4.cmml">y</mi><mo id="S4.p4.4.m1.4.5.2.3.2.3" stretchy="false" xref="S4.p4.4.m1.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="S4.p4.4.m1.4.5.1" xref="S4.p4.4.m1.4.5.1.cmml">=</mo><mrow id="S4.p4.4.m1.4.5.3" xref="S4.p4.4.m1.4.5.3.cmml"><mi id="S4.p4.4.m1.4.5.3.2" xref="S4.p4.4.m1.4.5.3.2.cmml">β</mi><mo id="S4.p4.4.m1.4.5.3.1" lspace="0.167em" xref="S4.p4.4.m1.4.5.3.1.cmml">⁢</mo><mrow id="S4.p4.4.m1.4.5.3.3" xref="S4.p4.4.m1.4.5.3.3.cmml"><mi id="S4.p4.4.m1.4.5.3.3.1" xref="S4.p4.4.m1.4.5.3.3.1.cmml">log</mi><mo id="S4.p4.4.m1.4.5.3.3a" lspace="0.167em" xref="S4.p4.4.m1.4.5.3.3.cmml">⁡</mo><mfrac id="S4.p4.4.m1.2.2" xref="S4.p4.4.m1.2.2.cmml"><mrow id="S4.p4.4.m1.1.1.1" xref="S4.p4.4.m1.1.1.1.cmml"><msub id="S4.p4.4.m1.1.1.1.3" xref="S4.p4.4.m1.1.1.1.3.cmml"><mi id="S4.p4.4.m1.1.1.1.3.2" xref="S4.p4.4.m1.1.1.1.3.2.cmml">π</mi><mi id="S4.p4.4.m1.1.1.1.3.3" xref="S4.p4.4.m1.1.1.1.3.3.cmml">θ</mi></msub><mo id="S4.p4.4.m1.1.1.1.2" xref="S4.p4.4.m1.1.1.1.2.cmml">⁢</mo><mrow id="S4.p4.4.m1.1.1.1.1.1" xref="S4.p4.4.m1.1.1.1.1.1.1.cmml"><mo id="S4.p4.4.m1.1.1.1.1.1.2" stretchy="false" xref="S4.p4.4.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.p4.4.m1.1.1.1.1.1.1" xref="S4.p4.4.m1.1.1.1.1.1.1.cmml"><mi id="S4.p4.4.m1.1.1.1.1.1.1.2" xref="S4.p4.4.m1.1.1.1.1.1.1.2.cmml">y</mi><mo id="S4.p4.4.m1.1.1.1.1.1.1.1" xref="S4.p4.4.m1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S4.p4.4.m1.1.1.1.1.1.1.3" xref="S4.p4.4.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.p4.4.m1.1.1.1.1.1.3" stretchy="false" xref="S4.p4.4.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S4.p4.4.m1.2.2.2" xref="S4.p4.4.m1.2.2.2.cmml"><msub id="S4.p4.4.m1.2.2.2.3" xref="S4.p4.4.m1.2.2.2.3.cmml"><mi id="S4.p4.4.m1.2.2.2.3.2" xref="S4.p4.4.m1.2.2.2.3.2.cmml">π</mi><mtext id="S4.p4.4.m1.2.2.2.3.3" xref="S4.p4.4.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="S4.p4.4.m1.2.2.2.2" xref="S4.p4.4.m1.2.2.2.2.cmml">⁢</mo><mrow id="S4.p4.4.m1.2.2.2.1.1" xref="S4.p4.4.m1.2.2.2.1.1.1.cmml"><mo id="S4.p4.4.m1.2.2.2.1.1.2" stretchy="false" xref="S4.p4.4.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="S4.p4.4.m1.2.2.2.1.1.1" xref="S4.p4.4.m1.2.2.2.1.1.1.cmml"><mi id="S4.p4.4.m1.2.2.2.1.1.1.2" xref="S4.p4.4.m1.2.2.2.1.1.1.2.cmml">y</mi><mo id="S4.p4.4.m1.2.2.2.1.1.1.1" xref="S4.p4.4.m1.2.2.2.1.1.1.1.cmml">∣</mo><mi id="S4.p4.4.m1.2.2.2.1.1.1.3" xref="S4.p4.4.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="S4.p4.4.m1.2.2.2.1.1.3" stretchy="false" xref="S4.p4.4.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p4.4.m1.4b"><apply id="S4.p4.4.m1.4.5.cmml" xref="S4.p4.4.m1.4.5"><eq id="S4.p4.4.m1.4.5.1.cmml" xref="S4.p4.4.m1.4.5.1"></eq><apply id="S4.p4.4.m1.4.5.2.cmml" xref="S4.p4.4.m1.4.5.2"><times id="S4.p4.4.m1.4.5.2.1.cmml" xref="S4.p4.4.m1.4.5.2.1"></times><apply id="S4.p4.4.m1.4.5.2.2.cmml" xref="S4.p4.4.m1.4.5.2.2"><csymbol cd="ambiguous" id="S4.p4.4.m1.4.5.2.2.1.cmml" xref="S4.p4.4.m1.4.5.2.2">subscript</csymbol><apply id="S4.p4.4.m1.4.5.2.2.2.cmml" xref="S4.p4.4.m1.4.5.2.2.2"><ci id="S4.p4.4.m1.4.5.2.2.2.1.cmml" xref="S4.p4.4.m1.4.5.2.2.2.1">^</ci><ci id="S4.p4.4.m1.4.5.2.2.2.2.cmml" xref="S4.p4.4.m1.4.5.2.2.2.2">𝑟</ci></apply><ci id="S4.p4.4.m1.4.5.2.2.3.cmml" xref="S4.p4.4.m1.4.5.2.2.3">𝜃</ci></apply><interval closure="open" id="S4.p4.4.m1.4.5.2.3.1.cmml" xref="S4.p4.4.m1.4.5.2.3.2"><ci id="S4.p4.4.m1.3.3.cmml" xref="S4.p4.4.m1.3.3">𝑥</ci><ci id="S4.p4.4.m1.4.4.cmml" xref="S4.p4.4.m1.4.4">𝑦</ci></interval></apply><apply id="S4.p4.4.m1.4.5.3.cmml" xref="S4.p4.4.m1.4.5.3"><times id="S4.p4.4.m1.4.5.3.1.cmml" xref="S4.p4.4.m1.4.5.3.1"></times><ci id="S4.p4.4.m1.4.5.3.2.cmml" xref="S4.p4.4.m1.4.5.3.2">𝛽</ci><apply id="S4.p4.4.m1.4.5.3.3.cmml" xref="S4.p4.4.m1.4.5.3.3"><log id="S4.p4.4.m1.4.5.3.3.1.cmml" xref="S4.p4.4.m1.4.5.3.3.1"></log><apply id="S4.p4.4.m1.2.2.cmml" xref="S4.p4.4.m1.2.2"><divide id="S4.p4.4.m1.2.2.3.cmml" xref="S4.p4.4.m1.2.2"></divide><apply id="S4.p4.4.m1.1.1.1.cmml" xref="S4.p4.4.m1.1.1.1"><times id="S4.p4.4.m1.1.1.1.2.cmml" xref="S4.p4.4.m1.1.1.1.2"></times><apply id="S4.p4.4.m1.1.1.1.3.cmml" xref="S4.p4.4.m1.1.1.1.3"><csymbol cd="ambiguous" id="S4.p4.4.m1.1.1.1.3.1.cmml" xref="S4.p4.4.m1.1.1.1.3">subscript</csymbol><ci id="S4.p4.4.m1.1.1.1.3.2.cmml" xref="S4.p4.4.m1.1.1.1.3.2">𝜋</ci><ci id="S4.p4.4.m1.1.1.1.3.3.cmml" xref="S4.p4.4.m1.1.1.1.3.3">𝜃</ci></apply><apply id="S4.p4.4.m1.1.1.1.1.1.1.cmml" xref="S4.p4.4.m1.1.1.1.1.1"><csymbol cd="latexml" id="S4.p4.4.m1.1.1.1.1.1.1.1.cmml" xref="S4.p4.4.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S4.p4.4.m1.1.1.1.1.1.1.2.cmml" xref="S4.p4.4.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="S4.p4.4.m1.1.1.1.1.1.1.3.cmml" xref="S4.p4.4.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S4.p4.4.m1.2.2.2.cmml" xref="S4.p4.4.m1.2.2.2"><times id="S4.p4.4.m1.2.2.2.2.cmml" xref="S4.p4.4.m1.2.2.2.2"></times><apply id="S4.p4.4.m1.2.2.2.3.cmml" xref="S4.p4.4.m1.2.2.2.3"><csymbol cd="ambiguous" id="S4.p4.4.m1.2.2.2.3.1.cmml" xref="S4.p4.4.m1.2.2.2.3">subscript</csymbol><ci id="S4.p4.4.m1.2.2.2.3.2.cmml" xref="S4.p4.4.m1.2.2.2.3.2">𝜋</ci><ci id="S4.p4.4.m1.2.2.2.3.3a.cmml" xref="S4.p4.4.m1.2.2.2.3.3"><mtext id="S4.p4.4.m1.2.2.2.3.3.cmml" mathsize="50%" xref="S4.p4.4.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="S4.p4.4.m1.2.2.2.1.1.1.cmml" xref="S4.p4.4.m1.2.2.2.1.1"><csymbol cd="latexml" id="S4.p4.4.m1.2.2.2.1.1.1.1.cmml" xref="S4.p4.4.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="S4.p4.4.m1.2.2.2.1.1.1.2.cmml" xref="S4.p4.4.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="S4.p4.4.m1.2.2.2.1.1.1.3.cmml" xref="S4.p4.4.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.4.m1.4c">\hat{r}_{\theta}(x,y)=\beta\log\frac{\pi_{\theta}(y\mid x)}{\pi_{\text{ref}}(y%
\mid x)}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.4.m1.4d">over^ start_ARG italic_r end_ARG start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG</annotation></semantics></math> is the reward implicitly defined by the language model <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S4.p4.5.m2.1"><semantics id="S4.p4.5.m2.1a"><msub id="S4.p4.5.m2.1.1" xref="S4.p4.5.m2.1.1.cmml"><mi id="S4.p4.5.m2.1.1.2" xref="S4.p4.5.m2.1.1.2.cmml">π</mi><mi id="S4.p4.5.m2.1.1.3" xref="S4.p4.5.m2.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p4.5.m2.1b"><apply id="S4.p4.5.m2.1.1.cmml" xref="S4.p4.5.m2.1.1"><csymbol cd="ambiguous" id="S4.p4.5.m2.1.1.1.cmml" xref="S4.p4.5.m2.1.1">subscript</csymbol><ci id="S4.p4.5.m2.1.1.2.cmml" xref="S4.p4.5.m2.1.1.2">𝜋</ci><ci id="S4.p4.5.m2.1.1.3.cmml" xref="S4.p4.5.m2.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.5.m2.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.5.m2.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> and reference model <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S4.p4.6.m3.1"><semantics id="S4.p4.6.m3.1a"><msub id="S4.p4.6.m3.1.1" xref="S4.p4.6.m3.1.1.cmml"><mi id="S4.p4.6.m3.1.1.2" xref="S4.p4.6.m3.1.1.2.cmml">π</mi><mtext id="S4.p4.6.m3.1.1.3" xref="S4.p4.6.m3.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p4.6.m3.1b"><apply id="S4.p4.6.m3.1.1.cmml" xref="S4.p4.6.m3.1.1"><csymbol cd="ambiguous" id="S4.p4.6.m3.1.1.1.cmml" xref="S4.p4.6.m3.1.1">subscript</csymbol><ci id="S4.p4.6.m3.1.1.2.cmml" xref="S4.p4.6.m3.1.1.2">𝜋</ci><ci id="S4.p4.6.m3.1.1.3a.cmml" xref="S4.p4.6.m3.1.1.3"><mtext id="S4.p4.6.m3.1.1.3.cmml" mathsize="70%" xref="S4.p4.6.m3.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.6.m3.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.6.m3.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math> (more in Section&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5" title="5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a>). Intuitively, the gradient of the loss function <math alttext="\mathcal{L}_{\text{DPO}}" class="ltx_Math" display="inline" id="S4.p4.7.m4.1"><semantics id="S4.p4.7.m4.1a"><msub id="S4.p4.7.m4.1.1" xref="S4.p4.7.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.p4.7.m4.1.1.2" xref="S4.p4.7.m4.1.1.2.cmml">ℒ</mi><mtext id="S4.p4.7.m4.1.1.3" xref="S4.p4.7.m4.1.1.3a.cmml">DPO</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p4.7.m4.1b"><apply id="S4.p4.7.m4.1.1.cmml" xref="S4.p4.7.m4.1.1"><csymbol cd="ambiguous" id="S4.p4.7.m4.1.1.1.cmml" xref="S4.p4.7.m4.1.1">subscript</csymbol><ci id="S4.p4.7.m4.1.1.2.cmml" xref="S4.p4.7.m4.1.1.2">ℒ</ci><ci id="S4.p4.7.m4.1.1.3a.cmml" xref="S4.p4.7.m4.1.1.3"><mtext id="S4.p4.7.m4.1.1.3.cmml" mathsize="70%" xref="S4.p4.7.m4.1.1.3">DPO</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.7.m4.1c">\mathcal{L}_{\text{DPO}}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.7.m4.1d">caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT</annotation></semantics></math> increases the likelihood of the preferred completions <math alttext="y_{w}" class="ltx_Math" display="inline" id="S4.p4.8.m5.1"><semantics id="S4.p4.8.m5.1a"><msub id="S4.p4.8.m5.1.1" xref="S4.p4.8.m5.1.1.cmml"><mi id="S4.p4.8.m5.1.1.2" xref="S4.p4.8.m5.1.1.2.cmml">y</mi><mi id="S4.p4.8.m5.1.1.3" xref="S4.p4.8.m5.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p4.8.m5.1b"><apply id="S4.p4.8.m5.1.1.cmml" xref="S4.p4.8.m5.1.1"><csymbol cd="ambiguous" id="S4.p4.8.m5.1.1.1.cmml" xref="S4.p4.8.m5.1.1">subscript</csymbol><ci id="S4.p4.8.m5.1.1.2.cmml" xref="S4.p4.8.m5.1.1.2">𝑦</ci><ci id="S4.p4.8.m5.1.1.3.cmml" xref="S4.p4.8.m5.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.8.m5.1c">y_{w}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.8.m5.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> and decreases the likelihood of dispreferred completions <math alttext="y_{l}" class="ltx_Math" display="inline" id="S4.p4.9.m6.1"><semantics id="S4.p4.9.m6.1a"><msub id="S4.p4.9.m6.1.1" xref="S4.p4.9.m6.1.1.cmml"><mi id="S4.p4.9.m6.1.1.2" xref="S4.p4.9.m6.1.1.2.cmml">y</mi><mi id="S4.p4.9.m6.1.1.3" xref="S4.p4.9.m6.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p4.9.m6.1b"><apply id="S4.p4.9.m6.1.1.cmml" xref="S4.p4.9.m6.1.1"><csymbol cd="ambiguous" id="S4.p4.9.m6.1.1.1.cmml" xref="S4.p4.9.m6.1.1">subscript</csymbol><ci id="S4.p4.9.m6.1.1.2.cmml" xref="S4.p4.9.m6.1.1.2">𝑦</ci><ci id="S4.p4.9.m6.1.1.3.cmml" xref="S4.p4.9.m6.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.9.m6.1c">y_{l}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.9.m6.1d">italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>. Importantly, the examples are weighed by how much higher the implicit reward model <math alttext="\hat{r}_{\theta}" class="ltx_Math" display="inline" id="S4.p4.10.m7.1"><semantics id="S4.p4.10.m7.1a"><msub id="S4.p4.10.m7.1.1" xref="S4.p4.10.m7.1.1.cmml"><mover accent="true" id="S4.p4.10.m7.1.1.2" xref="S4.p4.10.m7.1.1.2.cmml"><mi id="S4.p4.10.m7.1.1.2.2" xref="S4.p4.10.m7.1.1.2.2.cmml">r</mi><mo id="S4.p4.10.m7.1.1.2.1" xref="S4.p4.10.m7.1.1.2.1.cmml">^</mo></mover><mi id="S4.p4.10.m7.1.1.3" xref="S4.p4.10.m7.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p4.10.m7.1b"><apply id="S4.p4.10.m7.1.1.cmml" xref="S4.p4.10.m7.1.1"><csymbol cd="ambiguous" id="S4.p4.10.m7.1.1.1.cmml" xref="S4.p4.10.m7.1.1">subscript</csymbol><apply id="S4.p4.10.m7.1.1.2.cmml" xref="S4.p4.10.m7.1.1.2"><ci id="S4.p4.10.m7.1.1.2.1.cmml" xref="S4.p4.10.m7.1.1.2.1">^</ci><ci id="S4.p4.10.m7.1.1.2.2.cmml" xref="S4.p4.10.m7.1.1.2.2">𝑟</ci></apply><ci id="S4.p4.10.m7.1.1.3.cmml" xref="S4.p4.10.m7.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.10.m7.1c">\hat{r}_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.10.m7.1d">over^ start_ARG italic_r end_ARG start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> rates the dispreferred completions, scaled by <math alttext="\beta" class="ltx_Math" display="inline" id="S4.p4.11.m8.1"><semantics id="S4.p4.11.m8.1a"><mi id="S4.p4.11.m8.1.1" xref="S4.p4.11.m8.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S4.p4.11.m8.1b"><ci id="S4.p4.11.m8.1.1.cmml" xref="S4.p4.11.m8.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.11.m8.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S4.p4.11.m8.1d">italic_β</annotation></semantics></math>, i.e, how incorrectly the implicit reward model orders the completions, accounting for the strength of the KL constraint. Our experiments suggest the importance of this weighting, as a naïve version of this method without the weighting coefficient can cause the language model to degenerate (Appendix Table&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3.T3" title="Table 3 ‣ C.3 Unlikelihood baseline ‣ Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a>).</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S4.p5">
<p class="ltx_p" id="S4.p5.15"><span class="ltx_text ltx_font_bold" id="S4.p5.15.1">DPO outline.</span>
The general DPO pipeline is as follows: 1) Sample completions <math alttext="y_{1},y_{2}\sim\pi_{\text{ref}}(\cdot\mid x)" class="ltx_math_unparsed" display="inline" id="S4.p5.1.m1.1"><semantics id="S4.p5.1.m1.1a"><mrow id="S4.p5.1.m1.1b"><msub id="S4.p5.1.m1.1.1"><mi id="S4.p5.1.m1.1.1.2">y</mi><mn id="S4.p5.1.m1.1.1.3">1</mn></msub><mo id="S4.p5.1.m1.1.2">,</mo><msub id="S4.p5.1.m1.1.3"><mi id="S4.p5.1.m1.1.3.2">y</mi><mn id="S4.p5.1.m1.1.3.3">2</mn></msub><mo id="S4.p5.1.m1.1.4">∼</mo><msub id="S4.p5.1.m1.1.5"><mi id="S4.p5.1.m1.1.5.2">π</mi><mtext id="S4.p5.1.m1.1.5.3">ref</mtext></msub><mrow id="S4.p5.1.m1.1.6"><mo id="S4.p5.1.m1.1.6.1" stretchy="false">(</mo><mo id="S4.p5.1.m1.1.6.2" lspace="0em" rspace="0em">⋅</mo><mo id="S4.p5.1.m1.1.6.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S4.p5.1.m1.1.6.4">x</mi><mo id="S4.p5.1.m1.1.6.5" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S4.p5.1.m1.1c">y_{1},y_{2}\sim\pi_{\text{ref}}(\cdot\mid x)</annotation><annotation encoding="application/x-llamapun" id="S4.p5.1.m1.1d">italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∼ italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( ⋅ ∣ italic_x )</annotation></semantics></math> for every prompt <math alttext="x" class="ltx_Math" display="inline" id="S4.p5.2.m2.1"><semantics id="S4.p5.2.m2.1a"><mi id="S4.p5.2.m2.1.1" xref="S4.p5.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S4.p5.2.m2.1b"><ci id="S4.p5.2.m2.1.1.cmml" xref="S4.p5.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.2.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="S4.p5.2.m2.1d">italic_x</annotation></semantics></math>, label with human preferences to construct the offline dataset of preferences <math alttext="\mathcal{D}=\{x^{(i)},y_{w}^{(i)},y_{l})^{(i)}\}_{i=1}^{N}" class="ltx_math_unparsed" display="inline" id="S4.p5.3.m3.3"><semantics id="S4.p5.3.m3.3a"><mrow id="S4.p5.3.m3.3b"><mi class="ltx_font_mathcaligraphic" id="S4.p5.3.m3.3.4">𝒟</mi><mo id="S4.p5.3.m3.3.5">=</mo><msup id="S4.p5.3.m3.3.6"><mrow id="S4.p5.3.m3.3.6.2"><mo id="S4.p5.3.m3.3.6.2.1" stretchy="false">{</mo><msup id="S4.p5.3.m3.3.6.2.2"><mi id="S4.p5.3.m3.3.6.2.2.2">x</mi><mrow id="S4.p5.3.m3.1.1.1.3"><mo id="S4.p5.3.m3.1.1.1.3.1" stretchy="false">(</mo><mi id="S4.p5.3.m3.1.1.1.1">i</mi><mo id="S4.p5.3.m3.1.1.1.3.2" stretchy="false">)</mo></mrow></msup><mo id="S4.p5.3.m3.3.6.2.3">,</mo><msubsup id="S4.p5.3.m3.3.6.2.4"><mi id="S4.p5.3.m3.3.6.2.4.2.2">y</mi><mi id="S4.p5.3.m3.3.6.2.4.2.3">w</mi><mrow id="S4.p5.3.m3.2.2.1.3"><mo id="S4.p5.3.m3.2.2.1.3.1" stretchy="false">(</mo><mi id="S4.p5.3.m3.2.2.1.1">i</mi><mo id="S4.p5.3.m3.2.2.1.3.2" stretchy="false">)</mo></mrow></msubsup><mo id="S4.p5.3.m3.3.6.2.5">,</mo><msub id="S4.p5.3.m3.3.6.2.6"><mi id="S4.p5.3.m3.3.6.2.6.2">y</mi><mi id="S4.p5.3.m3.3.6.2.6.3">l</mi></msub><mo id="S4.p5.3.m3.3.6.2.7" stretchy="false">)</mo></mrow><mrow id="S4.p5.3.m3.3.3.1.3"><mo id="S4.p5.3.m3.3.3.1.3.1" stretchy="false">(</mo><mi id="S4.p5.3.m3.3.3.1.1">i</mi><mo id="S4.p5.3.m3.3.3.1.3.2" stretchy="false">)</mo></mrow></msup><mo id="S4.p5.3.m3.3.7" stretchy="false">}</mo><msub id="S4.p5.3.m3.3.8"><mi id="S4.p5.3.m3.3.8a"></mi><mrow id="S4.p5.3.m3.3.8.1"><mi id="S4.p5.3.m3.3.8.1.2">i</mi><mo id="S4.p5.3.m3.3.8.1.1">=</mo><mn id="S4.p5.3.m3.3.8.1.3">1</mn></mrow></msub><msup id="S4.p5.3.m3.3.9"><mi id="S4.p5.3.m3.3.9a"></mi><mi id="S4.p5.3.m3.3.9.1">N</mi></msup></mrow><annotation encoding="application/x-tex" id="S4.p5.3.m3.3c">\mathcal{D}=\{x^{(i)},y_{w}^{(i)},y_{l})^{(i)}\}_{i=1}^{N}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.3.m3.3d">caligraphic_D = { italic_x start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT</annotation></semantics></math> and 2) optimize the language model <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S4.p5.4.m4.1"><semantics id="S4.p5.4.m4.1a"><msub id="S4.p5.4.m4.1.1" xref="S4.p5.4.m4.1.1.cmml"><mi id="S4.p5.4.m4.1.1.2" xref="S4.p5.4.m4.1.1.2.cmml">π</mi><mi id="S4.p5.4.m4.1.1.3" xref="S4.p5.4.m4.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S4.p5.4.m4.1b"><apply id="S4.p5.4.m4.1.1.cmml" xref="S4.p5.4.m4.1.1"><csymbol cd="ambiguous" id="S4.p5.4.m4.1.1.1.cmml" xref="S4.p5.4.m4.1.1">subscript</csymbol><ci id="S4.p5.4.m4.1.1.2.cmml" xref="S4.p5.4.m4.1.1.2">𝜋</ci><ci id="S4.p5.4.m4.1.1.3.cmml" xref="S4.p5.4.m4.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.4.m4.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.4.m4.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> to minimize <math alttext="\mathcal{L}_{\text{DPO}}" class="ltx_Math" display="inline" id="S4.p5.5.m5.1"><semantics id="S4.p5.5.m5.1a"><msub id="S4.p5.5.m5.1.1" xref="S4.p5.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.p5.5.m5.1.1.2" xref="S4.p5.5.m5.1.1.2.cmml">ℒ</mi><mtext id="S4.p5.5.m5.1.1.3" xref="S4.p5.5.m5.1.1.3a.cmml">DPO</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p5.5.m5.1b"><apply id="S4.p5.5.m5.1.1.cmml" xref="S4.p5.5.m5.1.1"><csymbol cd="ambiguous" id="S4.p5.5.m5.1.1.1.cmml" xref="S4.p5.5.m5.1.1">subscript</csymbol><ci id="S4.p5.5.m5.1.1.2.cmml" xref="S4.p5.5.m5.1.1.2">ℒ</ci><ci id="S4.p5.5.m5.1.1.3a.cmml" xref="S4.p5.5.m5.1.1.3"><mtext id="S4.p5.5.m5.1.1.3.cmml" mathsize="70%" xref="S4.p5.5.m5.1.1.3">DPO</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.5.m5.1c">\mathcal{L}_{\text{DPO}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.5.m5.1d">caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT</annotation></semantics></math> for the given <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S4.p5.6.m6.1"><semantics id="S4.p5.6.m6.1a"><msub id="S4.p5.6.m6.1.1" xref="S4.p5.6.m6.1.1.cmml"><mi id="S4.p5.6.m6.1.1.2" xref="S4.p5.6.m6.1.1.2.cmml">π</mi><mtext id="S4.p5.6.m6.1.1.3" xref="S4.p5.6.m6.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p5.6.m6.1b"><apply id="S4.p5.6.m6.1.1.cmml" xref="S4.p5.6.m6.1.1"><csymbol cd="ambiguous" id="S4.p5.6.m6.1.1.1.cmml" xref="S4.p5.6.m6.1.1">subscript</csymbol><ci id="S4.p5.6.m6.1.1.2.cmml" xref="S4.p5.6.m6.1.1.2">𝜋</ci><ci id="S4.p5.6.m6.1.1.3a.cmml" xref="S4.p5.6.m6.1.1.3"><mtext id="S4.p5.6.m6.1.1.3.cmml" mathsize="70%" xref="S4.p5.6.m6.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.6.m6.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.6.m6.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{D}" class="ltx_Math" display="inline" id="S4.p5.7.m7.1"><semantics id="S4.p5.7.m7.1a"><mi class="ltx_font_mathcaligraphic" id="S4.p5.7.m7.1.1" xref="S4.p5.7.m7.1.1.cmml">𝒟</mi><annotation-xml encoding="MathML-Content" id="S4.p5.7.m7.1b"><ci id="S4.p5.7.m7.1.1.cmml" xref="S4.p5.7.m7.1.1">𝒟</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.7.m7.1c">\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.7.m7.1d">caligraphic_D</annotation></semantics></math> and desired <math alttext="\beta" class="ltx_Math" display="inline" id="S4.p5.8.m8.1"><semantics id="S4.p5.8.m8.1a"><mi id="S4.p5.8.m8.1.1" xref="S4.p5.8.m8.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S4.p5.8.m8.1b"><ci id="S4.p5.8.m8.1.1.cmml" xref="S4.p5.8.m8.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.8.m8.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S4.p5.8.m8.1d">italic_β</annotation></semantics></math>.
In practice, one would like to reuse preference datasets publicly available, rather than generating samples and gathering human preferences. Since the preference datasets are sampled using <math alttext="\pi^{\text{SFT}}" class="ltx_Math" display="inline" id="S4.p5.9.m9.1"><semantics id="S4.p5.9.m9.1a"><msup id="S4.p5.9.m9.1.1" xref="S4.p5.9.m9.1.1.cmml"><mi id="S4.p5.9.m9.1.1.2" xref="S4.p5.9.m9.1.1.2.cmml">π</mi><mtext id="S4.p5.9.m9.1.1.3" xref="S4.p5.9.m9.1.1.3a.cmml">SFT</mtext></msup><annotation-xml encoding="MathML-Content" id="S4.p5.9.m9.1b"><apply id="S4.p5.9.m9.1.1.cmml" xref="S4.p5.9.m9.1.1"><csymbol cd="ambiguous" id="S4.p5.9.m9.1.1.1.cmml" xref="S4.p5.9.m9.1.1">superscript</csymbol><ci id="S4.p5.9.m9.1.1.2.cmml" xref="S4.p5.9.m9.1.1.2">𝜋</ci><ci id="S4.p5.9.m9.1.1.3a.cmml" xref="S4.p5.9.m9.1.1.3"><mtext id="S4.p5.9.m9.1.1.3.cmml" mathsize="70%" xref="S4.p5.9.m9.1.1.3">SFT</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.9.m9.1c">\pi^{\text{SFT}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.9.m9.1d">italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT</annotation></semantics></math>, we initialize <math alttext="\pi_{\text{ref}}=\pi^{\text{SFT}}" class="ltx_Math" display="inline" id="S4.p5.10.m10.1"><semantics id="S4.p5.10.m10.1a"><mrow id="S4.p5.10.m10.1.1" xref="S4.p5.10.m10.1.1.cmml"><msub id="S4.p5.10.m10.1.1.2" xref="S4.p5.10.m10.1.1.2.cmml"><mi id="S4.p5.10.m10.1.1.2.2" xref="S4.p5.10.m10.1.1.2.2.cmml">π</mi><mtext id="S4.p5.10.m10.1.1.2.3" xref="S4.p5.10.m10.1.1.2.3a.cmml">ref</mtext></msub><mo id="S4.p5.10.m10.1.1.1" xref="S4.p5.10.m10.1.1.1.cmml">=</mo><msup id="S4.p5.10.m10.1.1.3" xref="S4.p5.10.m10.1.1.3.cmml"><mi id="S4.p5.10.m10.1.1.3.2" xref="S4.p5.10.m10.1.1.3.2.cmml">π</mi><mtext id="S4.p5.10.m10.1.1.3.3" xref="S4.p5.10.m10.1.1.3.3a.cmml">SFT</mtext></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.p5.10.m10.1b"><apply id="S4.p5.10.m10.1.1.cmml" xref="S4.p5.10.m10.1.1"><eq id="S4.p5.10.m10.1.1.1.cmml" xref="S4.p5.10.m10.1.1.1"></eq><apply id="S4.p5.10.m10.1.1.2.cmml" xref="S4.p5.10.m10.1.1.2"><csymbol cd="ambiguous" id="S4.p5.10.m10.1.1.2.1.cmml" xref="S4.p5.10.m10.1.1.2">subscript</csymbol><ci id="S4.p5.10.m10.1.1.2.2.cmml" xref="S4.p5.10.m10.1.1.2.2">𝜋</ci><ci id="S4.p5.10.m10.1.1.2.3a.cmml" xref="S4.p5.10.m10.1.1.2.3"><mtext id="S4.p5.10.m10.1.1.2.3.cmml" mathsize="70%" xref="S4.p5.10.m10.1.1.2.3">ref</mtext></ci></apply><apply id="S4.p5.10.m10.1.1.3.cmml" xref="S4.p5.10.m10.1.1.3"><csymbol cd="ambiguous" id="S4.p5.10.m10.1.1.3.1.cmml" xref="S4.p5.10.m10.1.1.3">superscript</csymbol><ci id="S4.p5.10.m10.1.1.3.2.cmml" xref="S4.p5.10.m10.1.1.3.2">𝜋</ci><ci id="S4.p5.10.m10.1.1.3.3a.cmml" xref="S4.p5.10.m10.1.1.3.3"><mtext id="S4.p5.10.m10.1.1.3.3.cmml" mathsize="70%" xref="S4.p5.10.m10.1.1.3.3">SFT</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.10.m10.1c">\pi_{\text{ref}}=\pi^{\text{SFT}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.10.m10.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT = italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT</annotation></semantics></math> whenever available. However, when <math alttext="\pi^{\text{SFT}}" class="ltx_Math" display="inline" id="S4.p5.11.m11.1"><semantics id="S4.p5.11.m11.1a"><msup id="S4.p5.11.m11.1.1" xref="S4.p5.11.m11.1.1.cmml"><mi id="S4.p5.11.m11.1.1.2" xref="S4.p5.11.m11.1.1.2.cmml">π</mi><mtext id="S4.p5.11.m11.1.1.3" xref="S4.p5.11.m11.1.1.3a.cmml">SFT</mtext></msup><annotation-xml encoding="MathML-Content" id="S4.p5.11.m11.1b"><apply id="S4.p5.11.m11.1.1.cmml" xref="S4.p5.11.m11.1.1"><csymbol cd="ambiguous" id="S4.p5.11.m11.1.1.1.cmml" xref="S4.p5.11.m11.1.1">superscript</csymbol><ci id="S4.p5.11.m11.1.1.2.cmml" xref="S4.p5.11.m11.1.1.2">𝜋</ci><ci id="S4.p5.11.m11.1.1.3a.cmml" xref="S4.p5.11.m11.1.1.3"><mtext id="S4.p5.11.m11.1.1.3.cmml" mathsize="70%" xref="S4.p5.11.m11.1.1.3">SFT</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.11.m11.1c">\pi^{\text{SFT}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.11.m11.1d">italic_π start_POSTSUPERSCRIPT SFT end_POSTSUPERSCRIPT</annotation></semantics></math> is not available, we initialize <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S4.p5.12.m12.1"><semantics id="S4.p5.12.m12.1a"><msub id="S4.p5.12.m12.1.1" xref="S4.p5.12.m12.1.1.cmml"><mi id="S4.p5.12.m12.1.1.2" xref="S4.p5.12.m12.1.1.2.cmml">π</mi><mtext id="S4.p5.12.m12.1.1.3" xref="S4.p5.12.m12.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p5.12.m12.1b"><apply id="S4.p5.12.m12.1.1.cmml" xref="S4.p5.12.m12.1.1"><csymbol cd="ambiguous" id="S4.p5.12.m12.1.1.1.cmml" xref="S4.p5.12.m12.1.1">subscript</csymbol><ci id="S4.p5.12.m12.1.1.2.cmml" xref="S4.p5.12.m12.1.1.2">𝜋</ci><ci id="S4.p5.12.m12.1.1.3a.cmml" xref="S4.p5.12.m12.1.1.3"><mtext id="S4.p5.12.m12.1.1.3.cmml" mathsize="70%" xref="S4.p5.12.m12.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.12.m12.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.12.m12.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math> by maximizing likelihood of preferred completions <math alttext="{(x,y_{w})}" class="ltx_Math" display="inline" id="S4.p5.13.m13.2"><semantics id="S4.p5.13.m13.2a"><mrow id="S4.p5.13.m13.2.2.1" xref="S4.p5.13.m13.2.2.2.cmml"><mo id="S4.p5.13.m13.2.2.1.2" stretchy="false" xref="S4.p5.13.m13.2.2.2.cmml">(</mo><mi id="S4.p5.13.m13.1.1" xref="S4.p5.13.m13.1.1.cmml">x</mi><mo id="S4.p5.13.m13.2.2.1.3" xref="S4.p5.13.m13.2.2.2.cmml">,</mo><msub id="S4.p5.13.m13.2.2.1.1" xref="S4.p5.13.m13.2.2.1.1.cmml"><mi id="S4.p5.13.m13.2.2.1.1.2" xref="S4.p5.13.m13.2.2.1.1.2.cmml">y</mi><mi id="S4.p5.13.m13.2.2.1.1.3" xref="S4.p5.13.m13.2.2.1.1.3.cmml">w</mi></msub><mo id="S4.p5.13.m13.2.2.1.4" stretchy="false" xref="S4.p5.13.m13.2.2.2.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.p5.13.m13.2b"><interval closure="open" id="S4.p5.13.m13.2.2.2.cmml" xref="S4.p5.13.m13.2.2.1"><ci id="S4.p5.13.m13.1.1.cmml" xref="S4.p5.13.m13.1.1">𝑥</ci><apply id="S4.p5.13.m13.2.2.1.1.cmml" xref="S4.p5.13.m13.2.2.1.1"><csymbol cd="ambiguous" id="S4.p5.13.m13.2.2.1.1.1.cmml" xref="S4.p5.13.m13.2.2.1.1">subscript</csymbol><ci id="S4.p5.13.m13.2.2.1.1.2.cmml" xref="S4.p5.13.m13.2.2.1.1.2">𝑦</ci><ci id="S4.p5.13.m13.2.2.1.1.3.cmml" xref="S4.p5.13.m13.2.2.1.1.3">𝑤</ci></apply></interval></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.13.m13.2c">{(x,y_{w})}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.13.m13.2d">( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT )</annotation></semantics></math>, that is, <math alttext="{\pi_{\text{ref}}=\operatorname*{arg\,max}_{\pi}\mathbb{E}_{x,y_{w}\sim%
\mathcal{D}}\left[\log\pi(y_{w}\mid x)\right]}" class="ltx_Math" display="inline" id="S4.p5.14.m14.3"><semantics id="S4.p5.14.m14.3a"><mrow id="S4.p5.14.m14.3.3" xref="S4.p5.14.m14.3.3.cmml"><msub id="S4.p5.14.m14.3.3.3" xref="S4.p5.14.m14.3.3.3.cmml"><mi id="S4.p5.14.m14.3.3.3.2" xref="S4.p5.14.m14.3.3.3.2.cmml">π</mi><mtext id="S4.p5.14.m14.3.3.3.3" xref="S4.p5.14.m14.3.3.3.3a.cmml">ref</mtext></msub><mo id="S4.p5.14.m14.3.3.2" xref="S4.p5.14.m14.3.3.2.cmml">=</mo><mrow id="S4.p5.14.m14.3.3.1" xref="S4.p5.14.m14.3.3.1.cmml"><mrow id="S4.p5.14.m14.3.3.1.3" xref="S4.p5.14.m14.3.3.1.3.cmml"><msub id="S4.p5.14.m14.3.3.1.3.1" xref="S4.p5.14.m14.3.3.1.3.1.cmml"><mrow id="S4.p5.14.m14.3.3.1.3.1.2" xref="S4.p5.14.m14.3.3.1.3.1.2.cmml"><mi id="S4.p5.14.m14.3.3.1.3.1.2.2" xref="S4.p5.14.m14.3.3.1.3.1.2.2.cmml">arg</mi><mo id="S4.p5.14.m14.3.3.1.3.1.2.1" lspace="0.170em" xref="S4.p5.14.m14.3.3.1.3.1.2.1.cmml">⁢</mo><mi id="S4.p5.14.m14.3.3.1.3.1.2.3" xref="S4.p5.14.m14.3.3.1.3.1.2.3.cmml">max</mi></mrow><mi id="S4.p5.14.m14.3.3.1.3.1.3" xref="S4.p5.14.m14.3.3.1.3.1.3.cmml">π</mi></msub><mo id="S4.p5.14.m14.3.3.1.3a" xref="S4.p5.14.m14.3.3.1.3.cmml">⁡</mo><msub id="S4.p5.14.m14.3.3.1.3.2" xref="S4.p5.14.m14.3.3.1.3.2.cmml"><mi id="S4.p5.14.m14.3.3.1.3.2.2" xref="S4.p5.14.m14.3.3.1.3.2.2.cmml">𝔼</mi><mrow id="S4.p5.14.m14.2.2.2" xref="S4.p5.14.m14.2.2.2.cmml"><mrow id="S4.p5.14.m14.2.2.2.2.1" xref="S4.p5.14.m14.2.2.2.2.2.cmml"><mi id="S4.p5.14.m14.1.1.1.1" xref="S4.p5.14.m14.1.1.1.1.cmml">x</mi><mo id="S4.p5.14.m14.2.2.2.2.1.2" xref="S4.p5.14.m14.2.2.2.2.2.cmml">,</mo><msub id="S4.p5.14.m14.2.2.2.2.1.1" xref="S4.p5.14.m14.2.2.2.2.1.1.cmml"><mi id="S4.p5.14.m14.2.2.2.2.1.1.2" xref="S4.p5.14.m14.2.2.2.2.1.1.2.cmml">y</mi><mi id="S4.p5.14.m14.2.2.2.2.1.1.3" xref="S4.p5.14.m14.2.2.2.2.1.1.3.cmml">w</mi></msub></mrow><mo id="S4.p5.14.m14.2.2.2.3" xref="S4.p5.14.m14.2.2.2.3.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="S4.p5.14.m14.2.2.2.4" xref="S4.p5.14.m14.2.2.2.4.cmml">𝒟</mi></mrow></msub></mrow><mo id="S4.p5.14.m14.3.3.1.2" xref="S4.p5.14.m14.3.3.1.2.cmml">⁢</mo><mrow id="S4.p5.14.m14.3.3.1.1.1" xref="S4.p5.14.m14.3.3.1.1.2.cmml"><mo id="S4.p5.14.m14.3.3.1.1.1.2" xref="S4.p5.14.m14.3.3.1.1.2.1.cmml">[</mo><mrow id="S4.p5.14.m14.3.3.1.1.1.1" xref="S4.p5.14.m14.3.3.1.1.1.1.cmml"><mrow id="S4.p5.14.m14.3.3.1.1.1.1.3" xref="S4.p5.14.m14.3.3.1.1.1.1.3.cmml"><mi id="S4.p5.14.m14.3.3.1.1.1.1.3.1" xref="S4.p5.14.m14.3.3.1.1.1.1.3.1.cmml">log</mi><mo id="S4.p5.14.m14.3.3.1.1.1.1.3a" lspace="0.167em" xref="S4.p5.14.m14.3.3.1.1.1.1.3.cmml">⁡</mo><mi id="S4.p5.14.m14.3.3.1.1.1.1.3.2" xref="S4.p5.14.m14.3.3.1.1.1.1.3.2.cmml">π</mi></mrow><mo id="S4.p5.14.m14.3.3.1.1.1.1.2" xref="S4.p5.14.m14.3.3.1.1.1.1.2.cmml">⁢</mo><mrow id="S4.p5.14.m14.3.3.1.1.1.1.1.1" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.cmml"><mo id="S4.p5.14.m14.3.3.1.1.1.1.1.1.2" stretchy="false" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.cmml"><msub id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.cmml"><mi id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.2" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.2.cmml">y</mi><mi id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.3" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.3.cmml">w</mi></msub><mo id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.1" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.3" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S4.p5.14.m14.3.3.1.1.1.1.1.1.3" stretchy="false" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S4.p5.14.m14.3.3.1.1.1.3" xref="S4.p5.14.m14.3.3.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.p5.14.m14.3b"><apply id="S4.p5.14.m14.3.3.cmml" xref="S4.p5.14.m14.3.3"><eq id="S4.p5.14.m14.3.3.2.cmml" xref="S4.p5.14.m14.3.3.2"></eq><apply id="S4.p5.14.m14.3.3.3.cmml" xref="S4.p5.14.m14.3.3.3"><csymbol cd="ambiguous" id="S4.p5.14.m14.3.3.3.1.cmml" xref="S4.p5.14.m14.3.3.3">subscript</csymbol><ci id="S4.p5.14.m14.3.3.3.2.cmml" xref="S4.p5.14.m14.3.3.3.2">𝜋</ci><ci id="S4.p5.14.m14.3.3.3.3a.cmml" xref="S4.p5.14.m14.3.3.3.3"><mtext id="S4.p5.14.m14.3.3.3.3.cmml" mathsize="70%" xref="S4.p5.14.m14.3.3.3.3">ref</mtext></ci></apply><apply id="S4.p5.14.m14.3.3.1.cmml" xref="S4.p5.14.m14.3.3.1"><times id="S4.p5.14.m14.3.3.1.2.cmml" xref="S4.p5.14.m14.3.3.1.2"></times><apply id="S4.p5.14.m14.3.3.1.3.cmml" xref="S4.p5.14.m14.3.3.1.3"><apply id="S4.p5.14.m14.3.3.1.3.1.cmml" xref="S4.p5.14.m14.3.3.1.3.1"><csymbol cd="ambiguous" id="S4.p5.14.m14.3.3.1.3.1.1.cmml" xref="S4.p5.14.m14.3.3.1.3.1">subscript</csymbol><apply id="S4.p5.14.m14.3.3.1.3.1.2.cmml" xref="S4.p5.14.m14.3.3.1.3.1.2"><times id="S4.p5.14.m14.3.3.1.3.1.2.1.cmml" xref="S4.p5.14.m14.3.3.1.3.1.2.1"></times><ci id="S4.p5.14.m14.3.3.1.3.1.2.2.cmml" xref="S4.p5.14.m14.3.3.1.3.1.2.2">arg</ci><ci id="S4.p5.14.m14.3.3.1.3.1.2.3.cmml" xref="S4.p5.14.m14.3.3.1.3.1.2.3">max</ci></apply><ci id="S4.p5.14.m14.3.3.1.3.1.3.cmml" xref="S4.p5.14.m14.3.3.1.3.1.3">𝜋</ci></apply><apply id="S4.p5.14.m14.3.3.1.3.2.cmml" xref="S4.p5.14.m14.3.3.1.3.2"><csymbol cd="ambiguous" id="S4.p5.14.m14.3.3.1.3.2.1.cmml" xref="S4.p5.14.m14.3.3.1.3.2">subscript</csymbol><ci id="S4.p5.14.m14.3.3.1.3.2.2.cmml" xref="S4.p5.14.m14.3.3.1.3.2.2">𝔼</ci><apply id="S4.p5.14.m14.2.2.2.cmml" xref="S4.p5.14.m14.2.2.2"><csymbol cd="latexml" id="S4.p5.14.m14.2.2.2.3.cmml" xref="S4.p5.14.m14.2.2.2.3">similar-to</csymbol><list id="S4.p5.14.m14.2.2.2.2.2.cmml" xref="S4.p5.14.m14.2.2.2.2.1"><ci id="S4.p5.14.m14.1.1.1.1.cmml" xref="S4.p5.14.m14.1.1.1.1">𝑥</ci><apply id="S4.p5.14.m14.2.2.2.2.1.1.cmml" xref="S4.p5.14.m14.2.2.2.2.1.1"><csymbol cd="ambiguous" id="S4.p5.14.m14.2.2.2.2.1.1.1.cmml" xref="S4.p5.14.m14.2.2.2.2.1.1">subscript</csymbol><ci id="S4.p5.14.m14.2.2.2.2.1.1.2.cmml" xref="S4.p5.14.m14.2.2.2.2.1.1.2">𝑦</ci><ci id="S4.p5.14.m14.2.2.2.2.1.1.3.cmml" xref="S4.p5.14.m14.2.2.2.2.1.1.3">𝑤</ci></apply></list><ci id="S4.p5.14.m14.2.2.2.4.cmml" xref="S4.p5.14.m14.2.2.2.4">𝒟</ci></apply></apply></apply><apply id="S4.p5.14.m14.3.3.1.1.2.cmml" xref="S4.p5.14.m14.3.3.1.1.1"><csymbol cd="latexml" id="S4.p5.14.m14.3.3.1.1.2.1.cmml" xref="S4.p5.14.m14.3.3.1.1.1.2">delimited-[]</csymbol><apply id="S4.p5.14.m14.3.3.1.1.1.1.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1"><times id="S4.p5.14.m14.3.3.1.1.1.1.2.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.2"></times><apply id="S4.p5.14.m14.3.3.1.1.1.1.3.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.3"><log id="S4.p5.14.m14.3.3.1.1.1.1.3.1.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.3.1"></log><ci id="S4.p5.14.m14.3.3.1.1.1.1.3.2.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.3.2">𝜋</ci></apply><apply id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1"><csymbol cd="latexml" id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.1.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.1">conditional</csymbol><apply id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.1.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.2.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.2">𝑦</ci><ci id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.3.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.2.3">𝑤</ci></apply><ci id="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.3.cmml" xref="S4.p5.14.m14.3.3.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.14.m14.3c">{\pi_{\text{ref}}=\operatorname*{arg\,max}_{\pi}\mathbb{E}_{x,y_{w}\sim%
\mathcal{D}}\left[\log\pi(y_{w}\mid x)\right]}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.14.m14.3d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT = start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∼ caligraphic_D end_POSTSUBSCRIPT [ roman_log italic_π ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_x ) ]</annotation></semantics></math>. This procedure helps mitigate the distribution shift between the true reference distribution which is unavailable, and <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S4.p5.15.m15.1"><semantics id="S4.p5.15.m15.1a"><msub id="S4.p5.15.m15.1.1" xref="S4.p5.15.m15.1.1.cmml"><mi id="S4.p5.15.m15.1.1.2" xref="S4.p5.15.m15.1.1.2.cmml">π</mi><mtext id="S4.p5.15.m15.1.1.3" xref="S4.p5.15.m15.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.p5.15.m15.1b"><apply id="S4.p5.15.m15.1.1.cmml" xref="S4.p5.15.m15.1.1"><csymbol cd="ambiguous" id="S4.p5.15.m15.1.1.1.cmml" xref="S4.p5.15.m15.1.1">subscript</csymbol><ci id="S4.p5.15.m15.1.1.2.cmml" xref="S4.p5.15.m15.1.1.2">𝜋</ci><ci id="S4.p5.15.m15.1.1.3a.cmml" xref="S4.p5.15.m15.1.1.3"><mtext id="S4.p5.15.m15.1.1.3.cmml" mathsize="70%" xref="S4.p5.15.m15.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p5.15.m15.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S4.p5.15.m15.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math> used by DPO. Further details related to the implementation and hyperparameters can be found in Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A2" title="Appendix B DPO Implementation Details and Hyperparameters ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">B</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Theoretical Analysis of DPO</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this section, we give further interpretation of the DPO method, provide theoretical backing, and relate advantages of DPO to issues with actor critic algorithms used for RLHF (such as PPO&nbsp;<cite class="ltx_cite ltx_citemacro_cite">Schulman et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib37" title="">2017</a>)</cite>).</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Your Language Model Is Secretly a Reward Model</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.2">DPO is able to bypass both fitting an explicit reward and performing RL to learn the policy using a single maximum likelihood objective. Note the optimization objective Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E5" title="5 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a> is equivalent to a Bradley-Terry model with a reward parameterization <math alttext="r^{*}(x,y)=\beta\log\frac{\pi^{*}_{\theta}(y\mid x)}{\pi_{\text{ref}}(y\mid x)}" class="ltx_Math" display="inline" id="S5.SS1.p1.1.m1.4"><semantics id="S5.SS1.p1.1.m1.4a"><mrow id="S5.SS1.p1.1.m1.4.5" xref="S5.SS1.p1.1.m1.4.5.cmml"><mrow id="S5.SS1.p1.1.m1.4.5.2" xref="S5.SS1.p1.1.m1.4.5.2.cmml"><msup id="S5.SS1.p1.1.m1.4.5.2.2" xref="S5.SS1.p1.1.m1.4.5.2.2.cmml"><mi id="S5.SS1.p1.1.m1.4.5.2.2.2" xref="S5.SS1.p1.1.m1.4.5.2.2.2.cmml">r</mi><mo id="S5.SS1.p1.1.m1.4.5.2.2.3" xref="S5.SS1.p1.1.m1.4.5.2.2.3.cmml">*</mo></msup><mo id="S5.SS1.p1.1.m1.4.5.2.1" xref="S5.SS1.p1.1.m1.4.5.2.1.cmml">⁢</mo><mrow id="S5.SS1.p1.1.m1.4.5.2.3.2" xref="S5.SS1.p1.1.m1.4.5.2.3.1.cmml"><mo id="S5.SS1.p1.1.m1.4.5.2.3.2.1" stretchy="false" xref="S5.SS1.p1.1.m1.4.5.2.3.1.cmml">(</mo><mi id="S5.SS1.p1.1.m1.3.3" xref="S5.SS1.p1.1.m1.3.3.cmml">x</mi><mo id="S5.SS1.p1.1.m1.4.5.2.3.2.2" xref="S5.SS1.p1.1.m1.4.5.2.3.1.cmml">,</mo><mi id="S5.SS1.p1.1.m1.4.4" xref="S5.SS1.p1.1.m1.4.4.cmml">y</mi><mo id="S5.SS1.p1.1.m1.4.5.2.3.2.3" stretchy="false" xref="S5.SS1.p1.1.m1.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="S5.SS1.p1.1.m1.4.5.1" xref="S5.SS1.p1.1.m1.4.5.1.cmml">=</mo><mrow id="S5.SS1.p1.1.m1.4.5.3" xref="S5.SS1.p1.1.m1.4.5.3.cmml"><mi id="S5.SS1.p1.1.m1.4.5.3.2" xref="S5.SS1.p1.1.m1.4.5.3.2.cmml">β</mi><mo id="S5.SS1.p1.1.m1.4.5.3.1" lspace="0.167em" xref="S5.SS1.p1.1.m1.4.5.3.1.cmml">⁢</mo><mrow id="S5.SS1.p1.1.m1.4.5.3.3" xref="S5.SS1.p1.1.m1.4.5.3.3.cmml"><mi id="S5.SS1.p1.1.m1.4.5.3.3.1" xref="S5.SS1.p1.1.m1.4.5.3.3.1.cmml">log</mi><mo id="S5.SS1.p1.1.m1.4.5.3.3a" lspace="0.167em" xref="S5.SS1.p1.1.m1.4.5.3.3.cmml">⁡</mo><mfrac id="S5.SS1.p1.1.m1.2.2" xref="S5.SS1.p1.1.m1.2.2.cmml"><mrow id="S5.SS1.p1.1.m1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.cmml"><msubsup id="S5.SS1.p1.1.m1.1.1.1.3" xref="S5.SS1.p1.1.m1.1.1.1.3.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.3.2.2" xref="S5.SS1.p1.1.m1.1.1.1.3.2.2.cmml">π</mi><mi id="S5.SS1.p1.1.m1.1.1.1.3.3" xref="S5.SS1.p1.1.m1.1.1.1.3.3.cmml">θ</mi><mo id="S5.SS1.p1.1.m1.1.1.1.3.2.3" xref="S5.SS1.p1.1.m1.1.1.1.3.2.3.cmml">*</mo></msubsup><mo id="S5.SS1.p1.1.m1.1.1.1.2" xref="S5.SS1.p1.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS1.p1.1.m1.1.1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.cmml"><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.2" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS1.p1.1.m1.1.1.1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.cmml"><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.1.2" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.1.1" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.SS1.p1.1.m1.1.1.1.1.1.1.3" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS1.p1.1.m1.1.1.1.1.1.3" stretchy="false" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S5.SS1.p1.1.m1.2.2.2" xref="S5.SS1.p1.1.m1.2.2.2.cmml"><msub id="S5.SS1.p1.1.m1.2.2.2.3" xref="S5.SS1.p1.1.m1.2.2.2.3.cmml"><mi id="S5.SS1.p1.1.m1.2.2.2.3.2" xref="S5.SS1.p1.1.m1.2.2.2.3.2.cmml">π</mi><mtext id="S5.SS1.p1.1.m1.2.2.2.3.3" xref="S5.SS1.p1.1.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="S5.SS1.p1.1.m1.2.2.2.2" xref="S5.SS1.p1.1.m1.2.2.2.2.cmml">⁢</mo><mrow id="S5.SS1.p1.1.m1.2.2.2.1.1" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.cmml"><mo id="S5.SS1.p1.1.m1.2.2.2.1.1.2" stretchy="false" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="S5.SS1.p1.1.m1.2.2.2.1.1.1" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.cmml"><mi id="S5.SS1.p1.1.m1.2.2.2.1.1.1.2" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.2.cmml">y</mi><mo id="S5.SS1.p1.1.m1.2.2.2.1.1.1.1" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.1.cmml">∣</mo><mi id="S5.SS1.p1.1.m1.2.2.2.1.1.1.3" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS1.p1.1.m1.2.2.2.1.1.3" stretchy="false" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.1.m1.4b"><apply id="S5.SS1.p1.1.m1.4.5.cmml" xref="S5.SS1.p1.1.m1.4.5"><eq id="S5.SS1.p1.1.m1.4.5.1.cmml" xref="S5.SS1.p1.1.m1.4.5.1"></eq><apply id="S5.SS1.p1.1.m1.4.5.2.cmml" xref="S5.SS1.p1.1.m1.4.5.2"><times id="S5.SS1.p1.1.m1.4.5.2.1.cmml" xref="S5.SS1.p1.1.m1.4.5.2.1"></times><apply id="S5.SS1.p1.1.m1.4.5.2.2.cmml" xref="S5.SS1.p1.1.m1.4.5.2.2"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.4.5.2.2.1.cmml" xref="S5.SS1.p1.1.m1.4.5.2.2">superscript</csymbol><ci id="S5.SS1.p1.1.m1.4.5.2.2.2.cmml" xref="S5.SS1.p1.1.m1.4.5.2.2.2">𝑟</ci><times id="S5.SS1.p1.1.m1.4.5.2.2.3.cmml" xref="S5.SS1.p1.1.m1.4.5.2.2.3"></times></apply><interval closure="open" id="S5.SS1.p1.1.m1.4.5.2.3.1.cmml" xref="S5.SS1.p1.1.m1.4.5.2.3.2"><ci id="S5.SS1.p1.1.m1.3.3.cmml" xref="S5.SS1.p1.1.m1.3.3">𝑥</ci><ci id="S5.SS1.p1.1.m1.4.4.cmml" xref="S5.SS1.p1.1.m1.4.4">𝑦</ci></interval></apply><apply id="S5.SS1.p1.1.m1.4.5.3.cmml" xref="S5.SS1.p1.1.m1.4.5.3"><times id="S5.SS1.p1.1.m1.4.5.3.1.cmml" xref="S5.SS1.p1.1.m1.4.5.3.1"></times><ci id="S5.SS1.p1.1.m1.4.5.3.2.cmml" xref="S5.SS1.p1.1.m1.4.5.3.2">𝛽</ci><apply id="S5.SS1.p1.1.m1.4.5.3.3.cmml" xref="S5.SS1.p1.1.m1.4.5.3.3"><log id="S5.SS1.p1.1.m1.4.5.3.3.1.cmml" xref="S5.SS1.p1.1.m1.4.5.3.3.1"></log><apply id="S5.SS1.p1.1.m1.2.2.cmml" xref="S5.SS1.p1.1.m1.2.2"><divide id="S5.SS1.p1.1.m1.2.2.3.cmml" xref="S5.SS1.p1.1.m1.2.2"></divide><apply id="S5.SS1.p1.1.m1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1"><times id="S5.SS1.p1.1.m1.1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.2"></times><apply id="S5.SS1.p1.1.m1.1.1.1.3.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.3.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3">subscript</csymbol><apply id="S5.SS1.p1.1.m1.1.1.1.3.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.1.1.1.3.2.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3">superscript</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.3.2.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3.2.2">𝜋</ci><times id="S5.SS1.p1.1.m1.1.1.1.3.2.3.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3.2.3"></times></apply><ci id="S5.SS1.p1.1.m1.1.1.1.3.3.cmml" xref="S5.SS1.p1.1.m1.1.1.1.3.3">𝜃</ci></apply><apply id="S5.SS1.p1.1.m1.1.1.1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="S5.SS1.p1.1.m1.1.1.1.1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="S5.SS1.p1.1.m1.1.1.1.1.1.1.3.cmml" xref="S5.SS1.p1.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S5.SS1.p1.1.m1.2.2.2.cmml" xref="S5.SS1.p1.1.m1.2.2.2"><times id="S5.SS1.p1.1.m1.2.2.2.2.cmml" xref="S5.SS1.p1.1.m1.2.2.2.2"></times><apply id="S5.SS1.p1.1.m1.2.2.2.3.cmml" xref="S5.SS1.p1.1.m1.2.2.2.3"><csymbol cd="ambiguous" id="S5.SS1.p1.1.m1.2.2.2.3.1.cmml" xref="S5.SS1.p1.1.m1.2.2.2.3">subscript</csymbol><ci id="S5.SS1.p1.1.m1.2.2.2.3.2.cmml" xref="S5.SS1.p1.1.m1.2.2.2.3.2">𝜋</ci><ci id="S5.SS1.p1.1.m1.2.2.2.3.3a.cmml" xref="S5.SS1.p1.1.m1.2.2.2.3.3"><mtext id="S5.SS1.p1.1.m1.2.2.2.3.3.cmml" mathsize="50%" xref="S5.SS1.p1.1.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="S5.SS1.p1.1.m1.2.2.2.1.1.1.cmml" xref="S5.SS1.p1.1.m1.2.2.2.1.1"><csymbol cd="latexml" id="S5.SS1.p1.1.m1.2.2.2.1.1.1.1.cmml" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="S5.SS1.p1.1.m1.2.2.2.1.1.1.2.cmml" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="S5.SS1.p1.1.m1.2.2.2.1.1.1.3.cmml" xref="S5.SS1.p1.1.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.1.m1.4c">r^{*}(x,y)=\beta\log\frac{\pi^{*}_{\theta}(y\mid x)}{\pi_{\text{ref}}(y\mid x)}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.1.m1.4d">italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG</annotation></semantics></math> and we optimize our parametric model <math alttext="\pi_{\theta}" class="ltx_Math" display="inline" id="S5.SS1.p1.2.m2.1"><semantics id="S5.SS1.p1.2.m2.1a"><msub id="S5.SS1.p1.2.m2.1.1" xref="S5.SS1.p1.2.m2.1.1.cmml"><mi id="S5.SS1.p1.2.m2.1.1.2" xref="S5.SS1.p1.2.m2.1.1.2.cmml">π</mi><mi id="S5.SS1.p1.2.m2.1.1.3" xref="S5.SS1.p1.2.m2.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.p1.2.m2.1b"><apply id="S5.SS1.p1.2.m2.1.1.cmml" xref="S5.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS1.p1.2.m2.1.1.1.cmml" xref="S5.SS1.p1.2.m2.1.1">subscript</csymbol><ci id="S5.SS1.p1.2.m2.1.1.2.cmml" xref="S5.SS1.p1.2.m2.1.1.2">𝜋</ci><ci id="S5.SS1.p1.2.m2.1.1.3.cmml" xref="S5.SS1.p1.2.m2.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p1.2.m2.1c">\pi_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p1.2.m2.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math>, equivalently to the reward model optimization in Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E2" title="2 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">2</span></a> under the change of variables. In this section we will build the theory behind this reparameterization, show that it does not constrain the class of learned reward models, and allows for the exact recovery of the optimal policy. We begin with by defining an equivalence relation between reward functions.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_theorem ltx_theorem_definition" id="Thmdefinition1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold" id="Thmdefinition1.1.1.1">Definition 1</span></span><span class="ltx_text ltx_font_bold" id="Thmdefinition1.2.2">.</span>
</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Thmdefinition1.p1">
<p class="ltx_p" id="Thmdefinition1.p1.4"><span class="ltx_text ltx_font_italic" id="Thmdefinition1.p1.4.4">We say that two reward functions <math alttext="r(x,y)" class="ltx_Math" display="inline" id="Thmdefinition1.p1.1.1.m1.2"><semantics id="Thmdefinition1.p1.1.1.m1.2a"><mrow id="Thmdefinition1.p1.1.1.m1.2.3" xref="Thmdefinition1.p1.1.1.m1.2.3.cmml"><mi id="Thmdefinition1.p1.1.1.m1.2.3.2" xref="Thmdefinition1.p1.1.1.m1.2.3.2.cmml">r</mi><mo id="Thmdefinition1.p1.1.1.m1.2.3.1" mathvariant="italic" xref="Thmdefinition1.p1.1.1.m1.2.3.1.cmml">⁢</mo><mrow id="Thmdefinition1.p1.1.1.m1.2.3.3.2" xref="Thmdefinition1.p1.1.1.m1.2.3.3.1.cmml"><mo id="Thmdefinition1.p1.1.1.m1.2.3.3.2.1" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.1.1.m1.2.3.3.1.cmml">(</mo><mi id="Thmdefinition1.p1.1.1.m1.1.1" xref="Thmdefinition1.p1.1.1.m1.1.1.cmml">x</mi><mo id="Thmdefinition1.p1.1.1.m1.2.3.3.2.2" mathvariant="normal" xref="Thmdefinition1.p1.1.1.m1.2.3.3.1.cmml">,</mo><mi id="Thmdefinition1.p1.1.1.m1.2.2" xref="Thmdefinition1.p1.1.1.m1.2.2.cmml">y</mi><mo id="Thmdefinition1.p1.1.1.m1.2.3.3.2.3" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.1.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmdefinition1.p1.1.1.m1.2b"><apply id="Thmdefinition1.p1.1.1.m1.2.3.cmml" xref="Thmdefinition1.p1.1.1.m1.2.3"><times id="Thmdefinition1.p1.1.1.m1.2.3.1.cmml" xref="Thmdefinition1.p1.1.1.m1.2.3.1"></times><ci id="Thmdefinition1.p1.1.1.m1.2.3.2.cmml" xref="Thmdefinition1.p1.1.1.m1.2.3.2">𝑟</ci><interval closure="open" id="Thmdefinition1.p1.1.1.m1.2.3.3.1.cmml" xref="Thmdefinition1.p1.1.1.m1.2.3.3.2"><ci id="Thmdefinition1.p1.1.1.m1.1.1.cmml" xref="Thmdefinition1.p1.1.1.m1.1.1">𝑥</ci><ci id="Thmdefinition1.p1.1.1.m1.2.2.cmml" xref="Thmdefinition1.p1.1.1.m1.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmdefinition1.p1.1.1.m1.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="Thmdefinition1.p1.1.1.m1.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math> and <math alttext="r^{\prime}(x,y)" class="ltx_Math" display="inline" id="Thmdefinition1.p1.2.2.m2.2"><semantics id="Thmdefinition1.p1.2.2.m2.2a"><mrow id="Thmdefinition1.p1.2.2.m2.2.3" xref="Thmdefinition1.p1.2.2.m2.2.3.cmml"><msup id="Thmdefinition1.p1.2.2.m2.2.3.2" xref="Thmdefinition1.p1.2.2.m2.2.3.2.cmml"><mi id="Thmdefinition1.p1.2.2.m2.2.3.2.2" xref="Thmdefinition1.p1.2.2.m2.2.3.2.2.cmml">r</mi><mo id="Thmdefinition1.p1.2.2.m2.2.3.2.3" mathvariant="normal" xref="Thmdefinition1.p1.2.2.m2.2.3.2.3.cmml">′</mo></msup><mo id="Thmdefinition1.p1.2.2.m2.2.3.1" mathvariant="italic" xref="Thmdefinition1.p1.2.2.m2.2.3.1.cmml">⁢</mo><mrow id="Thmdefinition1.p1.2.2.m2.2.3.3.2" xref="Thmdefinition1.p1.2.2.m2.2.3.3.1.cmml"><mo id="Thmdefinition1.p1.2.2.m2.2.3.3.2.1" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.2.2.m2.2.3.3.1.cmml">(</mo><mi id="Thmdefinition1.p1.2.2.m2.1.1" xref="Thmdefinition1.p1.2.2.m2.1.1.cmml">x</mi><mo id="Thmdefinition1.p1.2.2.m2.2.3.3.2.2" mathvariant="normal" xref="Thmdefinition1.p1.2.2.m2.2.3.3.1.cmml">,</mo><mi id="Thmdefinition1.p1.2.2.m2.2.2" xref="Thmdefinition1.p1.2.2.m2.2.2.cmml">y</mi><mo id="Thmdefinition1.p1.2.2.m2.2.3.3.2.3" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.2.2.m2.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmdefinition1.p1.2.2.m2.2b"><apply id="Thmdefinition1.p1.2.2.m2.2.3.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3"><times id="Thmdefinition1.p1.2.2.m2.2.3.1.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3.1"></times><apply id="Thmdefinition1.p1.2.2.m2.2.3.2.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3.2"><csymbol cd="ambiguous" id="Thmdefinition1.p1.2.2.m2.2.3.2.1.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3.2">superscript</csymbol><ci id="Thmdefinition1.p1.2.2.m2.2.3.2.2.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3.2.2">𝑟</ci><ci id="Thmdefinition1.p1.2.2.m2.2.3.2.3.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3.2.3">normal-′</ci></apply><interval closure="open" id="Thmdefinition1.p1.2.2.m2.2.3.3.1.cmml" xref="Thmdefinition1.p1.2.2.m2.2.3.3.2"><ci id="Thmdefinition1.p1.2.2.m2.1.1.cmml" xref="Thmdefinition1.p1.2.2.m2.1.1">𝑥</ci><ci id="Thmdefinition1.p1.2.2.m2.2.2.cmml" xref="Thmdefinition1.p1.2.2.m2.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmdefinition1.p1.2.2.m2.2c">r^{\prime}(x,y)</annotation><annotation encoding="application/x-llamapun" id="Thmdefinition1.p1.2.2.m2.2d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y )</annotation></semantics></math> are equivalent iff <math alttext="{r(x,y)-r^{\prime}(x,y)=f(x)}" class="ltx_Math" display="inline" id="Thmdefinition1.p1.3.3.m3.5"><semantics id="Thmdefinition1.p1.3.3.m3.5a"><mrow id="Thmdefinition1.p1.3.3.m3.5.6" xref="Thmdefinition1.p1.3.3.m3.5.6.cmml"><mrow id="Thmdefinition1.p1.3.3.m3.5.6.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.cmml"><mrow id="Thmdefinition1.p1.3.3.m3.5.6.2.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.cmml"><mi id="Thmdefinition1.p1.3.3.m3.5.6.2.2.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.2.cmml">r</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.2.1" mathvariant="italic" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.1.cmml">⁢</mo><mrow id="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.1.cmml"><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.2.1" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.1.cmml">(</mo><mi id="Thmdefinition1.p1.3.3.m3.1.1" xref="Thmdefinition1.p1.3.3.m3.1.1.cmml">x</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.2.2" mathvariant="normal" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.1.cmml">,</mo><mi id="Thmdefinition1.p1.3.3.m3.2.2" xref="Thmdefinition1.p1.3.3.m3.2.2.cmml">y</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.2.3" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.1.cmml">)</mo></mrow></mrow><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.1" mathvariant="normal" xref="Thmdefinition1.p1.3.3.m3.5.6.2.1.cmml">−</mo><mrow id="Thmdefinition1.p1.3.3.m3.5.6.2.3" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.cmml"><msup id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.cmml"><mi id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.2.cmml">r</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.3" mathvariant="normal" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.3.cmml">′</mo></msup><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.3.1" mathvariant="italic" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.1.cmml">⁢</mo><mrow id="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.2" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.1.cmml"><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.2.1" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.1.cmml">(</mo><mi id="Thmdefinition1.p1.3.3.m3.3.3" xref="Thmdefinition1.p1.3.3.m3.3.3.cmml">x</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.2.2" mathvariant="normal" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.1.cmml">,</mo><mi id="Thmdefinition1.p1.3.3.m3.4.4" xref="Thmdefinition1.p1.3.3.m3.4.4.cmml">y</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.2.3" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.1.cmml">)</mo></mrow></mrow></mrow><mo id="Thmdefinition1.p1.3.3.m3.5.6.1" mathvariant="normal" xref="Thmdefinition1.p1.3.3.m3.5.6.1.cmml">=</mo><mrow id="Thmdefinition1.p1.3.3.m3.5.6.3" xref="Thmdefinition1.p1.3.3.m3.5.6.3.cmml"><mi id="Thmdefinition1.p1.3.3.m3.5.6.3.2" xref="Thmdefinition1.p1.3.3.m3.5.6.3.2.cmml">f</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.3.1" mathvariant="italic" xref="Thmdefinition1.p1.3.3.m3.5.6.3.1.cmml">⁢</mo><mrow id="Thmdefinition1.p1.3.3.m3.5.6.3.3.2" xref="Thmdefinition1.p1.3.3.m3.5.6.3.cmml"><mo id="Thmdefinition1.p1.3.3.m3.5.6.3.3.2.1" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.3.3.m3.5.6.3.cmml">(</mo><mi id="Thmdefinition1.p1.3.3.m3.5.5" xref="Thmdefinition1.p1.3.3.m3.5.5.cmml">x</mi><mo id="Thmdefinition1.p1.3.3.m3.5.6.3.3.2.2" mathvariant="normal" stretchy="false" xref="Thmdefinition1.p1.3.3.m3.5.6.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmdefinition1.p1.3.3.m3.5b"><apply id="Thmdefinition1.p1.3.3.m3.5.6.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6"><eq id="Thmdefinition1.p1.3.3.m3.5.6.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.1"></eq><apply id="Thmdefinition1.p1.3.3.m3.5.6.2.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2"><minus id="Thmdefinition1.p1.3.3.m3.5.6.2.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.1"></minus><apply id="Thmdefinition1.p1.3.3.m3.5.6.2.2.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2"><times id="Thmdefinition1.p1.3.3.m3.5.6.2.2.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.1"></times><ci id="Thmdefinition1.p1.3.3.m3.5.6.2.2.2.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.2">𝑟</ci><interval closure="open" id="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.2.3.2"><ci id="Thmdefinition1.p1.3.3.m3.1.1.cmml" xref="Thmdefinition1.p1.3.3.m3.1.1">𝑥</ci><ci id="Thmdefinition1.p1.3.3.m3.2.2.cmml" xref="Thmdefinition1.p1.3.3.m3.2.2">𝑦</ci></interval></apply><apply id="Thmdefinition1.p1.3.3.m3.5.6.2.3.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3"><times id="Thmdefinition1.p1.3.3.m3.5.6.2.3.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.1"></times><apply id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2"><csymbol cd="ambiguous" id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2">superscript</csymbol><ci id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.2.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.2">𝑟</ci><ci id="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.3.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.2.3">normal-′</ci></apply><interval closure="open" id="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.2.3.3.2"><ci id="Thmdefinition1.p1.3.3.m3.3.3.cmml" xref="Thmdefinition1.p1.3.3.m3.3.3">𝑥</ci><ci id="Thmdefinition1.p1.3.3.m3.4.4.cmml" xref="Thmdefinition1.p1.3.3.m3.4.4">𝑦</ci></interval></apply></apply><apply id="Thmdefinition1.p1.3.3.m3.5.6.3.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.3"><times id="Thmdefinition1.p1.3.3.m3.5.6.3.1.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.3.1"></times><ci id="Thmdefinition1.p1.3.3.m3.5.6.3.2.cmml" xref="Thmdefinition1.p1.3.3.m3.5.6.3.2">𝑓</ci><ci id="Thmdefinition1.p1.3.3.m3.5.5.cmml" xref="Thmdefinition1.p1.3.3.m3.5.5">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmdefinition1.p1.3.3.m3.5c">{r(x,y)-r^{\prime}(x,y)=f(x)}</annotation><annotation encoding="application/x-llamapun" id="Thmdefinition1.p1.3.3.m3.5d">italic_r ( italic_x , italic_y ) - italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_f ( italic_x )</annotation></semantics></math> for some function <math alttext="f" class="ltx_Math" display="inline" id="Thmdefinition1.p1.4.4.m4.1"><semantics id="Thmdefinition1.p1.4.4.m4.1a"><mi id="Thmdefinition1.p1.4.4.m4.1.1" xref="Thmdefinition1.p1.4.4.m4.1.1.cmml">f</mi><annotation-xml encoding="MathML-Content" id="Thmdefinition1.p1.4.4.m4.1b"><ci id="Thmdefinition1.p1.4.4.m4.1.1.cmml" xref="Thmdefinition1.p1.4.4.m4.1.1">𝑓</ci></annotation-xml><annotation encoding="application/x-tex" id="Thmdefinition1.p1.4.4.m4.1c">f</annotation><annotation encoding="application/x-llamapun" id="Thmdefinition1.p1.4.4.m4.1d">italic_f</annotation></semantics></math>.</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_para" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.1">It is easy to see that this is indeed an equivalence relation, which partitions the set of reward functions into classes. We can state the following two lemmas:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_theorem ltx_theorem_lemma" id="Thmlemma1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold" id="Thmlemma1.1.1.1">Lemma 1</span></span><span class="ltx_text ltx_font_bold" id="Thmlemma1.2.2">.</span>
</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Thmlemma1.p1">
<p class="ltx_p" id="Thmlemma1.p1.1"><span class="ltx_text ltx_font_italic" id="Thmlemma1.p1.1.1">Under the Plackett-Luce, and in particular the Bradley-Terry, preference framework, two reward functions from the same class induce the same preference distribution.</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_theorem ltx_theorem_lemma" id="Thmlemma2">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold" id="Thmlemma2.1.1.1">Lemma 2</span></span><span class="ltx_text ltx_font_bold" id="Thmlemma2.2.2">.</span>
</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Thmlemma2.p1">
<p class="ltx_p" id="Thmlemma2.p1.1"><span class="ltx_text ltx_font_italic" id="Thmlemma2.p1.1.1">Two reward functions from the same equivalence class induce the same optimal policy under the constrained RL problem.</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_para" id="S5.SS1.p3">
<p class="ltx_p" id="S5.SS1.p3.1">The proofs are straightforward and we defer them to Appendix <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS5" title="A.5 Proof of Lemma 1 and 2 ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.5</span></a>. The first lemma is a well-known under-specification issue with the Plackett-Luce family of models <cite class="ltx_cite ltx_citemacro_cite">Plackett (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib30" title="">1975</a>)</cite>. Due to this under-specification, we usually have to impose additional identifiability constraints to achieve any guarantees on the MLE estimates from Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E2" title="2 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">2</span></a> <cite class="ltx_cite ltx_citemacro_cite">Bong and Rinaldo (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib4" title="">2022</a>)</cite>. The second lemma states that all reward functions from the same class yield the same optimal policy, hence for our final objective, we are only interested in recovering an arbitrary reward function from the optimal class. We prove the following Theorem in Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS6" title="A.6 Proof of Theorem 1 ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.6</span></a>:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_theorem ltx_theorem_theorem" id="Thmtheorem1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold" id="Thmtheorem1.1.1.1">Theorem 1</span></span><span class="ltx_text ltx_font_bold" id="Thmtheorem1.2.2">.</span>
</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Thmtheorem1.p1">
<p class="ltx_p" id="Thmtheorem1.p1.3"><span class="ltx_text ltx_font_italic" id="Thmtheorem1.p1.3.3">Under mild assumptions, all reward classes consistent with the Plackett-Luce (and Bradley-Terry in particular) models can be represented with the reparameterization <math alttext="{r(x,y)=\beta\log\frac{\pi(y\mid x)}{\pi_{\text{ref}}(y\mid x)}}" class="ltx_Math" display="inline" id="Thmtheorem1.p1.1.1.m1.4"><semantics id="Thmtheorem1.p1.1.1.m1.4a"><mrow id="Thmtheorem1.p1.1.1.m1.4.5" xref="Thmtheorem1.p1.1.1.m1.4.5.cmml"><mrow id="Thmtheorem1.p1.1.1.m1.4.5.2" xref="Thmtheorem1.p1.1.1.m1.4.5.2.cmml"><mi id="Thmtheorem1.p1.1.1.m1.4.5.2.2" xref="Thmtheorem1.p1.1.1.m1.4.5.2.2.cmml">r</mi><mo id="Thmtheorem1.p1.1.1.m1.4.5.2.1" mathvariant="italic" xref="Thmtheorem1.p1.1.1.m1.4.5.2.1.cmml">⁢</mo><mrow id="Thmtheorem1.p1.1.1.m1.4.5.2.3.2" xref="Thmtheorem1.p1.1.1.m1.4.5.2.3.1.cmml"><mo id="Thmtheorem1.p1.1.1.m1.4.5.2.3.2.1" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.1.1.m1.4.5.2.3.1.cmml">(</mo><mi id="Thmtheorem1.p1.1.1.m1.3.3" xref="Thmtheorem1.p1.1.1.m1.3.3.cmml">x</mi><mo id="Thmtheorem1.p1.1.1.m1.4.5.2.3.2.2" mathvariant="normal" xref="Thmtheorem1.p1.1.1.m1.4.5.2.3.1.cmml">,</mo><mi id="Thmtheorem1.p1.1.1.m1.4.4" xref="Thmtheorem1.p1.1.1.m1.4.4.cmml">y</mi><mo id="Thmtheorem1.p1.1.1.m1.4.5.2.3.2.3" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.1.1.m1.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="Thmtheorem1.p1.1.1.m1.4.5.1" mathvariant="normal" xref="Thmtheorem1.p1.1.1.m1.4.5.1.cmml">=</mo><mrow id="Thmtheorem1.p1.1.1.m1.4.5.3" xref="Thmtheorem1.p1.1.1.m1.4.5.3.cmml"><mi id="Thmtheorem1.p1.1.1.m1.4.5.3.2" xref="Thmtheorem1.p1.1.1.m1.4.5.3.2.cmml">β</mi><mo id="Thmtheorem1.p1.1.1.m1.4.5.3.1" lspace="0.167em" mathvariant="italic" xref="Thmtheorem1.p1.1.1.m1.4.5.3.1.cmml">⁢</mo><mrow id="Thmtheorem1.p1.1.1.m1.4.5.3.3" xref="Thmtheorem1.p1.1.1.m1.4.5.3.3.cmml"><mi id="Thmtheorem1.p1.1.1.m1.4.5.3.3.1" mathvariant="normal" xref="Thmtheorem1.p1.1.1.m1.4.5.3.3.1.cmml">log</mi><mo id="Thmtheorem1.p1.1.1.m1.4.5.3.3a" lspace="0.167em" mathvariant="italic" xref="Thmtheorem1.p1.1.1.m1.4.5.3.3.cmml">⁡</mo><mfrac id="Thmtheorem1.p1.1.1.m1.2.2" xref="Thmtheorem1.p1.1.1.m1.2.2.cmml"><mrow id="Thmtheorem1.p1.1.1.m1.1.1.1" xref="Thmtheorem1.p1.1.1.m1.1.1.1.cmml"><mi id="Thmtheorem1.p1.1.1.m1.1.1.1.3" xref="Thmtheorem1.p1.1.1.m1.1.1.1.3.cmml">π</mi><mo id="Thmtheorem1.p1.1.1.m1.1.1.1.2" mathvariant="italic" xref="Thmtheorem1.p1.1.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.cmml"><mo id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.cmml"><mi id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.2" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.2.cmml">y</mi><mo id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.1" mathvariant="normal" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.3" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="Thmtheorem1.p1.1.1.m1.2.2.2" xref="Thmtheorem1.p1.1.1.m1.2.2.2.cmml"><msub id="Thmtheorem1.p1.1.1.m1.2.2.2.3" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3.cmml"><mi id="Thmtheorem1.p1.1.1.m1.2.2.2.3.2" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3.2.cmml">π</mi><mtext id="Thmtheorem1.p1.1.1.m1.2.2.2.3.3" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3.3a.cmml">𝑟𝑒𝑓</mtext></msub><mo id="Thmtheorem1.p1.1.1.m1.2.2.2.2" mathvariant="italic" xref="Thmtheorem1.p1.1.1.m1.2.2.2.2.cmml">⁢</mo><mrow id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.cmml"><mo id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.2" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.cmml"><mi id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.2" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.2.cmml">y</mi><mo id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.1" mathvariant="normal" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.1.cmml">∣</mo><mi id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.3" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.3" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmtheorem1.p1.1.1.m1.4b"><apply id="Thmtheorem1.p1.1.1.m1.4.5.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5"><eq id="Thmtheorem1.p1.1.1.m1.4.5.1.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.1"></eq><apply id="Thmtheorem1.p1.1.1.m1.4.5.2.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.2"><times id="Thmtheorem1.p1.1.1.m1.4.5.2.1.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.2.1"></times><ci id="Thmtheorem1.p1.1.1.m1.4.5.2.2.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.2.2">𝑟</ci><interval closure="open" id="Thmtheorem1.p1.1.1.m1.4.5.2.3.1.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.2.3.2"><ci id="Thmtheorem1.p1.1.1.m1.3.3.cmml" xref="Thmtheorem1.p1.1.1.m1.3.3">𝑥</ci><ci id="Thmtheorem1.p1.1.1.m1.4.4.cmml" xref="Thmtheorem1.p1.1.1.m1.4.4">𝑦</ci></interval></apply><apply id="Thmtheorem1.p1.1.1.m1.4.5.3.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.3"><times id="Thmtheorem1.p1.1.1.m1.4.5.3.1.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.3.1"></times><ci id="Thmtheorem1.p1.1.1.m1.4.5.3.2.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.3.2">𝛽</ci><apply id="Thmtheorem1.p1.1.1.m1.4.5.3.3.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.3.3"><log id="Thmtheorem1.p1.1.1.m1.4.5.3.3.1.cmml" xref="Thmtheorem1.p1.1.1.m1.4.5.3.3.1"></log><apply id="Thmtheorem1.p1.1.1.m1.2.2.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2"><divide id="Thmtheorem1.p1.1.1.m1.2.2.3.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2"></divide><apply id="Thmtheorem1.p1.1.1.m1.1.1.1.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1"><times id="Thmtheorem1.p1.1.1.m1.1.1.1.2.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1.2"></times><ci id="Thmtheorem1.p1.1.1.m1.1.1.1.3.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1.3">𝜋</ci><apply id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.1.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.2.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.3.cmml" xref="Thmtheorem1.p1.1.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="Thmtheorem1.p1.1.1.m1.2.2.2.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2"><times id="Thmtheorem1.p1.1.1.m1.2.2.2.2.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.2"></times><apply id="Thmtheorem1.p1.1.1.m1.2.2.2.3.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3"><csymbol cd="ambiguous" id="Thmtheorem1.p1.1.1.m1.2.2.2.3.1.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3">subscript</csymbol><ci id="Thmtheorem1.p1.1.1.m1.2.2.2.3.2.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3.2">𝜋</ci><ci id="Thmtheorem1.p1.1.1.m1.2.2.2.3.3a.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3.3"><mtext id="Thmtheorem1.p1.1.1.m1.2.2.2.3.3.cmml" mathsize="50%" xref="Thmtheorem1.p1.1.1.m1.2.2.2.3.3">𝑟𝑒𝑓</mtext></ci></apply><apply id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1"><csymbol cd="latexml" id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.1.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.2.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.3.cmml" xref="Thmtheorem1.p1.1.1.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmtheorem1.p1.1.1.m1.4c">{r(x,y)=\beta\log\frac{\pi(y\mid x)}{\pi_{\text{ref}}(y\mid x)}}</annotation><annotation encoding="application/x-llamapun" id="Thmtheorem1.p1.1.1.m1.4d">italic_r ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG</annotation></semantics></math> for some model <math alttext="\pi(y\mid x)" class="ltx_Math" display="inline" id="Thmtheorem1.p1.2.2.m2.1"><semantics id="Thmtheorem1.p1.2.2.m2.1a"><mrow id="Thmtheorem1.p1.2.2.m2.1.1" xref="Thmtheorem1.p1.2.2.m2.1.1.cmml"><mi id="Thmtheorem1.p1.2.2.m2.1.1.3" xref="Thmtheorem1.p1.2.2.m2.1.1.3.cmml">π</mi><mo id="Thmtheorem1.p1.2.2.m2.1.1.2" mathvariant="italic" xref="Thmtheorem1.p1.2.2.m2.1.1.2.cmml">⁢</mo><mrow id="Thmtheorem1.p1.2.2.m2.1.1.1.1" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.cmml"><mo id="Thmtheorem1.p1.2.2.m2.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.cmml">(</mo><mrow id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.cmml"><mi id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.2" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.2.cmml">y</mi><mo id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.1" mathvariant="normal" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.1.cmml">∣</mo><mi id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.3" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="Thmtheorem1.p1.2.2.m2.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmtheorem1.p1.2.2.m2.1b"><apply id="Thmtheorem1.p1.2.2.m2.1.1.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1"><times id="Thmtheorem1.p1.2.2.m2.1.1.2.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1.2"></times><ci id="Thmtheorem1.p1.2.2.m2.1.1.3.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1.3">𝜋</ci><apply id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1"><csymbol cd="latexml" id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.1.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.1">conditional</csymbol><ci id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.2.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.2">𝑦</ci><ci id="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.3.cmml" xref="Thmtheorem1.p1.2.2.m2.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmtheorem1.p1.2.2.m2.1c">\pi(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="Thmtheorem1.p1.2.2.m2.1d">italic_π ( italic_y ∣ italic_x )</annotation></semantics></math> and a given reference model <math alttext="\pi_{\text{ref}}(y\mid x)" class="ltx_Math" display="inline" id="Thmtheorem1.p1.3.3.m3.1"><semantics id="Thmtheorem1.p1.3.3.m3.1a"><mrow id="Thmtheorem1.p1.3.3.m3.1.1" xref="Thmtheorem1.p1.3.3.m3.1.1.cmml"><msub id="Thmtheorem1.p1.3.3.m3.1.1.3" xref="Thmtheorem1.p1.3.3.m3.1.1.3.cmml"><mi id="Thmtheorem1.p1.3.3.m3.1.1.3.2" xref="Thmtheorem1.p1.3.3.m3.1.1.3.2.cmml">π</mi><mtext id="Thmtheorem1.p1.3.3.m3.1.1.3.3" xref="Thmtheorem1.p1.3.3.m3.1.1.3.3a.cmml">𝑟𝑒𝑓</mtext></msub><mo id="Thmtheorem1.p1.3.3.m3.1.1.2" mathvariant="italic" xref="Thmtheorem1.p1.3.3.m3.1.1.2.cmml">⁢</mo><mrow id="Thmtheorem1.p1.3.3.m3.1.1.1.1" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.cmml"><mo id="Thmtheorem1.p1.3.3.m3.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.cmml">(</mo><mrow id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.cmml"><mi id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.2" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.2.cmml">y</mi><mo id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.1" mathvariant="normal" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.1.cmml">∣</mo><mi id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.3" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="Thmtheorem1.p1.3.3.m3.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmtheorem1.p1.3.3.m3.1b"><apply id="Thmtheorem1.p1.3.3.m3.1.1.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1"><times id="Thmtheorem1.p1.3.3.m3.1.1.2.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.2"></times><apply id="Thmtheorem1.p1.3.3.m3.1.1.3.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.3"><csymbol cd="ambiguous" id="Thmtheorem1.p1.3.3.m3.1.1.3.1.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.3">subscript</csymbol><ci id="Thmtheorem1.p1.3.3.m3.1.1.3.2.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.3.2">𝜋</ci><ci id="Thmtheorem1.p1.3.3.m3.1.1.3.3a.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.3.3"><mtext id="Thmtheorem1.p1.3.3.m3.1.1.3.3.cmml" mathsize="70%" xref="Thmtheorem1.p1.3.3.m3.1.1.3.3">𝑟𝑒𝑓</mtext></ci></apply><apply id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1"><csymbol cd="latexml" id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.1.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.1">conditional</csymbol><ci id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.2.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.2">𝑦</ci><ci id="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.3.cmml" xref="Thmtheorem1.p1.3.3.m3.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmtheorem1.p1.3.3.m3.1c">\pi_{\text{ref}}(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="Thmtheorem1.p1.3.3.m3.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x )</annotation></semantics></math>.</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_proof" id="S5.SS1.1">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof Sketch.</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S5.SS1.1.p1">
<p class="ltx_p" id="S5.SS1.1.p1.4">Consider any reward function <math alttext="r(x,y)" class="ltx_Math" display="inline" id="S5.SS1.1.p1.1.m1.2"><semantics id="S5.SS1.1.p1.1.m1.2a"><mrow id="S5.SS1.1.p1.1.m1.2.3" xref="S5.SS1.1.p1.1.m1.2.3.cmml"><mi id="S5.SS1.1.p1.1.m1.2.3.2" xref="S5.SS1.1.p1.1.m1.2.3.2.cmml">r</mi><mo id="S5.SS1.1.p1.1.m1.2.3.1" xref="S5.SS1.1.p1.1.m1.2.3.1.cmml">⁢</mo><mrow id="S5.SS1.1.p1.1.m1.2.3.3.2" xref="S5.SS1.1.p1.1.m1.2.3.3.1.cmml"><mo id="S5.SS1.1.p1.1.m1.2.3.3.2.1" stretchy="false" xref="S5.SS1.1.p1.1.m1.2.3.3.1.cmml">(</mo><mi id="S5.SS1.1.p1.1.m1.1.1" xref="S5.SS1.1.p1.1.m1.1.1.cmml">x</mi><mo id="S5.SS1.1.p1.1.m1.2.3.3.2.2" xref="S5.SS1.1.p1.1.m1.2.3.3.1.cmml">,</mo><mi id="S5.SS1.1.p1.1.m1.2.2" xref="S5.SS1.1.p1.1.m1.2.2.cmml">y</mi><mo id="S5.SS1.1.p1.1.m1.2.3.3.2.3" stretchy="false" xref="S5.SS1.1.p1.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.1.m1.2b"><apply id="S5.SS1.1.p1.1.m1.2.3.cmml" xref="S5.SS1.1.p1.1.m1.2.3"><times id="S5.SS1.1.p1.1.m1.2.3.1.cmml" xref="S5.SS1.1.p1.1.m1.2.3.1"></times><ci id="S5.SS1.1.p1.1.m1.2.3.2.cmml" xref="S5.SS1.1.p1.1.m1.2.3.2">𝑟</ci><interval closure="open" id="S5.SS1.1.p1.1.m1.2.3.3.1.cmml" xref="S5.SS1.1.p1.1.m1.2.3.3.2"><ci id="S5.SS1.1.p1.1.m1.1.1.cmml" xref="S5.SS1.1.p1.1.m1.1.1">𝑥</ci><ci id="S5.SS1.1.p1.1.m1.2.2.cmml" xref="S5.SS1.1.p1.1.m1.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.1.m1.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.1.m1.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math>, which induces a corresponding optimal model <math alttext="\pi_{r}(y\mid x)" class="ltx_Math" display="inline" id="S5.SS1.1.p1.2.m2.1"><semantics id="S5.SS1.1.p1.2.m2.1a"><mrow id="S5.SS1.1.p1.2.m2.1.1" xref="S5.SS1.1.p1.2.m2.1.1.cmml"><msub id="S5.SS1.1.p1.2.m2.1.1.3" xref="S5.SS1.1.p1.2.m2.1.1.3.cmml"><mi id="S5.SS1.1.p1.2.m2.1.1.3.2" xref="S5.SS1.1.p1.2.m2.1.1.3.2.cmml">π</mi><mi id="S5.SS1.1.p1.2.m2.1.1.3.3" xref="S5.SS1.1.p1.2.m2.1.1.3.3.cmml">r</mi></msub><mo id="S5.SS1.1.p1.2.m2.1.1.2" xref="S5.SS1.1.p1.2.m2.1.1.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.2.m2.1.1.1.1" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.cmml"><mo id="S5.SS1.1.p1.2.m2.1.1.1.1.2" stretchy="false" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS1.1.p1.2.m2.1.1.1.1.1" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.cmml"><mi id="S5.SS1.1.p1.2.m2.1.1.1.1.1.2" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.2.cmml">y</mi><mo id="S5.SS1.1.p1.2.m2.1.1.1.1.1.1" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.SS1.1.p1.2.m2.1.1.1.1.1.3" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS1.1.p1.2.m2.1.1.1.1.3" stretchy="false" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.2.m2.1b"><apply id="S5.SS1.1.p1.2.m2.1.1.cmml" xref="S5.SS1.1.p1.2.m2.1.1"><times id="S5.SS1.1.p1.2.m2.1.1.2.cmml" xref="S5.SS1.1.p1.2.m2.1.1.2"></times><apply id="S5.SS1.1.p1.2.m2.1.1.3.cmml" xref="S5.SS1.1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.1.p1.2.m2.1.1.3.1.cmml" xref="S5.SS1.1.p1.2.m2.1.1.3">subscript</csymbol><ci id="S5.SS1.1.p1.2.m2.1.1.3.2.cmml" xref="S5.SS1.1.p1.2.m2.1.1.3.2">𝜋</ci><ci id="S5.SS1.1.p1.2.m2.1.1.3.3.cmml" xref="S5.SS1.1.p1.2.m2.1.1.3.3">𝑟</ci></apply><apply id="S5.SS1.1.p1.2.m2.1.1.1.1.1.cmml" xref="S5.SS1.1.p1.2.m2.1.1.1.1"><csymbol cd="latexml" id="S5.SS1.1.p1.2.m2.1.1.1.1.1.1.cmml" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS1.1.p1.2.m2.1.1.1.1.1.2.cmml" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.2">𝑦</ci><ci id="S5.SS1.1.p1.2.m2.1.1.1.1.1.3.cmml" xref="S5.SS1.1.p1.2.m2.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.2.m2.1c">\pi_{r}(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.2.m2.1d">italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y ∣ italic_x )</annotation></semantics></math>, specified by Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>. We will show that a reward function from the equivalence class of <math alttext="r" class="ltx_Math" display="inline" id="S5.SS1.1.p1.3.m3.1"><semantics id="S5.SS1.1.p1.3.m3.1a"><mi id="S5.SS1.1.p1.3.m3.1.1" xref="S5.SS1.1.p1.3.m3.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.3.m3.1b"><ci id="S5.SS1.1.p1.3.m3.1.1.cmml" xref="S5.SS1.1.p1.3.m3.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.3.m3.1c">r</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.3.m3.1d">italic_r</annotation></semantics></math> can be represented using the reparameterization given above. We define the projection <math alttext="f" class="ltx_Math" display="inline" id="S5.SS1.1.p1.4.m4.1"><semantics id="S5.SS1.1.p1.4.m4.1a"><mi id="S5.SS1.1.p1.4.m4.1.1" xref="S5.SS1.1.p1.4.m4.1.1.cmml">f</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.4.m4.1b"><ci id="S5.SS1.1.p1.4.m4.1.1.cmml" xref="S5.SS1.1.p1.4.m4.1.1">𝑓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.4.m4.1c">f</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.4.m4.1d">italic_f</annotation></semantics></math> as</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S5.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f(r;\pi_{\text{ref}},\beta)(x,y)=r(x,y)-\beta\log\sum_{y}\pi_{\text{ref}}(y%
\mid x)\exp\left(\frac{1}{\beta}r(x,y)\right)" class="ltx_Math" display="block" id="S5.E8.m1.12"><semantics id="S5.E8.m1.12a"><mrow id="S5.E8.m1.12.12" xref="S5.E8.m1.12.12.cmml"><mrow id="S5.E8.m1.10.10.1" xref="S5.E8.m1.10.10.1.cmml"><mi id="S5.E8.m1.10.10.1.3" xref="S5.E8.m1.10.10.1.3.cmml">f</mi><mo id="S5.E8.m1.10.10.1.2" xref="S5.E8.m1.10.10.1.2.cmml">⁢</mo><mrow id="S5.E8.m1.10.10.1.1.1" xref="S5.E8.m1.10.10.1.1.2.cmml"><mo id="S5.E8.m1.10.10.1.1.1.2" stretchy="false" xref="S5.E8.m1.10.10.1.1.2.cmml">(</mo><mi id="S5.E8.m1.1.1" xref="S5.E8.m1.1.1.cmml">r</mi><mo id="S5.E8.m1.10.10.1.1.1.3" xref="S5.E8.m1.10.10.1.1.2.cmml">;</mo><msub id="S5.E8.m1.10.10.1.1.1.1" xref="S5.E8.m1.10.10.1.1.1.1.cmml"><mi id="S5.E8.m1.10.10.1.1.1.1.2" xref="S5.E8.m1.10.10.1.1.1.1.2.cmml">π</mi><mtext id="S5.E8.m1.10.10.1.1.1.1.3" xref="S5.E8.m1.10.10.1.1.1.1.3a.cmml">ref</mtext></msub><mo id="S5.E8.m1.10.10.1.1.1.4" xref="S5.E8.m1.10.10.1.1.2.cmml">,</mo><mi id="S5.E8.m1.2.2" xref="S5.E8.m1.2.2.cmml">β</mi><mo id="S5.E8.m1.10.10.1.1.1.5" stretchy="false" xref="S5.E8.m1.10.10.1.1.2.cmml">)</mo></mrow><mo id="S5.E8.m1.10.10.1.2a" xref="S5.E8.m1.10.10.1.2.cmml">⁢</mo><mrow id="S5.E8.m1.10.10.1.4.2" xref="S5.E8.m1.10.10.1.4.1.cmml"><mo id="S5.E8.m1.10.10.1.4.2.1" stretchy="false" xref="S5.E8.m1.10.10.1.4.1.cmml">(</mo><mi id="S5.E8.m1.3.3" xref="S5.E8.m1.3.3.cmml">x</mi><mo id="S5.E8.m1.10.10.1.4.2.2" xref="S5.E8.m1.10.10.1.4.1.cmml">,</mo><mi id="S5.E8.m1.4.4" xref="S5.E8.m1.4.4.cmml">y</mi><mo id="S5.E8.m1.10.10.1.4.2.3" stretchy="false" xref="S5.E8.m1.10.10.1.4.1.cmml">)</mo></mrow></mrow><mo id="S5.E8.m1.12.12.4" xref="S5.E8.m1.12.12.4.cmml">=</mo><mrow id="S5.E8.m1.12.12.3" xref="S5.E8.m1.12.12.3.cmml"><mrow id="S5.E8.m1.12.12.3.4" xref="S5.E8.m1.12.12.3.4.cmml"><mi id="S5.E8.m1.12.12.3.4.2" xref="S5.E8.m1.12.12.3.4.2.cmml">r</mi><mo id="S5.E8.m1.12.12.3.4.1" xref="S5.E8.m1.12.12.3.4.1.cmml">⁢</mo><mrow id="S5.E8.m1.12.12.3.4.3.2" xref="S5.E8.m1.12.12.3.4.3.1.cmml"><mo id="S5.E8.m1.12.12.3.4.3.2.1" stretchy="false" xref="S5.E8.m1.12.12.3.4.3.1.cmml">(</mo><mi id="S5.E8.m1.5.5" xref="S5.E8.m1.5.5.cmml">x</mi><mo id="S5.E8.m1.12.12.3.4.3.2.2" xref="S5.E8.m1.12.12.3.4.3.1.cmml">,</mo><mi id="S5.E8.m1.6.6" xref="S5.E8.m1.6.6.cmml">y</mi><mo id="S5.E8.m1.12.12.3.4.3.2.3" stretchy="false" xref="S5.E8.m1.12.12.3.4.3.1.cmml">)</mo></mrow></mrow><mo id="S5.E8.m1.12.12.3.3" xref="S5.E8.m1.12.12.3.3.cmml">−</mo><mrow id="S5.E8.m1.12.12.3.2" xref="S5.E8.m1.12.12.3.2.cmml"><mi id="S5.E8.m1.12.12.3.2.4" xref="S5.E8.m1.12.12.3.2.4.cmml">β</mi><mo id="S5.E8.m1.12.12.3.2.3" lspace="0.167em" xref="S5.E8.m1.12.12.3.2.3.cmml">⁢</mo><mi id="S5.E8.m1.12.12.3.2.5" xref="S5.E8.m1.12.12.3.2.5.cmml">log</mi><mo id="S5.E8.m1.12.12.3.2.3a" xref="S5.E8.m1.12.12.3.2.3.cmml">⁢</mo><mrow id="S5.E8.m1.12.12.3.2.2" xref="S5.E8.m1.12.12.3.2.2.cmml"><munder id="S5.E8.m1.12.12.3.2.2.3" xref="S5.E8.m1.12.12.3.2.2.3.cmml"><mo id="S5.E8.m1.12.12.3.2.2.3.2" movablelimits="false" xref="S5.E8.m1.12.12.3.2.2.3.2.cmml">∑</mo><mi id="S5.E8.m1.12.12.3.2.2.3.3" xref="S5.E8.m1.12.12.3.2.2.3.3.cmml">y</mi></munder><mrow id="S5.E8.m1.12.12.3.2.2.2" xref="S5.E8.m1.12.12.3.2.2.2.cmml"><msub id="S5.E8.m1.12.12.3.2.2.2.4" xref="S5.E8.m1.12.12.3.2.2.2.4.cmml"><mi id="S5.E8.m1.12.12.3.2.2.2.4.2" xref="S5.E8.m1.12.12.3.2.2.2.4.2.cmml">π</mi><mtext id="S5.E8.m1.12.12.3.2.2.2.4.3" xref="S5.E8.m1.12.12.3.2.2.2.4.3a.cmml">ref</mtext></msub><mo id="S5.E8.m1.12.12.3.2.2.2.3" xref="S5.E8.m1.12.12.3.2.2.2.3.cmml">⁢</mo><mrow id="S5.E8.m1.11.11.2.1.1.1.1.1" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.cmml"><mo id="S5.E8.m1.11.11.2.1.1.1.1.1.2" stretchy="false" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.E8.m1.11.11.2.1.1.1.1.1.1" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.cmml"><mi id="S5.E8.m1.11.11.2.1.1.1.1.1.1.2" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.E8.m1.11.11.2.1.1.1.1.1.1.1" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.E8.m1.11.11.2.1.1.1.1.1.1.3" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.E8.m1.11.11.2.1.1.1.1.1.3" stretchy="false" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S5.E8.m1.12.12.3.2.2.2.3a" lspace="0.167em" xref="S5.E8.m1.12.12.3.2.2.2.3.cmml">⁢</mo><mrow id="S5.E8.m1.12.12.3.2.2.2.2.1" xref="S5.E8.m1.12.12.3.2.2.2.2.2.cmml"><mi id="S5.E8.m1.9.9" xref="S5.E8.m1.9.9.cmml">exp</mi><mo id="S5.E8.m1.12.12.3.2.2.2.2.1a" xref="S5.E8.m1.12.12.3.2.2.2.2.2.cmml">⁡</mo><mrow id="S5.E8.m1.12.12.3.2.2.2.2.1.1" xref="S5.E8.m1.12.12.3.2.2.2.2.2.cmml"><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.2" xref="S5.E8.m1.12.12.3.2.2.2.2.2.cmml">(</mo><mrow id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.cmml"><mfrac id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.cmml"><mn id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.2" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.2.cmml">1</mn><mi id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.3" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.1" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.1.cmml">⁢</mo><mi id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.3" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.3.cmml">r</mi><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.1a" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.2" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.1.cmml"><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.2.1" stretchy="false" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.1.cmml">(</mo><mi id="S5.E8.m1.7.7" xref="S5.E8.m1.7.7.cmml">x</mi><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.2.2" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.1.cmml">,</mo><mi id="S5.E8.m1.8.8" xref="S5.E8.m1.8.8.cmml">y</mi><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.2.3" stretchy="false" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="S5.E8.m1.12.12.3.2.2.2.2.1.1.3" xref="S5.E8.m1.12.12.3.2.2.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E8.m1.12b"><apply id="S5.E8.m1.12.12.cmml" xref="S5.E8.m1.12.12"><eq id="S5.E8.m1.12.12.4.cmml" xref="S5.E8.m1.12.12.4"></eq><apply id="S5.E8.m1.10.10.1.cmml" xref="S5.E8.m1.10.10.1"><times id="S5.E8.m1.10.10.1.2.cmml" xref="S5.E8.m1.10.10.1.2"></times><ci id="S5.E8.m1.10.10.1.3.cmml" xref="S5.E8.m1.10.10.1.3">𝑓</ci><list id="S5.E8.m1.10.10.1.1.2.cmml" xref="S5.E8.m1.10.10.1.1.1"><ci id="S5.E8.m1.1.1.cmml" xref="S5.E8.m1.1.1">𝑟</ci><apply id="S5.E8.m1.10.10.1.1.1.1.cmml" xref="S5.E8.m1.10.10.1.1.1.1"><csymbol cd="ambiguous" id="S5.E8.m1.10.10.1.1.1.1.1.cmml" xref="S5.E8.m1.10.10.1.1.1.1">subscript</csymbol><ci id="S5.E8.m1.10.10.1.1.1.1.2.cmml" xref="S5.E8.m1.10.10.1.1.1.1.2">𝜋</ci><ci id="S5.E8.m1.10.10.1.1.1.1.3a.cmml" xref="S5.E8.m1.10.10.1.1.1.1.3"><mtext id="S5.E8.m1.10.10.1.1.1.1.3.cmml" mathsize="70%" xref="S5.E8.m1.10.10.1.1.1.1.3">ref</mtext></ci></apply><ci id="S5.E8.m1.2.2.cmml" xref="S5.E8.m1.2.2">𝛽</ci></list><interval closure="open" id="S5.E8.m1.10.10.1.4.1.cmml" xref="S5.E8.m1.10.10.1.4.2"><ci id="S5.E8.m1.3.3.cmml" xref="S5.E8.m1.3.3">𝑥</ci><ci id="S5.E8.m1.4.4.cmml" xref="S5.E8.m1.4.4">𝑦</ci></interval></apply><apply id="S5.E8.m1.12.12.3.cmml" xref="S5.E8.m1.12.12.3"><minus id="S5.E8.m1.12.12.3.3.cmml" xref="S5.E8.m1.12.12.3.3"></minus><apply id="S5.E8.m1.12.12.3.4.cmml" xref="S5.E8.m1.12.12.3.4"><times id="S5.E8.m1.12.12.3.4.1.cmml" xref="S5.E8.m1.12.12.3.4.1"></times><ci id="S5.E8.m1.12.12.3.4.2.cmml" xref="S5.E8.m1.12.12.3.4.2">𝑟</ci><interval closure="open" id="S5.E8.m1.12.12.3.4.3.1.cmml" xref="S5.E8.m1.12.12.3.4.3.2"><ci id="S5.E8.m1.5.5.cmml" xref="S5.E8.m1.5.5">𝑥</ci><ci id="S5.E8.m1.6.6.cmml" xref="S5.E8.m1.6.6">𝑦</ci></interval></apply><apply id="S5.E8.m1.12.12.3.2.cmml" xref="S5.E8.m1.12.12.3.2"><times id="S5.E8.m1.12.12.3.2.3.cmml" xref="S5.E8.m1.12.12.3.2.3"></times><ci id="S5.E8.m1.12.12.3.2.4.cmml" xref="S5.E8.m1.12.12.3.2.4">𝛽</ci><log id="S5.E8.m1.12.12.3.2.5.cmml" xref="S5.E8.m1.12.12.3.2.5"></log><apply id="S5.E8.m1.12.12.3.2.2.cmml" xref="S5.E8.m1.12.12.3.2.2"><apply id="S5.E8.m1.12.12.3.2.2.3.cmml" xref="S5.E8.m1.12.12.3.2.2.3"><csymbol cd="ambiguous" id="S5.E8.m1.12.12.3.2.2.3.1.cmml" xref="S5.E8.m1.12.12.3.2.2.3">subscript</csymbol><sum id="S5.E8.m1.12.12.3.2.2.3.2.cmml" xref="S5.E8.m1.12.12.3.2.2.3.2"></sum><ci id="S5.E8.m1.12.12.3.2.2.3.3.cmml" xref="S5.E8.m1.12.12.3.2.2.3.3">𝑦</ci></apply><apply id="S5.E8.m1.12.12.3.2.2.2.cmml" xref="S5.E8.m1.12.12.3.2.2.2"><times id="S5.E8.m1.12.12.3.2.2.2.3.cmml" xref="S5.E8.m1.12.12.3.2.2.2.3"></times><apply id="S5.E8.m1.12.12.3.2.2.2.4.cmml" xref="S5.E8.m1.12.12.3.2.2.2.4"><csymbol cd="ambiguous" id="S5.E8.m1.12.12.3.2.2.2.4.1.cmml" xref="S5.E8.m1.12.12.3.2.2.2.4">subscript</csymbol><ci id="S5.E8.m1.12.12.3.2.2.2.4.2.cmml" xref="S5.E8.m1.12.12.3.2.2.2.4.2">𝜋</ci><ci id="S5.E8.m1.12.12.3.2.2.2.4.3a.cmml" xref="S5.E8.m1.12.12.3.2.2.2.4.3"><mtext id="S5.E8.m1.12.12.3.2.2.2.4.3.cmml" mathsize="70%" xref="S5.E8.m1.12.12.3.2.2.2.4.3">ref</mtext></ci></apply><apply id="S5.E8.m1.11.11.2.1.1.1.1.1.1.cmml" xref="S5.E8.m1.11.11.2.1.1.1.1.1"><csymbol cd="latexml" id="S5.E8.m1.11.11.2.1.1.1.1.1.1.1.cmml" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.E8.m1.11.11.2.1.1.1.1.1.1.2.cmml" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.2">𝑦</ci><ci id="S5.E8.m1.11.11.2.1.1.1.1.1.1.3.cmml" xref="S5.E8.m1.11.11.2.1.1.1.1.1.1.3">𝑥</ci></apply><apply id="S5.E8.m1.12.12.3.2.2.2.2.2.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1"><exp id="S5.E8.m1.9.9.cmml" xref="S5.E8.m1.9.9"></exp><apply id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1"><times id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.1.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.1"></times><apply id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2"><divide id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.1.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2"></divide><cn id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.2.cmml" type="integer" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.2">1</cn><ci id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.3.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.3.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.1.cmml" xref="S5.E8.m1.12.12.3.2.2.2.2.1.1.1.4.2"><ci id="S5.E8.m1.7.7.cmml" xref="S5.E8.m1.7.7">𝑥</ci><ci id="S5.E8.m1.8.8.cmml" xref="S5.E8.m1.8.8">𝑦</ci></interval></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E8.m1.12c">f(r;\pi_{\text{ref}},\beta)(x,y)=r(x,y)-\beta\log\sum_{y}\pi_{\text{ref}}(y%
\mid x)\exp\left(\frac{1}{\beta}r(x,y)\right)</annotation><annotation encoding="application/x-llamapun" id="S5.E8.m1.12d">italic_f ( italic_r ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) ( italic_x , italic_y ) = italic_r ( italic_x , italic_y ) - italic_β roman_log ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.1.p1.13">The operator <math alttext="f" class="ltx_Math" display="inline" id="S5.SS1.1.p1.5.m1.1"><semantics id="S5.SS1.1.p1.5.m1.1a"><mi id="S5.SS1.1.p1.5.m1.1.1" xref="S5.SS1.1.p1.5.m1.1.1.cmml">f</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.5.m1.1b"><ci id="S5.SS1.1.p1.5.m1.1.1.cmml" xref="S5.SS1.1.p1.5.m1.1.1">𝑓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.5.m1.1c">f</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.5.m1.1d">italic_f</annotation></semantics></math> simply normalizes the reward function with the logarithm of the partition function of <math alttext="\pi_{r}" class="ltx_Math" display="inline" id="S5.SS1.1.p1.6.m2.1"><semantics id="S5.SS1.1.p1.6.m2.1a"><msub id="S5.SS1.1.p1.6.m2.1.1" xref="S5.SS1.1.p1.6.m2.1.1.cmml"><mi id="S5.SS1.1.p1.6.m2.1.1.2" xref="S5.SS1.1.p1.6.m2.1.1.2.cmml">π</mi><mi id="S5.SS1.1.p1.6.m2.1.1.3" xref="S5.SS1.1.p1.6.m2.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.6.m2.1b"><apply id="S5.SS1.1.p1.6.m2.1.1.cmml" xref="S5.SS1.1.p1.6.m2.1.1"><csymbol cd="ambiguous" id="S5.SS1.1.p1.6.m2.1.1.1.cmml" xref="S5.SS1.1.p1.6.m2.1.1">subscript</csymbol><ci id="S5.SS1.1.p1.6.m2.1.1.2.cmml" xref="S5.SS1.1.p1.6.m2.1.1.2">𝜋</ci><ci id="S5.SS1.1.p1.6.m2.1.1.3.cmml" xref="S5.SS1.1.p1.6.m2.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.6.m2.1c">\pi_{r}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.6.m2.1d">italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math>. Since the added normalization term is only a function of the prefix <math alttext="x" class="ltx_Math" display="inline" id="S5.SS1.1.p1.7.m3.1"><semantics id="S5.SS1.1.p1.7.m3.1a"><mi id="S5.SS1.1.p1.7.m3.1.1" xref="S5.SS1.1.p1.7.m3.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.7.m3.1b"><ci id="S5.SS1.1.p1.7.m3.1.1.cmml" xref="S5.SS1.1.p1.7.m3.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.7.m3.1c">x</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.7.m3.1d">italic_x</annotation></semantics></math>, <math alttext="f(r;\pi_{\text{ref}},\beta)(x,y)" class="ltx_Math" display="inline" id="S5.SS1.1.p1.8.m4.5"><semantics id="S5.SS1.1.p1.8.m4.5a"><mrow id="S5.SS1.1.p1.8.m4.5.5" xref="S5.SS1.1.p1.8.m4.5.5.cmml"><mi id="S5.SS1.1.p1.8.m4.5.5.3" xref="S5.SS1.1.p1.8.m4.5.5.3.cmml">f</mi><mo id="S5.SS1.1.p1.8.m4.5.5.2" xref="S5.SS1.1.p1.8.m4.5.5.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.8.m4.5.5.1.1" xref="S5.SS1.1.p1.8.m4.5.5.1.2.cmml"><mo id="S5.SS1.1.p1.8.m4.5.5.1.1.2" stretchy="false" xref="S5.SS1.1.p1.8.m4.5.5.1.2.cmml">(</mo><mi id="S5.SS1.1.p1.8.m4.1.1" xref="S5.SS1.1.p1.8.m4.1.1.cmml">r</mi><mo id="S5.SS1.1.p1.8.m4.5.5.1.1.3" xref="S5.SS1.1.p1.8.m4.5.5.1.2.cmml">;</mo><msub id="S5.SS1.1.p1.8.m4.5.5.1.1.1" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1.cmml"><mi id="S5.SS1.1.p1.8.m4.5.5.1.1.1.2" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1.2.cmml">π</mi><mtext id="S5.SS1.1.p1.8.m4.5.5.1.1.1.3" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1.3a.cmml">ref</mtext></msub><mo id="S5.SS1.1.p1.8.m4.5.5.1.1.4" xref="S5.SS1.1.p1.8.m4.5.5.1.2.cmml">,</mo><mi id="S5.SS1.1.p1.8.m4.2.2" xref="S5.SS1.1.p1.8.m4.2.2.cmml">β</mi><mo id="S5.SS1.1.p1.8.m4.5.5.1.1.5" stretchy="false" xref="S5.SS1.1.p1.8.m4.5.5.1.2.cmml">)</mo></mrow><mo id="S5.SS1.1.p1.8.m4.5.5.2a" xref="S5.SS1.1.p1.8.m4.5.5.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.8.m4.5.5.4.2" xref="S5.SS1.1.p1.8.m4.5.5.4.1.cmml"><mo id="S5.SS1.1.p1.8.m4.5.5.4.2.1" stretchy="false" xref="S5.SS1.1.p1.8.m4.5.5.4.1.cmml">(</mo><mi id="S5.SS1.1.p1.8.m4.3.3" xref="S5.SS1.1.p1.8.m4.3.3.cmml">x</mi><mo id="S5.SS1.1.p1.8.m4.5.5.4.2.2" xref="S5.SS1.1.p1.8.m4.5.5.4.1.cmml">,</mo><mi id="S5.SS1.1.p1.8.m4.4.4" xref="S5.SS1.1.p1.8.m4.4.4.cmml">y</mi><mo id="S5.SS1.1.p1.8.m4.5.5.4.2.3" stretchy="false" xref="S5.SS1.1.p1.8.m4.5.5.4.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.8.m4.5b"><apply id="S5.SS1.1.p1.8.m4.5.5.cmml" xref="S5.SS1.1.p1.8.m4.5.5"><times id="S5.SS1.1.p1.8.m4.5.5.2.cmml" xref="S5.SS1.1.p1.8.m4.5.5.2"></times><ci id="S5.SS1.1.p1.8.m4.5.5.3.cmml" xref="S5.SS1.1.p1.8.m4.5.5.3">𝑓</ci><list id="S5.SS1.1.p1.8.m4.5.5.1.2.cmml" xref="S5.SS1.1.p1.8.m4.5.5.1.1"><ci id="S5.SS1.1.p1.8.m4.1.1.cmml" xref="S5.SS1.1.p1.8.m4.1.1">𝑟</ci><apply id="S5.SS1.1.p1.8.m4.5.5.1.1.1.cmml" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1"><csymbol cd="ambiguous" id="S5.SS1.1.p1.8.m4.5.5.1.1.1.1.cmml" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1">subscript</csymbol><ci id="S5.SS1.1.p1.8.m4.5.5.1.1.1.2.cmml" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1.2">𝜋</ci><ci id="S5.SS1.1.p1.8.m4.5.5.1.1.1.3a.cmml" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1.3"><mtext id="S5.SS1.1.p1.8.m4.5.5.1.1.1.3.cmml" mathsize="70%" xref="S5.SS1.1.p1.8.m4.5.5.1.1.1.3">ref</mtext></ci></apply><ci id="S5.SS1.1.p1.8.m4.2.2.cmml" xref="S5.SS1.1.p1.8.m4.2.2">𝛽</ci></list><interval closure="open" id="S5.SS1.1.p1.8.m4.5.5.4.1.cmml" xref="S5.SS1.1.p1.8.m4.5.5.4.2"><ci id="S5.SS1.1.p1.8.m4.3.3.cmml" xref="S5.SS1.1.p1.8.m4.3.3">𝑥</ci><ci id="S5.SS1.1.p1.8.m4.4.4.cmml" xref="S5.SS1.1.p1.8.m4.4.4">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.8.m4.5c">f(r;\pi_{\text{ref}},\beta)(x,y)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.8.m4.5d">italic_f ( italic_r ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) ( italic_x , italic_y )</annotation></semantics></math> is a reward function in the equivalence class of <math alttext="r(x,y)" class="ltx_Math" display="inline" id="S5.SS1.1.p1.9.m5.2"><semantics id="S5.SS1.1.p1.9.m5.2a"><mrow id="S5.SS1.1.p1.9.m5.2.3" xref="S5.SS1.1.p1.9.m5.2.3.cmml"><mi id="S5.SS1.1.p1.9.m5.2.3.2" xref="S5.SS1.1.p1.9.m5.2.3.2.cmml">r</mi><mo id="S5.SS1.1.p1.9.m5.2.3.1" xref="S5.SS1.1.p1.9.m5.2.3.1.cmml">⁢</mo><mrow id="S5.SS1.1.p1.9.m5.2.3.3.2" xref="S5.SS1.1.p1.9.m5.2.3.3.1.cmml"><mo id="S5.SS1.1.p1.9.m5.2.3.3.2.1" stretchy="false" xref="S5.SS1.1.p1.9.m5.2.3.3.1.cmml">(</mo><mi id="S5.SS1.1.p1.9.m5.1.1" xref="S5.SS1.1.p1.9.m5.1.1.cmml">x</mi><mo id="S5.SS1.1.p1.9.m5.2.3.3.2.2" xref="S5.SS1.1.p1.9.m5.2.3.3.1.cmml">,</mo><mi id="S5.SS1.1.p1.9.m5.2.2" xref="S5.SS1.1.p1.9.m5.2.2.cmml">y</mi><mo id="S5.SS1.1.p1.9.m5.2.3.3.2.3" stretchy="false" xref="S5.SS1.1.p1.9.m5.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.9.m5.2b"><apply id="S5.SS1.1.p1.9.m5.2.3.cmml" xref="S5.SS1.1.p1.9.m5.2.3"><times id="S5.SS1.1.p1.9.m5.2.3.1.cmml" xref="S5.SS1.1.p1.9.m5.2.3.1"></times><ci id="S5.SS1.1.p1.9.m5.2.3.2.cmml" xref="S5.SS1.1.p1.9.m5.2.3.2">𝑟</ci><interval closure="open" id="S5.SS1.1.p1.9.m5.2.3.3.1.cmml" xref="S5.SS1.1.p1.9.m5.2.3.3.2"><ci id="S5.SS1.1.p1.9.m5.1.1.cmml" xref="S5.SS1.1.p1.9.m5.1.1">𝑥</ci><ci id="S5.SS1.1.p1.9.m5.2.2.cmml" xref="S5.SS1.1.p1.9.m5.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.9.m5.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.9.m5.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math>. Finally, replacing <math alttext="r" class="ltx_Math" display="inline" id="S5.SS1.1.p1.10.m6.1"><semantics id="S5.SS1.1.p1.10.m6.1a"><mi id="S5.SS1.1.p1.10.m6.1.1" xref="S5.SS1.1.p1.10.m6.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.10.m6.1b"><ci id="S5.SS1.1.p1.10.m6.1.1.cmml" xref="S5.SS1.1.p1.10.m6.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.10.m6.1c">r</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.10.m6.1d">italic_r</annotation></semantics></math> with the RHS of Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E5" title="5 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a> (which holds for any reward function), we have <math alttext="f(r;\pi_{\text{ref}},\beta)(x,y)=\beta\log\frac{\pi_{r}(y\mid x)}{\pi_{\text{%
ref}}(y\mid x)}" class="ltx_Math" display="inline" id="S5.SS1.1.p1.11.m7.7"><semantics id="S5.SS1.1.p1.11.m7.7a"><mrow id="S5.SS1.1.p1.11.m7.7.7" xref="S5.SS1.1.p1.11.m7.7.7.cmml"><mrow id="S5.SS1.1.p1.11.m7.7.7.1" xref="S5.SS1.1.p1.11.m7.7.7.1.cmml"><mi id="S5.SS1.1.p1.11.m7.7.7.1.3" xref="S5.SS1.1.p1.11.m7.7.7.1.3.cmml">f</mi><mo id="S5.SS1.1.p1.11.m7.7.7.1.2" xref="S5.SS1.1.p1.11.m7.7.7.1.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.11.m7.7.7.1.1.1" xref="S5.SS1.1.p1.11.m7.7.7.1.1.2.cmml"><mo id="S5.SS1.1.p1.11.m7.7.7.1.1.1.2" stretchy="false" xref="S5.SS1.1.p1.11.m7.7.7.1.1.2.cmml">(</mo><mi id="S5.SS1.1.p1.11.m7.3.3" xref="S5.SS1.1.p1.11.m7.3.3.cmml">r</mi><mo id="S5.SS1.1.p1.11.m7.7.7.1.1.1.3" xref="S5.SS1.1.p1.11.m7.7.7.1.1.2.cmml">;</mo><msub id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.cmml"><mi id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.2" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.2.cmml">π</mi><mtext id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.3" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.3a.cmml">ref</mtext></msub><mo id="S5.SS1.1.p1.11.m7.7.7.1.1.1.4" xref="S5.SS1.1.p1.11.m7.7.7.1.1.2.cmml">,</mo><mi id="S5.SS1.1.p1.11.m7.4.4" xref="S5.SS1.1.p1.11.m7.4.4.cmml">β</mi><mo id="S5.SS1.1.p1.11.m7.7.7.1.1.1.5" stretchy="false" xref="S5.SS1.1.p1.11.m7.7.7.1.1.2.cmml">)</mo></mrow><mo id="S5.SS1.1.p1.11.m7.7.7.1.2a" xref="S5.SS1.1.p1.11.m7.7.7.1.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.11.m7.7.7.1.4.2" xref="S5.SS1.1.p1.11.m7.7.7.1.4.1.cmml"><mo id="S5.SS1.1.p1.11.m7.7.7.1.4.2.1" stretchy="false" xref="S5.SS1.1.p1.11.m7.7.7.1.4.1.cmml">(</mo><mi id="S5.SS1.1.p1.11.m7.5.5" xref="S5.SS1.1.p1.11.m7.5.5.cmml">x</mi><mo id="S5.SS1.1.p1.11.m7.7.7.1.4.2.2" xref="S5.SS1.1.p1.11.m7.7.7.1.4.1.cmml">,</mo><mi id="S5.SS1.1.p1.11.m7.6.6" xref="S5.SS1.1.p1.11.m7.6.6.cmml">y</mi><mo id="S5.SS1.1.p1.11.m7.7.7.1.4.2.3" stretchy="false" xref="S5.SS1.1.p1.11.m7.7.7.1.4.1.cmml">)</mo></mrow></mrow><mo id="S5.SS1.1.p1.11.m7.7.7.2" xref="S5.SS1.1.p1.11.m7.7.7.2.cmml">=</mo><mrow id="S5.SS1.1.p1.11.m7.7.7.3" xref="S5.SS1.1.p1.11.m7.7.7.3.cmml"><mi id="S5.SS1.1.p1.11.m7.7.7.3.2" xref="S5.SS1.1.p1.11.m7.7.7.3.2.cmml">β</mi><mo id="S5.SS1.1.p1.11.m7.7.7.3.1" lspace="0.167em" xref="S5.SS1.1.p1.11.m7.7.7.3.1.cmml">⁢</mo><mrow id="S5.SS1.1.p1.11.m7.7.7.3.3" xref="S5.SS1.1.p1.11.m7.7.7.3.3.cmml"><mi id="S5.SS1.1.p1.11.m7.7.7.3.3.1" xref="S5.SS1.1.p1.11.m7.7.7.3.3.1.cmml">log</mi><mo id="S5.SS1.1.p1.11.m7.7.7.3.3a" lspace="0.167em" xref="S5.SS1.1.p1.11.m7.7.7.3.3.cmml">⁡</mo><mfrac id="S5.SS1.1.p1.11.m7.2.2" xref="S5.SS1.1.p1.11.m7.2.2.cmml"><mrow id="S5.SS1.1.p1.11.m7.1.1.1" xref="S5.SS1.1.p1.11.m7.1.1.1.cmml"><msub id="S5.SS1.1.p1.11.m7.1.1.1.3" xref="S5.SS1.1.p1.11.m7.1.1.1.3.cmml"><mi id="S5.SS1.1.p1.11.m7.1.1.1.3.2" xref="S5.SS1.1.p1.11.m7.1.1.1.3.2.cmml">π</mi><mi id="S5.SS1.1.p1.11.m7.1.1.1.3.3" xref="S5.SS1.1.p1.11.m7.1.1.1.3.3.cmml">r</mi></msub><mo id="S5.SS1.1.p1.11.m7.1.1.1.2" xref="S5.SS1.1.p1.11.m7.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.11.m7.1.1.1.1.1" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.cmml"><mo id="S5.SS1.1.p1.11.m7.1.1.1.1.1.2" stretchy="false" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.cmml"><mi id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.2" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.1" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.3" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS1.1.p1.11.m7.1.1.1.1.1.3" stretchy="false" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S5.SS1.1.p1.11.m7.2.2.2" xref="S5.SS1.1.p1.11.m7.2.2.2.cmml"><msub id="S5.SS1.1.p1.11.m7.2.2.2.3" xref="S5.SS1.1.p1.11.m7.2.2.2.3.cmml"><mi id="S5.SS1.1.p1.11.m7.2.2.2.3.2" xref="S5.SS1.1.p1.11.m7.2.2.2.3.2.cmml">π</mi><mtext id="S5.SS1.1.p1.11.m7.2.2.2.3.3" xref="S5.SS1.1.p1.11.m7.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="S5.SS1.1.p1.11.m7.2.2.2.2" xref="S5.SS1.1.p1.11.m7.2.2.2.2.cmml">⁢</mo><mrow id="S5.SS1.1.p1.11.m7.2.2.2.1.1" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.cmml"><mo id="S5.SS1.1.p1.11.m7.2.2.2.1.1.2" stretchy="false" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.cmml">(</mo><mrow id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.cmml"><mi id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.2" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.2.cmml">y</mi><mo id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.1" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.1.cmml">∣</mo><mi id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.3" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS1.1.p1.11.m7.2.2.2.1.1.3" stretchy="false" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.11.m7.7b"><apply id="S5.SS1.1.p1.11.m7.7.7.cmml" xref="S5.SS1.1.p1.11.m7.7.7"><eq id="S5.SS1.1.p1.11.m7.7.7.2.cmml" xref="S5.SS1.1.p1.11.m7.7.7.2"></eq><apply id="S5.SS1.1.p1.11.m7.7.7.1.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1"><times id="S5.SS1.1.p1.11.m7.7.7.1.2.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.2"></times><ci id="S5.SS1.1.p1.11.m7.7.7.1.3.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.3">𝑓</ci><list id="S5.SS1.1.p1.11.m7.7.7.1.1.2.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1"><ci id="S5.SS1.1.p1.11.m7.3.3.cmml" xref="S5.SS1.1.p1.11.m7.3.3">𝑟</ci><apply id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1"><csymbol cd="ambiguous" id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1">subscript</csymbol><ci id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.2.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.2">𝜋</ci><ci id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.3a.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.3"><mtext id="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.3.cmml" mathsize="70%" xref="S5.SS1.1.p1.11.m7.7.7.1.1.1.1.3">ref</mtext></ci></apply><ci id="S5.SS1.1.p1.11.m7.4.4.cmml" xref="S5.SS1.1.p1.11.m7.4.4">𝛽</ci></list><interval closure="open" id="S5.SS1.1.p1.11.m7.7.7.1.4.1.cmml" xref="S5.SS1.1.p1.11.m7.7.7.1.4.2"><ci id="S5.SS1.1.p1.11.m7.5.5.cmml" xref="S5.SS1.1.p1.11.m7.5.5">𝑥</ci><ci id="S5.SS1.1.p1.11.m7.6.6.cmml" xref="S5.SS1.1.p1.11.m7.6.6">𝑦</ci></interval></apply><apply id="S5.SS1.1.p1.11.m7.7.7.3.cmml" xref="S5.SS1.1.p1.11.m7.7.7.3"><times id="S5.SS1.1.p1.11.m7.7.7.3.1.cmml" xref="S5.SS1.1.p1.11.m7.7.7.3.1"></times><ci id="S5.SS1.1.p1.11.m7.7.7.3.2.cmml" xref="S5.SS1.1.p1.11.m7.7.7.3.2">𝛽</ci><apply id="S5.SS1.1.p1.11.m7.7.7.3.3.cmml" xref="S5.SS1.1.p1.11.m7.7.7.3.3"><log id="S5.SS1.1.p1.11.m7.7.7.3.3.1.cmml" xref="S5.SS1.1.p1.11.m7.7.7.3.3.1"></log><apply id="S5.SS1.1.p1.11.m7.2.2.cmml" xref="S5.SS1.1.p1.11.m7.2.2"><divide id="S5.SS1.1.p1.11.m7.2.2.3.cmml" xref="S5.SS1.1.p1.11.m7.2.2"></divide><apply id="S5.SS1.1.p1.11.m7.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1"><times id="S5.SS1.1.p1.11.m7.1.1.1.2.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.2"></times><apply id="S5.SS1.1.p1.11.m7.1.1.1.3.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.1.p1.11.m7.1.1.1.3.1.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.3">subscript</csymbol><ci id="S5.SS1.1.p1.11.m7.1.1.1.3.2.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.3.2">𝜋</ci><ci id="S5.SS1.1.p1.11.m7.1.1.1.3.3.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.3.3">𝑟</ci></apply><apply id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1"><csymbol cd="latexml" id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.2.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.2">𝑦</ci><ci id="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.3.cmml" xref="S5.SS1.1.p1.11.m7.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S5.SS1.1.p1.11.m7.2.2.2.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2"><times id="S5.SS1.1.p1.11.m7.2.2.2.2.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.2"></times><apply id="S5.SS1.1.p1.11.m7.2.2.2.3.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.3"><csymbol cd="ambiguous" id="S5.SS1.1.p1.11.m7.2.2.2.3.1.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.3">subscript</csymbol><ci id="S5.SS1.1.p1.11.m7.2.2.2.3.2.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.3.2">𝜋</ci><ci id="S5.SS1.1.p1.11.m7.2.2.2.3.3a.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.3.3"><mtext id="S5.SS1.1.p1.11.m7.2.2.2.3.3.cmml" mathsize="50%" xref="S5.SS1.1.p1.11.m7.2.2.2.3.3">ref</mtext></ci></apply><apply id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1"><csymbol cd="latexml" id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.1.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.1">conditional</csymbol><ci id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.2.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.2">𝑦</ci><ci id="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.3.cmml" xref="S5.SS1.1.p1.11.m7.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.11.m7.7c">f(r;\pi_{\text{ref}},\beta)(x,y)=\beta\log\frac{\pi_{r}(y\mid x)}{\pi_{\text{%
ref}}(y\mid x)}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.11.m7.7d">italic_f ( italic_r ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG</annotation></semantics></math>. That is, the projection <math alttext="f" class="ltx_Math" display="inline" id="S5.SS1.1.p1.12.m8.1"><semantics id="S5.SS1.1.p1.12.m8.1a"><mi id="S5.SS1.1.p1.12.m8.1.1" xref="S5.SS1.1.p1.12.m8.1.1.cmml">f</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.12.m8.1b"><ci id="S5.SS1.1.p1.12.m8.1.1.cmml" xref="S5.SS1.1.p1.12.m8.1.1">𝑓</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.12.m8.1c">f</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.12.m8.1d">italic_f</annotation></semantics></math> produces a member of the equivalence class of <math alttext="r" class="ltx_Math" display="inline" id="S5.SS1.1.p1.13.m9.1"><semantics id="S5.SS1.1.p1.13.m9.1a"><mi id="S5.SS1.1.p1.13.m9.1.1" xref="S5.SS1.1.p1.13.m9.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.1.p1.13.m9.1b"><ci id="S5.SS1.1.p1.13.m9.1.1.cmml" xref="S5.SS1.1.p1.13.m9.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.1.p1.13.m9.1c">r</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.1.p1.13.m9.1d">italic_r</annotation></semantics></math> with the desired form, and we do not lose any generality in our reward model from the proposed reparameterization.
∎</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_para" id="S5.SS1.p4">
<p class="ltx_p" id="S5.SS1.p4.4">We can alternatively view Theorem&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmtheorem1" title="Theorem 1. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a> as specifying exactly which reward function within each equivalence class the DPO reparameterization selects, that is, the reward function satisfying:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S5.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\sum_{y}\underbrace{\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{\beta}r(x,y)%
\right)}_{=\pi(y\mid x)\text{, using Thm.~{}\ref{thm:main} reparam.}}=1," class="ltx_Math" display="block" id="S5.E9.m1.7"><semantics id="S5.E9.m1.7a"><mrow id="S5.E9.m1.7.7.1" xref="S5.E9.m1.7.7.1.1.cmml"><mrow id="S5.E9.m1.7.7.1.1" xref="S5.E9.m1.7.7.1.1.cmml"><mrow id="S5.E9.m1.7.7.1.1.2" xref="S5.E9.m1.7.7.1.1.2.cmml"><munder id="S5.E9.m1.7.7.1.1.2.1" xref="S5.E9.m1.7.7.1.1.2.1.cmml"><mo id="S5.E9.m1.7.7.1.1.2.1.2" movablelimits="false" xref="S5.E9.m1.7.7.1.1.2.1.2.cmml">∑</mo><mi id="S5.E9.m1.7.7.1.1.2.1.3" xref="S5.E9.m1.7.7.1.1.2.1.3.cmml">y</mi></munder><munder id="S5.E9.m1.7.7.1.1.2.2" xref="S5.E9.m1.7.7.1.1.2.2.cmml"><munder accentunder="true" id="S5.E9.m1.5.5" xref="S5.E9.m1.5.5.cmml"><mrow id="S5.E9.m1.5.5.5" xref="S5.E9.m1.5.5.5.cmml"><msub id="S5.E9.m1.5.5.5.7" xref="S5.E9.m1.5.5.5.7.cmml"><mi id="S5.E9.m1.5.5.5.7.2" xref="S5.E9.m1.5.5.5.7.2.cmml">π</mi><mtext id="S5.E9.m1.5.5.5.7.3" xref="S5.E9.m1.5.5.5.7.3a.cmml">ref</mtext></msub><mo id="S5.E9.m1.5.5.5.6" xref="S5.E9.m1.5.5.5.6.cmml">⁢</mo><mrow id="S5.E9.m1.4.4.4.4.1" xref="S5.E9.m1.4.4.4.4.1.1.cmml"><mo id="S5.E9.m1.4.4.4.4.1.2" stretchy="false" xref="S5.E9.m1.4.4.4.4.1.1.cmml">(</mo><mrow id="S5.E9.m1.4.4.4.4.1.1" xref="S5.E9.m1.4.4.4.4.1.1.cmml"><mi id="S5.E9.m1.4.4.4.4.1.1.2" xref="S5.E9.m1.4.4.4.4.1.1.2.cmml">y</mi><mo id="S5.E9.m1.4.4.4.4.1.1.1" xref="S5.E9.m1.4.4.4.4.1.1.1.cmml">∣</mo><mi id="S5.E9.m1.4.4.4.4.1.1.3" xref="S5.E9.m1.4.4.4.4.1.1.3.cmml">x</mi></mrow><mo id="S5.E9.m1.4.4.4.4.1.3" stretchy="false" xref="S5.E9.m1.4.4.4.4.1.1.cmml">)</mo></mrow><mo id="S5.E9.m1.5.5.5.6a" lspace="0.167em" xref="S5.E9.m1.5.5.5.6.cmml">⁢</mo><mrow id="S5.E9.m1.5.5.5.5.1" xref="S5.E9.m1.5.5.5.5.2.cmml"><mi id="S5.E9.m1.3.3.3.3" xref="S5.E9.m1.3.3.3.3.cmml">exp</mi><mo id="S5.E9.m1.5.5.5.5.1a" xref="S5.E9.m1.5.5.5.5.2.cmml">⁡</mo><mrow id="S5.E9.m1.5.5.5.5.1.1" xref="S5.E9.m1.5.5.5.5.2.cmml"><mo id="S5.E9.m1.5.5.5.5.1.1.2" xref="S5.E9.m1.5.5.5.5.2.cmml">(</mo><mrow id="S5.E9.m1.5.5.5.5.1.1.1" xref="S5.E9.m1.5.5.5.5.1.1.1.cmml"><mfrac id="S5.E9.m1.5.5.5.5.1.1.1.2" xref="S5.E9.m1.5.5.5.5.1.1.1.2.cmml"><mn id="S5.E9.m1.5.5.5.5.1.1.1.2.2" xref="S5.E9.m1.5.5.5.5.1.1.1.2.2.cmml">1</mn><mi id="S5.E9.m1.5.5.5.5.1.1.1.2.3" xref="S5.E9.m1.5.5.5.5.1.1.1.2.3.cmml">β</mi></mfrac><mo id="S5.E9.m1.5.5.5.5.1.1.1.1" xref="S5.E9.m1.5.5.5.5.1.1.1.1.cmml">⁢</mo><mi id="S5.E9.m1.5.5.5.5.1.1.1.3" xref="S5.E9.m1.5.5.5.5.1.1.1.3.cmml">r</mi><mo id="S5.E9.m1.5.5.5.5.1.1.1.1a" xref="S5.E9.m1.5.5.5.5.1.1.1.1.cmml">⁢</mo><mrow id="S5.E9.m1.5.5.5.5.1.1.1.4.2" xref="S5.E9.m1.5.5.5.5.1.1.1.4.1.cmml"><mo id="S5.E9.m1.5.5.5.5.1.1.1.4.2.1" stretchy="false" xref="S5.E9.m1.5.5.5.5.1.1.1.4.1.cmml">(</mo><mi id="S5.E9.m1.1.1.1.1" xref="S5.E9.m1.1.1.1.1.cmml">x</mi><mo id="S5.E9.m1.5.5.5.5.1.1.1.4.2.2" xref="S5.E9.m1.5.5.5.5.1.1.1.4.1.cmml">,</mo><mi id="S5.E9.m1.2.2.2.2" xref="S5.E9.m1.2.2.2.2.cmml">y</mi><mo id="S5.E9.m1.5.5.5.5.1.1.1.4.2.3" stretchy="false" xref="S5.E9.m1.5.5.5.5.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="S5.E9.m1.5.5.5.5.1.1.3" xref="S5.E9.m1.5.5.5.5.2.cmml">)</mo></mrow></mrow></mrow><mo id="S5.E9.m1.5.5.6" xref="S5.E9.m1.5.5.6.cmml">⏟</mo></munder><mrow id="S5.E9.m1.6.6.1" xref="S5.E9.m1.6.6.1.cmml"><mi id="S5.E9.m1.6.6.1.3" xref="S5.E9.m1.6.6.1.3.cmml"></mi><mo id="S5.E9.m1.6.6.1.2" xref="S5.E9.m1.6.6.1.2.cmml">=</mo><mrow id="S5.E9.m1.6.6.1.1" xref="S5.E9.m1.6.6.1.1.cmml"><mi id="S5.E9.m1.6.6.1.1.3" xref="S5.E9.m1.6.6.1.1.3.cmml">π</mi><mo id="S5.E9.m1.6.6.1.1.2" xref="S5.E9.m1.6.6.1.1.2.cmml">⁢</mo><mrow id="S5.E9.m1.6.6.1.1.1.1" xref="S5.E9.m1.6.6.1.1.1.1.1.cmml"><mo id="S5.E9.m1.6.6.1.1.1.1.2" stretchy="false" xref="S5.E9.m1.6.6.1.1.1.1.1.cmml">(</mo><mrow id="S5.E9.m1.6.6.1.1.1.1.1" xref="S5.E9.m1.6.6.1.1.1.1.1.cmml"><mi id="S5.E9.m1.6.6.1.1.1.1.1.2" xref="S5.E9.m1.6.6.1.1.1.1.1.2.cmml">y</mi><mo id="S5.E9.m1.6.6.1.1.1.1.1.1" xref="S5.E9.m1.6.6.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.E9.m1.6.6.1.1.1.1.1.3" xref="S5.E9.m1.6.6.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.E9.m1.6.6.1.1.1.1.3" stretchy="false" xref="S5.E9.m1.6.6.1.1.1.1.1.cmml">)</mo></mrow><mo id="S5.E9.m1.6.6.1.1.2a" xref="S5.E9.m1.6.6.1.1.2.cmml">⁢</mo><mrow id="S5.E9.m1.6.6.1.1.4" xref="S5.E9.m1.6.6.1.1.4f.cmml"><mtext id="S5.E9.m1.6.6.1.1.4a" xref="S5.E9.m1.6.6.1.1.4f.cmml">, using Thm.&nbsp;</mtext><mtext id="S5.E9.m1.6.6.1.1.4b" xref="S5.E9.m1.6.6.1.1.4f.cmml"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmtheorem1" style="font-size:70%;" title="Theorem 1. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a></mtext><mtext id="S5.E9.m1.6.6.1.1.4e" xref="S5.E9.m1.6.6.1.1.4f.cmml">&nbsp;reparam.</mtext></mrow></mrow></mrow></munder></mrow><mo id="S5.E9.m1.7.7.1.1.1" xref="S5.E9.m1.7.7.1.1.1.cmml">=</mo><mn id="S5.E9.m1.7.7.1.1.3" xref="S5.E9.m1.7.7.1.1.3.cmml">1</mn></mrow><mo id="S5.E9.m1.7.7.1.2" xref="S5.E9.m1.7.7.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.E9.m1.7b"><apply id="S5.E9.m1.7.7.1.1.cmml" xref="S5.E9.m1.7.7.1"><eq id="S5.E9.m1.7.7.1.1.1.cmml" xref="S5.E9.m1.7.7.1.1.1"></eq><apply id="S5.E9.m1.7.7.1.1.2.cmml" xref="S5.E9.m1.7.7.1.1.2"><apply id="S5.E9.m1.7.7.1.1.2.1.cmml" xref="S5.E9.m1.7.7.1.1.2.1"><csymbol cd="ambiguous" id="S5.E9.m1.7.7.1.1.2.1.1.cmml" xref="S5.E9.m1.7.7.1.1.2.1">subscript</csymbol><sum id="S5.E9.m1.7.7.1.1.2.1.2.cmml" xref="S5.E9.m1.7.7.1.1.2.1.2"></sum><ci id="S5.E9.m1.7.7.1.1.2.1.3.cmml" xref="S5.E9.m1.7.7.1.1.2.1.3">𝑦</ci></apply><apply id="S5.E9.m1.7.7.1.1.2.2.cmml" xref="S5.E9.m1.7.7.1.1.2.2"><csymbol cd="ambiguous" id="S5.E9.m1.7.7.1.1.2.2.1.cmml" xref="S5.E9.m1.7.7.1.1.2.2">subscript</csymbol><apply id="S5.E9.m1.5.5.cmml" xref="S5.E9.m1.5.5"><ci id="S5.E9.m1.5.5.6.cmml" xref="S5.E9.m1.5.5.6">⏟</ci><apply id="S5.E9.m1.5.5.5.cmml" xref="S5.E9.m1.5.5.5"><times id="S5.E9.m1.5.5.5.6.cmml" xref="S5.E9.m1.5.5.5.6"></times><apply id="S5.E9.m1.5.5.5.7.cmml" xref="S5.E9.m1.5.5.5.7"><csymbol cd="ambiguous" id="S5.E9.m1.5.5.5.7.1.cmml" xref="S5.E9.m1.5.5.5.7">subscript</csymbol><ci id="S5.E9.m1.5.5.5.7.2.cmml" xref="S5.E9.m1.5.5.5.7.2">𝜋</ci><ci id="S5.E9.m1.5.5.5.7.3a.cmml" xref="S5.E9.m1.5.5.5.7.3"><mtext id="S5.E9.m1.5.5.5.7.3.cmml" mathsize="70%" xref="S5.E9.m1.5.5.5.7.3">ref</mtext></ci></apply><apply id="S5.E9.m1.4.4.4.4.1.1.cmml" xref="S5.E9.m1.4.4.4.4.1"><csymbol cd="latexml" id="S5.E9.m1.4.4.4.4.1.1.1.cmml" xref="S5.E9.m1.4.4.4.4.1.1.1">conditional</csymbol><ci id="S5.E9.m1.4.4.4.4.1.1.2.cmml" xref="S5.E9.m1.4.4.4.4.1.1.2">𝑦</ci><ci id="S5.E9.m1.4.4.4.4.1.1.3.cmml" xref="S5.E9.m1.4.4.4.4.1.1.3">𝑥</ci></apply><apply id="S5.E9.m1.5.5.5.5.2.cmml" xref="S5.E9.m1.5.5.5.5.1"><exp id="S5.E9.m1.3.3.3.3.cmml" xref="S5.E9.m1.3.3.3.3"></exp><apply id="S5.E9.m1.5.5.5.5.1.1.1.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1"><times id="S5.E9.m1.5.5.5.5.1.1.1.1.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1.1"></times><apply id="S5.E9.m1.5.5.5.5.1.1.1.2.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1.2"><divide id="S5.E9.m1.5.5.5.5.1.1.1.2.1.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1.2"></divide><cn id="S5.E9.m1.5.5.5.5.1.1.1.2.2.cmml" type="integer" xref="S5.E9.m1.5.5.5.5.1.1.1.2.2">1</cn><ci id="S5.E9.m1.5.5.5.5.1.1.1.2.3.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1.2.3">𝛽</ci></apply><ci id="S5.E9.m1.5.5.5.5.1.1.1.3.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1.3">𝑟</ci><interval closure="open" id="S5.E9.m1.5.5.5.5.1.1.1.4.1.cmml" xref="S5.E9.m1.5.5.5.5.1.1.1.4.2"><ci id="S5.E9.m1.1.1.1.1.cmml" xref="S5.E9.m1.1.1.1.1">𝑥</ci><ci id="S5.E9.m1.2.2.2.2.cmml" xref="S5.E9.m1.2.2.2.2">𝑦</ci></interval></apply></apply></apply></apply><apply id="S5.E9.m1.6.6.1.cmml" xref="S5.E9.m1.6.6.1"><eq id="S5.E9.m1.6.6.1.2.cmml" xref="S5.E9.m1.6.6.1.2"></eq><csymbol cd="latexml" id="S5.E9.m1.6.6.1.3.cmml" xref="S5.E9.m1.6.6.1.3">absent</csymbol><apply id="S5.E9.m1.6.6.1.1.cmml" xref="S5.E9.m1.6.6.1.1"><times id="S5.E9.m1.6.6.1.1.2.cmml" xref="S5.E9.m1.6.6.1.1.2"></times><ci id="S5.E9.m1.6.6.1.1.3.cmml" xref="S5.E9.m1.6.6.1.1.3">𝜋</ci><apply id="S5.E9.m1.6.6.1.1.1.1.1.cmml" xref="S5.E9.m1.6.6.1.1.1.1"><csymbol cd="latexml" id="S5.E9.m1.6.6.1.1.1.1.1.1.cmml" xref="S5.E9.m1.6.6.1.1.1.1.1.1">conditional</csymbol><ci id="S5.E9.m1.6.6.1.1.1.1.1.2.cmml" xref="S5.E9.m1.6.6.1.1.1.1.1.2">𝑦</ci><ci id="S5.E9.m1.6.6.1.1.1.1.1.3.cmml" xref="S5.E9.m1.6.6.1.1.1.1.1.3">𝑥</ci></apply><ci id="S5.E9.m1.6.6.1.1.4f.cmml" xref="S5.E9.m1.6.6.1.1.4"><mrow id="S5.E9.m1.6.6.1.1.4.cmml" xref="S5.E9.m1.6.6.1.1.4"><mtext id="S5.E9.m1.6.6.1.1.4a.cmml" mathsize="70%" xref="S5.E9.m1.6.6.1.1.4">, using Thm.&nbsp;</mtext><mtext id="S5.E9.m1.6.6.1.1.4b.cmml" mathsize="70%" xref="S5.E9.m1.6.6.1.1.4"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmtheorem1" style="font-size:70%;" title="Theorem 1. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a></mtext><mtext id="S5.E9.m1.6.6.1.1.4e.cmml" mathsize="70%" xref="S5.E9.m1.6.6.1.1.4">&nbsp;reparam.</mtext></mrow></ci></apply></apply></apply></apply><cn id="S5.E9.m1.7.7.1.1.3.cmml" type="integer" xref="S5.E9.m1.7.7.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E9.m1.7c">\sum_{y}\underbrace{\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{\beta}r(x,y)%
\right)}_{=\pi(y\mid x)\text{, using Thm.~{}\ref{thm:main} reparam.}}=1,</annotation><annotation encoding="application/x-llamapun" id="S5.E9.m1.7d">∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT under⏟ start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) end_ARG start_POSTSUBSCRIPT = italic_π ( italic_y ∣ italic_x ) , using Thm. reparam. end_POSTSUBSCRIPT = 1 ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.p4.3">i.e., <math alttext="\pi(y\mid x)" class="ltx_Math" display="inline" id="S5.SS1.p4.1.m1.1"><semantics id="S5.SS1.p4.1.m1.1a"><mrow id="S5.SS1.p4.1.m1.1.1" xref="S5.SS1.p4.1.m1.1.1.cmml"><mi id="S5.SS1.p4.1.m1.1.1.3" xref="S5.SS1.p4.1.m1.1.1.3.cmml">π</mi><mo id="S5.SS1.p4.1.m1.1.1.2" xref="S5.SS1.p4.1.m1.1.1.2.cmml">⁢</mo><mrow id="S5.SS1.p4.1.m1.1.1.1.1" xref="S5.SS1.p4.1.m1.1.1.1.1.1.cmml"><mo id="S5.SS1.p4.1.m1.1.1.1.1.2" stretchy="false" xref="S5.SS1.p4.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS1.p4.1.m1.1.1.1.1.1" xref="S5.SS1.p4.1.m1.1.1.1.1.1.cmml"><mi id="S5.SS1.p4.1.m1.1.1.1.1.1.2" xref="S5.SS1.p4.1.m1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.SS1.p4.1.m1.1.1.1.1.1.1" xref="S5.SS1.p4.1.m1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.SS1.p4.1.m1.1.1.1.1.1.3" xref="S5.SS1.p4.1.m1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS1.p4.1.m1.1.1.1.1.3" stretchy="false" xref="S5.SS1.p4.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.1.m1.1b"><apply id="S5.SS1.p4.1.m1.1.1.cmml" xref="S5.SS1.p4.1.m1.1.1"><times id="S5.SS1.p4.1.m1.1.1.2.cmml" xref="S5.SS1.p4.1.m1.1.1.2"></times><ci id="S5.SS1.p4.1.m1.1.1.3.cmml" xref="S5.SS1.p4.1.m1.1.1.3">𝜋</ci><apply id="S5.SS1.p4.1.m1.1.1.1.1.1.cmml" xref="S5.SS1.p4.1.m1.1.1.1.1"><csymbol cd="latexml" id="S5.SS1.p4.1.m1.1.1.1.1.1.1.cmml" xref="S5.SS1.p4.1.m1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS1.p4.1.m1.1.1.1.1.1.2.cmml" xref="S5.SS1.p4.1.m1.1.1.1.1.1.2">𝑦</ci><ci id="S5.SS1.p4.1.m1.1.1.1.1.1.3.cmml" xref="S5.SS1.p4.1.m1.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.1.m1.1c">\pi(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.1.m1.1d">italic_π ( italic_y ∣ italic_x )</annotation></semantics></math> is a valid distribution (probabilities are positive and sum to 1).
However, following Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>, we can see that Eq.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5.E9" title="9 ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">9</span></a> is the partition function of the optimal policy induced by the reward function <math alttext="r(x,y)" class="ltx_Math" display="inline" id="S5.SS1.p4.2.m2.2"><semantics id="S5.SS1.p4.2.m2.2a"><mrow id="S5.SS1.p4.2.m2.2.3" xref="S5.SS1.p4.2.m2.2.3.cmml"><mi id="S5.SS1.p4.2.m2.2.3.2" xref="S5.SS1.p4.2.m2.2.3.2.cmml">r</mi><mo id="S5.SS1.p4.2.m2.2.3.1" xref="S5.SS1.p4.2.m2.2.3.1.cmml">⁢</mo><mrow id="S5.SS1.p4.2.m2.2.3.3.2" xref="S5.SS1.p4.2.m2.2.3.3.1.cmml"><mo id="S5.SS1.p4.2.m2.2.3.3.2.1" stretchy="false" xref="S5.SS1.p4.2.m2.2.3.3.1.cmml">(</mo><mi id="S5.SS1.p4.2.m2.1.1" xref="S5.SS1.p4.2.m2.1.1.cmml">x</mi><mo id="S5.SS1.p4.2.m2.2.3.3.2.2" xref="S5.SS1.p4.2.m2.2.3.3.1.cmml">,</mo><mi id="S5.SS1.p4.2.m2.2.2" xref="S5.SS1.p4.2.m2.2.2.cmml">y</mi><mo id="S5.SS1.p4.2.m2.2.3.3.2.3" stretchy="false" xref="S5.SS1.p4.2.m2.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.2.m2.2b"><apply id="S5.SS1.p4.2.m2.2.3.cmml" xref="S5.SS1.p4.2.m2.2.3"><times id="S5.SS1.p4.2.m2.2.3.1.cmml" xref="S5.SS1.p4.2.m2.2.3.1"></times><ci id="S5.SS1.p4.2.m2.2.3.2.cmml" xref="S5.SS1.p4.2.m2.2.3.2">𝑟</ci><interval closure="open" id="S5.SS1.p4.2.m2.2.3.3.1.cmml" xref="S5.SS1.p4.2.m2.2.3.3.2"><ci id="S5.SS1.p4.2.m2.1.1.cmml" xref="S5.SS1.p4.2.m2.1.1">𝑥</ci><ci id="S5.SS1.p4.2.m2.2.2.cmml" xref="S5.SS1.p4.2.m2.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.2.m2.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.2.m2.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math>.
The key insight of the DPO algorithm is that we can impose certain constraints on the under-constrained Plackett-Luce (and Bradley-Terry in particular) family of preference models, such that we preserve the class of representable reward models, but explicitly make the optimal policy in Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a> analytically tractable for all prompts <math alttext="x" class="ltx_Math" display="inline" id="S5.SS1.p4.3.m3.1"><semantics id="S5.SS1.p4.3.m3.1a"><mi id="S5.SS1.p4.3.m3.1.1" xref="S5.SS1.p4.3.m3.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.3.m3.1b"><ci id="S5.SS1.p4.3.m3.1.1.cmml" xref="S5.SS1.p4.3.m3.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.3.m3.1c">x</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.3.m3.1d">italic_x</annotation></semantics></math>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Instability of Actor-Critic Algorithms</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.4">We can also use our framework to diagnose instabilities with standard actor-critic algorithms used for the RLHF, such as PPO. We follow the RLHF pipeline and focus on the RL fine-tuning step outlined in Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3" title="3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a>. We can draw connections to the control as inference framework <cite class="ltx_cite ltx_citemacro_cite">Levine (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib20" title="">2018</a>)</cite> for the constrained RL problem outlined in <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E3" title="3 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a>. We assume a parameterized model <math alttext="\pi_{\theta}(y\mid x)" class="ltx_Math" display="inline" id="S5.SS2.p1.1.m1.1"><semantics id="S5.SS2.p1.1.m1.1a"><mrow id="S5.SS2.p1.1.m1.1.1" xref="S5.SS2.p1.1.m1.1.1.cmml"><msub id="S5.SS2.p1.1.m1.1.1.3" xref="S5.SS2.p1.1.m1.1.1.3.cmml"><mi id="S5.SS2.p1.1.m1.1.1.3.2" xref="S5.SS2.p1.1.m1.1.1.3.2.cmml">π</mi><mi id="S5.SS2.p1.1.m1.1.1.3.3" xref="S5.SS2.p1.1.m1.1.1.3.3.cmml">θ</mi></msub><mo id="S5.SS2.p1.1.m1.1.1.2" xref="S5.SS2.p1.1.m1.1.1.2.cmml">⁢</mo><mrow id="S5.SS2.p1.1.m1.1.1.1.1" xref="S5.SS2.p1.1.m1.1.1.1.1.1.cmml"><mo id="S5.SS2.p1.1.m1.1.1.1.1.2" stretchy="false" xref="S5.SS2.p1.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS2.p1.1.m1.1.1.1.1.1" xref="S5.SS2.p1.1.m1.1.1.1.1.1.cmml"><mi id="S5.SS2.p1.1.m1.1.1.1.1.1.2" xref="S5.SS2.p1.1.m1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.SS2.p1.1.m1.1.1.1.1.1.1" xref="S5.SS2.p1.1.m1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.SS2.p1.1.m1.1.1.1.1.1.3" xref="S5.SS2.p1.1.m1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.SS2.p1.1.m1.1.1.1.1.3" stretchy="false" xref="S5.SS2.p1.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.1.m1.1b"><apply id="S5.SS2.p1.1.m1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1"><times id="S5.SS2.p1.1.m1.1.1.2.cmml" xref="S5.SS2.p1.1.m1.1.1.2"></times><apply id="S5.SS2.p1.1.m1.1.1.3.cmml" xref="S5.SS2.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S5.SS2.p1.1.m1.1.1.3.1.cmml" xref="S5.SS2.p1.1.m1.1.1.3">subscript</csymbol><ci id="S5.SS2.p1.1.m1.1.1.3.2.cmml" xref="S5.SS2.p1.1.m1.1.1.3.2">𝜋</ci><ci id="S5.SS2.p1.1.m1.1.1.3.3.cmml" xref="S5.SS2.p1.1.m1.1.1.3.3">𝜃</ci></apply><apply id="S5.SS2.p1.1.m1.1.1.1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1.1.1"><csymbol cd="latexml" id="S5.SS2.p1.1.m1.1.1.1.1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS2.p1.1.m1.1.1.1.1.1.2.cmml" xref="S5.SS2.p1.1.m1.1.1.1.1.1.2">𝑦</ci><ci id="S5.SS2.p1.1.m1.1.1.1.1.1.3.cmml" xref="S5.SS2.p1.1.m1.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.1.m1.1c">\pi_{\theta}(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.1.m1.1d">italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x )</annotation></semantics></math> and minimize <math alttext="\mathbb{D}_{\text{KL}}[\pi_{\theta}(y|x)\mid\mid\pi^{*}(y\mid x)]" class="ltx_math_unparsed" display="inline" id="S5.SS2.p1.2.m2.1"><semantics id="S5.SS2.p1.2.m2.1a"><mrow id="S5.SS2.p1.2.m2.1b"><msub id="S5.SS2.p1.2.m2.1.1"><mi id="S5.SS2.p1.2.m2.1.1.2">𝔻</mi><mtext id="S5.SS2.p1.2.m2.1.1.3">KL</mtext></msub><mrow id="S5.SS2.p1.2.m2.1.2"><mo id="S5.SS2.p1.2.m2.1.2.1" stretchy="false">[</mo><msub id="S5.SS2.p1.2.m2.1.2.2"><mi id="S5.SS2.p1.2.m2.1.2.2.2">π</mi><mi id="S5.SS2.p1.2.m2.1.2.2.3">θ</mi></msub><mrow id="S5.SS2.p1.2.m2.1.2.3"><mo id="S5.SS2.p1.2.m2.1.2.3.1" stretchy="false">(</mo><mi id="S5.SS2.p1.2.m2.1.2.3.2">y</mi><mo fence="false" id="S5.SS2.p1.2.m2.1.2.3.3" rspace="0.167em" stretchy="false">|</mo><mi id="S5.SS2.p1.2.m2.1.2.3.4">x</mi><mo id="S5.SS2.p1.2.m2.1.2.3.5" stretchy="false">)</mo></mrow><mo id="S5.SS2.p1.2.m2.1.2.4" lspace="0em" rspace="0.0835em">∣</mo><mo id="S5.SS2.p1.2.m2.1.2.5" lspace="0.0835em" rspace="0.167em">∣</mo><msup id="S5.SS2.p1.2.m2.1.2.6"><mi id="S5.SS2.p1.2.m2.1.2.6.2">π</mi><mo id="S5.SS2.p1.2.m2.1.2.6.3">*</mo></msup><mrow id="S5.SS2.p1.2.m2.1.2.7"><mo id="S5.SS2.p1.2.m2.1.2.7.1" stretchy="false">(</mo><mi id="S5.SS2.p1.2.m2.1.2.7.2">y</mi><mo id="S5.SS2.p1.2.m2.1.2.7.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S5.SS2.p1.2.m2.1.2.7.4">x</mi><mo id="S5.SS2.p1.2.m2.1.2.7.5" stretchy="false">)</mo></mrow><mo id="S5.SS2.p1.2.m2.1.2.8" stretchy="false">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="S5.SS2.p1.2.m2.1c">\mathbb{D}_{\text{KL}}[\pi_{\theta}(y|x)\mid\mid\pi^{*}(y\mid x)]</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.2.m2.1d">blackboard_D start_POSTSUBSCRIPT KL end_POSTSUBSCRIPT [ italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y | italic_x ) ∣ ∣ italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y ∣ italic_x ) ]</annotation></semantics></math> where <math alttext="\pi^{*}" class="ltx_Math" display="inline" id="S5.SS2.p1.3.m3.1"><semantics id="S5.SS2.p1.3.m3.1a"><msup id="S5.SS2.p1.3.m3.1.1" xref="S5.SS2.p1.3.m3.1.1.cmml"><mi id="S5.SS2.p1.3.m3.1.1.2" xref="S5.SS2.p1.3.m3.1.1.2.cmml">π</mi><mo id="S5.SS2.p1.3.m3.1.1.3" xref="S5.SS2.p1.3.m3.1.1.3.cmml">*</mo></msup><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.3.m3.1b"><apply id="S5.SS2.p1.3.m3.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.3.m3.1.1.1.cmml" xref="S5.SS2.p1.3.m3.1.1">superscript</csymbol><ci id="S5.SS2.p1.3.m3.1.1.2.cmml" xref="S5.SS2.p1.3.m3.1.1.2">𝜋</ci><times id="S5.SS2.p1.3.m3.1.1.3.cmml" xref="S5.SS2.p1.3.m3.1.1.3"></times></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.3.m3.1c">\pi^{*}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.3.m3.1d">italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT</annotation></semantics></math> is the optimal policy from Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E7" title="7 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">7</span></a> induced by the reward function <math alttext="r_{\phi}(y,x)" class="ltx_Math" display="inline" id="S5.SS2.p1.4.m4.2"><semantics id="S5.SS2.p1.4.m4.2a"><mrow id="S5.SS2.p1.4.m4.2.3" xref="S5.SS2.p1.4.m4.2.3.cmml"><msub id="S5.SS2.p1.4.m4.2.3.2" xref="S5.SS2.p1.4.m4.2.3.2.cmml"><mi id="S5.SS2.p1.4.m4.2.3.2.2" xref="S5.SS2.p1.4.m4.2.3.2.2.cmml">r</mi><mi id="S5.SS2.p1.4.m4.2.3.2.3" xref="S5.SS2.p1.4.m4.2.3.2.3.cmml">ϕ</mi></msub><mo id="S5.SS2.p1.4.m4.2.3.1" xref="S5.SS2.p1.4.m4.2.3.1.cmml">⁢</mo><mrow id="S5.SS2.p1.4.m4.2.3.3.2" xref="S5.SS2.p1.4.m4.2.3.3.1.cmml"><mo id="S5.SS2.p1.4.m4.2.3.3.2.1" stretchy="false" xref="S5.SS2.p1.4.m4.2.3.3.1.cmml">(</mo><mi id="S5.SS2.p1.4.m4.1.1" xref="S5.SS2.p1.4.m4.1.1.cmml">y</mi><mo id="S5.SS2.p1.4.m4.2.3.3.2.2" xref="S5.SS2.p1.4.m4.2.3.3.1.cmml">,</mo><mi id="S5.SS2.p1.4.m4.2.2" xref="S5.SS2.p1.4.m4.2.2.cmml">x</mi><mo id="S5.SS2.p1.4.m4.2.3.3.2.3" stretchy="false" xref="S5.SS2.p1.4.m4.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.4.m4.2b"><apply id="S5.SS2.p1.4.m4.2.3.cmml" xref="S5.SS2.p1.4.m4.2.3"><times id="S5.SS2.p1.4.m4.2.3.1.cmml" xref="S5.SS2.p1.4.m4.2.3.1"></times><apply id="S5.SS2.p1.4.m4.2.3.2.cmml" xref="S5.SS2.p1.4.m4.2.3.2"><csymbol cd="ambiguous" id="S5.SS2.p1.4.m4.2.3.2.1.cmml" xref="S5.SS2.p1.4.m4.2.3.2">subscript</csymbol><ci id="S5.SS2.p1.4.m4.2.3.2.2.cmml" xref="S5.SS2.p1.4.m4.2.3.2.2">𝑟</ci><ci id="S5.SS2.p1.4.m4.2.3.2.3.cmml" xref="S5.SS2.p1.4.m4.2.3.2.3">italic-ϕ</ci></apply><interval closure="open" id="S5.SS2.p1.4.m4.2.3.3.1.cmml" xref="S5.SS2.p1.4.m4.2.3.3.2"><ci id="S5.SS2.p1.4.m4.1.1.cmml" xref="S5.SS2.p1.4.m4.1.1">𝑦</ci><ci id="S5.SS2.p1.4.m4.2.2.cmml" xref="S5.SS2.p1.4.m4.2.2">𝑥</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.4.m4.2c">r_{\phi}(y,x)</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.4.m4.2d">italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_y , italic_x )</annotation></semantics></math>. With some algebra this leads to the optimization objective:
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="S5.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\pi_{\theta}}\mathbb{E}_{\pi_{\theta}(y\mid x)}\bigg{[}\underbrace{r_{%
\phi}(x,y)-\beta\log\sum_{y}\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{\beta}%
r_{\phi}(x,y)\right)}_{f(r_{\phi},\pi_{\text{ref}},\beta)}-\underbrace{\beta%
\log\frac{\pi_{\theta}(y\mid x)}{\pi_{\text{ref}}(y\mid x)}}_{\text{KL}}\bigg{]}" class="ltx_Math" display="block" id="S5.E10.m1.14"><semantics id="S5.E10.m1.14a"><mrow id="S5.E10.m1.14.14" xref="S5.E10.m1.14.14.cmml"><mrow id="S5.E10.m1.14.14.3" xref="S5.E10.m1.14.14.3.cmml"><munder id="S5.E10.m1.14.14.3.1" xref="S5.E10.m1.14.14.3.1.cmml"><mi id="S5.E10.m1.14.14.3.1.2" xref="S5.E10.m1.14.14.3.1.2.cmml">max</mi><msub id="S5.E10.m1.14.14.3.1.3" xref="S5.E10.m1.14.14.3.1.3.cmml"><mi id="S5.E10.m1.14.14.3.1.3.2" xref="S5.E10.m1.14.14.3.1.3.2.cmml">π</mi><mi id="S5.E10.m1.14.14.3.1.3.3" xref="S5.E10.m1.14.14.3.1.3.3.cmml">θ</mi></msub></munder><mo id="S5.E10.m1.14.14.3a" lspace="0.167em" xref="S5.E10.m1.14.14.3.cmml">⁡</mo><msub id="S5.E10.m1.14.14.3.2" xref="S5.E10.m1.14.14.3.2.cmml"><mi id="S5.E10.m1.14.14.3.2.2" xref="S5.E10.m1.14.14.3.2.2.cmml">𝔼</mi><mrow id="S5.E10.m1.1.1.1" xref="S5.E10.m1.1.1.1.cmml"><msub id="S5.E10.m1.1.1.1.3" xref="S5.E10.m1.1.1.1.3.cmml"><mi id="S5.E10.m1.1.1.1.3.2" xref="S5.E10.m1.1.1.1.3.2.cmml">π</mi><mi id="S5.E10.m1.1.1.1.3.3" xref="S5.E10.m1.1.1.1.3.3.cmml">θ</mi></msub><mo id="S5.E10.m1.1.1.1.2" xref="S5.E10.m1.1.1.1.2.cmml">⁢</mo><mrow id="S5.E10.m1.1.1.1.1.1" xref="S5.E10.m1.1.1.1.1.1.1.cmml"><mo id="S5.E10.m1.1.1.1.1.1.2" stretchy="false" xref="S5.E10.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.E10.m1.1.1.1.1.1.1" xref="S5.E10.m1.1.1.1.1.1.1.cmml"><mi id="S5.E10.m1.1.1.1.1.1.1.2" xref="S5.E10.m1.1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.E10.m1.1.1.1.1.1.1.1" xref="S5.E10.m1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.E10.m1.1.1.1.1.1.1.3" xref="S5.E10.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.E10.m1.1.1.1.1.1.3" stretchy="false" xref="S5.E10.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub></mrow><mo id="S5.E10.m1.14.14.2" xref="S5.E10.m1.14.14.2.cmml">⁢</mo><mrow id="S5.E10.m1.14.14.1.1" xref="S5.E10.m1.14.14.1.2.cmml"><mo id="S5.E10.m1.14.14.1.1.2" maxsize="210%" minsize="210%" xref="S5.E10.m1.14.14.1.2.1.cmml">[</mo><mrow id="S5.E10.m1.14.14.1.1.1" xref="S5.E10.m1.14.14.1.1.1.cmml"><munder id="S5.E10.m1.14.14.1.1.1.2" xref="S5.E10.m1.14.14.1.1.1.2.cmml"><munder accentunder="true" id="S5.E10.m1.8.8" xref="S5.E10.m1.8.8.cmml"><mrow id="S5.E10.m1.8.8.7" xref="S5.E10.m1.8.8.7.cmml"><mrow id="S5.E10.m1.8.8.7.9" xref="S5.E10.m1.8.8.7.9.cmml"><msub id="S5.E10.m1.8.8.7.9.2" xref="S5.E10.m1.8.8.7.9.2.cmml"><mi id="S5.E10.m1.8.8.7.9.2.2" xref="S5.E10.m1.8.8.7.9.2.2.cmml">r</mi><mi id="S5.E10.m1.8.8.7.9.2.3" xref="S5.E10.m1.8.8.7.9.2.3.cmml">ϕ</mi></msub><mo id="S5.E10.m1.8.8.7.9.1" xref="S5.E10.m1.8.8.7.9.1.cmml">⁢</mo><mrow id="S5.E10.m1.8.8.7.9.3.2" xref="S5.E10.m1.8.8.7.9.3.1.cmml"><mo id="S5.E10.m1.8.8.7.9.3.2.1" stretchy="false" xref="S5.E10.m1.8.8.7.9.3.1.cmml">(</mo><mi id="S5.E10.m1.2.2.1.1" xref="S5.E10.m1.2.2.1.1.cmml">x</mi><mo id="S5.E10.m1.8.8.7.9.3.2.2" xref="S5.E10.m1.8.8.7.9.3.1.cmml">,</mo><mi id="S5.E10.m1.3.3.2.2" xref="S5.E10.m1.3.3.2.2.cmml">y</mi><mo id="S5.E10.m1.8.8.7.9.3.2.3" stretchy="false" xref="S5.E10.m1.8.8.7.9.3.1.cmml">)</mo></mrow></mrow><mo id="S5.E10.m1.8.8.7.8" xref="S5.E10.m1.8.8.7.8.cmml">−</mo><mrow id="S5.E10.m1.8.8.7.7" xref="S5.E10.m1.8.8.7.7.cmml"><mi id="S5.E10.m1.8.8.7.7.4" xref="S5.E10.m1.8.8.7.7.4.cmml">β</mi><mo id="S5.E10.m1.8.8.7.7.3" lspace="0.167em" xref="S5.E10.m1.8.8.7.7.3.cmml">⁢</mo><mi id="S5.E10.m1.8.8.7.7.5" xref="S5.E10.m1.8.8.7.7.5.cmml">log</mi><mo id="S5.E10.m1.8.8.7.7.3a" xref="S5.E10.m1.8.8.7.7.3.cmml">⁢</mo><mrow id="S5.E10.m1.8.8.7.7.2" xref="S5.E10.m1.8.8.7.7.2.cmml"><munder id="S5.E10.m1.8.8.7.7.2.3" xref="S5.E10.m1.8.8.7.7.2.3.cmml"><mo id="S5.E10.m1.8.8.7.7.2.3.2" movablelimits="false" xref="S5.E10.m1.8.8.7.7.2.3.2.cmml">∑</mo><mi id="S5.E10.m1.8.8.7.7.2.3.3" xref="S5.E10.m1.8.8.7.7.2.3.3.cmml">y</mi></munder><mrow id="S5.E10.m1.8.8.7.7.2.2" xref="S5.E10.m1.8.8.7.7.2.2.cmml"><msub id="S5.E10.m1.8.8.7.7.2.2.4" xref="S5.E10.m1.8.8.7.7.2.2.4.cmml"><mi id="S5.E10.m1.8.8.7.7.2.2.4.2" xref="S5.E10.m1.8.8.7.7.2.2.4.2.cmml">π</mi><mtext id="S5.E10.m1.8.8.7.7.2.2.4.3" xref="S5.E10.m1.8.8.7.7.2.2.4.3a.cmml">ref</mtext></msub><mo id="S5.E10.m1.8.8.7.7.2.2.3" xref="S5.E10.m1.8.8.7.7.2.2.3.cmml">⁢</mo><mrow id="S5.E10.m1.7.7.6.6.1.1.1.1" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.cmml"><mo id="S5.E10.m1.7.7.6.6.1.1.1.1.2" stretchy="false" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.cmml">(</mo><mrow id="S5.E10.m1.7.7.6.6.1.1.1.1.1" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.cmml"><mi id="S5.E10.m1.7.7.6.6.1.1.1.1.1.2" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.2.cmml">y</mi><mo id="S5.E10.m1.7.7.6.6.1.1.1.1.1.1" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.E10.m1.7.7.6.6.1.1.1.1.1.3" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.E10.m1.7.7.6.6.1.1.1.1.3" stretchy="false" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.cmml">)</mo></mrow><mo id="S5.E10.m1.8.8.7.7.2.2.3a" lspace="0.167em" xref="S5.E10.m1.8.8.7.7.2.2.3.cmml">⁢</mo><mrow id="S5.E10.m1.8.8.7.7.2.2.2.1" xref="S5.E10.m1.8.8.7.7.2.2.2.2.cmml"><mi id="S5.E10.m1.6.6.5.5" xref="S5.E10.m1.6.6.5.5.cmml">exp</mi><mo id="S5.E10.m1.8.8.7.7.2.2.2.1a" xref="S5.E10.m1.8.8.7.7.2.2.2.2.cmml">⁡</mo><mrow id="S5.E10.m1.8.8.7.7.2.2.2.1.1" xref="S5.E10.m1.8.8.7.7.2.2.2.2.cmml"><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.2" xref="S5.E10.m1.8.8.7.7.2.2.2.2.cmml">(</mo><mrow id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.cmml"><mfrac id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.cmml"><mn id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.2" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.2.cmml">1</mn><mi id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.3" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.1" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.1.cmml">⁢</mo><msub id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.cmml"><mi id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.2" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.2.cmml">r</mi><mi id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.3" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.3.cmml">ϕ</mi></msub><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.1a" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.2" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.1.cmml"><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.2.1" stretchy="false" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.1.cmml">(</mo><mi id="S5.E10.m1.4.4.3.3" xref="S5.E10.m1.4.4.3.3.cmml">x</mi><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.2.2" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.1.cmml">,</mo><mi id="S5.E10.m1.5.5.4.4" xref="S5.E10.m1.5.5.4.4.cmml">y</mi><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.2.3" stretchy="false" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="S5.E10.m1.8.8.7.7.2.2.2.1.1.3" xref="S5.E10.m1.8.8.7.7.2.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow><mo id="S5.E10.m1.8.8.8" xref="S5.E10.m1.8.8.8.cmml">⏟</mo></munder><mrow id="S5.E10.m1.11.11.3" xref="S5.E10.m1.11.11.3.cmml"><mi id="S5.E10.m1.11.11.3.5" xref="S5.E10.m1.11.11.3.5.cmml">f</mi><mo id="S5.E10.m1.11.11.3.4" xref="S5.E10.m1.11.11.3.4.cmml">⁢</mo><mrow id="S5.E10.m1.11.11.3.3.2" xref="S5.E10.m1.11.11.3.3.3.cmml"><mo id="S5.E10.m1.11.11.3.3.2.3" stretchy="false" xref="S5.E10.m1.11.11.3.3.3.cmml">(</mo><msub id="S5.E10.m1.10.10.2.2.1.1" xref="S5.E10.m1.10.10.2.2.1.1.cmml"><mi id="S5.E10.m1.10.10.2.2.1.1.2" xref="S5.E10.m1.10.10.2.2.1.1.2.cmml">r</mi><mi id="S5.E10.m1.10.10.2.2.1.1.3" xref="S5.E10.m1.10.10.2.2.1.1.3.cmml">ϕ</mi></msub><mo id="S5.E10.m1.11.11.3.3.2.4" xref="S5.E10.m1.11.11.3.3.3.cmml">,</mo><msub id="S5.E10.m1.11.11.3.3.2.2" xref="S5.E10.m1.11.11.3.3.2.2.cmml"><mi id="S5.E10.m1.11.11.3.3.2.2.2" xref="S5.E10.m1.11.11.3.3.2.2.2.cmml">π</mi><mtext id="S5.E10.m1.11.11.3.3.2.2.3" xref="S5.E10.m1.11.11.3.3.2.2.3a.cmml">ref</mtext></msub><mo id="S5.E10.m1.11.11.3.3.2.5" xref="S5.E10.m1.11.11.3.3.3.cmml">,</mo><mi id="S5.E10.m1.9.9.1.1" xref="S5.E10.m1.9.9.1.1.cmml">β</mi><mo id="S5.E10.m1.11.11.3.3.2.6" stretchy="false" xref="S5.E10.m1.11.11.3.3.3.cmml">)</mo></mrow></mrow></munder><mo id="S5.E10.m1.14.14.1.1.1.1" xref="S5.E10.m1.14.14.1.1.1.1.cmml">−</mo><munder id="S5.E10.m1.14.14.1.1.1.3" xref="S5.E10.m1.14.14.1.1.1.3.cmml"><munder accentunder="true" id="S5.E10.m1.13.13" xref="S5.E10.m1.13.13.cmml"><mrow id="S5.E10.m1.13.13.2" xref="S5.E10.m1.13.13.2.cmml"><mi id="S5.E10.m1.13.13.2.4" xref="S5.E10.m1.13.13.2.4.cmml">β</mi><mo id="S5.E10.m1.13.13.2.3" lspace="0.167em" xref="S5.E10.m1.13.13.2.3.cmml">⁢</mo><mrow id="S5.E10.m1.13.13.2.5" xref="S5.E10.m1.13.13.2.5.cmml"><mi id="S5.E10.m1.13.13.2.5.1" xref="S5.E10.m1.13.13.2.5.1.cmml">log</mi><mo id="S5.E10.m1.13.13.2.5a" lspace="0.167em" xref="S5.E10.m1.13.13.2.5.cmml">⁡</mo><mfrac id="S5.E10.m1.13.13.2.2" xref="S5.E10.m1.13.13.2.2.cmml"><mrow id="S5.E10.m1.12.12.1.1.1" xref="S5.E10.m1.12.12.1.1.1.cmml"><msub id="S5.E10.m1.12.12.1.1.1.3" xref="S5.E10.m1.12.12.1.1.1.3.cmml"><mi id="S5.E10.m1.12.12.1.1.1.3.2" xref="S5.E10.m1.12.12.1.1.1.3.2.cmml">π</mi><mi id="S5.E10.m1.12.12.1.1.1.3.3" xref="S5.E10.m1.12.12.1.1.1.3.3.cmml">θ</mi></msub><mo id="S5.E10.m1.12.12.1.1.1.2" xref="S5.E10.m1.12.12.1.1.1.2.cmml">⁢</mo><mrow id="S5.E10.m1.12.12.1.1.1.1.1" xref="S5.E10.m1.12.12.1.1.1.1.1.1.cmml"><mo id="S5.E10.m1.12.12.1.1.1.1.1.2" stretchy="false" xref="S5.E10.m1.12.12.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.E10.m1.12.12.1.1.1.1.1.1" xref="S5.E10.m1.12.12.1.1.1.1.1.1.cmml"><mi id="S5.E10.m1.12.12.1.1.1.1.1.1.2" xref="S5.E10.m1.12.12.1.1.1.1.1.1.2.cmml">y</mi><mo id="S5.E10.m1.12.12.1.1.1.1.1.1.1" xref="S5.E10.m1.12.12.1.1.1.1.1.1.1.cmml">∣</mo><mi id="S5.E10.m1.12.12.1.1.1.1.1.1.3" xref="S5.E10.m1.12.12.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S5.E10.m1.12.12.1.1.1.1.1.3" stretchy="false" xref="S5.E10.m1.12.12.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S5.E10.m1.13.13.2.2.2" xref="S5.E10.m1.13.13.2.2.2.cmml"><msub id="S5.E10.m1.13.13.2.2.2.3" xref="S5.E10.m1.13.13.2.2.2.3.cmml"><mi id="S5.E10.m1.13.13.2.2.2.3.2" xref="S5.E10.m1.13.13.2.2.2.3.2.cmml">π</mi><mtext id="S5.E10.m1.13.13.2.2.2.3.3" xref="S5.E10.m1.13.13.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="S5.E10.m1.13.13.2.2.2.2" xref="S5.E10.m1.13.13.2.2.2.2.cmml">⁢</mo><mrow id="S5.E10.m1.13.13.2.2.2.1.1" xref="S5.E10.m1.13.13.2.2.2.1.1.1.cmml"><mo id="S5.E10.m1.13.13.2.2.2.1.1.2" stretchy="false" xref="S5.E10.m1.13.13.2.2.2.1.1.1.cmml">(</mo><mrow id="S5.E10.m1.13.13.2.2.2.1.1.1" xref="S5.E10.m1.13.13.2.2.2.1.1.1.cmml"><mi id="S5.E10.m1.13.13.2.2.2.1.1.1.2" xref="S5.E10.m1.13.13.2.2.2.1.1.1.2.cmml">y</mi><mo id="S5.E10.m1.13.13.2.2.2.1.1.1.1" xref="S5.E10.m1.13.13.2.2.2.1.1.1.1.cmml">∣</mo><mi id="S5.E10.m1.13.13.2.2.2.1.1.1.3" xref="S5.E10.m1.13.13.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="S5.E10.m1.13.13.2.2.2.1.1.3" stretchy="false" xref="S5.E10.m1.13.13.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="S5.E10.m1.13.13.3" xref="S5.E10.m1.13.13.3.cmml">⏟</mo></munder><mtext id="S5.E10.m1.14.14.1.1.1.3.2" xref="S5.E10.m1.14.14.1.1.1.3.2a.cmml">KL</mtext></munder></mrow><mo id="S5.E10.m1.14.14.1.1.3" maxsize="210%" minsize="210%" xref="S5.E10.m1.14.14.1.2.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.E10.m1.14b"><apply id="S5.E10.m1.14.14.cmml" xref="S5.E10.m1.14.14"><times id="S5.E10.m1.14.14.2.cmml" xref="S5.E10.m1.14.14.2"></times><apply id="S5.E10.m1.14.14.3.cmml" xref="S5.E10.m1.14.14.3"><apply id="S5.E10.m1.14.14.3.1.cmml" xref="S5.E10.m1.14.14.3.1"><csymbol cd="ambiguous" id="S5.E10.m1.14.14.3.1.1.cmml" xref="S5.E10.m1.14.14.3.1">subscript</csymbol><max id="S5.E10.m1.14.14.3.1.2.cmml" xref="S5.E10.m1.14.14.3.1.2"></max><apply id="S5.E10.m1.14.14.3.1.3.cmml" xref="S5.E10.m1.14.14.3.1.3"><csymbol cd="ambiguous" id="S5.E10.m1.14.14.3.1.3.1.cmml" xref="S5.E10.m1.14.14.3.1.3">subscript</csymbol><ci id="S5.E10.m1.14.14.3.1.3.2.cmml" xref="S5.E10.m1.14.14.3.1.3.2">𝜋</ci><ci id="S5.E10.m1.14.14.3.1.3.3.cmml" xref="S5.E10.m1.14.14.3.1.3.3">𝜃</ci></apply></apply><apply id="S5.E10.m1.14.14.3.2.cmml" xref="S5.E10.m1.14.14.3.2"><csymbol cd="ambiguous" id="S5.E10.m1.14.14.3.2.1.cmml" xref="S5.E10.m1.14.14.3.2">subscript</csymbol><ci id="S5.E10.m1.14.14.3.2.2.cmml" xref="S5.E10.m1.14.14.3.2.2">𝔼</ci><apply id="S5.E10.m1.1.1.1.cmml" xref="S5.E10.m1.1.1.1"><times id="S5.E10.m1.1.1.1.2.cmml" xref="S5.E10.m1.1.1.1.2"></times><apply id="S5.E10.m1.1.1.1.3.cmml" xref="S5.E10.m1.1.1.1.3"><csymbol cd="ambiguous" id="S5.E10.m1.1.1.1.3.1.cmml" xref="S5.E10.m1.1.1.1.3">subscript</csymbol><ci id="S5.E10.m1.1.1.1.3.2.cmml" xref="S5.E10.m1.1.1.1.3.2">𝜋</ci><ci id="S5.E10.m1.1.1.1.3.3.cmml" xref="S5.E10.m1.1.1.1.3.3">𝜃</ci></apply><apply id="S5.E10.m1.1.1.1.1.1.1.cmml" xref="S5.E10.m1.1.1.1.1.1"><csymbol cd="latexml" id="S5.E10.m1.1.1.1.1.1.1.1.cmml" xref="S5.E10.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.E10.m1.1.1.1.1.1.1.2.cmml" xref="S5.E10.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="S5.E10.m1.1.1.1.1.1.1.3.cmml" xref="S5.E10.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply><apply id="S5.E10.m1.14.14.1.2.cmml" xref="S5.E10.m1.14.14.1.1"><csymbol cd="latexml" id="S5.E10.m1.14.14.1.2.1.cmml" xref="S5.E10.m1.14.14.1.1.2">delimited-[]</csymbol><apply id="S5.E10.m1.14.14.1.1.1.cmml" xref="S5.E10.m1.14.14.1.1.1"><minus id="S5.E10.m1.14.14.1.1.1.1.cmml" xref="S5.E10.m1.14.14.1.1.1.1"></minus><apply id="S5.E10.m1.14.14.1.1.1.2.cmml" xref="S5.E10.m1.14.14.1.1.1.2"><csymbol cd="ambiguous" id="S5.E10.m1.14.14.1.1.1.2.1.cmml" xref="S5.E10.m1.14.14.1.1.1.2">subscript</csymbol><apply id="S5.E10.m1.8.8.cmml" xref="S5.E10.m1.8.8"><ci id="S5.E10.m1.8.8.8.cmml" xref="S5.E10.m1.8.8.8">⏟</ci><apply id="S5.E10.m1.8.8.7.cmml" xref="S5.E10.m1.8.8.7"><minus id="S5.E10.m1.8.8.7.8.cmml" xref="S5.E10.m1.8.8.7.8"></minus><apply id="S5.E10.m1.8.8.7.9.cmml" xref="S5.E10.m1.8.8.7.9"><times id="S5.E10.m1.8.8.7.9.1.cmml" xref="S5.E10.m1.8.8.7.9.1"></times><apply id="S5.E10.m1.8.8.7.9.2.cmml" xref="S5.E10.m1.8.8.7.9.2"><csymbol cd="ambiguous" id="S5.E10.m1.8.8.7.9.2.1.cmml" xref="S5.E10.m1.8.8.7.9.2">subscript</csymbol><ci id="S5.E10.m1.8.8.7.9.2.2.cmml" xref="S5.E10.m1.8.8.7.9.2.2">𝑟</ci><ci id="S5.E10.m1.8.8.7.9.2.3.cmml" xref="S5.E10.m1.8.8.7.9.2.3">italic-ϕ</ci></apply><interval closure="open" id="S5.E10.m1.8.8.7.9.3.1.cmml" xref="S5.E10.m1.8.8.7.9.3.2"><ci id="S5.E10.m1.2.2.1.1.cmml" xref="S5.E10.m1.2.2.1.1">𝑥</ci><ci id="S5.E10.m1.3.3.2.2.cmml" xref="S5.E10.m1.3.3.2.2">𝑦</ci></interval></apply><apply id="S5.E10.m1.8.8.7.7.cmml" xref="S5.E10.m1.8.8.7.7"><times id="S5.E10.m1.8.8.7.7.3.cmml" xref="S5.E10.m1.8.8.7.7.3"></times><ci id="S5.E10.m1.8.8.7.7.4.cmml" xref="S5.E10.m1.8.8.7.7.4">𝛽</ci><log id="S5.E10.m1.8.8.7.7.5.cmml" xref="S5.E10.m1.8.8.7.7.5"></log><apply id="S5.E10.m1.8.8.7.7.2.cmml" xref="S5.E10.m1.8.8.7.7.2"><apply id="S5.E10.m1.8.8.7.7.2.3.cmml" xref="S5.E10.m1.8.8.7.7.2.3"><csymbol cd="ambiguous" id="S5.E10.m1.8.8.7.7.2.3.1.cmml" xref="S5.E10.m1.8.8.7.7.2.3">subscript</csymbol><sum id="S5.E10.m1.8.8.7.7.2.3.2.cmml" xref="S5.E10.m1.8.8.7.7.2.3.2"></sum><ci id="S5.E10.m1.8.8.7.7.2.3.3.cmml" xref="S5.E10.m1.8.8.7.7.2.3.3">𝑦</ci></apply><apply id="S5.E10.m1.8.8.7.7.2.2.cmml" xref="S5.E10.m1.8.8.7.7.2.2"><times id="S5.E10.m1.8.8.7.7.2.2.3.cmml" xref="S5.E10.m1.8.8.7.7.2.2.3"></times><apply id="S5.E10.m1.8.8.7.7.2.2.4.cmml" xref="S5.E10.m1.8.8.7.7.2.2.4"><csymbol cd="ambiguous" id="S5.E10.m1.8.8.7.7.2.2.4.1.cmml" xref="S5.E10.m1.8.8.7.7.2.2.4">subscript</csymbol><ci id="S5.E10.m1.8.8.7.7.2.2.4.2.cmml" xref="S5.E10.m1.8.8.7.7.2.2.4.2">𝜋</ci><ci id="S5.E10.m1.8.8.7.7.2.2.4.3a.cmml" xref="S5.E10.m1.8.8.7.7.2.2.4.3"><mtext id="S5.E10.m1.8.8.7.7.2.2.4.3.cmml" mathsize="70%" xref="S5.E10.m1.8.8.7.7.2.2.4.3">ref</mtext></ci></apply><apply id="S5.E10.m1.7.7.6.6.1.1.1.1.1.cmml" xref="S5.E10.m1.7.7.6.6.1.1.1.1"><csymbol cd="latexml" id="S5.E10.m1.7.7.6.6.1.1.1.1.1.1.cmml" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.1">conditional</csymbol><ci id="S5.E10.m1.7.7.6.6.1.1.1.1.1.2.cmml" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.2">𝑦</ci><ci id="S5.E10.m1.7.7.6.6.1.1.1.1.1.3.cmml" xref="S5.E10.m1.7.7.6.6.1.1.1.1.1.3">𝑥</ci></apply><apply id="S5.E10.m1.8.8.7.7.2.2.2.2.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1"><exp id="S5.E10.m1.6.6.5.5.cmml" xref="S5.E10.m1.6.6.5.5"></exp><apply id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1"><times id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.1.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.1"></times><apply id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2"><divide id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.1.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2"></divide><cn id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.2.cmml" type="integer" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.2">1</cn><ci id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.3.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.2.3">𝛽</ci></apply><apply id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.1.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3">subscript</csymbol><ci id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.2.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.2">𝑟</ci><ci id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.3.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.3.3">italic-ϕ</ci></apply><interval closure="open" id="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.1.cmml" xref="S5.E10.m1.8.8.7.7.2.2.2.1.1.1.4.2"><ci id="S5.E10.m1.4.4.3.3.cmml" xref="S5.E10.m1.4.4.3.3">𝑥</ci><ci id="S5.E10.m1.5.5.4.4.cmml" xref="S5.E10.m1.5.5.4.4">𝑦</ci></interval></apply></apply></apply></apply></apply></apply></apply><apply id="S5.E10.m1.11.11.3.cmml" xref="S5.E10.m1.11.11.3"><times id="S5.E10.m1.11.11.3.4.cmml" xref="S5.E10.m1.11.11.3.4"></times><ci id="S5.E10.m1.11.11.3.5.cmml" xref="S5.E10.m1.11.11.3.5">𝑓</ci><vector id="S5.E10.m1.11.11.3.3.3.cmml" xref="S5.E10.m1.11.11.3.3.2"><apply id="S5.E10.m1.10.10.2.2.1.1.cmml" xref="S5.E10.m1.10.10.2.2.1.1"><csymbol cd="ambiguous" id="S5.E10.m1.10.10.2.2.1.1.1.cmml" xref="S5.E10.m1.10.10.2.2.1.1">subscript</csymbol><ci id="S5.E10.m1.10.10.2.2.1.1.2.cmml" xref="S5.E10.m1.10.10.2.2.1.1.2">𝑟</ci><ci id="S5.E10.m1.10.10.2.2.1.1.3.cmml" xref="S5.E10.m1.10.10.2.2.1.1.3">italic-ϕ</ci></apply><apply id="S5.E10.m1.11.11.3.3.2.2.cmml" xref="S5.E10.m1.11.11.3.3.2.2"><csymbol cd="ambiguous" id="S5.E10.m1.11.11.3.3.2.2.1.cmml" xref="S5.E10.m1.11.11.3.3.2.2">subscript</csymbol><ci id="S5.E10.m1.11.11.3.3.2.2.2.cmml" xref="S5.E10.m1.11.11.3.3.2.2.2">𝜋</ci><ci id="S5.E10.m1.11.11.3.3.2.2.3a.cmml" xref="S5.E10.m1.11.11.3.3.2.2.3"><mtext id="S5.E10.m1.11.11.3.3.2.2.3.cmml" mathsize="50%" xref="S5.E10.m1.11.11.3.3.2.2.3">ref</mtext></ci></apply><ci id="S5.E10.m1.9.9.1.1.cmml" xref="S5.E10.m1.9.9.1.1">𝛽</ci></vector></apply></apply><apply id="S5.E10.m1.14.14.1.1.1.3.cmml" xref="S5.E10.m1.14.14.1.1.1.3"><csymbol cd="ambiguous" id="S5.E10.m1.14.14.1.1.1.3.1.cmml" xref="S5.E10.m1.14.14.1.1.1.3">subscript</csymbol><apply id="S5.E10.m1.13.13.cmml" xref="S5.E10.m1.13.13"><ci id="S5.E10.m1.13.13.3.cmml" xref="S5.E10.m1.13.13.3">⏟</ci><apply id="S5.E10.m1.13.13.2.cmml" xref="S5.E10.m1.13.13.2"><times id="S5.E10.m1.13.13.2.3.cmml" xref="S5.E10.m1.13.13.2.3"></times><ci id="S5.E10.m1.13.13.2.4.cmml" xref="S5.E10.m1.13.13.2.4">𝛽</ci><apply id="S5.E10.m1.13.13.2.5.cmml" xref="S5.E10.m1.13.13.2.5"><log id="S5.E10.m1.13.13.2.5.1.cmml" xref="S5.E10.m1.13.13.2.5.1"></log><apply id="S5.E10.m1.13.13.2.2.cmml" xref="S5.E10.m1.13.13.2.2"><divide id="S5.E10.m1.13.13.2.2.3.cmml" xref="S5.E10.m1.13.13.2.2"></divide><apply id="S5.E10.m1.12.12.1.1.1.cmml" xref="S5.E10.m1.12.12.1.1.1"><times id="S5.E10.m1.12.12.1.1.1.2.cmml" xref="S5.E10.m1.12.12.1.1.1.2"></times><apply id="S5.E10.m1.12.12.1.1.1.3.cmml" xref="S5.E10.m1.12.12.1.1.1.3"><csymbol cd="ambiguous" id="S5.E10.m1.12.12.1.1.1.3.1.cmml" xref="S5.E10.m1.12.12.1.1.1.3">subscript</csymbol><ci id="S5.E10.m1.12.12.1.1.1.3.2.cmml" xref="S5.E10.m1.12.12.1.1.1.3.2">𝜋</ci><ci id="S5.E10.m1.12.12.1.1.1.3.3.cmml" xref="S5.E10.m1.12.12.1.1.1.3.3">𝜃</ci></apply><apply id="S5.E10.m1.12.12.1.1.1.1.1.1.cmml" xref="S5.E10.m1.12.12.1.1.1.1.1"><csymbol cd="latexml" id="S5.E10.m1.12.12.1.1.1.1.1.1.1.cmml" xref="S5.E10.m1.12.12.1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.E10.m1.12.12.1.1.1.1.1.1.2.cmml" xref="S5.E10.m1.12.12.1.1.1.1.1.1.2">𝑦</ci><ci id="S5.E10.m1.12.12.1.1.1.1.1.1.3.cmml" xref="S5.E10.m1.12.12.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S5.E10.m1.13.13.2.2.2.cmml" xref="S5.E10.m1.13.13.2.2.2"><times id="S5.E10.m1.13.13.2.2.2.2.cmml" xref="S5.E10.m1.13.13.2.2.2.2"></times><apply id="S5.E10.m1.13.13.2.2.2.3.cmml" xref="S5.E10.m1.13.13.2.2.2.3"><csymbol cd="ambiguous" id="S5.E10.m1.13.13.2.2.2.3.1.cmml" xref="S5.E10.m1.13.13.2.2.2.3">subscript</csymbol><ci id="S5.E10.m1.13.13.2.2.2.3.2.cmml" xref="S5.E10.m1.13.13.2.2.2.3.2">𝜋</ci><ci id="S5.E10.m1.13.13.2.2.2.3.3a.cmml" xref="S5.E10.m1.13.13.2.2.2.3.3"><mtext id="S5.E10.m1.13.13.2.2.2.3.3.cmml" mathsize="70%" xref="S5.E10.m1.13.13.2.2.2.3.3">ref</mtext></ci></apply><apply id="S5.E10.m1.13.13.2.2.2.1.1.1.cmml" xref="S5.E10.m1.13.13.2.2.2.1.1"><csymbol cd="latexml" id="S5.E10.m1.13.13.2.2.2.1.1.1.1.cmml" xref="S5.E10.m1.13.13.2.2.2.1.1.1.1">conditional</csymbol><ci id="S5.E10.m1.13.13.2.2.2.1.1.1.2.cmml" xref="S5.E10.m1.13.13.2.2.2.1.1.1.2">𝑦</ci><ci id="S5.E10.m1.13.13.2.2.2.1.1.1.3.cmml" xref="S5.E10.m1.13.13.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><ci id="S5.E10.m1.14.14.1.1.1.3.2a.cmml" xref="S5.E10.m1.14.14.1.1.1.3.2"><mtext id="S5.E10.m1.14.14.1.1.1.3.2.cmml" mathsize="70%" xref="S5.E10.m1.14.14.1.1.1.3.2">KL</mtext></ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E10.m1.14c">\max_{\pi_{\theta}}\mathbb{E}_{\pi_{\theta}(y\mid x)}\bigg{[}\underbrace{r_{%
\phi}(x,y)-\beta\log\sum_{y}\pi_{\text{ref}}(y\mid x)\exp\left(\frac{1}{\beta}%
r_{\phi}(x,y)\right)}_{f(r_{\phi},\pi_{\text{ref}},\beta)}-\underbrace{\beta%
\log\frac{\pi_{\theta}(y\mid x)}{\pi_{\text{ref}}(y\mid x)}}_{\text{KL}}\bigg{]}</annotation><annotation encoding="application/x-llamapun" id="S5.E10.m1.14d">roman_max start_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_POSTSUBSCRIPT [ under⏟ start_ARG italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y ) - italic_β roman_log ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT ( italic_x , italic_y ) ) end_ARG start_POSTSUBSCRIPT italic_f ( italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) end_POSTSUBSCRIPT - under⏟ start_ARG italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG end_ARG start_POSTSUBSCRIPT KL end_POSTSUBSCRIPT ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(10)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS2.p1.7">This is the same objective optimized in prior works
<cite class="ltx_cite ltx_citemacro_citep">(Ziegler et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib49" title="">2020</a>; Stiennon et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">2022</a>; Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib1" title="">2022a</a>; Ouyang et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib26" title="">2022</a>)</cite> using the DPO-equivalent reward for the reward class of <math alttext="r_{\phi}" class="ltx_Math" display="inline" id="S5.SS2.p1.5.m1.1"><semantics id="S5.SS2.p1.5.m1.1a"><msub id="S5.SS2.p1.5.m1.1.1" xref="S5.SS2.p1.5.m1.1.1.cmml"><mi id="S5.SS2.p1.5.m1.1.1.2" xref="S5.SS2.p1.5.m1.1.1.2.cmml">r</mi><mi id="S5.SS2.p1.5.m1.1.1.3" xref="S5.SS2.p1.5.m1.1.1.3.cmml">ϕ</mi></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.5.m1.1b"><apply id="S5.SS2.p1.5.m1.1.1.cmml" xref="S5.SS2.p1.5.m1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.5.m1.1.1.1.cmml" xref="S5.SS2.p1.5.m1.1.1">subscript</csymbol><ci id="S5.SS2.p1.5.m1.1.1.2.cmml" xref="S5.SS2.p1.5.m1.1.1.2">𝑟</ci><ci id="S5.SS2.p1.5.m1.1.1.3.cmml" xref="S5.SS2.p1.5.m1.1.1.3">italic-ϕ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.5.m1.1c">r_{\phi}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.5.m1.1d">italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT</annotation></semantics></math>. In this setting, we can interpret the normalization term in <math alttext="f(r_{\phi},\pi_{\text{ref}},\beta)" class="ltx_Math" display="inline" id="S5.SS2.p1.6.m2.3"><semantics id="S5.SS2.p1.6.m2.3a"><mrow id="S5.SS2.p1.6.m2.3.3" xref="S5.SS2.p1.6.m2.3.3.cmml"><mi id="S5.SS2.p1.6.m2.3.3.4" xref="S5.SS2.p1.6.m2.3.3.4.cmml">f</mi><mo id="S5.SS2.p1.6.m2.3.3.3" xref="S5.SS2.p1.6.m2.3.3.3.cmml">⁢</mo><mrow id="S5.SS2.p1.6.m2.3.3.2.2" xref="S5.SS2.p1.6.m2.3.3.2.3.cmml"><mo id="S5.SS2.p1.6.m2.3.3.2.2.3" stretchy="false" xref="S5.SS2.p1.6.m2.3.3.2.3.cmml">(</mo><msub id="S5.SS2.p1.6.m2.2.2.1.1.1" xref="S5.SS2.p1.6.m2.2.2.1.1.1.cmml"><mi id="S5.SS2.p1.6.m2.2.2.1.1.1.2" xref="S5.SS2.p1.6.m2.2.2.1.1.1.2.cmml">r</mi><mi id="S5.SS2.p1.6.m2.2.2.1.1.1.3" xref="S5.SS2.p1.6.m2.2.2.1.1.1.3.cmml">ϕ</mi></msub><mo id="S5.SS2.p1.6.m2.3.3.2.2.4" xref="S5.SS2.p1.6.m2.3.3.2.3.cmml">,</mo><msub id="S5.SS2.p1.6.m2.3.3.2.2.2" xref="S5.SS2.p1.6.m2.3.3.2.2.2.cmml"><mi id="S5.SS2.p1.6.m2.3.3.2.2.2.2" xref="S5.SS2.p1.6.m2.3.3.2.2.2.2.cmml">π</mi><mtext id="S5.SS2.p1.6.m2.3.3.2.2.2.3" xref="S5.SS2.p1.6.m2.3.3.2.2.2.3a.cmml">ref</mtext></msub><mo id="S5.SS2.p1.6.m2.3.3.2.2.5" xref="S5.SS2.p1.6.m2.3.3.2.3.cmml">,</mo><mi id="S5.SS2.p1.6.m2.1.1" xref="S5.SS2.p1.6.m2.1.1.cmml">β</mi><mo id="S5.SS2.p1.6.m2.3.3.2.2.6" stretchy="false" xref="S5.SS2.p1.6.m2.3.3.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.6.m2.3b"><apply id="S5.SS2.p1.6.m2.3.3.cmml" xref="S5.SS2.p1.6.m2.3.3"><times id="S5.SS2.p1.6.m2.3.3.3.cmml" xref="S5.SS2.p1.6.m2.3.3.3"></times><ci id="S5.SS2.p1.6.m2.3.3.4.cmml" xref="S5.SS2.p1.6.m2.3.3.4">𝑓</ci><vector id="S5.SS2.p1.6.m2.3.3.2.3.cmml" xref="S5.SS2.p1.6.m2.3.3.2.2"><apply id="S5.SS2.p1.6.m2.2.2.1.1.1.cmml" xref="S5.SS2.p1.6.m2.2.2.1.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.6.m2.2.2.1.1.1.1.cmml" xref="S5.SS2.p1.6.m2.2.2.1.1.1">subscript</csymbol><ci id="S5.SS2.p1.6.m2.2.2.1.1.1.2.cmml" xref="S5.SS2.p1.6.m2.2.2.1.1.1.2">𝑟</ci><ci id="S5.SS2.p1.6.m2.2.2.1.1.1.3.cmml" xref="S5.SS2.p1.6.m2.2.2.1.1.1.3">italic-ϕ</ci></apply><apply id="S5.SS2.p1.6.m2.3.3.2.2.2.cmml" xref="S5.SS2.p1.6.m2.3.3.2.2.2"><csymbol cd="ambiguous" id="S5.SS2.p1.6.m2.3.3.2.2.2.1.cmml" xref="S5.SS2.p1.6.m2.3.3.2.2.2">subscript</csymbol><ci id="S5.SS2.p1.6.m2.3.3.2.2.2.2.cmml" xref="S5.SS2.p1.6.m2.3.3.2.2.2.2">𝜋</ci><ci id="S5.SS2.p1.6.m2.3.3.2.2.2.3a.cmml" xref="S5.SS2.p1.6.m2.3.3.2.2.2.3"><mtext id="S5.SS2.p1.6.m2.3.3.2.2.2.3.cmml" mathsize="70%" xref="S5.SS2.p1.6.m2.3.3.2.2.2.3">ref</mtext></ci></apply><ci id="S5.SS2.p1.6.m2.1.1.cmml" xref="S5.SS2.p1.6.m2.1.1">𝛽</ci></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.6.m2.3c">f(r_{\phi},\pi_{\text{ref}},\beta)</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.6.m2.3d">italic_f ( italic_r start_POSTSUBSCRIPT italic_ϕ end_POSTSUBSCRIPT , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β )</annotation></semantics></math> as the soft value function of the reference policy <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="S5.SS2.p1.7.m3.1"><semantics id="S5.SS2.p1.7.m3.1a"><msub id="S5.SS2.p1.7.m3.1.1" xref="S5.SS2.p1.7.m3.1.1.cmml"><mi id="S5.SS2.p1.7.m3.1.1.2" xref="S5.SS2.p1.7.m3.1.1.2.cmml">π</mi><mtext id="S5.SS2.p1.7.m3.1.1.3" xref="S5.SS2.p1.7.m3.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.7.m3.1b"><apply id="S5.SS2.p1.7.m3.1.1.cmml" xref="S5.SS2.p1.7.m3.1.1"><csymbol cd="ambiguous" id="S5.SS2.p1.7.m3.1.1.1.cmml" xref="S5.SS2.p1.7.m3.1.1">subscript</csymbol><ci id="S5.SS2.p1.7.m3.1.1.2.cmml" xref="S5.SS2.p1.7.m3.1.1.2">𝜋</ci><ci id="S5.SS2.p1.7.m3.1.1.3a.cmml" xref="S5.SS2.p1.7.m3.1.1.3"><mtext id="S5.SS2.p1.7.m3.1.1.3.cmml" mathsize="70%" xref="S5.SS2.p1.7.m3.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.7.m3.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.7.m3.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math>. While this term does not affect the optimal solution, without it, the policy gradient of the objective could have high variance, making learning unstable. We can accommodate for the normalization term using a learned value function, but that can also be difficult to optimize. Alternatively, prior works have normalized rewards using a human completion baseline, essentially a single sample Monte-Carlo estimate of the normalizing term. In contrast the DPO reparameterization yields a reward function that does not require any baselines.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Experiments</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">In this section, we empirically evaluate DPO’s ability to train policies directly from preferences. First, in a well-controlled text-generation setting, we ask: how efficiently does DPO trade off maximizing reward and minimizing KL-divergence with the reference policy, compared to common preference learning algorithms such as PPO? Next, we evaluate DPO’s performance on larger models and more difficult RLHF tasks, including summarization and dialogue. We find that with almost no tuning of hyperparameters, DPO tends to perform as well or better than strong baselines like RLHF with PPO as well as returning the best of <math alttext="N" class="ltx_Math" display="inline" id="S6.p1.1.m1.1"><semantics id="S6.p1.1.m1.1a"><mi id="S6.p1.1.m1.1.1" xref="S6.p1.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.p1.1.m1.1b"><ci id="S6.p1.1.m1.1.1.cmml" xref="S6.p1.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p1.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.p1.1.m1.1d">italic_N</annotation></semantics></math> sampled trajectories under a learned reward function. Before presenting these results, we describe the experimental set-up; additional details are in Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3" title="Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">C</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S6.p2">
<p class="ltx_p" id="S6.p2.8"><span class="ltx_text ltx_font_bold" id="S6.p2.8.1">Tasks.</span> Our experiments explore three different open-ended text generation tasks. For all experiments, algorithms learn a policy from a dataset of preferences <math alttext="\mathcal{D}=\bigl{\{}x^{(i)},y_{w}^{(i)},y_{l}^{(i)}\bigr{\}}_{i=1}^{N}" class="ltx_Math" display="inline" id="S6.p2.1.m1.6"><semantics id="S6.p2.1.m1.6a"><mrow id="S6.p2.1.m1.6.6" xref="S6.p2.1.m1.6.6.cmml"><mi class="ltx_font_mathcaligraphic" id="S6.p2.1.m1.6.6.5" xref="S6.p2.1.m1.6.6.5.cmml">𝒟</mi><mo id="S6.p2.1.m1.6.6.4" xref="S6.p2.1.m1.6.6.4.cmml">=</mo><msubsup id="S6.p2.1.m1.6.6.3" xref="S6.p2.1.m1.6.6.3.cmml"><mrow id="S6.p2.1.m1.6.6.3.3.3.3" xref="S6.p2.1.m1.6.6.3.3.3.4.cmml"><mo id="S6.p2.1.m1.6.6.3.3.3.3.4" maxsize="120%" minsize="120%" xref="S6.p2.1.m1.6.6.3.3.3.4.cmml">{</mo><msup id="S6.p2.1.m1.4.4.1.1.1.1.1" xref="S6.p2.1.m1.4.4.1.1.1.1.1.cmml"><mi id="S6.p2.1.m1.4.4.1.1.1.1.1.2" xref="S6.p2.1.m1.4.4.1.1.1.1.1.2.cmml">x</mi><mrow id="S6.p2.1.m1.1.1.1.3" xref="S6.p2.1.m1.4.4.1.1.1.1.1.cmml"><mo id="S6.p2.1.m1.1.1.1.3.1" stretchy="false" xref="S6.p2.1.m1.4.4.1.1.1.1.1.cmml">(</mo><mi id="S6.p2.1.m1.1.1.1.1" xref="S6.p2.1.m1.1.1.1.1.cmml">i</mi><mo id="S6.p2.1.m1.1.1.1.3.2" stretchy="false" xref="S6.p2.1.m1.4.4.1.1.1.1.1.cmml">)</mo></mrow></msup><mo id="S6.p2.1.m1.6.6.3.3.3.3.5" xref="S6.p2.1.m1.6.6.3.3.3.4.cmml">,</mo><msubsup id="S6.p2.1.m1.5.5.2.2.2.2.2" xref="S6.p2.1.m1.5.5.2.2.2.2.2.cmml"><mi id="S6.p2.1.m1.5.5.2.2.2.2.2.2.2" xref="S6.p2.1.m1.5.5.2.2.2.2.2.2.2.cmml">y</mi><mi id="S6.p2.1.m1.5.5.2.2.2.2.2.2.3" xref="S6.p2.1.m1.5.5.2.2.2.2.2.2.3.cmml">w</mi><mrow id="S6.p2.1.m1.2.2.1.3" xref="S6.p2.1.m1.5.5.2.2.2.2.2.cmml"><mo id="S6.p2.1.m1.2.2.1.3.1" stretchy="false" xref="S6.p2.1.m1.5.5.2.2.2.2.2.cmml">(</mo><mi id="S6.p2.1.m1.2.2.1.1" xref="S6.p2.1.m1.2.2.1.1.cmml">i</mi><mo id="S6.p2.1.m1.2.2.1.3.2" stretchy="false" xref="S6.p2.1.m1.5.5.2.2.2.2.2.cmml">)</mo></mrow></msubsup><mo id="S6.p2.1.m1.6.6.3.3.3.3.6" xref="S6.p2.1.m1.6.6.3.3.3.4.cmml">,</mo><msubsup id="S6.p2.1.m1.6.6.3.3.3.3.3" xref="S6.p2.1.m1.6.6.3.3.3.3.3.cmml"><mi id="S6.p2.1.m1.6.6.3.3.3.3.3.2.2" xref="S6.p2.1.m1.6.6.3.3.3.3.3.2.2.cmml">y</mi><mi id="S6.p2.1.m1.6.6.3.3.3.3.3.2.3" xref="S6.p2.1.m1.6.6.3.3.3.3.3.2.3.cmml">l</mi><mrow id="S6.p2.1.m1.3.3.1.3" xref="S6.p2.1.m1.6.6.3.3.3.3.3.cmml"><mo id="S6.p2.1.m1.3.3.1.3.1" stretchy="false" xref="S6.p2.1.m1.6.6.3.3.3.3.3.cmml">(</mo><mi id="S6.p2.1.m1.3.3.1.1" xref="S6.p2.1.m1.3.3.1.1.cmml">i</mi><mo id="S6.p2.1.m1.3.3.1.3.2" stretchy="false" xref="S6.p2.1.m1.6.6.3.3.3.3.3.cmml">)</mo></mrow></msubsup><mo id="S6.p2.1.m1.6.6.3.3.3.3.7" maxsize="120%" minsize="120%" xref="S6.p2.1.m1.6.6.3.3.3.4.cmml">}</mo></mrow><mrow id="S6.p2.1.m1.6.6.3.3.5" xref="S6.p2.1.m1.6.6.3.3.5.cmml"><mi id="S6.p2.1.m1.6.6.3.3.5.2" xref="S6.p2.1.m1.6.6.3.3.5.2.cmml">i</mi><mo id="S6.p2.1.m1.6.6.3.3.5.1" xref="S6.p2.1.m1.6.6.3.3.5.1.cmml">=</mo><mn id="S6.p2.1.m1.6.6.3.3.5.3" xref="S6.p2.1.m1.6.6.3.3.5.3.cmml">1</mn></mrow><mi id="S6.p2.1.m1.6.6.3.5" xref="S6.p2.1.m1.6.6.3.5.cmml">N</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S6.p2.1.m1.6b"><apply id="S6.p2.1.m1.6.6.cmml" xref="S6.p2.1.m1.6.6"><eq id="S6.p2.1.m1.6.6.4.cmml" xref="S6.p2.1.m1.6.6.4"></eq><ci id="S6.p2.1.m1.6.6.5.cmml" xref="S6.p2.1.m1.6.6.5">𝒟</ci><apply id="S6.p2.1.m1.6.6.3.cmml" xref="S6.p2.1.m1.6.6.3"><csymbol cd="ambiguous" id="S6.p2.1.m1.6.6.3.4.cmml" xref="S6.p2.1.m1.6.6.3">superscript</csymbol><apply id="S6.p2.1.m1.6.6.3.3.cmml" xref="S6.p2.1.m1.6.6.3"><csymbol cd="ambiguous" id="S6.p2.1.m1.6.6.3.3.4.cmml" xref="S6.p2.1.m1.6.6.3">subscript</csymbol><set id="S6.p2.1.m1.6.6.3.3.3.4.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3"><apply id="S6.p2.1.m1.4.4.1.1.1.1.1.cmml" xref="S6.p2.1.m1.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="S6.p2.1.m1.4.4.1.1.1.1.1.1.cmml" xref="S6.p2.1.m1.4.4.1.1.1.1.1">superscript</csymbol><ci id="S6.p2.1.m1.4.4.1.1.1.1.1.2.cmml" xref="S6.p2.1.m1.4.4.1.1.1.1.1.2">𝑥</ci><ci id="S6.p2.1.m1.1.1.1.1.cmml" xref="S6.p2.1.m1.1.1.1.1">𝑖</ci></apply><apply id="S6.p2.1.m1.5.5.2.2.2.2.2.cmml" xref="S6.p2.1.m1.5.5.2.2.2.2.2"><csymbol cd="ambiguous" id="S6.p2.1.m1.5.5.2.2.2.2.2.1.cmml" xref="S6.p2.1.m1.5.5.2.2.2.2.2">superscript</csymbol><apply id="S6.p2.1.m1.5.5.2.2.2.2.2.2.cmml" xref="S6.p2.1.m1.5.5.2.2.2.2.2"><csymbol cd="ambiguous" id="S6.p2.1.m1.5.5.2.2.2.2.2.2.1.cmml" xref="S6.p2.1.m1.5.5.2.2.2.2.2">subscript</csymbol><ci id="S6.p2.1.m1.5.5.2.2.2.2.2.2.2.cmml" xref="S6.p2.1.m1.5.5.2.2.2.2.2.2.2">𝑦</ci><ci id="S6.p2.1.m1.5.5.2.2.2.2.2.2.3.cmml" xref="S6.p2.1.m1.5.5.2.2.2.2.2.2.3">𝑤</ci></apply><ci id="S6.p2.1.m1.2.2.1.1.cmml" xref="S6.p2.1.m1.2.2.1.1">𝑖</ci></apply><apply id="S6.p2.1.m1.6.6.3.3.3.3.3.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3.3"><csymbol cd="ambiguous" id="S6.p2.1.m1.6.6.3.3.3.3.3.1.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3.3">superscript</csymbol><apply id="S6.p2.1.m1.6.6.3.3.3.3.3.2.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3.3"><csymbol cd="ambiguous" id="S6.p2.1.m1.6.6.3.3.3.3.3.2.1.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3.3">subscript</csymbol><ci id="S6.p2.1.m1.6.6.3.3.3.3.3.2.2.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3.3.2.2">𝑦</ci><ci id="S6.p2.1.m1.6.6.3.3.3.3.3.2.3.cmml" xref="S6.p2.1.m1.6.6.3.3.3.3.3.2.3">𝑙</ci></apply><ci id="S6.p2.1.m1.3.3.1.1.cmml" xref="S6.p2.1.m1.3.3.1.1">𝑖</ci></apply></set><apply id="S6.p2.1.m1.6.6.3.3.5.cmml" xref="S6.p2.1.m1.6.6.3.3.5"><eq id="S6.p2.1.m1.6.6.3.3.5.1.cmml" xref="S6.p2.1.m1.6.6.3.3.5.1"></eq><ci id="S6.p2.1.m1.6.6.3.3.5.2.cmml" xref="S6.p2.1.m1.6.6.3.3.5.2">𝑖</ci><cn id="S6.p2.1.m1.6.6.3.3.5.3.cmml" type="integer" xref="S6.p2.1.m1.6.6.3.3.5.3">1</cn></apply></apply><ci id="S6.p2.1.m1.6.6.3.5.cmml" xref="S6.p2.1.m1.6.6.3.5">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.1.m1.6c">\mathcal{D}=\bigl{\{}x^{(i)},y_{w}^{(i)},y_{l}^{(i)}\bigr{\}}_{i=1}^{N}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.1.m1.6d">caligraphic_D = { italic_x start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT</annotation></semantics></math>. In <span class="ltx_text ltx_font_bold" id="S6.p2.8.2">controlled sentiment generation</span>, <math alttext="x" class="ltx_Math" display="inline" id="S6.p2.2.m2.1"><semantics id="S6.p2.2.m2.1a"><mi id="S6.p2.2.m2.1.1" xref="S6.p2.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S6.p2.2.m2.1b"><ci id="S6.p2.2.m2.1.1.cmml" xref="S6.p2.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.2.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="S6.p2.2.m2.1d">italic_x</annotation></semantics></math> is a prefix of a movie review from the IMDb dataset <cite class="ltx_cite ltx_citemacro_cite">Maas et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib22" title="">2011</a>)</cite>, and the policy must generate <math alttext="y" class="ltx_Math" display="inline" id="S6.p2.3.m3.1"><semantics id="S6.p2.3.m3.1a"><mi id="S6.p2.3.m3.1.1" xref="S6.p2.3.m3.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S6.p2.3.m3.1b"><ci id="S6.p2.3.m3.1.1.cmml" xref="S6.p2.3.m3.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.3.m3.1c">y</annotation><annotation encoding="application/x-llamapun" id="S6.p2.3.m3.1d">italic_y</annotation></semantics></math> with positive sentiment. In order to perform a controlled evaluation, for this experiment we <span class="ltx_text ltx_font_italic" id="S6.p2.8.3">generate</span> preference pairs over generations using a pre-trained sentiment classifier, where <math alttext="p(\text{positive}\mid x,y_{w})>p(\text{positive}\mid x,y_{l})" class="ltx_Math" display="inline" id="S6.p2.4.m4.4"><semantics id="S6.p2.4.m4.4a"><mrow id="S6.p2.4.m4.4.4" xref="S6.p2.4.m4.4.4.cmml"><mrow id="S6.p2.4.m4.3.3.1" xref="S6.p2.4.m4.3.3.1.cmml"><mi id="S6.p2.4.m4.3.3.1.3" xref="S6.p2.4.m4.3.3.1.3.cmml">p</mi><mo id="S6.p2.4.m4.3.3.1.2" xref="S6.p2.4.m4.3.3.1.2.cmml">⁢</mo><mrow id="S6.p2.4.m4.3.3.1.1.1" xref="S6.p2.4.m4.3.3.1.1.1.1.cmml"><mo id="S6.p2.4.m4.3.3.1.1.1.2" stretchy="false" xref="S6.p2.4.m4.3.3.1.1.1.1.cmml">(</mo><mrow id="S6.p2.4.m4.3.3.1.1.1.1" xref="S6.p2.4.m4.3.3.1.1.1.1.cmml"><mtext id="S6.p2.4.m4.3.3.1.1.1.1.3" xref="S6.p2.4.m4.3.3.1.1.1.1.3a.cmml">positive</mtext><mo id="S6.p2.4.m4.3.3.1.1.1.1.2" xref="S6.p2.4.m4.3.3.1.1.1.1.2.cmml">∣</mo><mrow id="S6.p2.4.m4.3.3.1.1.1.1.1.1" xref="S6.p2.4.m4.3.3.1.1.1.1.1.2.cmml"><mi id="S6.p2.4.m4.1.1" xref="S6.p2.4.m4.1.1.cmml">x</mi><mo id="S6.p2.4.m4.3.3.1.1.1.1.1.1.2" xref="S6.p2.4.m4.3.3.1.1.1.1.1.2.cmml">,</mo><msub id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.cmml"><mi id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.2" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.2.cmml">y</mi><mi id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.3" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.3.cmml">w</mi></msub></mrow></mrow><mo id="S6.p2.4.m4.3.3.1.1.1.3" stretchy="false" xref="S6.p2.4.m4.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S6.p2.4.m4.4.4.3" xref="S6.p2.4.m4.4.4.3.cmml">&gt;</mo><mrow id="S6.p2.4.m4.4.4.2" xref="S6.p2.4.m4.4.4.2.cmml"><mi id="S6.p2.4.m4.4.4.2.3" xref="S6.p2.4.m4.4.4.2.3.cmml">p</mi><mo id="S6.p2.4.m4.4.4.2.2" xref="S6.p2.4.m4.4.4.2.2.cmml">⁢</mo><mrow id="S6.p2.4.m4.4.4.2.1.1" xref="S6.p2.4.m4.4.4.2.1.1.1.cmml"><mo id="S6.p2.4.m4.4.4.2.1.1.2" stretchy="false" xref="S6.p2.4.m4.4.4.2.1.1.1.cmml">(</mo><mrow id="S6.p2.4.m4.4.4.2.1.1.1" xref="S6.p2.4.m4.4.4.2.1.1.1.cmml"><mtext id="S6.p2.4.m4.4.4.2.1.1.1.3" xref="S6.p2.4.m4.4.4.2.1.1.1.3a.cmml">positive</mtext><mo id="S6.p2.4.m4.4.4.2.1.1.1.2" xref="S6.p2.4.m4.4.4.2.1.1.1.2.cmml">∣</mo><mrow id="S6.p2.4.m4.4.4.2.1.1.1.1.1" xref="S6.p2.4.m4.4.4.2.1.1.1.1.2.cmml"><mi id="S6.p2.4.m4.2.2" xref="S6.p2.4.m4.2.2.cmml">x</mi><mo id="S6.p2.4.m4.4.4.2.1.1.1.1.1.2" xref="S6.p2.4.m4.4.4.2.1.1.1.1.2.cmml">,</mo><msub id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.cmml"><mi id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.2" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.2.cmml">y</mi><mi id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.3" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.3.cmml">l</mi></msub></mrow></mrow><mo id="S6.p2.4.m4.4.4.2.1.1.3" stretchy="false" xref="S6.p2.4.m4.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.p2.4.m4.4b"><apply id="S6.p2.4.m4.4.4.cmml" xref="S6.p2.4.m4.4.4"><gt id="S6.p2.4.m4.4.4.3.cmml" xref="S6.p2.4.m4.4.4.3"></gt><apply id="S6.p2.4.m4.3.3.1.cmml" xref="S6.p2.4.m4.3.3.1"><times id="S6.p2.4.m4.3.3.1.2.cmml" xref="S6.p2.4.m4.3.3.1.2"></times><ci id="S6.p2.4.m4.3.3.1.3.cmml" xref="S6.p2.4.m4.3.3.1.3">𝑝</ci><apply id="S6.p2.4.m4.3.3.1.1.1.1.cmml" xref="S6.p2.4.m4.3.3.1.1.1"><csymbol cd="latexml" id="S6.p2.4.m4.3.3.1.1.1.1.2.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.2">conditional</csymbol><ci id="S6.p2.4.m4.3.3.1.1.1.1.3a.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.3"><mtext id="S6.p2.4.m4.3.3.1.1.1.1.3.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.3">positive</mtext></ci><list id="S6.p2.4.m4.3.3.1.1.1.1.1.2.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1"><ci id="S6.p2.4.m4.1.1.cmml" xref="S6.p2.4.m4.1.1">𝑥</ci><apply id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.1.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.2.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.2">𝑦</ci><ci id="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.3.cmml" xref="S6.p2.4.m4.3.3.1.1.1.1.1.1.1.3">𝑤</ci></apply></list></apply></apply><apply id="S6.p2.4.m4.4.4.2.cmml" xref="S6.p2.4.m4.4.4.2"><times id="S6.p2.4.m4.4.4.2.2.cmml" xref="S6.p2.4.m4.4.4.2.2"></times><ci id="S6.p2.4.m4.4.4.2.3.cmml" xref="S6.p2.4.m4.4.4.2.3">𝑝</ci><apply id="S6.p2.4.m4.4.4.2.1.1.1.cmml" xref="S6.p2.4.m4.4.4.2.1.1"><csymbol cd="latexml" id="S6.p2.4.m4.4.4.2.1.1.1.2.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.2">conditional</csymbol><ci id="S6.p2.4.m4.4.4.2.1.1.1.3a.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.3"><mtext id="S6.p2.4.m4.4.4.2.1.1.1.3.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.3">positive</mtext></ci><list id="S6.p2.4.m4.4.4.2.1.1.1.1.2.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1"><ci id="S6.p2.4.m4.2.2.cmml" xref="S6.p2.4.m4.2.2">𝑥</ci><apply id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.1.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1">subscript</csymbol><ci id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.2.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.2">𝑦</ci><ci id="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.3.cmml" xref="S6.p2.4.m4.4.4.2.1.1.1.1.1.1.3">𝑙</ci></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.4.m4.4c">p(\text{positive}\mid x,y_{w})&gt;p(\text{positive}\mid x,y_{l})</annotation><annotation encoding="application/x-llamapun" id="S6.p2.4.m4.4d">italic_p ( positive ∣ italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ) &gt; italic_p ( positive ∣ italic_x , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT )</annotation></semantics></math>. For SFT, we fine-tune GPT-2-large until convergence on reviews from the train split of the IMDB dataset (further details in App&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3.SS1" title="C.1 IMDb Sentiment Experiment and Baseline Details ‣ Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">C.1</span></a>). In <span class="ltx_text ltx_font_bold" id="S6.p2.8.4">summarization</span>, <math alttext="x" class="ltx_Math" display="inline" id="S6.p2.5.m5.1"><semantics id="S6.p2.5.m5.1a"><mi id="S6.p2.5.m5.1.1" xref="S6.p2.5.m5.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S6.p2.5.m5.1b"><ci id="S6.p2.5.m5.1.1.cmml" xref="S6.p2.5.m5.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.5.m5.1c">x</annotation><annotation encoding="application/x-llamapun" id="S6.p2.5.m5.1d">italic_x</annotation></semantics></math> is a forum post from Reddit; the policy must generate a summary <math alttext="y" class="ltx_Math" display="inline" id="S6.p2.6.m6.1"><semantics id="S6.p2.6.m6.1a"><mi id="S6.p2.6.m6.1.1" xref="S6.p2.6.m6.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S6.p2.6.m6.1b"><ci id="S6.p2.6.m6.1.1.cmml" xref="S6.p2.6.m6.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.6.m6.1c">y</annotation><annotation encoding="application/x-llamapun" id="S6.p2.6.m6.1d">italic_y</annotation></semantics></math> of the main points in the post. Following prior work, we use the Reddit TL;DR summarization dataset <cite class="ltx_cite ltx_citemacro_citep">(Völske et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib41" title="">2017</a>)</cite> along with human preferences gathered by <cite class="ltx_cite ltx_citemacro_citeauthor"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">Stiennon et&nbsp;al.</a></cite>. We use an SFT model fine-tuned on human-written forum post summaries<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://huggingface.co/CarperAI/openai_summarize_tldr_sft" title="">https://huggingface.co/CarperAI/openai_summarize_tldr_sft</a></span></span></span> with the TRLX <cite class="ltx_cite ltx_citemacro_citep">(von Werra et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib42" title="">2023</a>)</cite> framework for RLHF. The human preference dataset was gathered by <cite class="ltx_cite ltx_citemacro_citeauthor"><a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">Stiennon et&nbsp;al.</a></cite> on samples from a different, but similarly-trained, SFT model. Finally, in <span class="ltx_text ltx_font_bold" id="S6.p2.8.5">single-turn dialogue</span>,
<math alttext="x" class="ltx_Math" display="inline" id="S6.p2.7.m7.1"><semantics id="S6.p2.7.m7.1a"><mi id="S6.p2.7.m7.1.1" xref="S6.p2.7.m7.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S6.p2.7.m7.1b"><ci id="S6.p2.7.m7.1.1.cmml" xref="S6.p2.7.m7.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.7.m7.1c">x</annotation><annotation encoding="application/x-llamapun" id="S6.p2.7.m7.1d">italic_x</annotation></semantics></math> is a human query, which may be anything from a question about astrophysics to a request for relationship advice. A policy must produce an engaging and helpful response <math alttext="y" class="ltx_Math" display="inline" id="S6.p2.8.m8.1"><semantics id="S6.p2.8.m8.1a"><mi id="S6.p2.8.m8.1.1" xref="S6.p2.8.m8.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S6.p2.8.m8.1b"><ci id="S6.p2.8.m8.1.1.cmml" xref="S6.p2.8.m8.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.8.m8.1c">y</annotation><annotation encoding="application/x-llamapun" id="S6.p2.8.m8.1d">italic_y</annotation></semantics></math> to a user’s query; we use the Anthropic Helpful and Harmless dialogue dataset <cite class="ltx_cite ltx_citemacro_citep">(Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib1" title="">2022a</a>)</cite>, containing 170k dialogues between a human and an automated assistant. Each transcript ends with a pair of responses generated by a large (although unknown) language model along with a preference label denoting the human-preferred response. In this setting, no pre-trained SFT model is available; we therefore fine-tune an off-the-shelf language model on only the preferred completions to form the SFT model.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_figure" id="S6.F2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="311" id="S6.F2.g1" src="x1.png" width="415"></div>
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="305" id="S6.F2.g2" src="x2.png" width="407"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span><span class="ltx_text ltx_font_bold" id="S6.F2.3.1">Left.</span> The frontier of expected reward vs KL to the reference policy. DPO provides the highest expected reward for all KL values, demonstrating the quality of the optimization. <span class="ltx_text ltx_font_bold" id="S6.F2.4.2">Right.</span> TL;DR summarization win rates vs. human-written summaries, using GPT-4 as evaluator. DPO exceeds PPO’s best-case performance on summarization, while being more robust to changes in the sampling temperature.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.p3">
<p class="ltx_p" id="S6.p3.1"><span class="ltx_text ltx_font_bold" id="S6.p3.1.1">Evaluation.</span> Our experiments use two different approaches to evaluation. In order to analyze the effectiveness of each algorithm in optimizing the constrained reward maximization objective, in the controlled sentiment generation setting we evaluate each algorithm by its frontier of achieved reward and KL-divergence from the reference policy; this frontier is computable because we have acccess to the ground-truth reward function (a sentiment classifier). However, in the real world, the ground truth reward function is not known; therefore, we evaluate algorithms with their <span class="ltx_text ltx_font_italic" id="S6.p3.1.2">win rate</span> against a baseline policy, using GPT-4 as a proxy for human evaluation of summary quality and response helpfulness in the summarization and single-turn dialogue settings, respectively. For summarization, we use reference summaries in the test set as the baseline; for dialogue, we use the preferred response in the test dataset as the baseline. While existing studies suggest LMs can be better automated evaluators than existing metrics <cite class="ltx_cite ltx_citemacro_citep">(Chen et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib10" title="">2023</a>)</cite>, we conduct a human study to justify our usage of GPT-4 for evaluation in Sec.&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS4" title="6.4 Validating GPT-4 judgments with human judgments ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">6.4</span></a>. We find GPT-4 judgments correlate strongly with humans, with human agreement with GPT-4 typically similar or higher than inter-human annotator agreement.
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S6.p4">
<p class="ltx_p" id="S6.p4.8"><span class="ltx_text ltx_font_bold" id="S6.p4.8.2">Methods.</span> In addition to DPO, we evaluate several existing approaches to training language models to adhere to human preferences. Most simply, we explore zero-shot prompting with <span class="ltx_text ltx_font_bold" id="S6.p4.8.3">GPT-J</span> <cite class="ltx_cite ltx_citemacro_citep">(Wang and Komatsuzaki, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib43" title="">2021</a>)</cite> in the summarization task and 2-shot prompting with <span class="ltx_text ltx_font_bold" id="S6.p4.8.4">Pythia-2.8B</span> <cite class="ltx_cite ltx_citemacro_citep">(Biderman et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib3" title="">2023</a>)</cite> in the dialogue task. In addition, we evaluate the <span class="ltx_text ltx_font_bold" id="S6.p4.8.5">SFT</span> model as well as <span class="ltx_text ltx_font_bold" id="S6.p4.8.6">Preferred-FT</span>, which is a model fine-tuned with supervised learning on the chosen completion <math alttext="y_{w}" class="ltx_Math" display="inline" id="S6.p4.1.m1.1"><semantics id="S6.p4.1.m1.1a"><msub id="S6.p4.1.m1.1.1" xref="S6.p4.1.m1.1.1.cmml"><mi id="S6.p4.1.m1.1.1.2" xref="S6.p4.1.m1.1.1.2.cmml">y</mi><mi id="S6.p4.1.m1.1.1.3" xref="S6.p4.1.m1.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S6.p4.1.m1.1b"><apply id="S6.p4.1.m1.1.1.cmml" xref="S6.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S6.p4.1.m1.1.1.1.cmml" xref="S6.p4.1.m1.1.1">subscript</csymbol><ci id="S6.p4.1.m1.1.1.2.cmml" xref="S6.p4.1.m1.1.1.2">𝑦</ci><ci id="S6.p4.1.m1.1.1.3.cmml" xref="S6.p4.1.m1.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.1.m1.1c">y_{w}</annotation><annotation encoding="application/x-llamapun" id="S6.p4.1.m1.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> from either the SFT model (in controlled sentiment and summarization) or a generic LM (in single-turn dialogue). Another pseudo-supervised method is <span class="ltx_text ltx_font_bold" id="S6.p4.8.7">Unlikelihood</span>&nbsp;<cite class="ltx_cite ltx_citemacro_citep">(Welleck et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib44" title="">2019</a>)</cite>, which simply optimizes the policy to maximize the probability assigned to <math alttext="y_{w}" class="ltx_Math" display="inline" id="S6.p4.2.m2.1"><semantics id="S6.p4.2.m2.1a"><msub id="S6.p4.2.m2.1.1" xref="S6.p4.2.m2.1.1.cmml"><mi id="S6.p4.2.m2.1.1.2" xref="S6.p4.2.m2.1.1.2.cmml">y</mi><mi id="S6.p4.2.m2.1.1.3" xref="S6.p4.2.m2.1.1.3.cmml">w</mi></msub><annotation-xml encoding="MathML-Content" id="S6.p4.2.m2.1b"><apply id="S6.p4.2.m2.1.1.cmml" xref="S6.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S6.p4.2.m2.1.1.1.cmml" xref="S6.p4.2.m2.1.1">subscript</csymbol><ci id="S6.p4.2.m2.1.1.2.cmml" xref="S6.p4.2.m2.1.1.2">𝑦</ci><ci id="S6.p4.2.m2.1.1.3.cmml" xref="S6.p4.2.m2.1.1.3">𝑤</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.2.m2.1c">y_{w}</annotation><annotation encoding="application/x-llamapun" id="S6.p4.2.m2.1d">italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT</annotation></semantics></math> and <span class="ltx_text ltx_font_italic" id="S6.p4.8.8">minimize</span> the probability assigned to <math alttext="y_{l}" class="ltx_Math" display="inline" id="S6.p4.3.m3.1"><semantics id="S6.p4.3.m3.1a"><msub id="S6.p4.3.m3.1.1" xref="S6.p4.3.m3.1.1.cmml"><mi id="S6.p4.3.m3.1.1.2" xref="S6.p4.3.m3.1.1.2.cmml">y</mi><mi id="S6.p4.3.m3.1.1.3" xref="S6.p4.3.m3.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S6.p4.3.m3.1b"><apply id="S6.p4.3.m3.1.1.cmml" xref="S6.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S6.p4.3.m3.1.1.1.cmml" xref="S6.p4.3.m3.1.1">subscript</csymbol><ci id="S6.p4.3.m3.1.1.2.cmml" xref="S6.p4.3.m3.1.1.2">𝑦</ci><ci id="S6.p4.3.m3.1.1.3.cmml" xref="S6.p4.3.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.3.m3.1c">y_{l}</annotation><annotation encoding="application/x-llamapun" id="S6.p4.3.m3.1d">italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>; we use an optional coefficient <math alttext="\alpha\in[0,1]" class="ltx_Math" display="inline" id="S6.p4.4.m4.2"><semantics id="S6.p4.4.m4.2a"><mrow id="S6.p4.4.m4.2.3" xref="S6.p4.4.m4.2.3.cmml"><mi id="S6.p4.4.m4.2.3.2" xref="S6.p4.4.m4.2.3.2.cmml">α</mi><mo id="S6.p4.4.m4.2.3.1" xref="S6.p4.4.m4.2.3.1.cmml">∈</mo><mrow id="S6.p4.4.m4.2.3.3.2" xref="S6.p4.4.m4.2.3.3.1.cmml"><mo id="S6.p4.4.m4.2.3.3.2.1" stretchy="false" xref="S6.p4.4.m4.2.3.3.1.cmml">[</mo><mn id="S6.p4.4.m4.1.1" xref="S6.p4.4.m4.1.1.cmml">0</mn><mo id="S6.p4.4.m4.2.3.3.2.2" xref="S6.p4.4.m4.2.3.3.1.cmml">,</mo><mn id="S6.p4.4.m4.2.2" xref="S6.p4.4.m4.2.2.cmml">1</mn><mo id="S6.p4.4.m4.2.3.3.2.3" stretchy="false" xref="S6.p4.4.m4.2.3.3.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.p4.4.m4.2b"><apply id="S6.p4.4.m4.2.3.cmml" xref="S6.p4.4.m4.2.3"><in id="S6.p4.4.m4.2.3.1.cmml" xref="S6.p4.4.m4.2.3.1"></in><ci id="S6.p4.4.m4.2.3.2.cmml" xref="S6.p4.4.m4.2.3.2">𝛼</ci><interval closure="closed" id="S6.p4.4.m4.2.3.3.1.cmml" xref="S6.p4.4.m4.2.3.3.2"><cn id="S6.p4.4.m4.1.1.cmml" type="integer" xref="S6.p4.4.m4.1.1">0</cn><cn id="S6.p4.4.m4.2.2.cmml" type="integer" xref="S6.p4.4.m4.2.2">1</cn></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.4.m4.2c">\alpha\in[0,1]</annotation><annotation encoding="application/x-llamapun" id="S6.p4.4.m4.2d">italic_α ∈ [ 0 , 1 ]</annotation></semantics></math> on the ‘unlikelihood’ term. We also consider <span class="ltx_text ltx_font_bold" id="S6.p4.8.9">PPO</span> <cite class="ltx_cite ltx_citemacro_citep">(Schulman et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib37" title="">2017</a>)</cite> using a reward function learned from the preference data and <span class="ltx_text ltx_font_bold" id="S6.p4.8.10">PPO-GT</span>, which is an oracle that learns from the ground truth reward function available in the controlled sentiment setting. In our sentiment experiments, we use two implementations of PPO-GT, one of-the-shelf version <cite class="ltx_cite ltx_citemacro_cite">von Werra et&nbsp;al. (<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib42" title="">2023</a>)</cite> as well as a modified version that normalizes rewards and further tunes hyperparameters to improve performance (we also use these modifications when running ‘normal’ PPO with learned rewards). Finally, we consider the <span class="ltx_text ltx_font_bold" id="S6.p4.5.1">Best of <math alttext="N" class="ltx_Math" display="inline" id="S6.p4.5.1.m1.1"><semantics id="S6.p4.5.1.m1.1a"><mi id="S6.p4.5.1.m1.1.1" xref="S6.p4.5.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.p4.5.1.m1.1b"><ci id="S6.p4.5.1.m1.1.1.cmml" xref="S6.p4.5.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.5.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.p4.5.1.m1.1d">italic_N</annotation></semantics></math></span> baseline, sampling <math alttext="N" class="ltx_Math" display="inline" id="S6.p4.6.m5.1"><semantics id="S6.p4.6.m5.1a"><mi id="S6.p4.6.m5.1.1" xref="S6.p4.6.m5.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.p4.6.m5.1b"><ci id="S6.p4.6.m5.1.1.cmml" xref="S6.p4.6.m5.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.6.m5.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.p4.6.m5.1d">italic_N</annotation></semantics></math> responses from the SFT model (or Preferred-FT in dialogue) and returning the highest-scoring response according to a reward function learned from the preference dataset. This high-performing method decouples the quality of the reward model from the PPO optimization, but is computationally impractical even for moderate <math alttext="N" class="ltx_Math" display="inline" id="S6.p4.7.m6.1"><semantics id="S6.p4.7.m6.1a"><mi id="S6.p4.7.m6.1.1" xref="S6.p4.7.m6.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.p4.7.m6.1b"><ci id="S6.p4.7.m6.1.1.cmml" xref="S6.p4.7.m6.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.7.m6.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.p4.7.m6.1d">italic_N</annotation></semantics></math> as it requires sampling <math alttext="N" class="ltx_Math" display="inline" id="S6.p4.8.m7.1"><semantics id="S6.p4.8.m7.1a"><mi id="S6.p4.8.m7.1.1" xref="S6.p4.8.m7.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.p4.8.m7.1b"><ci id="S6.p4.8.m7.1.1.cmml" xref="S6.p4.8.m7.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p4.8.m7.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.p4.8.m7.1d">italic_N</annotation></semantics></math> completions for every query at test time.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<section class="ltx_subsection" id="S6.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.1 </span>How well can DPO optimize the RLHF objective?</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_figure" id="S6.F3">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="311" id="S6.F3.g1" src="x3.png" width="415"></div>
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="305" id="S6.F3.g2" src="x4.png" width="407"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span><span class="ltx_text ltx_font_bold" id="S6.F3.3.1">Left.</span> Win rates computed by GPT-4 for Anthropic-HH one-step dialogue; DPO is the only method that improves over chosen summaries in the Anthropic-HH test set. <span class="ltx_text ltx_font_bold" id="S6.F3.4.2">Right.</span> Win rates for different sampling temperatures over the course of training. DPO’s improvement over the dataset labels is fairly stable over the course of training for different sampling temperatures.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.SS1.p1">
<p class="ltx_p" id="S6.SS1.p1.4">The KL-constrained reward maximization objective used in typical RLHF algorithms balances exploitation of reward while restricting the policy from deviating far from the reference policy. Therefore, when comparing algorithms, we must take into account both reward achieved as well as the KL discrepancy; achieving slightly higher reward but with much higher KL is not necessarily desirable. Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.F2" title="Figure 2 ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">2</span></a> shows the reward-KL frontier for various algorithms in the sentiment setting. We execute multiple training runs for each algorithm, using a different hyperparameter for policy conservativeness in each run (target KL <math alttext="\in\{3,6,9,12\}" class="ltx_Math" display="inline" id="S6.SS1.p1.1.m1.4"><semantics id="S6.SS1.p1.1.m1.4a"><mrow id="S6.SS1.p1.1.m1.4.5" xref="S6.SS1.p1.1.m1.4.5.cmml"><mi id="S6.SS1.p1.1.m1.4.5.2" xref="S6.SS1.p1.1.m1.4.5.2.cmml"></mi><mo id="S6.SS1.p1.1.m1.4.5.1" xref="S6.SS1.p1.1.m1.4.5.1.cmml">∈</mo><mrow id="S6.SS1.p1.1.m1.4.5.3.2" xref="S6.SS1.p1.1.m1.4.5.3.1.cmml"><mo id="S6.SS1.p1.1.m1.4.5.3.2.1" stretchy="false" xref="S6.SS1.p1.1.m1.4.5.3.1.cmml">{</mo><mn id="S6.SS1.p1.1.m1.1.1" xref="S6.SS1.p1.1.m1.1.1.cmml">3</mn><mo id="S6.SS1.p1.1.m1.4.5.3.2.2" xref="S6.SS1.p1.1.m1.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.1.m1.2.2" xref="S6.SS1.p1.1.m1.2.2.cmml">6</mn><mo id="S6.SS1.p1.1.m1.4.5.3.2.3" xref="S6.SS1.p1.1.m1.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.1.m1.3.3" xref="S6.SS1.p1.1.m1.3.3.cmml">9</mn><mo id="S6.SS1.p1.1.m1.4.5.3.2.4" xref="S6.SS1.p1.1.m1.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.1.m1.4.4" xref="S6.SS1.p1.1.m1.4.4.cmml">12</mn><mo id="S6.SS1.p1.1.m1.4.5.3.2.5" stretchy="false" xref="S6.SS1.p1.1.m1.4.5.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS1.p1.1.m1.4b"><apply id="S6.SS1.p1.1.m1.4.5.cmml" xref="S6.SS1.p1.1.m1.4.5"><in id="S6.SS1.p1.1.m1.4.5.1.cmml" xref="S6.SS1.p1.1.m1.4.5.1"></in><csymbol cd="latexml" id="S6.SS1.p1.1.m1.4.5.2.cmml" xref="S6.SS1.p1.1.m1.4.5.2">absent</csymbol><set id="S6.SS1.p1.1.m1.4.5.3.1.cmml" xref="S6.SS1.p1.1.m1.4.5.3.2"><cn id="S6.SS1.p1.1.m1.1.1.cmml" type="integer" xref="S6.SS1.p1.1.m1.1.1">3</cn><cn id="S6.SS1.p1.1.m1.2.2.cmml" type="integer" xref="S6.SS1.p1.1.m1.2.2">6</cn><cn id="S6.SS1.p1.1.m1.3.3.cmml" type="integer" xref="S6.SS1.p1.1.m1.3.3">9</cn><cn id="S6.SS1.p1.1.m1.4.4.cmml" type="integer" xref="S6.SS1.p1.1.m1.4.4">12</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p1.1.m1.4c">\in\{3,6,9,12\}</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p1.1.m1.4d">∈ { 3 , 6 , 9 , 12 }</annotation></semantics></math> for PPO, <math alttext="\beta\in\{0.05,0.1,1,5\}" class="ltx_Math" display="inline" id="S6.SS1.p1.2.m2.4"><semantics id="S6.SS1.p1.2.m2.4a"><mrow id="S6.SS1.p1.2.m2.4.5" xref="S6.SS1.p1.2.m2.4.5.cmml"><mi id="S6.SS1.p1.2.m2.4.5.2" xref="S6.SS1.p1.2.m2.4.5.2.cmml">β</mi><mo id="S6.SS1.p1.2.m2.4.5.1" xref="S6.SS1.p1.2.m2.4.5.1.cmml">∈</mo><mrow id="S6.SS1.p1.2.m2.4.5.3.2" xref="S6.SS1.p1.2.m2.4.5.3.1.cmml"><mo id="S6.SS1.p1.2.m2.4.5.3.2.1" stretchy="false" xref="S6.SS1.p1.2.m2.4.5.3.1.cmml">{</mo><mn id="S6.SS1.p1.2.m2.1.1" xref="S6.SS1.p1.2.m2.1.1.cmml">0.05</mn><mo id="S6.SS1.p1.2.m2.4.5.3.2.2" xref="S6.SS1.p1.2.m2.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.2.m2.2.2" xref="S6.SS1.p1.2.m2.2.2.cmml">0.1</mn><mo id="S6.SS1.p1.2.m2.4.5.3.2.3" xref="S6.SS1.p1.2.m2.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.2.m2.3.3" xref="S6.SS1.p1.2.m2.3.3.cmml">1</mn><mo id="S6.SS1.p1.2.m2.4.5.3.2.4" xref="S6.SS1.p1.2.m2.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.2.m2.4.4" xref="S6.SS1.p1.2.m2.4.4.cmml">5</mn><mo id="S6.SS1.p1.2.m2.4.5.3.2.5" stretchy="false" xref="S6.SS1.p1.2.m2.4.5.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS1.p1.2.m2.4b"><apply id="S6.SS1.p1.2.m2.4.5.cmml" xref="S6.SS1.p1.2.m2.4.5"><in id="S6.SS1.p1.2.m2.4.5.1.cmml" xref="S6.SS1.p1.2.m2.4.5.1"></in><ci id="S6.SS1.p1.2.m2.4.5.2.cmml" xref="S6.SS1.p1.2.m2.4.5.2">𝛽</ci><set id="S6.SS1.p1.2.m2.4.5.3.1.cmml" xref="S6.SS1.p1.2.m2.4.5.3.2"><cn id="S6.SS1.p1.2.m2.1.1.cmml" type="float" xref="S6.SS1.p1.2.m2.1.1">0.05</cn><cn id="S6.SS1.p1.2.m2.2.2.cmml" type="float" xref="S6.SS1.p1.2.m2.2.2">0.1</cn><cn id="S6.SS1.p1.2.m2.3.3.cmml" type="integer" xref="S6.SS1.p1.2.m2.3.3">1</cn><cn id="S6.SS1.p1.2.m2.4.4.cmml" type="integer" xref="S6.SS1.p1.2.m2.4.4">5</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p1.2.m2.4c">\beta\in\{0.05,0.1,1,5\}</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p1.2.m2.4d">italic_β ∈ { 0.05 , 0.1 , 1 , 5 }</annotation></semantics></math>, <math alttext="\alpha\in\{0.05,0.1,0.5,1\}" class="ltx_Math" display="inline" id="S6.SS1.p1.3.m3.4"><semantics id="S6.SS1.p1.3.m3.4a"><mrow id="S6.SS1.p1.3.m3.4.5" xref="S6.SS1.p1.3.m3.4.5.cmml"><mi id="S6.SS1.p1.3.m3.4.5.2" xref="S6.SS1.p1.3.m3.4.5.2.cmml">α</mi><mo id="S6.SS1.p1.3.m3.4.5.1" xref="S6.SS1.p1.3.m3.4.5.1.cmml">∈</mo><mrow id="S6.SS1.p1.3.m3.4.5.3.2" xref="S6.SS1.p1.3.m3.4.5.3.1.cmml"><mo id="S6.SS1.p1.3.m3.4.5.3.2.1" stretchy="false" xref="S6.SS1.p1.3.m3.4.5.3.1.cmml">{</mo><mn id="S6.SS1.p1.3.m3.1.1" xref="S6.SS1.p1.3.m3.1.1.cmml">0.05</mn><mo id="S6.SS1.p1.3.m3.4.5.3.2.2" xref="S6.SS1.p1.3.m3.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.3.m3.2.2" xref="S6.SS1.p1.3.m3.2.2.cmml">0.1</mn><mo id="S6.SS1.p1.3.m3.4.5.3.2.3" xref="S6.SS1.p1.3.m3.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.3.m3.3.3" xref="S6.SS1.p1.3.m3.3.3.cmml">0.5</mn><mo id="S6.SS1.p1.3.m3.4.5.3.2.4" xref="S6.SS1.p1.3.m3.4.5.3.1.cmml">,</mo><mn id="S6.SS1.p1.3.m3.4.4" xref="S6.SS1.p1.3.m3.4.4.cmml">1</mn><mo id="S6.SS1.p1.3.m3.4.5.3.2.5" stretchy="false" xref="S6.SS1.p1.3.m3.4.5.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S6.SS1.p1.3.m3.4b"><apply id="S6.SS1.p1.3.m3.4.5.cmml" xref="S6.SS1.p1.3.m3.4.5"><in id="S6.SS1.p1.3.m3.4.5.1.cmml" xref="S6.SS1.p1.3.m3.4.5.1"></in><ci id="S6.SS1.p1.3.m3.4.5.2.cmml" xref="S6.SS1.p1.3.m3.4.5.2">𝛼</ci><set id="S6.SS1.p1.3.m3.4.5.3.1.cmml" xref="S6.SS1.p1.3.m3.4.5.3.2"><cn id="S6.SS1.p1.3.m3.1.1.cmml" type="float" xref="S6.SS1.p1.3.m3.1.1">0.05</cn><cn id="S6.SS1.p1.3.m3.2.2.cmml" type="float" xref="S6.SS1.p1.3.m3.2.2">0.1</cn><cn id="S6.SS1.p1.3.m3.3.3.cmml" type="float" xref="S6.SS1.p1.3.m3.3.3">0.5</cn><cn id="S6.SS1.p1.3.m3.4.4.cmml" type="integer" xref="S6.SS1.p1.3.m3.4.4">1</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.SS1.p1.3.m3.4c">\alpha\in\{0.05,0.1,0.5,1\}</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p1.3.m3.4d">italic_α ∈ { 0.05 , 0.1 , 0.5 , 1 }</annotation></semantics></math> for unlikelihood, random seeds for preferred-FT). This sweep includes 22 runs in total. After each 100 training steps until convergence, we evaluate each policy on a set of test prompts, computing the average reward under the true reward function as well as the average sequence-level KL<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>That is, the sum of the per-timestep KL-divergences.</span></span></span> with the reference policy <math alttext="\text{KL}\left(\pi\mid\mid\pi_{\text{ref}}\right)" class="ltx_math_unparsed" display="inline" id="S6.SS1.p1.4.m4.1"><semantics id="S6.SS1.p1.4.m4.1a"><mrow id="S6.SS1.p1.4.m4.1b"><mtext id="S6.SS1.p1.4.m4.1.1">KL</mtext><mrow id="S6.SS1.p1.4.m4.1.2"><mo id="S6.SS1.p1.4.m4.1.2.1">(</mo><mi id="S6.SS1.p1.4.m4.1.2.2">π</mi><mo id="S6.SS1.p1.4.m4.1.2.3" lspace="0em" rspace="0.0835em">∣</mo><mo id="S6.SS1.p1.4.m4.1.2.4" lspace="0.0835em" rspace="0.167em">∣</mo><msub id="S6.SS1.p1.4.m4.1.2.5"><mi id="S6.SS1.p1.4.m4.1.2.5.2">π</mi><mtext id="S6.SS1.p1.4.m4.1.2.5.3">ref</mtext></msub><mo id="S6.SS1.p1.4.m4.1.2.6">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S6.SS1.p1.4.m4.1c">\text{KL}\left(\pi\mid\mid\pi_{\text{ref}}\right)</annotation><annotation encoding="application/x-llamapun" id="S6.SS1.p1.4.m4.1d">KL ( italic_π ∣ ∣ italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT )</annotation></semantics></math>. We find that DPO produces by far the most efficient frontier, achieving the highest reward while still achieving low KL. This result is particularly notable for multiple reasons. First, DPO and PPO optimize the same objective, but DPO is notably more efficient; DPO’s reward/KL tradeoff strictly dominates PPO. Second, DPO achieves a better frontier than PPO, <em class="ltx_emph ltx_font_italic" id="S6.SS1.p1.4.1">even when PPO can access ground truth rewards</em> (PPO-GT).</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="S6.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.2 </span>Can DPO scale to real preference datasets?</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.SS2.p1">
<p class="ltx_p" id="S6.SS2.p1.2">Next, we evaluate fine-tuning performance of DPO on summarization and single-turn dialogue. For summarization,
automatic evaluation metrics such as ROUGE can be poorly correlated with human preferences&nbsp;<cite class="ltx_cite ltx_citemacro_citep">(Stiennon et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib38" title="">2022</a>)</cite>, and prior work has found that fine-tuning LMs using PPO on human preferences to provide more effective summaries. We evaluate different methods by sampling completions on the test split of TL;DR summarization dataset, and computing the average win rate against reference completions in the test set. The completions for all methods are sampled at temperatures varying from 0.0 to 1.0, and the win rates are shown in Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.F2" title="Figure 2 ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">2</span></a> (right). DPO, PPO and Preferred-FT all fine-tune the same GPT-J SFT model<span class="ltx_note ltx_role_footnote" id="footnote3"><sup class="ltx_note_mark">3</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">3</sup><span class="ltx_tag ltx_tag_note">3</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://huggingface.co/CarperAI/openai_summarize_tldr_sft" title="">https://huggingface.co/CarperAI/openai_summarize_tldr_sft</a></span></span></span>. We find that DPO has a win rate of approximately 61% at a temperature of 0.0, exceeding the performance of PPO at &nbsp;57% at its optimal sampling temperature of 0.0. DPO also achieves a higher maximum win rate compared to the best of <math alttext="N" class="ltx_Math" display="inline" id="S6.SS2.p1.1.m1.1"><semantics id="S6.SS2.p1.1.m1.1a"><mi id="S6.SS2.p1.1.m1.1.1" xref="S6.SS2.p1.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.1.m1.1b"><ci id="S6.SS2.p1.1.m1.1.1.cmml" xref="S6.SS2.p1.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.1.m1.1d">italic_N</annotation></semantics></math> baseline. We note that we did not meaningfully tune DPO’s <math alttext="\beta" class="ltx_Math" display="inline" id="S6.SS2.p1.2.m2.1"><semantics id="S6.SS2.p1.2.m2.1a"><mi id="S6.SS2.p1.2.m2.1.1" xref="S6.SS2.p1.2.m2.1.1.cmml">β</mi><annotation-xml encoding="MathML-Content" id="S6.SS2.p1.2.m2.1b"><ci id="S6.SS2.p1.2.m2.1.1.cmml" xref="S6.SS2.p1.2.m2.1.1">𝛽</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p1.2.m2.1c">\beta</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p1.2.m2.1d">italic_β</annotation></semantics></math> hyperparameter, so these results may underestimate DPO’s potential. Moreover, we find DPO to be much more robust to the sampling temperature than PPO, the performance of which can degrade to that of the base GPT-J model at high temperatures. Preferred-FT does not improve significantly over the SFT model. We also compare DPO and PPO head-to-head in human evaluations in Section&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS4" title="6.4 Validating GPT-4 judgments with human judgments ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">6.4</span></a>, where DPO samples at temperature 0.25 were preferred 58% times over PPO samples at temperature 0.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S6.SS2.p2">
<p class="ltx_p" id="S6.SS2.p2.1">On single-turn dialogue, we evaluate the different methods on the subset of the test split of the Anthropic HH dataset <cite class="ltx_cite ltx_citemacro_citep">(Bai et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib1" title="">2022a</a>)</cite> with one step of human-assistant interaction. GPT-4 evaluations use the preferred completions on the test as the reference to compute the win rate for different methods. As there is no standard SFT model for this task, we start with a pre-trained Pythia-2.8B, use Preferred-FT to train a reference model on the chosen completions such that completions are within distribution of the model, and then train using DPO. We also compare against the best of 128 Preferred-FT completions (we found the Best of <math alttext="N" class="ltx_Math" display="inline" id="S6.SS2.p2.1.m1.1"><semantics id="S6.SS2.p2.1.m1.1a"><mi id="S6.SS2.p2.1.m1.1.1" xref="S6.SS2.p2.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S6.SS2.p2.1.m1.1b"><ci id="S6.SS2.p2.1.m1.1.1.cmml" xref="S6.SS2.p2.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.SS2.p2.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S6.SS2.p2.1.m1.1d">italic_N</annotation></semantics></math> baseline plateaus at 128 completions for this task; see Appendix Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.F4" title="Figure 4 ‣ D.1 Performance of Best of 𝑁 baseline for Various 𝑁 ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>) and a 2-shot prompted version of the Pythia-2.8B base model, finding DPO performs as well or better for the best-performing temperatures for each method. We also evaluate an RLHF model trained with PPO on the Anthropic HH dataset <span class="ltx_note ltx_role_footnote" id="footnote4"><sup class="ltx_note_mark">4</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">4</sup><span class="ltx_tag ltx_tag_note">4</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://huggingface.co/reciprocate/ppo_hh_pythia-6B" title="">https://huggingface.co/reciprocate/ppo_hh_pythia-6B</a></span></span></span> from a well-known source <span class="ltx_note ltx_role_footnote" id="footnote5"><sup class="ltx_note_mark">5</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">5</sup><span class="ltx_tag ltx_tag_note">5</span><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/CarperAI/trlx/tree/main/examples/hh" title="">https://github.com/CarperAI/trlx/tree/main/examples/hh</a></span></span></span>, but are unable to find a prompt or sampling temperature that gives performance better than the base Pythia-2.8B model. Based on our results from TL;DR and the fact that both methods optimize the same reward function, we consider Best of 128 a rough proxy for PPO-level performance. Overall, DPO is the only computationally efficient method that improves over the preferred completions in the Anthropic HH dataset, and provides similar or better performance to the computationally demanding Best of 128 baseline. Finally, Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.F3" title="Figure 3 ‣ 6.1 How well can DPO optimize the RLHF objective? ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a> shows that DPO converges to its best performance relatively quickly.
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="S6.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.3 </span>Generalization to a new input distribution</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table ltx_align_floatright" id="S6.T1">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S6.T1.2">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S6.T1.2.3.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S6.T1.2.3.1.1"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S6.T1.2.3.1.2">
<span class="ltx_text ltx_font_bold" id="S6.T1.2.3.1.2.1" style="font-size:90%;">Win rate vs. ground truth</span><span class="ltx_text" id="S6.T1.2.3.1.2.2" style="font-size:90%;"></span>
</td>
</tr>
<tr class="ltx_tr" id="S6.T1.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S6.T1.2.2.3"><span class="ltx_text ltx_font_bold" id="S6.T1.2.2.3.1" style="font-size:90%;">Alg.</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.1.1.1">
<span class="ltx_text" id="S6.T1.1.1.1.1" style="font-size:90%;">Temp </span><math alttext="0" class="ltx_Math" display="inline" id="S6.T1.1.1.1.m1.1"><semantics id="S6.T1.1.1.1.m1.1a"><mn id="S6.T1.1.1.1.m1.1.1" mathsize="90%" xref="S6.T1.1.1.1.m1.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S6.T1.1.1.1.m1.1b"><cn id="S6.T1.1.1.1.m1.1.1.cmml" type="integer" xref="S6.T1.1.1.1.m1.1.1">0</cn></annotation-xml></semantics></math>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.2.2.2">
<span class="ltx_text" id="S6.T1.2.2.2.1" style="font-size:90%;">Temp </span><math alttext="0.25" class="ltx_Math" display="inline" id="S6.T1.2.2.2.m1.1"><semantics id="S6.T1.2.2.2.m1.1a"><mn id="S6.T1.2.2.2.m1.1.1" mathsize="90%" xref="S6.T1.2.2.2.m1.1.1.cmml">0.25</mn><annotation-xml encoding="MathML-Content" id="S6.T1.2.2.2.m1.1b"><cn id="S6.T1.2.2.2.m1.1.1.cmml" type="float" xref="S6.T1.2.2.2.m1.1.1">0.25</cn></annotation-xml><annotation encoding="application/x-tex" id="S6.T1.2.2.2.m1.1c">0.25</annotation><annotation encoding="application/x-llamapun" id="S6.T1.2.2.2.m1.1d">0.25</annotation></semantics></math>
</td>
</tr>
<tr class="ltx_tr" id="S6.T1.2.4.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S6.T1.2.4.2.1"><span class="ltx_text" id="S6.T1.2.4.2.1.1" style="font-size:90%;">DPO</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.2.4.2.2"><span class="ltx_text" id="S6.T1.2.4.2.2.1" style="font-size:90%;">0.36</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T1.2.4.2.3"><span class="ltx_text" id="S6.T1.2.4.2.3.1" style="font-size:90%;">0.31</span></td>
</tr>
<tr class="ltx_tr" id="S6.T1.2.5.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb" id="S6.T1.2.5.3.1"><span class="ltx_text" id="S6.T1.2.5.3.1.1" style="font-size:90%;">PPO</span></th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T1.2.5.3.2"><span class="ltx_text" id="S6.T1.2.5.3.2.1" style="font-size:90%;">0.26</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T1.2.5.3.3"><span class="ltx_text" id="S6.T1.2.5.3.3.1" style="font-size:90%;">0.23</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">Table 1: </span>GPT-4 win rates vs. ground truth summaries for out-of-distribution CNN/DailyMail input articles.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.SS3.p1">
<p class="ltx_p" id="S6.SS3.p1.1">To further compare the performance of PPO and DPO under distribution shifts, we evaluate the PPO and DPO policies from our Reddit TL;DR summarization experiment on a different distribution, news articles in the test split of the CNN/DailyMail dataset <cite class="ltx_cite ltx_citemacro_citep">(Nallapati et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib24" title="">2016</a>)</cite>, using the best sampling temperatures from TL;DR (0 and 0.25). The results are presented in Table&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.T1" title="Table 1 ‣ 6.3 Generalization to a new input distribution ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a>. We computed the GPT-4 win rate against the ground-truth summaries in the datasets, using the same GPT-4 (C) prompt we used for Reddit TL;DR, but replacing the words “forum post” with “news article”. For this new distribution, DPO continues to outperform the PPO policy by a significant margin. This experiment provides initial evidence that DPO policies can generalize similarly well to PPO policies, even though DPO does not use the additional unlabeled Reddit TL;DR prompts that PPO uses.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="S6.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">6.4 </span>Validating GPT-4 judgments with human judgments</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.SS4.p1">
<p class="ltx_p" id="S6.SS4.p1.1">We conduct a human study to verify the reliability of GPT-4’s judgments, using the results of the TL;DR summarization experiment and two different GPT-4 prompts. The <span class="ltx_text ltx_font_bold" id="S6.SS4.p1.1.1">GPT-4 (S)</span> (simple) prompt simply asks for which summary better-summarizes the important information in the post. The <span class="ltx_text ltx_font_bold" id="S6.SS4.p1.1.2">GPT-4 (C)</span> (concise) prompt also asks for which summary is more concise; we evaluate this prompt because we find that GPT-4 prefers longer, more repetitive summaries than humans do with the <span class="ltx_text ltx_font_bold" id="S6.SS4.p1.1.3">GPT-4 (S)</span> prompt. See Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A3.SS2" title="C.2 GPT-4 prompts for computing summarization and dialogue win rates ‣ Appendix C Further Details on the Experimental Set-Up ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">C.2</span></a> for the complete prompts. We perform three comparisons, using the highest (DPO, temp. 0.25), the lowest (PPO, temp. 1.0), and a</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_table ltx_align_floatright" id="S6.T2">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S6.T2.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S6.T2.1.1.1">
<td class="ltx_td ltx_border_tt" id="S6.T2.1.1.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S6.T2.1.1.1.2"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.1.2.1" style="font-size:90%;">DPO</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S6.T2.1.1.1.3"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.1.3.1" style="font-size:90%;">SFT</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S6.T2.1.1.1.4"><span class="ltx_text ltx_font_bold" id="S6.T2.1.1.1.4.1" style="font-size:90%;">PPO-1</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.2.2">
<td class="ltx_td ltx_align_left" id="S6.T2.1.2.2.1"><span class="ltx_text" id="S6.T2.1.2.2.1.1" style="font-size:90%;">N respondents</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.2.2.2"><span class="ltx_text" id="S6.T2.1.2.2.2.1" style="font-size:90%;">272</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.2.2.3"><span class="ltx_text" id="S6.T2.1.2.2.3.1" style="font-size:90%;">122</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.2.2.4"><span class="ltx_text" id="S6.T2.1.2.2.4.1" style="font-size:90%;">199</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.3.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S6.T2.1.3.3.1"><span class="ltx_text" id="S6.T2.1.3.3.1.1" style="font-size:90%;">GPT-4 (S) win %</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.3.3.2"><span class="ltx_text" id="S6.T2.1.3.3.2.1" style="font-size:90%;">47</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.3.3.3"><span class="ltx_text" id="S6.T2.1.3.3.3.1" style="font-size:90%;">27</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.3.3.4"><span class="ltx_text" id="S6.T2.1.3.3.4.1" style="font-size:90%;">13</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.4.4">
<td class="ltx_td ltx_align_left" id="S6.T2.1.4.4.1"><span class="ltx_text" id="S6.T2.1.4.4.1.1" style="font-size:90%;">GPT-4 (C) win %</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.4.4.2"><span class="ltx_text" id="S6.T2.1.4.4.2.1" style="font-size:90%;">54</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.4.4.3"><span class="ltx_text" id="S6.T2.1.4.4.3.1" style="font-size:90%;">32</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.4.4.4"><span class="ltx_text" id="S6.T2.1.4.4.4.1" style="font-size:90%;">12</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.5.5">
<td class="ltx_td ltx_align_left" id="S6.T2.1.5.5.1"><span class="ltx_text" id="S6.T2.1.5.5.1.1" style="font-size:90%;">Human win %</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.5.5.2"><span class="ltx_text" id="S6.T2.1.5.5.2.1" style="font-size:90%;">58</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.5.5.3"><span class="ltx_text" id="S6.T2.1.5.5.3.1" style="font-size:90%;">43</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.5.5.4"><span class="ltx_text" id="S6.T2.1.5.5.4.1" style="font-size:90%;">17</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.6.6">
<td class="ltx_td ltx_align_left ltx_border_t" id="S6.T2.1.6.6.1"><span class="ltx_text" id="S6.T2.1.6.6.1.1" style="font-size:90%;">GPT-4 (S)-H agree</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.6.6.2"><span class="ltx_text" id="S6.T2.1.6.6.2.1" style="font-size:90%;">70</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.6.6.3"><span class="ltx_text" id="S6.T2.1.6.6.3.1" style="font-size:90%;">77</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S6.T2.1.6.6.4"><span class="ltx_text" id="S6.T2.1.6.6.4.1" style="font-size:90%;">86</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.7.7">
<td class="ltx_td ltx_align_left" id="S6.T2.1.7.7.1"><span class="ltx_text" id="S6.T2.1.7.7.1.1" style="font-size:90%;">GPT-4 (C)-H agree</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.7.7.2"><span class="ltx_text" id="S6.T2.1.7.7.2.1" style="font-size:90%;">67</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.7.7.3"><span class="ltx_text" id="S6.T2.1.7.7.3.1" style="font-size:90%;">79</span></td>
<td class="ltx_td ltx_align_center" id="S6.T2.1.7.7.4"><span class="ltx_text" id="S6.T2.1.7.7.4.1" style="font-size:90%;">85</span></td>
</tr>
<tr class="ltx_tr" id="S6.T2.1.8.8">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S6.T2.1.8.8.1"><span class="ltx_text" id="S6.T2.1.8.8.1.1" style="font-size:90%;">H-H agree</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T2.1.8.8.2"><span class="ltx_text" id="S6.T2.1.8.8.2.1" style="font-size:90%;">65</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T2.1.8.8.3"><span class="ltx_text" id="S6.T2.1.8.8.3.1" style="font-size:90%;">-</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S6.T2.1.8.8.4"><span class="ltx_text" id="S6.T2.1.8.8.4.1" style="font-size:90%;">87</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">Table 2: </span>Comparing human and GPT-4 win rates and per-judgment agreement on TL;DR summarization samples. <span class="ltx_text ltx_font_bold" id="S6.T2.6.1">Humans agree with GPT-4 about as much as they agree with each other.</span> Each experiment compares a summary from the stated method with a summary from PPO with temperature 0.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.SS4.p2">
<p class="ltx_p" id="S6.SS4.p2.1">middle-performing (SFT, temp. 0.25) method with the aim of covering a diversity of sample qualities; all three methods are compared against greedily-sampled PPO (its best-performing temperature). We find that with both prompts, GPT-4 tends to agree with humans about as often as humans agree with each other, suggesting that GPT-4 is a reasonable proxy for human evaluations (due to limited human raters, we only collect multiple human judgments for the DPO and PPO-1 comparisons). Overall, the <span class="ltx_text ltx_font_bold" id="S6.SS4.p2.1.1">GPT-4 (C)</span> prompt generally provides win rates more representative of humans; we therefore use this prompt for the main results in Section&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.SS2" title="6.2 Can DPO scale to real preference datasets? ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">6.2</span></a>. For additional details about the human study, including the web interface presented to raters and the list of human volunteers, see Appendix&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.SS3" title="D.3 Human study details ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">D.3</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Discussion</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.1">Learning from preferences is a powerful, scalable framework for training capable, aligned language models. We have introduced DPO, a simple training paradigm for training language models from preferences without reinforcement learning. Rather than coercing the preference learning problem into a standard RL setting in order to use off-the-shelf RL algorithms, DPO identifies a mapping between language model policies and reward functions that enables training a language model to satisfy human preferences <span class="ltx_text ltx_font_italic" id="S7.p1.1.1">directly</span>, with a simple cross-entropy loss, without reinforcement learning or loss of generality. With virtually no tuning of hyperparameters, DPO performs similarly or better than existing RLHF algorithms, including those based on PPO; DPO thus meaningfully reduces the barrier to training more language models from human preferences.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="S7.p2">
<p class="ltx_p" id="S7.p2.1"><span class="ltx_text ltx_font_bold" id="S7.p2.1.1">Limitations &amp; Future Work.</span> Our results raise several important questions for future work. How does the DPO policy generalize out of distribution, compared with learning from an explicit reward function? Our initial results suggest that DPO policies can generalize similarly to PPO-based models, but more comprehensive study is needed. For example, can training with self-labeling from the DPO policy similarly make effective use of unlabeled prompts? On another front, how does reward over-optimization manifest in the direct preference optimization setting, and is the slight decrease in performance in Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S6.F3" title="Figure 3 ‣ 6.1 How well can DPO optimize the RLHF objective? ‣ 6 Experiments ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a>-right an instance of it? Additionally, while we evaluate models up to 6B parameters, exploration of scaling DPO to state-of-the-art models orders of magnitude larger is an exciting direction for future work. Regarding evaluations, we find that the win rates computed by GPT-4 are impacted by the prompt; future work may study the best way to elicit high-quality judgments from automated systems. Finally, many possible applications of DPO exist beyond training language models from human preferences, including training generative models in other modalities.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgements</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">EM gratefully acknowledges funding from a Knight-Hennessy Graduate Fellowship. CF and CM are CIFAR Fellows. This work was supported in part by the Stanford Accelerator for Learning (SAL) and Stanford Institute for Human-Centered Artificial Intelligence (HAI) <span class="ltx_text ltx_font_italic" id="Sx1.p1.1.1">Generative AI for the Future of Learning</span> seed grant program. The Stanford Center for Research on Foundation Models (CRFM) provided part of the compute resources used for the experiments in this work. This work was supported in part by ONR grant N00014-20-1-2675.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et&nbsp;al. [2022a]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Y.&nbsp;Bai, A.&nbsp;Jones, K.&nbsp;Ndousse, A.&nbsp;Askell, A.&nbsp;Chen, N.&nbsp;DasSarma, D.&nbsp;Drain,
S.&nbsp;Fort, D.&nbsp;Ganguli, T.&nbsp;Henighan, N.&nbsp;Joseph, S.&nbsp;Kadavath, J.&nbsp;Kernion,
T.&nbsp;Conerly, S.&nbsp;El-Showk, N.&nbsp;Elhage, Z.&nbsp;Hatfield-Dodds, D.&nbsp;Hernandez, T.&nbsp;Hume,
S.&nbsp;Johnston, S.&nbsp;Kravec, L.&nbsp;Lovitt, N.&nbsp;Nanda, C.&nbsp;Olsson, D.&nbsp;Amodei, T.&nbsp;Brown,
J.&nbsp;Clark, S.&nbsp;McCandlish, C.&nbsp;Olah, B.&nbsp;Mann, and J.&nbsp;Kaplan.

</span>
<span class="ltx_bibblock">Training a helpful and harmless assistant with reinforcement learning
from human feedback, 2022a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et&nbsp;al. [2022b]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Y.&nbsp;Bai, S.&nbsp;Kadavath, S.&nbsp;Kundu, A.&nbsp;Askell, J.&nbsp;Kernion, A.&nbsp;Jones, A.&nbsp;Chen,
A.&nbsp;Goldie, A.&nbsp;Mirhoseini, C.&nbsp;McKinnon, C.&nbsp;Chen, C.&nbsp;Olsson, C.&nbsp;Olah,
D.&nbsp;Hernandez, D.&nbsp;Drain, D.&nbsp;Ganguli, D.&nbsp;Li, E.&nbsp;Tran-Johnson, E.&nbsp;Perez,
J.&nbsp;Kerr, J.&nbsp;Mueller, J.&nbsp;Ladish, J.&nbsp;Landau, K.&nbsp;Ndousse, K.&nbsp;Lukosuite,
L.&nbsp;Lovitt, M.&nbsp;Sellitto, N.&nbsp;Elhage, N.&nbsp;Schiefer, N.&nbsp;Mercado, N.&nbsp;DasSarma,
R.&nbsp;Lasenby, R.&nbsp;Larson, S.&nbsp;Ringer, S.&nbsp;Johnston, S.&nbsp;Kravec, S.&nbsp;E. Showk,
S.&nbsp;Fort, T.&nbsp;Lanham, T.&nbsp;Telleen-Lawton, T.&nbsp;Conerly, T.&nbsp;Henighan, T.&nbsp;Hume,
S.&nbsp;R. Bowman, Z.&nbsp;Hatfield-Dodds, B.&nbsp;Mann, D.&nbsp;Amodei, N.&nbsp;Joseph,
S.&nbsp;McCandlish, T.&nbsp;Brown, and J.&nbsp;Kaplan.

</span>
<span class="ltx_bibblock">Constitutional ai: Harmlessness from ai feedback, 2022b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Biderman et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
S.&nbsp;Biderman, H.&nbsp;Schoelkopf, Q.&nbsp;Anthony, H.&nbsp;Bradley, K.&nbsp;O’Brien, E.&nbsp;Hallahan,
M.&nbsp;A. Khan, S.&nbsp;Purohit, U.&nbsp;S. Prashanth, E.&nbsp;Raff, A.&nbsp;Skowron, L.&nbsp;Sutawika,
and O.&nbsp;van&nbsp;der Wal.

</span>
<span class="ltx_bibblock">Pythia: A suite for analyzing large language models across training
and scaling, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bong and Rinaldo [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
H.&nbsp;Bong and A.&nbsp;Rinaldo.

</span>
<span class="ltx_bibblock">Generalized results for the existence and consistency of the MLE in
the Bradley-Terry-Luce model.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">International Conference on Machine Learning</em>, 2022.

</span>
<span class="ltx_bibblock">arXiv:2110.11487.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bradley and Terry [1952]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;A. Bradley and M.&nbsp;E. Terry.

</span>
<span class="ltx_bibblock">Rank analysis of incomplete block designs: I. the method of paired
comparisons.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Biometrika</em>, 39(3/4):324–345, 1952.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="https://doi.org/10.2307/2334029" title="">https://doi.org/10.2307/2334029</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et&nbsp;al. [2020a]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
T.&nbsp;Brown, B.&nbsp;Mann, N.&nbsp;Ryder, M.&nbsp;Subbiah, J.&nbsp;D. Kaplan, P.&nbsp;Dhariwal,
A.&nbsp;Neelakantan, P.&nbsp;Shyam, G.&nbsp;Sastry, A.&nbsp;Askell, S.&nbsp;Agarwal, A.&nbsp;Herbert-Voss,
G.&nbsp;Krueger, T.&nbsp;Henighan, R.&nbsp;Child, A.&nbsp;Ramesh, D.&nbsp;Ziegler, J.&nbsp;Wu, C.&nbsp;Winter,
C.&nbsp;Hesse, M.&nbsp;Chen, E.&nbsp;Sigler, M.&nbsp;Litwin, S.&nbsp;Gray, B.&nbsp;Chess, J.&nbsp;Clark,
C.&nbsp;Berner, S.&nbsp;McCandlish, A.&nbsp;Radford, I.&nbsp;Sutskever, and D.&nbsp;Amodei.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock">In H.&nbsp;Larochelle, M.&nbsp;Ranzato, R.&nbsp;Hadsell, M.&nbsp;Balcan, and H.&nbsp;Lin,
editors, <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Advances in Neural Information Processing Systems</em>, volume&nbsp;33,
pages 1877–1901. Curran Associates, Inc., 2020a.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2020/file/1457c0d6bfcb4967418bfb8ac142f64a-Paper.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2020/file/1457c0d6bfcb4967418bfb8ac142f64a-Paper.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et&nbsp;al. [2020b]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
T.&nbsp;Brown, B.&nbsp;Mann, N.&nbsp;Ryder, M.&nbsp;Subbiah, J.&nbsp;D. Kaplan, P.&nbsp;Dhariwal,
A.&nbsp;Neelakantan, P.&nbsp;Shyam, G.&nbsp;Sastry, A.&nbsp;Askell, et&nbsp;al.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Advances in neural information processing systems</em>,
33:1877–1901, 2020b.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bubeck et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
S.&nbsp;Bubeck, V.&nbsp;Chandrasekaran, R.&nbsp;Eldan, J.&nbsp;Gehrke, E.&nbsp;Horvitz, E.&nbsp;Kamar,
P.&nbsp;Lee, Y.&nbsp;T. Lee, Y.&nbsp;Li, S.&nbsp;Lundberg, H.&nbsp;Nori, H.&nbsp;Palangi, M.&nbsp;T. Ribeiro,
and Y.&nbsp;Zhang.

</span>
<span class="ltx_bibblock">Sparks of artificial general intelligence: Early experiments with
GPT-4, 2023.

</span>
<span class="ltx_bibblock">arXiv preprint arXiv:2303.12712.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Busa-Fekete et&nbsp;al. [2014]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;Busa-Fekete, B.&nbsp;Szörényi, P.&nbsp;Weng, W.&nbsp;Cheng, and
E.&nbsp;Hüllermeier.

</span>
<span class="ltx_bibblock">Preference-based reinforcement learning: evolutionary direct policy
search using a preference-based racing algorithm.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">Machine Learning</em>, 97(3):327–351, July
2014.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.1007/s10994-014-5458-8" title="">10.1007/s10994-014-5458-8</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1007/s10994-014-5458-8" title="">https://doi.org/10.1007/s10994-014-5458-8</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Y.&nbsp;Chen, R.&nbsp;Wang, H.&nbsp;Jiang, S.&nbsp;Shi, and R.-L. Xu.

</span>
<span class="ltx_bibblock">Exploring the use of large language models for reference-free text
quality evaluation: A preliminary empirical study.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">ArXiv</em>, abs/2304.00723, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chowdhery et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
A.&nbsp;Chowdhery, S.&nbsp;Narang, J.&nbsp;Devlin, M.&nbsp;Bosma, G.&nbsp;Mishra, A.&nbsp;Roberts, P.&nbsp;Barham,
H.&nbsp;W. Chung, C.&nbsp;Sutton, S.&nbsp;Gehrmann, et&nbsp;al.

</span>
<span class="ltx_bibblock">Palm: Scaling language modeling with pathways.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">arXiv preprint arXiv:2204.02311</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Christiano et&nbsp;al. [2017]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
P.&nbsp;F. Christiano, J.&nbsp;Leike, T.&nbsp;Brown, M.&nbsp;Martic, S.&nbsp;Legg, and D.&nbsp;Amodei.

</span>
<span class="ltx_bibblock">Deep reinforcement learning from human preferences.

</span>
<span class="ltx_bibblock">In I.&nbsp;Guyon, U.&nbsp;V. Luxburg, S.&nbsp;Bengio, H.&nbsp;Wallach, R.&nbsp;Fergus,
S.&nbsp;Vishwanathan, and R.&nbsp;Garnett, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">Advances in Neural
Information Processing Systems</em>, volume&nbsp;30. Curran Associates, Inc., 2017.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2017/file/d5e2c0adad503c91f91df240d0cd4e49-Paper.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2017/file/d5e2c0adad503c91f91df240d0cd4e49-Paper.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chung et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
H.&nbsp;W. Chung, L.&nbsp;Hou, S.&nbsp;Longpre, B.&nbsp;Zoph, Y.&nbsp;Tay, W.&nbsp;Fedus, Y.&nbsp;Li, X.&nbsp;Wang,
M.&nbsp;Dehghani, S.&nbsp;Brahma, A.&nbsp;Webson, S.&nbsp;S. Gu, Z.&nbsp;Dai, M.&nbsp;Suzgun, X.&nbsp;Chen,
A.&nbsp;Chowdhery, A.&nbsp;Castro-Ros, M.&nbsp;Pellat, K.&nbsp;Robinson, D.&nbsp;Valter, S.&nbsp;Narang,
G.&nbsp;Mishra, A.&nbsp;Yu, V.&nbsp;Zhao, Y.&nbsp;Huang, A.&nbsp;Dai, H.&nbsp;Yu, S.&nbsp;Petrov, E.&nbsp;H. Chi,
J.&nbsp;Dean, J.&nbsp;Devlin, A.&nbsp;Roberts, D.&nbsp;Zhou, Q.&nbsp;V. Le, and J.&nbsp;Wei.

</span>
<span class="ltx_bibblock">Scaling instruction-finetuned language models, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dudík et&nbsp;al. [2015]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
M.&nbsp;Dudík, K.&nbsp;Hofmann, R.&nbsp;E. Schapire, A.&nbsp;Slivkins, and M.&nbsp;Zoghi.

</span>
<span class="ltx_bibblock">Contextual dueling bandits.

</span>
<span class="ltx_bibblock">In P.&nbsp;Grünwald, E.&nbsp;Hazan, and S.&nbsp;Kale, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">Proceedings of
The 28th Conference on Learning Theory</em>, volume&nbsp;40 of <em class="ltx_emph ltx_font_italic" id="bib.bib14.2.2">Proceedings of
Machine Learning Research</em>, pages 563–587, Paris, France, 03–06 Jul 2015.
PMLR.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.mlr.press/v40/Dudik15.html" title="">https://proceedings.mlr.press/v40/Dudik15.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Go et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
D.&nbsp;Go, T.&nbsp;Korbak, G.&nbsp;Kruszewski, J.&nbsp;Rozen, N.&nbsp;Ryu, and M.&nbsp;Dymetman.

</span>
<span class="ltx_bibblock">Aligning language models with preferences through f-divergence
minimization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Proceedings of the 40th International Conference on Machine
Learning</em>, ICML’23. JMLR.org, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jain et&nbsp;al. [2013]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
A.&nbsp;Jain, B.&nbsp;Wojcik, T.&nbsp;Joachims, and A.&nbsp;Saxena.

</span>
<span class="ltx_bibblock">Learning trajectory preferences for manipulators via iterative
improvement.

</span>
<span class="ltx_bibblock">In C.&nbsp;Burges, L.&nbsp;Bottou, M.&nbsp;Welling, Z.&nbsp;Ghahramani, and
K.&nbsp;Weinberger, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">Advances in Neural Information Processing
Systems</em>, volume&nbsp;26. Curran Associates, Inc., 2013.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2013/file/c058f544c737782deacefa532d9add4c-Paper.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2013/file/c058f544c737782deacefa532d9add4c-Paper.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Korbak et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
T.&nbsp;Korbak, H.&nbsp;Elsahar, G.&nbsp;Kruszewski, and M.&nbsp;Dymetman.

</span>
<span class="ltx_bibblock">On reinforcement learning and distribution matching for fine-tuning
language models with no catastrophic forgetting.

</span>
<span class="ltx_bibblock">In S.&nbsp;Koyejo, S.&nbsp;Mohamed, A.&nbsp;Agarwal, D.&nbsp;Belgrave, K.&nbsp;Cho, and A.&nbsp;Oh,
editors, <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Advances in Neural Information Processing Systems</em>, volume&nbsp;35,
pages 16203–16220. Curran Associates, Inc., 2022.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2022/file/67496dfa96afddab795530cc7c69b57a-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2022/file/67496dfa96afddab795530cc7c69b57a-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kreutzer et&nbsp;al. [2018]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
J.&nbsp;Kreutzer, J.&nbsp;Uyheng, and S.&nbsp;Riezler.

</span>
<span class="ltx_bibblock">Reliability and learnability of human bandit feedback for
sequence-to-sequence reinforcement learning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Proceedings of the 56th Annual Meeting of the Association
for Computational Linguistics (Volume 1: Long Papers)</em>, pages 1777–1788,
Melbourne, Australia, July 2018. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/v1/P18-1165" title="">10.18653/v1/P18-1165</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P18-1165" title="">https://aclanthology.org/P18-1165</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kupcsik et&nbsp;al. [2018]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
A.&nbsp;Kupcsik, D.&nbsp;Hsu, and W.&nbsp;S. Lee.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Learning Dynamic Robot-to-Human Object Handover from Human
Feedback</em>, pages 161–176.

</span>
<span class="ltx_bibblock">Springer International Publishing, 01 2018.

</span>
<span class="ltx_bibblock">ISBN 978-3-319-51531-1.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.1007/978-3-319-51532-8_10" title="">10.1007/978-3-319-51532-8_10</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Levine [2018]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
S.&nbsp;Levine.

</span>
<span class="ltx_bibblock">Reinforcement learning and control as probabilistic inference:
Tutorial and review, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Luce [2012]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;D. Luce.

</span>
<span class="ltx_bibblock">Individual choice behavior: A theoretical analysis.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">Courier Corporation</em>, 2012.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Maas et&nbsp;al. [2011]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
A.&nbsp;L. Maas, R.&nbsp;E. Daly, P.&nbsp;T. Pham, D.&nbsp;Huang, A.&nbsp;Y. Ng, and C.&nbsp;Potts.

</span>
<span class="ltx_bibblock">Learning word vectors for sentiment analysis.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">Proceedings of the 49th Annual Meeting of the Association
for Computational Linguistics: Human Language Technologies</em>, pages 142–150,
Portland, Oregon, USA, June 2011. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://www.aclweb.org/anthology/P11-1015" title="">http://www.aclweb.org/anthology/P11-1015</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mishra et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
S.&nbsp;Mishra, D.&nbsp;Khashabi, C.&nbsp;Baral, and H.&nbsp;Hajishirzi.

</span>
<span class="ltx_bibblock">Cross-task generalization via natural language crowdsourcing
instructions.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">Proceedings of the 60th Annual Meeting of the Association
for Computational Linguistics (Volume 1: Long Papers)</em>, pages 3470–3487,
Dublin, Ireland, May 2022. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/v1/2022.acl-long.244" title="">10.18653/v1/2022.acl-long.244</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.acl-long.244" title="">https://aclanthology.org/2022.acl-long.244</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nallapati et&nbsp;al. [2016]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;Nallapati, B.&nbsp;Zhou, C.&nbsp;dos Santos, Ç.&nbsp;Gulçehre, and B.&nbsp;Xiang.

</span>
<span class="ltx_bibblock">Abstractive text summarization using sequence-to-sequence RNNs and
beyond.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Proceedings of the 20th SIGNLL Conference on Computational
Natural Language Learning</em>, pages 280–290, Berlin, Germany, Aug. 2016.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/v1/K16-1028" title="">10.18653/v1/K16-1028</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/K16-1028" title="">https://aclanthology.org/K16-1028</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Narayanan et&nbsp;al. [2021]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
D.&nbsp;Narayanan, M.&nbsp;Shoeybi, J.&nbsp;Casper, P.&nbsp;LeGresley, M.&nbsp;Patwary, V.&nbsp;Korthikanti,
D.&nbsp;Vainbrand, P.&nbsp;Kashinkunti, J.&nbsp;Bernauer, B.&nbsp;Catanzaro, A.&nbsp;Phanishayee, and
M.&nbsp;Zaharia.

</span>
<span class="ltx_bibblock">Efficient large-scale language model training on gpu clusters using
megatron-lm.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">Proceedings of the International Conference for High
Performance Computing, Networking, Storage and Analysis</em>, SC ’21, New York,
NY, USA, 2021. Association for Computing Machinery.

</span>
<span class="ltx_bibblock">ISBN 9781450384421.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.1145/3458817.3476209" title="">10.1145/3458817.3476209</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3458817.3476209" title="">https://doi.org/10.1145/3458817.3476209</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ouyang et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
L.&nbsp;Ouyang, J.&nbsp;Wu, X.&nbsp;Jiang, D.&nbsp;Almeida, C.&nbsp;Wainwright, P.&nbsp;Mishkin, C.&nbsp;Zhang,
S.&nbsp;Agarwal, K.&nbsp;Slama, A.&nbsp;Ray, J.&nbsp;Schulman, J.&nbsp;Hilton, F.&nbsp;Kelton, L.&nbsp;Miller,
M.&nbsp;Simens, A.&nbsp;Askell, P.&nbsp;Welinder, P.&nbsp;F. Christiano, J.&nbsp;Leike, and R.&nbsp;Lowe.

</span>
<span class="ltx_bibblock">Training language models to follow instructions with human feedback.

</span>
<span class="ltx_bibblock">In S.&nbsp;Koyejo, S.&nbsp;Mohamed, A.&nbsp;Agarwal, D.&nbsp;Belgrave, K.&nbsp;Cho, and A.&nbsp;Oh,
editors, <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">Advances in Neural Information Processing Systems</em>, volume&nbsp;35,
pages 27730–27744. Curran Associates, Inc., 2022.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2022/file/b1efde53be364a73914f58805a001731-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2022/file/b1efde53be364a73914f58805a001731-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Paulus et&nbsp;al. [2018]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;Paulus, C.&nbsp;Xiong, and R.&nbsp;Socher.

</span>
<span class="ltx_bibblock">A deep reinforced model for abstractive summarization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">International Conference on Learning Representations</em>, 2018.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=HkAClQgA-" title="">https://openreview.net/forum?id=HkAClQgA-</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peng et&nbsp;al. [2019]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
X.&nbsp;B. Peng, A.&nbsp;Kumar, G.&nbsp;Zhang, and S.&nbsp;Levine.

</span>
<span class="ltx_bibblock">Advantage-weighted regression: Simple and scalable off-policy
reinforcement learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">arXiv preprint arXiv:1910.00177</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peters and Schaal [2007]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
J.&nbsp;Peters and S.&nbsp;Schaal.

</span>
<span class="ltx_bibblock">Reinforcement learning by reward-weighted regression for operational
space control.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">Proceedings of the 24th international conference on Machine
learning</em>, pages 745–750, 2007.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Plackett [1975]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;L. Plackett.

</span>
<span class="ltx_bibblock">The analysis of permutations.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">Journal of the Royal Statistical Society. Series C (Applied
Statistics)</em>, 24(2):193–202, 1975.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="https://doi.org/10.2307/2346567" title="">https://doi.org/10.2307/2346567</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Radford et&nbsp;al. [2019]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
A.&nbsp;Radford, J.&nbsp;Wu, R.&nbsp;Child, D.&nbsp;Luan, D.&nbsp;Amodei, and I.&nbsp;Sutskever.

</span>
<span class="ltx_bibblock">Language models are unsupervised multitask learners, 2019.

</span>
<span class="ltx_bibblock">Ms., OpenAI.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ramamurthy et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;Ramamurthy, P.&nbsp;Ammanabrolu, K.&nbsp;Brantley, J.&nbsp;Hessel, R.&nbsp;Sifa, C.&nbsp;Bauckhage,
H.&nbsp;Hajishirzi, and Y.&nbsp;Choi.

</span>
<span class="ltx_bibblock">Is reinforcement learning (not) for natural language processing:
Benchmarks, baselines, and building blocks for natural language policy
optimization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">The Eleventh International Conference on Learning
Representations</em>, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=8aHzds2uUyB" title="">https://openreview.net/forum?id=8aHzds2uUyB</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ranzato et&nbsp;al. [2015]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
M.&nbsp;Ranzato, S.&nbsp;Chopra, M.&nbsp;Auli, and W.&nbsp;Zaremba.

</span>
<span class="ltx_bibblock">Sequence level training with recurrent neural networks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">CoRR</em>, abs/1511.06732, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sadigh et&nbsp;al. [2017]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
D.&nbsp;Sadigh, A.&nbsp;D. Dragan, S.&nbsp;Sastry, and S.&nbsp;A. Seshia.

</span>
<span class="ltx_bibblock">Active preference-based learning of reward functions.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">Robotics: Science and Systems (RSS)</em>, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Saha et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
A.&nbsp;Saha, A.&nbsp;Pacchiano, and J.&nbsp;Lee.

</span>
<span class="ltx_bibblock">Dueling rl: Reinforcement learning with trajectory preferences.

</span>
<span class="ltx_bibblock">In F.&nbsp;Ruiz, J.&nbsp;Dy, and J.-W. van&nbsp;de Meent, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">Proceedings
of The 26th International Conference on Artificial Intelligence and
Statistics</em>, volume 206 of <em class="ltx_emph ltx_font_italic" id="bib.bib35.2.2">Proceedings of Machine Learning Research</em>,
pages 6263–6289. PMLR, 25–27 Apr 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.mlr.press/v206/saha23a.html" title="">https://proceedings.mlr.press/v206/saha23a.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sanh et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
V.&nbsp;Sanh, A.&nbsp;Webson, C.&nbsp;Raffel, S.&nbsp;Bach, L.&nbsp;Sutawika, Z.&nbsp;Alyafeai, A.&nbsp;Chaffin,
A.&nbsp;Stiegler, A.&nbsp;Raja, M.&nbsp;Dey, M.&nbsp;S. Bari, C.&nbsp;Xu, U.&nbsp;Thakker, S.&nbsp;S. Sharma,
E.&nbsp;Szczechla, T.&nbsp;Kim, G.&nbsp;Chhablani, N.&nbsp;Nayak, D.&nbsp;Datta, J.&nbsp;Chang, M.&nbsp;T.-J.
Jiang, H.&nbsp;Wang, M.&nbsp;Manica, S.&nbsp;Shen, Z.&nbsp;X. Yong, H.&nbsp;Pandey, R.&nbsp;Bawden,
T.&nbsp;Wang, T.&nbsp;Neeraj, J.&nbsp;Rozen, A.&nbsp;Sharma, A.&nbsp;Santilli, T.&nbsp;Fevry, J.&nbsp;A. Fries,
R.&nbsp;Teehan, T.&nbsp;L. Scao, S.&nbsp;Biderman, L.&nbsp;Gao, T.&nbsp;Wolf, and A.&nbsp;M. Rush.

</span>
<span class="ltx_bibblock">Multitask prompted training enables zero-shot task generalization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">International Conference on Learning Representations</em>, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=9Vrb9D0WI4" title="">https://openreview.net/forum?id=9Vrb9D0WI4</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Schulman et&nbsp;al. [2017]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
J.&nbsp;Schulman, F.&nbsp;Wolski, P.&nbsp;Dhariwal, A.&nbsp;Radford, and O.&nbsp;Klimov.

</span>
<span class="ltx_bibblock">Proximal policy optimization algorithms, 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Stiennon et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
N.&nbsp;Stiennon, L.&nbsp;Ouyang, J.&nbsp;Wu, D.&nbsp;M. Ziegler, R.&nbsp;Lowe, C.&nbsp;Voss, A.&nbsp;Radford,
D.&nbsp;Amodei, and P.&nbsp;Christiano.

</span>
<span class="ltx_bibblock">Learning to summarize from human feedback, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Thoppilan et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;Thoppilan, D.&nbsp;D. Freitas, J.&nbsp;Hall, N.&nbsp;Shazeer, A.&nbsp;Kulshreshtha, H.-T. Cheng,
A.&nbsp;Jin, T.&nbsp;Bos, L.&nbsp;Baker, Y.&nbsp;Du, Y.&nbsp;Li, H.&nbsp;Lee, H.&nbsp;S. Zheng, A.&nbsp;Ghafouri,
M.&nbsp;Menegali, Y.&nbsp;Huang, M.&nbsp;Krikun, D.&nbsp;Lepikhin, J.&nbsp;Qin, D.&nbsp;Chen, Y.&nbsp;Xu,
Z.&nbsp;Chen, A.&nbsp;Roberts, M.&nbsp;Bosma, V.&nbsp;Zhao, Y.&nbsp;Zhou, C.-C. Chang, I.&nbsp;Krivokon,
W.&nbsp;Rusch, M.&nbsp;Pickett, P.&nbsp;Srinivasan, L.&nbsp;Man, K.&nbsp;Meier-Hellstern, M.&nbsp;R.
Morris, T.&nbsp;Doshi, R.&nbsp;D. Santos, T.&nbsp;Duke, J.&nbsp;Soraker, B.&nbsp;Zevenbergen,
V.&nbsp;Prabhakaran, M.&nbsp;Diaz, B.&nbsp;Hutchinson, K.&nbsp;Olson, A.&nbsp;Molina, E.&nbsp;Hoffman-John,
J.&nbsp;Lee, L.&nbsp;Aroyo, R.&nbsp;Rajakumar, A.&nbsp;Butryna, M.&nbsp;Lamm, V.&nbsp;Kuzmina, J.&nbsp;Fenton,
A.&nbsp;Cohen, R.&nbsp;Bernstein, R.&nbsp;Kurzweil, B.&nbsp;Aguera-Arcas, C.&nbsp;Cui, M.&nbsp;Croak,
E.&nbsp;Chi, and Q.&nbsp;Le.

</span>
<span class="ltx_bibblock">Lamda: Language models for dialog applications, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
H.&nbsp;Touvron, T.&nbsp;Lavril, G.&nbsp;Izacard, X.&nbsp;Martinet, M.-A. Lachaux, T.&nbsp;Lacroix,
B.&nbsp;Rozière, N.&nbsp;Goyal, E.&nbsp;Hambro, F.&nbsp;Azhar, et&nbsp;al.

</span>
<span class="ltx_bibblock">Llama: Open and efficient foundation language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">arXiv preprint arXiv:2302.13971</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Völske et&nbsp;al. [2017]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
M.&nbsp;Völske, M.&nbsp;Potthast, S.&nbsp;Syed, and B.&nbsp;Stein.

</span>
<span class="ltx_bibblock">TL;DR: Mining Reddit to learn automatic summarization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">Proceedings of the Workshop on New Frontiers in
Summarization</em>, pages 59–63, Copenhagen, Denmark, Sept. 2017. Association
for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.18653/v1/W17-4508" title="">10.18653/v1/W17-4508</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/W17-4508" title="">https://aclanthology.org/W17-4508</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">von Werra et&nbsp;al. [2023]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
L.&nbsp;von Werra, J.&nbsp;Tow, reciprocated, S.&nbsp;Matiana, A.&nbsp;Havrilla, cat state,
L.&nbsp;Castricato, Alan, D.&nbsp;V. Phung, A.&nbsp;Thakur, A.&nbsp;Bukhtiyarov, aaronrmm,
F.&nbsp;Milo, Daniel, D.&nbsp;King, D.&nbsp;Shin, E.&nbsp;Kim, J.&nbsp;Wei, M.&nbsp;Romero, N.&nbsp;Pochinkov,
O.&nbsp;Sanseviero, R.&nbsp;Adithyan, S.&nbsp;Siu, T.&nbsp;Simonini, V.&nbsp;Blagojevic, X.&nbsp;Song,
Z.&nbsp;Witten, alexandremuzio, and crumb.

</span>
<span class="ltx_bibblock">CarperAI/trlx: v0.6.0: LLaMa (Alpaca), Benchmark Util, T5 ILQL,
Tests, Mar. 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.5281/zenodo.7790115" title="">https://doi.org/10.5281/zenodo.7790115</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang and Komatsuzaki [2021]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
B.&nbsp;Wang and A.&nbsp;Komatsuzaki.

</span>
<span class="ltx_bibblock">GPT-J-6B: A 6 Billion Parameter Autoregressive Language Model.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://github.com/kingoflolz/mesh-transformer-jax" title="">https://github.com/kingoflolz/mesh-transformer-jax</a>, May 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Welleck et&nbsp;al. [2019]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
S.&nbsp;Welleck, I.&nbsp;Kulikov, S.&nbsp;Roller, E.&nbsp;Dinan, K.&nbsp;Cho, and J.&nbsp;Weston.

</span>
<span class="ltx_bibblock">Neural text generation with unlikelihood training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">arXiv preprint arXiv:1908.04319</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Williams [1992]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
R.&nbsp;J. Williams.

</span>
<span class="ltx_bibblock">Simple statistical gradient-following algorithms for connectionist
reinforcement learning.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">Mach. Learn.</em>, 8(3–4):229–256, may
1992.

</span>
<span class="ltx_bibblock">ISSN 0885-6125.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.1007/BF00992696" title="">10.1007/BF00992696</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1007/BF00992696" title="">https://doi.org/10.1007/BF00992696</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu and Hu [2018]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Y.&nbsp;Wu and B.&nbsp;Hu.

</span>
<span class="ltx_bibblock">Learning to extract coherent summary via deep reinforcement learning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib46.1.1">Proceedings of the Thirty-Second AAAI Conference on
Artificial Intelligence and Thirtieth Innovative Applications of Artificial
Intelligence Conference and Eighth AAAI Symposium on Educational Advances in
Artificial Intelligence</em>, AAAI’18/IAAI’18/EAAI’18. AAAI Press, 2018.

</span>
<span class="ltx_bibblock">ISBN 978-1-57735-800-8.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yan et&nbsp;al. [2022]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
X.&nbsp;Yan, C.&nbsp;Luo, C.&nbsp;L.&nbsp;A. Clarke, N.&nbsp;Craswell, E.&nbsp;M. Voorhees, and P.&nbsp;Castells.

</span>
<span class="ltx_bibblock">Human preferences as dueling bandits.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">Proceedings of the 45th International ACM SIGIR Conference
on Research and Development in Information Retrieval</em>, SIGIR ’22, page
567–577, New York, NY, USA, 2022. Association for Computing Machinery.

</span>
<span class="ltx_bibblock">ISBN 9781450387323.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="10.1145/3477495.3531991" title="">10.1145/3477495.3531991</a>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/3477495.3531991" title="">https://doi.org/10.1145/3477495.3531991</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yue et&nbsp;al. [2012]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Y.&nbsp;Yue, J.&nbsp;Broder, R.&nbsp;Kleinberg, and T.&nbsp;Joachims.

</span>
<span class="ltx_bibblock">The k-armed dueling bandits problem.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib48.1.1">Journal of Computer and System Sciences</em>, 78(5):1538–1556, 2012.

</span>
<span class="ltx_bibblock">ISSN 0022-0000.

</span>
<span class="ltx_bibblock">doi: <a class="ltx_ref ltx_Url" href="https://doi.org/10.1016/j.jcss.2011.12.028" title="">https://doi.org/10.1016/j.jcss.2011.12.028</a>.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.sciencedirect.com/science/article/pii/S0022000012000281" title="">https://www.sciencedirect.com/science/article/pii/S0022000012000281</a>.

</span>
<span class="ltx_bibblock">JCSS Special Issue: Cloud Computing 2011.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ziegler et&nbsp;al. [2020]<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
D.&nbsp;M. Ziegler, N.&nbsp;Stiennon, J.&nbsp;Wu, T.&nbsp;B. Brown, A.&nbsp;Radford, D.&nbsp;Amodei,
P.&nbsp;Christiano, and G.&nbsp;Irving.

</span>
<span class="ltx_bibblock">Fine-tuning language models from human preferences, 2020.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="Ax1">
<h2 class="ltx_title ltx_title_appendix">Author Contributions</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Ax1.p1">
<p class="ltx_p" id="Ax1.p1.1"><span class="ltx_text ltx_font_bold" id="Ax1.p1.1.1">All authors</span> provided valuable contributions to designing, analyzing, and iterating on experiments, writing and editing the paper, and generally managing the project’s progress.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="Ax1.p2">
<p class="ltx_p" id="Ax1.p2.1"><span class="ltx_text ltx_font_bold" id="Ax1.p2.1.1">RR</span> proposed using autoregressive reward models in discussions with <span class="ltx_text ltx_font_bold" id="Ax1.p2.1.2">EM</span>; derived the DPO objective; proved the theoretical properties of the algorithm and wrote the relevant sections and appendices. He also suggested and helped with organizing experiments and contributed some of the PPO and reward learning baselines.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="Ax1.p3">
<p class="ltx_p" id="Ax1.p3.1"><span class="ltx_text ltx_font_bold" id="Ax1.p3.1.1">AS</span> initiated the discussion on using weighted regression methods as an alternative to PPO;
initiated project-related organization, wrote initial analysis connecting DPO with weighted regression and unlikelihood; design and iterations of DPO + baseline implementations, initial exploratory experiments for DPO; substantial experiment organization and design (datasets, baselines, evaluation); led model training and evaluation for controlled sentiment generation and summarization; design iterations for GPT-4 evaluation (particularly summarization); substantial writing contributions to abstract, prelims/method and experiments; editing contributions to other sections.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="Ax1.p4">
<p class="ltx_p" id="Ax1.p4.1"><span class="ltx_text ltx_font_bold" id="Ax1.p4.1.1">EM</span> provided input on early discussions on learning autoregressive reward functions; wrote the first implementation of DPO and ran the first DPO experiments; trained the large-scale (summarization and dialogue) DPO models used in paper experiments; conducted initial GPT-4 win rate evaluations and set up related infrastructure; recruited participants for, conducted, and analyzed results from the human study; wrote the abstract, introduction, related work, discussion, and most of experiments; and assisted with editing the rest of the paper.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="Ax1.p5">
<p class="ltx_p" id="Ax1.p5.1"><span class="ltx_text ltx_font_bold" id="Ax1.p5.1.1">CF, CM, &amp; SE</span> supervised the research, suggested ideas and experiments, and assisted in writing the paper.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Mathematical Derivations</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_subsection" id="A1.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1 </span>Deriving the Optimum of the KL-Constrained Reward Maximization Objective</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS1.p1">
<p class="ltx_p" id="A1.SS1.p1.3">In this appendix, we will derive Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>. Analogously to Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S3.E3" title="3 ‣ 3 Preliminaries ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">3</span></a>, we optimize the following objective:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E11">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{\pi}\mathbb{E}_{x\sim\mathcal{D},y\sim\pi}\bigl{[}r(x,y)\bigr{]}-\beta%
\mathbb{D}_{\textrm{KL}}\bigl{[}\pi(y|x)||\pi_{\text{ref}}(y|x)\bigr{]}" class="ltx_math_unparsed" display="block" id="A1.E11.m1.4"><semantics id="A1.E11.m1.4a"><mrow id="A1.E11.m1.4b"><munder id="A1.E11.m1.4.5"><mi id="A1.E11.m1.4.5.2">max</mi><mi id="A1.E11.m1.4.5.3">π</mi></munder><msub id="A1.E11.m1.4.6"><mi id="A1.E11.m1.4.6.2">𝔼</mi><mrow id="A1.E11.m1.2.2.2.2"><mrow id="A1.E11.m1.1.1.1.1.1"><mi id="A1.E11.m1.1.1.1.1.1.2">x</mi><mo id="A1.E11.m1.1.1.1.1.1.1">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E11.m1.1.1.1.1.1.3">𝒟</mi></mrow><mo id="A1.E11.m1.2.2.2.2.3">,</mo><mrow id="A1.E11.m1.2.2.2.2.2"><mi id="A1.E11.m1.2.2.2.2.2.2">y</mi><mo id="A1.E11.m1.2.2.2.2.2.1">∼</mo><mi id="A1.E11.m1.2.2.2.2.2.3">π</mi></mrow></mrow></msub><mrow id="A1.E11.m1.4.7"><mo id="A1.E11.m1.4.7.1" maxsize="120%" minsize="120%">[</mo><mi id="A1.E11.m1.4.7.2">r</mi><mrow id="A1.E11.m1.4.7.3"><mo id="A1.E11.m1.4.7.3.1" stretchy="false">(</mo><mi id="A1.E11.m1.3.3">x</mi><mo id="A1.E11.m1.4.7.3.2">,</mo><mi id="A1.E11.m1.4.4">y</mi><mo id="A1.E11.m1.4.7.3.3" stretchy="false">)</mo></mrow><mo id="A1.E11.m1.4.7.4" maxsize="120%" minsize="120%">]</mo></mrow><mo id="A1.E11.m1.4.8">−</mo><mi id="A1.E11.m1.4.9">β</mi><msub id="A1.E11.m1.4.10"><mi id="A1.E11.m1.4.10.2">𝔻</mi><mtext id="A1.E11.m1.4.10.3">KL</mtext></msub><mrow id="A1.E11.m1.4.11"><mo id="A1.E11.m1.4.11.1" maxsize="120%" minsize="120%">[</mo><mi id="A1.E11.m1.4.11.2">π</mi><mrow id="A1.E11.m1.4.11.3"><mo id="A1.E11.m1.4.11.3.1" stretchy="false">(</mo><mi id="A1.E11.m1.4.11.3.2">y</mi><mo fence="false" id="A1.E11.m1.4.11.3.3" rspace="0.167em" stretchy="false">|</mo><mi id="A1.E11.m1.4.11.3.4">x</mi><mo id="A1.E11.m1.4.11.3.5" stretchy="false">)</mo></mrow><mo fence="false" id="A1.E11.m1.4.11.4" rspace="0.167em" stretchy="false">|</mo><mo fence="false" id="A1.E11.m1.4.11.5" rspace="0.167em" stretchy="false">|</mo><msub id="A1.E11.m1.4.11.6"><mi id="A1.E11.m1.4.11.6.2">π</mi><mtext id="A1.E11.m1.4.11.6.3">ref</mtext></msub><mrow id="A1.E11.m1.4.11.7"><mo id="A1.E11.m1.4.11.7.1" stretchy="false">(</mo><mi id="A1.E11.m1.4.11.7.2">y</mi><mo fence="false" id="A1.E11.m1.4.11.7.3" rspace="0.167em" stretchy="false">|</mo><mi id="A1.E11.m1.4.11.7.4">x</mi><mo id="A1.E11.m1.4.11.7.5" stretchy="false">)</mo></mrow><mo id="A1.E11.m1.4.11.8" maxsize="120%" minsize="120%">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="A1.E11.m1.4c">\max_{\pi}\mathbb{E}_{x\sim\mathcal{D},y\sim\pi}\bigl{[}r(x,y)\bigr{]}-\beta%
\mathbb{D}_{\textrm{KL}}\bigl{[}\pi(y|x)||\pi_{\text{ref}}(y|x)\bigr{]}</annotation><annotation encoding="application/x-llamapun" id="A1.E11.m1.4d">roman_max start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D , italic_y ∼ italic_π end_POSTSUBSCRIPT [ italic_r ( italic_x , italic_y ) ] - italic_β blackboard_D start_POSTSUBSCRIPT KL end_POSTSUBSCRIPT [ italic_π ( italic_y | italic_x ) | | italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(11)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS1.p1.2">under any reward function <math alttext="r(x,y)" class="ltx_Math" display="inline" id="A1.SS1.p1.1.m1.2"><semantics id="A1.SS1.p1.1.m1.2a"><mrow id="A1.SS1.p1.1.m1.2.3" xref="A1.SS1.p1.1.m1.2.3.cmml"><mi id="A1.SS1.p1.1.m1.2.3.2" xref="A1.SS1.p1.1.m1.2.3.2.cmml">r</mi><mo id="A1.SS1.p1.1.m1.2.3.1" xref="A1.SS1.p1.1.m1.2.3.1.cmml">⁢</mo><mrow id="A1.SS1.p1.1.m1.2.3.3.2" xref="A1.SS1.p1.1.m1.2.3.3.1.cmml"><mo id="A1.SS1.p1.1.m1.2.3.3.2.1" stretchy="false" xref="A1.SS1.p1.1.m1.2.3.3.1.cmml">(</mo><mi id="A1.SS1.p1.1.m1.1.1" xref="A1.SS1.p1.1.m1.1.1.cmml">x</mi><mo id="A1.SS1.p1.1.m1.2.3.3.2.2" xref="A1.SS1.p1.1.m1.2.3.3.1.cmml">,</mo><mi id="A1.SS1.p1.1.m1.2.2" xref="A1.SS1.p1.1.m1.2.2.cmml">y</mi><mo id="A1.SS1.p1.1.m1.2.3.3.2.3" stretchy="false" xref="A1.SS1.p1.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p1.1.m1.2b"><apply id="A1.SS1.p1.1.m1.2.3.cmml" xref="A1.SS1.p1.1.m1.2.3"><times id="A1.SS1.p1.1.m1.2.3.1.cmml" xref="A1.SS1.p1.1.m1.2.3.1"></times><ci id="A1.SS1.p1.1.m1.2.3.2.cmml" xref="A1.SS1.p1.1.m1.2.3.2">𝑟</ci><interval closure="open" id="A1.SS1.p1.1.m1.2.3.3.1.cmml" xref="A1.SS1.p1.1.m1.2.3.3.2"><ci id="A1.SS1.p1.1.m1.1.1.cmml" xref="A1.SS1.p1.1.m1.1.1">𝑥</ci><ci id="A1.SS1.p1.1.m1.2.2.cmml" xref="A1.SS1.p1.1.m1.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p1.1.m1.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p1.1.m1.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math>, reference model <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="A1.SS1.p1.2.m2.1"><semantics id="A1.SS1.p1.2.m2.1a"><msub id="A1.SS1.p1.2.m2.1.1" xref="A1.SS1.p1.2.m2.1.1.cmml"><mi id="A1.SS1.p1.2.m2.1.1.2" xref="A1.SS1.p1.2.m2.1.1.2.cmml">π</mi><mtext id="A1.SS1.p1.2.m2.1.1.3" xref="A1.SS1.p1.2.m2.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p1.2.m2.1b"><apply id="A1.SS1.p1.2.m2.1.1.cmml" xref="A1.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS1.p1.2.m2.1.1.1.cmml" xref="A1.SS1.p1.2.m2.1.1">subscript</csymbol><ci id="A1.SS1.p1.2.m2.1.1.2.cmml" xref="A1.SS1.p1.2.m2.1.1.2">𝜋</ci><ci id="A1.SS1.p1.2.m2.1.1.3a.cmml" xref="A1.SS1.p1.2.m2.1.1.3"><mtext id="A1.SS1.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p1.2.m2.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p1.2.m2.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p1.2.m2.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math> and a general non-parametric policy class. We now have:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx1">
<tbody id="A1.Ex1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\max_{\pi}\mathbb{E}_{x\sim\mathcal{D},y\sim\pi}" class="ltx_Math" display="inline" id="A1.Ex1.m1.2"><semantics id="A1.Ex1.m1.2a"><mrow id="A1.Ex1.m1.2.3" xref="A1.Ex1.m1.2.3.cmml"><munder id="A1.Ex1.m1.2.3.1" xref="A1.Ex1.m1.2.3.1.cmml"><mi id="A1.Ex1.m1.2.3.1.2" xref="A1.Ex1.m1.2.3.1.2.cmml">max</mi><mi id="A1.Ex1.m1.2.3.1.3" xref="A1.Ex1.m1.2.3.1.3.cmml">π</mi></munder><mo id="A1.Ex1.m1.2.3a" lspace="0.167em" xref="A1.Ex1.m1.2.3.cmml">⁡</mo><msub id="A1.Ex1.m1.2.3.2" xref="A1.Ex1.m1.2.3.2.cmml"><mi id="A1.Ex1.m1.2.3.2.2" xref="A1.Ex1.m1.2.3.2.2.cmml">𝔼</mi><mrow id="A1.Ex1.m1.2.2.2.2" xref="A1.Ex1.m1.2.2.2.3.cmml"><mrow id="A1.Ex1.m1.1.1.1.1.1" xref="A1.Ex1.m1.1.1.1.1.1.cmml"><mi id="A1.Ex1.m1.1.1.1.1.1.2" xref="A1.Ex1.m1.1.1.1.1.1.2.cmml">x</mi><mo id="A1.Ex1.m1.1.1.1.1.1.1" xref="A1.Ex1.m1.1.1.1.1.1.1.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.Ex1.m1.1.1.1.1.1.3" xref="A1.Ex1.m1.1.1.1.1.1.3.cmml">𝒟</mi></mrow><mo id="A1.Ex1.m1.2.2.2.2.3" xref="A1.Ex1.m1.2.2.2.3a.cmml">,</mo><mrow id="A1.Ex1.m1.2.2.2.2.2" xref="A1.Ex1.m1.2.2.2.2.2.cmml"><mi id="A1.Ex1.m1.2.2.2.2.2.2" xref="A1.Ex1.m1.2.2.2.2.2.2.cmml">y</mi><mo id="A1.Ex1.m1.2.2.2.2.2.1" xref="A1.Ex1.m1.2.2.2.2.2.1.cmml">∼</mo><mi id="A1.Ex1.m1.2.2.2.2.2.3" xref="A1.Ex1.m1.2.2.2.2.2.3.cmml">π</mi></mrow></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex1.m1.2b"><apply id="A1.Ex1.m1.2.3.cmml" xref="A1.Ex1.m1.2.3"><apply id="A1.Ex1.m1.2.3.1.cmml" xref="A1.Ex1.m1.2.3.1"><csymbol cd="ambiguous" id="A1.Ex1.m1.2.3.1.1.cmml" xref="A1.Ex1.m1.2.3.1">subscript</csymbol><max id="A1.Ex1.m1.2.3.1.2.cmml" xref="A1.Ex1.m1.2.3.1.2"></max><ci id="A1.Ex1.m1.2.3.1.3.cmml" xref="A1.Ex1.m1.2.3.1.3">𝜋</ci></apply><apply id="A1.Ex1.m1.2.3.2.cmml" xref="A1.Ex1.m1.2.3.2"><csymbol cd="ambiguous" id="A1.Ex1.m1.2.3.2.1.cmml" xref="A1.Ex1.m1.2.3.2">subscript</csymbol><ci id="A1.Ex1.m1.2.3.2.2.cmml" xref="A1.Ex1.m1.2.3.2.2">𝔼</ci><apply id="A1.Ex1.m1.2.2.2.3.cmml" xref="A1.Ex1.m1.2.2.2.2"><csymbol cd="ambiguous" id="A1.Ex1.m1.2.2.2.3a.cmml" xref="A1.Ex1.m1.2.2.2.2.3">formulae-sequence</csymbol><apply id="A1.Ex1.m1.1.1.1.1.1.cmml" xref="A1.Ex1.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex1.m1.1.1.1.1.1.1.cmml" xref="A1.Ex1.m1.1.1.1.1.1.1">similar-to</csymbol><ci id="A1.Ex1.m1.1.1.1.1.1.2.cmml" xref="A1.Ex1.m1.1.1.1.1.1.2">𝑥</ci><ci id="A1.Ex1.m1.1.1.1.1.1.3.cmml" xref="A1.Ex1.m1.1.1.1.1.1.3">𝒟</ci></apply><apply id="A1.Ex1.m1.2.2.2.2.2.cmml" xref="A1.Ex1.m1.2.2.2.2.2"><csymbol cd="latexml" id="A1.Ex1.m1.2.2.2.2.2.1.cmml" xref="A1.Ex1.m1.2.2.2.2.2.1">similar-to</csymbol><ci id="A1.Ex1.m1.2.2.2.2.2.2.cmml" xref="A1.Ex1.m1.2.2.2.2.2.2">𝑦</ci><ci id="A1.Ex1.m1.2.2.2.2.2.3.cmml" xref="A1.Ex1.m1.2.2.2.2.2.3">𝜋</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex1.m1.2c">\displaystyle\max_{\pi}\mathbb{E}_{x\sim\mathcal{D},y\sim\pi}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex1.m1.2d">roman_max start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D , italic_y ∼ italic_π end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle\bigl{[}r(x,y)\bigr{]}-\beta\mathbb{D}_{\textrm{KL}}\bigl{[}\pi(y%
|x)\mid\mid\pi_{\text{ref}}(y|x)\bigr{]}" class="ltx_math_unparsed" display="inline" id="A1.Ex1.m2.2"><semantics id="A1.Ex1.m2.2a"><mrow id="A1.Ex1.m2.2b"><mrow id="A1.Ex1.m2.2.3"><mo id="A1.Ex1.m2.2.3.1" maxsize="120%" minsize="120%">[</mo><mi id="A1.Ex1.m2.2.3.2">r</mi><mrow id="A1.Ex1.m2.2.3.3"><mo id="A1.Ex1.m2.2.3.3.1" stretchy="false">(</mo><mi id="A1.Ex1.m2.1.1">x</mi><mo id="A1.Ex1.m2.2.3.3.2">,</mo><mi id="A1.Ex1.m2.2.2">y</mi><mo id="A1.Ex1.m2.2.3.3.3" stretchy="false">)</mo></mrow><mo id="A1.Ex1.m2.2.3.4" maxsize="120%" minsize="120%">]</mo></mrow><mo id="A1.Ex1.m2.2.4">−</mo><mi id="A1.Ex1.m2.2.5">β</mi><msub id="A1.Ex1.m2.2.6"><mi id="A1.Ex1.m2.2.6.2">𝔻</mi><mtext id="A1.Ex1.m2.2.6.3">KL</mtext></msub><mrow id="A1.Ex1.m2.2.7"><mo id="A1.Ex1.m2.2.7.1" maxsize="120%" minsize="120%">[</mo><mi id="A1.Ex1.m2.2.7.2">π</mi><mrow id="A1.Ex1.m2.2.7.3"><mo id="A1.Ex1.m2.2.7.3.1" stretchy="false">(</mo><mi id="A1.Ex1.m2.2.7.3.2">y</mi><mo fence="false" id="A1.Ex1.m2.2.7.3.3" rspace="0.167em" stretchy="false">|</mo><mi id="A1.Ex1.m2.2.7.3.4">x</mi><mo id="A1.Ex1.m2.2.7.3.5" stretchy="false">)</mo></mrow><mo id="A1.Ex1.m2.2.7.4" lspace="0em" rspace="0.0835em">∣</mo><mo id="A1.Ex1.m2.2.7.5" lspace="0.0835em" rspace="0.167em">∣</mo><msub id="A1.Ex1.m2.2.7.6"><mi id="A1.Ex1.m2.2.7.6.2">π</mi><mtext id="A1.Ex1.m2.2.7.6.3">ref</mtext></msub><mrow id="A1.Ex1.m2.2.7.7"><mo id="A1.Ex1.m2.2.7.7.1" stretchy="false">(</mo><mi id="A1.Ex1.m2.2.7.7.2">y</mi><mo fence="false" id="A1.Ex1.m2.2.7.7.3" rspace="0.167em" stretchy="false">|</mo><mi id="A1.Ex1.m2.2.7.7.4">x</mi><mo id="A1.Ex1.m2.2.7.7.5" stretchy="false">)</mo></mrow><mo id="A1.Ex1.m2.2.7.8" maxsize="120%" minsize="120%">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="A1.Ex1.m2.2c">\displaystyle\bigl{[}r(x,y)\bigr{]}-\beta\mathbb{D}_{\textrm{KL}}\bigl{[}\pi(y%
|x)\mid\mid\pi_{\text{ref}}(y|x)\bigr{]}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex1.m2.2d">[ italic_r ( italic_x , italic_y ) ] - italic_β blackboard_D start_POSTSUBSCRIPT KL end_POSTSUBSCRIPT [ italic_π ( italic_y | italic_x ) ∣ ∣ italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\max_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\mathbb{E}_{y\sim\pi(y|x)%
}\left[r(x,y)-\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}\right]" class="ltx_Math" display="inline" id="A1.Ex2.m1.6"><semantics id="A1.Ex2.m1.6a"><mrow id="A1.Ex2.m1.6.6" xref="A1.Ex2.m1.6.6.cmml"><mi id="A1.Ex2.m1.6.6.3" xref="A1.Ex2.m1.6.6.3.cmml"></mi><mo id="A1.Ex2.m1.6.6.2" xref="A1.Ex2.m1.6.6.2.cmml">=</mo><mrow id="A1.Ex2.m1.6.6.1" xref="A1.Ex2.m1.6.6.1.cmml"><mrow id="A1.Ex2.m1.6.6.1.3" xref="A1.Ex2.m1.6.6.1.3.cmml"><munder id="A1.Ex2.m1.6.6.1.3.1" xref="A1.Ex2.m1.6.6.1.3.1.cmml"><mi id="A1.Ex2.m1.6.6.1.3.1.2" xref="A1.Ex2.m1.6.6.1.3.1.2.cmml">max</mi><mi id="A1.Ex2.m1.6.6.1.3.1.3" xref="A1.Ex2.m1.6.6.1.3.1.3.cmml">π</mi></munder><mo id="A1.Ex2.m1.6.6.1.3a" lspace="0.167em" xref="A1.Ex2.m1.6.6.1.3.cmml">⁡</mo><mrow id="A1.Ex2.m1.6.6.1.3.2" xref="A1.Ex2.m1.6.6.1.3.2.cmml"><msub id="A1.Ex2.m1.6.6.1.3.2.2" xref="A1.Ex2.m1.6.6.1.3.2.2.cmml"><mi id="A1.Ex2.m1.6.6.1.3.2.2.2" xref="A1.Ex2.m1.6.6.1.3.2.2.2.cmml">𝔼</mi><mrow id="A1.Ex2.m1.6.6.1.3.2.2.3" xref="A1.Ex2.m1.6.6.1.3.2.2.3.cmml"><mi id="A1.Ex2.m1.6.6.1.3.2.2.3.2" xref="A1.Ex2.m1.6.6.1.3.2.2.3.2.cmml">x</mi><mo id="A1.Ex2.m1.6.6.1.3.2.2.3.1" xref="A1.Ex2.m1.6.6.1.3.2.2.3.1.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.Ex2.m1.6.6.1.3.2.2.3.3" xref="A1.Ex2.m1.6.6.1.3.2.2.3.3.cmml">𝒟</mi></mrow></msub><mo id="A1.Ex2.m1.6.6.1.3.2.1" xref="A1.Ex2.m1.6.6.1.3.2.1.cmml">⁢</mo><msub id="A1.Ex2.m1.6.6.1.3.2.3" xref="A1.Ex2.m1.6.6.1.3.2.3.cmml"><mi id="A1.Ex2.m1.6.6.1.3.2.3.2" xref="A1.Ex2.m1.6.6.1.3.2.3.2.cmml">𝔼</mi><mrow id="A1.Ex2.m1.1.1.1" xref="A1.Ex2.m1.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.3.cmml">y</mi><mo id="A1.Ex2.m1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.2.cmml">∼</mo><mrow id="A1.Ex2.m1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.3.cmml">π</mi><mo id="A1.Ex2.m1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex2.m1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.1.cmml"><mo id="A1.Ex2.m1.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex2.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex2.m1.1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex2.m1.1.1.1.1.1.1.1.2" xref="A1.Ex2.m1.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex2.m1.1.1.1.1.1.1.1.1" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex2.m1.1.1.1.1.1.1.1.3" xref="A1.Ex2.m1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex2.m1.1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex2.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></msub></mrow></mrow><mo id="A1.Ex2.m1.6.6.1.2" xref="A1.Ex2.m1.6.6.1.2.cmml">⁢</mo><mrow id="A1.Ex2.m1.6.6.1.1.1" xref="A1.Ex2.m1.6.6.1.1.2.cmml"><mo id="A1.Ex2.m1.6.6.1.1.1.2" xref="A1.Ex2.m1.6.6.1.1.2.1.cmml">[</mo><mrow id="A1.Ex2.m1.6.6.1.1.1.1" xref="A1.Ex2.m1.6.6.1.1.1.1.cmml"><mrow id="A1.Ex2.m1.6.6.1.1.1.1.2" xref="A1.Ex2.m1.6.6.1.1.1.1.2.cmml"><mi id="A1.Ex2.m1.6.6.1.1.1.1.2.2" xref="A1.Ex2.m1.6.6.1.1.1.1.2.2.cmml">r</mi><mo id="A1.Ex2.m1.6.6.1.1.1.1.2.1" xref="A1.Ex2.m1.6.6.1.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex2.m1.6.6.1.1.1.1.2.3.2" xref="A1.Ex2.m1.6.6.1.1.1.1.2.3.1.cmml"><mo id="A1.Ex2.m1.6.6.1.1.1.1.2.3.2.1" stretchy="false" xref="A1.Ex2.m1.6.6.1.1.1.1.2.3.1.cmml">(</mo><mi id="A1.Ex2.m1.4.4" xref="A1.Ex2.m1.4.4.cmml">x</mi><mo id="A1.Ex2.m1.6.6.1.1.1.1.2.3.2.2" xref="A1.Ex2.m1.6.6.1.1.1.1.2.3.1.cmml">,</mo><mi id="A1.Ex2.m1.5.5" xref="A1.Ex2.m1.5.5.cmml">y</mi><mo id="A1.Ex2.m1.6.6.1.1.1.1.2.3.2.3" stretchy="false" xref="A1.Ex2.m1.6.6.1.1.1.1.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex2.m1.6.6.1.1.1.1.1" xref="A1.Ex2.m1.6.6.1.1.1.1.1.cmml">−</mo><mrow id="A1.Ex2.m1.6.6.1.1.1.1.3" xref="A1.Ex2.m1.6.6.1.1.1.1.3.cmml"><mi id="A1.Ex2.m1.6.6.1.1.1.1.3.2" xref="A1.Ex2.m1.6.6.1.1.1.1.3.2.cmml">β</mi><mo id="A1.Ex2.m1.6.6.1.1.1.1.3.1" lspace="0.167em" xref="A1.Ex2.m1.6.6.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex2.m1.6.6.1.1.1.1.3.3" xref="A1.Ex2.m1.6.6.1.1.1.1.3.3.cmml"><mi id="A1.Ex2.m1.6.6.1.1.1.1.3.3.1" xref="A1.Ex2.m1.6.6.1.1.1.1.3.3.1.cmml">log</mi><mo id="A1.Ex2.m1.6.6.1.1.1.1.3.3a" lspace="0.167em" xref="A1.Ex2.m1.6.6.1.1.1.1.3.3.cmml">⁡</mo><mstyle displaystyle="true" id="A1.Ex2.m1.3.3" xref="A1.Ex2.m1.3.3.cmml"><mfrac id="A1.Ex2.m1.3.3a" xref="A1.Ex2.m1.3.3.cmml"><mrow id="A1.Ex2.m1.2.2.1" xref="A1.Ex2.m1.2.2.1.cmml"><mi id="A1.Ex2.m1.2.2.1.3" xref="A1.Ex2.m1.2.2.1.3.cmml">π</mi><mo id="A1.Ex2.m1.2.2.1.2" xref="A1.Ex2.m1.2.2.1.2.cmml">⁢</mo><mrow id="A1.Ex2.m1.2.2.1.1.1" xref="A1.Ex2.m1.2.2.1.1.1.1.cmml"><mo id="A1.Ex2.m1.2.2.1.1.1.2" stretchy="false" xref="A1.Ex2.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="A1.Ex2.m1.2.2.1.1.1.1" xref="A1.Ex2.m1.2.2.1.1.1.1.cmml"><mi id="A1.Ex2.m1.2.2.1.1.1.1.2" xref="A1.Ex2.m1.2.2.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex2.m1.2.2.1.1.1.1.1" xref="A1.Ex2.m1.2.2.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex2.m1.2.2.1.1.1.1.3" xref="A1.Ex2.m1.2.2.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex2.m1.2.2.1.1.1.3" stretchy="false" xref="A1.Ex2.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex2.m1.3.3.2" xref="A1.Ex2.m1.3.3.2.cmml"><msub id="A1.Ex2.m1.3.3.2.3" xref="A1.Ex2.m1.3.3.2.3.cmml"><mi id="A1.Ex2.m1.3.3.2.3.2" xref="A1.Ex2.m1.3.3.2.3.2.cmml">π</mi><mtext id="A1.Ex2.m1.3.3.2.3.3" xref="A1.Ex2.m1.3.3.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex2.m1.3.3.2.2" xref="A1.Ex2.m1.3.3.2.2.cmml">⁢</mo><mrow id="A1.Ex2.m1.3.3.2.1.1" xref="A1.Ex2.m1.3.3.2.1.1.1.cmml"><mo id="A1.Ex2.m1.3.3.2.1.1.2" stretchy="false" xref="A1.Ex2.m1.3.3.2.1.1.1.cmml">(</mo><mrow id="A1.Ex2.m1.3.3.2.1.1.1" xref="A1.Ex2.m1.3.3.2.1.1.1.cmml"><mi id="A1.Ex2.m1.3.3.2.1.1.1.2" xref="A1.Ex2.m1.3.3.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex2.m1.3.3.2.1.1.1.1" xref="A1.Ex2.m1.3.3.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex2.m1.3.3.2.1.1.1.3" xref="A1.Ex2.m1.3.3.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex2.m1.3.3.2.1.1.3" stretchy="false" xref="A1.Ex2.m1.3.3.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow></mrow></mrow><mo id="A1.Ex2.m1.6.6.1.1.1.3" xref="A1.Ex2.m1.6.6.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex2.m1.6b"><apply id="A1.Ex2.m1.6.6.cmml" xref="A1.Ex2.m1.6.6"><eq id="A1.Ex2.m1.6.6.2.cmml" xref="A1.Ex2.m1.6.6.2"></eq><csymbol cd="latexml" id="A1.Ex2.m1.6.6.3.cmml" xref="A1.Ex2.m1.6.6.3">absent</csymbol><apply id="A1.Ex2.m1.6.6.1.cmml" xref="A1.Ex2.m1.6.6.1"><times id="A1.Ex2.m1.6.6.1.2.cmml" xref="A1.Ex2.m1.6.6.1.2"></times><apply id="A1.Ex2.m1.6.6.1.3.cmml" xref="A1.Ex2.m1.6.6.1.3"><apply id="A1.Ex2.m1.6.6.1.3.1.cmml" xref="A1.Ex2.m1.6.6.1.3.1"><csymbol cd="ambiguous" id="A1.Ex2.m1.6.6.1.3.1.1.cmml" xref="A1.Ex2.m1.6.6.1.3.1">subscript</csymbol><max id="A1.Ex2.m1.6.6.1.3.1.2.cmml" xref="A1.Ex2.m1.6.6.1.3.1.2"></max><ci id="A1.Ex2.m1.6.6.1.3.1.3.cmml" xref="A1.Ex2.m1.6.6.1.3.1.3">𝜋</ci></apply><apply id="A1.Ex2.m1.6.6.1.3.2.cmml" xref="A1.Ex2.m1.6.6.1.3.2"><times id="A1.Ex2.m1.6.6.1.3.2.1.cmml" xref="A1.Ex2.m1.6.6.1.3.2.1"></times><apply id="A1.Ex2.m1.6.6.1.3.2.2.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2"><csymbol cd="ambiguous" id="A1.Ex2.m1.6.6.1.3.2.2.1.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2">subscript</csymbol><ci id="A1.Ex2.m1.6.6.1.3.2.2.2.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2.2">𝔼</ci><apply id="A1.Ex2.m1.6.6.1.3.2.2.3.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2.3"><csymbol cd="latexml" id="A1.Ex2.m1.6.6.1.3.2.2.3.1.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2.3.1">similar-to</csymbol><ci id="A1.Ex2.m1.6.6.1.3.2.2.3.2.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2.3.2">𝑥</ci><ci id="A1.Ex2.m1.6.6.1.3.2.2.3.3.cmml" xref="A1.Ex2.m1.6.6.1.3.2.2.3.3">𝒟</ci></apply></apply><apply id="A1.Ex2.m1.6.6.1.3.2.3.cmml" xref="A1.Ex2.m1.6.6.1.3.2.3"><csymbol cd="ambiguous" id="A1.Ex2.m1.6.6.1.3.2.3.1.cmml" xref="A1.Ex2.m1.6.6.1.3.2.3">subscript</csymbol><ci id="A1.Ex2.m1.6.6.1.3.2.3.2.cmml" xref="A1.Ex2.m1.6.6.1.3.2.3.2">𝔼</ci><apply id="A1.Ex2.m1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1"><csymbol cd="latexml" id="A1.Ex2.m1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.2">similar-to</csymbol><ci id="A1.Ex2.m1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.3">𝑦</ci><apply id="A1.Ex2.m1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1"><times id="A1.Ex2.m1.1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.1.2"></times><ci id="A1.Ex2.m1.1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.1.3">𝜋</ci><apply id="A1.Ex2.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex2.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex2.m1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex2.m1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex2.m1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.Ex2.m1.6.6.1.1.2.cmml" xref="A1.Ex2.m1.6.6.1.1.1"><csymbol cd="latexml" id="A1.Ex2.m1.6.6.1.1.2.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.2">delimited-[]</csymbol><apply id="A1.Ex2.m1.6.6.1.1.1.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1"><minus id="A1.Ex2.m1.6.6.1.1.1.1.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.1"></minus><apply id="A1.Ex2.m1.6.6.1.1.1.1.2.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.2"><times id="A1.Ex2.m1.6.6.1.1.1.1.2.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.2.1"></times><ci id="A1.Ex2.m1.6.6.1.1.1.1.2.2.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.2.2">𝑟</ci><interval closure="open" id="A1.Ex2.m1.6.6.1.1.1.1.2.3.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.2.3.2"><ci id="A1.Ex2.m1.4.4.cmml" xref="A1.Ex2.m1.4.4">𝑥</ci><ci id="A1.Ex2.m1.5.5.cmml" xref="A1.Ex2.m1.5.5">𝑦</ci></interval></apply><apply id="A1.Ex2.m1.6.6.1.1.1.1.3.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.3"><times id="A1.Ex2.m1.6.6.1.1.1.1.3.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.3.1"></times><ci id="A1.Ex2.m1.6.6.1.1.1.1.3.2.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.3.2">𝛽</ci><apply id="A1.Ex2.m1.6.6.1.1.1.1.3.3.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.3.3"><log id="A1.Ex2.m1.6.6.1.1.1.1.3.3.1.cmml" xref="A1.Ex2.m1.6.6.1.1.1.1.3.3.1"></log><apply id="A1.Ex2.m1.3.3.cmml" xref="A1.Ex2.m1.3.3"><divide id="A1.Ex2.m1.3.3.3.cmml" xref="A1.Ex2.m1.3.3"></divide><apply id="A1.Ex2.m1.2.2.1.cmml" xref="A1.Ex2.m1.2.2.1"><times id="A1.Ex2.m1.2.2.1.2.cmml" xref="A1.Ex2.m1.2.2.1.2"></times><ci id="A1.Ex2.m1.2.2.1.3.cmml" xref="A1.Ex2.m1.2.2.1.3">𝜋</ci><apply id="A1.Ex2.m1.2.2.1.1.1.1.cmml" xref="A1.Ex2.m1.2.2.1.1.1"><csymbol cd="latexml" id="A1.Ex2.m1.2.2.1.1.1.1.1.cmml" xref="A1.Ex2.m1.2.2.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex2.m1.2.2.1.1.1.1.2.cmml" xref="A1.Ex2.m1.2.2.1.1.1.1.2">𝑦</ci><ci id="A1.Ex2.m1.2.2.1.1.1.1.3.cmml" xref="A1.Ex2.m1.2.2.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex2.m1.3.3.2.cmml" xref="A1.Ex2.m1.3.3.2"><times id="A1.Ex2.m1.3.3.2.2.cmml" xref="A1.Ex2.m1.3.3.2.2"></times><apply id="A1.Ex2.m1.3.3.2.3.cmml" xref="A1.Ex2.m1.3.3.2.3"><csymbol cd="ambiguous" id="A1.Ex2.m1.3.3.2.3.1.cmml" xref="A1.Ex2.m1.3.3.2.3">subscript</csymbol><ci id="A1.Ex2.m1.3.3.2.3.2.cmml" xref="A1.Ex2.m1.3.3.2.3.2">𝜋</ci><ci id="A1.Ex2.m1.3.3.2.3.3a.cmml" xref="A1.Ex2.m1.3.3.2.3.3"><mtext id="A1.Ex2.m1.3.3.2.3.3.cmml" mathsize="70%" xref="A1.Ex2.m1.3.3.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex2.m1.3.3.2.1.1.1.cmml" xref="A1.Ex2.m1.3.3.2.1.1"><csymbol cd="latexml" id="A1.Ex2.m1.3.3.2.1.1.1.1.cmml" xref="A1.Ex2.m1.3.3.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex2.m1.3.3.2.1.1.1.2.cmml" xref="A1.Ex2.m1.3.3.2.1.1.1.2">𝑦</ci><ci id="A1.Ex2.m1.3.3.2.1.1.1.3.cmml" xref="A1.Ex2.m1.3.3.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex2.m1.6c">\displaystyle=\max_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\mathbb{E}_{y\sim\pi(y|x)%
}\left[r(x,y)-\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}\right]</annotation><annotation encoding="application/x-llamapun" id="A1.Ex2.m1.6d">= roman_max start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y ∼ italic_π ( italic_y | italic_x ) end_POSTSUBSCRIPT [ italic_r ( italic_x , italic_y ) - italic_β roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex3"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\mathbb{E}_{y\sim\pi(y|x)%
}\left[\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}-\frac{1}{\beta}r(x,y)\right]" class="ltx_Math" display="inline" id="A1.Ex3.m1.6"><semantics id="A1.Ex3.m1.6a"><mrow id="A1.Ex3.m1.6.6" xref="A1.Ex3.m1.6.6.cmml"><mi id="A1.Ex3.m1.6.6.3" xref="A1.Ex3.m1.6.6.3.cmml"></mi><mo id="A1.Ex3.m1.6.6.2" xref="A1.Ex3.m1.6.6.2.cmml">=</mo><mrow id="A1.Ex3.m1.6.6.1" xref="A1.Ex3.m1.6.6.1.cmml"><mrow id="A1.Ex3.m1.6.6.1.3" xref="A1.Ex3.m1.6.6.1.3.cmml"><munder id="A1.Ex3.m1.6.6.1.3.1" xref="A1.Ex3.m1.6.6.1.3.1.cmml"><mi id="A1.Ex3.m1.6.6.1.3.1.2" xref="A1.Ex3.m1.6.6.1.3.1.2.cmml">min</mi><mi id="A1.Ex3.m1.6.6.1.3.1.3" xref="A1.Ex3.m1.6.6.1.3.1.3.cmml">π</mi></munder><mo id="A1.Ex3.m1.6.6.1.3a" lspace="0.167em" xref="A1.Ex3.m1.6.6.1.3.cmml">⁡</mo><mrow id="A1.Ex3.m1.6.6.1.3.2" xref="A1.Ex3.m1.6.6.1.3.2.cmml"><msub id="A1.Ex3.m1.6.6.1.3.2.2" xref="A1.Ex3.m1.6.6.1.3.2.2.cmml"><mi id="A1.Ex3.m1.6.6.1.3.2.2.2" xref="A1.Ex3.m1.6.6.1.3.2.2.2.cmml">𝔼</mi><mrow id="A1.Ex3.m1.6.6.1.3.2.2.3" xref="A1.Ex3.m1.6.6.1.3.2.2.3.cmml"><mi id="A1.Ex3.m1.6.6.1.3.2.2.3.2" xref="A1.Ex3.m1.6.6.1.3.2.2.3.2.cmml">x</mi><mo id="A1.Ex3.m1.6.6.1.3.2.2.3.1" xref="A1.Ex3.m1.6.6.1.3.2.2.3.1.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.Ex3.m1.6.6.1.3.2.2.3.3" xref="A1.Ex3.m1.6.6.1.3.2.2.3.3.cmml">𝒟</mi></mrow></msub><mo id="A1.Ex3.m1.6.6.1.3.2.1" xref="A1.Ex3.m1.6.6.1.3.2.1.cmml">⁢</mo><msub id="A1.Ex3.m1.6.6.1.3.2.3" xref="A1.Ex3.m1.6.6.1.3.2.3.cmml"><mi id="A1.Ex3.m1.6.6.1.3.2.3.2" xref="A1.Ex3.m1.6.6.1.3.2.3.2.cmml">𝔼</mi><mrow id="A1.Ex3.m1.1.1.1" xref="A1.Ex3.m1.1.1.1.cmml"><mi id="A1.Ex3.m1.1.1.1.3" xref="A1.Ex3.m1.1.1.1.3.cmml">y</mi><mo id="A1.Ex3.m1.1.1.1.2" xref="A1.Ex3.m1.1.1.1.2.cmml">∼</mo><mrow id="A1.Ex3.m1.1.1.1.1" xref="A1.Ex3.m1.1.1.1.1.cmml"><mi id="A1.Ex3.m1.1.1.1.1.3" xref="A1.Ex3.m1.1.1.1.1.3.cmml">π</mi><mo id="A1.Ex3.m1.1.1.1.1.2" xref="A1.Ex3.m1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex3.m1.1.1.1.1.1.1" xref="A1.Ex3.m1.1.1.1.1.1.1.1.cmml"><mo id="A1.Ex3.m1.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex3.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex3.m1.1.1.1.1.1.1.1" xref="A1.Ex3.m1.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex3.m1.1.1.1.1.1.1.1.2" xref="A1.Ex3.m1.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex3.m1.1.1.1.1.1.1.1.1" xref="A1.Ex3.m1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex3.m1.1.1.1.1.1.1.1.3" xref="A1.Ex3.m1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex3.m1.1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex3.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></msub></mrow></mrow><mo id="A1.Ex3.m1.6.6.1.2" xref="A1.Ex3.m1.6.6.1.2.cmml">⁢</mo><mrow id="A1.Ex3.m1.6.6.1.1.1" xref="A1.Ex3.m1.6.6.1.1.2.cmml"><mo id="A1.Ex3.m1.6.6.1.1.1.2" xref="A1.Ex3.m1.6.6.1.1.2.1.cmml">[</mo><mrow id="A1.Ex3.m1.6.6.1.1.1.1" xref="A1.Ex3.m1.6.6.1.1.1.1.cmml"><mrow id="A1.Ex3.m1.6.6.1.1.1.1.2" xref="A1.Ex3.m1.6.6.1.1.1.1.2.cmml"><mi id="A1.Ex3.m1.6.6.1.1.1.1.2.1" xref="A1.Ex3.m1.6.6.1.1.1.1.2.1.cmml">log</mi><mo id="A1.Ex3.m1.6.6.1.1.1.1.2a" lspace="0.167em" xref="A1.Ex3.m1.6.6.1.1.1.1.2.cmml">⁡</mo><mstyle displaystyle="true" id="A1.Ex3.m1.3.3" xref="A1.Ex3.m1.3.3.cmml"><mfrac id="A1.Ex3.m1.3.3a" xref="A1.Ex3.m1.3.3.cmml"><mrow id="A1.Ex3.m1.2.2.1" xref="A1.Ex3.m1.2.2.1.cmml"><mi id="A1.Ex3.m1.2.2.1.3" xref="A1.Ex3.m1.2.2.1.3.cmml">π</mi><mo id="A1.Ex3.m1.2.2.1.2" xref="A1.Ex3.m1.2.2.1.2.cmml">⁢</mo><mrow id="A1.Ex3.m1.2.2.1.1.1" xref="A1.Ex3.m1.2.2.1.1.1.1.cmml"><mo id="A1.Ex3.m1.2.2.1.1.1.2" stretchy="false" xref="A1.Ex3.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="A1.Ex3.m1.2.2.1.1.1.1" xref="A1.Ex3.m1.2.2.1.1.1.1.cmml"><mi id="A1.Ex3.m1.2.2.1.1.1.1.2" xref="A1.Ex3.m1.2.2.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex3.m1.2.2.1.1.1.1.1" xref="A1.Ex3.m1.2.2.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex3.m1.2.2.1.1.1.1.3" xref="A1.Ex3.m1.2.2.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex3.m1.2.2.1.1.1.3" stretchy="false" xref="A1.Ex3.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex3.m1.3.3.2" xref="A1.Ex3.m1.3.3.2.cmml"><msub id="A1.Ex3.m1.3.3.2.3" xref="A1.Ex3.m1.3.3.2.3.cmml"><mi id="A1.Ex3.m1.3.3.2.3.2" xref="A1.Ex3.m1.3.3.2.3.2.cmml">π</mi><mtext id="A1.Ex3.m1.3.3.2.3.3" xref="A1.Ex3.m1.3.3.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex3.m1.3.3.2.2" xref="A1.Ex3.m1.3.3.2.2.cmml">⁢</mo><mrow id="A1.Ex3.m1.3.3.2.1.1" xref="A1.Ex3.m1.3.3.2.1.1.1.cmml"><mo id="A1.Ex3.m1.3.3.2.1.1.2" stretchy="false" xref="A1.Ex3.m1.3.3.2.1.1.1.cmml">(</mo><mrow id="A1.Ex3.m1.3.3.2.1.1.1" xref="A1.Ex3.m1.3.3.2.1.1.1.cmml"><mi id="A1.Ex3.m1.3.3.2.1.1.1.2" xref="A1.Ex3.m1.3.3.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex3.m1.3.3.2.1.1.1.1" xref="A1.Ex3.m1.3.3.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex3.m1.3.3.2.1.1.1.3" xref="A1.Ex3.m1.3.3.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex3.m1.3.3.2.1.1.3" stretchy="false" xref="A1.Ex3.m1.3.3.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow><mo id="A1.Ex3.m1.6.6.1.1.1.1.1" xref="A1.Ex3.m1.6.6.1.1.1.1.1.cmml">−</mo><mrow id="A1.Ex3.m1.6.6.1.1.1.1.3" xref="A1.Ex3.m1.6.6.1.1.1.1.3.cmml"><mstyle displaystyle="true" id="A1.Ex3.m1.6.6.1.1.1.1.3.2" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2.cmml"><mfrac id="A1.Ex3.m1.6.6.1.1.1.1.3.2a" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2.cmml"><mn id="A1.Ex3.m1.6.6.1.1.1.1.3.2.2" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2.2.cmml">1</mn><mi id="A1.Ex3.m1.6.6.1.1.1.1.3.2.3" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2.3.cmml">β</mi></mfrac></mstyle><mo id="A1.Ex3.m1.6.6.1.1.1.1.3.1" xref="A1.Ex3.m1.6.6.1.1.1.1.3.1.cmml">⁢</mo><mi id="A1.Ex3.m1.6.6.1.1.1.1.3.3" xref="A1.Ex3.m1.6.6.1.1.1.1.3.3.cmml">r</mi><mo id="A1.Ex3.m1.6.6.1.1.1.1.3.1a" xref="A1.Ex3.m1.6.6.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex3.m1.6.6.1.1.1.1.3.4.2" xref="A1.Ex3.m1.6.6.1.1.1.1.3.4.1.cmml"><mo id="A1.Ex3.m1.6.6.1.1.1.1.3.4.2.1" stretchy="false" xref="A1.Ex3.m1.6.6.1.1.1.1.3.4.1.cmml">(</mo><mi id="A1.Ex3.m1.4.4" xref="A1.Ex3.m1.4.4.cmml">x</mi><mo id="A1.Ex3.m1.6.6.1.1.1.1.3.4.2.2" xref="A1.Ex3.m1.6.6.1.1.1.1.3.4.1.cmml">,</mo><mi id="A1.Ex3.m1.5.5" xref="A1.Ex3.m1.5.5.cmml">y</mi><mo id="A1.Ex3.m1.6.6.1.1.1.1.3.4.2.3" stretchy="false" xref="A1.Ex3.m1.6.6.1.1.1.1.3.4.1.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex3.m1.6.6.1.1.1.3" xref="A1.Ex3.m1.6.6.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex3.m1.6b"><apply id="A1.Ex3.m1.6.6.cmml" xref="A1.Ex3.m1.6.6"><eq id="A1.Ex3.m1.6.6.2.cmml" xref="A1.Ex3.m1.6.6.2"></eq><csymbol cd="latexml" id="A1.Ex3.m1.6.6.3.cmml" xref="A1.Ex3.m1.6.6.3">absent</csymbol><apply id="A1.Ex3.m1.6.6.1.cmml" xref="A1.Ex3.m1.6.6.1"><times id="A1.Ex3.m1.6.6.1.2.cmml" xref="A1.Ex3.m1.6.6.1.2"></times><apply id="A1.Ex3.m1.6.6.1.3.cmml" xref="A1.Ex3.m1.6.6.1.3"><apply id="A1.Ex3.m1.6.6.1.3.1.cmml" xref="A1.Ex3.m1.6.6.1.3.1"><csymbol cd="ambiguous" id="A1.Ex3.m1.6.6.1.3.1.1.cmml" xref="A1.Ex3.m1.6.6.1.3.1">subscript</csymbol><min id="A1.Ex3.m1.6.6.1.3.1.2.cmml" xref="A1.Ex3.m1.6.6.1.3.1.2"></min><ci id="A1.Ex3.m1.6.6.1.3.1.3.cmml" xref="A1.Ex3.m1.6.6.1.3.1.3">𝜋</ci></apply><apply id="A1.Ex3.m1.6.6.1.3.2.cmml" xref="A1.Ex3.m1.6.6.1.3.2"><times id="A1.Ex3.m1.6.6.1.3.2.1.cmml" xref="A1.Ex3.m1.6.6.1.3.2.1"></times><apply id="A1.Ex3.m1.6.6.1.3.2.2.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2"><csymbol cd="ambiguous" id="A1.Ex3.m1.6.6.1.3.2.2.1.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2">subscript</csymbol><ci id="A1.Ex3.m1.6.6.1.3.2.2.2.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2.2">𝔼</ci><apply id="A1.Ex3.m1.6.6.1.3.2.2.3.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2.3"><csymbol cd="latexml" id="A1.Ex3.m1.6.6.1.3.2.2.3.1.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2.3.1">similar-to</csymbol><ci id="A1.Ex3.m1.6.6.1.3.2.2.3.2.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2.3.2">𝑥</ci><ci id="A1.Ex3.m1.6.6.1.3.2.2.3.3.cmml" xref="A1.Ex3.m1.6.6.1.3.2.2.3.3">𝒟</ci></apply></apply><apply id="A1.Ex3.m1.6.6.1.3.2.3.cmml" xref="A1.Ex3.m1.6.6.1.3.2.3"><csymbol cd="ambiguous" id="A1.Ex3.m1.6.6.1.3.2.3.1.cmml" xref="A1.Ex3.m1.6.6.1.3.2.3">subscript</csymbol><ci id="A1.Ex3.m1.6.6.1.3.2.3.2.cmml" xref="A1.Ex3.m1.6.6.1.3.2.3.2">𝔼</ci><apply id="A1.Ex3.m1.1.1.1.cmml" xref="A1.Ex3.m1.1.1.1"><csymbol cd="latexml" id="A1.Ex3.m1.1.1.1.2.cmml" xref="A1.Ex3.m1.1.1.1.2">similar-to</csymbol><ci id="A1.Ex3.m1.1.1.1.3.cmml" xref="A1.Ex3.m1.1.1.1.3">𝑦</ci><apply id="A1.Ex3.m1.1.1.1.1.cmml" xref="A1.Ex3.m1.1.1.1.1"><times id="A1.Ex3.m1.1.1.1.1.2.cmml" xref="A1.Ex3.m1.1.1.1.1.2"></times><ci id="A1.Ex3.m1.1.1.1.1.3.cmml" xref="A1.Ex3.m1.1.1.1.1.3">𝜋</ci><apply id="A1.Ex3.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex3.m1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex3.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex3.m1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex3.m1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex3.m1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex3.m1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex3.m1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.Ex3.m1.6.6.1.1.2.cmml" xref="A1.Ex3.m1.6.6.1.1.1"><csymbol cd="latexml" id="A1.Ex3.m1.6.6.1.1.2.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.2">delimited-[]</csymbol><apply id="A1.Ex3.m1.6.6.1.1.1.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1"><minus id="A1.Ex3.m1.6.6.1.1.1.1.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.1"></minus><apply id="A1.Ex3.m1.6.6.1.1.1.1.2.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.2"><log id="A1.Ex3.m1.6.6.1.1.1.1.2.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.2.1"></log><apply id="A1.Ex3.m1.3.3.cmml" xref="A1.Ex3.m1.3.3"><divide id="A1.Ex3.m1.3.3.3.cmml" xref="A1.Ex3.m1.3.3"></divide><apply id="A1.Ex3.m1.2.2.1.cmml" xref="A1.Ex3.m1.2.2.1"><times id="A1.Ex3.m1.2.2.1.2.cmml" xref="A1.Ex3.m1.2.2.1.2"></times><ci id="A1.Ex3.m1.2.2.1.3.cmml" xref="A1.Ex3.m1.2.2.1.3">𝜋</ci><apply id="A1.Ex3.m1.2.2.1.1.1.1.cmml" xref="A1.Ex3.m1.2.2.1.1.1"><csymbol cd="latexml" id="A1.Ex3.m1.2.2.1.1.1.1.1.cmml" xref="A1.Ex3.m1.2.2.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex3.m1.2.2.1.1.1.1.2.cmml" xref="A1.Ex3.m1.2.2.1.1.1.1.2">𝑦</ci><ci id="A1.Ex3.m1.2.2.1.1.1.1.3.cmml" xref="A1.Ex3.m1.2.2.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex3.m1.3.3.2.cmml" xref="A1.Ex3.m1.3.3.2"><times id="A1.Ex3.m1.3.3.2.2.cmml" xref="A1.Ex3.m1.3.3.2.2"></times><apply id="A1.Ex3.m1.3.3.2.3.cmml" xref="A1.Ex3.m1.3.3.2.3"><csymbol cd="ambiguous" id="A1.Ex3.m1.3.3.2.3.1.cmml" xref="A1.Ex3.m1.3.3.2.3">subscript</csymbol><ci id="A1.Ex3.m1.3.3.2.3.2.cmml" xref="A1.Ex3.m1.3.3.2.3.2">𝜋</ci><ci id="A1.Ex3.m1.3.3.2.3.3a.cmml" xref="A1.Ex3.m1.3.3.2.3.3"><mtext id="A1.Ex3.m1.3.3.2.3.3.cmml" mathsize="70%" xref="A1.Ex3.m1.3.3.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex3.m1.3.3.2.1.1.1.cmml" xref="A1.Ex3.m1.3.3.2.1.1"><csymbol cd="latexml" id="A1.Ex3.m1.3.3.2.1.1.1.1.cmml" xref="A1.Ex3.m1.3.3.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex3.m1.3.3.2.1.1.1.2.cmml" xref="A1.Ex3.m1.3.3.2.1.1.1.2">𝑦</ci><ci id="A1.Ex3.m1.3.3.2.1.1.1.3.cmml" xref="A1.Ex3.m1.3.3.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply><apply id="A1.Ex3.m1.6.6.1.1.1.1.3.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3"><times id="A1.Ex3.m1.6.6.1.1.1.1.3.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3.1"></times><apply id="A1.Ex3.m1.6.6.1.1.1.1.3.2.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2"><divide id="A1.Ex3.m1.6.6.1.1.1.1.3.2.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2"></divide><cn id="A1.Ex3.m1.6.6.1.1.1.1.3.2.2.cmml" type="integer" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2.2">1</cn><ci id="A1.Ex3.m1.6.6.1.1.1.1.3.2.3.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3.2.3">𝛽</ci></apply><ci id="A1.Ex3.m1.6.6.1.1.1.1.3.3.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3.3">𝑟</ci><interval closure="open" id="A1.Ex3.m1.6.6.1.1.1.1.3.4.1.cmml" xref="A1.Ex3.m1.6.6.1.1.1.1.3.4.2"><ci id="A1.Ex3.m1.4.4.cmml" xref="A1.Ex3.m1.4.4">𝑥</ci><ci id="A1.Ex3.m1.5.5.cmml" xref="A1.Ex3.m1.5.5">𝑦</ci></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex3.m1.6c">\displaystyle=\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\mathbb{E}_{y\sim\pi(y|x)%
}\left[\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}-\frac{1}{\beta}r(x,y)\right]</annotation><annotation encoding="application/x-llamapun" id="A1.Ex3.m1.6d">= roman_min start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y ∼ italic_π ( italic_y | italic_x ) end_POSTSUBSCRIPT [ roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG - divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.E12"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\mathbb{E}_{y\sim\pi(y|x)%
}\left[\log\frac{\pi(y|x)}{\frac{1}{Z(x)}\pi_{\text{ref}}(y|x)\exp\left(\frac{%
1}{\beta}r(x,y)\right)}-\log Z(x)\right]" class="ltx_Math" display="inline" id="A1.E12.m1.10"><semantics id="A1.E12.m1.10a"><mrow id="A1.E12.m1.10.10" xref="A1.E12.m1.10.10.cmml"><mi id="A1.E12.m1.10.10.3" xref="A1.E12.m1.10.10.3.cmml"></mi><mo id="A1.E12.m1.10.10.2" xref="A1.E12.m1.10.10.2.cmml">=</mo><mrow id="A1.E12.m1.10.10.1" xref="A1.E12.m1.10.10.1.cmml"><mrow id="A1.E12.m1.10.10.1.3" xref="A1.E12.m1.10.10.1.3.cmml"><munder id="A1.E12.m1.10.10.1.3.1" xref="A1.E12.m1.10.10.1.3.1.cmml"><mi id="A1.E12.m1.10.10.1.3.1.2" xref="A1.E12.m1.10.10.1.3.1.2.cmml">min</mi><mi id="A1.E12.m1.10.10.1.3.1.3" xref="A1.E12.m1.10.10.1.3.1.3.cmml">π</mi></munder><mo id="A1.E12.m1.10.10.1.3a" lspace="0.167em" xref="A1.E12.m1.10.10.1.3.cmml">⁡</mo><mrow id="A1.E12.m1.10.10.1.3.2" xref="A1.E12.m1.10.10.1.3.2.cmml"><msub id="A1.E12.m1.10.10.1.3.2.2" xref="A1.E12.m1.10.10.1.3.2.2.cmml"><mi id="A1.E12.m1.10.10.1.3.2.2.2" xref="A1.E12.m1.10.10.1.3.2.2.2.cmml">𝔼</mi><mrow id="A1.E12.m1.10.10.1.3.2.2.3" xref="A1.E12.m1.10.10.1.3.2.2.3.cmml"><mi id="A1.E12.m1.10.10.1.3.2.2.3.2" xref="A1.E12.m1.10.10.1.3.2.2.3.2.cmml">x</mi><mo id="A1.E12.m1.10.10.1.3.2.2.3.1" xref="A1.E12.m1.10.10.1.3.2.2.3.1.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E12.m1.10.10.1.3.2.2.3.3" xref="A1.E12.m1.10.10.1.3.2.2.3.3.cmml">𝒟</mi></mrow></msub><mo id="A1.E12.m1.10.10.1.3.2.1" xref="A1.E12.m1.10.10.1.3.2.1.cmml">⁢</mo><msub id="A1.E12.m1.10.10.1.3.2.3" xref="A1.E12.m1.10.10.1.3.2.3.cmml"><mi id="A1.E12.m1.10.10.1.3.2.3.2" xref="A1.E12.m1.10.10.1.3.2.3.2.cmml">𝔼</mi><mrow id="A1.E12.m1.1.1.1" xref="A1.E12.m1.1.1.1.cmml"><mi id="A1.E12.m1.1.1.1.3" xref="A1.E12.m1.1.1.1.3.cmml">y</mi><mo id="A1.E12.m1.1.1.1.2" xref="A1.E12.m1.1.1.1.2.cmml">∼</mo><mrow id="A1.E12.m1.1.1.1.1" xref="A1.E12.m1.1.1.1.1.cmml"><mi id="A1.E12.m1.1.1.1.1.3" xref="A1.E12.m1.1.1.1.1.3.cmml">π</mi><mo id="A1.E12.m1.1.1.1.1.2" xref="A1.E12.m1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.1.1.1.1.1.1" xref="A1.E12.m1.1.1.1.1.1.1.1.cmml"><mo id="A1.E12.m1.1.1.1.1.1.1.2" stretchy="false" xref="A1.E12.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E12.m1.1.1.1.1.1.1.1" xref="A1.E12.m1.1.1.1.1.1.1.1.cmml"><mi id="A1.E12.m1.1.1.1.1.1.1.1.2" xref="A1.E12.m1.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E12.m1.1.1.1.1.1.1.1.1" xref="A1.E12.m1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.E12.m1.1.1.1.1.1.1.1.3" xref="A1.E12.m1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E12.m1.1.1.1.1.1.1.3" stretchy="false" xref="A1.E12.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></msub></mrow></mrow><mo id="A1.E12.m1.10.10.1.2" xref="A1.E12.m1.10.10.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.10.10.1.1.1" xref="A1.E12.m1.10.10.1.1.2.cmml"><mo id="A1.E12.m1.10.10.1.1.1.2" xref="A1.E12.m1.10.10.1.1.2.1.cmml">[</mo><mrow id="A1.E12.m1.10.10.1.1.1.1" xref="A1.E12.m1.10.10.1.1.1.1.cmml"><mrow id="A1.E12.m1.10.10.1.1.1.1.2" xref="A1.E12.m1.10.10.1.1.1.1.2.cmml"><mi id="A1.E12.m1.10.10.1.1.1.1.2.1" xref="A1.E12.m1.10.10.1.1.1.1.2.1.cmml">log</mi><mo id="A1.E12.m1.10.10.1.1.1.1.2a" lspace="0.167em" xref="A1.E12.m1.10.10.1.1.1.1.2.cmml">⁡</mo><mstyle displaystyle="true" id="A1.E12.m1.8.8" xref="A1.E12.m1.8.8.cmml"><mfrac id="A1.E12.m1.8.8a" xref="A1.E12.m1.8.8.cmml"><mrow id="A1.E12.m1.2.2.1" xref="A1.E12.m1.2.2.1.cmml"><mi id="A1.E12.m1.2.2.1.3" xref="A1.E12.m1.2.2.1.3.cmml">π</mi><mo id="A1.E12.m1.2.2.1.2" xref="A1.E12.m1.2.2.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.2.2.1.1.1" xref="A1.E12.m1.2.2.1.1.1.1.cmml"><mo id="A1.E12.m1.2.2.1.1.1.2" stretchy="false" xref="A1.E12.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="A1.E12.m1.2.2.1.1.1.1" xref="A1.E12.m1.2.2.1.1.1.1.cmml"><mi id="A1.E12.m1.2.2.1.1.1.1.2" xref="A1.E12.m1.2.2.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E12.m1.2.2.1.1.1.1.1" xref="A1.E12.m1.2.2.1.1.1.1.1.cmml">|</mo><mi id="A1.E12.m1.2.2.1.1.1.1.3" xref="A1.E12.m1.2.2.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E12.m1.2.2.1.1.1.3" stretchy="false" xref="A1.E12.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E12.m1.8.8.7" xref="A1.E12.m1.8.8.7.cmml"><mfrac id="A1.E12.m1.3.3.2.1" xref="A1.E12.m1.3.3.2.1.cmml"><mn id="A1.E12.m1.3.3.2.1.3" xref="A1.E12.m1.3.3.2.1.3.cmml">1</mn><mrow id="A1.E12.m1.3.3.2.1.1" xref="A1.E12.m1.3.3.2.1.1.cmml"><mi id="A1.E12.m1.3.3.2.1.1.3" xref="A1.E12.m1.3.3.2.1.1.3.cmml">Z</mi><mo id="A1.E12.m1.3.3.2.1.1.2" xref="A1.E12.m1.3.3.2.1.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.3.3.2.1.1.4.2" xref="A1.E12.m1.3.3.2.1.1.cmml"><mo id="A1.E12.m1.3.3.2.1.1.4.2.1" stretchy="false" xref="A1.E12.m1.3.3.2.1.1.cmml">(</mo><mi id="A1.E12.m1.3.3.2.1.1.1" xref="A1.E12.m1.3.3.2.1.1.1.cmml">x</mi><mo id="A1.E12.m1.3.3.2.1.1.4.2.2" stretchy="false" xref="A1.E12.m1.3.3.2.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="A1.E12.m1.8.8.7.7" xref="A1.E12.m1.8.8.7.7.cmml">⁢</mo><msub id="A1.E12.m1.8.8.7.8" xref="A1.E12.m1.8.8.7.8.cmml"><mi id="A1.E12.m1.8.8.7.8.2" xref="A1.E12.m1.8.8.7.8.2.cmml">π</mi><mtext id="A1.E12.m1.8.8.7.8.3" xref="A1.E12.m1.8.8.7.8.3a.cmml">ref</mtext></msub><mo id="A1.E12.m1.8.8.7.7a" xref="A1.E12.m1.8.8.7.7.cmml">⁢</mo><mrow id="A1.E12.m1.7.7.6.5.1" xref="A1.E12.m1.7.7.6.5.1.1.cmml"><mo id="A1.E12.m1.7.7.6.5.1.2" stretchy="false" xref="A1.E12.m1.7.7.6.5.1.1.cmml">(</mo><mrow id="A1.E12.m1.7.7.6.5.1.1" xref="A1.E12.m1.7.7.6.5.1.1.cmml"><mi id="A1.E12.m1.7.7.6.5.1.1.2" xref="A1.E12.m1.7.7.6.5.1.1.2.cmml">y</mi><mo fence="false" id="A1.E12.m1.7.7.6.5.1.1.1" xref="A1.E12.m1.7.7.6.5.1.1.1.cmml">|</mo><mi id="A1.E12.m1.7.7.6.5.1.1.3" xref="A1.E12.m1.7.7.6.5.1.1.3.cmml">x</mi></mrow><mo id="A1.E12.m1.7.7.6.5.1.3" stretchy="false" xref="A1.E12.m1.7.7.6.5.1.1.cmml">)</mo></mrow><mo id="A1.E12.m1.8.8.7.7b" lspace="0.167em" xref="A1.E12.m1.8.8.7.7.cmml">⁢</mo><mrow id="A1.E12.m1.8.8.7.6.1" xref="A1.E12.m1.8.8.7.6.2.cmml"><mi id="A1.E12.m1.6.6.5.4" xref="A1.E12.m1.6.6.5.4.cmml">exp</mi><mo id="A1.E12.m1.8.8.7.6.1a" xref="A1.E12.m1.8.8.7.6.2.cmml">⁡</mo><mrow id="A1.E12.m1.8.8.7.6.1.1" xref="A1.E12.m1.8.8.7.6.2.cmml"><mo id="A1.E12.m1.8.8.7.6.1.1.2" xref="A1.E12.m1.8.8.7.6.2.cmml">(</mo><mrow id="A1.E12.m1.8.8.7.6.1.1.1" xref="A1.E12.m1.8.8.7.6.1.1.1.cmml"><mfrac id="A1.E12.m1.8.8.7.6.1.1.1.2" xref="A1.E12.m1.8.8.7.6.1.1.1.2.cmml"><mn id="A1.E12.m1.8.8.7.6.1.1.1.2.2" xref="A1.E12.m1.8.8.7.6.1.1.1.2.2.cmml">1</mn><mi id="A1.E12.m1.8.8.7.6.1.1.1.2.3" xref="A1.E12.m1.8.8.7.6.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.E12.m1.8.8.7.6.1.1.1.1" xref="A1.E12.m1.8.8.7.6.1.1.1.1.cmml">⁢</mo><mi id="A1.E12.m1.8.8.7.6.1.1.1.3" xref="A1.E12.m1.8.8.7.6.1.1.1.3.cmml">r</mi><mo id="A1.E12.m1.8.8.7.6.1.1.1.1a" xref="A1.E12.m1.8.8.7.6.1.1.1.1.cmml">⁢</mo><mrow id="A1.E12.m1.8.8.7.6.1.1.1.4.2" xref="A1.E12.m1.8.8.7.6.1.1.1.4.1.cmml"><mo id="A1.E12.m1.8.8.7.6.1.1.1.4.2.1" stretchy="false" xref="A1.E12.m1.8.8.7.6.1.1.1.4.1.cmml">(</mo><mi id="A1.E12.m1.4.4.3.2" xref="A1.E12.m1.4.4.3.2.cmml">x</mi><mo id="A1.E12.m1.8.8.7.6.1.1.1.4.2.2" xref="A1.E12.m1.8.8.7.6.1.1.1.4.1.cmml">,</mo><mi id="A1.E12.m1.5.5.4.3" xref="A1.E12.m1.5.5.4.3.cmml">y</mi><mo id="A1.E12.m1.8.8.7.6.1.1.1.4.2.3" stretchy="false" xref="A1.E12.m1.8.8.7.6.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.E12.m1.8.8.7.6.1.1.3" xref="A1.E12.m1.8.8.7.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow><mo id="A1.E12.m1.10.10.1.1.1.1.1" xref="A1.E12.m1.10.10.1.1.1.1.1.cmml">−</mo><mrow id="A1.E12.m1.10.10.1.1.1.1.3" xref="A1.E12.m1.10.10.1.1.1.1.3.cmml"><mrow id="A1.E12.m1.10.10.1.1.1.1.3.2" xref="A1.E12.m1.10.10.1.1.1.1.3.2.cmml"><mi id="A1.E12.m1.10.10.1.1.1.1.3.2.1" xref="A1.E12.m1.10.10.1.1.1.1.3.2.1.cmml">log</mi><mo id="A1.E12.m1.10.10.1.1.1.1.3.2a" lspace="0.167em" xref="A1.E12.m1.10.10.1.1.1.1.3.2.cmml">⁡</mo><mi id="A1.E12.m1.10.10.1.1.1.1.3.2.2" xref="A1.E12.m1.10.10.1.1.1.1.3.2.2.cmml">Z</mi></mrow><mo id="A1.E12.m1.10.10.1.1.1.1.3.1" xref="A1.E12.m1.10.10.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.E12.m1.10.10.1.1.1.1.3.3.2" xref="A1.E12.m1.10.10.1.1.1.1.3.cmml"><mo id="A1.E12.m1.10.10.1.1.1.1.3.3.2.1" stretchy="false" xref="A1.E12.m1.10.10.1.1.1.1.3.cmml">(</mo><mi id="A1.E12.m1.9.9" xref="A1.E12.m1.9.9.cmml">x</mi><mo id="A1.E12.m1.10.10.1.1.1.1.3.3.2.2" stretchy="false" xref="A1.E12.m1.10.10.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.E12.m1.10.10.1.1.1.3" xref="A1.E12.m1.10.10.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E12.m1.10b"><apply id="A1.E12.m1.10.10.cmml" xref="A1.E12.m1.10.10"><eq id="A1.E12.m1.10.10.2.cmml" xref="A1.E12.m1.10.10.2"></eq><csymbol cd="latexml" id="A1.E12.m1.10.10.3.cmml" xref="A1.E12.m1.10.10.3">absent</csymbol><apply id="A1.E12.m1.10.10.1.cmml" xref="A1.E12.m1.10.10.1"><times id="A1.E12.m1.10.10.1.2.cmml" xref="A1.E12.m1.10.10.1.2"></times><apply id="A1.E12.m1.10.10.1.3.cmml" xref="A1.E12.m1.10.10.1.3"><apply id="A1.E12.m1.10.10.1.3.1.cmml" xref="A1.E12.m1.10.10.1.3.1"><csymbol cd="ambiguous" id="A1.E12.m1.10.10.1.3.1.1.cmml" xref="A1.E12.m1.10.10.1.3.1">subscript</csymbol><min id="A1.E12.m1.10.10.1.3.1.2.cmml" xref="A1.E12.m1.10.10.1.3.1.2"></min><ci id="A1.E12.m1.10.10.1.3.1.3.cmml" xref="A1.E12.m1.10.10.1.3.1.3">𝜋</ci></apply><apply id="A1.E12.m1.10.10.1.3.2.cmml" xref="A1.E12.m1.10.10.1.3.2"><times id="A1.E12.m1.10.10.1.3.2.1.cmml" xref="A1.E12.m1.10.10.1.3.2.1"></times><apply id="A1.E12.m1.10.10.1.3.2.2.cmml" xref="A1.E12.m1.10.10.1.3.2.2"><csymbol cd="ambiguous" id="A1.E12.m1.10.10.1.3.2.2.1.cmml" xref="A1.E12.m1.10.10.1.3.2.2">subscript</csymbol><ci id="A1.E12.m1.10.10.1.3.2.2.2.cmml" xref="A1.E12.m1.10.10.1.3.2.2.2">𝔼</ci><apply id="A1.E12.m1.10.10.1.3.2.2.3.cmml" xref="A1.E12.m1.10.10.1.3.2.2.3"><csymbol cd="latexml" id="A1.E12.m1.10.10.1.3.2.2.3.1.cmml" xref="A1.E12.m1.10.10.1.3.2.2.3.1">similar-to</csymbol><ci id="A1.E12.m1.10.10.1.3.2.2.3.2.cmml" xref="A1.E12.m1.10.10.1.3.2.2.3.2">𝑥</ci><ci id="A1.E12.m1.10.10.1.3.2.2.3.3.cmml" xref="A1.E12.m1.10.10.1.3.2.2.3.3">𝒟</ci></apply></apply><apply id="A1.E12.m1.10.10.1.3.2.3.cmml" xref="A1.E12.m1.10.10.1.3.2.3"><csymbol cd="ambiguous" id="A1.E12.m1.10.10.1.3.2.3.1.cmml" xref="A1.E12.m1.10.10.1.3.2.3">subscript</csymbol><ci id="A1.E12.m1.10.10.1.3.2.3.2.cmml" xref="A1.E12.m1.10.10.1.3.2.3.2">𝔼</ci><apply id="A1.E12.m1.1.1.1.cmml" xref="A1.E12.m1.1.1.1"><csymbol cd="latexml" id="A1.E12.m1.1.1.1.2.cmml" xref="A1.E12.m1.1.1.1.2">similar-to</csymbol><ci id="A1.E12.m1.1.1.1.3.cmml" xref="A1.E12.m1.1.1.1.3">𝑦</ci><apply id="A1.E12.m1.1.1.1.1.cmml" xref="A1.E12.m1.1.1.1.1"><times id="A1.E12.m1.1.1.1.1.2.cmml" xref="A1.E12.m1.1.1.1.1.2"></times><ci id="A1.E12.m1.1.1.1.1.3.cmml" xref="A1.E12.m1.1.1.1.1.3">𝜋</ci><apply id="A1.E12.m1.1.1.1.1.1.1.1.cmml" xref="A1.E12.m1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E12.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.E12.m1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.E12.m1.1.1.1.1.1.1.1.2.cmml" xref="A1.E12.m1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.E12.m1.1.1.1.1.1.1.1.3.cmml" xref="A1.E12.m1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.E12.m1.10.10.1.1.2.cmml" xref="A1.E12.m1.10.10.1.1.1"><csymbol cd="latexml" id="A1.E12.m1.10.10.1.1.2.1.cmml" xref="A1.E12.m1.10.10.1.1.1.2">delimited-[]</csymbol><apply id="A1.E12.m1.10.10.1.1.1.1.cmml" xref="A1.E12.m1.10.10.1.1.1.1"><minus id="A1.E12.m1.10.10.1.1.1.1.1.cmml" xref="A1.E12.m1.10.10.1.1.1.1.1"></minus><apply id="A1.E12.m1.10.10.1.1.1.1.2.cmml" xref="A1.E12.m1.10.10.1.1.1.1.2"><log id="A1.E12.m1.10.10.1.1.1.1.2.1.cmml" xref="A1.E12.m1.10.10.1.1.1.1.2.1"></log><apply id="A1.E12.m1.8.8.cmml" xref="A1.E12.m1.8.8"><divide id="A1.E12.m1.8.8.8.cmml" xref="A1.E12.m1.8.8"></divide><apply id="A1.E12.m1.2.2.1.cmml" xref="A1.E12.m1.2.2.1"><times id="A1.E12.m1.2.2.1.2.cmml" xref="A1.E12.m1.2.2.1.2"></times><ci id="A1.E12.m1.2.2.1.3.cmml" xref="A1.E12.m1.2.2.1.3">𝜋</ci><apply id="A1.E12.m1.2.2.1.1.1.1.cmml" xref="A1.E12.m1.2.2.1.1.1"><csymbol cd="latexml" id="A1.E12.m1.2.2.1.1.1.1.1.cmml" xref="A1.E12.m1.2.2.1.1.1.1.1">conditional</csymbol><ci id="A1.E12.m1.2.2.1.1.1.1.2.cmml" xref="A1.E12.m1.2.2.1.1.1.1.2">𝑦</ci><ci id="A1.E12.m1.2.2.1.1.1.1.3.cmml" xref="A1.E12.m1.2.2.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.E12.m1.8.8.7.cmml" xref="A1.E12.m1.8.8.7"><times id="A1.E12.m1.8.8.7.7.cmml" xref="A1.E12.m1.8.8.7.7"></times><apply id="A1.E12.m1.3.3.2.1.cmml" xref="A1.E12.m1.3.3.2.1"><divide id="A1.E12.m1.3.3.2.1.2.cmml" xref="A1.E12.m1.3.3.2.1"></divide><cn id="A1.E12.m1.3.3.2.1.3.cmml" type="integer" xref="A1.E12.m1.3.3.2.1.3">1</cn><apply id="A1.E12.m1.3.3.2.1.1.cmml" xref="A1.E12.m1.3.3.2.1.1"><times id="A1.E12.m1.3.3.2.1.1.2.cmml" xref="A1.E12.m1.3.3.2.1.1.2"></times><ci id="A1.E12.m1.3.3.2.1.1.3.cmml" xref="A1.E12.m1.3.3.2.1.1.3">𝑍</ci><ci id="A1.E12.m1.3.3.2.1.1.1.cmml" xref="A1.E12.m1.3.3.2.1.1.1">𝑥</ci></apply></apply><apply id="A1.E12.m1.8.8.7.8.cmml" xref="A1.E12.m1.8.8.7.8"><csymbol cd="ambiguous" id="A1.E12.m1.8.8.7.8.1.cmml" xref="A1.E12.m1.8.8.7.8">subscript</csymbol><ci id="A1.E12.m1.8.8.7.8.2.cmml" xref="A1.E12.m1.8.8.7.8.2">𝜋</ci><ci id="A1.E12.m1.8.8.7.8.3a.cmml" xref="A1.E12.m1.8.8.7.8.3"><mtext id="A1.E12.m1.8.8.7.8.3.cmml" mathsize="70%" xref="A1.E12.m1.8.8.7.8.3">ref</mtext></ci></apply><apply id="A1.E12.m1.7.7.6.5.1.1.cmml" xref="A1.E12.m1.7.7.6.5.1"><csymbol cd="latexml" id="A1.E12.m1.7.7.6.5.1.1.1.cmml" xref="A1.E12.m1.7.7.6.5.1.1.1">conditional</csymbol><ci id="A1.E12.m1.7.7.6.5.1.1.2.cmml" xref="A1.E12.m1.7.7.6.5.1.1.2">𝑦</ci><ci id="A1.E12.m1.7.7.6.5.1.1.3.cmml" xref="A1.E12.m1.7.7.6.5.1.1.3">𝑥</ci></apply><apply id="A1.E12.m1.8.8.7.6.2.cmml" xref="A1.E12.m1.8.8.7.6.1"><exp id="A1.E12.m1.6.6.5.4.cmml" xref="A1.E12.m1.6.6.5.4"></exp><apply id="A1.E12.m1.8.8.7.6.1.1.1.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1"><times id="A1.E12.m1.8.8.7.6.1.1.1.1.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1.1"></times><apply id="A1.E12.m1.8.8.7.6.1.1.1.2.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1.2"><divide id="A1.E12.m1.8.8.7.6.1.1.1.2.1.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1.2"></divide><cn id="A1.E12.m1.8.8.7.6.1.1.1.2.2.cmml" type="integer" xref="A1.E12.m1.8.8.7.6.1.1.1.2.2">1</cn><ci id="A1.E12.m1.8.8.7.6.1.1.1.2.3.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1.2.3">𝛽</ci></apply><ci id="A1.E12.m1.8.8.7.6.1.1.1.3.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1.3">𝑟</ci><interval closure="open" id="A1.E12.m1.8.8.7.6.1.1.1.4.1.cmml" xref="A1.E12.m1.8.8.7.6.1.1.1.4.2"><ci id="A1.E12.m1.4.4.3.2.cmml" xref="A1.E12.m1.4.4.3.2">𝑥</ci><ci id="A1.E12.m1.5.5.4.3.cmml" xref="A1.E12.m1.5.5.4.3">𝑦</ci></interval></apply></apply></apply></apply></apply><apply id="A1.E12.m1.10.10.1.1.1.1.3.cmml" xref="A1.E12.m1.10.10.1.1.1.1.3"><times id="A1.E12.m1.10.10.1.1.1.1.3.1.cmml" xref="A1.E12.m1.10.10.1.1.1.1.3.1"></times><apply id="A1.E12.m1.10.10.1.1.1.1.3.2.cmml" xref="A1.E12.m1.10.10.1.1.1.1.3.2"><log id="A1.E12.m1.10.10.1.1.1.1.3.2.1.cmml" xref="A1.E12.m1.10.10.1.1.1.1.3.2.1"></log><ci id="A1.E12.m1.10.10.1.1.1.1.3.2.2.cmml" xref="A1.E12.m1.10.10.1.1.1.1.3.2.2">𝑍</ci></apply><ci id="A1.E12.m1.9.9.cmml" xref="A1.E12.m1.9.9">𝑥</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E12.m1.10c">\displaystyle=\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\mathbb{E}_{y\sim\pi(y|x)%
}\left[\log\frac{\pi(y|x)}{\frac{1}{Z(x)}\pi_{\text{ref}}(y|x)\exp\left(\frac{%
1}{\beta}r(x,y)\right)}-\log Z(x)\right]</annotation><annotation encoding="application/x-llamapun" id="A1.E12.m1.10d">= roman_min start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y ∼ italic_π ( italic_y | italic_x ) end_POSTSUBSCRIPT [ roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG divide start_ARG 1 end_ARG start_ARG italic_Z ( italic_x ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) end_ARG - roman_log italic_Z ( italic_x ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(12)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS1.p2">
<p class="ltx_p" id="A1.SS1.p2.1">where we have partition function:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.Ex4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="Z(x)=\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)." class="ltx_Math" display="block" id="A1.Ex4.m1.5"><semantics id="A1.Ex4.m1.5a"><mrow id="A1.Ex4.m1.5.5.1" xref="A1.Ex4.m1.5.5.1.1.cmml"><mrow id="A1.Ex4.m1.5.5.1.1" xref="A1.Ex4.m1.5.5.1.1.cmml"><mrow id="A1.Ex4.m1.5.5.1.1.4" xref="A1.Ex4.m1.5.5.1.1.4.cmml"><mi id="A1.Ex4.m1.5.5.1.1.4.2" xref="A1.Ex4.m1.5.5.1.1.4.2.cmml">Z</mi><mo id="A1.Ex4.m1.5.5.1.1.4.1" xref="A1.Ex4.m1.5.5.1.1.4.1.cmml">⁢</mo><mrow id="A1.Ex4.m1.5.5.1.1.4.3.2" xref="A1.Ex4.m1.5.5.1.1.4.cmml"><mo id="A1.Ex4.m1.5.5.1.1.4.3.2.1" stretchy="false" xref="A1.Ex4.m1.5.5.1.1.4.cmml">(</mo><mi id="A1.Ex4.m1.1.1" xref="A1.Ex4.m1.1.1.cmml">x</mi><mo id="A1.Ex4.m1.5.5.1.1.4.3.2.2" stretchy="false" xref="A1.Ex4.m1.5.5.1.1.4.cmml">)</mo></mrow></mrow><mo id="A1.Ex4.m1.5.5.1.1.3" rspace="0.111em" xref="A1.Ex4.m1.5.5.1.1.3.cmml">=</mo><mrow id="A1.Ex4.m1.5.5.1.1.2" xref="A1.Ex4.m1.5.5.1.1.2.cmml"><munder id="A1.Ex4.m1.5.5.1.1.2.3" xref="A1.Ex4.m1.5.5.1.1.2.3.cmml"><mo id="A1.Ex4.m1.5.5.1.1.2.3.2" movablelimits="false" xref="A1.Ex4.m1.5.5.1.1.2.3.2.cmml">∑</mo><mi id="A1.Ex4.m1.5.5.1.1.2.3.3" xref="A1.Ex4.m1.5.5.1.1.2.3.3.cmml">y</mi></munder><mrow id="A1.Ex4.m1.5.5.1.1.2.2" xref="A1.Ex4.m1.5.5.1.1.2.2.cmml"><msub id="A1.Ex4.m1.5.5.1.1.2.2.4" xref="A1.Ex4.m1.5.5.1.1.2.2.4.cmml"><mi id="A1.Ex4.m1.5.5.1.1.2.2.4.2" xref="A1.Ex4.m1.5.5.1.1.2.2.4.2.cmml">π</mi><mtext id="A1.Ex4.m1.5.5.1.1.2.2.4.3" xref="A1.Ex4.m1.5.5.1.1.2.2.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex4.m1.5.5.1.1.2.2.3" xref="A1.Ex4.m1.5.5.1.1.2.2.3.cmml">⁢</mo><mrow id="A1.Ex4.m1.5.5.1.1.1.1.1.1" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.cmml"><mo id="A1.Ex4.m1.5.5.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.2" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.1" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.3" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex4.m1.5.5.1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex4.m1.5.5.1.1.2.2.3a" lspace="0.167em" xref="A1.Ex4.m1.5.5.1.1.2.2.3.cmml">⁢</mo><mrow id="A1.Ex4.m1.5.5.1.1.2.2.2.1" xref="A1.Ex4.m1.5.5.1.1.2.2.2.2.cmml"><mi id="A1.Ex4.m1.4.4" xref="A1.Ex4.m1.4.4.cmml">exp</mi><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1a" xref="A1.Ex4.m1.5.5.1.1.2.2.2.2.cmml">⁡</mo><mrow id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1" xref="A1.Ex4.m1.5.5.1.1.2.2.2.2.cmml"><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.2" xref="A1.Ex4.m1.5.5.1.1.2.2.2.2.cmml">(</mo><mrow id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.cmml"><mfrac id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.cmml"><mn id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.2" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.3" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.1" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.3" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.3.cmml">r</mi><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.1a" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.2" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.1.cmml"><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex4.m1.2.2" xref="A1.Ex4.m1.2.2.cmml">x</mi><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.2.2" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex4.m1.3.3" xref="A1.Ex4.m1.3.3.cmml">y</mi><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.3" xref="A1.Ex4.m1.5.5.1.1.2.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><mo id="A1.Ex4.m1.5.5.1.2" lspace="0em" xref="A1.Ex4.m1.5.5.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex4.m1.5b"><apply id="A1.Ex4.m1.5.5.1.1.cmml" xref="A1.Ex4.m1.5.5.1"><eq id="A1.Ex4.m1.5.5.1.1.3.cmml" xref="A1.Ex4.m1.5.5.1.1.3"></eq><apply id="A1.Ex4.m1.5.5.1.1.4.cmml" xref="A1.Ex4.m1.5.5.1.1.4"><times id="A1.Ex4.m1.5.5.1.1.4.1.cmml" xref="A1.Ex4.m1.5.5.1.1.4.1"></times><ci id="A1.Ex4.m1.5.5.1.1.4.2.cmml" xref="A1.Ex4.m1.5.5.1.1.4.2">𝑍</ci><ci id="A1.Ex4.m1.1.1.cmml" xref="A1.Ex4.m1.1.1">𝑥</ci></apply><apply id="A1.Ex4.m1.5.5.1.1.2.cmml" xref="A1.Ex4.m1.5.5.1.1.2"><apply id="A1.Ex4.m1.5.5.1.1.2.3.cmml" xref="A1.Ex4.m1.5.5.1.1.2.3"><csymbol cd="ambiguous" id="A1.Ex4.m1.5.5.1.1.2.3.1.cmml" xref="A1.Ex4.m1.5.5.1.1.2.3">subscript</csymbol><sum id="A1.Ex4.m1.5.5.1.1.2.3.2.cmml" xref="A1.Ex4.m1.5.5.1.1.2.3.2"></sum><ci id="A1.Ex4.m1.5.5.1.1.2.3.3.cmml" xref="A1.Ex4.m1.5.5.1.1.2.3.3">𝑦</ci></apply><apply id="A1.Ex4.m1.5.5.1.1.2.2.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2"><times id="A1.Ex4.m1.5.5.1.1.2.2.3.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.3"></times><apply id="A1.Ex4.m1.5.5.1.1.2.2.4.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.4"><csymbol cd="ambiguous" id="A1.Ex4.m1.5.5.1.1.2.2.4.1.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.4">subscript</csymbol><ci id="A1.Ex4.m1.5.5.1.1.2.2.4.2.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.4.2">𝜋</ci><ci id="A1.Ex4.m1.5.5.1.1.2.2.4.3a.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.4.3"><mtext id="A1.Ex4.m1.5.5.1.1.2.2.4.3.cmml" mathsize="70%" xref="A1.Ex4.m1.5.5.1.1.2.2.4.3">ref</mtext></ci></apply><apply id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.cmml" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex4.m1.5.5.1.1.1.1.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex4.m1.5.5.1.1.2.2.2.2.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1"><exp id="A1.Ex4.m1.4.4.cmml" xref="A1.Ex4.m1.4.4"></exp><apply id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1"><times id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.1.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.1"></times><apply id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2"><divide id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.1.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2"></divide><cn id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.2">1</cn><ci id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.3.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.3.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.1.cmml" xref="A1.Ex4.m1.5.5.1.1.2.2.2.1.1.1.4.2"><ci id="A1.Ex4.m1.2.2.cmml" xref="A1.Ex4.m1.2.2">𝑥</ci><ci id="A1.Ex4.m1.3.3.cmml" xref="A1.Ex4.m1.3.3">𝑦</ci></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex4.m1.5c">Z(x)=\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right).</annotation><annotation encoding="application/x-llamapun" id="A1.Ex4.m1.5d">italic_Z ( italic_x ) = ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS1.p3">
<p class="ltx_p" id="A1.SS1.p3.3">Note that the partition function is a function of only <math alttext="x" class="ltx_Math" display="inline" id="A1.SS1.p3.1.m1.1"><semantics id="A1.SS1.p3.1.m1.1a"><mi id="A1.SS1.p3.1.m1.1.1" xref="A1.SS1.p3.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.1.m1.1b"><ci id="A1.SS1.p3.1.m1.1.1.cmml" xref="A1.SS1.p3.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.1.m1.1c">x</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.1.m1.1d">italic_x</annotation></semantics></math> and the reference policy <math alttext="\pi_{\text{ref}}" class="ltx_Math" display="inline" id="A1.SS1.p3.2.m2.1"><semantics id="A1.SS1.p3.2.m2.1a"><msub id="A1.SS1.p3.2.m2.1.1" xref="A1.SS1.p3.2.m2.1.1.cmml"><mi id="A1.SS1.p3.2.m2.1.1.2" xref="A1.SS1.p3.2.m2.1.1.2.cmml">π</mi><mtext id="A1.SS1.p3.2.m2.1.1.3" xref="A1.SS1.p3.2.m2.1.1.3a.cmml">ref</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.2.m2.1b"><apply id="A1.SS1.p3.2.m2.1.1.cmml" xref="A1.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.2.m2.1.1.1.cmml" xref="A1.SS1.p3.2.m2.1.1">subscript</csymbol><ci id="A1.SS1.p3.2.m2.1.1.2.cmml" xref="A1.SS1.p3.2.m2.1.1.2">𝜋</ci><ci id="A1.SS1.p3.2.m2.1.1.3a.cmml" xref="A1.SS1.p3.2.m2.1.1.3"><mtext id="A1.SS1.p3.2.m2.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.2.m2.1.1.3">ref</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.2.m2.1c">\pi_{\text{ref}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.2.m2.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT</annotation></semantics></math>, but does not depend on the policy <math alttext="\pi" class="ltx_Math" display="inline" id="A1.SS1.p3.3.m3.1"><semantics id="A1.SS1.p3.3.m3.1a"><mi id="A1.SS1.p3.3.m3.1.1" xref="A1.SS1.p3.3.m3.1.1.cmml">π</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.3.m3.1b"><ci id="A1.SS1.p3.3.m3.1.1.cmml" xref="A1.SS1.p3.3.m3.1.1">𝜋</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.3.m3.1c">\pi</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.3.m3.1d">italic_π</annotation></semantics></math>. We can now define</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.Ex5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\pi^{*}(y|x)=\frac{1}{Z(x)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y%
)\right)," class="ltx_Math" display="block" id="A1.Ex5.m1.5"><semantics id="A1.Ex5.m1.5a"><mrow id="A1.Ex5.m1.5.5.1" xref="A1.Ex5.m1.5.5.1.1.cmml"><mrow id="A1.Ex5.m1.5.5.1.1" xref="A1.Ex5.m1.5.5.1.1.cmml"><mrow id="A1.Ex5.m1.5.5.1.1.1" xref="A1.Ex5.m1.5.5.1.1.1.cmml"><msup id="A1.Ex5.m1.5.5.1.1.1.3" xref="A1.Ex5.m1.5.5.1.1.1.3.cmml"><mi id="A1.Ex5.m1.5.5.1.1.1.3.2" xref="A1.Ex5.m1.5.5.1.1.1.3.2.cmml">π</mi><mo id="A1.Ex5.m1.5.5.1.1.1.3.3" xref="A1.Ex5.m1.5.5.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.Ex5.m1.5.5.1.1.1.2" xref="A1.Ex5.m1.5.5.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex5.m1.5.5.1.1.1.1.1" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.cmml"><mo id="A1.Ex5.m1.5.5.1.1.1.1.1.2" stretchy="false" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex5.m1.5.5.1.1.1.1.1.1" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.cmml"><mi id="A1.Ex5.m1.5.5.1.1.1.1.1.1.2" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex5.m1.5.5.1.1.1.1.1.1.1" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex5.m1.5.5.1.1.1.1.1.1.3" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex5.m1.5.5.1.1.1.1.1.3" stretchy="false" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex5.m1.5.5.1.1.4" xref="A1.Ex5.m1.5.5.1.1.4.cmml">=</mo><mrow id="A1.Ex5.m1.5.5.1.1.3" xref="A1.Ex5.m1.5.5.1.1.3.cmml"><mfrac id="A1.Ex5.m1.1.1" xref="A1.Ex5.m1.1.1.cmml"><mn id="A1.Ex5.m1.1.1.3" xref="A1.Ex5.m1.1.1.3.cmml">1</mn><mrow id="A1.Ex5.m1.1.1.1" xref="A1.Ex5.m1.1.1.1.cmml"><mi id="A1.Ex5.m1.1.1.1.3" xref="A1.Ex5.m1.1.1.1.3.cmml">Z</mi><mo id="A1.Ex5.m1.1.1.1.2" xref="A1.Ex5.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex5.m1.1.1.1.4.2" xref="A1.Ex5.m1.1.1.1.cmml"><mo id="A1.Ex5.m1.1.1.1.4.2.1" stretchy="false" xref="A1.Ex5.m1.1.1.1.cmml">(</mo><mi id="A1.Ex5.m1.1.1.1.1" xref="A1.Ex5.m1.1.1.1.1.cmml">x</mi><mo id="A1.Ex5.m1.1.1.1.4.2.2" stretchy="false" xref="A1.Ex5.m1.1.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="A1.Ex5.m1.5.5.1.1.3.3" xref="A1.Ex5.m1.5.5.1.1.3.3.cmml">⁢</mo><msub id="A1.Ex5.m1.5.5.1.1.3.4" xref="A1.Ex5.m1.5.5.1.1.3.4.cmml"><mi id="A1.Ex5.m1.5.5.1.1.3.4.2" xref="A1.Ex5.m1.5.5.1.1.3.4.2.cmml">π</mi><mtext id="A1.Ex5.m1.5.5.1.1.3.4.3" xref="A1.Ex5.m1.5.5.1.1.3.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex5.m1.5.5.1.1.3.3a" xref="A1.Ex5.m1.5.5.1.1.3.3.cmml">⁢</mo><mrow id="A1.Ex5.m1.5.5.1.1.2.1.1" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.cmml"><mo id="A1.Ex5.m1.5.5.1.1.2.1.1.2" stretchy="false" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.cmml">(</mo><mrow id="A1.Ex5.m1.5.5.1.1.2.1.1.1" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.cmml"><mi id="A1.Ex5.m1.5.5.1.1.2.1.1.1.2" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex5.m1.5.5.1.1.2.1.1.1.1" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex5.m1.5.5.1.1.2.1.1.1.3" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex5.m1.5.5.1.1.2.1.1.3" stretchy="false" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex5.m1.5.5.1.1.3.3b" lspace="0.167em" xref="A1.Ex5.m1.5.5.1.1.3.3.cmml">⁢</mo><mrow id="A1.Ex5.m1.5.5.1.1.3.2.1" xref="A1.Ex5.m1.5.5.1.1.3.2.2.cmml"><mi id="A1.Ex5.m1.4.4" xref="A1.Ex5.m1.4.4.cmml">exp</mi><mo id="A1.Ex5.m1.5.5.1.1.3.2.1a" xref="A1.Ex5.m1.5.5.1.1.3.2.2.cmml">⁡</mo><mrow id="A1.Ex5.m1.5.5.1.1.3.2.1.1" xref="A1.Ex5.m1.5.5.1.1.3.2.2.cmml"><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.2" xref="A1.Ex5.m1.5.5.1.1.3.2.2.cmml">(</mo><mrow id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.cmml"><mfrac id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.cmml"><mn id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.2" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.3" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.1" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.3" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.3.cmml">r</mi><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.1a" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.2" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.1.cmml"><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex5.m1.2.2" xref="A1.Ex5.m1.2.2.cmml">x</mi><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.2.2" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex5.m1.3.3" xref="A1.Ex5.m1.3.3.cmml">y</mi><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex5.m1.5.5.1.1.3.2.1.1.3" xref="A1.Ex5.m1.5.5.1.1.3.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="A1.Ex5.m1.5.5.1.2" xref="A1.Ex5.m1.5.5.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex5.m1.5b"><apply id="A1.Ex5.m1.5.5.1.1.cmml" xref="A1.Ex5.m1.5.5.1"><eq id="A1.Ex5.m1.5.5.1.1.4.cmml" xref="A1.Ex5.m1.5.5.1.1.4"></eq><apply id="A1.Ex5.m1.5.5.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.1"><times id="A1.Ex5.m1.5.5.1.1.1.2.cmml" xref="A1.Ex5.m1.5.5.1.1.1.2"></times><apply id="A1.Ex5.m1.5.5.1.1.1.3.cmml" xref="A1.Ex5.m1.5.5.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex5.m1.5.5.1.1.1.3.1.cmml" xref="A1.Ex5.m1.5.5.1.1.1.3">superscript</csymbol><ci id="A1.Ex5.m1.5.5.1.1.1.3.2.cmml" xref="A1.Ex5.m1.5.5.1.1.1.3.2">𝜋</ci><times id="A1.Ex5.m1.5.5.1.1.1.3.3.cmml" xref="A1.Ex5.m1.5.5.1.1.1.3.3"></times></apply><apply id="A1.Ex5.m1.5.5.1.1.1.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex5.m1.5.5.1.1.1.1.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex5.m1.5.5.1.1.1.1.1.1.2.cmml" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex5.m1.5.5.1.1.1.1.1.1.3.cmml" xref="A1.Ex5.m1.5.5.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex5.m1.5.5.1.1.3.cmml" xref="A1.Ex5.m1.5.5.1.1.3"><times id="A1.Ex5.m1.5.5.1.1.3.3.cmml" xref="A1.Ex5.m1.5.5.1.1.3.3"></times><apply id="A1.Ex5.m1.1.1.cmml" xref="A1.Ex5.m1.1.1"><divide id="A1.Ex5.m1.1.1.2.cmml" xref="A1.Ex5.m1.1.1"></divide><cn id="A1.Ex5.m1.1.1.3.cmml" type="integer" xref="A1.Ex5.m1.1.1.3">1</cn><apply id="A1.Ex5.m1.1.1.1.cmml" xref="A1.Ex5.m1.1.1.1"><times id="A1.Ex5.m1.1.1.1.2.cmml" xref="A1.Ex5.m1.1.1.1.2"></times><ci id="A1.Ex5.m1.1.1.1.3.cmml" xref="A1.Ex5.m1.1.1.1.3">𝑍</ci><ci id="A1.Ex5.m1.1.1.1.1.cmml" xref="A1.Ex5.m1.1.1.1.1">𝑥</ci></apply></apply><apply id="A1.Ex5.m1.5.5.1.1.3.4.cmml" xref="A1.Ex5.m1.5.5.1.1.3.4"><csymbol cd="ambiguous" id="A1.Ex5.m1.5.5.1.1.3.4.1.cmml" xref="A1.Ex5.m1.5.5.1.1.3.4">subscript</csymbol><ci id="A1.Ex5.m1.5.5.1.1.3.4.2.cmml" xref="A1.Ex5.m1.5.5.1.1.3.4.2">𝜋</ci><ci id="A1.Ex5.m1.5.5.1.1.3.4.3a.cmml" xref="A1.Ex5.m1.5.5.1.1.3.4.3"><mtext id="A1.Ex5.m1.5.5.1.1.3.4.3.cmml" mathsize="70%" xref="A1.Ex5.m1.5.5.1.1.3.4.3">ref</mtext></ci></apply><apply id="A1.Ex5.m1.5.5.1.1.2.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.2.1.1"><csymbol cd="latexml" id="A1.Ex5.m1.5.5.1.1.2.1.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex5.m1.5.5.1.1.2.1.1.1.2.cmml" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.2">𝑦</ci><ci id="A1.Ex5.m1.5.5.1.1.2.1.1.1.3.cmml" xref="A1.Ex5.m1.5.5.1.1.2.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex5.m1.5.5.1.1.3.2.2.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1"><exp id="A1.Ex5.m1.4.4.cmml" xref="A1.Ex5.m1.4.4"></exp><apply id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1"><times id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.1.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.1"></times><apply id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2"><divide id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.1.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2"></divide><cn id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.2">1</cn><ci id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.3.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.3.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.1.cmml" xref="A1.Ex5.m1.5.5.1.1.3.2.1.1.1.4.2"><ci id="A1.Ex5.m1.2.2.cmml" xref="A1.Ex5.m1.2.2">𝑥</ci><ci id="A1.Ex5.m1.3.3.cmml" xref="A1.Ex5.m1.3.3">𝑦</ci></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex5.m1.5c">\pi^{*}(y|x)=\frac{1}{Z(x)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y%
)\right),</annotation><annotation encoding="application/x-llamapun" id="A1.Ex5.m1.5d">italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) = divide start_ARG 1 end_ARG start_ARG italic_Z ( italic_x ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS1.p4">
<p class="ltx_p" id="A1.SS1.p4.5">which is a valid probability distribution as <math alttext="\pi^{*}(y|x)\geq 0" class="ltx_Math" display="inline" id="A1.SS1.p4.1.m1.1"><semantics id="A1.SS1.p4.1.m1.1a"><mrow id="A1.SS1.p4.1.m1.1.1" xref="A1.SS1.p4.1.m1.1.1.cmml"><mrow id="A1.SS1.p4.1.m1.1.1.1" xref="A1.SS1.p4.1.m1.1.1.1.cmml"><msup id="A1.SS1.p4.1.m1.1.1.1.3" xref="A1.SS1.p4.1.m1.1.1.1.3.cmml"><mi id="A1.SS1.p4.1.m1.1.1.1.3.2" xref="A1.SS1.p4.1.m1.1.1.1.3.2.cmml">π</mi><mo id="A1.SS1.p4.1.m1.1.1.1.3.3" xref="A1.SS1.p4.1.m1.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.SS1.p4.1.m1.1.1.1.2" xref="A1.SS1.p4.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS1.p4.1.m1.1.1.1.1.1" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.cmml"><mo id="A1.SS1.p4.1.m1.1.1.1.1.1.2" stretchy="false" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS1.p4.1.m1.1.1.1.1.1.1" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.cmml"><mi id="A1.SS1.p4.1.m1.1.1.1.1.1.1.2" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS1.p4.1.m1.1.1.1.1.1.1.1" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS1.p4.1.m1.1.1.1.1.1.1.3" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS1.p4.1.m1.1.1.1.1.1.3" stretchy="false" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS1.p4.1.m1.1.1.2" xref="A1.SS1.p4.1.m1.1.1.2.cmml">≥</mo><mn id="A1.SS1.p4.1.m1.1.1.3" xref="A1.SS1.p4.1.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.1.m1.1b"><apply id="A1.SS1.p4.1.m1.1.1.cmml" xref="A1.SS1.p4.1.m1.1.1"><geq id="A1.SS1.p4.1.m1.1.1.2.cmml" xref="A1.SS1.p4.1.m1.1.1.2"></geq><apply id="A1.SS1.p4.1.m1.1.1.1.cmml" xref="A1.SS1.p4.1.m1.1.1.1"><times id="A1.SS1.p4.1.m1.1.1.1.2.cmml" xref="A1.SS1.p4.1.m1.1.1.1.2"></times><apply id="A1.SS1.p4.1.m1.1.1.1.3.cmml" xref="A1.SS1.p4.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.SS1.p4.1.m1.1.1.1.3.1.cmml" xref="A1.SS1.p4.1.m1.1.1.1.3">superscript</csymbol><ci id="A1.SS1.p4.1.m1.1.1.1.3.2.cmml" xref="A1.SS1.p4.1.m1.1.1.1.3.2">𝜋</ci><times id="A1.SS1.p4.1.m1.1.1.1.3.3.cmml" xref="A1.SS1.p4.1.m1.1.1.1.3.3"></times></apply><apply id="A1.SS1.p4.1.m1.1.1.1.1.1.1.cmml" xref="A1.SS1.p4.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS1.p4.1.m1.1.1.1.1.1.1.1.cmml" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS1.p4.1.m1.1.1.1.1.1.1.2.cmml" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS1.p4.1.m1.1.1.1.1.1.1.3.cmml" xref="A1.SS1.p4.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><cn id="A1.SS1.p4.1.m1.1.1.3.cmml" type="integer" xref="A1.SS1.p4.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.1.m1.1c">\pi^{*}(y|x)\geq 0</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.1.m1.1d">italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) ≥ 0</annotation></semantics></math> for all <math alttext="y" class="ltx_Math" display="inline" id="A1.SS1.p4.2.m2.1"><semantics id="A1.SS1.p4.2.m2.1a"><mi id="A1.SS1.p4.2.m2.1.1" xref="A1.SS1.p4.2.m2.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.2.m2.1b"><ci id="A1.SS1.p4.2.m2.1.1.cmml" xref="A1.SS1.p4.2.m2.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.2.m2.1c">y</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.2.m2.1d">italic_y</annotation></semantics></math> and <math alttext="\sum_{y}\pi^{*}(y|x)=1" class="ltx_Math" display="inline" id="A1.SS1.p4.3.m3.1"><semantics id="A1.SS1.p4.3.m3.1a"><mrow id="A1.SS1.p4.3.m3.1.1" xref="A1.SS1.p4.3.m3.1.1.cmml"><mrow id="A1.SS1.p4.3.m3.1.1.1" xref="A1.SS1.p4.3.m3.1.1.1.cmml"><msub id="A1.SS1.p4.3.m3.1.1.1.2" xref="A1.SS1.p4.3.m3.1.1.1.2.cmml"><mo id="A1.SS1.p4.3.m3.1.1.1.2.2" xref="A1.SS1.p4.3.m3.1.1.1.2.2.cmml">∑</mo><mi id="A1.SS1.p4.3.m3.1.1.1.2.3" xref="A1.SS1.p4.3.m3.1.1.1.2.3.cmml">y</mi></msub><mrow id="A1.SS1.p4.3.m3.1.1.1.1" xref="A1.SS1.p4.3.m3.1.1.1.1.cmml"><msup id="A1.SS1.p4.3.m3.1.1.1.1.3" xref="A1.SS1.p4.3.m3.1.1.1.1.3.cmml"><mi id="A1.SS1.p4.3.m3.1.1.1.1.3.2" xref="A1.SS1.p4.3.m3.1.1.1.1.3.2.cmml">π</mi><mo id="A1.SS1.p4.3.m3.1.1.1.1.3.3" xref="A1.SS1.p4.3.m3.1.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.SS1.p4.3.m3.1.1.1.1.2" xref="A1.SS1.p4.3.m3.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS1.p4.3.m3.1.1.1.1.1.1" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.cmml"><mo id="A1.SS1.p4.3.m3.1.1.1.1.1.1.2" stretchy="false" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.cmml"><mi id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.2" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.1" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.3" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS1.p4.3.m3.1.1.1.1.1.1.3" stretchy="false" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="A1.SS1.p4.3.m3.1.1.2" xref="A1.SS1.p4.3.m3.1.1.2.cmml">=</mo><mn id="A1.SS1.p4.3.m3.1.1.3" xref="A1.SS1.p4.3.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.3.m3.1b"><apply id="A1.SS1.p4.3.m3.1.1.cmml" xref="A1.SS1.p4.3.m3.1.1"><eq id="A1.SS1.p4.3.m3.1.1.2.cmml" xref="A1.SS1.p4.3.m3.1.1.2"></eq><apply id="A1.SS1.p4.3.m3.1.1.1.cmml" xref="A1.SS1.p4.3.m3.1.1.1"><apply id="A1.SS1.p4.3.m3.1.1.1.2.cmml" xref="A1.SS1.p4.3.m3.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS1.p4.3.m3.1.1.1.2.1.cmml" xref="A1.SS1.p4.3.m3.1.1.1.2">subscript</csymbol><sum id="A1.SS1.p4.3.m3.1.1.1.2.2.cmml" xref="A1.SS1.p4.3.m3.1.1.1.2.2"></sum><ci id="A1.SS1.p4.3.m3.1.1.1.2.3.cmml" xref="A1.SS1.p4.3.m3.1.1.1.2.3">𝑦</ci></apply><apply id="A1.SS1.p4.3.m3.1.1.1.1.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1"><times id="A1.SS1.p4.3.m3.1.1.1.1.2.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.2"></times><apply id="A1.SS1.p4.3.m3.1.1.1.1.3.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.SS1.p4.3.m3.1.1.1.1.3.1.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.3">superscript</csymbol><ci id="A1.SS1.p4.3.m3.1.1.1.1.3.2.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.3.2">𝜋</ci><times id="A1.SS1.p4.3.m3.1.1.1.1.3.3.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.3.3"></times></apply><apply id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.1.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.2.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.3.cmml" xref="A1.SS1.p4.3.m3.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply><cn id="A1.SS1.p4.3.m3.1.1.3.cmml" type="integer" xref="A1.SS1.p4.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.3.m3.1c">\sum_{y}\pi^{*}(y|x)=1</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.3.m3.1d">∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) = 1</annotation></semantics></math>. Since <math alttext="Z(x)" class="ltx_Math" display="inline" id="A1.SS1.p4.4.m4.1"><semantics id="A1.SS1.p4.4.m4.1a"><mrow id="A1.SS1.p4.4.m4.1.2" xref="A1.SS1.p4.4.m4.1.2.cmml"><mi id="A1.SS1.p4.4.m4.1.2.2" xref="A1.SS1.p4.4.m4.1.2.2.cmml">Z</mi><mo id="A1.SS1.p4.4.m4.1.2.1" xref="A1.SS1.p4.4.m4.1.2.1.cmml">⁢</mo><mrow id="A1.SS1.p4.4.m4.1.2.3.2" xref="A1.SS1.p4.4.m4.1.2.cmml"><mo id="A1.SS1.p4.4.m4.1.2.3.2.1" stretchy="false" xref="A1.SS1.p4.4.m4.1.2.cmml">(</mo><mi id="A1.SS1.p4.4.m4.1.1" xref="A1.SS1.p4.4.m4.1.1.cmml">x</mi><mo id="A1.SS1.p4.4.m4.1.2.3.2.2" stretchy="false" xref="A1.SS1.p4.4.m4.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.4.m4.1b"><apply id="A1.SS1.p4.4.m4.1.2.cmml" xref="A1.SS1.p4.4.m4.1.2"><times id="A1.SS1.p4.4.m4.1.2.1.cmml" xref="A1.SS1.p4.4.m4.1.2.1"></times><ci id="A1.SS1.p4.4.m4.1.2.2.cmml" xref="A1.SS1.p4.4.m4.1.2.2">𝑍</ci><ci id="A1.SS1.p4.4.m4.1.1.cmml" xref="A1.SS1.p4.4.m4.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.4.m4.1c">Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.4.m4.1d">italic_Z ( italic_x )</annotation></semantics></math> is not a function of <math alttext="y" class="ltx_Math" display="inline" id="A1.SS1.p4.5.m5.1"><semantics id="A1.SS1.p4.5.m5.1a"><mi id="A1.SS1.p4.5.m5.1.1" xref="A1.SS1.p4.5.m5.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.5.m5.1b"><ci id="A1.SS1.p4.5.m5.1.1.cmml" xref="A1.SS1.p4.5.m5.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.5.m5.1c">y</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.5.m5.1d">italic_y</annotation></semantics></math>, we can then re-organize the final objective in Eq <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.Ex1" title="A.1 Deriving the Optimum of the KL-Constrained Reward Maximization Objective ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.1</span></a> as:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx2">
<tbody id="A1.E13"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\left[\mathbb{E}_{y\sim\pi%
(y|x)}\left[\log\frac{\pi(y|x)}{\pi^{*}(y|x)}\right]-\log Z(x)\right]=" class="ltx_Math" display="inline" id="A1.E13.m1.5"><semantics id="A1.E13.m1.5a"><mrow id="A1.E13.m1.5.5" xref="A1.E13.m1.5.5.cmml"><mrow id="A1.E13.m1.5.5.1" xref="A1.E13.m1.5.5.1.cmml"><mrow id="A1.E13.m1.5.5.1.3" xref="A1.E13.m1.5.5.1.3.cmml"><munder id="A1.E13.m1.5.5.1.3.1" xref="A1.E13.m1.5.5.1.3.1.cmml"><mi id="A1.E13.m1.5.5.1.3.1.2" xref="A1.E13.m1.5.5.1.3.1.2.cmml">min</mi><mi id="A1.E13.m1.5.5.1.3.1.3" xref="A1.E13.m1.5.5.1.3.1.3.cmml">π</mi></munder><mo id="A1.E13.m1.5.5.1.3a" lspace="0.167em" xref="A1.E13.m1.5.5.1.3.cmml">⁡</mo><msub id="A1.E13.m1.5.5.1.3.2" xref="A1.E13.m1.5.5.1.3.2.cmml"><mi id="A1.E13.m1.5.5.1.3.2.2" xref="A1.E13.m1.5.5.1.3.2.2.cmml">𝔼</mi><mrow id="A1.E13.m1.5.5.1.3.2.3" xref="A1.E13.m1.5.5.1.3.2.3.cmml"><mi id="A1.E13.m1.5.5.1.3.2.3.2" xref="A1.E13.m1.5.5.1.3.2.3.2.cmml">x</mi><mo id="A1.E13.m1.5.5.1.3.2.3.1" xref="A1.E13.m1.5.5.1.3.2.3.1.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E13.m1.5.5.1.3.2.3.3" xref="A1.E13.m1.5.5.1.3.2.3.3.cmml">𝒟</mi></mrow></msub></mrow><mo id="A1.E13.m1.5.5.1.2" xref="A1.E13.m1.5.5.1.2.cmml">⁢</mo><mrow id="A1.E13.m1.5.5.1.1.1" xref="A1.E13.m1.5.5.1.1.2.cmml"><mo id="A1.E13.m1.5.5.1.1.1.2" xref="A1.E13.m1.5.5.1.1.2.1.cmml">[</mo><mrow id="A1.E13.m1.5.5.1.1.1.1" xref="A1.E13.m1.5.5.1.1.1.1.cmml"><mrow id="A1.E13.m1.5.5.1.1.1.1.1" xref="A1.E13.m1.5.5.1.1.1.1.1.cmml"><msub id="A1.E13.m1.5.5.1.1.1.1.1.3" xref="A1.E13.m1.5.5.1.1.1.1.1.3.cmml"><mi id="A1.E13.m1.5.5.1.1.1.1.1.3.2" xref="A1.E13.m1.5.5.1.1.1.1.1.3.2.cmml">𝔼</mi><mrow id="A1.E13.m1.1.1.1" xref="A1.E13.m1.1.1.1.cmml"><mi id="A1.E13.m1.1.1.1.3" xref="A1.E13.m1.1.1.1.3.cmml">y</mi><mo id="A1.E13.m1.1.1.1.2" xref="A1.E13.m1.1.1.1.2.cmml">∼</mo><mrow id="A1.E13.m1.1.1.1.1" xref="A1.E13.m1.1.1.1.1.cmml"><mi id="A1.E13.m1.1.1.1.1.3" xref="A1.E13.m1.1.1.1.1.3.cmml">π</mi><mo id="A1.E13.m1.1.1.1.1.2" xref="A1.E13.m1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E13.m1.1.1.1.1.1.1" xref="A1.E13.m1.1.1.1.1.1.1.1.cmml"><mo id="A1.E13.m1.1.1.1.1.1.1.2" stretchy="false" xref="A1.E13.m1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E13.m1.1.1.1.1.1.1.1" xref="A1.E13.m1.1.1.1.1.1.1.1.cmml"><mi id="A1.E13.m1.1.1.1.1.1.1.1.2" xref="A1.E13.m1.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E13.m1.1.1.1.1.1.1.1.1" xref="A1.E13.m1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.E13.m1.1.1.1.1.1.1.1.3" xref="A1.E13.m1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E13.m1.1.1.1.1.1.1.3" stretchy="false" xref="A1.E13.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></msub><mo id="A1.E13.m1.5.5.1.1.1.1.1.2" xref="A1.E13.m1.5.5.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E13.m1.5.5.1.1.1.1.1.1.1" xref="A1.E13.m1.5.5.1.1.1.1.1.1.2.cmml"><mo id="A1.E13.m1.5.5.1.1.1.1.1.1.1.2" xref="A1.E13.m1.5.5.1.1.1.1.1.1.2.1.cmml">[</mo><mrow id="A1.E13.m1.5.5.1.1.1.1.1.1.1.1" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.cmml"><mi id="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.1" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.1.cmml">log</mi><mo id="A1.E13.m1.5.5.1.1.1.1.1.1.1.1a" lspace="0.167em" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.cmml">⁡</mo><mstyle displaystyle="true" id="A1.E13.m1.3.3" xref="A1.E13.m1.3.3.cmml"><mfrac id="A1.E13.m1.3.3a" xref="A1.E13.m1.3.3.cmml"><mrow id="A1.E13.m1.2.2.1" xref="A1.E13.m1.2.2.1.cmml"><mi id="A1.E13.m1.2.2.1.3" xref="A1.E13.m1.2.2.1.3.cmml">π</mi><mo id="A1.E13.m1.2.2.1.2" xref="A1.E13.m1.2.2.1.2.cmml">⁢</mo><mrow id="A1.E13.m1.2.2.1.1.1" xref="A1.E13.m1.2.2.1.1.1.1.cmml"><mo id="A1.E13.m1.2.2.1.1.1.2" stretchy="false" xref="A1.E13.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="A1.E13.m1.2.2.1.1.1.1" xref="A1.E13.m1.2.2.1.1.1.1.cmml"><mi id="A1.E13.m1.2.2.1.1.1.1.2" xref="A1.E13.m1.2.2.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E13.m1.2.2.1.1.1.1.1" xref="A1.E13.m1.2.2.1.1.1.1.1.cmml">|</mo><mi id="A1.E13.m1.2.2.1.1.1.1.3" xref="A1.E13.m1.2.2.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E13.m1.2.2.1.1.1.3" stretchy="false" xref="A1.E13.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E13.m1.3.3.2" xref="A1.E13.m1.3.3.2.cmml"><msup id="A1.E13.m1.3.3.2.3" xref="A1.E13.m1.3.3.2.3.cmml"><mi id="A1.E13.m1.3.3.2.3.2" xref="A1.E13.m1.3.3.2.3.2.cmml">π</mi><mo id="A1.E13.m1.3.3.2.3.3" xref="A1.E13.m1.3.3.2.3.3.cmml">*</mo></msup><mo id="A1.E13.m1.3.3.2.2" xref="A1.E13.m1.3.3.2.2.cmml">⁢</mo><mrow id="A1.E13.m1.3.3.2.1.1" xref="A1.E13.m1.3.3.2.1.1.1.cmml"><mo id="A1.E13.m1.3.3.2.1.1.2" stretchy="false" xref="A1.E13.m1.3.3.2.1.1.1.cmml">(</mo><mrow id="A1.E13.m1.3.3.2.1.1.1" xref="A1.E13.m1.3.3.2.1.1.1.cmml"><mi id="A1.E13.m1.3.3.2.1.1.1.2" xref="A1.E13.m1.3.3.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E13.m1.3.3.2.1.1.1.1" xref="A1.E13.m1.3.3.2.1.1.1.1.cmml">|</mo><mi id="A1.E13.m1.3.3.2.1.1.1.3" xref="A1.E13.m1.3.3.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E13.m1.3.3.2.1.1.3" stretchy="false" xref="A1.E13.m1.3.3.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow><mo id="A1.E13.m1.5.5.1.1.1.1.1.1.1.3" xref="A1.E13.m1.5.5.1.1.1.1.1.1.2.1.cmml">]</mo></mrow></mrow><mo id="A1.E13.m1.5.5.1.1.1.1.2" xref="A1.E13.m1.5.5.1.1.1.1.2.cmml">−</mo><mrow id="A1.E13.m1.5.5.1.1.1.1.3" xref="A1.E13.m1.5.5.1.1.1.1.3.cmml"><mrow id="A1.E13.m1.5.5.1.1.1.1.3.2" xref="A1.E13.m1.5.5.1.1.1.1.3.2.cmml"><mi id="A1.E13.m1.5.5.1.1.1.1.3.2.1" xref="A1.E13.m1.5.5.1.1.1.1.3.2.1.cmml">log</mi><mo id="A1.E13.m1.5.5.1.1.1.1.3.2a" lspace="0.167em" xref="A1.E13.m1.5.5.1.1.1.1.3.2.cmml">⁡</mo><mi id="A1.E13.m1.5.5.1.1.1.1.3.2.2" xref="A1.E13.m1.5.5.1.1.1.1.3.2.2.cmml">Z</mi></mrow><mo id="A1.E13.m1.5.5.1.1.1.1.3.1" xref="A1.E13.m1.5.5.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.E13.m1.5.5.1.1.1.1.3.3.2" xref="A1.E13.m1.5.5.1.1.1.1.3.cmml"><mo id="A1.E13.m1.5.5.1.1.1.1.3.3.2.1" stretchy="false" xref="A1.E13.m1.5.5.1.1.1.1.3.cmml">(</mo><mi id="A1.E13.m1.4.4" xref="A1.E13.m1.4.4.cmml">x</mi><mo id="A1.E13.m1.5.5.1.1.1.1.3.3.2.2" stretchy="false" xref="A1.E13.m1.5.5.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.E13.m1.5.5.1.1.1.3" xref="A1.E13.m1.5.5.1.1.2.1.cmml">]</mo></mrow></mrow><mo id="A1.E13.m1.5.5.2" xref="A1.E13.m1.5.5.2.cmml">=</mo><mi id="A1.E13.m1.5.5.3" xref="A1.E13.m1.5.5.3.cmml"></mi></mrow><annotation-xml encoding="MathML-Content" id="A1.E13.m1.5b"><apply id="A1.E13.m1.5.5.cmml" xref="A1.E13.m1.5.5"><eq id="A1.E13.m1.5.5.2.cmml" xref="A1.E13.m1.5.5.2"></eq><apply id="A1.E13.m1.5.5.1.cmml" xref="A1.E13.m1.5.5.1"><times id="A1.E13.m1.5.5.1.2.cmml" xref="A1.E13.m1.5.5.1.2"></times><apply id="A1.E13.m1.5.5.1.3.cmml" xref="A1.E13.m1.5.5.1.3"><apply id="A1.E13.m1.5.5.1.3.1.cmml" xref="A1.E13.m1.5.5.1.3.1"><csymbol cd="ambiguous" id="A1.E13.m1.5.5.1.3.1.1.cmml" xref="A1.E13.m1.5.5.1.3.1">subscript</csymbol><min id="A1.E13.m1.5.5.1.3.1.2.cmml" xref="A1.E13.m1.5.5.1.3.1.2"></min><ci id="A1.E13.m1.5.5.1.3.1.3.cmml" xref="A1.E13.m1.5.5.1.3.1.3">𝜋</ci></apply><apply id="A1.E13.m1.5.5.1.3.2.cmml" xref="A1.E13.m1.5.5.1.3.2"><csymbol cd="ambiguous" id="A1.E13.m1.5.5.1.3.2.1.cmml" xref="A1.E13.m1.5.5.1.3.2">subscript</csymbol><ci id="A1.E13.m1.5.5.1.3.2.2.cmml" xref="A1.E13.m1.5.5.1.3.2.2">𝔼</ci><apply id="A1.E13.m1.5.5.1.3.2.3.cmml" xref="A1.E13.m1.5.5.1.3.2.3"><csymbol cd="latexml" id="A1.E13.m1.5.5.1.3.2.3.1.cmml" xref="A1.E13.m1.5.5.1.3.2.3.1">similar-to</csymbol><ci id="A1.E13.m1.5.5.1.3.2.3.2.cmml" xref="A1.E13.m1.5.5.1.3.2.3.2">𝑥</ci><ci id="A1.E13.m1.5.5.1.3.2.3.3.cmml" xref="A1.E13.m1.5.5.1.3.2.3.3">𝒟</ci></apply></apply></apply><apply id="A1.E13.m1.5.5.1.1.2.cmml" xref="A1.E13.m1.5.5.1.1.1"><csymbol cd="latexml" id="A1.E13.m1.5.5.1.1.2.1.cmml" xref="A1.E13.m1.5.5.1.1.1.2">delimited-[]</csymbol><apply id="A1.E13.m1.5.5.1.1.1.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1"><minus id="A1.E13.m1.5.5.1.1.1.1.2.cmml" xref="A1.E13.m1.5.5.1.1.1.1.2"></minus><apply id="A1.E13.m1.5.5.1.1.1.1.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1"><times id="A1.E13.m1.5.5.1.1.1.1.1.2.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.2"></times><apply id="A1.E13.m1.5.5.1.1.1.1.1.3.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.E13.m1.5.5.1.1.1.1.1.3.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.3">subscript</csymbol><ci id="A1.E13.m1.5.5.1.1.1.1.1.3.2.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.3.2">𝔼</ci><apply id="A1.E13.m1.1.1.1.cmml" xref="A1.E13.m1.1.1.1"><csymbol cd="latexml" id="A1.E13.m1.1.1.1.2.cmml" xref="A1.E13.m1.1.1.1.2">similar-to</csymbol><ci id="A1.E13.m1.1.1.1.3.cmml" xref="A1.E13.m1.1.1.1.3">𝑦</ci><apply id="A1.E13.m1.1.1.1.1.cmml" xref="A1.E13.m1.1.1.1.1"><times id="A1.E13.m1.1.1.1.1.2.cmml" xref="A1.E13.m1.1.1.1.1.2"></times><ci id="A1.E13.m1.1.1.1.1.3.cmml" xref="A1.E13.m1.1.1.1.1.3">𝜋</ci><apply id="A1.E13.m1.1.1.1.1.1.1.1.cmml" xref="A1.E13.m1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E13.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.E13.m1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.E13.m1.1.1.1.1.1.1.1.2.cmml" xref="A1.E13.m1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.E13.m1.1.1.1.1.1.1.1.3.cmml" xref="A1.E13.m1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply><apply id="A1.E13.m1.5.5.1.1.1.1.1.1.2.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E13.m1.5.5.1.1.1.1.1.1.2.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1.2">delimited-[]</csymbol><apply id="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1.1"><log id="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.1.1.1.1.1"></log><apply id="A1.E13.m1.3.3.cmml" xref="A1.E13.m1.3.3"><divide id="A1.E13.m1.3.3.3.cmml" xref="A1.E13.m1.3.3"></divide><apply id="A1.E13.m1.2.2.1.cmml" xref="A1.E13.m1.2.2.1"><times id="A1.E13.m1.2.2.1.2.cmml" xref="A1.E13.m1.2.2.1.2"></times><ci id="A1.E13.m1.2.2.1.3.cmml" xref="A1.E13.m1.2.2.1.3">𝜋</ci><apply id="A1.E13.m1.2.2.1.1.1.1.cmml" xref="A1.E13.m1.2.2.1.1.1"><csymbol cd="latexml" id="A1.E13.m1.2.2.1.1.1.1.1.cmml" xref="A1.E13.m1.2.2.1.1.1.1.1">conditional</csymbol><ci id="A1.E13.m1.2.2.1.1.1.1.2.cmml" xref="A1.E13.m1.2.2.1.1.1.1.2">𝑦</ci><ci id="A1.E13.m1.2.2.1.1.1.1.3.cmml" xref="A1.E13.m1.2.2.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.E13.m1.3.3.2.cmml" xref="A1.E13.m1.3.3.2"><times id="A1.E13.m1.3.3.2.2.cmml" xref="A1.E13.m1.3.3.2.2"></times><apply id="A1.E13.m1.3.3.2.3.cmml" xref="A1.E13.m1.3.3.2.3"><csymbol cd="ambiguous" id="A1.E13.m1.3.3.2.3.1.cmml" xref="A1.E13.m1.3.3.2.3">superscript</csymbol><ci id="A1.E13.m1.3.3.2.3.2.cmml" xref="A1.E13.m1.3.3.2.3.2">𝜋</ci><times id="A1.E13.m1.3.3.2.3.3.cmml" xref="A1.E13.m1.3.3.2.3.3"></times></apply><apply id="A1.E13.m1.3.3.2.1.1.1.cmml" xref="A1.E13.m1.3.3.2.1.1"><csymbol cd="latexml" id="A1.E13.m1.3.3.2.1.1.1.1.cmml" xref="A1.E13.m1.3.3.2.1.1.1.1">conditional</csymbol><ci id="A1.E13.m1.3.3.2.1.1.1.2.cmml" xref="A1.E13.m1.3.3.2.1.1.1.2">𝑦</ci><ci id="A1.E13.m1.3.3.2.1.1.1.3.cmml" xref="A1.E13.m1.3.3.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.E13.m1.5.5.1.1.1.1.3.cmml" xref="A1.E13.m1.5.5.1.1.1.1.3"><times id="A1.E13.m1.5.5.1.1.1.1.3.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.3.1"></times><apply id="A1.E13.m1.5.5.1.1.1.1.3.2.cmml" xref="A1.E13.m1.5.5.1.1.1.1.3.2"><log id="A1.E13.m1.5.5.1.1.1.1.3.2.1.cmml" xref="A1.E13.m1.5.5.1.1.1.1.3.2.1"></log><ci id="A1.E13.m1.5.5.1.1.1.1.3.2.2.cmml" xref="A1.E13.m1.5.5.1.1.1.1.3.2.2">𝑍</ci></apply><ci id="A1.E13.m1.4.4.cmml" xref="A1.E13.m1.4.4">𝑥</ci></apply></apply></apply></apply><csymbol cd="latexml" id="A1.E13.m1.5.5.3.cmml" xref="A1.E13.m1.5.5.3">absent</csymbol></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E13.m1.5c">\displaystyle\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\left[\mathbb{E}_{y\sim\pi%
(y|x)}\left[\log\frac{\pi(y|x)}{\pi^{*}(y|x)}\right]-\log Z(x)\right]=</annotation><annotation encoding="application/x-llamapun" id="A1.E13.m1.5d">roman_min start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D end_POSTSUBSCRIPT [ blackboard_E start_POSTSUBSCRIPT italic_y ∼ italic_π ( italic_y | italic_x ) end_POSTSUBSCRIPT [ roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) end_ARG ] - roman_log italic_Z ( italic_x ) ] =</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(13)</span></td>
</tr></tbody>
<tbody id="A1.E14"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\left[\mathbb{D}_{\text{KL%
}}(\pi(y|x)\mid\mid\pi^{*}(y|x))-\log Z(x)\right]" class="ltx_math_unparsed" display="inline" id="A1.E14.m1.1"><semantics id="A1.E14.m1.1a"><mrow id="A1.E14.m1.1b"><munder id="A1.E14.m1.1.1"><mi id="A1.E14.m1.1.1.2">min</mi><mi id="A1.E14.m1.1.1.3">π</mi></munder><msub id="A1.E14.m1.1.2"><mi id="A1.E14.m1.1.2.2">𝔼</mi><mrow id="A1.E14.m1.1.2.3"><mi id="A1.E14.m1.1.2.3.2">x</mi><mo id="A1.E14.m1.1.2.3.1">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E14.m1.1.2.3.3">𝒟</mi></mrow></msub><mrow id="A1.E14.m1.1.3"><mo id="A1.E14.m1.1.3.1">[</mo><msub id="A1.E14.m1.1.3.2"><mi id="A1.E14.m1.1.3.2.2">𝔻</mi><mtext id="A1.E14.m1.1.3.2.3">KL</mtext></msub><mrow id="A1.E14.m1.1.3.3"><mo id="A1.E14.m1.1.3.3.1" stretchy="false">(</mo><mi id="A1.E14.m1.1.3.3.2">π</mi><mrow id="A1.E14.m1.1.3.3.3"><mo id="A1.E14.m1.1.3.3.3.1" stretchy="false">(</mo><mi id="A1.E14.m1.1.3.3.3.2">y</mi><mo fence="false" id="A1.E14.m1.1.3.3.3.3" rspace="0.167em" stretchy="false">|</mo><mi id="A1.E14.m1.1.3.3.3.4">x</mi><mo id="A1.E14.m1.1.3.3.3.5" stretchy="false">)</mo></mrow><mo id="A1.E14.m1.1.3.3.4" lspace="0em" rspace="0.0835em">∣</mo><mo id="A1.E14.m1.1.3.3.5" lspace="0.0835em" rspace="0.167em">∣</mo><msup id="A1.E14.m1.1.3.3.6"><mi id="A1.E14.m1.1.3.3.6.2">π</mi><mo id="A1.E14.m1.1.3.3.6.3">*</mo></msup><mrow id="A1.E14.m1.1.3.3.7"><mo id="A1.E14.m1.1.3.3.7.1" stretchy="false">(</mo><mi id="A1.E14.m1.1.3.3.7.2">y</mi><mo fence="false" id="A1.E14.m1.1.3.3.7.3" rspace="0.167em" stretchy="false">|</mo><mi id="A1.E14.m1.1.3.3.7.4">x</mi><mo id="A1.E14.m1.1.3.3.7.5" stretchy="false">)</mo></mrow><mo id="A1.E14.m1.1.3.3.8" stretchy="false">)</mo></mrow><mo id="A1.E14.m1.1.3.4">−</mo><mi id="A1.E14.m1.1.3.5">log</mi><mi id="A1.E14.m1.1.3.6">Z</mi><mrow id="A1.E14.m1.1.3.7"><mo id="A1.E14.m1.1.3.7.1" stretchy="false">(</mo><mi id="A1.E14.m1.1.3.7.2">x</mi><mo id="A1.E14.m1.1.3.7.3" stretchy="false">)</mo></mrow><mo id="A1.E14.m1.1.3.8">]</mo></mrow></mrow><annotation encoding="application/x-tex" id="A1.E14.m1.1c">\displaystyle\min_{\pi}\mathbb{E}_{x\sim\mathcal{D}}\left[\mathbb{D}_{\text{KL%
}}(\pi(y|x)\mid\mid\pi^{*}(y|x))-\log Z(x)\right]</annotation><annotation encoding="application/x-llamapun" id="A1.E14.m1.1d">roman_min start_POSTSUBSCRIPT italic_π end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D end_POSTSUBSCRIPT [ blackboard_D start_POSTSUBSCRIPT KL end_POSTSUBSCRIPT ( italic_π ( italic_y | italic_x ) ∣ ∣ italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) ) - roman_log italic_Z ( italic_x ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(14)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS1.p4.7">Now, since <math alttext="Z(x)" class="ltx_Math" display="inline" id="A1.SS1.p4.6.m1.1"><semantics id="A1.SS1.p4.6.m1.1a"><mrow id="A1.SS1.p4.6.m1.1.2" xref="A1.SS1.p4.6.m1.1.2.cmml"><mi id="A1.SS1.p4.6.m1.1.2.2" xref="A1.SS1.p4.6.m1.1.2.2.cmml">Z</mi><mo id="A1.SS1.p4.6.m1.1.2.1" xref="A1.SS1.p4.6.m1.1.2.1.cmml">⁢</mo><mrow id="A1.SS1.p4.6.m1.1.2.3.2" xref="A1.SS1.p4.6.m1.1.2.cmml"><mo id="A1.SS1.p4.6.m1.1.2.3.2.1" stretchy="false" xref="A1.SS1.p4.6.m1.1.2.cmml">(</mo><mi id="A1.SS1.p4.6.m1.1.1" xref="A1.SS1.p4.6.m1.1.1.cmml">x</mi><mo id="A1.SS1.p4.6.m1.1.2.3.2.2" stretchy="false" xref="A1.SS1.p4.6.m1.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.6.m1.1b"><apply id="A1.SS1.p4.6.m1.1.2.cmml" xref="A1.SS1.p4.6.m1.1.2"><times id="A1.SS1.p4.6.m1.1.2.1.cmml" xref="A1.SS1.p4.6.m1.1.2.1"></times><ci id="A1.SS1.p4.6.m1.1.2.2.cmml" xref="A1.SS1.p4.6.m1.1.2.2">𝑍</ci><ci id="A1.SS1.p4.6.m1.1.1.cmml" xref="A1.SS1.p4.6.m1.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.6.m1.1c">Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.6.m1.1d">italic_Z ( italic_x )</annotation></semantics></math> does not depend on <math alttext="\pi" class="ltx_Math" display="inline" id="A1.SS1.p4.7.m2.1"><semantics id="A1.SS1.p4.7.m2.1a"><mi id="A1.SS1.p4.7.m2.1.1" xref="A1.SS1.p4.7.m2.1.1.cmml">π</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.7.m2.1b"><ci id="A1.SS1.p4.7.m2.1.1.cmml" xref="A1.SS1.p4.7.m2.1.1">𝜋</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.7.m2.1c">\pi</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.7.m2.1d">italic_π</annotation></semantics></math>, the minimum is achieved by the policy that minimizes the first KL term. Gibbs’ inequality tells us that the KL-divergence is minimized at 0 if and only if the two distributions are identical. Hence we have the optimal solution:
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E15">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\pi(y|x)=\pi^{*}(y|x)=\frac{1}{Z(x)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{%
\beta}r(x,y)\right)" class="ltx_Math" display="block" id="A1.E15.m1.8"><semantics id="A1.E15.m1.8a"><mrow id="A1.E15.m1.8.8" xref="A1.E15.m1.8.8.cmml"><mrow id="A1.E15.m1.5.5.1" xref="A1.E15.m1.5.5.1.cmml"><mi id="A1.E15.m1.5.5.1.3" xref="A1.E15.m1.5.5.1.3.cmml">π</mi><mo id="A1.E15.m1.5.5.1.2" xref="A1.E15.m1.5.5.1.2.cmml">⁢</mo><mrow id="A1.E15.m1.5.5.1.1.1" xref="A1.E15.m1.5.5.1.1.1.1.cmml"><mo id="A1.E15.m1.5.5.1.1.1.2" stretchy="false" xref="A1.E15.m1.5.5.1.1.1.1.cmml">(</mo><mrow id="A1.E15.m1.5.5.1.1.1.1" xref="A1.E15.m1.5.5.1.1.1.1.cmml"><mi id="A1.E15.m1.5.5.1.1.1.1.2" xref="A1.E15.m1.5.5.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E15.m1.5.5.1.1.1.1.1" xref="A1.E15.m1.5.5.1.1.1.1.1.cmml">|</mo><mi id="A1.E15.m1.5.5.1.1.1.1.3" xref="A1.E15.m1.5.5.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E15.m1.5.5.1.1.1.3" stretchy="false" xref="A1.E15.m1.5.5.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E15.m1.8.8.6" xref="A1.E15.m1.8.8.6.cmml">=</mo><mrow id="A1.E15.m1.6.6.2" xref="A1.E15.m1.6.6.2.cmml"><msup id="A1.E15.m1.6.6.2.3" xref="A1.E15.m1.6.6.2.3.cmml"><mi id="A1.E15.m1.6.6.2.3.2" xref="A1.E15.m1.6.6.2.3.2.cmml">π</mi><mo id="A1.E15.m1.6.6.2.3.3" xref="A1.E15.m1.6.6.2.3.3.cmml">*</mo></msup><mo id="A1.E15.m1.6.6.2.2" xref="A1.E15.m1.6.6.2.2.cmml">⁢</mo><mrow id="A1.E15.m1.6.6.2.1.1" xref="A1.E15.m1.6.6.2.1.1.1.cmml"><mo id="A1.E15.m1.6.6.2.1.1.2" stretchy="false" xref="A1.E15.m1.6.6.2.1.1.1.cmml">(</mo><mrow id="A1.E15.m1.6.6.2.1.1.1" xref="A1.E15.m1.6.6.2.1.1.1.cmml"><mi id="A1.E15.m1.6.6.2.1.1.1.2" xref="A1.E15.m1.6.6.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E15.m1.6.6.2.1.1.1.1" xref="A1.E15.m1.6.6.2.1.1.1.1.cmml">|</mo><mi id="A1.E15.m1.6.6.2.1.1.1.3" xref="A1.E15.m1.6.6.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E15.m1.6.6.2.1.1.3" stretchy="false" xref="A1.E15.m1.6.6.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E15.m1.8.8.7" xref="A1.E15.m1.8.8.7.cmml">=</mo><mrow id="A1.E15.m1.8.8.4" xref="A1.E15.m1.8.8.4.cmml"><mfrac id="A1.E15.m1.1.1" xref="A1.E15.m1.1.1.cmml"><mn id="A1.E15.m1.1.1.3" xref="A1.E15.m1.1.1.3.cmml">1</mn><mrow id="A1.E15.m1.1.1.1" xref="A1.E15.m1.1.1.1.cmml"><mi id="A1.E15.m1.1.1.1.3" xref="A1.E15.m1.1.1.1.3.cmml">Z</mi><mo id="A1.E15.m1.1.1.1.2" xref="A1.E15.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E15.m1.1.1.1.4.2" xref="A1.E15.m1.1.1.1.cmml"><mo id="A1.E15.m1.1.1.1.4.2.1" stretchy="false" xref="A1.E15.m1.1.1.1.cmml">(</mo><mi id="A1.E15.m1.1.1.1.1" xref="A1.E15.m1.1.1.1.1.cmml">x</mi><mo id="A1.E15.m1.1.1.1.4.2.2" stretchy="false" xref="A1.E15.m1.1.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="A1.E15.m1.8.8.4.3" xref="A1.E15.m1.8.8.4.3.cmml">⁢</mo><msub id="A1.E15.m1.8.8.4.4" xref="A1.E15.m1.8.8.4.4.cmml"><mi id="A1.E15.m1.8.8.4.4.2" xref="A1.E15.m1.8.8.4.4.2.cmml">π</mi><mtext id="A1.E15.m1.8.8.4.4.3" xref="A1.E15.m1.8.8.4.4.3a.cmml">ref</mtext></msub><mo id="A1.E15.m1.8.8.4.3a" xref="A1.E15.m1.8.8.4.3.cmml">⁢</mo><mrow id="A1.E15.m1.7.7.3.1.1" xref="A1.E15.m1.7.7.3.1.1.1.cmml"><mo id="A1.E15.m1.7.7.3.1.1.2" stretchy="false" xref="A1.E15.m1.7.7.3.1.1.1.cmml">(</mo><mrow id="A1.E15.m1.7.7.3.1.1.1" xref="A1.E15.m1.7.7.3.1.1.1.cmml"><mi id="A1.E15.m1.7.7.3.1.1.1.2" xref="A1.E15.m1.7.7.3.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E15.m1.7.7.3.1.1.1.1" xref="A1.E15.m1.7.7.3.1.1.1.1.cmml">|</mo><mi id="A1.E15.m1.7.7.3.1.1.1.3" xref="A1.E15.m1.7.7.3.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E15.m1.7.7.3.1.1.3" stretchy="false" xref="A1.E15.m1.7.7.3.1.1.1.cmml">)</mo></mrow><mo id="A1.E15.m1.8.8.4.3b" lspace="0.167em" xref="A1.E15.m1.8.8.4.3.cmml">⁢</mo><mrow id="A1.E15.m1.8.8.4.2.1" xref="A1.E15.m1.8.8.4.2.2.cmml"><mi id="A1.E15.m1.4.4" xref="A1.E15.m1.4.4.cmml">exp</mi><mo id="A1.E15.m1.8.8.4.2.1a" xref="A1.E15.m1.8.8.4.2.2.cmml">⁡</mo><mrow id="A1.E15.m1.8.8.4.2.1.1" xref="A1.E15.m1.8.8.4.2.2.cmml"><mo id="A1.E15.m1.8.8.4.2.1.1.2" xref="A1.E15.m1.8.8.4.2.2.cmml">(</mo><mrow id="A1.E15.m1.8.8.4.2.1.1.1" xref="A1.E15.m1.8.8.4.2.1.1.1.cmml"><mfrac id="A1.E15.m1.8.8.4.2.1.1.1.2" xref="A1.E15.m1.8.8.4.2.1.1.1.2.cmml"><mn id="A1.E15.m1.8.8.4.2.1.1.1.2.2" xref="A1.E15.m1.8.8.4.2.1.1.1.2.2.cmml">1</mn><mi id="A1.E15.m1.8.8.4.2.1.1.1.2.3" xref="A1.E15.m1.8.8.4.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.E15.m1.8.8.4.2.1.1.1.1" xref="A1.E15.m1.8.8.4.2.1.1.1.1.cmml">⁢</mo><mi id="A1.E15.m1.8.8.4.2.1.1.1.3" xref="A1.E15.m1.8.8.4.2.1.1.1.3.cmml">r</mi><mo id="A1.E15.m1.8.8.4.2.1.1.1.1a" xref="A1.E15.m1.8.8.4.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.E15.m1.8.8.4.2.1.1.1.4.2" xref="A1.E15.m1.8.8.4.2.1.1.1.4.1.cmml"><mo id="A1.E15.m1.8.8.4.2.1.1.1.4.2.1" stretchy="false" xref="A1.E15.m1.8.8.4.2.1.1.1.4.1.cmml">(</mo><mi id="A1.E15.m1.2.2" xref="A1.E15.m1.2.2.cmml">x</mi><mo id="A1.E15.m1.8.8.4.2.1.1.1.4.2.2" xref="A1.E15.m1.8.8.4.2.1.1.1.4.1.cmml">,</mo><mi id="A1.E15.m1.3.3" xref="A1.E15.m1.3.3.cmml">y</mi><mo id="A1.E15.m1.8.8.4.2.1.1.1.4.2.3" stretchy="false" xref="A1.E15.m1.8.8.4.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.E15.m1.8.8.4.2.1.1.3" xref="A1.E15.m1.8.8.4.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E15.m1.8b"><apply id="A1.E15.m1.8.8.cmml" xref="A1.E15.m1.8.8"><and id="A1.E15.m1.8.8a.cmml" xref="A1.E15.m1.8.8"></and><apply id="A1.E15.m1.8.8b.cmml" xref="A1.E15.m1.8.8"><eq id="A1.E15.m1.8.8.6.cmml" xref="A1.E15.m1.8.8.6"></eq><apply id="A1.E15.m1.5.5.1.cmml" xref="A1.E15.m1.5.5.1"><times id="A1.E15.m1.5.5.1.2.cmml" xref="A1.E15.m1.5.5.1.2"></times><ci id="A1.E15.m1.5.5.1.3.cmml" xref="A1.E15.m1.5.5.1.3">𝜋</ci><apply id="A1.E15.m1.5.5.1.1.1.1.cmml" xref="A1.E15.m1.5.5.1.1.1"><csymbol cd="latexml" id="A1.E15.m1.5.5.1.1.1.1.1.cmml" xref="A1.E15.m1.5.5.1.1.1.1.1">conditional</csymbol><ci id="A1.E15.m1.5.5.1.1.1.1.2.cmml" xref="A1.E15.m1.5.5.1.1.1.1.2">𝑦</ci><ci id="A1.E15.m1.5.5.1.1.1.1.3.cmml" xref="A1.E15.m1.5.5.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.E15.m1.6.6.2.cmml" xref="A1.E15.m1.6.6.2"><times id="A1.E15.m1.6.6.2.2.cmml" xref="A1.E15.m1.6.6.2.2"></times><apply id="A1.E15.m1.6.6.2.3.cmml" xref="A1.E15.m1.6.6.2.3"><csymbol cd="ambiguous" id="A1.E15.m1.6.6.2.3.1.cmml" xref="A1.E15.m1.6.6.2.3">superscript</csymbol><ci id="A1.E15.m1.6.6.2.3.2.cmml" xref="A1.E15.m1.6.6.2.3.2">𝜋</ci><times id="A1.E15.m1.6.6.2.3.3.cmml" xref="A1.E15.m1.6.6.2.3.3"></times></apply><apply id="A1.E15.m1.6.6.2.1.1.1.cmml" xref="A1.E15.m1.6.6.2.1.1"><csymbol cd="latexml" id="A1.E15.m1.6.6.2.1.1.1.1.cmml" xref="A1.E15.m1.6.6.2.1.1.1.1">conditional</csymbol><ci id="A1.E15.m1.6.6.2.1.1.1.2.cmml" xref="A1.E15.m1.6.6.2.1.1.1.2">𝑦</ci><ci id="A1.E15.m1.6.6.2.1.1.1.3.cmml" xref="A1.E15.m1.6.6.2.1.1.1.3">𝑥</ci></apply></apply></apply><apply id="A1.E15.m1.8.8c.cmml" xref="A1.E15.m1.8.8"><eq id="A1.E15.m1.8.8.7.cmml" xref="A1.E15.m1.8.8.7"></eq><share href="#A1.E15.m1.6.6.2.cmml" id="A1.E15.m1.8.8d.cmml" xref="A1.E15.m1.8.8"></share><apply id="A1.E15.m1.8.8.4.cmml" xref="A1.E15.m1.8.8.4"><times id="A1.E15.m1.8.8.4.3.cmml" xref="A1.E15.m1.8.8.4.3"></times><apply id="A1.E15.m1.1.1.cmml" xref="A1.E15.m1.1.1"><divide id="A1.E15.m1.1.1.2.cmml" xref="A1.E15.m1.1.1"></divide><cn id="A1.E15.m1.1.1.3.cmml" type="integer" xref="A1.E15.m1.1.1.3">1</cn><apply id="A1.E15.m1.1.1.1.cmml" xref="A1.E15.m1.1.1.1"><times id="A1.E15.m1.1.1.1.2.cmml" xref="A1.E15.m1.1.1.1.2"></times><ci id="A1.E15.m1.1.1.1.3.cmml" xref="A1.E15.m1.1.1.1.3">𝑍</ci><ci id="A1.E15.m1.1.1.1.1.cmml" xref="A1.E15.m1.1.1.1.1">𝑥</ci></apply></apply><apply id="A1.E15.m1.8.8.4.4.cmml" xref="A1.E15.m1.8.8.4.4"><csymbol cd="ambiguous" id="A1.E15.m1.8.8.4.4.1.cmml" xref="A1.E15.m1.8.8.4.4">subscript</csymbol><ci id="A1.E15.m1.8.8.4.4.2.cmml" xref="A1.E15.m1.8.8.4.4.2">𝜋</ci><ci id="A1.E15.m1.8.8.4.4.3a.cmml" xref="A1.E15.m1.8.8.4.4.3"><mtext id="A1.E15.m1.8.8.4.4.3.cmml" mathsize="70%" xref="A1.E15.m1.8.8.4.4.3">ref</mtext></ci></apply><apply id="A1.E15.m1.7.7.3.1.1.1.cmml" xref="A1.E15.m1.7.7.3.1.1"><csymbol cd="latexml" id="A1.E15.m1.7.7.3.1.1.1.1.cmml" xref="A1.E15.m1.7.7.3.1.1.1.1">conditional</csymbol><ci id="A1.E15.m1.7.7.3.1.1.1.2.cmml" xref="A1.E15.m1.7.7.3.1.1.1.2">𝑦</ci><ci id="A1.E15.m1.7.7.3.1.1.1.3.cmml" xref="A1.E15.m1.7.7.3.1.1.1.3">𝑥</ci></apply><apply id="A1.E15.m1.8.8.4.2.2.cmml" xref="A1.E15.m1.8.8.4.2.1"><exp id="A1.E15.m1.4.4.cmml" xref="A1.E15.m1.4.4"></exp><apply id="A1.E15.m1.8.8.4.2.1.1.1.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1"><times id="A1.E15.m1.8.8.4.2.1.1.1.1.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1.1"></times><apply id="A1.E15.m1.8.8.4.2.1.1.1.2.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1.2"><divide id="A1.E15.m1.8.8.4.2.1.1.1.2.1.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1.2"></divide><cn id="A1.E15.m1.8.8.4.2.1.1.1.2.2.cmml" type="integer" xref="A1.E15.m1.8.8.4.2.1.1.1.2.2">1</cn><ci id="A1.E15.m1.8.8.4.2.1.1.1.2.3.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.E15.m1.8.8.4.2.1.1.1.3.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.E15.m1.8.8.4.2.1.1.1.4.1.cmml" xref="A1.E15.m1.8.8.4.2.1.1.1.4.2"><ci id="A1.E15.m1.2.2.cmml" xref="A1.E15.m1.2.2">𝑥</ci><ci id="A1.E15.m1.3.3.cmml" xref="A1.E15.m1.3.3">𝑦</ci></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E15.m1.8c">\pi(y|x)=\pi^{*}(y|x)=\frac{1}{Z(x)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{%
\beta}r(x,y)\right)</annotation><annotation encoding="application/x-llamapun" id="A1.E15.m1.8d">italic_π ( italic_y | italic_x ) = italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) = divide start_ARG 1 end_ARG start_ARG italic_Z ( italic_x ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(15)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS1.p4.8">for all <math alttext="x\in\mathcal{D}" class="ltx_Math" display="inline" id="A1.SS1.p4.8.m1.1"><semantics id="A1.SS1.p4.8.m1.1a"><mrow id="A1.SS1.p4.8.m1.1.1" xref="A1.SS1.p4.8.m1.1.1.cmml"><mi id="A1.SS1.p4.8.m1.1.1.2" xref="A1.SS1.p4.8.m1.1.1.2.cmml">x</mi><mo id="A1.SS1.p4.8.m1.1.1.1" xref="A1.SS1.p4.8.m1.1.1.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="A1.SS1.p4.8.m1.1.1.3" xref="A1.SS1.p4.8.m1.1.1.3.cmml">𝒟</mi></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.8.m1.1b"><apply id="A1.SS1.p4.8.m1.1.1.cmml" xref="A1.SS1.p4.8.m1.1.1"><in id="A1.SS1.p4.8.m1.1.1.1.cmml" xref="A1.SS1.p4.8.m1.1.1.1"></in><ci id="A1.SS1.p4.8.m1.1.1.2.cmml" xref="A1.SS1.p4.8.m1.1.1.2">𝑥</ci><ci id="A1.SS1.p4.8.m1.1.1.3.cmml" xref="A1.SS1.p4.8.m1.1.1.3">𝒟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.8.m1.1c">x\in\mathcal{D}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.8.m1.1d">italic_x ∈ caligraphic_D</annotation></semantics></math>. This completes the derivation.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="A1.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.2 </span>Deriving the DPO Objective Under the Bradley-Terry Model</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS2.p1">
<p class="ltx_p" id="A1.SS2.p1.1">It is straightforward to derive the DPO objective under the Bradley-Terry preference model as we have</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E16">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p^{*}(y_{1}\succ y_{2}|x)=\frac{\exp\left(r^{*}(x,y_{1})\right)}{\exp\left(r^{%
*}(x,y_{1})\right)+\exp\left(r^{*}(x,y_{2})\right)}" class="ltx_Math" display="block" id="A1.E16.m1.10"><semantics id="A1.E16.m1.10a"><mrow id="A1.E16.m1.10.10" xref="A1.E16.m1.10.10.cmml"><mrow id="A1.E16.m1.10.10.1" xref="A1.E16.m1.10.10.1.cmml"><msup id="A1.E16.m1.10.10.1.3" xref="A1.E16.m1.10.10.1.3.cmml"><mi id="A1.E16.m1.10.10.1.3.2" xref="A1.E16.m1.10.10.1.3.2.cmml">p</mi><mo id="A1.E16.m1.10.10.1.3.3" xref="A1.E16.m1.10.10.1.3.3.cmml">*</mo></msup><mo id="A1.E16.m1.10.10.1.2" xref="A1.E16.m1.10.10.1.2.cmml">⁢</mo><mrow id="A1.E16.m1.10.10.1.1.1" xref="A1.E16.m1.10.10.1.1.1.1.cmml"><mo id="A1.E16.m1.10.10.1.1.1.2" stretchy="false" xref="A1.E16.m1.10.10.1.1.1.1.cmml">(</mo><mrow id="A1.E16.m1.10.10.1.1.1.1" xref="A1.E16.m1.10.10.1.1.1.1.cmml"><msub id="A1.E16.m1.10.10.1.1.1.1.2" xref="A1.E16.m1.10.10.1.1.1.1.2.cmml"><mi id="A1.E16.m1.10.10.1.1.1.1.2.2" xref="A1.E16.m1.10.10.1.1.1.1.2.2.cmml">y</mi><mn id="A1.E16.m1.10.10.1.1.1.1.2.3" xref="A1.E16.m1.10.10.1.1.1.1.2.3.cmml">1</mn></msub><mo id="A1.E16.m1.10.10.1.1.1.1.1" xref="A1.E16.m1.10.10.1.1.1.1.1.cmml">≻</mo><mrow id="A1.E16.m1.10.10.1.1.1.1.3" xref="A1.E16.m1.10.10.1.1.1.1.3.cmml"><msub id="A1.E16.m1.10.10.1.1.1.1.3.2" xref="A1.E16.m1.10.10.1.1.1.1.3.2.cmml"><mi id="A1.E16.m1.10.10.1.1.1.1.3.2.2" xref="A1.E16.m1.10.10.1.1.1.1.3.2.2.cmml">y</mi><mn id="A1.E16.m1.10.10.1.1.1.1.3.2.3" xref="A1.E16.m1.10.10.1.1.1.1.3.2.3.cmml">2</mn></msub><mo fence="false" id="A1.E16.m1.10.10.1.1.1.1.3.1" xref="A1.E16.m1.10.10.1.1.1.1.3.1.cmml">|</mo><mi id="A1.E16.m1.10.10.1.1.1.1.3.3" xref="A1.E16.m1.10.10.1.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="A1.E16.m1.10.10.1.1.1.3" stretchy="false" xref="A1.E16.m1.10.10.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E16.m1.10.10.2" xref="A1.E16.m1.10.10.2.cmml">=</mo><mfrac id="A1.E16.m1.9.9" xref="A1.E16.m1.9.9.cmml"><mrow id="A1.E16.m1.3.3.3.3" xref="A1.E16.m1.3.3.3.4.cmml"><mi id="A1.E16.m1.2.2.2.2" xref="A1.E16.m1.2.2.2.2.cmml">exp</mi><mo id="A1.E16.m1.3.3.3.3a" xref="A1.E16.m1.3.3.3.4.cmml">⁡</mo><mrow id="A1.E16.m1.3.3.3.3.1" xref="A1.E16.m1.3.3.3.4.cmml"><mo id="A1.E16.m1.3.3.3.3.1.2" xref="A1.E16.m1.3.3.3.4.cmml">(</mo><mrow id="A1.E16.m1.3.3.3.3.1.1" xref="A1.E16.m1.3.3.3.3.1.1.cmml"><msup id="A1.E16.m1.3.3.3.3.1.1.3" xref="A1.E16.m1.3.3.3.3.1.1.3.cmml"><mi id="A1.E16.m1.3.3.3.3.1.1.3.2" xref="A1.E16.m1.3.3.3.3.1.1.3.2.cmml">r</mi><mo id="A1.E16.m1.3.3.3.3.1.1.3.3" xref="A1.E16.m1.3.3.3.3.1.1.3.3.cmml">*</mo></msup><mo id="A1.E16.m1.3.3.3.3.1.1.2" xref="A1.E16.m1.3.3.3.3.1.1.2.cmml">⁢</mo><mrow id="A1.E16.m1.3.3.3.3.1.1.1.1" xref="A1.E16.m1.3.3.3.3.1.1.1.2.cmml"><mo id="A1.E16.m1.3.3.3.3.1.1.1.1.2" stretchy="false" xref="A1.E16.m1.3.3.3.3.1.1.1.2.cmml">(</mo><mi id="A1.E16.m1.1.1.1.1" xref="A1.E16.m1.1.1.1.1.cmml">x</mi><mo id="A1.E16.m1.3.3.3.3.1.1.1.1.3" xref="A1.E16.m1.3.3.3.3.1.1.1.2.cmml">,</mo><msub id="A1.E16.m1.3.3.3.3.1.1.1.1.1" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1.cmml"><mi id="A1.E16.m1.3.3.3.3.1.1.1.1.1.2" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E16.m1.3.3.3.3.1.1.1.1.1.3" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.E16.m1.3.3.3.3.1.1.1.1.4" stretchy="false" xref="A1.E16.m1.3.3.3.3.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E16.m1.3.3.3.3.1.3" xref="A1.E16.m1.3.3.3.4.cmml">)</mo></mrow></mrow><mrow id="A1.E16.m1.9.9.9" xref="A1.E16.m1.9.9.9.cmml"><mrow id="A1.E16.m1.8.8.8.5.1" xref="A1.E16.m1.8.8.8.5.2.cmml"><mi id="A1.E16.m1.5.5.5.2" xref="A1.E16.m1.5.5.5.2.cmml">exp</mi><mo id="A1.E16.m1.8.8.8.5.1a" xref="A1.E16.m1.8.8.8.5.2.cmml">⁡</mo><mrow id="A1.E16.m1.8.8.8.5.1.1" xref="A1.E16.m1.8.8.8.5.2.cmml"><mo id="A1.E16.m1.8.8.8.5.1.1.2" xref="A1.E16.m1.8.8.8.5.2.cmml">(</mo><mrow id="A1.E16.m1.8.8.8.5.1.1.1" xref="A1.E16.m1.8.8.8.5.1.1.1.cmml"><msup id="A1.E16.m1.8.8.8.5.1.1.1.3" xref="A1.E16.m1.8.8.8.5.1.1.1.3.cmml"><mi id="A1.E16.m1.8.8.8.5.1.1.1.3.2" xref="A1.E16.m1.8.8.8.5.1.1.1.3.2.cmml">r</mi><mo id="A1.E16.m1.8.8.8.5.1.1.1.3.3" xref="A1.E16.m1.8.8.8.5.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.E16.m1.8.8.8.5.1.1.1.2" xref="A1.E16.m1.8.8.8.5.1.1.1.2.cmml">⁢</mo><mrow id="A1.E16.m1.8.8.8.5.1.1.1.1.1" xref="A1.E16.m1.8.8.8.5.1.1.1.1.2.cmml"><mo id="A1.E16.m1.8.8.8.5.1.1.1.1.1.2" stretchy="false" xref="A1.E16.m1.8.8.8.5.1.1.1.1.2.cmml">(</mo><mi id="A1.E16.m1.4.4.4.1" xref="A1.E16.m1.4.4.4.1.cmml">x</mi><mo id="A1.E16.m1.8.8.8.5.1.1.1.1.1.3" xref="A1.E16.m1.8.8.8.5.1.1.1.1.2.cmml">,</mo><msub id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.cmml"><mi id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.2" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.3" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.E16.m1.8.8.8.5.1.1.1.1.1.4" stretchy="false" xref="A1.E16.m1.8.8.8.5.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E16.m1.8.8.8.5.1.1.3" xref="A1.E16.m1.8.8.8.5.2.cmml">)</mo></mrow></mrow><mo id="A1.E16.m1.9.9.9.7" xref="A1.E16.m1.9.9.9.7.cmml">+</mo><mrow id="A1.E16.m1.9.9.9.6.1" xref="A1.E16.m1.9.9.9.6.2.cmml"><mi id="A1.E16.m1.7.7.7.4" xref="A1.E16.m1.7.7.7.4.cmml">exp</mi><mo id="A1.E16.m1.9.9.9.6.1a" xref="A1.E16.m1.9.9.9.6.2.cmml">⁡</mo><mrow id="A1.E16.m1.9.9.9.6.1.1" xref="A1.E16.m1.9.9.9.6.2.cmml"><mo id="A1.E16.m1.9.9.9.6.1.1.2" xref="A1.E16.m1.9.9.9.6.2.cmml">(</mo><mrow id="A1.E16.m1.9.9.9.6.1.1.1" xref="A1.E16.m1.9.9.9.6.1.1.1.cmml"><msup id="A1.E16.m1.9.9.9.6.1.1.1.3" xref="A1.E16.m1.9.9.9.6.1.1.1.3.cmml"><mi id="A1.E16.m1.9.9.9.6.1.1.1.3.2" xref="A1.E16.m1.9.9.9.6.1.1.1.3.2.cmml">r</mi><mo id="A1.E16.m1.9.9.9.6.1.1.1.3.3" xref="A1.E16.m1.9.9.9.6.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.E16.m1.9.9.9.6.1.1.1.2" xref="A1.E16.m1.9.9.9.6.1.1.1.2.cmml">⁢</mo><mrow id="A1.E16.m1.9.9.9.6.1.1.1.1.1" xref="A1.E16.m1.9.9.9.6.1.1.1.1.2.cmml"><mo id="A1.E16.m1.9.9.9.6.1.1.1.1.1.2" stretchy="false" xref="A1.E16.m1.9.9.9.6.1.1.1.1.2.cmml">(</mo><mi id="A1.E16.m1.6.6.6.3" xref="A1.E16.m1.6.6.6.3.cmml">x</mi><mo id="A1.E16.m1.9.9.9.6.1.1.1.1.1.3" xref="A1.E16.m1.9.9.9.6.1.1.1.1.2.cmml">,</mo><msub id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.cmml"><mi id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.2" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.3" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.3.cmml">2</mn></msub><mo id="A1.E16.m1.9.9.9.6.1.1.1.1.1.4" stretchy="false" xref="A1.E16.m1.9.9.9.6.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E16.m1.9.9.9.6.1.1.3" xref="A1.E16.m1.9.9.9.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow><annotation-xml encoding="MathML-Content" id="A1.E16.m1.10b"><apply id="A1.E16.m1.10.10.cmml" xref="A1.E16.m1.10.10"><eq id="A1.E16.m1.10.10.2.cmml" xref="A1.E16.m1.10.10.2"></eq><apply id="A1.E16.m1.10.10.1.cmml" xref="A1.E16.m1.10.10.1"><times id="A1.E16.m1.10.10.1.2.cmml" xref="A1.E16.m1.10.10.1.2"></times><apply id="A1.E16.m1.10.10.1.3.cmml" xref="A1.E16.m1.10.10.1.3"><csymbol cd="ambiguous" id="A1.E16.m1.10.10.1.3.1.cmml" xref="A1.E16.m1.10.10.1.3">superscript</csymbol><ci id="A1.E16.m1.10.10.1.3.2.cmml" xref="A1.E16.m1.10.10.1.3.2">𝑝</ci><times id="A1.E16.m1.10.10.1.3.3.cmml" xref="A1.E16.m1.10.10.1.3.3"></times></apply><apply id="A1.E16.m1.10.10.1.1.1.1.cmml" xref="A1.E16.m1.10.10.1.1.1"><csymbol cd="latexml" id="A1.E16.m1.10.10.1.1.1.1.1.cmml" xref="A1.E16.m1.10.10.1.1.1.1.1">succeeds</csymbol><apply id="A1.E16.m1.10.10.1.1.1.1.2.cmml" xref="A1.E16.m1.10.10.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.E16.m1.10.10.1.1.1.1.2.1.cmml" xref="A1.E16.m1.10.10.1.1.1.1.2">subscript</csymbol><ci id="A1.E16.m1.10.10.1.1.1.1.2.2.cmml" xref="A1.E16.m1.10.10.1.1.1.1.2.2">𝑦</ci><cn id="A1.E16.m1.10.10.1.1.1.1.2.3.cmml" type="integer" xref="A1.E16.m1.10.10.1.1.1.1.2.3">1</cn></apply><apply id="A1.E16.m1.10.10.1.1.1.1.3.cmml" xref="A1.E16.m1.10.10.1.1.1.1.3"><csymbol cd="latexml" id="A1.E16.m1.10.10.1.1.1.1.3.1.cmml" xref="A1.E16.m1.10.10.1.1.1.1.3.1">conditional</csymbol><apply id="A1.E16.m1.10.10.1.1.1.1.3.2.cmml" xref="A1.E16.m1.10.10.1.1.1.1.3.2"><csymbol cd="ambiguous" id="A1.E16.m1.10.10.1.1.1.1.3.2.1.cmml" xref="A1.E16.m1.10.10.1.1.1.1.3.2">subscript</csymbol><ci id="A1.E16.m1.10.10.1.1.1.1.3.2.2.cmml" xref="A1.E16.m1.10.10.1.1.1.1.3.2.2">𝑦</ci><cn id="A1.E16.m1.10.10.1.1.1.1.3.2.3.cmml" type="integer" xref="A1.E16.m1.10.10.1.1.1.1.3.2.3">2</cn></apply><ci id="A1.E16.m1.10.10.1.1.1.1.3.3.cmml" xref="A1.E16.m1.10.10.1.1.1.1.3.3">𝑥</ci></apply></apply></apply><apply id="A1.E16.m1.9.9.cmml" xref="A1.E16.m1.9.9"><divide id="A1.E16.m1.9.9.10.cmml" xref="A1.E16.m1.9.9"></divide><apply id="A1.E16.m1.3.3.3.4.cmml" xref="A1.E16.m1.3.3.3.3"><exp id="A1.E16.m1.2.2.2.2.cmml" xref="A1.E16.m1.2.2.2.2"></exp><apply id="A1.E16.m1.3.3.3.3.1.1.cmml" xref="A1.E16.m1.3.3.3.3.1.1"><times id="A1.E16.m1.3.3.3.3.1.1.2.cmml" xref="A1.E16.m1.3.3.3.3.1.1.2"></times><apply id="A1.E16.m1.3.3.3.3.1.1.3.cmml" xref="A1.E16.m1.3.3.3.3.1.1.3"><csymbol cd="ambiguous" id="A1.E16.m1.3.3.3.3.1.1.3.1.cmml" xref="A1.E16.m1.3.3.3.3.1.1.3">superscript</csymbol><ci id="A1.E16.m1.3.3.3.3.1.1.3.2.cmml" xref="A1.E16.m1.3.3.3.3.1.1.3.2">𝑟</ci><times id="A1.E16.m1.3.3.3.3.1.1.3.3.cmml" xref="A1.E16.m1.3.3.3.3.1.1.3.3"></times></apply><interval closure="open" id="A1.E16.m1.3.3.3.3.1.1.1.2.cmml" xref="A1.E16.m1.3.3.3.3.1.1.1.1"><ci id="A1.E16.m1.1.1.1.1.cmml" xref="A1.E16.m1.1.1.1.1">𝑥</ci><apply id="A1.E16.m1.3.3.3.3.1.1.1.1.1.cmml" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E16.m1.3.3.3.3.1.1.1.1.1.1.cmml" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1">subscript</csymbol><ci id="A1.E16.m1.3.3.3.3.1.1.1.1.1.2.cmml" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1.2">𝑦</ci><cn id="A1.E16.m1.3.3.3.3.1.1.1.1.1.3.cmml" type="integer" xref="A1.E16.m1.3.3.3.3.1.1.1.1.1.3">1</cn></apply></interval></apply></apply><apply id="A1.E16.m1.9.9.9.cmml" xref="A1.E16.m1.9.9.9"><plus id="A1.E16.m1.9.9.9.7.cmml" xref="A1.E16.m1.9.9.9.7"></plus><apply id="A1.E16.m1.8.8.8.5.2.cmml" xref="A1.E16.m1.8.8.8.5.1"><exp id="A1.E16.m1.5.5.5.2.cmml" xref="A1.E16.m1.5.5.5.2"></exp><apply id="A1.E16.m1.8.8.8.5.1.1.1.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1"><times id="A1.E16.m1.8.8.8.5.1.1.1.2.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.2"></times><apply id="A1.E16.m1.8.8.8.5.1.1.1.3.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.3"><csymbol cd="ambiguous" id="A1.E16.m1.8.8.8.5.1.1.1.3.1.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.3">superscript</csymbol><ci id="A1.E16.m1.8.8.8.5.1.1.1.3.2.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.3.2">𝑟</ci><times id="A1.E16.m1.8.8.8.5.1.1.1.3.3.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.3.3"></times></apply><interval closure="open" id="A1.E16.m1.8.8.8.5.1.1.1.1.2.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1"><ci id="A1.E16.m1.4.4.4.1.cmml" xref="A1.E16.m1.4.4.4.1">𝑥</ci><apply id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.1.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.2.cmml" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.E16.m1.8.8.8.5.1.1.1.1.1.1.3">1</cn></apply></interval></apply></apply><apply id="A1.E16.m1.9.9.9.6.2.cmml" xref="A1.E16.m1.9.9.9.6.1"><exp id="A1.E16.m1.7.7.7.4.cmml" xref="A1.E16.m1.7.7.7.4"></exp><apply id="A1.E16.m1.9.9.9.6.1.1.1.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1"><times id="A1.E16.m1.9.9.9.6.1.1.1.2.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.2"></times><apply id="A1.E16.m1.9.9.9.6.1.1.1.3.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.3"><csymbol cd="ambiguous" id="A1.E16.m1.9.9.9.6.1.1.1.3.1.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.3">superscript</csymbol><ci id="A1.E16.m1.9.9.9.6.1.1.1.3.2.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.3.2">𝑟</ci><times id="A1.E16.m1.9.9.9.6.1.1.1.3.3.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.3.3"></times></apply><interval closure="open" id="A1.E16.m1.9.9.9.6.1.1.1.1.2.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1"><ci id="A1.E16.m1.6.6.6.3.cmml" xref="A1.E16.m1.6.6.6.3">𝑥</ci><apply id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.1.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.2.cmml" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.E16.m1.9.9.9.6.1.1.1.1.1.1.3">2</cn></apply></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E16.m1.10c">p^{*}(y_{1}\succ y_{2}|x)=\frac{\exp\left(r^{*}(x,y_{1})\right)}{\exp\left(r^{%
*}(x,y_{1})\right)+\exp\left(r^{*}(x,y_{2})\right)}</annotation><annotation encoding="application/x-llamapun" id="A1.E16.m1.10d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ≻ italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) = divide start_ARG roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ) end_ARG start_ARG roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) ) + roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(16)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS2.p2">
<p class="ltx_p" id="A1.SS2.p2.1">In Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4" title="4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a> we showed that we can express the (unavailable) ground-truth reward through its corresponding optimal policy:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E17">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="r^{*}(x,y)=\beta\log\frac{\pi^{*}(y|x)}{\pi_{\text{ref}}(y|x)}+\beta\log Z(x)" class="ltx_Math" display="block" id="A1.E17.m1.5"><semantics id="A1.E17.m1.5a"><mrow id="A1.E17.m1.5.6" xref="A1.E17.m1.5.6.cmml"><mrow id="A1.E17.m1.5.6.2" xref="A1.E17.m1.5.6.2.cmml"><msup id="A1.E17.m1.5.6.2.2" xref="A1.E17.m1.5.6.2.2.cmml"><mi id="A1.E17.m1.5.6.2.2.2" xref="A1.E17.m1.5.6.2.2.2.cmml">r</mi><mo id="A1.E17.m1.5.6.2.2.3" xref="A1.E17.m1.5.6.2.2.3.cmml">*</mo></msup><mo id="A1.E17.m1.5.6.2.1" xref="A1.E17.m1.5.6.2.1.cmml">⁢</mo><mrow id="A1.E17.m1.5.6.2.3.2" xref="A1.E17.m1.5.6.2.3.1.cmml"><mo id="A1.E17.m1.5.6.2.3.2.1" stretchy="false" xref="A1.E17.m1.5.6.2.3.1.cmml">(</mo><mi id="A1.E17.m1.3.3" xref="A1.E17.m1.3.3.cmml">x</mi><mo id="A1.E17.m1.5.6.2.3.2.2" xref="A1.E17.m1.5.6.2.3.1.cmml">,</mo><mi id="A1.E17.m1.4.4" xref="A1.E17.m1.4.4.cmml">y</mi><mo id="A1.E17.m1.5.6.2.3.2.3" stretchy="false" xref="A1.E17.m1.5.6.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.E17.m1.5.6.1" xref="A1.E17.m1.5.6.1.cmml">=</mo><mrow id="A1.E17.m1.5.6.3" xref="A1.E17.m1.5.6.3.cmml"><mrow id="A1.E17.m1.5.6.3.2" xref="A1.E17.m1.5.6.3.2.cmml"><mi id="A1.E17.m1.5.6.3.2.2" xref="A1.E17.m1.5.6.3.2.2.cmml">β</mi><mo id="A1.E17.m1.5.6.3.2.1" lspace="0.167em" xref="A1.E17.m1.5.6.3.2.1.cmml">⁢</mo><mrow id="A1.E17.m1.5.6.3.2.3" xref="A1.E17.m1.5.6.3.2.3.cmml"><mi id="A1.E17.m1.5.6.3.2.3.1" xref="A1.E17.m1.5.6.3.2.3.1.cmml">log</mi><mo id="A1.E17.m1.5.6.3.2.3a" lspace="0.167em" xref="A1.E17.m1.5.6.3.2.3.cmml">⁡</mo><mfrac id="A1.E17.m1.2.2" xref="A1.E17.m1.2.2.cmml"><mrow id="A1.E17.m1.1.1.1" xref="A1.E17.m1.1.1.1.cmml"><msup id="A1.E17.m1.1.1.1.3" xref="A1.E17.m1.1.1.1.3.cmml"><mi id="A1.E17.m1.1.1.1.3.2" xref="A1.E17.m1.1.1.1.3.2.cmml">π</mi><mo id="A1.E17.m1.1.1.1.3.3" xref="A1.E17.m1.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.E17.m1.1.1.1.2" xref="A1.E17.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E17.m1.1.1.1.1.1" xref="A1.E17.m1.1.1.1.1.1.1.cmml"><mo id="A1.E17.m1.1.1.1.1.1.2" stretchy="false" xref="A1.E17.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E17.m1.1.1.1.1.1.1" xref="A1.E17.m1.1.1.1.1.1.1.cmml"><mi id="A1.E17.m1.1.1.1.1.1.1.2" xref="A1.E17.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E17.m1.1.1.1.1.1.1.1" xref="A1.E17.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.E17.m1.1.1.1.1.1.1.3" xref="A1.E17.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E17.m1.1.1.1.1.1.3" stretchy="false" xref="A1.E17.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E17.m1.2.2.2" xref="A1.E17.m1.2.2.2.cmml"><msub id="A1.E17.m1.2.2.2.3" xref="A1.E17.m1.2.2.2.3.cmml"><mi id="A1.E17.m1.2.2.2.3.2" xref="A1.E17.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.E17.m1.2.2.2.3.3" xref="A1.E17.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.E17.m1.2.2.2.2" xref="A1.E17.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.E17.m1.2.2.2.1.1" xref="A1.E17.m1.2.2.2.1.1.1.cmml"><mo id="A1.E17.m1.2.2.2.1.1.2" stretchy="false" xref="A1.E17.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.E17.m1.2.2.2.1.1.1" xref="A1.E17.m1.2.2.2.1.1.1.cmml"><mi id="A1.E17.m1.2.2.2.1.1.1.2" xref="A1.E17.m1.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.E17.m1.2.2.2.1.1.1.1" xref="A1.E17.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.E17.m1.2.2.2.1.1.1.3" xref="A1.E17.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E17.m1.2.2.2.1.1.3" stretchy="false" xref="A1.E17.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.E17.m1.5.6.3.1" xref="A1.E17.m1.5.6.3.1.cmml">+</mo><mrow id="A1.E17.m1.5.6.3.3" xref="A1.E17.m1.5.6.3.3.cmml"><mi id="A1.E17.m1.5.6.3.3.2" xref="A1.E17.m1.5.6.3.3.2.cmml">β</mi><mo id="A1.E17.m1.5.6.3.3.1" lspace="0.167em" xref="A1.E17.m1.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.E17.m1.5.6.3.3.3" xref="A1.E17.m1.5.6.3.3.3.cmml"><mi id="A1.E17.m1.5.6.3.3.3.1" xref="A1.E17.m1.5.6.3.3.3.1.cmml">log</mi><mo id="A1.E17.m1.5.6.3.3.3a" lspace="0.167em" xref="A1.E17.m1.5.6.3.3.3.cmml">⁡</mo><mi id="A1.E17.m1.5.6.3.3.3.2" xref="A1.E17.m1.5.6.3.3.3.2.cmml">Z</mi></mrow><mo id="A1.E17.m1.5.6.3.3.1a" xref="A1.E17.m1.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.E17.m1.5.6.3.3.4.2" xref="A1.E17.m1.5.6.3.3.cmml"><mo id="A1.E17.m1.5.6.3.3.4.2.1" stretchy="false" xref="A1.E17.m1.5.6.3.3.cmml">(</mo><mi id="A1.E17.m1.5.5" xref="A1.E17.m1.5.5.cmml">x</mi><mo id="A1.E17.m1.5.6.3.3.4.2.2" stretchy="false" xref="A1.E17.m1.5.6.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E17.m1.5b"><apply id="A1.E17.m1.5.6.cmml" xref="A1.E17.m1.5.6"><eq id="A1.E17.m1.5.6.1.cmml" xref="A1.E17.m1.5.6.1"></eq><apply id="A1.E17.m1.5.6.2.cmml" xref="A1.E17.m1.5.6.2"><times id="A1.E17.m1.5.6.2.1.cmml" xref="A1.E17.m1.5.6.2.1"></times><apply id="A1.E17.m1.5.6.2.2.cmml" xref="A1.E17.m1.5.6.2.2"><csymbol cd="ambiguous" id="A1.E17.m1.5.6.2.2.1.cmml" xref="A1.E17.m1.5.6.2.2">superscript</csymbol><ci id="A1.E17.m1.5.6.2.2.2.cmml" xref="A1.E17.m1.5.6.2.2.2">𝑟</ci><times id="A1.E17.m1.5.6.2.2.3.cmml" xref="A1.E17.m1.5.6.2.2.3"></times></apply><interval closure="open" id="A1.E17.m1.5.6.2.3.1.cmml" xref="A1.E17.m1.5.6.2.3.2"><ci id="A1.E17.m1.3.3.cmml" xref="A1.E17.m1.3.3">𝑥</ci><ci id="A1.E17.m1.4.4.cmml" xref="A1.E17.m1.4.4">𝑦</ci></interval></apply><apply id="A1.E17.m1.5.6.3.cmml" xref="A1.E17.m1.5.6.3"><plus id="A1.E17.m1.5.6.3.1.cmml" xref="A1.E17.m1.5.6.3.1"></plus><apply id="A1.E17.m1.5.6.3.2.cmml" xref="A1.E17.m1.5.6.3.2"><times id="A1.E17.m1.5.6.3.2.1.cmml" xref="A1.E17.m1.5.6.3.2.1"></times><ci id="A1.E17.m1.5.6.3.2.2.cmml" xref="A1.E17.m1.5.6.3.2.2">𝛽</ci><apply id="A1.E17.m1.5.6.3.2.3.cmml" xref="A1.E17.m1.5.6.3.2.3"><log id="A1.E17.m1.5.6.3.2.3.1.cmml" xref="A1.E17.m1.5.6.3.2.3.1"></log><apply id="A1.E17.m1.2.2.cmml" xref="A1.E17.m1.2.2"><divide id="A1.E17.m1.2.2.3.cmml" xref="A1.E17.m1.2.2"></divide><apply id="A1.E17.m1.1.1.1.cmml" xref="A1.E17.m1.1.1.1"><times id="A1.E17.m1.1.1.1.2.cmml" xref="A1.E17.m1.1.1.1.2"></times><apply id="A1.E17.m1.1.1.1.3.cmml" xref="A1.E17.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.E17.m1.1.1.1.3.1.cmml" xref="A1.E17.m1.1.1.1.3">superscript</csymbol><ci id="A1.E17.m1.1.1.1.3.2.cmml" xref="A1.E17.m1.1.1.1.3.2">𝜋</ci><times id="A1.E17.m1.1.1.1.3.3.cmml" xref="A1.E17.m1.1.1.1.3.3"></times></apply><apply id="A1.E17.m1.1.1.1.1.1.1.cmml" xref="A1.E17.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E17.m1.1.1.1.1.1.1.1.cmml" xref="A1.E17.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.E17.m1.1.1.1.1.1.1.2.cmml" xref="A1.E17.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.E17.m1.1.1.1.1.1.1.3.cmml" xref="A1.E17.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.E17.m1.2.2.2.cmml" xref="A1.E17.m1.2.2.2"><times id="A1.E17.m1.2.2.2.2.cmml" xref="A1.E17.m1.2.2.2.2"></times><apply id="A1.E17.m1.2.2.2.3.cmml" xref="A1.E17.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.E17.m1.2.2.2.3.1.cmml" xref="A1.E17.m1.2.2.2.3">subscript</csymbol><ci id="A1.E17.m1.2.2.2.3.2.cmml" xref="A1.E17.m1.2.2.2.3.2">𝜋</ci><ci id="A1.E17.m1.2.2.2.3.3a.cmml" xref="A1.E17.m1.2.2.2.3.3"><mtext id="A1.E17.m1.2.2.2.3.3.cmml" mathsize="70%" xref="A1.E17.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.E17.m1.2.2.2.1.1.1.cmml" xref="A1.E17.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.E17.m1.2.2.2.1.1.1.1.cmml" xref="A1.E17.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.E17.m1.2.2.2.1.1.1.2.cmml" xref="A1.E17.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.E17.m1.2.2.2.1.1.1.3.cmml" xref="A1.E17.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.E17.m1.5.6.3.3.cmml" xref="A1.E17.m1.5.6.3.3"><times id="A1.E17.m1.5.6.3.3.1.cmml" xref="A1.E17.m1.5.6.3.3.1"></times><ci id="A1.E17.m1.5.6.3.3.2.cmml" xref="A1.E17.m1.5.6.3.3.2">𝛽</ci><apply id="A1.E17.m1.5.6.3.3.3.cmml" xref="A1.E17.m1.5.6.3.3.3"><log id="A1.E17.m1.5.6.3.3.3.1.cmml" xref="A1.E17.m1.5.6.3.3.3.1"></log><ci id="A1.E17.m1.5.6.3.3.3.2.cmml" xref="A1.E17.m1.5.6.3.3.3.2">𝑍</ci></apply><ci id="A1.E17.m1.5.5.cmml" xref="A1.E17.m1.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E17.m1.5c">r^{*}(x,y)=\beta\log\frac{\pi^{*}(y|x)}{\pi_{\text{ref}}(y|x)}+\beta\log Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.E17.m1.5d">italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG + italic_β roman_log italic_Z ( italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(17)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS2.p3">
<p class="ltx_p" id="A1.SS2.p3.1">Substituting Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.E17" title="17 ‣ A.2 Deriving the DPO Objective Under the Bradley-Terry Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">17</span></a> into Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.E16" title="16 ‣ A.2 Deriving the DPO Objective Under the Bradley-Terry Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">16</span></a> we obtain:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx3">
<tbody id="A1.Ex6"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p^{*}(y_{1}\succ y_{2}|x)" class="ltx_Math" display="inline" id="A1.Ex6.m1.1"><semantics id="A1.Ex6.m1.1a"><mrow id="A1.Ex6.m1.1.1" xref="A1.Ex6.m1.1.1.cmml"><msup id="A1.Ex6.m1.1.1.3" xref="A1.Ex6.m1.1.1.3.cmml"><mi id="A1.Ex6.m1.1.1.3.2" xref="A1.Ex6.m1.1.1.3.2.cmml">p</mi><mo id="A1.Ex6.m1.1.1.3.3" xref="A1.Ex6.m1.1.1.3.3.cmml">*</mo></msup><mo id="A1.Ex6.m1.1.1.2" xref="A1.Ex6.m1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex6.m1.1.1.1.1" xref="A1.Ex6.m1.1.1.1.1.1.cmml"><mo id="A1.Ex6.m1.1.1.1.1.2" stretchy="false" xref="A1.Ex6.m1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m1.1.1.1.1.1" xref="A1.Ex6.m1.1.1.1.1.1.cmml"><msub id="A1.Ex6.m1.1.1.1.1.1.2" xref="A1.Ex6.m1.1.1.1.1.1.2.cmml"><mi id="A1.Ex6.m1.1.1.1.1.1.2.2" xref="A1.Ex6.m1.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m1.1.1.1.1.1.2.3" xref="A1.Ex6.m1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="A1.Ex6.m1.1.1.1.1.1.1" xref="A1.Ex6.m1.1.1.1.1.1.1.cmml">≻</mo><mrow id="A1.Ex6.m1.1.1.1.1.1.3" xref="A1.Ex6.m1.1.1.1.1.1.3.cmml"><msub id="A1.Ex6.m1.1.1.1.1.1.3.2" xref="A1.Ex6.m1.1.1.1.1.1.3.2.cmml"><mi id="A1.Ex6.m1.1.1.1.1.1.3.2.2" xref="A1.Ex6.m1.1.1.1.1.1.3.2.2.cmml">y</mi><mn id="A1.Ex6.m1.1.1.1.1.1.3.2.3" xref="A1.Ex6.m1.1.1.1.1.1.3.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex6.m1.1.1.1.1.1.3.1" xref="A1.Ex6.m1.1.1.1.1.1.3.1.cmml">|</mo><mi id="A1.Ex6.m1.1.1.1.1.1.3.3" xref="A1.Ex6.m1.1.1.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="A1.Ex6.m1.1.1.1.1.3" stretchy="false" xref="A1.Ex6.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex6.m1.1b"><apply id="A1.Ex6.m1.1.1.cmml" xref="A1.Ex6.m1.1.1"><times id="A1.Ex6.m1.1.1.2.cmml" xref="A1.Ex6.m1.1.1.2"></times><apply id="A1.Ex6.m1.1.1.3.cmml" xref="A1.Ex6.m1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex6.m1.1.1.3.1.cmml" xref="A1.Ex6.m1.1.1.3">superscript</csymbol><ci id="A1.Ex6.m1.1.1.3.2.cmml" xref="A1.Ex6.m1.1.1.3.2">𝑝</ci><times id="A1.Ex6.m1.1.1.3.3.cmml" xref="A1.Ex6.m1.1.1.3.3"></times></apply><apply id="A1.Ex6.m1.1.1.1.1.1.cmml" xref="A1.Ex6.m1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex6.m1.1.1.1.1.1.1.cmml" xref="A1.Ex6.m1.1.1.1.1.1.1">succeeds</csymbol><apply id="A1.Ex6.m1.1.1.1.1.1.2.cmml" xref="A1.Ex6.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m1.1.1.1.1.1.2.1.cmml" xref="A1.Ex6.m1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m1.1.1.1.1.1.2.2.cmml" xref="A1.Ex6.m1.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m1.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m1.1.1.1.1.1.2.3">1</cn></apply><apply id="A1.Ex6.m1.1.1.1.1.1.3.cmml" xref="A1.Ex6.m1.1.1.1.1.1.3"><csymbol cd="latexml" id="A1.Ex6.m1.1.1.1.1.1.3.1.cmml" xref="A1.Ex6.m1.1.1.1.1.1.3.1">conditional</csymbol><apply id="A1.Ex6.m1.1.1.1.1.1.3.2.cmml" xref="A1.Ex6.m1.1.1.1.1.1.3.2"><csymbol cd="ambiguous" id="A1.Ex6.m1.1.1.1.1.1.3.2.1.cmml" xref="A1.Ex6.m1.1.1.1.1.1.3.2">subscript</csymbol><ci id="A1.Ex6.m1.1.1.1.1.1.3.2.2.cmml" xref="A1.Ex6.m1.1.1.1.1.1.3.2.2">𝑦</ci><cn id="A1.Ex6.m1.1.1.1.1.1.3.2.3.cmml" type="integer" xref="A1.Ex6.m1.1.1.1.1.1.3.2.3">2</cn></apply><ci id="A1.Ex6.m1.1.1.1.1.1.3.3.cmml" xref="A1.Ex6.m1.1.1.1.1.1.3.3">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex6.m1.1c">\displaystyle p^{*}(y_{1}\succ y_{2}|x)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex6.m1.1d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ≻ italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{\exp\left(\beta\log\frac{\pi^{*}(y_{1}|x)}{\pi_{\text{ref}%
}(y_{1}|x)}+\beta\log Z(x)\right)}{\exp\left(\beta\log\frac{\pi^{*}(y_{1}|x)}{%
\pi_{\text{ref}}(y_{1}|x)}+\beta\log Z(x)\right)+\exp\left(\beta\log\frac{\pi^%
{*}(y_{2}|x)}{\pi_{\text{ref}}(y_{2}|x)}+\beta\log Z(x)\right)}" class="ltx_Math" display="inline" id="A1.Ex6.m2.15"><semantics id="A1.Ex6.m2.15a"><mrow id="A1.Ex6.m2.15.16" xref="A1.Ex6.m2.15.16.cmml"><mi id="A1.Ex6.m2.15.16.2" xref="A1.Ex6.m2.15.16.2.cmml"></mi><mo id="A1.Ex6.m2.15.16.1" xref="A1.Ex6.m2.15.16.1.cmml">=</mo><mstyle displaystyle="true" id="A1.Ex6.m2.15.15" xref="A1.Ex6.m2.15.15.cmml"><mfrac id="A1.Ex6.m2.15.15a" xref="A1.Ex6.m2.15.15.cmml"><mrow id="A1.Ex6.m2.5.5.5.5" xref="A1.Ex6.m2.5.5.5.6.cmml"><mi id="A1.Ex6.m2.4.4.4.4" xref="A1.Ex6.m2.4.4.4.4.cmml">exp</mi><mo id="A1.Ex6.m2.5.5.5.5a" xref="A1.Ex6.m2.5.5.5.6.cmml">⁡</mo><mrow id="A1.Ex6.m2.5.5.5.5.1" xref="A1.Ex6.m2.5.5.5.6.cmml"><mo id="A1.Ex6.m2.5.5.5.5.1.2" xref="A1.Ex6.m2.5.5.5.6.cmml">(</mo><mrow id="A1.Ex6.m2.5.5.5.5.1.1" xref="A1.Ex6.m2.5.5.5.5.1.1.cmml"><mrow id="A1.Ex6.m2.5.5.5.5.1.1.2" xref="A1.Ex6.m2.5.5.5.5.1.1.2.cmml"><mi id="A1.Ex6.m2.5.5.5.5.1.1.2.2" xref="A1.Ex6.m2.5.5.5.5.1.1.2.2.cmml">β</mi><mo id="A1.Ex6.m2.5.5.5.5.1.1.2.1" lspace="0.167em" xref="A1.Ex6.m2.5.5.5.5.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.5.5.5.5.1.1.2.3" xref="A1.Ex6.m2.5.5.5.5.1.1.2.3.cmml"><mi id="A1.Ex6.m2.5.5.5.5.1.1.2.3.1" xref="A1.Ex6.m2.5.5.5.5.1.1.2.3.1.cmml">log</mi><mo id="A1.Ex6.m2.5.5.5.5.1.1.2.3a" lspace="0.167em" xref="A1.Ex6.m2.5.5.5.5.1.1.2.3.cmml">⁡</mo><mfrac id="A1.Ex6.m2.2.2.2.2" xref="A1.Ex6.m2.2.2.2.2.cmml"><mrow id="A1.Ex6.m2.1.1.1.1.1" xref="A1.Ex6.m2.1.1.1.1.1.cmml"><msup id="A1.Ex6.m2.1.1.1.1.1.3" xref="A1.Ex6.m2.1.1.1.1.1.3.cmml"><mi id="A1.Ex6.m2.1.1.1.1.1.3.2" xref="A1.Ex6.m2.1.1.1.1.1.3.2.cmml">π</mi><mo id="A1.Ex6.m2.1.1.1.1.1.3.3" xref="A1.Ex6.m2.1.1.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.Ex6.m2.1.1.1.1.1.2" xref="A1.Ex6.m2.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex6.m2.1.1.1.1.1.1.1" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.cmml"><mo id="A1.Ex6.m2.1.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m2.1.1.1.1.1.1.1.1" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.cmml"><msub id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.2" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.3" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex6.m2.1.1.1.1.1.1.1.1.1" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex6.m2.1.1.1.1.1.1.1.1.3" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex6.m2.1.1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex6.m2.2.2.2.2.2" xref="A1.Ex6.m2.2.2.2.2.2.cmml"><msub id="A1.Ex6.m2.2.2.2.2.2.3" xref="A1.Ex6.m2.2.2.2.2.2.3.cmml"><mi id="A1.Ex6.m2.2.2.2.2.2.3.2" xref="A1.Ex6.m2.2.2.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex6.m2.2.2.2.2.2.3.3" xref="A1.Ex6.m2.2.2.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex6.m2.2.2.2.2.2.2" xref="A1.Ex6.m2.2.2.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex6.m2.2.2.2.2.2.1.1" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.cmml"><mo id="A1.Ex6.m2.2.2.2.2.2.1.1.2" stretchy="false" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m2.2.2.2.2.2.1.1.1" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.cmml"><msub id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.cmml"><mi id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.2" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.3" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex6.m2.2.2.2.2.2.1.1.1.1" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex6.m2.2.2.2.2.2.1.1.1.3" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex6.m2.2.2.2.2.2.1.1.3" stretchy="false" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex6.m2.5.5.5.5.1.1.1" xref="A1.Ex6.m2.5.5.5.5.1.1.1.cmml">+</mo><mrow id="A1.Ex6.m2.5.5.5.5.1.1.3" xref="A1.Ex6.m2.5.5.5.5.1.1.3.cmml"><mi id="A1.Ex6.m2.5.5.5.5.1.1.3.2" xref="A1.Ex6.m2.5.5.5.5.1.1.3.2.cmml">β</mi><mo id="A1.Ex6.m2.5.5.5.5.1.1.3.1" lspace="0.167em" xref="A1.Ex6.m2.5.5.5.5.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.5.5.5.5.1.1.3.3" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3.cmml"><mi id="A1.Ex6.m2.5.5.5.5.1.1.3.3.1" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3.1.cmml">log</mi><mo id="A1.Ex6.m2.5.5.5.5.1.1.3.3a" lspace="0.167em" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3.cmml">⁡</mo><mi id="A1.Ex6.m2.5.5.5.5.1.1.3.3.2" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3.2.cmml">Z</mi></mrow><mo id="A1.Ex6.m2.5.5.5.5.1.1.3.1a" xref="A1.Ex6.m2.5.5.5.5.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.5.5.5.5.1.1.3.4.2" xref="A1.Ex6.m2.5.5.5.5.1.1.3.cmml"><mo id="A1.Ex6.m2.5.5.5.5.1.1.3.4.2.1" stretchy="false" xref="A1.Ex6.m2.5.5.5.5.1.1.3.cmml">(</mo><mi id="A1.Ex6.m2.3.3.3.3" xref="A1.Ex6.m2.3.3.3.3.cmml">x</mi><mo id="A1.Ex6.m2.5.5.5.5.1.1.3.4.2.2" stretchy="false" xref="A1.Ex6.m2.5.5.5.5.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex6.m2.5.5.5.5.1.3" xref="A1.Ex6.m2.5.5.5.6.cmml">)</mo></mrow></mrow><mrow id="A1.Ex6.m2.15.15.15" xref="A1.Ex6.m2.15.15.15.cmml"><mrow id="A1.Ex6.m2.14.14.14.9.1" xref="A1.Ex6.m2.14.14.14.9.2.cmml"><mi id="A1.Ex6.m2.11.11.11.6" xref="A1.Ex6.m2.11.11.11.6.cmml">exp</mi><mo id="A1.Ex6.m2.14.14.14.9.1a" xref="A1.Ex6.m2.14.14.14.9.2.cmml">⁡</mo><mrow id="A1.Ex6.m2.14.14.14.9.1.1" xref="A1.Ex6.m2.14.14.14.9.2.cmml"><mo id="A1.Ex6.m2.14.14.14.9.1.1.2" xref="A1.Ex6.m2.14.14.14.9.2.cmml">(</mo><mrow id="A1.Ex6.m2.14.14.14.9.1.1.1" xref="A1.Ex6.m2.14.14.14.9.1.1.1.cmml"><mrow id="A1.Ex6.m2.14.14.14.9.1.1.1.2" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.cmml"><mi id="A1.Ex6.m2.14.14.14.9.1.1.1.2.2" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.2.cmml">β</mi><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.2.1" lspace="0.167em" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.14.14.14.9.1.1.1.2.3" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.cmml"><mi id="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.1" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.1.cmml">log</mi><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.2.3a" lspace="0.167em" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.cmml">⁡</mo><mfrac id="A1.Ex6.m2.7.7.7.2" xref="A1.Ex6.m2.7.7.7.2.cmml"><mrow id="A1.Ex6.m2.6.6.6.1.1" xref="A1.Ex6.m2.6.6.6.1.1.cmml"><msup id="A1.Ex6.m2.6.6.6.1.1.3" xref="A1.Ex6.m2.6.6.6.1.1.3.cmml"><mi id="A1.Ex6.m2.6.6.6.1.1.3.2" xref="A1.Ex6.m2.6.6.6.1.1.3.2.cmml">π</mi><mo id="A1.Ex6.m2.6.6.6.1.1.3.3" xref="A1.Ex6.m2.6.6.6.1.1.3.3.cmml">*</mo></msup><mo id="A1.Ex6.m2.6.6.6.1.1.2" xref="A1.Ex6.m2.6.6.6.1.1.2.cmml">⁢</mo><mrow id="A1.Ex6.m2.6.6.6.1.1.1.1" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.cmml"><mo id="A1.Ex6.m2.6.6.6.1.1.1.1.2" stretchy="false" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m2.6.6.6.1.1.1.1.1" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.cmml"><msub id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.cmml"><mi id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.2" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.3" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex6.m2.6.6.6.1.1.1.1.1.1" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex6.m2.6.6.6.1.1.1.1.1.3" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex6.m2.6.6.6.1.1.1.1.3" stretchy="false" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex6.m2.7.7.7.2.2" xref="A1.Ex6.m2.7.7.7.2.2.cmml"><msub id="A1.Ex6.m2.7.7.7.2.2.3" xref="A1.Ex6.m2.7.7.7.2.2.3.cmml"><mi id="A1.Ex6.m2.7.7.7.2.2.3.2" xref="A1.Ex6.m2.7.7.7.2.2.3.2.cmml">π</mi><mtext id="A1.Ex6.m2.7.7.7.2.2.3.3" xref="A1.Ex6.m2.7.7.7.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex6.m2.7.7.7.2.2.2" xref="A1.Ex6.m2.7.7.7.2.2.2.cmml">⁢</mo><mrow id="A1.Ex6.m2.7.7.7.2.2.1.1" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.cmml"><mo id="A1.Ex6.m2.7.7.7.2.2.1.1.2" stretchy="false" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m2.7.7.7.2.2.1.1.1" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.cmml"><msub id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.cmml"><mi id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.2" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.3" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex6.m2.7.7.7.2.2.1.1.1.1" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex6.m2.7.7.7.2.2.1.1.1.3" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex6.m2.7.7.7.2.2.1.1.3" stretchy="false" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.1" xref="A1.Ex6.m2.14.14.14.9.1.1.1.1.cmml">+</mo><mrow id="A1.Ex6.m2.14.14.14.9.1.1.1.3" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.cmml"><mi id="A1.Ex6.m2.14.14.14.9.1.1.1.3.2" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.2.cmml">β</mi><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.3.1" lspace="0.167em" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.cmml"><mi id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.1" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.1.cmml">log</mi><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3a" lspace="0.167em" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.cmml">⁡</mo><mi id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.2" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.2.cmml">Z</mi></mrow><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.3.1a" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.14.14.14.9.1.1.1.3.4.2" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.cmml"><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.3.4.2.1" stretchy="false" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.cmml">(</mo><mi id="A1.Ex6.m2.10.10.10.5" xref="A1.Ex6.m2.10.10.10.5.cmml">x</mi><mo id="A1.Ex6.m2.14.14.14.9.1.1.1.3.4.2.2" stretchy="false" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex6.m2.14.14.14.9.1.1.3" xref="A1.Ex6.m2.14.14.14.9.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex6.m2.15.15.15.11" xref="A1.Ex6.m2.15.15.15.11.cmml">+</mo><mrow id="A1.Ex6.m2.15.15.15.10.1" xref="A1.Ex6.m2.15.15.15.10.2.cmml"><mi id="A1.Ex6.m2.13.13.13.8" xref="A1.Ex6.m2.13.13.13.8.cmml">exp</mi><mo id="A1.Ex6.m2.15.15.15.10.1a" xref="A1.Ex6.m2.15.15.15.10.2.cmml">⁡</mo><mrow id="A1.Ex6.m2.15.15.15.10.1.1" xref="A1.Ex6.m2.15.15.15.10.2.cmml"><mo id="A1.Ex6.m2.15.15.15.10.1.1.2" xref="A1.Ex6.m2.15.15.15.10.2.cmml">(</mo><mrow id="A1.Ex6.m2.15.15.15.10.1.1.1" xref="A1.Ex6.m2.15.15.15.10.1.1.1.cmml"><mrow id="A1.Ex6.m2.15.15.15.10.1.1.1.2" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.cmml"><mi id="A1.Ex6.m2.15.15.15.10.1.1.1.2.2" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.2.cmml">β</mi><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.2.1" lspace="0.167em" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.15.15.15.10.1.1.1.2.3" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.cmml"><mi id="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.1" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.1.cmml">log</mi><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.2.3a" lspace="0.167em" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.cmml">⁡</mo><mfrac id="A1.Ex6.m2.9.9.9.4" xref="A1.Ex6.m2.9.9.9.4.cmml"><mrow id="A1.Ex6.m2.8.8.8.3.1" xref="A1.Ex6.m2.8.8.8.3.1.cmml"><msup id="A1.Ex6.m2.8.8.8.3.1.3" xref="A1.Ex6.m2.8.8.8.3.1.3.cmml"><mi id="A1.Ex6.m2.8.8.8.3.1.3.2" xref="A1.Ex6.m2.8.8.8.3.1.3.2.cmml">π</mi><mo id="A1.Ex6.m2.8.8.8.3.1.3.3" xref="A1.Ex6.m2.8.8.8.3.1.3.3.cmml">*</mo></msup><mo id="A1.Ex6.m2.8.8.8.3.1.2" xref="A1.Ex6.m2.8.8.8.3.1.2.cmml">⁢</mo><mrow id="A1.Ex6.m2.8.8.8.3.1.1.1" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.cmml"><mo id="A1.Ex6.m2.8.8.8.3.1.1.1.2" stretchy="false" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m2.8.8.8.3.1.1.1.1" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.cmml"><msub id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.cmml"><mi id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.2" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.3" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex6.m2.8.8.8.3.1.1.1.1.1" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex6.m2.8.8.8.3.1.1.1.1.3" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex6.m2.8.8.8.3.1.1.1.3" stretchy="false" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex6.m2.9.9.9.4.2" xref="A1.Ex6.m2.9.9.9.4.2.cmml"><msub id="A1.Ex6.m2.9.9.9.4.2.3" xref="A1.Ex6.m2.9.9.9.4.2.3.cmml"><mi id="A1.Ex6.m2.9.9.9.4.2.3.2" xref="A1.Ex6.m2.9.9.9.4.2.3.2.cmml">π</mi><mtext id="A1.Ex6.m2.9.9.9.4.2.3.3" xref="A1.Ex6.m2.9.9.9.4.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex6.m2.9.9.9.4.2.2" xref="A1.Ex6.m2.9.9.9.4.2.2.cmml">⁢</mo><mrow id="A1.Ex6.m2.9.9.9.4.2.1.1" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.cmml"><mo id="A1.Ex6.m2.9.9.9.4.2.1.1.2" stretchy="false" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.cmml">(</mo><mrow id="A1.Ex6.m2.9.9.9.4.2.1.1.1" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.cmml"><msub id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.cmml"><mi id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.2" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.3" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex6.m2.9.9.9.4.2.1.1.1.1" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex6.m2.9.9.9.4.2.1.1.1.3" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex6.m2.9.9.9.4.2.1.1.3" stretchy="false" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.1" xref="A1.Ex6.m2.15.15.15.10.1.1.1.1.cmml">+</mo><mrow id="A1.Ex6.m2.15.15.15.10.1.1.1.3" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.cmml"><mi id="A1.Ex6.m2.15.15.15.10.1.1.1.3.2" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.2.cmml">β</mi><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.3.1" lspace="0.167em" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.cmml"><mi id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.1" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.1.cmml">log</mi><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3a" lspace="0.167em" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.cmml">⁡</mo><mi id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.2" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.2.cmml">Z</mi></mrow><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.3.1a" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex6.m2.15.15.15.10.1.1.1.3.4.2" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.cmml"><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.3.4.2.1" stretchy="false" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.cmml">(</mo><mi id="A1.Ex6.m2.12.12.12.7" xref="A1.Ex6.m2.12.12.12.7.cmml">x</mi><mo id="A1.Ex6.m2.15.15.15.10.1.1.1.3.4.2.2" stretchy="false" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex6.m2.15.15.15.10.1.1.3" xref="A1.Ex6.m2.15.15.15.10.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex6.m2.15b"><apply id="A1.Ex6.m2.15.16.cmml" xref="A1.Ex6.m2.15.16"><eq id="A1.Ex6.m2.15.16.1.cmml" xref="A1.Ex6.m2.15.16.1"></eq><csymbol cd="latexml" id="A1.Ex6.m2.15.16.2.cmml" xref="A1.Ex6.m2.15.16.2">absent</csymbol><apply id="A1.Ex6.m2.15.15.cmml" xref="A1.Ex6.m2.15.15"><divide id="A1.Ex6.m2.15.15.16.cmml" xref="A1.Ex6.m2.15.15"></divide><apply id="A1.Ex6.m2.5.5.5.6.cmml" xref="A1.Ex6.m2.5.5.5.5"><exp id="A1.Ex6.m2.4.4.4.4.cmml" xref="A1.Ex6.m2.4.4.4.4"></exp><apply id="A1.Ex6.m2.5.5.5.5.1.1.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1"><plus id="A1.Ex6.m2.5.5.5.5.1.1.1.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.1"></plus><apply id="A1.Ex6.m2.5.5.5.5.1.1.2.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.2"><times id="A1.Ex6.m2.5.5.5.5.1.1.2.1.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.2.1"></times><ci id="A1.Ex6.m2.5.5.5.5.1.1.2.2.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.2.2">𝛽</ci><apply id="A1.Ex6.m2.5.5.5.5.1.1.2.3.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.2.3"><log id="A1.Ex6.m2.5.5.5.5.1.1.2.3.1.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.2.3.1"></log><apply id="A1.Ex6.m2.2.2.2.2.cmml" xref="A1.Ex6.m2.2.2.2.2"><divide id="A1.Ex6.m2.2.2.2.2.3.cmml" xref="A1.Ex6.m2.2.2.2.2"></divide><apply id="A1.Ex6.m2.1.1.1.1.1.cmml" xref="A1.Ex6.m2.1.1.1.1.1"><times id="A1.Ex6.m2.1.1.1.1.1.2.cmml" xref="A1.Ex6.m2.1.1.1.1.1.2"></times><apply id="A1.Ex6.m2.1.1.1.1.1.3.cmml" xref="A1.Ex6.m2.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex6.m2.1.1.1.1.1.3.1.cmml" xref="A1.Ex6.m2.1.1.1.1.1.3">superscript</csymbol><ci id="A1.Ex6.m2.1.1.1.1.1.3.2.cmml" xref="A1.Ex6.m2.1.1.1.1.1.3.2">𝜋</ci><times id="A1.Ex6.m2.1.1.1.1.1.3.3.cmml" xref="A1.Ex6.m2.1.1.1.1.1.3.3"></times></apply><apply id="A1.Ex6.m2.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex6.m2.1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex6.m2.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.1.cmml" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.2.3">1</cn></apply><ci id="A1.Ex6.m2.1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex6.m2.1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex6.m2.2.2.2.2.2.cmml" xref="A1.Ex6.m2.2.2.2.2.2"><times id="A1.Ex6.m2.2.2.2.2.2.2.cmml" xref="A1.Ex6.m2.2.2.2.2.2.2"></times><apply id="A1.Ex6.m2.2.2.2.2.2.3.cmml" xref="A1.Ex6.m2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex6.m2.2.2.2.2.2.3.1.cmml" xref="A1.Ex6.m2.2.2.2.2.2.3">subscript</csymbol><ci id="A1.Ex6.m2.2.2.2.2.2.3.2.cmml" xref="A1.Ex6.m2.2.2.2.2.2.3.2">𝜋</ci><ci id="A1.Ex6.m2.2.2.2.2.2.3.3a.cmml" xref="A1.Ex6.m2.2.2.2.2.2.3.3"><mtext id="A1.Ex6.m2.2.2.2.2.2.3.3.cmml" mathsize="50%" xref="A1.Ex6.m2.2.2.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex6.m2.2.2.2.2.2.1.1.1.cmml" xref="A1.Ex6.m2.2.2.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex6.m2.2.2.2.2.2.1.1.1.1.cmml" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.cmml" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.1.cmml" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.2.cmml" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.2.3">1</cn></apply><ci id="A1.Ex6.m2.2.2.2.2.2.1.1.1.3.cmml" xref="A1.Ex6.m2.2.2.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex6.m2.5.5.5.5.1.1.3.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.3"><times id="A1.Ex6.m2.5.5.5.5.1.1.3.1.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.3.1"></times><ci id="A1.Ex6.m2.5.5.5.5.1.1.3.2.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.3.2">𝛽</ci><apply id="A1.Ex6.m2.5.5.5.5.1.1.3.3.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3"><log id="A1.Ex6.m2.5.5.5.5.1.1.3.3.1.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3.1"></log><ci id="A1.Ex6.m2.5.5.5.5.1.1.3.3.2.cmml" xref="A1.Ex6.m2.5.5.5.5.1.1.3.3.2">𝑍</ci></apply><ci id="A1.Ex6.m2.3.3.3.3.cmml" xref="A1.Ex6.m2.3.3.3.3">𝑥</ci></apply></apply></apply><apply id="A1.Ex6.m2.15.15.15.cmml" xref="A1.Ex6.m2.15.15.15"><plus id="A1.Ex6.m2.15.15.15.11.cmml" xref="A1.Ex6.m2.15.15.15.11"></plus><apply id="A1.Ex6.m2.14.14.14.9.2.cmml" xref="A1.Ex6.m2.14.14.14.9.1"><exp id="A1.Ex6.m2.11.11.11.6.cmml" xref="A1.Ex6.m2.11.11.11.6"></exp><apply id="A1.Ex6.m2.14.14.14.9.1.1.1.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1"><plus id="A1.Ex6.m2.14.14.14.9.1.1.1.1.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.1"></plus><apply id="A1.Ex6.m2.14.14.14.9.1.1.1.2.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2"><times id="A1.Ex6.m2.14.14.14.9.1.1.1.2.1.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.1"></times><ci id="A1.Ex6.m2.14.14.14.9.1.1.1.2.2.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.2">𝛽</ci><apply id="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.3"><log id="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.1.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.2.3.1"></log><apply id="A1.Ex6.m2.7.7.7.2.cmml" xref="A1.Ex6.m2.7.7.7.2"><divide id="A1.Ex6.m2.7.7.7.2.3.cmml" xref="A1.Ex6.m2.7.7.7.2"></divide><apply id="A1.Ex6.m2.6.6.6.1.1.cmml" xref="A1.Ex6.m2.6.6.6.1.1"><times id="A1.Ex6.m2.6.6.6.1.1.2.cmml" xref="A1.Ex6.m2.6.6.6.1.1.2"></times><apply id="A1.Ex6.m2.6.6.6.1.1.3.cmml" xref="A1.Ex6.m2.6.6.6.1.1.3"><csymbol cd="ambiguous" id="A1.Ex6.m2.6.6.6.1.1.3.1.cmml" xref="A1.Ex6.m2.6.6.6.1.1.3">superscript</csymbol><ci id="A1.Ex6.m2.6.6.6.1.1.3.2.cmml" xref="A1.Ex6.m2.6.6.6.1.1.3.2">𝜋</ci><times id="A1.Ex6.m2.6.6.6.1.1.3.3.cmml" xref="A1.Ex6.m2.6.6.6.1.1.3.3"></times></apply><apply id="A1.Ex6.m2.6.6.6.1.1.1.1.1.cmml" xref="A1.Ex6.m2.6.6.6.1.1.1.1"><csymbol cd="latexml" id="A1.Ex6.m2.6.6.6.1.1.1.1.1.1.cmml" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.cmml" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.1.cmml" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.2.cmml" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.2.3">1</cn></apply><ci id="A1.Ex6.m2.6.6.6.1.1.1.1.1.3.cmml" xref="A1.Ex6.m2.6.6.6.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex6.m2.7.7.7.2.2.cmml" xref="A1.Ex6.m2.7.7.7.2.2"><times id="A1.Ex6.m2.7.7.7.2.2.2.cmml" xref="A1.Ex6.m2.7.7.7.2.2.2"></times><apply id="A1.Ex6.m2.7.7.7.2.2.3.cmml" xref="A1.Ex6.m2.7.7.7.2.2.3"><csymbol cd="ambiguous" id="A1.Ex6.m2.7.7.7.2.2.3.1.cmml" xref="A1.Ex6.m2.7.7.7.2.2.3">subscript</csymbol><ci id="A1.Ex6.m2.7.7.7.2.2.3.2.cmml" xref="A1.Ex6.m2.7.7.7.2.2.3.2">𝜋</ci><ci id="A1.Ex6.m2.7.7.7.2.2.3.3a.cmml" xref="A1.Ex6.m2.7.7.7.2.2.3.3"><mtext id="A1.Ex6.m2.7.7.7.2.2.3.3.cmml" mathsize="50%" xref="A1.Ex6.m2.7.7.7.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex6.m2.7.7.7.2.2.1.1.1.cmml" xref="A1.Ex6.m2.7.7.7.2.2.1.1"><csymbol cd="latexml" id="A1.Ex6.m2.7.7.7.2.2.1.1.1.1.cmml" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.cmml" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.1.cmml" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.2.cmml" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.2.3">1</cn></apply><ci id="A1.Ex6.m2.7.7.7.2.2.1.1.1.3.cmml" xref="A1.Ex6.m2.7.7.7.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex6.m2.14.14.14.9.1.1.1.3.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3"><times id="A1.Ex6.m2.14.14.14.9.1.1.1.3.1.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.1"></times><ci id="A1.Ex6.m2.14.14.14.9.1.1.1.3.2.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.2">𝛽</ci><apply id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3"><log id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.1.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.1"></log><ci id="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.2.cmml" xref="A1.Ex6.m2.14.14.14.9.1.1.1.3.3.2">𝑍</ci></apply><ci id="A1.Ex6.m2.10.10.10.5.cmml" xref="A1.Ex6.m2.10.10.10.5">𝑥</ci></apply></apply></apply><apply id="A1.Ex6.m2.15.15.15.10.2.cmml" xref="A1.Ex6.m2.15.15.15.10.1"><exp id="A1.Ex6.m2.13.13.13.8.cmml" xref="A1.Ex6.m2.13.13.13.8"></exp><apply id="A1.Ex6.m2.15.15.15.10.1.1.1.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1"><plus id="A1.Ex6.m2.15.15.15.10.1.1.1.1.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.1"></plus><apply id="A1.Ex6.m2.15.15.15.10.1.1.1.2.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2"><times id="A1.Ex6.m2.15.15.15.10.1.1.1.2.1.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.1"></times><ci id="A1.Ex6.m2.15.15.15.10.1.1.1.2.2.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.2">𝛽</ci><apply id="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.3"><log id="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.1.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.2.3.1"></log><apply id="A1.Ex6.m2.9.9.9.4.cmml" xref="A1.Ex6.m2.9.9.9.4"><divide id="A1.Ex6.m2.9.9.9.4.3.cmml" xref="A1.Ex6.m2.9.9.9.4"></divide><apply id="A1.Ex6.m2.8.8.8.3.1.cmml" xref="A1.Ex6.m2.8.8.8.3.1"><times id="A1.Ex6.m2.8.8.8.3.1.2.cmml" xref="A1.Ex6.m2.8.8.8.3.1.2"></times><apply id="A1.Ex6.m2.8.8.8.3.1.3.cmml" xref="A1.Ex6.m2.8.8.8.3.1.3"><csymbol cd="ambiguous" id="A1.Ex6.m2.8.8.8.3.1.3.1.cmml" xref="A1.Ex6.m2.8.8.8.3.1.3">superscript</csymbol><ci id="A1.Ex6.m2.8.8.8.3.1.3.2.cmml" xref="A1.Ex6.m2.8.8.8.3.1.3.2">𝜋</ci><times id="A1.Ex6.m2.8.8.8.3.1.3.3.cmml" xref="A1.Ex6.m2.8.8.8.3.1.3.3"></times></apply><apply id="A1.Ex6.m2.8.8.8.3.1.1.1.1.cmml" xref="A1.Ex6.m2.8.8.8.3.1.1.1"><csymbol cd="latexml" id="A1.Ex6.m2.8.8.8.3.1.1.1.1.1.cmml" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.cmml" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.1.cmml" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.2.cmml" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.2.3">2</cn></apply><ci id="A1.Ex6.m2.8.8.8.3.1.1.1.1.3.cmml" xref="A1.Ex6.m2.8.8.8.3.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex6.m2.9.9.9.4.2.cmml" xref="A1.Ex6.m2.9.9.9.4.2"><times id="A1.Ex6.m2.9.9.9.4.2.2.cmml" xref="A1.Ex6.m2.9.9.9.4.2.2"></times><apply id="A1.Ex6.m2.9.9.9.4.2.3.cmml" xref="A1.Ex6.m2.9.9.9.4.2.3"><csymbol cd="ambiguous" id="A1.Ex6.m2.9.9.9.4.2.3.1.cmml" xref="A1.Ex6.m2.9.9.9.4.2.3">subscript</csymbol><ci id="A1.Ex6.m2.9.9.9.4.2.3.2.cmml" xref="A1.Ex6.m2.9.9.9.4.2.3.2">𝜋</ci><ci id="A1.Ex6.m2.9.9.9.4.2.3.3a.cmml" xref="A1.Ex6.m2.9.9.9.4.2.3.3"><mtext id="A1.Ex6.m2.9.9.9.4.2.3.3.cmml" mathsize="50%" xref="A1.Ex6.m2.9.9.9.4.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex6.m2.9.9.9.4.2.1.1.1.cmml" xref="A1.Ex6.m2.9.9.9.4.2.1.1"><csymbol cd="latexml" id="A1.Ex6.m2.9.9.9.4.2.1.1.1.1.cmml" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.cmml" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.1.cmml" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.2.cmml" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.2.3">2</cn></apply><ci id="A1.Ex6.m2.9.9.9.4.2.1.1.1.3.cmml" xref="A1.Ex6.m2.9.9.9.4.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex6.m2.15.15.15.10.1.1.1.3.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3"><times id="A1.Ex6.m2.15.15.15.10.1.1.1.3.1.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.1"></times><ci id="A1.Ex6.m2.15.15.15.10.1.1.1.3.2.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.2">𝛽</ci><apply id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3"><log id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.1.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.1"></log><ci id="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.2.cmml" xref="A1.Ex6.m2.15.15.15.10.1.1.1.3.3.2">𝑍</ci></apply><ci id="A1.Ex6.m2.12.12.12.7.cmml" xref="A1.Ex6.m2.12.12.12.7">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex6.m2.15c">\displaystyle=\frac{\exp\left(\beta\log\frac{\pi^{*}(y_{1}|x)}{\pi_{\text{ref}%
}(y_{1}|x)}+\beta\log Z(x)\right)}{\exp\left(\beta\log\frac{\pi^{*}(y_{1}|x)}{%
\pi_{\text{ref}}(y_{1}|x)}+\beta\log Z(x)\right)+\exp\left(\beta\log\frac{\pi^%
{*}(y_{2}|x)}{\pi_{\text{ref}}(y_{2}|x)}+\beta\log Z(x)\right)}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex6.m2.15d">= divide start_ARG roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG + italic_β roman_log italic_Z ( italic_x ) ) end_ARG start_ARG roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG + italic_β roman_log italic_Z ( italic_x ) ) + roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) end_ARG + italic_β roman_log italic_Z ( italic_x ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex7"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{1}{1+\exp\left(\beta\log\frac{\pi^{*}(y_{2}|x)}{\pi_{\text%
{ref}}(y_{2}|x)}-\beta\log\frac{\pi^{*}(y_{1}|x)}{\pi_{\text{ref}}(y_{1}|x)}%
\right)}" class="ltx_Math" display="inline" id="A1.Ex7.m1.6"><semantics id="A1.Ex7.m1.6a"><mrow id="A1.Ex7.m1.6.7" xref="A1.Ex7.m1.6.7.cmml"><mi id="A1.Ex7.m1.6.7.2" xref="A1.Ex7.m1.6.7.2.cmml"></mi><mo id="A1.Ex7.m1.6.7.1" xref="A1.Ex7.m1.6.7.1.cmml">=</mo><mstyle displaystyle="true" id="A1.Ex7.m1.6.6" xref="A1.Ex7.m1.6.6.cmml"><mfrac id="A1.Ex7.m1.6.6a" xref="A1.Ex7.m1.6.6.cmml"><mn id="A1.Ex7.m1.6.6.8" xref="A1.Ex7.m1.6.6.8.cmml">1</mn><mrow id="A1.Ex7.m1.6.6.6" xref="A1.Ex7.m1.6.6.6.cmml"><mn id="A1.Ex7.m1.6.6.6.8" xref="A1.Ex7.m1.6.6.6.8.cmml">1</mn><mo id="A1.Ex7.m1.6.6.6.7" xref="A1.Ex7.m1.6.6.6.7.cmml">+</mo><mrow id="A1.Ex7.m1.6.6.6.6.1" xref="A1.Ex7.m1.6.6.6.6.2.cmml"><mi id="A1.Ex7.m1.5.5.5.5" xref="A1.Ex7.m1.5.5.5.5.cmml">exp</mi><mo id="A1.Ex7.m1.6.6.6.6.1a" xref="A1.Ex7.m1.6.6.6.6.2.cmml">⁡</mo><mrow id="A1.Ex7.m1.6.6.6.6.1.1" xref="A1.Ex7.m1.6.6.6.6.2.cmml"><mo id="A1.Ex7.m1.6.6.6.6.1.1.2" xref="A1.Ex7.m1.6.6.6.6.2.cmml">(</mo><mrow id="A1.Ex7.m1.6.6.6.6.1.1.1" xref="A1.Ex7.m1.6.6.6.6.1.1.1.cmml"><mrow id="A1.Ex7.m1.6.6.6.6.1.1.1.2" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.cmml"><mi id="A1.Ex7.m1.6.6.6.6.1.1.1.2.2" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.2.cmml">β</mi><mo id="A1.Ex7.m1.6.6.6.6.1.1.1.2.1" lspace="0.167em" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex7.m1.6.6.6.6.1.1.1.2.3" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.cmml"><mi id="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.1" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.1.cmml">log</mi><mo id="A1.Ex7.m1.6.6.6.6.1.1.1.2.3a" lspace="0.167em" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.cmml">⁡</mo><mfrac id="A1.Ex7.m1.2.2.2.2" xref="A1.Ex7.m1.2.2.2.2.cmml"><mrow id="A1.Ex7.m1.1.1.1.1.1" xref="A1.Ex7.m1.1.1.1.1.1.cmml"><msup id="A1.Ex7.m1.1.1.1.1.1.3" xref="A1.Ex7.m1.1.1.1.1.1.3.cmml"><mi id="A1.Ex7.m1.1.1.1.1.1.3.2" xref="A1.Ex7.m1.1.1.1.1.1.3.2.cmml">π</mi><mo id="A1.Ex7.m1.1.1.1.1.1.3.3" xref="A1.Ex7.m1.1.1.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.Ex7.m1.1.1.1.1.1.2" xref="A1.Ex7.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex7.m1.1.1.1.1.1.1.1" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.cmml"><mo id="A1.Ex7.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex7.m1.1.1.1.1.1.1.1.1" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.cmml"><msub id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.2" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.3" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex7.m1.1.1.1.1.1.1.1.1.1" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex7.m1.1.1.1.1.1.1.1.1.3" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex7.m1.1.1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex7.m1.2.2.2.2.2" xref="A1.Ex7.m1.2.2.2.2.2.cmml"><msub id="A1.Ex7.m1.2.2.2.2.2.3" xref="A1.Ex7.m1.2.2.2.2.2.3.cmml"><mi id="A1.Ex7.m1.2.2.2.2.2.3.2" xref="A1.Ex7.m1.2.2.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex7.m1.2.2.2.2.2.3.3" xref="A1.Ex7.m1.2.2.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex7.m1.2.2.2.2.2.2" xref="A1.Ex7.m1.2.2.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex7.m1.2.2.2.2.2.1.1" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.cmml"><mo id="A1.Ex7.m1.2.2.2.2.2.1.1.2" stretchy="false" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex7.m1.2.2.2.2.2.1.1.1" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.cmml"><msub id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.cmml"><mi id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.2" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.3" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex7.m1.2.2.2.2.2.1.1.1.1" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex7.m1.2.2.2.2.2.1.1.1.3" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex7.m1.2.2.2.2.2.1.1.3" stretchy="false" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex7.m1.6.6.6.6.1.1.1.1" xref="A1.Ex7.m1.6.6.6.6.1.1.1.1.cmml">−</mo><mrow id="A1.Ex7.m1.6.6.6.6.1.1.1.3" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.cmml"><mi id="A1.Ex7.m1.6.6.6.6.1.1.1.3.2" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.2.cmml">β</mi><mo id="A1.Ex7.m1.6.6.6.6.1.1.1.3.1" lspace="0.167em" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex7.m1.6.6.6.6.1.1.1.3.3" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.cmml"><mi id="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.1" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.1.cmml">log</mi><mo id="A1.Ex7.m1.6.6.6.6.1.1.1.3.3a" lspace="0.167em" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.cmml">⁡</mo><mfrac id="A1.Ex7.m1.4.4.4.4" xref="A1.Ex7.m1.4.4.4.4.cmml"><mrow id="A1.Ex7.m1.3.3.3.3.1" xref="A1.Ex7.m1.3.3.3.3.1.cmml"><msup id="A1.Ex7.m1.3.3.3.3.1.3" xref="A1.Ex7.m1.3.3.3.3.1.3.cmml"><mi id="A1.Ex7.m1.3.3.3.3.1.3.2" xref="A1.Ex7.m1.3.3.3.3.1.3.2.cmml">π</mi><mo id="A1.Ex7.m1.3.3.3.3.1.3.3" xref="A1.Ex7.m1.3.3.3.3.1.3.3.cmml">*</mo></msup><mo id="A1.Ex7.m1.3.3.3.3.1.2" xref="A1.Ex7.m1.3.3.3.3.1.2.cmml">⁢</mo><mrow id="A1.Ex7.m1.3.3.3.3.1.1.1" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.cmml"><mo id="A1.Ex7.m1.3.3.3.3.1.1.1.2" stretchy="false" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.cmml">(</mo><mrow id="A1.Ex7.m1.3.3.3.3.1.1.1.1" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.cmml"><msub id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.cmml"><mi id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.2" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.3" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex7.m1.3.3.3.3.1.1.1.1.1" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex7.m1.3.3.3.3.1.1.1.1.3" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex7.m1.3.3.3.3.1.1.1.3" stretchy="false" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex7.m1.4.4.4.4.2" xref="A1.Ex7.m1.4.4.4.4.2.cmml"><msub id="A1.Ex7.m1.4.4.4.4.2.3" xref="A1.Ex7.m1.4.4.4.4.2.3.cmml"><mi id="A1.Ex7.m1.4.4.4.4.2.3.2" xref="A1.Ex7.m1.4.4.4.4.2.3.2.cmml">π</mi><mtext id="A1.Ex7.m1.4.4.4.4.2.3.3" xref="A1.Ex7.m1.4.4.4.4.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex7.m1.4.4.4.4.2.2" xref="A1.Ex7.m1.4.4.4.4.2.2.cmml">⁢</mo><mrow id="A1.Ex7.m1.4.4.4.4.2.1.1" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.cmml"><mo id="A1.Ex7.m1.4.4.4.4.2.1.1.2" stretchy="false" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.cmml">(</mo><mrow id="A1.Ex7.m1.4.4.4.4.2.1.1.1" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.cmml"><msub id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.cmml"><mi id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.2" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.3" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex7.m1.4.4.4.4.2.1.1.1.1" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex7.m1.4.4.4.4.2.1.1.1.3" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex7.m1.4.4.4.4.2.1.1.3" stretchy="false" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><mo id="A1.Ex7.m1.6.6.6.6.1.1.3" xref="A1.Ex7.m1.6.6.6.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex7.m1.6b"><apply id="A1.Ex7.m1.6.7.cmml" xref="A1.Ex7.m1.6.7"><eq id="A1.Ex7.m1.6.7.1.cmml" xref="A1.Ex7.m1.6.7.1"></eq><csymbol cd="latexml" id="A1.Ex7.m1.6.7.2.cmml" xref="A1.Ex7.m1.6.7.2">absent</csymbol><apply id="A1.Ex7.m1.6.6.cmml" xref="A1.Ex7.m1.6.6"><divide id="A1.Ex7.m1.6.6.7.cmml" xref="A1.Ex7.m1.6.6"></divide><cn id="A1.Ex7.m1.6.6.8.cmml" type="integer" xref="A1.Ex7.m1.6.6.8">1</cn><apply id="A1.Ex7.m1.6.6.6.cmml" xref="A1.Ex7.m1.6.6.6"><plus id="A1.Ex7.m1.6.6.6.7.cmml" xref="A1.Ex7.m1.6.6.6.7"></plus><cn id="A1.Ex7.m1.6.6.6.8.cmml" type="integer" xref="A1.Ex7.m1.6.6.6.8">1</cn><apply id="A1.Ex7.m1.6.6.6.6.2.cmml" xref="A1.Ex7.m1.6.6.6.6.1"><exp id="A1.Ex7.m1.5.5.5.5.cmml" xref="A1.Ex7.m1.5.5.5.5"></exp><apply id="A1.Ex7.m1.6.6.6.6.1.1.1.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1"><minus id="A1.Ex7.m1.6.6.6.6.1.1.1.1.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.1"></minus><apply id="A1.Ex7.m1.6.6.6.6.1.1.1.2.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2"><times id="A1.Ex7.m1.6.6.6.6.1.1.1.2.1.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.1"></times><ci id="A1.Ex7.m1.6.6.6.6.1.1.1.2.2.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.2">𝛽</ci><apply id="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.3"><log id="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.1.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.2.3.1"></log><apply id="A1.Ex7.m1.2.2.2.2.cmml" xref="A1.Ex7.m1.2.2.2.2"><divide id="A1.Ex7.m1.2.2.2.2.3.cmml" xref="A1.Ex7.m1.2.2.2.2"></divide><apply id="A1.Ex7.m1.1.1.1.1.1.cmml" xref="A1.Ex7.m1.1.1.1.1.1"><times id="A1.Ex7.m1.1.1.1.1.1.2.cmml" xref="A1.Ex7.m1.1.1.1.1.1.2"></times><apply id="A1.Ex7.m1.1.1.1.1.1.3.cmml" xref="A1.Ex7.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex7.m1.1.1.1.1.1.3.1.cmml" xref="A1.Ex7.m1.1.1.1.1.1.3">superscript</csymbol><ci id="A1.Ex7.m1.1.1.1.1.1.3.2.cmml" xref="A1.Ex7.m1.1.1.1.1.1.3.2">𝜋</ci><times id="A1.Ex7.m1.1.1.1.1.1.3.3.cmml" xref="A1.Ex7.m1.1.1.1.1.1.3.3"></times></apply><apply id="A1.Ex7.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex7.m1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex7.m1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.1.cmml" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.2.3">2</cn></apply><ci id="A1.Ex7.m1.1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex7.m1.1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex7.m1.2.2.2.2.2.cmml" xref="A1.Ex7.m1.2.2.2.2.2"><times id="A1.Ex7.m1.2.2.2.2.2.2.cmml" xref="A1.Ex7.m1.2.2.2.2.2.2"></times><apply id="A1.Ex7.m1.2.2.2.2.2.3.cmml" xref="A1.Ex7.m1.2.2.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex7.m1.2.2.2.2.2.3.1.cmml" xref="A1.Ex7.m1.2.2.2.2.2.3">subscript</csymbol><ci id="A1.Ex7.m1.2.2.2.2.2.3.2.cmml" xref="A1.Ex7.m1.2.2.2.2.2.3.2">𝜋</ci><ci id="A1.Ex7.m1.2.2.2.2.2.3.3a.cmml" xref="A1.Ex7.m1.2.2.2.2.2.3.3"><mtext id="A1.Ex7.m1.2.2.2.2.2.3.3.cmml" mathsize="50%" xref="A1.Ex7.m1.2.2.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex7.m1.2.2.2.2.2.1.1.1.cmml" xref="A1.Ex7.m1.2.2.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex7.m1.2.2.2.2.2.1.1.1.1.cmml" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.cmml" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.1.cmml" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.2.cmml" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.2.3">2</cn></apply><ci id="A1.Ex7.m1.2.2.2.2.2.1.1.1.3.cmml" xref="A1.Ex7.m1.2.2.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex7.m1.6.6.6.6.1.1.1.3.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3"><times id="A1.Ex7.m1.6.6.6.6.1.1.1.3.1.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.1"></times><ci id="A1.Ex7.m1.6.6.6.6.1.1.1.3.2.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.2">𝛽</ci><apply id="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.3"><log id="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.1.cmml" xref="A1.Ex7.m1.6.6.6.6.1.1.1.3.3.1"></log><apply id="A1.Ex7.m1.4.4.4.4.cmml" xref="A1.Ex7.m1.4.4.4.4"><divide id="A1.Ex7.m1.4.4.4.4.3.cmml" xref="A1.Ex7.m1.4.4.4.4"></divide><apply id="A1.Ex7.m1.3.3.3.3.1.cmml" xref="A1.Ex7.m1.3.3.3.3.1"><times id="A1.Ex7.m1.3.3.3.3.1.2.cmml" xref="A1.Ex7.m1.3.3.3.3.1.2"></times><apply id="A1.Ex7.m1.3.3.3.3.1.3.cmml" xref="A1.Ex7.m1.3.3.3.3.1.3"><csymbol cd="ambiguous" id="A1.Ex7.m1.3.3.3.3.1.3.1.cmml" xref="A1.Ex7.m1.3.3.3.3.1.3">superscript</csymbol><ci id="A1.Ex7.m1.3.3.3.3.1.3.2.cmml" xref="A1.Ex7.m1.3.3.3.3.1.3.2">𝜋</ci><times id="A1.Ex7.m1.3.3.3.3.1.3.3.cmml" xref="A1.Ex7.m1.3.3.3.3.1.3.3"></times></apply><apply id="A1.Ex7.m1.3.3.3.3.1.1.1.1.cmml" xref="A1.Ex7.m1.3.3.3.3.1.1.1"><csymbol cd="latexml" id="A1.Ex7.m1.3.3.3.3.1.1.1.1.1.cmml" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.cmml" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.1.cmml" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.2.cmml" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.2.3">1</cn></apply><ci id="A1.Ex7.m1.3.3.3.3.1.1.1.1.3.cmml" xref="A1.Ex7.m1.3.3.3.3.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex7.m1.4.4.4.4.2.cmml" xref="A1.Ex7.m1.4.4.4.4.2"><times id="A1.Ex7.m1.4.4.4.4.2.2.cmml" xref="A1.Ex7.m1.4.4.4.4.2.2"></times><apply id="A1.Ex7.m1.4.4.4.4.2.3.cmml" xref="A1.Ex7.m1.4.4.4.4.2.3"><csymbol cd="ambiguous" id="A1.Ex7.m1.4.4.4.4.2.3.1.cmml" xref="A1.Ex7.m1.4.4.4.4.2.3">subscript</csymbol><ci id="A1.Ex7.m1.4.4.4.4.2.3.2.cmml" xref="A1.Ex7.m1.4.4.4.4.2.3.2">𝜋</ci><ci id="A1.Ex7.m1.4.4.4.4.2.3.3a.cmml" xref="A1.Ex7.m1.4.4.4.4.2.3.3"><mtext id="A1.Ex7.m1.4.4.4.4.2.3.3.cmml" mathsize="50%" xref="A1.Ex7.m1.4.4.4.4.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex7.m1.4.4.4.4.2.1.1.1.cmml" xref="A1.Ex7.m1.4.4.4.4.2.1.1"><csymbol cd="latexml" id="A1.Ex7.m1.4.4.4.4.2.1.1.1.1.cmml" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.cmml" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.1.cmml" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.2.cmml" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.2.3">1</cn></apply><ci id="A1.Ex7.m1.4.4.4.4.2.1.1.1.3.cmml" xref="A1.Ex7.m1.4.4.4.4.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex7.m1.6c">\displaystyle=\frac{1}{1+\exp\left(\beta\log\frac{\pi^{*}(y_{2}|x)}{\pi_{\text%
{ref}}(y_{2}|x)}-\beta\log\frac{\pi^{*}(y_{1}|x)}{\pi_{\text{ref}}(y_{1}|x)}%
\right)}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex7.m1.6d">= divide start_ARG 1 end_ARG start_ARG 1 + roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex8"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\sigma\left(\beta\log\frac{\pi^{*}(y_{1}|x)}{\pi_{\text{ref}}(y_%
{1}|x)}-\beta\log\frac{\pi^{*}(y_{2}|x)}{\pi_{\text{ref}}(y_{2}|x)}\right)." class="ltx_Math" display="inline" id="A1.Ex8.m1.5"><semantics id="A1.Ex8.m1.5a"><mrow id="A1.Ex8.m1.5.5.1" xref="A1.Ex8.m1.5.5.1.1.cmml"><mrow id="A1.Ex8.m1.5.5.1.1" xref="A1.Ex8.m1.5.5.1.1.cmml"><mi id="A1.Ex8.m1.5.5.1.1.3" xref="A1.Ex8.m1.5.5.1.1.3.cmml"></mi><mo id="A1.Ex8.m1.5.5.1.1.2" xref="A1.Ex8.m1.5.5.1.1.2.cmml">=</mo><mrow id="A1.Ex8.m1.5.5.1.1.1" xref="A1.Ex8.m1.5.5.1.1.1.cmml"><mi id="A1.Ex8.m1.5.5.1.1.1.3" xref="A1.Ex8.m1.5.5.1.1.1.3.cmml">σ</mi><mo id="A1.Ex8.m1.5.5.1.1.1.2" xref="A1.Ex8.m1.5.5.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex8.m1.5.5.1.1.1.1.1" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.cmml"><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.2" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex8.m1.5.5.1.1.1.1.1.1" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.cmml"><mrow id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.2" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.2.cmml">β</mi><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.1" lspace="0.167em" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.cmml"><mi id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.1" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.1.cmml">log</mi><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3a" lspace="0.167em" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.cmml">⁡</mo><mstyle displaystyle="true" id="A1.Ex8.m1.2.2" xref="A1.Ex8.m1.2.2.cmml"><mfrac id="A1.Ex8.m1.2.2a" xref="A1.Ex8.m1.2.2.cmml"><mrow id="A1.Ex8.m1.1.1.1" xref="A1.Ex8.m1.1.1.1.cmml"><msup id="A1.Ex8.m1.1.1.1.3" xref="A1.Ex8.m1.1.1.1.3.cmml"><mi id="A1.Ex8.m1.1.1.1.3.2" xref="A1.Ex8.m1.1.1.1.3.2.cmml">π</mi><mo id="A1.Ex8.m1.1.1.1.3.3" xref="A1.Ex8.m1.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.Ex8.m1.1.1.1.2" xref="A1.Ex8.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex8.m1.1.1.1.1.1" xref="A1.Ex8.m1.1.1.1.1.1.1.cmml"><mo id="A1.Ex8.m1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex8.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex8.m1.1.1.1.1.1.1" xref="A1.Ex8.m1.1.1.1.1.1.1.cmml"><msub id="A1.Ex8.m1.1.1.1.1.1.1.2" xref="A1.Ex8.m1.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex8.m1.1.1.1.1.1.1.2.2" xref="A1.Ex8.m1.1.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex8.m1.1.1.1.1.1.1.2.3" xref="A1.Ex8.m1.1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex8.m1.1.1.1.1.1.1.1" xref="A1.Ex8.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex8.m1.1.1.1.1.1.1.3" xref="A1.Ex8.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex8.m1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex8.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex8.m1.2.2.2" xref="A1.Ex8.m1.2.2.2.cmml"><msub id="A1.Ex8.m1.2.2.2.3" xref="A1.Ex8.m1.2.2.2.3.cmml"><mi id="A1.Ex8.m1.2.2.2.3.2" xref="A1.Ex8.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex8.m1.2.2.2.3.3" xref="A1.Ex8.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex8.m1.2.2.2.2" xref="A1.Ex8.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex8.m1.2.2.2.1.1" xref="A1.Ex8.m1.2.2.2.1.1.1.cmml"><mo id="A1.Ex8.m1.2.2.2.1.1.2" stretchy="false" xref="A1.Ex8.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex8.m1.2.2.2.1.1.1" xref="A1.Ex8.m1.2.2.2.1.1.1.cmml"><msub id="A1.Ex8.m1.2.2.2.1.1.1.2" xref="A1.Ex8.m1.2.2.2.1.1.1.2.cmml"><mi id="A1.Ex8.m1.2.2.2.1.1.1.2.2" xref="A1.Ex8.m1.2.2.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex8.m1.2.2.2.1.1.1.2.3" xref="A1.Ex8.m1.2.2.2.1.1.1.2.3.cmml">1</mn></msub><mo fence="false" id="A1.Ex8.m1.2.2.2.1.1.1.1" xref="A1.Ex8.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex8.m1.2.2.2.1.1.1.3" xref="A1.Ex8.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex8.m1.2.2.2.1.1.3" stretchy="false" xref="A1.Ex8.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow></mrow><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.1.1" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.1.cmml">−</mo><mrow id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.cmml"><mi id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.2" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.2.cmml">β</mi><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.1" lspace="0.167em" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.cmml"><mi id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.1" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.1.cmml">log</mi><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3a" lspace="0.167em" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.cmml">⁡</mo><mstyle displaystyle="true" id="A1.Ex8.m1.4.4" xref="A1.Ex8.m1.4.4.cmml"><mfrac id="A1.Ex8.m1.4.4a" xref="A1.Ex8.m1.4.4.cmml"><mrow id="A1.Ex8.m1.3.3.1" xref="A1.Ex8.m1.3.3.1.cmml"><msup id="A1.Ex8.m1.3.3.1.3" xref="A1.Ex8.m1.3.3.1.3.cmml"><mi id="A1.Ex8.m1.3.3.1.3.2" xref="A1.Ex8.m1.3.3.1.3.2.cmml">π</mi><mo id="A1.Ex8.m1.3.3.1.3.3" xref="A1.Ex8.m1.3.3.1.3.3.cmml">*</mo></msup><mo id="A1.Ex8.m1.3.3.1.2" xref="A1.Ex8.m1.3.3.1.2.cmml">⁢</mo><mrow id="A1.Ex8.m1.3.3.1.1.1" xref="A1.Ex8.m1.3.3.1.1.1.1.cmml"><mo id="A1.Ex8.m1.3.3.1.1.1.2" stretchy="false" xref="A1.Ex8.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="A1.Ex8.m1.3.3.1.1.1.1" xref="A1.Ex8.m1.3.3.1.1.1.1.cmml"><msub id="A1.Ex8.m1.3.3.1.1.1.1.2" xref="A1.Ex8.m1.3.3.1.1.1.1.2.cmml"><mi id="A1.Ex8.m1.3.3.1.1.1.1.2.2" xref="A1.Ex8.m1.3.3.1.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex8.m1.3.3.1.1.1.1.2.3" xref="A1.Ex8.m1.3.3.1.1.1.1.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex8.m1.3.3.1.1.1.1.1" xref="A1.Ex8.m1.3.3.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex8.m1.3.3.1.1.1.1.3" xref="A1.Ex8.m1.3.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex8.m1.3.3.1.1.1.3" stretchy="false" xref="A1.Ex8.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex8.m1.4.4.2" xref="A1.Ex8.m1.4.4.2.cmml"><msub id="A1.Ex8.m1.4.4.2.3" xref="A1.Ex8.m1.4.4.2.3.cmml"><mi id="A1.Ex8.m1.4.4.2.3.2" xref="A1.Ex8.m1.4.4.2.3.2.cmml">π</mi><mtext id="A1.Ex8.m1.4.4.2.3.3" xref="A1.Ex8.m1.4.4.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex8.m1.4.4.2.2" xref="A1.Ex8.m1.4.4.2.2.cmml">⁢</mo><mrow id="A1.Ex8.m1.4.4.2.1.1" xref="A1.Ex8.m1.4.4.2.1.1.1.cmml"><mo id="A1.Ex8.m1.4.4.2.1.1.2" stretchy="false" xref="A1.Ex8.m1.4.4.2.1.1.1.cmml">(</mo><mrow id="A1.Ex8.m1.4.4.2.1.1.1" xref="A1.Ex8.m1.4.4.2.1.1.1.cmml"><msub id="A1.Ex8.m1.4.4.2.1.1.1.2" xref="A1.Ex8.m1.4.4.2.1.1.1.2.cmml"><mi id="A1.Ex8.m1.4.4.2.1.1.1.2.2" xref="A1.Ex8.m1.4.4.2.1.1.1.2.2.cmml">y</mi><mn id="A1.Ex8.m1.4.4.2.1.1.1.2.3" xref="A1.Ex8.m1.4.4.2.1.1.1.2.3.cmml">2</mn></msub><mo fence="false" id="A1.Ex8.m1.4.4.2.1.1.1.1" xref="A1.Ex8.m1.4.4.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex8.m1.4.4.2.1.1.1.3" xref="A1.Ex8.m1.4.4.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex8.m1.4.4.2.1.1.3" stretchy="false" xref="A1.Ex8.m1.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow></mrow></mrow><mo id="A1.Ex8.m1.5.5.1.1.1.1.1.3" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex8.m1.5.5.1.2" lspace="0em" xref="A1.Ex8.m1.5.5.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex8.m1.5b"><apply id="A1.Ex8.m1.5.5.1.1.cmml" xref="A1.Ex8.m1.5.5.1"><eq id="A1.Ex8.m1.5.5.1.1.2.cmml" xref="A1.Ex8.m1.5.5.1.1.2"></eq><csymbol cd="latexml" id="A1.Ex8.m1.5.5.1.1.3.cmml" xref="A1.Ex8.m1.5.5.1.1.3">absent</csymbol><apply id="A1.Ex8.m1.5.5.1.1.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1"><times id="A1.Ex8.m1.5.5.1.1.1.2.cmml" xref="A1.Ex8.m1.5.5.1.1.1.2"></times><ci id="A1.Ex8.m1.5.5.1.1.1.3.cmml" xref="A1.Ex8.m1.5.5.1.1.1.3">𝜎</ci><apply id="A1.Ex8.m1.5.5.1.1.1.1.1.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1"><minus id="A1.Ex8.m1.5.5.1.1.1.1.1.1.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.1"></minus><apply id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2"><times id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.1"></times><ci id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.2">𝛽</ci><apply id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3"><log id="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.2.3.1"></log><apply id="A1.Ex8.m1.2.2.cmml" xref="A1.Ex8.m1.2.2"><divide id="A1.Ex8.m1.2.2.3.cmml" xref="A1.Ex8.m1.2.2"></divide><apply id="A1.Ex8.m1.1.1.1.cmml" xref="A1.Ex8.m1.1.1.1"><times id="A1.Ex8.m1.1.1.1.2.cmml" xref="A1.Ex8.m1.1.1.1.2"></times><apply id="A1.Ex8.m1.1.1.1.3.cmml" xref="A1.Ex8.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex8.m1.1.1.1.3.1.cmml" xref="A1.Ex8.m1.1.1.1.3">superscript</csymbol><ci id="A1.Ex8.m1.1.1.1.3.2.cmml" xref="A1.Ex8.m1.1.1.1.3.2">𝜋</ci><times id="A1.Ex8.m1.1.1.1.3.3.cmml" xref="A1.Ex8.m1.1.1.1.3.3"></times></apply><apply id="A1.Ex8.m1.1.1.1.1.1.1.cmml" xref="A1.Ex8.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex8.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex8.m1.1.1.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex8.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex8.m1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex8.m1.1.1.1.1.1.1.2.1.cmml" xref="A1.Ex8.m1.1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex8.m1.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex8.m1.1.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex8.m1.1.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex8.m1.1.1.1.1.1.1.2.3">1</cn></apply><ci id="A1.Ex8.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex8.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex8.m1.2.2.2.cmml" xref="A1.Ex8.m1.2.2.2"><times id="A1.Ex8.m1.2.2.2.2.cmml" xref="A1.Ex8.m1.2.2.2.2"></times><apply id="A1.Ex8.m1.2.2.2.3.cmml" xref="A1.Ex8.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex8.m1.2.2.2.3.1.cmml" xref="A1.Ex8.m1.2.2.2.3">subscript</csymbol><ci id="A1.Ex8.m1.2.2.2.3.2.cmml" xref="A1.Ex8.m1.2.2.2.3.2">𝜋</ci><ci id="A1.Ex8.m1.2.2.2.3.3a.cmml" xref="A1.Ex8.m1.2.2.2.3.3"><mtext id="A1.Ex8.m1.2.2.2.3.3.cmml" mathsize="70%" xref="A1.Ex8.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex8.m1.2.2.2.1.1.1.cmml" xref="A1.Ex8.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex8.m1.2.2.2.1.1.1.1.cmml" xref="A1.Ex8.m1.2.2.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex8.m1.2.2.2.1.1.1.2.cmml" xref="A1.Ex8.m1.2.2.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex8.m1.2.2.2.1.1.1.2.1.cmml" xref="A1.Ex8.m1.2.2.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex8.m1.2.2.2.1.1.1.2.2.cmml" xref="A1.Ex8.m1.2.2.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex8.m1.2.2.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex8.m1.2.2.2.1.1.1.2.3">1</cn></apply><ci id="A1.Ex8.m1.2.2.2.1.1.1.3.cmml" xref="A1.Ex8.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3"><times id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.1"></times><ci id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.2.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.2">𝛽</ci><apply id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3"><log id="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.1.cmml" xref="A1.Ex8.m1.5.5.1.1.1.1.1.1.3.3.1"></log><apply id="A1.Ex8.m1.4.4.cmml" xref="A1.Ex8.m1.4.4"><divide id="A1.Ex8.m1.4.4.3.cmml" xref="A1.Ex8.m1.4.4"></divide><apply id="A1.Ex8.m1.3.3.1.cmml" xref="A1.Ex8.m1.3.3.1"><times id="A1.Ex8.m1.3.3.1.2.cmml" xref="A1.Ex8.m1.3.3.1.2"></times><apply id="A1.Ex8.m1.3.3.1.3.cmml" xref="A1.Ex8.m1.3.3.1.3"><csymbol cd="ambiguous" id="A1.Ex8.m1.3.3.1.3.1.cmml" xref="A1.Ex8.m1.3.3.1.3">superscript</csymbol><ci id="A1.Ex8.m1.3.3.1.3.2.cmml" xref="A1.Ex8.m1.3.3.1.3.2">𝜋</ci><times id="A1.Ex8.m1.3.3.1.3.3.cmml" xref="A1.Ex8.m1.3.3.1.3.3"></times></apply><apply id="A1.Ex8.m1.3.3.1.1.1.1.cmml" xref="A1.Ex8.m1.3.3.1.1.1"><csymbol cd="latexml" id="A1.Ex8.m1.3.3.1.1.1.1.1.cmml" xref="A1.Ex8.m1.3.3.1.1.1.1.1">conditional</csymbol><apply id="A1.Ex8.m1.3.3.1.1.1.1.2.cmml" xref="A1.Ex8.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex8.m1.3.3.1.1.1.1.2.1.cmml" xref="A1.Ex8.m1.3.3.1.1.1.1.2">subscript</csymbol><ci id="A1.Ex8.m1.3.3.1.1.1.1.2.2.cmml" xref="A1.Ex8.m1.3.3.1.1.1.1.2.2">𝑦</ci><cn id="A1.Ex8.m1.3.3.1.1.1.1.2.3.cmml" type="integer" xref="A1.Ex8.m1.3.3.1.1.1.1.2.3">2</cn></apply><ci id="A1.Ex8.m1.3.3.1.1.1.1.3.cmml" xref="A1.Ex8.m1.3.3.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex8.m1.4.4.2.cmml" xref="A1.Ex8.m1.4.4.2"><times id="A1.Ex8.m1.4.4.2.2.cmml" xref="A1.Ex8.m1.4.4.2.2"></times><apply id="A1.Ex8.m1.4.4.2.3.cmml" xref="A1.Ex8.m1.4.4.2.3"><csymbol cd="ambiguous" id="A1.Ex8.m1.4.4.2.3.1.cmml" xref="A1.Ex8.m1.4.4.2.3">subscript</csymbol><ci id="A1.Ex8.m1.4.4.2.3.2.cmml" xref="A1.Ex8.m1.4.4.2.3.2">𝜋</ci><ci id="A1.Ex8.m1.4.4.2.3.3a.cmml" xref="A1.Ex8.m1.4.4.2.3.3"><mtext id="A1.Ex8.m1.4.4.2.3.3.cmml" mathsize="70%" xref="A1.Ex8.m1.4.4.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex8.m1.4.4.2.1.1.1.cmml" xref="A1.Ex8.m1.4.4.2.1.1"><csymbol cd="latexml" id="A1.Ex8.m1.4.4.2.1.1.1.1.cmml" xref="A1.Ex8.m1.4.4.2.1.1.1.1">conditional</csymbol><apply id="A1.Ex8.m1.4.4.2.1.1.1.2.cmml" xref="A1.Ex8.m1.4.4.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.Ex8.m1.4.4.2.1.1.1.2.1.cmml" xref="A1.Ex8.m1.4.4.2.1.1.1.2">subscript</csymbol><ci id="A1.Ex8.m1.4.4.2.1.1.1.2.2.cmml" xref="A1.Ex8.m1.4.4.2.1.1.1.2.2">𝑦</ci><cn id="A1.Ex8.m1.4.4.2.1.1.1.2.3.cmml" type="integer" xref="A1.Ex8.m1.4.4.2.1.1.1.2.3">2</cn></apply><ci id="A1.Ex8.m1.4.4.2.1.1.1.3.cmml" xref="A1.Ex8.m1.4.4.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex8.m1.5c">\displaystyle=\sigma\left(\beta\log\frac{\pi^{*}(y_{1}|x)}{\pi_{\text{ref}}(y_%
{1}|x)}-\beta\log\frac{\pi^{*}(y_{2}|x)}{\pi_{\text{ref}}(y_{2}|x)}\right).</annotation><annotation encoding="application/x-llamapun" id="A1.Ex8.m1.5d">= italic_σ ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT | italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT | italic_x ) end_ARG ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS2.p4">
<p class="ltx_p" id="A1.SS2.p4.1">The last line is the per-instance loss in Equation&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E7" title="7 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">7</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="A1.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.3 </span>Deriving the DPO Objective Under the Plackett-Luce Model</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS3.p1">
<p class="ltx_p" id="A1.SS3.p1.4">The Plackett-Luce model <cite class="ltx_cite ltx_citemacro_citep">[Plackett, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib30" title="">1975</a>, Luce, <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib21" title="">2012</a>]</cite> is a generalization of the Bradley-Terry model over rankings (rather than just pair-wise comparisons). Similar to to the Bradley-Terry model, it stipulates that when presented with a set of possible choices, people prefer a choice with probability proportional to the value of some latent reward function for that choice. In our context, when presented with a prompt <math alttext="x" class="ltx_Math" display="inline" id="A1.SS3.p1.1.m1.1"><semantics id="A1.SS3.p1.1.m1.1a"><mi id="A1.SS3.p1.1.m1.1.1" xref="A1.SS3.p1.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="A1.SS3.p1.1.m1.1b"><ci id="A1.SS3.p1.1.m1.1.1.cmml" xref="A1.SS3.p1.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p1.1.m1.1c">x</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p1.1.m1.1d">italic_x</annotation></semantics></math> and a set of <math alttext="K" class="ltx_Math" display="inline" id="A1.SS3.p1.2.m2.1"><semantics id="A1.SS3.p1.2.m2.1a"><mi id="A1.SS3.p1.2.m2.1.1" xref="A1.SS3.p1.2.m2.1.1.cmml">K</mi><annotation-xml encoding="MathML-Content" id="A1.SS3.p1.2.m2.1b"><ci id="A1.SS3.p1.2.m2.1.1.cmml" xref="A1.SS3.p1.2.m2.1.1">𝐾</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p1.2.m2.1c">K</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p1.2.m2.1d">italic_K</annotation></semantics></math> answers <math alttext="y_{1},\ldots,y_{K}" class="ltx_Math" display="inline" id="A1.SS3.p1.3.m3.3"><semantics id="A1.SS3.p1.3.m3.3a"><mrow id="A1.SS3.p1.3.m3.3.3.2" xref="A1.SS3.p1.3.m3.3.3.3.cmml"><msub id="A1.SS3.p1.3.m3.2.2.1.1" xref="A1.SS3.p1.3.m3.2.2.1.1.cmml"><mi id="A1.SS3.p1.3.m3.2.2.1.1.2" xref="A1.SS3.p1.3.m3.2.2.1.1.2.cmml">y</mi><mn id="A1.SS3.p1.3.m3.2.2.1.1.3" xref="A1.SS3.p1.3.m3.2.2.1.1.3.cmml">1</mn></msub><mo id="A1.SS3.p1.3.m3.3.3.2.3" xref="A1.SS3.p1.3.m3.3.3.3.cmml">,</mo><mi id="A1.SS3.p1.3.m3.1.1" mathvariant="normal" xref="A1.SS3.p1.3.m3.1.1.cmml">…</mi><mo id="A1.SS3.p1.3.m3.3.3.2.4" xref="A1.SS3.p1.3.m3.3.3.3.cmml">,</mo><msub id="A1.SS3.p1.3.m3.3.3.2.2" xref="A1.SS3.p1.3.m3.3.3.2.2.cmml"><mi id="A1.SS3.p1.3.m3.3.3.2.2.2" xref="A1.SS3.p1.3.m3.3.3.2.2.2.cmml">y</mi><mi id="A1.SS3.p1.3.m3.3.3.2.2.3" xref="A1.SS3.p1.3.m3.3.3.2.2.3.cmml">K</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p1.3.m3.3b"><list id="A1.SS3.p1.3.m3.3.3.3.cmml" xref="A1.SS3.p1.3.m3.3.3.2"><apply id="A1.SS3.p1.3.m3.2.2.1.1.cmml" xref="A1.SS3.p1.3.m3.2.2.1.1"><csymbol cd="ambiguous" id="A1.SS3.p1.3.m3.2.2.1.1.1.cmml" xref="A1.SS3.p1.3.m3.2.2.1.1">subscript</csymbol><ci id="A1.SS3.p1.3.m3.2.2.1.1.2.cmml" xref="A1.SS3.p1.3.m3.2.2.1.1.2">𝑦</ci><cn id="A1.SS3.p1.3.m3.2.2.1.1.3.cmml" type="integer" xref="A1.SS3.p1.3.m3.2.2.1.1.3">1</cn></apply><ci id="A1.SS3.p1.3.m3.1.1.cmml" xref="A1.SS3.p1.3.m3.1.1">…</ci><apply id="A1.SS3.p1.3.m3.3.3.2.2.cmml" xref="A1.SS3.p1.3.m3.3.3.2.2"><csymbol cd="ambiguous" id="A1.SS3.p1.3.m3.3.3.2.2.1.cmml" xref="A1.SS3.p1.3.m3.3.3.2.2">subscript</csymbol><ci id="A1.SS3.p1.3.m3.3.3.2.2.2.cmml" xref="A1.SS3.p1.3.m3.3.3.2.2.2">𝑦</ci><ci id="A1.SS3.p1.3.m3.3.3.2.2.3.cmml" xref="A1.SS3.p1.3.m3.3.3.2.2.3">𝐾</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p1.3.m3.3c">y_{1},\ldots,y_{K}</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p1.3.m3.3d">italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT</annotation></semantics></math> a user would output a permutation <math alttext="\tau:[K]\to[K]" class="ltx_Math" display="inline" id="A1.SS3.p1.4.m4.2"><semantics id="A1.SS3.p1.4.m4.2a"><mrow id="A1.SS3.p1.4.m4.2.3" xref="A1.SS3.p1.4.m4.2.3.cmml"><mi id="A1.SS3.p1.4.m4.2.3.2" xref="A1.SS3.p1.4.m4.2.3.2.cmml">τ</mi><mo id="A1.SS3.p1.4.m4.2.3.1" lspace="0.278em" rspace="0.278em" xref="A1.SS3.p1.4.m4.2.3.1.cmml">:</mo><mrow id="A1.SS3.p1.4.m4.2.3.3" xref="A1.SS3.p1.4.m4.2.3.3.cmml"><mrow id="A1.SS3.p1.4.m4.2.3.3.2.2" xref="A1.SS3.p1.4.m4.2.3.3.2.1.cmml"><mo id="A1.SS3.p1.4.m4.2.3.3.2.2.1" stretchy="false" xref="A1.SS3.p1.4.m4.2.3.3.2.1.1.cmml">[</mo><mi id="A1.SS3.p1.4.m4.1.1" xref="A1.SS3.p1.4.m4.1.1.cmml">K</mi><mo id="A1.SS3.p1.4.m4.2.3.3.2.2.2" stretchy="false" xref="A1.SS3.p1.4.m4.2.3.3.2.1.1.cmml">]</mo></mrow><mo id="A1.SS3.p1.4.m4.2.3.3.1" stretchy="false" xref="A1.SS3.p1.4.m4.2.3.3.1.cmml">→</mo><mrow id="A1.SS3.p1.4.m4.2.3.3.3.2" xref="A1.SS3.p1.4.m4.2.3.3.3.1.cmml"><mo id="A1.SS3.p1.4.m4.2.3.3.3.2.1" stretchy="false" xref="A1.SS3.p1.4.m4.2.3.3.3.1.1.cmml">[</mo><mi id="A1.SS3.p1.4.m4.2.2" xref="A1.SS3.p1.4.m4.2.2.cmml">K</mi><mo id="A1.SS3.p1.4.m4.2.3.3.3.2.2" stretchy="false" xref="A1.SS3.p1.4.m4.2.3.3.3.1.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p1.4.m4.2b"><apply id="A1.SS3.p1.4.m4.2.3.cmml" xref="A1.SS3.p1.4.m4.2.3"><ci id="A1.SS3.p1.4.m4.2.3.1.cmml" xref="A1.SS3.p1.4.m4.2.3.1">:</ci><ci id="A1.SS3.p1.4.m4.2.3.2.cmml" xref="A1.SS3.p1.4.m4.2.3.2">𝜏</ci><apply id="A1.SS3.p1.4.m4.2.3.3.cmml" xref="A1.SS3.p1.4.m4.2.3.3"><ci id="A1.SS3.p1.4.m4.2.3.3.1.cmml" xref="A1.SS3.p1.4.m4.2.3.3.1">→</ci><apply id="A1.SS3.p1.4.m4.2.3.3.2.1.cmml" xref="A1.SS3.p1.4.m4.2.3.3.2.2"><csymbol cd="latexml" id="A1.SS3.p1.4.m4.2.3.3.2.1.1.cmml" xref="A1.SS3.p1.4.m4.2.3.3.2.2.1">delimited-[]</csymbol><ci id="A1.SS3.p1.4.m4.1.1.cmml" xref="A1.SS3.p1.4.m4.1.1">𝐾</ci></apply><apply id="A1.SS3.p1.4.m4.2.3.3.3.1.cmml" xref="A1.SS3.p1.4.m4.2.3.3.3.2"><csymbol cd="latexml" id="A1.SS3.p1.4.m4.2.3.3.3.1.1.cmml" xref="A1.SS3.p1.4.m4.2.3.3.3.2.1">delimited-[]</csymbol><ci id="A1.SS3.p1.4.m4.2.2.cmml" xref="A1.SS3.p1.4.m4.2.2">𝐾</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p1.4.m4.2c">\tau:[K]\to[K]</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p1.4.m4.2d">italic_τ : [ italic_K ] → [ italic_K ]</annotation></semantics></math>, giving their ranking of the answers. The Plackett-Luce model stipulates that</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E18">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p^{*}(\tau|y_{1},\ldots,y_{K},x)=\prod_{k=1}^{K}\frac{\exp(r^{*}(x,y_{\tau(k)}%
))}{\sum_{j=k}^{K}\exp(r^{*}(x,y_{\tau(j)}))}" class="ltx_Math" display="block" id="A1.E18.m1.11"><semantics id="A1.E18.m1.11a"><mrow id="A1.E18.m1.11.11" xref="A1.E18.m1.11.11.cmml"><mrow id="A1.E18.m1.11.11.1" xref="A1.E18.m1.11.11.1.cmml"><msup id="A1.E18.m1.11.11.1.3" xref="A1.E18.m1.11.11.1.3.cmml"><mi id="A1.E18.m1.11.11.1.3.2" xref="A1.E18.m1.11.11.1.3.2.cmml">p</mi><mo id="A1.E18.m1.11.11.1.3.3" xref="A1.E18.m1.11.11.1.3.3.cmml">*</mo></msup><mo id="A1.E18.m1.11.11.1.2" xref="A1.E18.m1.11.11.1.2.cmml">⁢</mo><mrow id="A1.E18.m1.11.11.1.1.1" xref="A1.E18.m1.11.11.1.1.1.1.cmml"><mo id="A1.E18.m1.11.11.1.1.1.2" stretchy="false" xref="A1.E18.m1.11.11.1.1.1.1.cmml">(</mo><mrow id="A1.E18.m1.11.11.1.1.1.1" xref="A1.E18.m1.11.11.1.1.1.1.cmml"><mi id="A1.E18.m1.11.11.1.1.1.1.4" xref="A1.E18.m1.11.11.1.1.1.1.4.cmml">τ</mi><mo fence="false" id="A1.E18.m1.11.11.1.1.1.1.3" xref="A1.E18.m1.11.11.1.1.1.1.3.cmml">|</mo><mrow id="A1.E18.m1.11.11.1.1.1.1.2.2" xref="A1.E18.m1.11.11.1.1.1.1.2.3.cmml"><msub id="A1.E18.m1.11.11.1.1.1.1.1.1.1" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1.cmml"><mi id="A1.E18.m1.11.11.1.1.1.1.1.1.1.2" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E18.m1.11.11.1.1.1.1.1.1.1.3" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.E18.m1.11.11.1.1.1.1.2.2.3" xref="A1.E18.m1.11.11.1.1.1.1.2.3.cmml">,</mo><mi id="A1.E18.m1.9.9" mathvariant="normal" xref="A1.E18.m1.9.9.cmml">…</mi><mo id="A1.E18.m1.11.11.1.1.1.1.2.2.4" xref="A1.E18.m1.11.11.1.1.1.1.2.3.cmml">,</mo><msub id="A1.E18.m1.11.11.1.1.1.1.2.2.2" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2.cmml"><mi id="A1.E18.m1.11.11.1.1.1.1.2.2.2.2" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="A1.E18.m1.11.11.1.1.1.1.2.2.2.3" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2.3.cmml">K</mi></msub><mo id="A1.E18.m1.11.11.1.1.1.1.2.2.5" xref="A1.E18.m1.11.11.1.1.1.1.2.3.cmml">,</mo><mi id="A1.E18.m1.10.10" xref="A1.E18.m1.10.10.cmml">x</mi></mrow></mrow><mo id="A1.E18.m1.11.11.1.1.1.3" stretchy="false" xref="A1.E18.m1.11.11.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E18.m1.11.11.2" rspace="0.111em" xref="A1.E18.m1.11.11.2.cmml">=</mo><mrow id="A1.E18.m1.11.11.3" xref="A1.E18.m1.11.11.3.cmml"><munderover id="A1.E18.m1.11.11.3.1" xref="A1.E18.m1.11.11.3.1.cmml"><mo id="A1.E18.m1.11.11.3.1.2.2" movablelimits="false" xref="A1.E18.m1.11.11.3.1.2.2.cmml">∏</mo><mrow id="A1.E18.m1.11.11.3.1.2.3" xref="A1.E18.m1.11.11.3.1.2.3.cmml"><mi id="A1.E18.m1.11.11.3.1.2.3.2" xref="A1.E18.m1.11.11.3.1.2.3.2.cmml">k</mi><mo id="A1.E18.m1.11.11.3.1.2.3.1" xref="A1.E18.m1.11.11.3.1.2.3.1.cmml">=</mo><mn id="A1.E18.m1.11.11.3.1.2.3.3" xref="A1.E18.m1.11.11.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.E18.m1.11.11.3.1.3" xref="A1.E18.m1.11.11.3.1.3.cmml">K</mi></munderover><mfrac id="A1.E18.m1.8.8" xref="A1.E18.m1.8.8.cmml"><mrow id="A1.E18.m1.4.4.4.4" xref="A1.E18.m1.4.4.4.5.cmml"><mi id="A1.E18.m1.3.3.3.3" xref="A1.E18.m1.3.3.3.3.cmml">exp</mi><mo id="A1.E18.m1.4.4.4.4a" xref="A1.E18.m1.4.4.4.5.cmml">⁡</mo><mrow id="A1.E18.m1.4.4.4.4.1" xref="A1.E18.m1.4.4.4.5.cmml"><mo id="A1.E18.m1.4.4.4.4.1.2" stretchy="false" xref="A1.E18.m1.4.4.4.5.cmml">(</mo><mrow id="A1.E18.m1.4.4.4.4.1.1" xref="A1.E18.m1.4.4.4.4.1.1.cmml"><msup id="A1.E18.m1.4.4.4.4.1.1.3" xref="A1.E18.m1.4.4.4.4.1.1.3.cmml"><mi id="A1.E18.m1.4.4.4.4.1.1.3.2" xref="A1.E18.m1.4.4.4.4.1.1.3.2.cmml">r</mi><mo id="A1.E18.m1.4.4.4.4.1.1.3.3" xref="A1.E18.m1.4.4.4.4.1.1.3.3.cmml">*</mo></msup><mo id="A1.E18.m1.4.4.4.4.1.1.2" xref="A1.E18.m1.4.4.4.4.1.1.2.cmml">⁢</mo><mrow id="A1.E18.m1.4.4.4.4.1.1.1.1" xref="A1.E18.m1.4.4.4.4.1.1.1.2.cmml"><mo id="A1.E18.m1.4.4.4.4.1.1.1.1.2" stretchy="false" xref="A1.E18.m1.4.4.4.4.1.1.1.2.cmml">(</mo><mi id="A1.E18.m1.2.2.2.2" xref="A1.E18.m1.2.2.2.2.cmml">x</mi><mo id="A1.E18.m1.4.4.4.4.1.1.1.1.3" xref="A1.E18.m1.4.4.4.4.1.1.1.2.cmml">,</mo><msub id="A1.E18.m1.4.4.4.4.1.1.1.1.1" xref="A1.E18.m1.4.4.4.4.1.1.1.1.1.cmml"><mi id="A1.E18.m1.4.4.4.4.1.1.1.1.1.2" xref="A1.E18.m1.4.4.4.4.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.E18.m1.1.1.1.1.1" xref="A1.E18.m1.1.1.1.1.1.cmml"><mi id="A1.E18.m1.1.1.1.1.1.3" xref="A1.E18.m1.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.E18.m1.1.1.1.1.1.2" xref="A1.E18.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E18.m1.1.1.1.1.1.4.2" xref="A1.E18.m1.1.1.1.1.1.cmml"><mo id="A1.E18.m1.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.E18.m1.1.1.1.1.1.cmml">(</mo><mi id="A1.E18.m1.1.1.1.1.1.1" xref="A1.E18.m1.1.1.1.1.1.1.cmml">k</mi><mo id="A1.E18.m1.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.E18.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.E18.m1.4.4.4.4.1.1.1.1.4" stretchy="false" xref="A1.E18.m1.4.4.4.4.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E18.m1.4.4.4.4.1.3" stretchy="false" xref="A1.E18.m1.4.4.4.5.cmml">)</mo></mrow></mrow><mrow id="A1.E18.m1.8.8.8" xref="A1.E18.m1.8.8.8.cmml"><msubsup id="A1.E18.m1.8.8.8.5" xref="A1.E18.m1.8.8.8.5.cmml"><mo id="A1.E18.m1.8.8.8.5.2.2" xref="A1.E18.m1.8.8.8.5.2.2.cmml">∑</mo><mrow id="A1.E18.m1.8.8.8.5.2.3" xref="A1.E18.m1.8.8.8.5.2.3.cmml"><mi id="A1.E18.m1.8.8.8.5.2.3.2" xref="A1.E18.m1.8.8.8.5.2.3.2.cmml">j</mi><mo id="A1.E18.m1.8.8.8.5.2.3.1" xref="A1.E18.m1.8.8.8.5.2.3.1.cmml">=</mo><mi id="A1.E18.m1.8.8.8.5.2.3.3" xref="A1.E18.m1.8.8.8.5.2.3.3.cmml">k</mi></mrow><mi id="A1.E18.m1.8.8.8.5.3" xref="A1.E18.m1.8.8.8.5.3.cmml">K</mi></msubsup><mrow id="A1.E18.m1.8.8.8.4.1" xref="A1.E18.m1.8.8.8.4.2.cmml"><mi id="A1.E18.m1.7.7.7.3" xref="A1.E18.m1.7.7.7.3.cmml">exp</mi><mo id="A1.E18.m1.8.8.8.4.1a" xref="A1.E18.m1.8.8.8.4.2.cmml">⁡</mo><mrow id="A1.E18.m1.8.8.8.4.1.1" xref="A1.E18.m1.8.8.8.4.2.cmml"><mo id="A1.E18.m1.8.8.8.4.1.1.2" stretchy="false" xref="A1.E18.m1.8.8.8.4.2.cmml">(</mo><mrow id="A1.E18.m1.8.8.8.4.1.1.1" xref="A1.E18.m1.8.8.8.4.1.1.1.cmml"><msup id="A1.E18.m1.8.8.8.4.1.1.1.3" xref="A1.E18.m1.8.8.8.4.1.1.1.3.cmml"><mi id="A1.E18.m1.8.8.8.4.1.1.1.3.2" xref="A1.E18.m1.8.8.8.4.1.1.1.3.2.cmml">r</mi><mo id="A1.E18.m1.8.8.8.4.1.1.1.3.3" xref="A1.E18.m1.8.8.8.4.1.1.1.3.3.cmml">*</mo></msup><mo id="A1.E18.m1.8.8.8.4.1.1.1.2" xref="A1.E18.m1.8.8.8.4.1.1.1.2.cmml">⁢</mo><mrow id="A1.E18.m1.8.8.8.4.1.1.1.1.1" xref="A1.E18.m1.8.8.8.4.1.1.1.1.2.cmml"><mo id="A1.E18.m1.8.8.8.4.1.1.1.1.1.2" stretchy="false" xref="A1.E18.m1.8.8.8.4.1.1.1.1.2.cmml">(</mo><mi id="A1.E18.m1.6.6.6.2" xref="A1.E18.m1.6.6.6.2.cmml">x</mi><mo id="A1.E18.m1.8.8.8.4.1.1.1.1.1.3" xref="A1.E18.m1.8.8.8.4.1.1.1.1.2.cmml">,</mo><msub id="A1.E18.m1.8.8.8.4.1.1.1.1.1.1" xref="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.cmml"><mi id="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.2" xref="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.E18.m1.5.5.5.1.1" xref="A1.E18.m1.5.5.5.1.1.cmml"><mi id="A1.E18.m1.5.5.5.1.1.3" xref="A1.E18.m1.5.5.5.1.1.3.cmml">τ</mi><mo id="A1.E18.m1.5.5.5.1.1.2" xref="A1.E18.m1.5.5.5.1.1.2.cmml">⁢</mo><mrow id="A1.E18.m1.5.5.5.1.1.4.2" xref="A1.E18.m1.5.5.5.1.1.cmml"><mo id="A1.E18.m1.5.5.5.1.1.4.2.1" stretchy="false" xref="A1.E18.m1.5.5.5.1.1.cmml">(</mo><mi id="A1.E18.m1.5.5.5.1.1.1" xref="A1.E18.m1.5.5.5.1.1.1.cmml">j</mi><mo id="A1.E18.m1.5.5.5.1.1.4.2.2" stretchy="false" xref="A1.E18.m1.5.5.5.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.E18.m1.8.8.8.4.1.1.1.1.1.4" stretchy="false" xref="A1.E18.m1.8.8.8.4.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E18.m1.8.8.8.4.1.1.3" stretchy="false" xref="A1.E18.m1.8.8.8.4.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E18.m1.11b"><apply id="A1.E18.m1.11.11.cmml" xref="A1.E18.m1.11.11"><eq id="A1.E18.m1.11.11.2.cmml" xref="A1.E18.m1.11.11.2"></eq><apply id="A1.E18.m1.11.11.1.cmml" xref="A1.E18.m1.11.11.1"><times id="A1.E18.m1.11.11.1.2.cmml" xref="A1.E18.m1.11.11.1.2"></times><apply id="A1.E18.m1.11.11.1.3.cmml" xref="A1.E18.m1.11.11.1.3"><csymbol cd="ambiguous" id="A1.E18.m1.11.11.1.3.1.cmml" xref="A1.E18.m1.11.11.1.3">superscript</csymbol><ci id="A1.E18.m1.11.11.1.3.2.cmml" xref="A1.E18.m1.11.11.1.3.2">𝑝</ci><times id="A1.E18.m1.11.11.1.3.3.cmml" xref="A1.E18.m1.11.11.1.3.3"></times></apply><apply id="A1.E18.m1.11.11.1.1.1.1.cmml" xref="A1.E18.m1.11.11.1.1.1"><csymbol cd="latexml" id="A1.E18.m1.11.11.1.1.1.1.3.cmml" xref="A1.E18.m1.11.11.1.1.1.1.3">conditional</csymbol><ci id="A1.E18.m1.11.11.1.1.1.1.4.cmml" xref="A1.E18.m1.11.11.1.1.1.1.4">𝜏</ci><list id="A1.E18.m1.11.11.1.1.1.1.2.3.cmml" xref="A1.E18.m1.11.11.1.1.1.1.2.2"><apply id="A1.E18.m1.11.11.1.1.1.1.1.1.1.cmml" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E18.m1.11.11.1.1.1.1.1.1.1.1.cmml" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E18.m1.11.11.1.1.1.1.1.1.1.2.cmml" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.E18.m1.11.11.1.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.E18.m1.11.11.1.1.1.1.1.1.1.3">1</cn></apply><ci id="A1.E18.m1.9.9.cmml" xref="A1.E18.m1.9.9">…</ci><apply id="A1.E18.m1.11.11.1.1.1.1.2.2.2.cmml" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="A1.E18.m1.11.11.1.1.1.1.2.2.2.1.cmml" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2">subscript</csymbol><ci id="A1.E18.m1.11.11.1.1.1.1.2.2.2.2.cmml" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2.2">𝑦</ci><ci id="A1.E18.m1.11.11.1.1.1.1.2.2.2.3.cmml" xref="A1.E18.m1.11.11.1.1.1.1.2.2.2.3">𝐾</ci></apply><ci id="A1.E18.m1.10.10.cmml" xref="A1.E18.m1.10.10">𝑥</ci></list></apply></apply><apply id="A1.E18.m1.11.11.3.cmml" xref="A1.E18.m1.11.11.3"><apply id="A1.E18.m1.11.11.3.1.cmml" xref="A1.E18.m1.11.11.3.1"><csymbol cd="ambiguous" id="A1.E18.m1.11.11.3.1.1.cmml" xref="A1.E18.m1.11.11.3.1">superscript</csymbol><apply id="A1.E18.m1.11.11.3.1.2.cmml" xref="A1.E18.m1.11.11.3.1"><csymbol cd="ambiguous" id="A1.E18.m1.11.11.3.1.2.1.cmml" xref="A1.E18.m1.11.11.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.E18.m1.11.11.3.1.2.2.cmml" xref="A1.E18.m1.11.11.3.1.2.2">product</csymbol><apply id="A1.E18.m1.11.11.3.1.2.3.cmml" xref="A1.E18.m1.11.11.3.1.2.3"><eq id="A1.E18.m1.11.11.3.1.2.3.1.cmml" xref="A1.E18.m1.11.11.3.1.2.3.1"></eq><ci id="A1.E18.m1.11.11.3.1.2.3.2.cmml" xref="A1.E18.m1.11.11.3.1.2.3.2">𝑘</ci><cn id="A1.E18.m1.11.11.3.1.2.3.3.cmml" type="integer" xref="A1.E18.m1.11.11.3.1.2.3.3">1</cn></apply></apply><ci id="A1.E18.m1.11.11.3.1.3.cmml" xref="A1.E18.m1.11.11.3.1.3">𝐾</ci></apply><apply id="A1.E18.m1.8.8.cmml" xref="A1.E18.m1.8.8"><divide id="A1.E18.m1.8.8.9.cmml" xref="A1.E18.m1.8.8"></divide><apply id="A1.E18.m1.4.4.4.5.cmml" xref="A1.E18.m1.4.4.4.4"><exp id="A1.E18.m1.3.3.3.3.cmml" xref="A1.E18.m1.3.3.3.3"></exp><apply id="A1.E18.m1.4.4.4.4.1.1.cmml" xref="A1.E18.m1.4.4.4.4.1.1"><times id="A1.E18.m1.4.4.4.4.1.1.2.cmml" xref="A1.E18.m1.4.4.4.4.1.1.2"></times><apply id="A1.E18.m1.4.4.4.4.1.1.3.cmml" xref="A1.E18.m1.4.4.4.4.1.1.3"><csymbol cd="ambiguous" id="A1.E18.m1.4.4.4.4.1.1.3.1.cmml" xref="A1.E18.m1.4.4.4.4.1.1.3">superscript</csymbol><ci id="A1.E18.m1.4.4.4.4.1.1.3.2.cmml" xref="A1.E18.m1.4.4.4.4.1.1.3.2">𝑟</ci><times id="A1.E18.m1.4.4.4.4.1.1.3.3.cmml" xref="A1.E18.m1.4.4.4.4.1.1.3.3"></times></apply><interval closure="open" id="A1.E18.m1.4.4.4.4.1.1.1.2.cmml" xref="A1.E18.m1.4.4.4.4.1.1.1.1"><ci id="A1.E18.m1.2.2.2.2.cmml" xref="A1.E18.m1.2.2.2.2">𝑥</ci><apply id="A1.E18.m1.4.4.4.4.1.1.1.1.1.cmml" xref="A1.E18.m1.4.4.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E18.m1.4.4.4.4.1.1.1.1.1.1.cmml" xref="A1.E18.m1.4.4.4.4.1.1.1.1.1">subscript</csymbol><ci id="A1.E18.m1.4.4.4.4.1.1.1.1.1.2.cmml" xref="A1.E18.m1.4.4.4.4.1.1.1.1.1.2">𝑦</ci><apply id="A1.E18.m1.1.1.1.1.1.cmml" xref="A1.E18.m1.1.1.1.1.1"><times id="A1.E18.m1.1.1.1.1.1.2.cmml" xref="A1.E18.m1.1.1.1.1.1.2"></times><ci id="A1.E18.m1.1.1.1.1.1.3.cmml" xref="A1.E18.m1.1.1.1.1.1.3">𝜏</ci><ci id="A1.E18.m1.1.1.1.1.1.1.cmml" xref="A1.E18.m1.1.1.1.1.1.1">𝑘</ci></apply></apply></interval></apply></apply><apply id="A1.E18.m1.8.8.8.cmml" xref="A1.E18.m1.8.8.8"><apply id="A1.E18.m1.8.8.8.5.cmml" xref="A1.E18.m1.8.8.8.5"><csymbol cd="ambiguous" id="A1.E18.m1.8.8.8.5.1.cmml" xref="A1.E18.m1.8.8.8.5">superscript</csymbol><apply id="A1.E18.m1.8.8.8.5.2.cmml" xref="A1.E18.m1.8.8.8.5"><csymbol cd="ambiguous" id="A1.E18.m1.8.8.8.5.2.1.cmml" xref="A1.E18.m1.8.8.8.5">subscript</csymbol><sum id="A1.E18.m1.8.8.8.5.2.2.cmml" xref="A1.E18.m1.8.8.8.5.2.2"></sum><apply id="A1.E18.m1.8.8.8.5.2.3.cmml" xref="A1.E18.m1.8.8.8.5.2.3"><eq id="A1.E18.m1.8.8.8.5.2.3.1.cmml" xref="A1.E18.m1.8.8.8.5.2.3.1"></eq><ci id="A1.E18.m1.8.8.8.5.2.3.2.cmml" xref="A1.E18.m1.8.8.8.5.2.3.2">𝑗</ci><ci id="A1.E18.m1.8.8.8.5.2.3.3.cmml" xref="A1.E18.m1.8.8.8.5.2.3.3">𝑘</ci></apply></apply><ci id="A1.E18.m1.8.8.8.5.3.cmml" xref="A1.E18.m1.8.8.8.5.3">𝐾</ci></apply><apply id="A1.E18.m1.8.8.8.4.2.cmml" xref="A1.E18.m1.8.8.8.4.1"><exp id="A1.E18.m1.7.7.7.3.cmml" xref="A1.E18.m1.7.7.7.3"></exp><apply id="A1.E18.m1.8.8.8.4.1.1.1.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1"><times id="A1.E18.m1.8.8.8.4.1.1.1.2.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.2"></times><apply id="A1.E18.m1.8.8.8.4.1.1.1.3.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.3"><csymbol cd="ambiguous" id="A1.E18.m1.8.8.8.4.1.1.1.3.1.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.3">superscript</csymbol><ci id="A1.E18.m1.8.8.8.4.1.1.1.3.2.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.3.2">𝑟</ci><times id="A1.E18.m1.8.8.8.4.1.1.1.3.3.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.3.3"></times></apply><interval closure="open" id="A1.E18.m1.8.8.8.4.1.1.1.1.2.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.1.1"><ci id="A1.E18.m1.6.6.6.2.cmml" xref="A1.E18.m1.6.6.6.2">𝑥</ci><apply id="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.1.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.2.cmml" xref="A1.E18.m1.8.8.8.4.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.E18.m1.5.5.5.1.1.cmml" xref="A1.E18.m1.5.5.5.1.1"><times id="A1.E18.m1.5.5.5.1.1.2.cmml" xref="A1.E18.m1.5.5.5.1.1.2"></times><ci id="A1.E18.m1.5.5.5.1.1.3.cmml" xref="A1.E18.m1.5.5.5.1.1.3">𝜏</ci><ci id="A1.E18.m1.5.5.5.1.1.1.cmml" xref="A1.E18.m1.5.5.5.1.1.1">𝑗</ci></apply></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E18.m1.11c">p^{*}(\tau|y_{1},\ldots,y_{K},x)=\prod_{k=1}^{K}\frac{\exp(r^{*}(x,y_{\tau(k)}%
))}{\sum_{j=k}^{K}\exp(r^{*}(x,y_{\tau(j)}))}</annotation><annotation encoding="application/x-llamapun" id="A1.E18.m1.11d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_τ | italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_x ) = ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT ) ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_r start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(18)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS3.p2">
<p class="ltx_p" id="A1.SS3.p2.2">Notice that when <math alttext="K=2" class="ltx_Math" display="inline" id="A1.SS3.p2.1.m1.1"><semantics id="A1.SS3.p2.1.m1.1a"><mrow id="A1.SS3.p2.1.m1.1.1" xref="A1.SS3.p2.1.m1.1.1.cmml"><mi id="A1.SS3.p2.1.m1.1.1.2" xref="A1.SS3.p2.1.m1.1.1.2.cmml">K</mi><mo id="A1.SS3.p2.1.m1.1.1.1" xref="A1.SS3.p2.1.m1.1.1.1.cmml">=</mo><mn id="A1.SS3.p2.1.m1.1.1.3" xref="A1.SS3.p2.1.m1.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p2.1.m1.1b"><apply id="A1.SS3.p2.1.m1.1.1.cmml" xref="A1.SS3.p2.1.m1.1.1"><eq id="A1.SS3.p2.1.m1.1.1.1.cmml" xref="A1.SS3.p2.1.m1.1.1.1"></eq><ci id="A1.SS3.p2.1.m1.1.1.2.cmml" xref="A1.SS3.p2.1.m1.1.1.2">𝐾</ci><cn id="A1.SS3.p2.1.m1.1.1.3.cmml" type="integer" xref="A1.SS3.p2.1.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p2.1.m1.1c">K=2</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p2.1.m1.1d">italic_K = 2</annotation></semantics></math>, Equation&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.E18" title="18 ‣ A.3 Deriving the DPO Objective Under the Plackett-Luce Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">18</span></a> reduces to the Bradley-Terry model. However, for the general Plackett-Luce model, we can still utilize the results of Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E5" title="5 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a> and substitute the reward function parameterized by its optimal policy. Similarly to Appendix <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.SS2" title="A.2 Deriving the DPO Objective Under the Bradley-Terry Model ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">A.2</span></a>, the normalization constant <math alttext="Z(x)" class="ltx_Math" display="inline" id="A1.SS3.p2.2.m2.1"><semantics id="A1.SS3.p2.2.m2.1a"><mrow id="A1.SS3.p2.2.m2.1.2" xref="A1.SS3.p2.2.m2.1.2.cmml"><mi id="A1.SS3.p2.2.m2.1.2.2" xref="A1.SS3.p2.2.m2.1.2.2.cmml">Z</mi><mo id="A1.SS3.p2.2.m2.1.2.1" xref="A1.SS3.p2.2.m2.1.2.1.cmml">⁢</mo><mrow id="A1.SS3.p2.2.m2.1.2.3.2" xref="A1.SS3.p2.2.m2.1.2.cmml"><mo id="A1.SS3.p2.2.m2.1.2.3.2.1" stretchy="false" xref="A1.SS3.p2.2.m2.1.2.cmml">(</mo><mi id="A1.SS3.p2.2.m2.1.1" xref="A1.SS3.p2.2.m2.1.1.cmml">x</mi><mo id="A1.SS3.p2.2.m2.1.2.3.2.2" stretchy="false" xref="A1.SS3.p2.2.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p2.2.m2.1b"><apply id="A1.SS3.p2.2.m2.1.2.cmml" xref="A1.SS3.p2.2.m2.1.2"><times id="A1.SS3.p2.2.m2.1.2.1.cmml" xref="A1.SS3.p2.2.m2.1.2.1"></times><ci id="A1.SS3.p2.2.m2.1.2.2.cmml" xref="A1.SS3.p2.2.m2.1.2.2">𝑍</ci><ci id="A1.SS3.p2.2.m2.1.1.cmml" xref="A1.SS3.p2.2.m2.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p2.2.m2.1c">Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p2.2.m2.1d">italic_Z ( italic_x )</annotation></semantics></math> cancels out and we’re left with:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E19">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p^{*}(\tau|y_{1},\ldots,y_{K},x)=\prod_{k=1}^{K}\frac{\exp\left(\beta\log\frac%
{\pi^{*}(y_{\tau(k)}|x)}{\pi_{\text{ref}}(y_{\tau(k)}|x)}\right)}{\sum_{j=k}^{%
K}\exp\left(\beta\log\frac{\pi^{*}(y_{\tau(j)}|x)}{\pi_{\text{ref}}(y_{\tau(j)%
}|x)}\right)}" class="ltx_Math" display="block" id="A1.E19.m1.15"><semantics id="A1.E19.m1.15a"><mrow id="A1.E19.m1.15.15" xref="A1.E19.m1.15.15.cmml"><mrow id="A1.E19.m1.15.15.1" xref="A1.E19.m1.15.15.1.cmml"><msup id="A1.E19.m1.15.15.1.3" xref="A1.E19.m1.15.15.1.3.cmml"><mi id="A1.E19.m1.15.15.1.3.2" xref="A1.E19.m1.15.15.1.3.2.cmml">p</mi><mo id="A1.E19.m1.15.15.1.3.3" xref="A1.E19.m1.15.15.1.3.3.cmml">*</mo></msup><mo id="A1.E19.m1.15.15.1.2" xref="A1.E19.m1.15.15.1.2.cmml">⁢</mo><mrow id="A1.E19.m1.15.15.1.1.1" xref="A1.E19.m1.15.15.1.1.1.1.cmml"><mo id="A1.E19.m1.15.15.1.1.1.2" stretchy="false" xref="A1.E19.m1.15.15.1.1.1.1.cmml">(</mo><mrow id="A1.E19.m1.15.15.1.1.1.1" xref="A1.E19.m1.15.15.1.1.1.1.cmml"><mi id="A1.E19.m1.15.15.1.1.1.1.4" xref="A1.E19.m1.15.15.1.1.1.1.4.cmml">τ</mi><mo fence="false" id="A1.E19.m1.15.15.1.1.1.1.3" xref="A1.E19.m1.15.15.1.1.1.1.3.cmml">|</mo><mrow id="A1.E19.m1.15.15.1.1.1.1.2.2" xref="A1.E19.m1.15.15.1.1.1.1.2.3.cmml"><msub id="A1.E19.m1.15.15.1.1.1.1.1.1.1" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1.cmml"><mi id="A1.E19.m1.15.15.1.1.1.1.1.1.1.2" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E19.m1.15.15.1.1.1.1.1.1.1.3" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.E19.m1.15.15.1.1.1.1.2.2.3" xref="A1.E19.m1.15.15.1.1.1.1.2.3.cmml">,</mo><mi id="A1.E19.m1.13.13" mathvariant="normal" xref="A1.E19.m1.13.13.cmml">…</mi><mo id="A1.E19.m1.15.15.1.1.1.1.2.2.4" xref="A1.E19.m1.15.15.1.1.1.1.2.3.cmml">,</mo><msub id="A1.E19.m1.15.15.1.1.1.1.2.2.2" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2.cmml"><mi id="A1.E19.m1.15.15.1.1.1.1.2.2.2.2" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="A1.E19.m1.15.15.1.1.1.1.2.2.2.3" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2.3.cmml">K</mi></msub><mo id="A1.E19.m1.15.15.1.1.1.1.2.2.5" xref="A1.E19.m1.15.15.1.1.1.1.2.3.cmml">,</mo><mi id="A1.E19.m1.14.14" xref="A1.E19.m1.14.14.cmml">x</mi></mrow></mrow><mo id="A1.E19.m1.15.15.1.1.1.3" stretchy="false" xref="A1.E19.m1.15.15.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E19.m1.15.15.2" rspace="0.111em" xref="A1.E19.m1.15.15.2.cmml">=</mo><mrow id="A1.E19.m1.15.15.3" xref="A1.E19.m1.15.15.3.cmml"><munderover id="A1.E19.m1.15.15.3.1" xref="A1.E19.m1.15.15.3.1.cmml"><mo id="A1.E19.m1.15.15.3.1.2.2" movablelimits="false" xref="A1.E19.m1.15.15.3.1.2.2.cmml">∏</mo><mrow id="A1.E19.m1.15.15.3.1.2.3" xref="A1.E19.m1.15.15.3.1.2.3.cmml"><mi id="A1.E19.m1.15.15.3.1.2.3.2" xref="A1.E19.m1.15.15.3.1.2.3.2.cmml">k</mi><mo id="A1.E19.m1.15.15.3.1.2.3.1" xref="A1.E19.m1.15.15.3.1.2.3.1.cmml">=</mo><mn id="A1.E19.m1.15.15.3.1.2.3.3" xref="A1.E19.m1.15.15.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.E19.m1.15.15.3.1.3" xref="A1.E19.m1.15.15.3.1.3.cmml">K</mi></munderover><mfrac id="A1.E19.m1.12.12" xref="A1.E19.m1.12.12.cmml"><mrow id="A1.E19.m1.6.6.6.6" xref="A1.E19.m1.6.6.6.7.cmml"><mi id="A1.E19.m1.5.5.5.5" xref="A1.E19.m1.5.5.5.5.cmml">exp</mi><mo id="A1.E19.m1.6.6.6.6a" xref="A1.E19.m1.6.6.6.7.cmml">⁡</mo><mrow id="A1.E19.m1.6.6.6.6.1" xref="A1.E19.m1.6.6.6.7.cmml"><mo id="A1.E19.m1.6.6.6.6.1.2" xref="A1.E19.m1.6.6.6.7.cmml">(</mo><mrow id="A1.E19.m1.6.6.6.6.1.1" xref="A1.E19.m1.6.6.6.6.1.1.cmml"><mi id="A1.E19.m1.6.6.6.6.1.1.2" xref="A1.E19.m1.6.6.6.6.1.1.2.cmml">β</mi><mo id="A1.E19.m1.6.6.6.6.1.1.1" lspace="0.167em" xref="A1.E19.m1.6.6.6.6.1.1.1.cmml">⁢</mo><mrow id="A1.E19.m1.6.6.6.6.1.1.3" xref="A1.E19.m1.6.6.6.6.1.1.3.cmml"><mi id="A1.E19.m1.6.6.6.6.1.1.3.1" xref="A1.E19.m1.6.6.6.6.1.1.3.1.cmml">log</mi><mo id="A1.E19.m1.6.6.6.6.1.1.3a" lspace="0.167em" xref="A1.E19.m1.6.6.6.6.1.1.3.cmml">⁡</mo><mfrac id="A1.E19.m1.4.4.4.4" xref="A1.E19.m1.4.4.4.4.cmml"><mrow id="A1.E19.m1.2.2.2.2.2" xref="A1.E19.m1.2.2.2.2.2.cmml"><msup id="A1.E19.m1.2.2.2.2.2.4" xref="A1.E19.m1.2.2.2.2.2.4.cmml"><mi id="A1.E19.m1.2.2.2.2.2.4.2" xref="A1.E19.m1.2.2.2.2.2.4.2.cmml">π</mi><mo id="A1.E19.m1.2.2.2.2.2.4.3" xref="A1.E19.m1.2.2.2.2.2.4.3.cmml">*</mo></msup><mo id="A1.E19.m1.2.2.2.2.2.3" xref="A1.E19.m1.2.2.2.2.2.3.cmml">⁢</mo><mrow id="A1.E19.m1.2.2.2.2.2.2.1" xref="A1.E19.m1.2.2.2.2.2.2.1.1.cmml"><mo id="A1.E19.m1.2.2.2.2.2.2.1.2" stretchy="false" xref="A1.E19.m1.2.2.2.2.2.2.1.1.cmml">(</mo><mrow id="A1.E19.m1.2.2.2.2.2.2.1.1" xref="A1.E19.m1.2.2.2.2.2.2.1.1.cmml"><msub id="A1.E19.m1.2.2.2.2.2.2.1.1.2" xref="A1.E19.m1.2.2.2.2.2.2.1.1.2.cmml"><mi id="A1.E19.m1.2.2.2.2.2.2.1.1.2.2" xref="A1.E19.m1.2.2.2.2.2.2.1.1.2.2.cmml">y</mi><mrow id="A1.E19.m1.1.1.1.1.1.1.1" xref="A1.E19.m1.1.1.1.1.1.1.1.cmml"><mi id="A1.E19.m1.1.1.1.1.1.1.1.3" xref="A1.E19.m1.1.1.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.E19.m1.1.1.1.1.1.1.1.2" xref="A1.E19.m1.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E19.m1.1.1.1.1.1.1.1.4.2" xref="A1.E19.m1.1.1.1.1.1.1.1.cmml"><mo id="A1.E19.m1.1.1.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.E19.m1.1.1.1.1.1.1.1.cmml">(</mo><mi id="A1.E19.m1.1.1.1.1.1.1.1.1" xref="A1.E19.m1.1.1.1.1.1.1.1.1.cmml">k</mi><mo id="A1.E19.m1.1.1.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.E19.m1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E19.m1.2.2.2.2.2.2.1.1.1" xref="A1.E19.m1.2.2.2.2.2.2.1.1.1.cmml">|</mo><mi id="A1.E19.m1.2.2.2.2.2.2.1.1.3" xref="A1.E19.m1.2.2.2.2.2.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E19.m1.2.2.2.2.2.2.1.3" stretchy="false" xref="A1.E19.m1.2.2.2.2.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E19.m1.4.4.4.4.4" xref="A1.E19.m1.4.4.4.4.4.cmml"><msub id="A1.E19.m1.4.4.4.4.4.4" xref="A1.E19.m1.4.4.4.4.4.4.cmml"><mi id="A1.E19.m1.4.4.4.4.4.4.2" xref="A1.E19.m1.4.4.4.4.4.4.2.cmml">π</mi><mtext id="A1.E19.m1.4.4.4.4.4.4.3" xref="A1.E19.m1.4.4.4.4.4.4.3a.cmml">ref</mtext></msub><mo id="A1.E19.m1.4.4.4.4.4.3" xref="A1.E19.m1.4.4.4.4.4.3.cmml">⁢</mo><mrow id="A1.E19.m1.4.4.4.4.4.2.1" xref="A1.E19.m1.4.4.4.4.4.2.1.1.cmml"><mo id="A1.E19.m1.4.4.4.4.4.2.1.2" stretchy="false" xref="A1.E19.m1.4.4.4.4.4.2.1.1.cmml">(</mo><mrow id="A1.E19.m1.4.4.4.4.4.2.1.1" xref="A1.E19.m1.4.4.4.4.4.2.1.1.cmml"><msub id="A1.E19.m1.4.4.4.4.4.2.1.1.2" xref="A1.E19.m1.4.4.4.4.4.2.1.1.2.cmml"><mi id="A1.E19.m1.4.4.4.4.4.2.1.1.2.2" xref="A1.E19.m1.4.4.4.4.4.2.1.1.2.2.cmml">y</mi><mrow id="A1.E19.m1.3.3.3.3.3.1.1" xref="A1.E19.m1.3.3.3.3.3.1.1.cmml"><mi id="A1.E19.m1.3.3.3.3.3.1.1.3" xref="A1.E19.m1.3.3.3.3.3.1.1.3.cmml">τ</mi><mo id="A1.E19.m1.3.3.3.3.3.1.1.2" xref="A1.E19.m1.3.3.3.3.3.1.1.2.cmml">⁢</mo><mrow id="A1.E19.m1.3.3.3.3.3.1.1.4.2" xref="A1.E19.m1.3.3.3.3.3.1.1.cmml"><mo id="A1.E19.m1.3.3.3.3.3.1.1.4.2.1" stretchy="false" xref="A1.E19.m1.3.3.3.3.3.1.1.cmml">(</mo><mi id="A1.E19.m1.3.3.3.3.3.1.1.1" xref="A1.E19.m1.3.3.3.3.3.1.1.1.cmml">k</mi><mo id="A1.E19.m1.3.3.3.3.3.1.1.4.2.2" stretchy="false" xref="A1.E19.m1.3.3.3.3.3.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E19.m1.4.4.4.4.4.2.1.1.1" xref="A1.E19.m1.4.4.4.4.4.2.1.1.1.cmml">|</mo><mi id="A1.E19.m1.4.4.4.4.4.2.1.1.3" xref="A1.E19.m1.4.4.4.4.4.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E19.m1.4.4.4.4.4.2.1.3" stretchy="false" xref="A1.E19.m1.4.4.4.4.4.2.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.E19.m1.6.6.6.6.1.3" xref="A1.E19.m1.6.6.6.7.cmml">)</mo></mrow></mrow><mrow id="A1.E19.m1.12.12.12" xref="A1.E19.m1.12.12.12.cmml"><msubsup id="A1.E19.m1.12.12.12.7" xref="A1.E19.m1.12.12.12.7.cmml"><mo id="A1.E19.m1.12.12.12.7.2.2" xref="A1.E19.m1.12.12.12.7.2.2.cmml">∑</mo><mrow id="A1.E19.m1.12.12.12.7.2.3" xref="A1.E19.m1.12.12.12.7.2.3.cmml"><mi id="A1.E19.m1.12.12.12.7.2.3.2" xref="A1.E19.m1.12.12.12.7.2.3.2.cmml">j</mi><mo id="A1.E19.m1.12.12.12.7.2.3.1" xref="A1.E19.m1.12.12.12.7.2.3.1.cmml">=</mo><mi id="A1.E19.m1.12.12.12.7.2.3.3" xref="A1.E19.m1.12.12.12.7.2.3.3.cmml">k</mi></mrow><mi id="A1.E19.m1.12.12.12.7.3" xref="A1.E19.m1.12.12.12.7.3.cmml">K</mi></msubsup><mrow id="A1.E19.m1.12.12.12.6.1" xref="A1.E19.m1.12.12.12.6.2.cmml"><mi id="A1.E19.m1.11.11.11.5" xref="A1.E19.m1.11.11.11.5.cmml">exp</mi><mo id="A1.E19.m1.12.12.12.6.1a" xref="A1.E19.m1.12.12.12.6.2.cmml">⁡</mo><mrow id="A1.E19.m1.12.12.12.6.1.1" xref="A1.E19.m1.12.12.12.6.2.cmml"><mo id="A1.E19.m1.12.12.12.6.1.1.2" xref="A1.E19.m1.12.12.12.6.2.cmml">(</mo><mrow id="A1.E19.m1.12.12.12.6.1.1.1" xref="A1.E19.m1.12.12.12.6.1.1.1.cmml"><mi id="A1.E19.m1.12.12.12.6.1.1.1.2" xref="A1.E19.m1.12.12.12.6.1.1.1.2.cmml">β</mi><mo id="A1.E19.m1.12.12.12.6.1.1.1.1" lspace="0.167em" xref="A1.E19.m1.12.12.12.6.1.1.1.1.cmml">⁢</mo><mrow id="A1.E19.m1.12.12.12.6.1.1.1.3" xref="A1.E19.m1.12.12.12.6.1.1.1.3.cmml"><mi id="A1.E19.m1.12.12.12.6.1.1.1.3.1" xref="A1.E19.m1.12.12.12.6.1.1.1.3.1.cmml">log</mi><mo id="A1.E19.m1.12.12.12.6.1.1.1.3a" lspace="0.167em" xref="A1.E19.m1.12.12.12.6.1.1.1.3.cmml">⁡</mo><mfrac id="A1.E19.m1.10.10.10.4" xref="A1.E19.m1.10.10.10.4.cmml"><mrow id="A1.E19.m1.8.8.8.2.2" xref="A1.E19.m1.8.8.8.2.2.cmml"><msup id="A1.E19.m1.8.8.8.2.2.4" xref="A1.E19.m1.8.8.8.2.2.4.cmml"><mi id="A1.E19.m1.8.8.8.2.2.4.2" xref="A1.E19.m1.8.8.8.2.2.4.2.cmml">π</mi><mo id="A1.E19.m1.8.8.8.2.2.4.3" xref="A1.E19.m1.8.8.8.2.2.4.3.cmml">*</mo></msup><mo id="A1.E19.m1.8.8.8.2.2.3" xref="A1.E19.m1.8.8.8.2.2.3.cmml">⁢</mo><mrow id="A1.E19.m1.8.8.8.2.2.2.1" xref="A1.E19.m1.8.8.8.2.2.2.1.1.cmml"><mo id="A1.E19.m1.8.8.8.2.2.2.1.2" stretchy="false" xref="A1.E19.m1.8.8.8.2.2.2.1.1.cmml">(</mo><mrow id="A1.E19.m1.8.8.8.2.2.2.1.1" xref="A1.E19.m1.8.8.8.2.2.2.1.1.cmml"><msub id="A1.E19.m1.8.8.8.2.2.2.1.1.2" xref="A1.E19.m1.8.8.8.2.2.2.1.1.2.cmml"><mi id="A1.E19.m1.8.8.8.2.2.2.1.1.2.2" xref="A1.E19.m1.8.8.8.2.2.2.1.1.2.2.cmml">y</mi><mrow id="A1.E19.m1.7.7.7.1.1.1.1" xref="A1.E19.m1.7.7.7.1.1.1.1.cmml"><mi id="A1.E19.m1.7.7.7.1.1.1.1.3" xref="A1.E19.m1.7.7.7.1.1.1.1.3.cmml">τ</mi><mo id="A1.E19.m1.7.7.7.1.1.1.1.2" xref="A1.E19.m1.7.7.7.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E19.m1.7.7.7.1.1.1.1.4.2" xref="A1.E19.m1.7.7.7.1.1.1.1.cmml"><mo id="A1.E19.m1.7.7.7.1.1.1.1.4.2.1" stretchy="false" xref="A1.E19.m1.7.7.7.1.1.1.1.cmml">(</mo><mi id="A1.E19.m1.7.7.7.1.1.1.1.1" xref="A1.E19.m1.7.7.7.1.1.1.1.1.cmml">j</mi><mo id="A1.E19.m1.7.7.7.1.1.1.1.4.2.2" stretchy="false" xref="A1.E19.m1.7.7.7.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E19.m1.8.8.8.2.2.2.1.1.1" xref="A1.E19.m1.8.8.8.2.2.2.1.1.1.cmml">|</mo><mi id="A1.E19.m1.8.8.8.2.2.2.1.1.3" xref="A1.E19.m1.8.8.8.2.2.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E19.m1.8.8.8.2.2.2.1.3" stretchy="false" xref="A1.E19.m1.8.8.8.2.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E19.m1.10.10.10.4.4" xref="A1.E19.m1.10.10.10.4.4.cmml"><msub id="A1.E19.m1.10.10.10.4.4.4" xref="A1.E19.m1.10.10.10.4.4.4.cmml"><mi id="A1.E19.m1.10.10.10.4.4.4.2" xref="A1.E19.m1.10.10.10.4.4.4.2.cmml">π</mi><mtext id="A1.E19.m1.10.10.10.4.4.4.3" xref="A1.E19.m1.10.10.10.4.4.4.3a.cmml">ref</mtext></msub><mo id="A1.E19.m1.10.10.10.4.4.3" xref="A1.E19.m1.10.10.10.4.4.3.cmml">⁢</mo><mrow id="A1.E19.m1.10.10.10.4.4.2.1" xref="A1.E19.m1.10.10.10.4.4.2.1.1.cmml"><mo id="A1.E19.m1.10.10.10.4.4.2.1.2" stretchy="false" xref="A1.E19.m1.10.10.10.4.4.2.1.1.cmml">(</mo><mrow id="A1.E19.m1.10.10.10.4.4.2.1.1" xref="A1.E19.m1.10.10.10.4.4.2.1.1.cmml"><msub id="A1.E19.m1.10.10.10.4.4.2.1.1.2" xref="A1.E19.m1.10.10.10.4.4.2.1.1.2.cmml"><mi id="A1.E19.m1.10.10.10.4.4.2.1.1.2.2" xref="A1.E19.m1.10.10.10.4.4.2.1.1.2.2.cmml">y</mi><mrow id="A1.E19.m1.9.9.9.3.3.1.1" xref="A1.E19.m1.9.9.9.3.3.1.1.cmml"><mi id="A1.E19.m1.9.9.9.3.3.1.1.3" xref="A1.E19.m1.9.9.9.3.3.1.1.3.cmml">τ</mi><mo id="A1.E19.m1.9.9.9.3.3.1.1.2" xref="A1.E19.m1.9.9.9.3.3.1.1.2.cmml">⁢</mo><mrow id="A1.E19.m1.9.9.9.3.3.1.1.4.2" xref="A1.E19.m1.9.9.9.3.3.1.1.cmml"><mo id="A1.E19.m1.9.9.9.3.3.1.1.4.2.1" stretchy="false" xref="A1.E19.m1.9.9.9.3.3.1.1.cmml">(</mo><mi id="A1.E19.m1.9.9.9.3.3.1.1.1" xref="A1.E19.m1.9.9.9.3.3.1.1.1.cmml">j</mi><mo id="A1.E19.m1.9.9.9.3.3.1.1.4.2.2" stretchy="false" xref="A1.E19.m1.9.9.9.3.3.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E19.m1.10.10.10.4.4.2.1.1.1" xref="A1.E19.m1.10.10.10.4.4.2.1.1.1.cmml">|</mo><mi id="A1.E19.m1.10.10.10.4.4.2.1.1.3" xref="A1.E19.m1.10.10.10.4.4.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E19.m1.10.10.10.4.4.2.1.3" stretchy="false" xref="A1.E19.m1.10.10.10.4.4.2.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.E19.m1.12.12.12.6.1.1.3" xref="A1.E19.m1.12.12.12.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E19.m1.15b"><apply id="A1.E19.m1.15.15.cmml" xref="A1.E19.m1.15.15"><eq id="A1.E19.m1.15.15.2.cmml" xref="A1.E19.m1.15.15.2"></eq><apply id="A1.E19.m1.15.15.1.cmml" xref="A1.E19.m1.15.15.1"><times id="A1.E19.m1.15.15.1.2.cmml" xref="A1.E19.m1.15.15.1.2"></times><apply id="A1.E19.m1.15.15.1.3.cmml" xref="A1.E19.m1.15.15.1.3"><csymbol cd="ambiguous" id="A1.E19.m1.15.15.1.3.1.cmml" xref="A1.E19.m1.15.15.1.3">superscript</csymbol><ci id="A1.E19.m1.15.15.1.3.2.cmml" xref="A1.E19.m1.15.15.1.3.2">𝑝</ci><times id="A1.E19.m1.15.15.1.3.3.cmml" xref="A1.E19.m1.15.15.1.3.3"></times></apply><apply id="A1.E19.m1.15.15.1.1.1.1.cmml" xref="A1.E19.m1.15.15.1.1.1"><csymbol cd="latexml" id="A1.E19.m1.15.15.1.1.1.1.3.cmml" xref="A1.E19.m1.15.15.1.1.1.1.3">conditional</csymbol><ci id="A1.E19.m1.15.15.1.1.1.1.4.cmml" xref="A1.E19.m1.15.15.1.1.1.1.4">𝜏</ci><list id="A1.E19.m1.15.15.1.1.1.1.2.3.cmml" xref="A1.E19.m1.15.15.1.1.1.1.2.2"><apply id="A1.E19.m1.15.15.1.1.1.1.1.1.1.cmml" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E19.m1.15.15.1.1.1.1.1.1.1.1.cmml" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E19.m1.15.15.1.1.1.1.1.1.1.2.cmml" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.E19.m1.15.15.1.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.E19.m1.15.15.1.1.1.1.1.1.1.3">1</cn></apply><ci id="A1.E19.m1.13.13.cmml" xref="A1.E19.m1.13.13">…</ci><apply id="A1.E19.m1.15.15.1.1.1.1.2.2.2.cmml" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="A1.E19.m1.15.15.1.1.1.1.2.2.2.1.cmml" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2">subscript</csymbol><ci id="A1.E19.m1.15.15.1.1.1.1.2.2.2.2.cmml" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2.2">𝑦</ci><ci id="A1.E19.m1.15.15.1.1.1.1.2.2.2.3.cmml" xref="A1.E19.m1.15.15.1.1.1.1.2.2.2.3">𝐾</ci></apply><ci id="A1.E19.m1.14.14.cmml" xref="A1.E19.m1.14.14">𝑥</ci></list></apply></apply><apply id="A1.E19.m1.15.15.3.cmml" xref="A1.E19.m1.15.15.3"><apply id="A1.E19.m1.15.15.3.1.cmml" xref="A1.E19.m1.15.15.3.1"><csymbol cd="ambiguous" id="A1.E19.m1.15.15.3.1.1.cmml" xref="A1.E19.m1.15.15.3.1">superscript</csymbol><apply id="A1.E19.m1.15.15.3.1.2.cmml" xref="A1.E19.m1.15.15.3.1"><csymbol cd="ambiguous" id="A1.E19.m1.15.15.3.1.2.1.cmml" xref="A1.E19.m1.15.15.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.E19.m1.15.15.3.1.2.2.cmml" xref="A1.E19.m1.15.15.3.1.2.2">product</csymbol><apply id="A1.E19.m1.15.15.3.1.2.3.cmml" xref="A1.E19.m1.15.15.3.1.2.3"><eq id="A1.E19.m1.15.15.3.1.2.3.1.cmml" xref="A1.E19.m1.15.15.3.1.2.3.1"></eq><ci id="A1.E19.m1.15.15.3.1.2.3.2.cmml" xref="A1.E19.m1.15.15.3.1.2.3.2">𝑘</ci><cn id="A1.E19.m1.15.15.3.1.2.3.3.cmml" type="integer" xref="A1.E19.m1.15.15.3.1.2.3.3">1</cn></apply></apply><ci id="A1.E19.m1.15.15.3.1.3.cmml" xref="A1.E19.m1.15.15.3.1.3">𝐾</ci></apply><apply id="A1.E19.m1.12.12.cmml" xref="A1.E19.m1.12.12"><divide id="A1.E19.m1.12.12.13.cmml" xref="A1.E19.m1.12.12"></divide><apply id="A1.E19.m1.6.6.6.7.cmml" xref="A1.E19.m1.6.6.6.6"><exp id="A1.E19.m1.5.5.5.5.cmml" xref="A1.E19.m1.5.5.5.5"></exp><apply id="A1.E19.m1.6.6.6.6.1.1.cmml" xref="A1.E19.m1.6.6.6.6.1.1"><times id="A1.E19.m1.6.6.6.6.1.1.1.cmml" xref="A1.E19.m1.6.6.6.6.1.1.1"></times><ci id="A1.E19.m1.6.6.6.6.1.1.2.cmml" xref="A1.E19.m1.6.6.6.6.1.1.2">𝛽</ci><apply id="A1.E19.m1.6.6.6.6.1.1.3.cmml" xref="A1.E19.m1.6.6.6.6.1.1.3"><log id="A1.E19.m1.6.6.6.6.1.1.3.1.cmml" xref="A1.E19.m1.6.6.6.6.1.1.3.1"></log><apply id="A1.E19.m1.4.4.4.4.cmml" xref="A1.E19.m1.4.4.4.4"><divide id="A1.E19.m1.4.4.4.4.5.cmml" xref="A1.E19.m1.4.4.4.4"></divide><apply id="A1.E19.m1.2.2.2.2.2.cmml" xref="A1.E19.m1.2.2.2.2.2"><times id="A1.E19.m1.2.2.2.2.2.3.cmml" xref="A1.E19.m1.2.2.2.2.2.3"></times><apply id="A1.E19.m1.2.2.2.2.2.4.cmml" xref="A1.E19.m1.2.2.2.2.2.4"><csymbol cd="ambiguous" id="A1.E19.m1.2.2.2.2.2.4.1.cmml" xref="A1.E19.m1.2.2.2.2.2.4">superscript</csymbol><ci id="A1.E19.m1.2.2.2.2.2.4.2.cmml" xref="A1.E19.m1.2.2.2.2.2.4.2">𝜋</ci><times id="A1.E19.m1.2.2.2.2.2.4.3.cmml" xref="A1.E19.m1.2.2.2.2.2.4.3"></times></apply><apply id="A1.E19.m1.2.2.2.2.2.2.1.1.cmml" xref="A1.E19.m1.2.2.2.2.2.2.1"><csymbol cd="latexml" id="A1.E19.m1.2.2.2.2.2.2.1.1.1.cmml" xref="A1.E19.m1.2.2.2.2.2.2.1.1.1">conditional</csymbol><apply id="A1.E19.m1.2.2.2.2.2.2.1.1.2.cmml" xref="A1.E19.m1.2.2.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="A1.E19.m1.2.2.2.2.2.2.1.1.2.1.cmml" xref="A1.E19.m1.2.2.2.2.2.2.1.1.2">subscript</csymbol><ci id="A1.E19.m1.2.2.2.2.2.2.1.1.2.2.cmml" xref="A1.E19.m1.2.2.2.2.2.2.1.1.2.2">𝑦</ci><apply id="A1.E19.m1.1.1.1.1.1.1.1.cmml" xref="A1.E19.m1.1.1.1.1.1.1.1"><times id="A1.E19.m1.1.1.1.1.1.1.1.2.cmml" xref="A1.E19.m1.1.1.1.1.1.1.1.2"></times><ci id="A1.E19.m1.1.1.1.1.1.1.1.3.cmml" xref="A1.E19.m1.1.1.1.1.1.1.1.3">𝜏</ci><ci id="A1.E19.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.E19.m1.1.1.1.1.1.1.1.1">𝑘</ci></apply></apply><ci id="A1.E19.m1.2.2.2.2.2.2.1.1.3.cmml" xref="A1.E19.m1.2.2.2.2.2.2.1.1.3">𝑥</ci></apply></apply><apply id="A1.E19.m1.4.4.4.4.4.cmml" xref="A1.E19.m1.4.4.4.4.4"><times id="A1.E19.m1.4.4.4.4.4.3.cmml" xref="A1.E19.m1.4.4.4.4.4.3"></times><apply id="A1.E19.m1.4.4.4.4.4.4.cmml" xref="A1.E19.m1.4.4.4.4.4.4"><csymbol cd="ambiguous" id="A1.E19.m1.4.4.4.4.4.4.1.cmml" xref="A1.E19.m1.4.4.4.4.4.4">subscript</csymbol><ci id="A1.E19.m1.4.4.4.4.4.4.2.cmml" xref="A1.E19.m1.4.4.4.4.4.4.2">𝜋</ci><ci id="A1.E19.m1.4.4.4.4.4.4.3a.cmml" xref="A1.E19.m1.4.4.4.4.4.4.3"><mtext id="A1.E19.m1.4.4.4.4.4.4.3.cmml" mathsize="50%" xref="A1.E19.m1.4.4.4.4.4.4.3">ref</mtext></ci></apply><apply id="A1.E19.m1.4.4.4.4.4.2.1.1.cmml" xref="A1.E19.m1.4.4.4.4.4.2.1"><csymbol cd="latexml" id="A1.E19.m1.4.4.4.4.4.2.1.1.1.cmml" xref="A1.E19.m1.4.4.4.4.4.2.1.1.1">conditional</csymbol><apply id="A1.E19.m1.4.4.4.4.4.2.1.1.2.cmml" xref="A1.E19.m1.4.4.4.4.4.2.1.1.2"><csymbol cd="ambiguous" id="A1.E19.m1.4.4.4.4.4.2.1.1.2.1.cmml" xref="A1.E19.m1.4.4.4.4.4.2.1.1.2">subscript</csymbol><ci id="A1.E19.m1.4.4.4.4.4.2.1.1.2.2.cmml" xref="A1.E19.m1.4.4.4.4.4.2.1.1.2.2">𝑦</ci><apply id="A1.E19.m1.3.3.3.3.3.1.1.cmml" xref="A1.E19.m1.3.3.3.3.3.1.1"><times id="A1.E19.m1.3.3.3.3.3.1.1.2.cmml" xref="A1.E19.m1.3.3.3.3.3.1.1.2"></times><ci id="A1.E19.m1.3.3.3.3.3.1.1.3.cmml" xref="A1.E19.m1.3.3.3.3.3.1.1.3">𝜏</ci><ci id="A1.E19.m1.3.3.3.3.3.1.1.1.cmml" xref="A1.E19.m1.3.3.3.3.3.1.1.1">𝑘</ci></apply></apply><ci id="A1.E19.m1.4.4.4.4.4.2.1.1.3.cmml" xref="A1.E19.m1.4.4.4.4.4.2.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.E19.m1.12.12.12.cmml" xref="A1.E19.m1.12.12.12"><apply id="A1.E19.m1.12.12.12.7.cmml" xref="A1.E19.m1.12.12.12.7"><csymbol cd="ambiguous" id="A1.E19.m1.12.12.12.7.1.cmml" xref="A1.E19.m1.12.12.12.7">superscript</csymbol><apply id="A1.E19.m1.12.12.12.7.2.cmml" xref="A1.E19.m1.12.12.12.7"><csymbol cd="ambiguous" id="A1.E19.m1.12.12.12.7.2.1.cmml" xref="A1.E19.m1.12.12.12.7">subscript</csymbol><sum id="A1.E19.m1.12.12.12.7.2.2.cmml" xref="A1.E19.m1.12.12.12.7.2.2"></sum><apply id="A1.E19.m1.12.12.12.7.2.3.cmml" xref="A1.E19.m1.12.12.12.7.2.3"><eq id="A1.E19.m1.12.12.12.7.2.3.1.cmml" xref="A1.E19.m1.12.12.12.7.2.3.1"></eq><ci id="A1.E19.m1.12.12.12.7.2.3.2.cmml" xref="A1.E19.m1.12.12.12.7.2.3.2">𝑗</ci><ci id="A1.E19.m1.12.12.12.7.2.3.3.cmml" xref="A1.E19.m1.12.12.12.7.2.3.3">𝑘</ci></apply></apply><ci id="A1.E19.m1.12.12.12.7.3.cmml" xref="A1.E19.m1.12.12.12.7.3">𝐾</ci></apply><apply id="A1.E19.m1.12.12.12.6.2.cmml" xref="A1.E19.m1.12.12.12.6.1"><exp id="A1.E19.m1.11.11.11.5.cmml" xref="A1.E19.m1.11.11.11.5"></exp><apply id="A1.E19.m1.12.12.12.6.1.1.1.cmml" xref="A1.E19.m1.12.12.12.6.1.1.1"><times id="A1.E19.m1.12.12.12.6.1.1.1.1.cmml" xref="A1.E19.m1.12.12.12.6.1.1.1.1"></times><ci id="A1.E19.m1.12.12.12.6.1.1.1.2.cmml" xref="A1.E19.m1.12.12.12.6.1.1.1.2">𝛽</ci><apply id="A1.E19.m1.12.12.12.6.1.1.1.3.cmml" xref="A1.E19.m1.12.12.12.6.1.1.1.3"><log id="A1.E19.m1.12.12.12.6.1.1.1.3.1.cmml" xref="A1.E19.m1.12.12.12.6.1.1.1.3.1"></log><apply id="A1.E19.m1.10.10.10.4.cmml" xref="A1.E19.m1.10.10.10.4"><divide id="A1.E19.m1.10.10.10.4.5.cmml" xref="A1.E19.m1.10.10.10.4"></divide><apply id="A1.E19.m1.8.8.8.2.2.cmml" xref="A1.E19.m1.8.8.8.2.2"><times id="A1.E19.m1.8.8.8.2.2.3.cmml" xref="A1.E19.m1.8.8.8.2.2.3"></times><apply id="A1.E19.m1.8.8.8.2.2.4.cmml" xref="A1.E19.m1.8.8.8.2.2.4"><csymbol cd="ambiguous" id="A1.E19.m1.8.8.8.2.2.4.1.cmml" xref="A1.E19.m1.8.8.8.2.2.4">superscript</csymbol><ci id="A1.E19.m1.8.8.8.2.2.4.2.cmml" xref="A1.E19.m1.8.8.8.2.2.4.2">𝜋</ci><times id="A1.E19.m1.8.8.8.2.2.4.3.cmml" xref="A1.E19.m1.8.8.8.2.2.4.3"></times></apply><apply id="A1.E19.m1.8.8.8.2.2.2.1.1.cmml" xref="A1.E19.m1.8.8.8.2.2.2.1"><csymbol cd="latexml" id="A1.E19.m1.8.8.8.2.2.2.1.1.1.cmml" xref="A1.E19.m1.8.8.8.2.2.2.1.1.1">conditional</csymbol><apply id="A1.E19.m1.8.8.8.2.2.2.1.1.2.cmml" xref="A1.E19.m1.8.8.8.2.2.2.1.1.2"><csymbol cd="ambiguous" id="A1.E19.m1.8.8.8.2.2.2.1.1.2.1.cmml" xref="A1.E19.m1.8.8.8.2.2.2.1.1.2">subscript</csymbol><ci id="A1.E19.m1.8.8.8.2.2.2.1.1.2.2.cmml" xref="A1.E19.m1.8.8.8.2.2.2.1.1.2.2">𝑦</ci><apply id="A1.E19.m1.7.7.7.1.1.1.1.cmml" xref="A1.E19.m1.7.7.7.1.1.1.1"><times id="A1.E19.m1.7.7.7.1.1.1.1.2.cmml" xref="A1.E19.m1.7.7.7.1.1.1.1.2"></times><ci id="A1.E19.m1.7.7.7.1.1.1.1.3.cmml" xref="A1.E19.m1.7.7.7.1.1.1.1.3">𝜏</ci><ci id="A1.E19.m1.7.7.7.1.1.1.1.1.cmml" xref="A1.E19.m1.7.7.7.1.1.1.1.1">𝑗</ci></apply></apply><ci id="A1.E19.m1.8.8.8.2.2.2.1.1.3.cmml" xref="A1.E19.m1.8.8.8.2.2.2.1.1.3">𝑥</ci></apply></apply><apply id="A1.E19.m1.10.10.10.4.4.cmml" xref="A1.E19.m1.10.10.10.4.4"><times id="A1.E19.m1.10.10.10.4.4.3.cmml" xref="A1.E19.m1.10.10.10.4.4.3"></times><apply id="A1.E19.m1.10.10.10.4.4.4.cmml" xref="A1.E19.m1.10.10.10.4.4.4"><csymbol cd="ambiguous" id="A1.E19.m1.10.10.10.4.4.4.1.cmml" xref="A1.E19.m1.10.10.10.4.4.4">subscript</csymbol><ci id="A1.E19.m1.10.10.10.4.4.4.2.cmml" xref="A1.E19.m1.10.10.10.4.4.4.2">𝜋</ci><ci id="A1.E19.m1.10.10.10.4.4.4.3a.cmml" xref="A1.E19.m1.10.10.10.4.4.4.3"><mtext id="A1.E19.m1.10.10.10.4.4.4.3.cmml" mathsize="50%" xref="A1.E19.m1.10.10.10.4.4.4.3">ref</mtext></ci></apply><apply id="A1.E19.m1.10.10.10.4.4.2.1.1.cmml" xref="A1.E19.m1.10.10.10.4.4.2.1"><csymbol cd="latexml" id="A1.E19.m1.10.10.10.4.4.2.1.1.1.cmml" xref="A1.E19.m1.10.10.10.4.4.2.1.1.1">conditional</csymbol><apply id="A1.E19.m1.10.10.10.4.4.2.1.1.2.cmml" xref="A1.E19.m1.10.10.10.4.4.2.1.1.2"><csymbol cd="ambiguous" id="A1.E19.m1.10.10.10.4.4.2.1.1.2.1.cmml" xref="A1.E19.m1.10.10.10.4.4.2.1.1.2">subscript</csymbol><ci id="A1.E19.m1.10.10.10.4.4.2.1.1.2.2.cmml" xref="A1.E19.m1.10.10.10.4.4.2.1.1.2.2">𝑦</ci><apply id="A1.E19.m1.9.9.9.3.3.1.1.cmml" xref="A1.E19.m1.9.9.9.3.3.1.1"><times id="A1.E19.m1.9.9.9.3.3.1.1.2.cmml" xref="A1.E19.m1.9.9.9.3.3.1.1.2"></times><ci id="A1.E19.m1.9.9.9.3.3.1.1.3.cmml" xref="A1.E19.m1.9.9.9.3.3.1.1.3">𝜏</ci><ci id="A1.E19.m1.9.9.9.3.3.1.1.1.cmml" xref="A1.E19.m1.9.9.9.3.3.1.1.1">𝑗</ci></apply></apply><ci id="A1.E19.m1.10.10.10.4.4.2.1.1.3.cmml" xref="A1.E19.m1.10.10.10.4.4.2.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E19.m1.15c">p^{*}(\tau|y_{1},\ldots,y_{K},x)=\prod_{k=1}^{K}\frac{\exp\left(\beta\log\frac%
{\pi^{*}(y_{\tau(k)}|x)}{\pi_{\text{ref}}(y_{\tau(k)}|x)}\right)}{\sum_{j=k}^{%
K}\exp\left(\beta\log\frac{\pi^{*}(y_{\tau(j)}|x)}{\pi_{\text{ref}}(y_{\tau(j)%
}|x)}\right)}</annotation><annotation encoding="application/x-llamapun" id="A1.E19.m1.15d">italic_p start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_τ | italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_x ) = ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT | italic_x ) end_ARG ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT * end_POSTSUPERSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT | italic_x ) end_ARG ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(19)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS3.p3">
<p class="ltx_p" id="A1.SS3.p3.1">Similarly to the approach of Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4" title="4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>, if we have access to a dataset <math alttext="\mathcal{D}=\{\tau^{(i)},y_{1}^{(i)},\ldots,y_{K}^{(i)},x^{(i)}\}_{i=1}^{N}" class="ltx_Math" display="inline" id="A1.SS3.p3.1.m1.9"><semantics id="A1.SS3.p3.1.m1.9a"><mrow id="A1.SS3.p3.1.m1.9.9" xref="A1.SS3.p3.1.m1.9.9.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.SS3.p3.1.m1.9.9.6" xref="A1.SS3.p3.1.m1.9.9.6.cmml">𝒟</mi><mo id="A1.SS3.p3.1.m1.9.9.5" xref="A1.SS3.p3.1.m1.9.9.5.cmml">=</mo><msubsup id="A1.SS3.p3.1.m1.9.9.4" xref="A1.SS3.p3.1.m1.9.9.4.cmml"><mrow id="A1.SS3.p3.1.m1.9.9.4.4.4.4" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml"><mo id="A1.SS3.p3.1.m1.9.9.4.4.4.4.5" stretchy="false" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml">{</mo><msup id="A1.SS3.p3.1.m1.6.6.1.1.1.1.1" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.cmml"><mi id="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.2" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.2.cmml">τ</mi><mrow id="A1.SS3.p3.1.m1.1.1.1.3" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.cmml"><mo id="A1.SS3.p3.1.m1.1.1.1.3.1" stretchy="false" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.cmml">(</mo><mi id="A1.SS3.p3.1.m1.1.1.1.1" xref="A1.SS3.p3.1.m1.1.1.1.1.cmml">i</mi><mo id="A1.SS3.p3.1.m1.1.1.1.3.2" stretchy="false" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.cmml">)</mo></mrow></msup><mo id="A1.SS3.p3.1.m1.9.9.4.4.4.4.6" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml">,</mo><msubsup id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.cmml"><mi id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.2" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.2.cmml">y</mi><mn id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.3" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.3.cmml">1</mn><mrow id="A1.SS3.p3.1.m1.2.2.1.3" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.cmml"><mo id="A1.SS3.p3.1.m1.2.2.1.3.1" stretchy="false" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.cmml">(</mo><mi id="A1.SS3.p3.1.m1.2.2.1.1" xref="A1.SS3.p3.1.m1.2.2.1.1.cmml">i</mi><mo id="A1.SS3.p3.1.m1.2.2.1.3.2" stretchy="false" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.cmml">)</mo></mrow></msubsup><mo id="A1.SS3.p3.1.m1.9.9.4.4.4.4.7" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml">,</mo><mi id="A1.SS3.p3.1.m1.5.5" mathvariant="normal" xref="A1.SS3.p3.1.m1.5.5.cmml">…</mi><mo id="A1.SS3.p3.1.m1.9.9.4.4.4.4.8" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml">,</mo><msubsup id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.cmml"><mi id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.2" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.2.cmml">y</mi><mi id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.3" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.3.cmml">K</mi><mrow id="A1.SS3.p3.1.m1.3.3.1.3" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.cmml"><mo id="A1.SS3.p3.1.m1.3.3.1.3.1" stretchy="false" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.cmml">(</mo><mi id="A1.SS3.p3.1.m1.3.3.1.1" xref="A1.SS3.p3.1.m1.3.3.1.1.cmml">i</mi><mo id="A1.SS3.p3.1.m1.3.3.1.3.2" stretchy="false" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.cmml">)</mo></mrow></msubsup><mo id="A1.SS3.p3.1.m1.9.9.4.4.4.4.9" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml">,</mo><msup id="A1.SS3.p3.1.m1.9.9.4.4.4.4.4" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.cmml"><mi id="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.2" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.2.cmml">x</mi><mrow id="A1.SS3.p3.1.m1.4.4.1.3" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.cmml"><mo id="A1.SS3.p3.1.m1.4.4.1.3.1" stretchy="false" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.cmml">(</mo><mi id="A1.SS3.p3.1.m1.4.4.1.1" xref="A1.SS3.p3.1.m1.4.4.1.1.cmml">i</mi><mo id="A1.SS3.p3.1.m1.4.4.1.3.2" stretchy="false" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.cmml">)</mo></mrow></msup><mo id="A1.SS3.p3.1.m1.9.9.4.4.4.4.10" stretchy="false" xref="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml">}</mo></mrow><mrow id="A1.SS3.p3.1.m1.9.9.4.4.6" xref="A1.SS3.p3.1.m1.9.9.4.4.6.cmml"><mi id="A1.SS3.p3.1.m1.9.9.4.4.6.2" xref="A1.SS3.p3.1.m1.9.9.4.4.6.2.cmml">i</mi><mo id="A1.SS3.p3.1.m1.9.9.4.4.6.1" xref="A1.SS3.p3.1.m1.9.9.4.4.6.1.cmml">=</mo><mn id="A1.SS3.p3.1.m1.9.9.4.4.6.3" xref="A1.SS3.p3.1.m1.9.9.4.4.6.3.cmml">1</mn></mrow><mi id="A1.SS3.p3.1.m1.9.9.4.6" xref="A1.SS3.p3.1.m1.9.9.4.6.cmml">N</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p3.1.m1.9b"><apply id="A1.SS3.p3.1.m1.9.9.cmml" xref="A1.SS3.p3.1.m1.9.9"><eq id="A1.SS3.p3.1.m1.9.9.5.cmml" xref="A1.SS3.p3.1.m1.9.9.5"></eq><ci id="A1.SS3.p3.1.m1.9.9.6.cmml" xref="A1.SS3.p3.1.m1.9.9.6">𝒟</ci><apply id="A1.SS3.p3.1.m1.9.9.4.cmml" xref="A1.SS3.p3.1.m1.9.9.4"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.9.9.4.5.cmml" xref="A1.SS3.p3.1.m1.9.9.4">superscript</csymbol><apply id="A1.SS3.p3.1.m1.9.9.4.4.cmml" xref="A1.SS3.p3.1.m1.9.9.4"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.9.9.4.4.5.cmml" xref="A1.SS3.p3.1.m1.9.9.4">subscript</csymbol><set id="A1.SS3.p3.1.m1.9.9.4.4.4.5.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4"><apply id="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.cmml" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.1.cmml" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1">superscript</csymbol><ci id="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.2.cmml" xref="A1.SS3.p3.1.m1.6.6.1.1.1.1.1.2">𝜏</ci><ci id="A1.SS3.p3.1.m1.1.1.1.1.cmml" xref="A1.SS3.p3.1.m1.1.1.1.1">𝑖</ci></apply><apply id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.cmml" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.1.cmml" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2">superscript</csymbol><apply id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.cmml" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.1.cmml" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2">subscript</csymbol><ci id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.2.cmml" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.2">𝑦</ci><cn id="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.3.cmml" type="integer" xref="A1.SS3.p3.1.m1.7.7.2.2.2.2.2.2.3">1</cn></apply><ci id="A1.SS3.p3.1.m1.2.2.1.1.cmml" xref="A1.SS3.p3.1.m1.2.2.1.1">𝑖</ci></apply><ci id="A1.SS3.p3.1.m1.5.5.cmml" xref="A1.SS3.p3.1.m1.5.5">…</ci><apply id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.cmml" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.1.cmml" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3">superscript</csymbol><apply id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.cmml" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.1.cmml" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3">subscript</csymbol><ci id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.2.cmml" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.2">𝑦</ci><ci id="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.3.cmml" xref="A1.SS3.p3.1.m1.8.8.3.3.3.3.3.2.3">𝐾</ci></apply><ci id="A1.SS3.p3.1.m1.3.3.1.1.cmml" xref="A1.SS3.p3.1.m1.3.3.1.1">𝑖</ci></apply><apply id="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4"><csymbol cd="ambiguous" id="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.1.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4">superscript</csymbol><ci id="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.2.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.4.4.4.2">𝑥</ci><ci id="A1.SS3.p3.1.m1.4.4.1.1.cmml" xref="A1.SS3.p3.1.m1.4.4.1.1">𝑖</ci></apply></set><apply id="A1.SS3.p3.1.m1.9.9.4.4.6.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.6"><eq id="A1.SS3.p3.1.m1.9.9.4.4.6.1.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.6.1"></eq><ci id="A1.SS3.p3.1.m1.9.9.4.4.6.2.cmml" xref="A1.SS3.p3.1.m1.9.9.4.4.6.2">𝑖</ci><cn id="A1.SS3.p3.1.m1.9.9.4.4.6.3.cmml" type="integer" xref="A1.SS3.p3.1.m1.9.9.4.4.6.3">1</cn></apply></apply><ci id="A1.SS3.p3.1.m1.9.9.4.6.cmml" xref="A1.SS3.p3.1.m1.9.9.4.6">𝑁</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p3.1.m1.9c">\mathcal{D}=\{\tau^{(i)},y_{1}^{(i)},\ldots,y_{K}^{(i)},x^{(i)}\}_{i=1}^{N}</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p3.1.m1.9d">caligraphic_D = { italic_τ start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT , italic_x start_POSTSUPERSCRIPT ( italic_i ) end_POSTSUPERSCRIPT } start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT</annotation></semantics></math> of prompts and user-specified rankings, we can use a parameterized model and optimize this objective with maximum-likelihood.:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.E20">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{DPO}}(\pi_{\theta},\pi_{\text{ref}})=-\mathbb{E}_{\tau,y_{1%
},\ldots,y_{K},x\sim\mathcal{D}}\left[\log\prod_{k=1}^{K}\frac{\exp\left(\beta%
\log\frac{\pi_{\theta}(y_{\tau(k)}|x)}{\pi_{\text{ref}}(y_{\tau(k)}|x)}\right)%
}{\sum_{j=k}^{K}\exp\left(\beta\log\frac{\pi_{\theta}(y_{\tau(j)}|x)}{\pi_{%
\text{ref}}(y_{\tau(j)}|x)}\right)}\right]" class="ltx_Math" display="block" id="A1.E20.m1.20"><semantics id="A1.E20.m1.20a"><mrow id="A1.E20.m1.20.20" xref="A1.E20.m1.20.20.cmml"><mrow id="A1.E20.m1.19.19.2" xref="A1.E20.m1.19.19.2.cmml"><msub id="A1.E20.m1.19.19.2.4" xref="A1.E20.m1.19.19.2.4.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.E20.m1.19.19.2.4.2" xref="A1.E20.m1.19.19.2.4.2.cmml">ℒ</mi><mtext id="A1.E20.m1.19.19.2.4.3" xref="A1.E20.m1.19.19.2.4.3a.cmml">DPO</mtext></msub><mo id="A1.E20.m1.19.19.2.3" xref="A1.E20.m1.19.19.2.3.cmml">⁢</mo><mrow id="A1.E20.m1.19.19.2.2.2" xref="A1.E20.m1.19.19.2.2.3.cmml"><mo id="A1.E20.m1.19.19.2.2.2.3" stretchy="false" xref="A1.E20.m1.19.19.2.2.3.cmml">(</mo><msub id="A1.E20.m1.18.18.1.1.1.1" xref="A1.E20.m1.18.18.1.1.1.1.cmml"><mi id="A1.E20.m1.18.18.1.1.1.1.2" xref="A1.E20.m1.18.18.1.1.1.1.2.cmml">π</mi><mi id="A1.E20.m1.18.18.1.1.1.1.3" xref="A1.E20.m1.18.18.1.1.1.1.3.cmml">θ</mi></msub><mo id="A1.E20.m1.19.19.2.2.2.4" xref="A1.E20.m1.19.19.2.2.3.cmml">,</mo><msub id="A1.E20.m1.19.19.2.2.2.2" xref="A1.E20.m1.19.19.2.2.2.2.cmml"><mi id="A1.E20.m1.19.19.2.2.2.2.2" xref="A1.E20.m1.19.19.2.2.2.2.2.cmml">π</mi><mtext id="A1.E20.m1.19.19.2.2.2.2.3" xref="A1.E20.m1.19.19.2.2.2.2.3a.cmml">ref</mtext></msub><mo id="A1.E20.m1.19.19.2.2.2.5" stretchy="false" xref="A1.E20.m1.19.19.2.2.3.cmml">)</mo></mrow></mrow><mo id="A1.E20.m1.20.20.4" xref="A1.E20.m1.20.20.4.cmml">=</mo><mrow id="A1.E20.m1.20.20.3" xref="A1.E20.m1.20.20.3.cmml"><mo id="A1.E20.m1.20.20.3a" xref="A1.E20.m1.20.20.3.cmml">−</mo><mrow id="A1.E20.m1.20.20.3.1" xref="A1.E20.m1.20.20.3.1.cmml"><msub id="A1.E20.m1.20.20.3.1.3" xref="A1.E20.m1.20.20.3.1.3.cmml"><mi id="A1.E20.m1.20.20.3.1.3.2" xref="A1.E20.m1.20.20.3.1.3.2.cmml">𝔼</mi><mrow id="A1.E20.m1.5.5.5" xref="A1.E20.m1.5.5.5.cmml"><mrow id="A1.E20.m1.5.5.5.5.2" xref="A1.E20.m1.5.5.5.5.3.cmml"><mi id="A1.E20.m1.1.1.1.1" xref="A1.E20.m1.1.1.1.1.cmml">τ</mi><mo id="A1.E20.m1.5.5.5.5.2.3" xref="A1.E20.m1.5.5.5.5.3.cmml">,</mo><msub id="A1.E20.m1.4.4.4.4.1.1" xref="A1.E20.m1.4.4.4.4.1.1.cmml"><mi id="A1.E20.m1.4.4.4.4.1.1.2" xref="A1.E20.m1.4.4.4.4.1.1.2.cmml">y</mi><mn id="A1.E20.m1.4.4.4.4.1.1.3" xref="A1.E20.m1.4.4.4.4.1.1.3.cmml">1</mn></msub><mo id="A1.E20.m1.5.5.5.5.2.4" xref="A1.E20.m1.5.5.5.5.3.cmml">,</mo><mi id="A1.E20.m1.2.2.2.2" mathvariant="normal" xref="A1.E20.m1.2.2.2.2.cmml">…</mi><mo id="A1.E20.m1.5.5.5.5.2.5" xref="A1.E20.m1.5.5.5.5.3.cmml">,</mo><msub id="A1.E20.m1.5.5.5.5.2.2" xref="A1.E20.m1.5.5.5.5.2.2.cmml"><mi id="A1.E20.m1.5.5.5.5.2.2.2" xref="A1.E20.m1.5.5.5.5.2.2.2.cmml">y</mi><mi id="A1.E20.m1.5.5.5.5.2.2.3" xref="A1.E20.m1.5.5.5.5.2.2.3.cmml">K</mi></msub><mo id="A1.E20.m1.5.5.5.5.2.6" xref="A1.E20.m1.5.5.5.5.3.cmml">,</mo><mi id="A1.E20.m1.3.3.3.3" xref="A1.E20.m1.3.3.3.3.cmml">x</mi></mrow><mo id="A1.E20.m1.5.5.5.6" xref="A1.E20.m1.5.5.5.6.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E20.m1.5.5.5.7" xref="A1.E20.m1.5.5.5.7.cmml">𝒟</mi></mrow></msub><mo id="A1.E20.m1.20.20.3.1.2" xref="A1.E20.m1.20.20.3.1.2.cmml">⁢</mo><mrow id="A1.E20.m1.20.20.3.1.1.1" xref="A1.E20.m1.20.20.3.1.1.2.cmml"><mo id="A1.E20.m1.20.20.3.1.1.1.2" xref="A1.E20.m1.20.20.3.1.1.2.1.cmml">[</mo><mrow id="A1.E20.m1.20.20.3.1.1.1.1" xref="A1.E20.m1.20.20.3.1.1.1.1.cmml"><mi id="A1.E20.m1.20.20.3.1.1.1.1.2" xref="A1.E20.m1.20.20.3.1.1.1.1.2.cmml">log</mi><mo id="A1.E20.m1.20.20.3.1.1.1.1.1" xref="A1.E20.m1.20.20.3.1.1.1.1.1.cmml">⁢</mo><mrow id="A1.E20.m1.20.20.3.1.1.1.1.3" xref="A1.E20.m1.20.20.3.1.1.1.1.3.cmml"><munderover id="A1.E20.m1.20.20.3.1.1.1.1.3.1" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.cmml"><mo id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.2" movablelimits="false" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.2.cmml">∏</mo><mrow id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.cmml"><mi id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.2" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.2.cmml">k</mi><mo id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.1" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.1.cmml">=</mo><mn id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.3" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.E20.m1.20.20.3.1.1.1.1.3.1.3" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.3.cmml">K</mi></munderover><mfrac id="A1.E20.m1.17.17" xref="A1.E20.m1.17.17.cmml"><mrow id="A1.E20.m1.11.11.6.6" xref="A1.E20.m1.11.11.6.7.cmml"><mi id="A1.E20.m1.10.10.5.5" xref="A1.E20.m1.10.10.5.5.cmml">exp</mi><mo id="A1.E20.m1.11.11.6.6a" xref="A1.E20.m1.11.11.6.7.cmml">⁡</mo><mrow id="A1.E20.m1.11.11.6.6.1" xref="A1.E20.m1.11.11.6.7.cmml"><mo id="A1.E20.m1.11.11.6.6.1.2" xref="A1.E20.m1.11.11.6.7.cmml">(</mo><mrow id="A1.E20.m1.11.11.6.6.1.1" xref="A1.E20.m1.11.11.6.6.1.1.cmml"><mi id="A1.E20.m1.11.11.6.6.1.1.2" xref="A1.E20.m1.11.11.6.6.1.1.2.cmml">β</mi><mo id="A1.E20.m1.11.11.6.6.1.1.1" lspace="0.167em" xref="A1.E20.m1.11.11.6.6.1.1.1.cmml">⁢</mo><mrow id="A1.E20.m1.11.11.6.6.1.1.3" xref="A1.E20.m1.11.11.6.6.1.1.3.cmml"><mi id="A1.E20.m1.11.11.6.6.1.1.3.1" xref="A1.E20.m1.11.11.6.6.1.1.3.1.cmml">log</mi><mo id="A1.E20.m1.11.11.6.6.1.1.3a" lspace="0.167em" xref="A1.E20.m1.11.11.6.6.1.1.3.cmml">⁡</mo><mfrac id="A1.E20.m1.9.9.4.4" xref="A1.E20.m1.9.9.4.4.cmml"><mrow id="A1.E20.m1.7.7.2.2.2" xref="A1.E20.m1.7.7.2.2.2.cmml"><msub id="A1.E20.m1.7.7.2.2.2.4" xref="A1.E20.m1.7.7.2.2.2.4.cmml"><mi id="A1.E20.m1.7.7.2.2.2.4.2" xref="A1.E20.m1.7.7.2.2.2.4.2.cmml">π</mi><mi id="A1.E20.m1.7.7.2.2.2.4.3" xref="A1.E20.m1.7.7.2.2.2.4.3.cmml">θ</mi></msub><mo id="A1.E20.m1.7.7.2.2.2.3" xref="A1.E20.m1.7.7.2.2.2.3.cmml">⁢</mo><mrow id="A1.E20.m1.7.7.2.2.2.2.1" xref="A1.E20.m1.7.7.2.2.2.2.1.1.cmml"><mo id="A1.E20.m1.7.7.2.2.2.2.1.2" stretchy="false" xref="A1.E20.m1.7.7.2.2.2.2.1.1.cmml">(</mo><mrow id="A1.E20.m1.7.7.2.2.2.2.1.1" xref="A1.E20.m1.7.7.2.2.2.2.1.1.cmml"><msub id="A1.E20.m1.7.7.2.2.2.2.1.1.2" xref="A1.E20.m1.7.7.2.2.2.2.1.1.2.cmml"><mi id="A1.E20.m1.7.7.2.2.2.2.1.1.2.2" xref="A1.E20.m1.7.7.2.2.2.2.1.1.2.2.cmml">y</mi><mrow id="A1.E20.m1.6.6.1.1.1.1.1" xref="A1.E20.m1.6.6.1.1.1.1.1.cmml"><mi id="A1.E20.m1.6.6.1.1.1.1.1.3" xref="A1.E20.m1.6.6.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.E20.m1.6.6.1.1.1.1.1.2" xref="A1.E20.m1.6.6.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E20.m1.6.6.1.1.1.1.1.4.2" xref="A1.E20.m1.6.6.1.1.1.1.1.cmml"><mo id="A1.E20.m1.6.6.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.E20.m1.6.6.1.1.1.1.1.cmml">(</mo><mi id="A1.E20.m1.6.6.1.1.1.1.1.1" xref="A1.E20.m1.6.6.1.1.1.1.1.1.cmml">k</mi><mo id="A1.E20.m1.6.6.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.E20.m1.6.6.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E20.m1.7.7.2.2.2.2.1.1.1" xref="A1.E20.m1.7.7.2.2.2.2.1.1.1.cmml">|</mo><mi id="A1.E20.m1.7.7.2.2.2.2.1.1.3" xref="A1.E20.m1.7.7.2.2.2.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E20.m1.7.7.2.2.2.2.1.3" stretchy="false" xref="A1.E20.m1.7.7.2.2.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E20.m1.9.9.4.4.4" xref="A1.E20.m1.9.9.4.4.4.cmml"><msub id="A1.E20.m1.9.9.4.4.4.4" xref="A1.E20.m1.9.9.4.4.4.4.cmml"><mi id="A1.E20.m1.9.9.4.4.4.4.2" xref="A1.E20.m1.9.9.4.4.4.4.2.cmml">π</mi><mtext id="A1.E20.m1.9.9.4.4.4.4.3" xref="A1.E20.m1.9.9.4.4.4.4.3a.cmml">ref</mtext></msub><mo id="A1.E20.m1.9.9.4.4.4.3" xref="A1.E20.m1.9.9.4.4.4.3.cmml">⁢</mo><mrow id="A1.E20.m1.9.9.4.4.4.2.1" xref="A1.E20.m1.9.9.4.4.4.2.1.1.cmml"><mo id="A1.E20.m1.9.9.4.4.4.2.1.2" stretchy="false" xref="A1.E20.m1.9.9.4.4.4.2.1.1.cmml">(</mo><mrow id="A1.E20.m1.9.9.4.4.4.2.1.1" xref="A1.E20.m1.9.9.4.4.4.2.1.1.cmml"><msub id="A1.E20.m1.9.9.4.4.4.2.1.1.2" xref="A1.E20.m1.9.9.4.4.4.2.1.1.2.cmml"><mi id="A1.E20.m1.9.9.4.4.4.2.1.1.2.2" xref="A1.E20.m1.9.9.4.4.4.2.1.1.2.2.cmml">y</mi><mrow id="A1.E20.m1.8.8.3.3.3.1.1" xref="A1.E20.m1.8.8.3.3.3.1.1.cmml"><mi id="A1.E20.m1.8.8.3.3.3.1.1.3" xref="A1.E20.m1.8.8.3.3.3.1.1.3.cmml">τ</mi><mo id="A1.E20.m1.8.8.3.3.3.1.1.2" xref="A1.E20.m1.8.8.3.3.3.1.1.2.cmml">⁢</mo><mrow id="A1.E20.m1.8.8.3.3.3.1.1.4.2" xref="A1.E20.m1.8.8.3.3.3.1.1.cmml"><mo id="A1.E20.m1.8.8.3.3.3.1.1.4.2.1" stretchy="false" xref="A1.E20.m1.8.8.3.3.3.1.1.cmml">(</mo><mi id="A1.E20.m1.8.8.3.3.3.1.1.1" xref="A1.E20.m1.8.8.3.3.3.1.1.1.cmml">k</mi><mo id="A1.E20.m1.8.8.3.3.3.1.1.4.2.2" stretchy="false" xref="A1.E20.m1.8.8.3.3.3.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E20.m1.9.9.4.4.4.2.1.1.1" xref="A1.E20.m1.9.9.4.4.4.2.1.1.1.cmml">|</mo><mi id="A1.E20.m1.9.9.4.4.4.2.1.1.3" xref="A1.E20.m1.9.9.4.4.4.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E20.m1.9.9.4.4.4.2.1.3" stretchy="false" xref="A1.E20.m1.9.9.4.4.4.2.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.E20.m1.11.11.6.6.1.3" xref="A1.E20.m1.11.11.6.7.cmml">)</mo></mrow></mrow><mrow id="A1.E20.m1.17.17.12" xref="A1.E20.m1.17.17.12.cmml"><msubsup id="A1.E20.m1.17.17.12.7" xref="A1.E20.m1.17.17.12.7.cmml"><mo id="A1.E20.m1.17.17.12.7.2.2" xref="A1.E20.m1.17.17.12.7.2.2.cmml">∑</mo><mrow id="A1.E20.m1.17.17.12.7.2.3" xref="A1.E20.m1.17.17.12.7.2.3.cmml"><mi id="A1.E20.m1.17.17.12.7.2.3.2" xref="A1.E20.m1.17.17.12.7.2.3.2.cmml">j</mi><mo id="A1.E20.m1.17.17.12.7.2.3.1" xref="A1.E20.m1.17.17.12.7.2.3.1.cmml">=</mo><mi id="A1.E20.m1.17.17.12.7.2.3.3" xref="A1.E20.m1.17.17.12.7.2.3.3.cmml">k</mi></mrow><mi id="A1.E20.m1.17.17.12.7.3" xref="A1.E20.m1.17.17.12.7.3.cmml">K</mi></msubsup><mrow id="A1.E20.m1.17.17.12.6.1" xref="A1.E20.m1.17.17.12.6.2.cmml"><mi id="A1.E20.m1.16.16.11.5" xref="A1.E20.m1.16.16.11.5.cmml">exp</mi><mo id="A1.E20.m1.17.17.12.6.1a" xref="A1.E20.m1.17.17.12.6.2.cmml">⁡</mo><mrow id="A1.E20.m1.17.17.12.6.1.1" xref="A1.E20.m1.17.17.12.6.2.cmml"><mo id="A1.E20.m1.17.17.12.6.1.1.2" xref="A1.E20.m1.17.17.12.6.2.cmml">(</mo><mrow id="A1.E20.m1.17.17.12.6.1.1.1" xref="A1.E20.m1.17.17.12.6.1.1.1.cmml"><mi id="A1.E20.m1.17.17.12.6.1.1.1.2" xref="A1.E20.m1.17.17.12.6.1.1.1.2.cmml">β</mi><mo id="A1.E20.m1.17.17.12.6.1.1.1.1" lspace="0.167em" xref="A1.E20.m1.17.17.12.6.1.1.1.1.cmml">⁢</mo><mrow id="A1.E20.m1.17.17.12.6.1.1.1.3" xref="A1.E20.m1.17.17.12.6.1.1.1.3.cmml"><mi id="A1.E20.m1.17.17.12.6.1.1.1.3.1" xref="A1.E20.m1.17.17.12.6.1.1.1.3.1.cmml">log</mi><mo id="A1.E20.m1.17.17.12.6.1.1.1.3a" lspace="0.167em" xref="A1.E20.m1.17.17.12.6.1.1.1.3.cmml">⁡</mo><mfrac id="A1.E20.m1.15.15.10.4" xref="A1.E20.m1.15.15.10.4.cmml"><mrow id="A1.E20.m1.13.13.8.2.2" xref="A1.E20.m1.13.13.8.2.2.cmml"><msub id="A1.E20.m1.13.13.8.2.2.4" xref="A1.E20.m1.13.13.8.2.2.4.cmml"><mi id="A1.E20.m1.13.13.8.2.2.4.2" xref="A1.E20.m1.13.13.8.2.2.4.2.cmml">π</mi><mi id="A1.E20.m1.13.13.8.2.2.4.3" xref="A1.E20.m1.13.13.8.2.2.4.3.cmml">θ</mi></msub><mo id="A1.E20.m1.13.13.8.2.2.3" xref="A1.E20.m1.13.13.8.2.2.3.cmml">⁢</mo><mrow id="A1.E20.m1.13.13.8.2.2.2.1" xref="A1.E20.m1.13.13.8.2.2.2.1.1.cmml"><mo id="A1.E20.m1.13.13.8.2.2.2.1.2" stretchy="false" xref="A1.E20.m1.13.13.8.2.2.2.1.1.cmml">(</mo><mrow id="A1.E20.m1.13.13.8.2.2.2.1.1" xref="A1.E20.m1.13.13.8.2.2.2.1.1.cmml"><msub id="A1.E20.m1.13.13.8.2.2.2.1.1.2" xref="A1.E20.m1.13.13.8.2.2.2.1.1.2.cmml"><mi id="A1.E20.m1.13.13.8.2.2.2.1.1.2.2" xref="A1.E20.m1.13.13.8.2.2.2.1.1.2.2.cmml">y</mi><mrow id="A1.E20.m1.12.12.7.1.1.1.1" xref="A1.E20.m1.12.12.7.1.1.1.1.cmml"><mi id="A1.E20.m1.12.12.7.1.1.1.1.3" xref="A1.E20.m1.12.12.7.1.1.1.1.3.cmml">τ</mi><mo id="A1.E20.m1.12.12.7.1.1.1.1.2" xref="A1.E20.m1.12.12.7.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E20.m1.12.12.7.1.1.1.1.4.2" xref="A1.E20.m1.12.12.7.1.1.1.1.cmml"><mo id="A1.E20.m1.12.12.7.1.1.1.1.4.2.1" stretchy="false" xref="A1.E20.m1.12.12.7.1.1.1.1.cmml">(</mo><mi id="A1.E20.m1.12.12.7.1.1.1.1.1" xref="A1.E20.m1.12.12.7.1.1.1.1.1.cmml">j</mi><mo id="A1.E20.m1.12.12.7.1.1.1.1.4.2.2" stretchy="false" xref="A1.E20.m1.12.12.7.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E20.m1.13.13.8.2.2.2.1.1.1" xref="A1.E20.m1.13.13.8.2.2.2.1.1.1.cmml">|</mo><mi id="A1.E20.m1.13.13.8.2.2.2.1.1.3" xref="A1.E20.m1.13.13.8.2.2.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E20.m1.13.13.8.2.2.2.1.3" stretchy="false" xref="A1.E20.m1.13.13.8.2.2.2.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E20.m1.15.15.10.4.4" xref="A1.E20.m1.15.15.10.4.4.cmml"><msub id="A1.E20.m1.15.15.10.4.4.4" xref="A1.E20.m1.15.15.10.4.4.4.cmml"><mi id="A1.E20.m1.15.15.10.4.4.4.2" xref="A1.E20.m1.15.15.10.4.4.4.2.cmml">π</mi><mtext id="A1.E20.m1.15.15.10.4.4.4.3" xref="A1.E20.m1.15.15.10.4.4.4.3a.cmml">ref</mtext></msub><mo id="A1.E20.m1.15.15.10.4.4.3" xref="A1.E20.m1.15.15.10.4.4.3.cmml">⁢</mo><mrow id="A1.E20.m1.15.15.10.4.4.2.1" xref="A1.E20.m1.15.15.10.4.4.2.1.1.cmml"><mo id="A1.E20.m1.15.15.10.4.4.2.1.2" stretchy="false" xref="A1.E20.m1.15.15.10.4.4.2.1.1.cmml">(</mo><mrow id="A1.E20.m1.15.15.10.4.4.2.1.1" xref="A1.E20.m1.15.15.10.4.4.2.1.1.cmml"><msub id="A1.E20.m1.15.15.10.4.4.2.1.1.2" xref="A1.E20.m1.15.15.10.4.4.2.1.1.2.cmml"><mi id="A1.E20.m1.15.15.10.4.4.2.1.1.2.2" xref="A1.E20.m1.15.15.10.4.4.2.1.1.2.2.cmml">y</mi><mrow id="A1.E20.m1.14.14.9.3.3.1.1" xref="A1.E20.m1.14.14.9.3.3.1.1.cmml"><mi id="A1.E20.m1.14.14.9.3.3.1.1.3" xref="A1.E20.m1.14.14.9.3.3.1.1.3.cmml">τ</mi><mo id="A1.E20.m1.14.14.9.3.3.1.1.2" xref="A1.E20.m1.14.14.9.3.3.1.1.2.cmml">⁢</mo><mrow id="A1.E20.m1.14.14.9.3.3.1.1.4.2" xref="A1.E20.m1.14.14.9.3.3.1.1.cmml"><mo id="A1.E20.m1.14.14.9.3.3.1.1.4.2.1" stretchy="false" xref="A1.E20.m1.14.14.9.3.3.1.1.cmml">(</mo><mi id="A1.E20.m1.14.14.9.3.3.1.1.1" xref="A1.E20.m1.14.14.9.3.3.1.1.1.cmml">j</mi><mo id="A1.E20.m1.14.14.9.3.3.1.1.4.2.2" stretchy="false" xref="A1.E20.m1.14.14.9.3.3.1.1.cmml">)</mo></mrow></mrow></msub><mo fence="false" id="A1.E20.m1.15.15.10.4.4.2.1.1.1" xref="A1.E20.m1.15.15.10.4.4.2.1.1.1.cmml">|</mo><mi id="A1.E20.m1.15.15.10.4.4.2.1.1.3" xref="A1.E20.m1.15.15.10.4.4.2.1.1.3.cmml">x</mi></mrow><mo id="A1.E20.m1.15.15.10.4.4.2.1.3" stretchy="false" xref="A1.E20.m1.15.15.10.4.4.2.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.E20.m1.17.17.12.6.1.1.3" xref="A1.E20.m1.17.17.12.6.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mrow></mrow><mo id="A1.E20.m1.20.20.3.1.1.1.3" xref="A1.E20.m1.20.20.3.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E20.m1.20b"><apply id="A1.E20.m1.20.20.cmml" xref="A1.E20.m1.20.20"><eq id="A1.E20.m1.20.20.4.cmml" xref="A1.E20.m1.20.20.4"></eq><apply id="A1.E20.m1.19.19.2.cmml" xref="A1.E20.m1.19.19.2"><times id="A1.E20.m1.19.19.2.3.cmml" xref="A1.E20.m1.19.19.2.3"></times><apply id="A1.E20.m1.19.19.2.4.cmml" xref="A1.E20.m1.19.19.2.4"><csymbol cd="ambiguous" id="A1.E20.m1.19.19.2.4.1.cmml" xref="A1.E20.m1.19.19.2.4">subscript</csymbol><ci id="A1.E20.m1.19.19.2.4.2.cmml" xref="A1.E20.m1.19.19.2.4.2">ℒ</ci><ci id="A1.E20.m1.19.19.2.4.3a.cmml" xref="A1.E20.m1.19.19.2.4.3"><mtext id="A1.E20.m1.19.19.2.4.3.cmml" mathsize="70%" xref="A1.E20.m1.19.19.2.4.3">DPO</mtext></ci></apply><interval closure="open" id="A1.E20.m1.19.19.2.2.3.cmml" xref="A1.E20.m1.19.19.2.2.2"><apply id="A1.E20.m1.18.18.1.1.1.1.cmml" xref="A1.E20.m1.18.18.1.1.1.1"><csymbol cd="ambiguous" id="A1.E20.m1.18.18.1.1.1.1.1.cmml" xref="A1.E20.m1.18.18.1.1.1.1">subscript</csymbol><ci id="A1.E20.m1.18.18.1.1.1.1.2.cmml" xref="A1.E20.m1.18.18.1.1.1.1.2">𝜋</ci><ci id="A1.E20.m1.18.18.1.1.1.1.3.cmml" xref="A1.E20.m1.18.18.1.1.1.1.3">𝜃</ci></apply><apply id="A1.E20.m1.19.19.2.2.2.2.cmml" xref="A1.E20.m1.19.19.2.2.2.2"><csymbol cd="ambiguous" id="A1.E20.m1.19.19.2.2.2.2.1.cmml" xref="A1.E20.m1.19.19.2.2.2.2">subscript</csymbol><ci id="A1.E20.m1.19.19.2.2.2.2.2.cmml" xref="A1.E20.m1.19.19.2.2.2.2.2">𝜋</ci><ci id="A1.E20.m1.19.19.2.2.2.2.3a.cmml" xref="A1.E20.m1.19.19.2.2.2.2.3"><mtext id="A1.E20.m1.19.19.2.2.2.2.3.cmml" mathsize="70%" xref="A1.E20.m1.19.19.2.2.2.2.3">ref</mtext></ci></apply></interval></apply><apply id="A1.E20.m1.20.20.3.cmml" xref="A1.E20.m1.20.20.3"><minus id="A1.E20.m1.20.20.3.2.cmml" xref="A1.E20.m1.20.20.3"></minus><apply id="A1.E20.m1.20.20.3.1.cmml" xref="A1.E20.m1.20.20.3.1"><times id="A1.E20.m1.20.20.3.1.2.cmml" xref="A1.E20.m1.20.20.3.1.2"></times><apply id="A1.E20.m1.20.20.3.1.3.cmml" xref="A1.E20.m1.20.20.3.1.3"><csymbol cd="ambiguous" id="A1.E20.m1.20.20.3.1.3.1.cmml" xref="A1.E20.m1.20.20.3.1.3">subscript</csymbol><ci id="A1.E20.m1.20.20.3.1.3.2.cmml" xref="A1.E20.m1.20.20.3.1.3.2">𝔼</ci><apply id="A1.E20.m1.5.5.5.cmml" xref="A1.E20.m1.5.5.5"><csymbol cd="latexml" id="A1.E20.m1.5.5.5.6.cmml" xref="A1.E20.m1.5.5.5.6">similar-to</csymbol><list id="A1.E20.m1.5.5.5.5.3.cmml" xref="A1.E20.m1.5.5.5.5.2"><ci id="A1.E20.m1.1.1.1.1.cmml" xref="A1.E20.m1.1.1.1.1">𝜏</ci><apply id="A1.E20.m1.4.4.4.4.1.1.cmml" xref="A1.E20.m1.4.4.4.4.1.1"><csymbol cd="ambiguous" id="A1.E20.m1.4.4.4.4.1.1.1.cmml" xref="A1.E20.m1.4.4.4.4.1.1">subscript</csymbol><ci id="A1.E20.m1.4.4.4.4.1.1.2.cmml" xref="A1.E20.m1.4.4.4.4.1.1.2">𝑦</ci><cn id="A1.E20.m1.4.4.4.4.1.1.3.cmml" type="integer" xref="A1.E20.m1.4.4.4.4.1.1.3">1</cn></apply><ci id="A1.E20.m1.2.2.2.2.cmml" xref="A1.E20.m1.2.2.2.2">…</ci><apply id="A1.E20.m1.5.5.5.5.2.2.cmml" xref="A1.E20.m1.5.5.5.5.2.2"><csymbol cd="ambiguous" id="A1.E20.m1.5.5.5.5.2.2.1.cmml" xref="A1.E20.m1.5.5.5.5.2.2">subscript</csymbol><ci id="A1.E20.m1.5.5.5.5.2.2.2.cmml" xref="A1.E20.m1.5.5.5.5.2.2.2">𝑦</ci><ci id="A1.E20.m1.5.5.5.5.2.2.3.cmml" xref="A1.E20.m1.5.5.5.5.2.2.3">𝐾</ci></apply><ci id="A1.E20.m1.3.3.3.3.cmml" xref="A1.E20.m1.3.3.3.3">𝑥</ci></list><ci id="A1.E20.m1.5.5.5.7.cmml" xref="A1.E20.m1.5.5.5.7">𝒟</ci></apply></apply><apply id="A1.E20.m1.20.20.3.1.1.2.cmml" xref="A1.E20.m1.20.20.3.1.1.1"><csymbol cd="latexml" id="A1.E20.m1.20.20.3.1.1.2.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.2">delimited-[]</csymbol><apply id="A1.E20.m1.20.20.3.1.1.1.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1"><times id="A1.E20.m1.20.20.3.1.1.1.1.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.1"></times><log id="A1.E20.m1.20.20.3.1.1.1.1.2.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.2"></log><apply id="A1.E20.m1.20.20.3.1.1.1.1.3.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3"><apply id="A1.E20.m1.20.20.3.1.1.1.1.3.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1"><csymbol cd="ambiguous" id="A1.E20.m1.20.20.3.1.1.1.1.3.1.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1">superscript</csymbol><apply id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1"><csymbol cd="ambiguous" id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.2.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.2">product</csymbol><apply id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3"><eq id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.1.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.1"></eq><ci id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.2.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.2">𝑘</ci><cn id="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.3.cmml" type="integer" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.2.3.3">1</cn></apply></apply><ci id="A1.E20.m1.20.20.3.1.1.1.1.3.1.3.cmml" xref="A1.E20.m1.20.20.3.1.1.1.1.3.1.3">𝐾</ci></apply><apply id="A1.E20.m1.17.17.cmml" xref="A1.E20.m1.17.17"><divide id="A1.E20.m1.17.17.13.cmml" xref="A1.E20.m1.17.17"></divide><apply id="A1.E20.m1.11.11.6.7.cmml" xref="A1.E20.m1.11.11.6.6"><exp id="A1.E20.m1.10.10.5.5.cmml" xref="A1.E20.m1.10.10.5.5"></exp><apply id="A1.E20.m1.11.11.6.6.1.1.cmml" xref="A1.E20.m1.11.11.6.6.1.1"><times id="A1.E20.m1.11.11.6.6.1.1.1.cmml" xref="A1.E20.m1.11.11.6.6.1.1.1"></times><ci id="A1.E20.m1.11.11.6.6.1.1.2.cmml" xref="A1.E20.m1.11.11.6.6.1.1.2">𝛽</ci><apply id="A1.E20.m1.11.11.6.6.1.1.3.cmml" xref="A1.E20.m1.11.11.6.6.1.1.3"><log id="A1.E20.m1.11.11.6.6.1.1.3.1.cmml" xref="A1.E20.m1.11.11.6.6.1.1.3.1"></log><apply id="A1.E20.m1.9.9.4.4.cmml" xref="A1.E20.m1.9.9.4.4"><divide id="A1.E20.m1.9.9.4.4.5.cmml" xref="A1.E20.m1.9.9.4.4"></divide><apply id="A1.E20.m1.7.7.2.2.2.cmml" xref="A1.E20.m1.7.7.2.2.2"><times id="A1.E20.m1.7.7.2.2.2.3.cmml" xref="A1.E20.m1.7.7.2.2.2.3"></times><apply id="A1.E20.m1.7.7.2.2.2.4.cmml" xref="A1.E20.m1.7.7.2.2.2.4"><csymbol cd="ambiguous" id="A1.E20.m1.7.7.2.2.2.4.1.cmml" xref="A1.E20.m1.7.7.2.2.2.4">subscript</csymbol><ci id="A1.E20.m1.7.7.2.2.2.4.2.cmml" xref="A1.E20.m1.7.7.2.2.2.4.2">𝜋</ci><ci id="A1.E20.m1.7.7.2.2.2.4.3.cmml" xref="A1.E20.m1.7.7.2.2.2.4.3">𝜃</ci></apply><apply id="A1.E20.m1.7.7.2.2.2.2.1.1.cmml" xref="A1.E20.m1.7.7.2.2.2.2.1"><csymbol cd="latexml" id="A1.E20.m1.7.7.2.2.2.2.1.1.1.cmml" xref="A1.E20.m1.7.7.2.2.2.2.1.1.1">conditional</csymbol><apply id="A1.E20.m1.7.7.2.2.2.2.1.1.2.cmml" xref="A1.E20.m1.7.7.2.2.2.2.1.1.2"><csymbol cd="ambiguous" id="A1.E20.m1.7.7.2.2.2.2.1.1.2.1.cmml" xref="A1.E20.m1.7.7.2.2.2.2.1.1.2">subscript</csymbol><ci id="A1.E20.m1.7.7.2.2.2.2.1.1.2.2.cmml" xref="A1.E20.m1.7.7.2.2.2.2.1.1.2.2">𝑦</ci><apply id="A1.E20.m1.6.6.1.1.1.1.1.cmml" xref="A1.E20.m1.6.6.1.1.1.1.1"><times id="A1.E20.m1.6.6.1.1.1.1.1.2.cmml" xref="A1.E20.m1.6.6.1.1.1.1.1.2"></times><ci id="A1.E20.m1.6.6.1.1.1.1.1.3.cmml" xref="A1.E20.m1.6.6.1.1.1.1.1.3">𝜏</ci><ci id="A1.E20.m1.6.6.1.1.1.1.1.1.cmml" xref="A1.E20.m1.6.6.1.1.1.1.1.1">𝑘</ci></apply></apply><ci id="A1.E20.m1.7.7.2.2.2.2.1.1.3.cmml" xref="A1.E20.m1.7.7.2.2.2.2.1.1.3">𝑥</ci></apply></apply><apply id="A1.E20.m1.9.9.4.4.4.cmml" xref="A1.E20.m1.9.9.4.4.4"><times id="A1.E20.m1.9.9.4.4.4.3.cmml" xref="A1.E20.m1.9.9.4.4.4.3"></times><apply id="A1.E20.m1.9.9.4.4.4.4.cmml" xref="A1.E20.m1.9.9.4.4.4.4"><csymbol cd="ambiguous" id="A1.E20.m1.9.9.4.4.4.4.1.cmml" xref="A1.E20.m1.9.9.4.4.4.4">subscript</csymbol><ci id="A1.E20.m1.9.9.4.4.4.4.2.cmml" xref="A1.E20.m1.9.9.4.4.4.4.2">𝜋</ci><ci id="A1.E20.m1.9.9.4.4.4.4.3a.cmml" xref="A1.E20.m1.9.9.4.4.4.4.3"><mtext id="A1.E20.m1.9.9.4.4.4.4.3.cmml" mathsize="50%" xref="A1.E20.m1.9.9.4.4.4.4.3">ref</mtext></ci></apply><apply id="A1.E20.m1.9.9.4.4.4.2.1.1.cmml" xref="A1.E20.m1.9.9.4.4.4.2.1"><csymbol cd="latexml" id="A1.E20.m1.9.9.4.4.4.2.1.1.1.cmml" xref="A1.E20.m1.9.9.4.4.4.2.1.1.1">conditional</csymbol><apply id="A1.E20.m1.9.9.4.4.4.2.1.1.2.cmml" xref="A1.E20.m1.9.9.4.4.4.2.1.1.2"><csymbol cd="ambiguous" id="A1.E20.m1.9.9.4.4.4.2.1.1.2.1.cmml" xref="A1.E20.m1.9.9.4.4.4.2.1.1.2">subscript</csymbol><ci id="A1.E20.m1.9.9.4.4.4.2.1.1.2.2.cmml" xref="A1.E20.m1.9.9.4.4.4.2.1.1.2.2">𝑦</ci><apply id="A1.E20.m1.8.8.3.3.3.1.1.cmml" xref="A1.E20.m1.8.8.3.3.3.1.1"><times id="A1.E20.m1.8.8.3.3.3.1.1.2.cmml" xref="A1.E20.m1.8.8.3.3.3.1.1.2"></times><ci id="A1.E20.m1.8.8.3.3.3.1.1.3.cmml" xref="A1.E20.m1.8.8.3.3.3.1.1.3">𝜏</ci><ci id="A1.E20.m1.8.8.3.3.3.1.1.1.cmml" xref="A1.E20.m1.8.8.3.3.3.1.1.1">𝑘</ci></apply></apply><ci id="A1.E20.m1.9.9.4.4.4.2.1.1.3.cmml" xref="A1.E20.m1.9.9.4.4.4.2.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.E20.m1.17.17.12.cmml" xref="A1.E20.m1.17.17.12"><apply id="A1.E20.m1.17.17.12.7.cmml" xref="A1.E20.m1.17.17.12.7"><csymbol cd="ambiguous" id="A1.E20.m1.17.17.12.7.1.cmml" xref="A1.E20.m1.17.17.12.7">superscript</csymbol><apply id="A1.E20.m1.17.17.12.7.2.cmml" xref="A1.E20.m1.17.17.12.7"><csymbol cd="ambiguous" id="A1.E20.m1.17.17.12.7.2.1.cmml" xref="A1.E20.m1.17.17.12.7">subscript</csymbol><sum id="A1.E20.m1.17.17.12.7.2.2.cmml" xref="A1.E20.m1.17.17.12.7.2.2"></sum><apply id="A1.E20.m1.17.17.12.7.2.3.cmml" xref="A1.E20.m1.17.17.12.7.2.3"><eq id="A1.E20.m1.17.17.12.7.2.3.1.cmml" xref="A1.E20.m1.17.17.12.7.2.3.1"></eq><ci id="A1.E20.m1.17.17.12.7.2.3.2.cmml" xref="A1.E20.m1.17.17.12.7.2.3.2">𝑗</ci><ci id="A1.E20.m1.17.17.12.7.2.3.3.cmml" xref="A1.E20.m1.17.17.12.7.2.3.3">𝑘</ci></apply></apply><ci id="A1.E20.m1.17.17.12.7.3.cmml" xref="A1.E20.m1.17.17.12.7.3">𝐾</ci></apply><apply id="A1.E20.m1.17.17.12.6.2.cmml" xref="A1.E20.m1.17.17.12.6.1"><exp id="A1.E20.m1.16.16.11.5.cmml" xref="A1.E20.m1.16.16.11.5"></exp><apply id="A1.E20.m1.17.17.12.6.1.1.1.cmml" xref="A1.E20.m1.17.17.12.6.1.1.1"><times id="A1.E20.m1.17.17.12.6.1.1.1.1.cmml" xref="A1.E20.m1.17.17.12.6.1.1.1.1"></times><ci id="A1.E20.m1.17.17.12.6.1.1.1.2.cmml" xref="A1.E20.m1.17.17.12.6.1.1.1.2">𝛽</ci><apply id="A1.E20.m1.17.17.12.6.1.1.1.3.cmml" xref="A1.E20.m1.17.17.12.6.1.1.1.3"><log id="A1.E20.m1.17.17.12.6.1.1.1.3.1.cmml" xref="A1.E20.m1.17.17.12.6.1.1.1.3.1"></log><apply id="A1.E20.m1.15.15.10.4.cmml" xref="A1.E20.m1.15.15.10.4"><divide id="A1.E20.m1.15.15.10.4.5.cmml" xref="A1.E20.m1.15.15.10.4"></divide><apply id="A1.E20.m1.13.13.8.2.2.cmml" xref="A1.E20.m1.13.13.8.2.2"><times id="A1.E20.m1.13.13.8.2.2.3.cmml" xref="A1.E20.m1.13.13.8.2.2.3"></times><apply id="A1.E20.m1.13.13.8.2.2.4.cmml" xref="A1.E20.m1.13.13.8.2.2.4"><csymbol cd="ambiguous" id="A1.E20.m1.13.13.8.2.2.4.1.cmml" xref="A1.E20.m1.13.13.8.2.2.4">subscript</csymbol><ci id="A1.E20.m1.13.13.8.2.2.4.2.cmml" xref="A1.E20.m1.13.13.8.2.2.4.2">𝜋</ci><ci id="A1.E20.m1.13.13.8.2.2.4.3.cmml" xref="A1.E20.m1.13.13.8.2.2.4.3">𝜃</ci></apply><apply id="A1.E20.m1.13.13.8.2.2.2.1.1.cmml" xref="A1.E20.m1.13.13.8.2.2.2.1"><csymbol cd="latexml" id="A1.E20.m1.13.13.8.2.2.2.1.1.1.cmml" xref="A1.E20.m1.13.13.8.2.2.2.1.1.1">conditional</csymbol><apply id="A1.E20.m1.13.13.8.2.2.2.1.1.2.cmml" xref="A1.E20.m1.13.13.8.2.2.2.1.1.2"><csymbol cd="ambiguous" id="A1.E20.m1.13.13.8.2.2.2.1.1.2.1.cmml" xref="A1.E20.m1.13.13.8.2.2.2.1.1.2">subscript</csymbol><ci id="A1.E20.m1.13.13.8.2.2.2.1.1.2.2.cmml" xref="A1.E20.m1.13.13.8.2.2.2.1.1.2.2">𝑦</ci><apply id="A1.E20.m1.12.12.7.1.1.1.1.cmml" xref="A1.E20.m1.12.12.7.1.1.1.1"><times id="A1.E20.m1.12.12.7.1.1.1.1.2.cmml" xref="A1.E20.m1.12.12.7.1.1.1.1.2"></times><ci id="A1.E20.m1.12.12.7.1.1.1.1.3.cmml" xref="A1.E20.m1.12.12.7.1.1.1.1.3">𝜏</ci><ci id="A1.E20.m1.12.12.7.1.1.1.1.1.cmml" xref="A1.E20.m1.12.12.7.1.1.1.1.1">𝑗</ci></apply></apply><ci id="A1.E20.m1.13.13.8.2.2.2.1.1.3.cmml" xref="A1.E20.m1.13.13.8.2.2.2.1.1.3">𝑥</ci></apply></apply><apply id="A1.E20.m1.15.15.10.4.4.cmml" xref="A1.E20.m1.15.15.10.4.4"><times id="A1.E20.m1.15.15.10.4.4.3.cmml" xref="A1.E20.m1.15.15.10.4.4.3"></times><apply id="A1.E20.m1.15.15.10.4.4.4.cmml" xref="A1.E20.m1.15.15.10.4.4.4"><csymbol cd="ambiguous" id="A1.E20.m1.15.15.10.4.4.4.1.cmml" xref="A1.E20.m1.15.15.10.4.4.4">subscript</csymbol><ci id="A1.E20.m1.15.15.10.4.4.4.2.cmml" xref="A1.E20.m1.15.15.10.4.4.4.2">𝜋</ci><ci id="A1.E20.m1.15.15.10.4.4.4.3a.cmml" xref="A1.E20.m1.15.15.10.4.4.4.3"><mtext id="A1.E20.m1.15.15.10.4.4.4.3.cmml" mathsize="50%" xref="A1.E20.m1.15.15.10.4.4.4.3">ref</mtext></ci></apply><apply id="A1.E20.m1.15.15.10.4.4.2.1.1.cmml" xref="A1.E20.m1.15.15.10.4.4.2.1"><csymbol cd="latexml" id="A1.E20.m1.15.15.10.4.4.2.1.1.1.cmml" xref="A1.E20.m1.15.15.10.4.4.2.1.1.1">conditional</csymbol><apply id="A1.E20.m1.15.15.10.4.4.2.1.1.2.cmml" xref="A1.E20.m1.15.15.10.4.4.2.1.1.2"><csymbol cd="ambiguous" id="A1.E20.m1.15.15.10.4.4.2.1.1.2.1.cmml" xref="A1.E20.m1.15.15.10.4.4.2.1.1.2">subscript</csymbol><ci id="A1.E20.m1.15.15.10.4.4.2.1.1.2.2.cmml" xref="A1.E20.m1.15.15.10.4.4.2.1.1.2.2">𝑦</ci><apply id="A1.E20.m1.14.14.9.3.3.1.1.cmml" xref="A1.E20.m1.14.14.9.3.3.1.1"><times id="A1.E20.m1.14.14.9.3.3.1.1.2.cmml" xref="A1.E20.m1.14.14.9.3.3.1.1.2"></times><ci id="A1.E20.m1.14.14.9.3.3.1.1.3.cmml" xref="A1.E20.m1.14.14.9.3.3.1.1.3">𝜏</ci><ci id="A1.E20.m1.14.14.9.3.3.1.1.1.cmml" xref="A1.E20.m1.14.14.9.3.3.1.1.1">𝑗</ci></apply></apply><ci id="A1.E20.m1.15.15.10.4.4.2.1.1.3.cmml" xref="A1.E20.m1.15.15.10.4.4.2.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E20.m1.20c">\mathcal{L}_{\text{DPO}}(\pi_{\theta},\pi_{\text{ref}})=-\mathbb{E}_{\tau,y_{1%
},\ldots,y_{K},x\sim\mathcal{D}}\left[\log\prod_{k=1}^{K}\frac{\exp\left(\beta%
\log\frac{\pi_{\theta}(y_{\tau(k)}|x)}{\pi_{\text{ref}}(y_{\tau(k)}|x)}\right)%
}{\sum_{j=k}^{K}\exp\left(\beta\log\frac{\pi_{\theta}(y_{\tau(j)}|x)}{\pi_{%
\text{ref}}(y_{\tau(j)}|x)}\right)}\right]</annotation><annotation encoding="application/x-llamapun" id="A1.E20.m1.20d">caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) = - blackboard_E start_POSTSUBSCRIPT italic_τ , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_x ∼ caligraphic_D end_POSTSUBSCRIPT [ roman_log ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT | italic_x ) end_ARG ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT | italic_x ) end_ARG ) end_ARG ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(20)</span></td>
</tr></tbody>
</table>
</div>
</section>
<section class="ltx_subsection" id="A1.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.4 </span>Deriving the Gradient of the DPO Objective</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS4.p1">
<p class="ltx_p" id="A1.SS4.p1.1">In this section we derive the gradient of the DPO objective:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx4">
<tbody id="A1.E21"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{%
ref}})=-\nabla_{\theta}\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\left[\log%
\sigma\left(\beta\log\frac{\pi_{\theta}(y_{l}|x)}{\pi_{\text{ref}}(y_{l}|x)}-%
\beta\log\frac{\pi_{\theta}(y_{w}|x)}{\pi_{\text{ref}}(y_{w}|x)}\right)\right]" class="ltx_Math" display="inline" id="A1.E21.m1.10"><semantics id="A1.E21.m1.10a"><mrow id="A1.E21.m1.10.10" xref="A1.E21.m1.10.10.cmml"><mrow id="A1.E21.m1.9.9.2" xref="A1.E21.m1.9.9.2.cmml"><mrow id="A1.E21.m1.9.9.2.4" xref="A1.E21.m1.9.9.2.4.cmml"><msub id="A1.E21.m1.9.9.2.4.1" xref="A1.E21.m1.9.9.2.4.1.cmml"><mo id="A1.E21.m1.9.9.2.4.1.2" xref="A1.E21.m1.9.9.2.4.1.2.cmml">∇</mo><mi id="A1.E21.m1.9.9.2.4.1.3" xref="A1.E21.m1.9.9.2.4.1.3.cmml">θ</mi></msub><msub id="A1.E21.m1.9.9.2.4.2" xref="A1.E21.m1.9.9.2.4.2.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.E21.m1.9.9.2.4.2.2" xref="A1.E21.m1.9.9.2.4.2.2.cmml">ℒ</mi><mtext id="A1.E21.m1.9.9.2.4.2.3" xref="A1.E21.m1.9.9.2.4.2.3a.cmml">DPO</mtext></msub></mrow><mo id="A1.E21.m1.9.9.2.3" xref="A1.E21.m1.9.9.2.3.cmml">⁢</mo><mrow id="A1.E21.m1.9.9.2.2.2" xref="A1.E21.m1.9.9.2.2.3.cmml"><mo id="A1.E21.m1.9.9.2.2.2.3" stretchy="false" xref="A1.E21.m1.9.9.2.2.3.cmml">(</mo><msub id="A1.E21.m1.8.8.1.1.1.1" xref="A1.E21.m1.8.8.1.1.1.1.cmml"><mi id="A1.E21.m1.8.8.1.1.1.1.2" xref="A1.E21.m1.8.8.1.1.1.1.2.cmml">π</mi><mi id="A1.E21.m1.8.8.1.1.1.1.3" xref="A1.E21.m1.8.8.1.1.1.1.3.cmml">θ</mi></msub><mo id="A1.E21.m1.9.9.2.2.2.4" xref="A1.E21.m1.9.9.2.2.3.cmml">;</mo><msub id="A1.E21.m1.9.9.2.2.2.2" xref="A1.E21.m1.9.9.2.2.2.2.cmml"><mi id="A1.E21.m1.9.9.2.2.2.2.2" xref="A1.E21.m1.9.9.2.2.2.2.2.cmml">π</mi><mtext id="A1.E21.m1.9.9.2.2.2.2.3" xref="A1.E21.m1.9.9.2.2.2.2.3a.cmml">ref</mtext></msub><mo id="A1.E21.m1.9.9.2.2.2.5" stretchy="false" xref="A1.E21.m1.9.9.2.2.3.cmml">)</mo></mrow></mrow><mo id="A1.E21.m1.10.10.4" xref="A1.E21.m1.10.10.4.cmml">=</mo><mrow id="A1.E21.m1.10.10.3" xref="A1.E21.m1.10.10.3.cmml"><mo id="A1.E21.m1.10.10.3a" rspace="0.167em" xref="A1.E21.m1.10.10.3.cmml">−</mo><mrow id="A1.E21.m1.10.10.3.1" xref="A1.E21.m1.10.10.3.1.cmml"><mrow id="A1.E21.m1.10.10.3.1.3" xref="A1.E21.m1.10.10.3.1.3.cmml"><msub id="A1.E21.m1.10.10.3.1.3.1" xref="A1.E21.m1.10.10.3.1.3.1.cmml"><mo id="A1.E21.m1.10.10.3.1.3.1.2" rspace="0.167em" xref="A1.E21.m1.10.10.3.1.3.1.2.cmml">∇</mo><mi id="A1.E21.m1.10.10.3.1.3.1.3" xref="A1.E21.m1.10.10.3.1.3.1.3.cmml">θ</mi></msub><msub id="A1.E21.m1.10.10.3.1.3.2" xref="A1.E21.m1.10.10.3.1.3.2.cmml"><mi id="A1.E21.m1.10.10.3.1.3.2.2" xref="A1.E21.m1.10.10.3.1.3.2.2.cmml">𝔼</mi><mrow id="A1.E21.m1.3.3.3" xref="A1.E21.m1.3.3.3.cmml"><mrow id="A1.E21.m1.3.3.3.3.2" xref="A1.E21.m1.3.3.3.3.3.cmml"><mo id="A1.E21.m1.3.3.3.3.2.3" stretchy="false" xref="A1.E21.m1.3.3.3.3.3.cmml">(</mo><mi id="A1.E21.m1.1.1.1.1" xref="A1.E21.m1.1.1.1.1.cmml">x</mi><mo id="A1.E21.m1.3.3.3.3.2.4" xref="A1.E21.m1.3.3.3.3.3.cmml">,</mo><msub id="A1.E21.m1.2.2.2.2.1.1" xref="A1.E21.m1.2.2.2.2.1.1.cmml"><mi id="A1.E21.m1.2.2.2.2.1.1.2" xref="A1.E21.m1.2.2.2.2.1.1.2.cmml">y</mi><mi id="A1.E21.m1.2.2.2.2.1.1.3" xref="A1.E21.m1.2.2.2.2.1.1.3.cmml">w</mi></msub><mo id="A1.E21.m1.3.3.3.3.2.5" xref="A1.E21.m1.3.3.3.3.3.cmml">,</mo><msub id="A1.E21.m1.3.3.3.3.2.2" xref="A1.E21.m1.3.3.3.3.2.2.cmml"><mi id="A1.E21.m1.3.3.3.3.2.2.2" xref="A1.E21.m1.3.3.3.3.2.2.2.cmml">y</mi><mi id="A1.E21.m1.3.3.3.3.2.2.3" xref="A1.E21.m1.3.3.3.3.2.2.3.cmml">l</mi></msub><mo id="A1.E21.m1.3.3.3.3.2.6" stretchy="false" xref="A1.E21.m1.3.3.3.3.3.cmml">)</mo></mrow><mo id="A1.E21.m1.3.3.3.4" xref="A1.E21.m1.3.3.3.4.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E21.m1.3.3.3.5" xref="A1.E21.m1.3.3.3.5.cmml">𝒟</mi></mrow></msub></mrow><mo id="A1.E21.m1.10.10.3.1.2" xref="A1.E21.m1.10.10.3.1.2.cmml">⁢</mo><mrow id="A1.E21.m1.10.10.3.1.1.1" xref="A1.E21.m1.10.10.3.1.1.2.cmml"><mo id="A1.E21.m1.10.10.3.1.1.1.2" xref="A1.E21.m1.10.10.3.1.1.2.1.cmml">[</mo><mrow id="A1.E21.m1.10.10.3.1.1.1.1" xref="A1.E21.m1.10.10.3.1.1.1.1.cmml"><mrow id="A1.E21.m1.10.10.3.1.1.1.1.3" xref="A1.E21.m1.10.10.3.1.1.1.1.3.cmml"><mi id="A1.E21.m1.10.10.3.1.1.1.1.3.1" xref="A1.E21.m1.10.10.3.1.1.1.1.3.1.cmml">log</mi><mo id="A1.E21.m1.10.10.3.1.1.1.1.3a" lspace="0.167em" xref="A1.E21.m1.10.10.3.1.1.1.1.3.cmml">⁡</mo><mi id="A1.E21.m1.10.10.3.1.1.1.1.3.2" xref="A1.E21.m1.10.10.3.1.1.1.1.3.2.cmml">σ</mi></mrow><mo id="A1.E21.m1.10.10.3.1.1.1.1.2" xref="A1.E21.m1.10.10.3.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E21.m1.10.10.3.1.1.1.1.1.1" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.cmml"><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.2" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.cmml"><mrow id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.cmml"><mi id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.2" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.2.cmml">β</mi><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.1" lspace="0.167em" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.cmml"><mi id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.1" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.1.cmml">log</mi><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3a" lspace="0.167em" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.cmml">⁡</mo><mstyle displaystyle="true" id="A1.E21.m1.5.5" xref="A1.E21.m1.5.5.cmml"><mfrac id="A1.E21.m1.5.5a" xref="A1.E21.m1.5.5.cmml"><mrow id="A1.E21.m1.4.4.1" xref="A1.E21.m1.4.4.1.cmml"><msub id="A1.E21.m1.4.4.1.3" xref="A1.E21.m1.4.4.1.3.cmml"><mi id="A1.E21.m1.4.4.1.3.2" xref="A1.E21.m1.4.4.1.3.2.cmml">π</mi><mi id="A1.E21.m1.4.4.1.3.3" xref="A1.E21.m1.4.4.1.3.3.cmml">θ</mi></msub><mo id="A1.E21.m1.4.4.1.2" xref="A1.E21.m1.4.4.1.2.cmml">⁢</mo><mrow id="A1.E21.m1.4.4.1.1.1" xref="A1.E21.m1.4.4.1.1.1.1.cmml"><mo id="A1.E21.m1.4.4.1.1.1.2" stretchy="false" xref="A1.E21.m1.4.4.1.1.1.1.cmml">(</mo><mrow id="A1.E21.m1.4.4.1.1.1.1" xref="A1.E21.m1.4.4.1.1.1.1.cmml"><msub id="A1.E21.m1.4.4.1.1.1.1.2" xref="A1.E21.m1.4.4.1.1.1.1.2.cmml"><mi id="A1.E21.m1.4.4.1.1.1.1.2.2" xref="A1.E21.m1.4.4.1.1.1.1.2.2.cmml">y</mi><mi id="A1.E21.m1.4.4.1.1.1.1.2.3" xref="A1.E21.m1.4.4.1.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A1.E21.m1.4.4.1.1.1.1.1" xref="A1.E21.m1.4.4.1.1.1.1.1.cmml">|</mo><mi id="A1.E21.m1.4.4.1.1.1.1.3" xref="A1.E21.m1.4.4.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E21.m1.4.4.1.1.1.3" stretchy="false" xref="A1.E21.m1.4.4.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E21.m1.5.5.2" xref="A1.E21.m1.5.5.2.cmml"><msub id="A1.E21.m1.5.5.2.3" xref="A1.E21.m1.5.5.2.3.cmml"><mi id="A1.E21.m1.5.5.2.3.2" xref="A1.E21.m1.5.5.2.3.2.cmml">π</mi><mtext id="A1.E21.m1.5.5.2.3.3" xref="A1.E21.m1.5.5.2.3.3a.cmml">ref</mtext></msub><mo id="A1.E21.m1.5.5.2.2" xref="A1.E21.m1.5.5.2.2.cmml">⁢</mo><mrow id="A1.E21.m1.5.5.2.1.1" xref="A1.E21.m1.5.5.2.1.1.1.cmml"><mo id="A1.E21.m1.5.5.2.1.1.2" stretchy="false" xref="A1.E21.m1.5.5.2.1.1.1.cmml">(</mo><mrow id="A1.E21.m1.5.5.2.1.1.1" xref="A1.E21.m1.5.5.2.1.1.1.cmml"><msub id="A1.E21.m1.5.5.2.1.1.1.2" xref="A1.E21.m1.5.5.2.1.1.1.2.cmml"><mi id="A1.E21.m1.5.5.2.1.1.1.2.2" xref="A1.E21.m1.5.5.2.1.1.1.2.2.cmml">y</mi><mi id="A1.E21.m1.5.5.2.1.1.1.2.3" xref="A1.E21.m1.5.5.2.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A1.E21.m1.5.5.2.1.1.1.1" xref="A1.E21.m1.5.5.2.1.1.1.1.cmml">|</mo><mi id="A1.E21.m1.5.5.2.1.1.1.3" xref="A1.E21.m1.5.5.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E21.m1.5.5.2.1.1.3" stretchy="false" xref="A1.E21.m1.5.5.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow></mrow><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.1" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.1.cmml">−</mo><mrow id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.cmml"><mi id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.2" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.2.cmml">β</mi><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.1" lspace="0.167em" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.cmml"><mi id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.1" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.1.cmml">log</mi><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3a" lspace="0.167em" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.cmml">⁡</mo><mstyle displaystyle="true" id="A1.E21.m1.7.7" xref="A1.E21.m1.7.7.cmml"><mfrac id="A1.E21.m1.7.7a" xref="A1.E21.m1.7.7.cmml"><mrow id="A1.E21.m1.6.6.1" xref="A1.E21.m1.6.6.1.cmml"><msub id="A1.E21.m1.6.6.1.3" xref="A1.E21.m1.6.6.1.3.cmml"><mi id="A1.E21.m1.6.6.1.3.2" xref="A1.E21.m1.6.6.1.3.2.cmml">π</mi><mi id="A1.E21.m1.6.6.1.3.3" xref="A1.E21.m1.6.6.1.3.3.cmml">θ</mi></msub><mo id="A1.E21.m1.6.6.1.2" xref="A1.E21.m1.6.6.1.2.cmml">⁢</mo><mrow id="A1.E21.m1.6.6.1.1.1" xref="A1.E21.m1.6.6.1.1.1.1.cmml"><mo id="A1.E21.m1.6.6.1.1.1.2" stretchy="false" xref="A1.E21.m1.6.6.1.1.1.1.cmml">(</mo><mrow id="A1.E21.m1.6.6.1.1.1.1" xref="A1.E21.m1.6.6.1.1.1.1.cmml"><msub id="A1.E21.m1.6.6.1.1.1.1.2" xref="A1.E21.m1.6.6.1.1.1.1.2.cmml"><mi id="A1.E21.m1.6.6.1.1.1.1.2.2" xref="A1.E21.m1.6.6.1.1.1.1.2.2.cmml">y</mi><mi id="A1.E21.m1.6.6.1.1.1.1.2.3" xref="A1.E21.m1.6.6.1.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A1.E21.m1.6.6.1.1.1.1.1" xref="A1.E21.m1.6.6.1.1.1.1.1.cmml">|</mo><mi id="A1.E21.m1.6.6.1.1.1.1.3" xref="A1.E21.m1.6.6.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E21.m1.6.6.1.1.1.3" stretchy="false" xref="A1.E21.m1.6.6.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.E21.m1.7.7.2" xref="A1.E21.m1.7.7.2.cmml"><msub id="A1.E21.m1.7.7.2.3" xref="A1.E21.m1.7.7.2.3.cmml"><mi id="A1.E21.m1.7.7.2.3.2" xref="A1.E21.m1.7.7.2.3.2.cmml">π</mi><mtext id="A1.E21.m1.7.7.2.3.3" xref="A1.E21.m1.7.7.2.3.3a.cmml">ref</mtext></msub><mo id="A1.E21.m1.7.7.2.2" xref="A1.E21.m1.7.7.2.2.cmml">⁢</mo><mrow id="A1.E21.m1.7.7.2.1.1" xref="A1.E21.m1.7.7.2.1.1.1.cmml"><mo id="A1.E21.m1.7.7.2.1.1.2" stretchy="false" xref="A1.E21.m1.7.7.2.1.1.1.cmml">(</mo><mrow id="A1.E21.m1.7.7.2.1.1.1" xref="A1.E21.m1.7.7.2.1.1.1.cmml"><msub id="A1.E21.m1.7.7.2.1.1.1.2" xref="A1.E21.m1.7.7.2.1.1.1.2.cmml"><mi id="A1.E21.m1.7.7.2.1.1.1.2.2" xref="A1.E21.m1.7.7.2.1.1.1.2.2.cmml">y</mi><mi id="A1.E21.m1.7.7.2.1.1.1.2.3" xref="A1.E21.m1.7.7.2.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A1.E21.m1.7.7.2.1.1.1.1" xref="A1.E21.m1.7.7.2.1.1.1.1.cmml">|</mo><mi id="A1.E21.m1.7.7.2.1.1.1.3" xref="A1.E21.m1.7.7.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.E21.m1.7.7.2.1.1.3" stretchy="false" xref="A1.E21.m1.7.7.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mstyle></mrow></mrow></mrow><mo id="A1.E21.m1.10.10.3.1.1.1.1.1.1.3" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E21.m1.10.10.3.1.1.1.3" xref="A1.E21.m1.10.10.3.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E21.m1.10b"><apply id="A1.E21.m1.10.10.cmml" xref="A1.E21.m1.10.10"><eq id="A1.E21.m1.10.10.4.cmml" xref="A1.E21.m1.10.10.4"></eq><apply id="A1.E21.m1.9.9.2.cmml" xref="A1.E21.m1.9.9.2"><times id="A1.E21.m1.9.9.2.3.cmml" xref="A1.E21.m1.9.9.2.3"></times><apply id="A1.E21.m1.9.9.2.4.cmml" xref="A1.E21.m1.9.9.2.4"><apply id="A1.E21.m1.9.9.2.4.1.cmml" xref="A1.E21.m1.9.9.2.4.1"><csymbol cd="ambiguous" id="A1.E21.m1.9.9.2.4.1.1.cmml" xref="A1.E21.m1.9.9.2.4.1">subscript</csymbol><ci id="A1.E21.m1.9.9.2.4.1.2.cmml" xref="A1.E21.m1.9.9.2.4.1.2">∇</ci><ci id="A1.E21.m1.9.9.2.4.1.3.cmml" xref="A1.E21.m1.9.9.2.4.1.3">𝜃</ci></apply><apply id="A1.E21.m1.9.9.2.4.2.cmml" xref="A1.E21.m1.9.9.2.4.2"><csymbol cd="ambiguous" id="A1.E21.m1.9.9.2.4.2.1.cmml" xref="A1.E21.m1.9.9.2.4.2">subscript</csymbol><ci id="A1.E21.m1.9.9.2.4.2.2.cmml" xref="A1.E21.m1.9.9.2.4.2.2">ℒ</ci><ci id="A1.E21.m1.9.9.2.4.2.3a.cmml" xref="A1.E21.m1.9.9.2.4.2.3"><mtext id="A1.E21.m1.9.9.2.4.2.3.cmml" mathsize="70%" xref="A1.E21.m1.9.9.2.4.2.3">DPO</mtext></ci></apply></apply><list id="A1.E21.m1.9.9.2.2.3.cmml" xref="A1.E21.m1.9.9.2.2.2"><apply id="A1.E21.m1.8.8.1.1.1.1.cmml" xref="A1.E21.m1.8.8.1.1.1.1"><csymbol cd="ambiguous" id="A1.E21.m1.8.8.1.1.1.1.1.cmml" xref="A1.E21.m1.8.8.1.1.1.1">subscript</csymbol><ci id="A1.E21.m1.8.8.1.1.1.1.2.cmml" xref="A1.E21.m1.8.8.1.1.1.1.2">𝜋</ci><ci id="A1.E21.m1.8.8.1.1.1.1.3.cmml" xref="A1.E21.m1.8.8.1.1.1.1.3">𝜃</ci></apply><apply id="A1.E21.m1.9.9.2.2.2.2.cmml" xref="A1.E21.m1.9.9.2.2.2.2"><csymbol cd="ambiguous" id="A1.E21.m1.9.9.2.2.2.2.1.cmml" xref="A1.E21.m1.9.9.2.2.2.2">subscript</csymbol><ci id="A1.E21.m1.9.9.2.2.2.2.2.cmml" xref="A1.E21.m1.9.9.2.2.2.2.2">𝜋</ci><ci id="A1.E21.m1.9.9.2.2.2.2.3a.cmml" xref="A1.E21.m1.9.9.2.2.2.2.3"><mtext id="A1.E21.m1.9.9.2.2.2.2.3.cmml" mathsize="70%" xref="A1.E21.m1.9.9.2.2.2.2.3">ref</mtext></ci></apply></list></apply><apply id="A1.E21.m1.10.10.3.cmml" xref="A1.E21.m1.10.10.3"><minus id="A1.E21.m1.10.10.3.2.cmml" xref="A1.E21.m1.10.10.3"></minus><apply id="A1.E21.m1.10.10.3.1.cmml" xref="A1.E21.m1.10.10.3.1"><times id="A1.E21.m1.10.10.3.1.2.cmml" xref="A1.E21.m1.10.10.3.1.2"></times><apply id="A1.E21.m1.10.10.3.1.3.cmml" xref="A1.E21.m1.10.10.3.1.3"><apply id="A1.E21.m1.10.10.3.1.3.1.cmml" xref="A1.E21.m1.10.10.3.1.3.1"><csymbol cd="ambiguous" id="A1.E21.m1.10.10.3.1.3.1.1.cmml" xref="A1.E21.m1.10.10.3.1.3.1">subscript</csymbol><ci id="A1.E21.m1.10.10.3.1.3.1.2.cmml" xref="A1.E21.m1.10.10.3.1.3.1.2">∇</ci><ci id="A1.E21.m1.10.10.3.1.3.1.3.cmml" xref="A1.E21.m1.10.10.3.1.3.1.3">𝜃</ci></apply><apply id="A1.E21.m1.10.10.3.1.3.2.cmml" xref="A1.E21.m1.10.10.3.1.3.2"><csymbol cd="ambiguous" id="A1.E21.m1.10.10.3.1.3.2.1.cmml" xref="A1.E21.m1.10.10.3.1.3.2">subscript</csymbol><ci id="A1.E21.m1.10.10.3.1.3.2.2.cmml" xref="A1.E21.m1.10.10.3.1.3.2.2">𝔼</ci><apply id="A1.E21.m1.3.3.3.cmml" xref="A1.E21.m1.3.3.3"><csymbol cd="latexml" id="A1.E21.m1.3.3.3.4.cmml" xref="A1.E21.m1.3.3.3.4">similar-to</csymbol><vector id="A1.E21.m1.3.3.3.3.3.cmml" xref="A1.E21.m1.3.3.3.3.2"><ci id="A1.E21.m1.1.1.1.1.cmml" xref="A1.E21.m1.1.1.1.1">𝑥</ci><apply id="A1.E21.m1.2.2.2.2.1.1.cmml" xref="A1.E21.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="A1.E21.m1.2.2.2.2.1.1.1.cmml" xref="A1.E21.m1.2.2.2.2.1.1">subscript</csymbol><ci id="A1.E21.m1.2.2.2.2.1.1.2.cmml" xref="A1.E21.m1.2.2.2.2.1.1.2">𝑦</ci><ci id="A1.E21.m1.2.2.2.2.1.1.3.cmml" xref="A1.E21.m1.2.2.2.2.1.1.3">𝑤</ci></apply><apply id="A1.E21.m1.3.3.3.3.2.2.cmml" xref="A1.E21.m1.3.3.3.3.2.2"><csymbol cd="ambiguous" id="A1.E21.m1.3.3.3.3.2.2.1.cmml" xref="A1.E21.m1.3.3.3.3.2.2">subscript</csymbol><ci id="A1.E21.m1.3.3.3.3.2.2.2.cmml" xref="A1.E21.m1.3.3.3.3.2.2.2">𝑦</ci><ci id="A1.E21.m1.3.3.3.3.2.2.3.cmml" xref="A1.E21.m1.3.3.3.3.2.2.3">𝑙</ci></apply></vector><ci id="A1.E21.m1.3.3.3.5.cmml" xref="A1.E21.m1.3.3.3.5">𝒟</ci></apply></apply></apply><apply id="A1.E21.m1.10.10.3.1.1.2.cmml" xref="A1.E21.m1.10.10.3.1.1.1"><csymbol cd="latexml" id="A1.E21.m1.10.10.3.1.1.2.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.2">delimited-[]</csymbol><apply id="A1.E21.m1.10.10.3.1.1.1.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1"><times id="A1.E21.m1.10.10.3.1.1.1.1.2.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.2"></times><apply id="A1.E21.m1.10.10.3.1.1.1.1.3.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.3"><log id="A1.E21.m1.10.10.3.1.1.1.1.3.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.3.1"></log><ci id="A1.E21.m1.10.10.3.1.1.1.1.3.2.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.3.2">𝜎</ci></apply><apply id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1"><minus id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.1"></minus><apply id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2"><times id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.1"></times><ci id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.2.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.2">𝛽</ci><apply id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3"><log id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.2.3.1"></log><apply id="A1.E21.m1.5.5.cmml" xref="A1.E21.m1.5.5"><divide id="A1.E21.m1.5.5.3.cmml" xref="A1.E21.m1.5.5"></divide><apply id="A1.E21.m1.4.4.1.cmml" xref="A1.E21.m1.4.4.1"><times id="A1.E21.m1.4.4.1.2.cmml" xref="A1.E21.m1.4.4.1.2"></times><apply id="A1.E21.m1.4.4.1.3.cmml" xref="A1.E21.m1.4.4.1.3"><csymbol cd="ambiguous" id="A1.E21.m1.4.4.1.3.1.cmml" xref="A1.E21.m1.4.4.1.3">subscript</csymbol><ci id="A1.E21.m1.4.4.1.3.2.cmml" xref="A1.E21.m1.4.4.1.3.2">𝜋</ci><ci id="A1.E21.m1.4.4.1.3.3.cmml" xref="A1.E21.m1.4.4.1.3.3">𝜃</ci></apply><apply id="A1.E21.m1.4.4.1.1.1.1.cmml" xref="A1.E21.m1.4.4.1.1.1"><csymbol cd="latexml" id="A1.E21.m1.4.4.1.1.1.1.1.cmml" xref="A1.E21.m1.4.4.1.1.1.1.1">conditional</csymbol><apply id="A1.E21.m1.4.4.1.1.1.1.2.cmml" xref="A1.E21.m1.4.4.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.E21.m1.4.4.1.1.1.1.2.1.cmml" xref="A1.E21.m1.4.4.1.1.1.1.2">subscript</csymbol><ci id="A1.E21.m1.4.4.1.1.1.1.2.2.cmml" xref="A1.E21.m1.4.4.1.1.1.1.2.2">𝑦</ci><ci id="A1.E21.m1.4.4.1.1.1.1.2.3.cmml" xref="A1.E21.m1.4.4.1.1.1.1.2.3">𝑙</ci></apply><ci id="A1.E21.m1.4.4.1.1.1.1.3.cmml" xref="A1.E21.m1.4.4.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.E21.m1.5.5.2.cmml" xref="A1.E21.m1.5.5.2"><times id="A1.E21.m1.5.5.2.2.cmml" xref="A1.E21.m1.5.5.2.2"></times><apply id="A1.E21.m1.5.5.2.3.cmml" xref="A1.E21.m1.5.5.2.3"><csymbol cd="ambiguous" id="A1.E21.m1.5.5.2.3.1.cmml" xref="A1.E21.m1.5.5.2.3">subscript</csymbol><ci id="A1.E21.m1.5.5.2.3.2.cmml" xref="A1.E21.m1.5.5.2.3.2">𝜋</ci><ci id="A1.E21.m1.5.5.2.3.3a.cmml" xref="A1.E21.m1.5.5.2.3.3"><mtext id="A1.E21.m1.5.5.2.3.3.cmml" mathsize="70%" xref="A1.E21.m1.5.5.2.3.3">ref</mtext></ci></apply><apply id="A1.E21.m1.5.5.2.1.1.1.cmml" xref="A1.E21.m1.5.5.2.1.1"><csymbol cd="latexml" id="A1.E21.m1.5.5.2.1.1.1.1.cmml" xref="A1.E21.m1.5.5.2.1.1.1.1">conditional</csymbol><apply id="A1.E21.m1.5.5.2.1.1.1.2.cmml" xref="A1.E21.m1.5.5.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.E21.m1.5.5.2.1.1.1.2.1.cmml" xref="A1.E21.m1.5.5.2.1.1.1.2">subscript</csymbol><ci id="A1.E21.m1.5.5.2.1.1.1.2.2.cmml" xref="A1.E21.m1.5.5.2.1.1.1.2.2">𝑦</ci><ci id="A1.E21.m1.5.5.2.1.1.1.2.3.cmml" xref="A1.E21.m1.5.5.2.1.1.1.2.3">𝑙</ci></apply><ci id="A1.E21.m1.5.5.2.1.1.1.3.cmml" xref="A1.E21.m1.5.5.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3"><times id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.1"></times><ci id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.2.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.2">𝛽</ci><apply id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3"><log id="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.1.cmml" xref="A1.E21.m1.10.10.3.1.1.1.1.1.1.1.3.3.1"></log><apply id="A1.E21.m1.7.7.cmml" xref="A1.E21.m1.7.7"><divide id="A1.E21.m1.7.7.3.cmml" xref="A1.E21.m1.7.7"></divide><apply id="A1.E21.m1.6.6.1.cmml" xref="A1.E21.m1.6.6.1"><times id="A1.E21.m1.6.6.1.2.cmml" xref="A1.E21.m1.6.6.1.2"></times><apply id="A1.E21.m1.6.6.1.3.cmml" xref="A1.E21.m1.6.6.1.3"><csymbol cd="ambiguous" id="A1.E21.m1.6.6.1.3.1.cmml" xref="A1.E21.m1.6.6.1.3">subscript</csymbol><ci id="A1.E21.m1.6.6.1.3.2.cmml" xref="A1.E21.m1.6.6.1.3.2">𝜋</ci><ci id="A1.E21.m1.6.6.1.3.3.cmml" xref="A1.E21.m1.6.6.1.3.3">𝜃</ci></apply><apply id="A1.E21.m1.6.6.1.1.1.1.cmml" xref="A1.E21.m1.6.6.1.1.1"><csymbol cd="latexml" id="A1.E21.m1.6.6.1.1.1.1.1.cmml" xref="A1.E21.m1.6.6.1.1.1.1.1">conditional</csymbol><apply id="A1.E21.m1.6.6.1.1.1.1.2.cmml" xref="A1.E21.m1.6.6.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.E21.m1.6.6.1.1.1.1.2.1.cmml" xref="A1.E21.m1.6.6.1.1.1.1.2">subscript</csymbol><ci id="A1.E21.m1.6.6.1.1.1.1.2.2.cmml" xref="A1.E21.m1.6.6.1.1.1.1.2.2">𝑦</ci><ci id="A1.E21.m1.6.6.1.1.1.1.2.3.cmml" xref="A1.E21.m1.6.6.1.1.1.1.2.3">𝑤</ci></apply><ci id="A1.E21.m1.6.6.1.1.1.1.3.cmml" xref="A1.E21.m1.6.6.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.E21.m1.7.7.2.cmml" xref="A1.E21.m1.7.7.2"><times id="A1.E21.m1.7.7.2.2.cmml" xref="A1.E21.m1.7.7.2.2"></times><apply id="A1.E21.m1.7.7.2.3.cmml" xref="A1.E21.m1.7.7.2.3"><csymbol cd="ambiguous" id="A1.E21.m1.7.7.2.3.1.cmml" xref="A1.E21.m1.7.7.2.3">subscript</csymbol><ci id="A1.E21.m1.7.7.2.3.2.cmml" xref="A1.E21.m1.7.7.2.3.2">𝜋</ci><ci id="A1.E21.m1.7.7.2.3.3a.cmml" xref="A1.E21.m1.7.7.2.3.3"><mtext id="A1.E21.m1.7.7.2.3.3.cmml" mathsize="70%" xref="A1.E21.m1.7.7.2.3.3">ref</mtext></ci></apply><apply id="A1.E21.m1.7.7.2.1.1.1.cmml" xref="A1.E21.m1.7.7.2.1.1"><csymbol cd="latexml" id="A1.E21.m1.7.7.2.1.1.1.1.cmml" xref="A1.E21.m1.7.7.2.1.1.1.1">conditional</csymbol><apply id="A1.E21.m1.7.7.2.1.1.1.2.cmml" xref="A1.E21.m1.7.7.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.E21.m1.7.7.2.1.1.1.2.1.cmml" xref="A1.E21.m1.7.7.2.1.1.1.2">subscript</csymbol><ci id="A1.E21.m1.7.7.2.1.1.1.2.2.cmml" xref="A1.E21.m1.7.7.2.1.1.1.2.2">𝑦</ci><ci id="A1.E21.m1.7.7.2.1.1.1.2.3.cmml" xref="A1.E21.m1.7.7.2.1.1.1.2.3">𝑤</ci></apply><ci id="A1.E21.m1.7.7.2.1.1.1.3.cmml" xref="A1.E21.m1.7.7.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E21.m1.10c">\displaystyle\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{%
ref}})=-\nabla_{\theta}\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\left[\log%
\sigma\left(\beta\log\frac{\pi_{\theta}(y_{l}|x)}{\pi_{\text{ref}}(y_{l}|x)}-%
\beta\log\frac{\pi_{\theta}(y_{w}|x)}{\pi_{\text{ref}}(y_{w}|x)}\right)\right]</annotation><annotation encoding="application/x-llamapun" id="A1.E21.m1.10d">∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) = - ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT [ roman_log italic_σ ( italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x ) end_ARG ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(21)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS4.p2">
<p class="ltx_p" id="A1.SS4.p2.2">We can rewrite the RHS of Equation&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A1.E21" title="21 ‣ A.4 Deriving the Gradient of the DPO Objective ‣ Appendix A Mathematical Derivations ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">21</span></a> as</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx5">
<tbody id="A1.E22"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{%
ref}})=-\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\left[\frac{\sigma^{\prime}%
\left(u\right)}{\sigma\left(u\right)}\nabla_{\theta}\left(u\right)\right]," class="ltx_Math" display="inline" id="A1.E22.m1.7"><semantics id="A1.E22.m1.7a"><mrow id="A1.E22.m1.7.7.1" xref="A1.E22.m1.7.7.1.1.cmml"><mrow id="A1.E22.m1.7.7.1.1" xref="A1.E22.m1.7.7.1.1.cmml"><mrow id="A1.E22.m1.7.7.1.1.2" xref="A1.E22.m1.7.7.1.1.2.cmml"><mrow id="A1.E22.m1.7.7.1.1.2.4" xref="A1.E22.m1.7.7.1.1.2.4.cmml"><msub id="A1.E22.m1.7.7.1.1.2.4.1" xref="A1.E22.m1.7.7.1.1.2.4.1.cmml"><mo id="A1.E22.m1.7.7.1.1.2.4.1.2" xref="A1.E22.m1.7.7.1.1.2.4.1.2.cmml">∇</mo><mi id="A1.E22.m1.7.7.1.1.2.4.1.3" xref="A1.E22.m1.7.7.1.1.2.4.1.3.cmml">θ</mi></msub><msub id="A1.E22.m1.7.7.1.1.2.4.2" xref="A1.E22.m1.7.7.1.1.2.4.2.cmml"><mi class="ltx_font_mathcaligraphic" id="A1.E22.m1.7.7.1.1.2.4.2.2" xref="A1.E22.m1.7.7.1.1.2.4.2.2.cmml">ℒ</mi><mtext id="A1.E22.m1.7.7.1.1.2.4.2.3" xref="A1.E22.m1.7.7.1.1.2.4.2.3a.cmml">DPO</mtext></msub></mrow><mo id="A1.E22.m1.7.7.1.1.2.3" xref="A1.E22.m1.7.7.1.1.2.3.cmml">⁢</mo><mrow id="A1.E22.m1.7.7.1.1.2.2.2" xref="A1.E22.m1.7.7.1.1.2.2.3.cmml"><mo id="A1.E22.m1.7.7.1.1.2.2.2.3" stretchy="false" xref="A1.E22.m1.7.7.1.1.2.2.3.cmml">(</mo><msub id="A1.E22.m1.7.7.1.1.1.1.1.1" xref="A1.E22.m1.7.7.1.1.1.1.1.1.cmml"><mi id="A1.E22.m1.7.7.1.1.1.1.1.1.2" xref="A1.E22.m1.7.7.1.1.1.1.1.1.2.cmml">π</mi><mi id="A1.E22.m1.7.7.1.1.1.1.1.1.3" xref="A1.E22.m1.7.7.1.1.1.1.1.1.3.cmml">θ</mi></msub><mo id="A1.E22.m1.7.7.1.1.2.2.2.4" xref="A1.E22.m1.7.7.1.1.2.2.3.cmml">;</mo><msub id="A1.E22.m1.7.7.1.1.2.2.2.2" xref="A1.E22.m1.7.7.1.1.2.2.2.2.cmml"><mi id="A1.E22.m1.7.7.1.1.2.2.2.2.2" xref="A1.E22.m1.7.7.1.1.2.2.2.2.2.cmml">π</mi><mtext id="A1.E22.m1.7.7.1.1.2.2.2.2.3" xref="A1.E22.m1.7.7.1.1.2.2.2.2.3a.cmml">ref</mtext></msub><mo id="A1.E22.m1.7.7.1.1.2.2.2.5" stretchy="false" xref="A1.E22.m1.7.7.1.1.2.2.3.cmml">)</mo></mrow></mrow><mo id="A1.E22.m1.7.7.1.1.4" xref="A1.E22.m1.7.7.1.1.4.cmml">=</mo><mrow id="A1.E22.m1.7.7.1.1.3" xref="A1.E22.m1.7.7.1.1.3.cmml"><mo id="A1.E22.m1.7.7.1.1.3a" xref="A1.E22.m1.7.7.1.1.3.cmml">−</mo><mrow id="A1.E22.m1.7.7.1.1.3.1" xref="A1.E22.m1.7.7.1.1.3.1.cmml"><msub id="A1.E22.m1.7.7.1.1.3.1.3" xref="A1.E22.m1.7.7.1.1.3.1.3.cmml"><mi id="A1.E22.m1.7.7.1.1.3.1.3.2" xref="A1.E22.m1.7.7.1.1.3.1.3.2.cmml">𝔼</mi><mrow id="A1.E22.m1.3.3.3" xref="A1.E22.m1.3.3.3.cmml"><mrow id="A1.E22.m1.3.3.3.3.2" xref="A1.E22.m1.3.3.3.3.3.cmml"><mo id="A1.E22.m1.3.3.3.3.2.3" stretchy="false" xref="A1.E22.m1.3.3.3.3.3.cmml">(</mo><mi id="A1.E22.m1.1.1.1.1" xref="A1.E22.m1.1.1.1.1.cmml">x</mi><mo id="A1.E22.m1.3.3.3.3.2.4" xref="A1.E22.m1.3.3.3.3.3.cmml">,</mo><msub id="A1.E22.m1.2.2.2.2.1.1" xref="A1.E22.m1.2.2.2.2.1.1.cmml"><mi id="A1.E22.m1.2.2.2.2.1.1.2" xref="A1.E22.m1.2.2.2.2.1.1.2.cmml">y</mi><mi id="A1.E22.m1.2.2.2.2.1.1.3" xref="A1.E22.m1.2.2.2.2.1.1.3.cmml">w</mi></msub><mo id="A1.E22.m1.3.3.3.3.2.5" xref="A1.E22.m1.3.3.3.3.3.cmml">,</mo><msub id="A1.E22.m1.3.3.3.3.2.2" xref="A1.E22.m1.3.3.3.3.2.2.cmml"><mi id="A1.E22.m1.3.3.3.3.2.2.2" xref="A1.E22.m1.3.3.3.3.2.2.2.cmml">y</mi><mi id="A1.E22.m1.3.3.3.3.2.2.3" xref="A1.E22.m1.3.3.3.3.2.2.3.cmml">l</mi></msub><mo id="A1.E22.m1.3.3.3.3.2.6" stretchy="false" xref="A1.E22.m1.3.3.3.3.3.cmml">)</mo></mrow><mo id="A1.E22.m1.3.3.3.4" xref="A1.E22.m1.3.3.3.4.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.E22.m1.3.3.3.5" xref="A1.E22.m1.3.3.3.5.cmml">𝒟</mi></mrow></msub><mo id="A1.E22.m1.7.7.1.1.3.1.2" xref="A1.E22.m1.7.7.1.1.3.1.2.cmml">⁢</mo><mrow id="A1.E22.m1.7.7.1.1.3.1.1.1" xref="A1.E22.m1.7.7.1.1.3.1.1.2.cmml"><mo id="A1.E22.m1.7.7.1.1.3.1.1.1.2" xref="A1.E22.m1.7.7.1.1.3.1.1.2.1.cmml">[</mo><mrow id="A1.E22.m1.7.7.1.1.3.1.1.1.1" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.cmml"><mstyle displaystyle="true" id="A1.E22.m1.5.5" xref="A1.E22.m1.5.5.cmml"><mfrac id="A1.E22.m1.5.5a" xref="A1.E22.m1.5.5.cmml"><mrow id="A1.E22.m1.4.4.1" xref="A1.E22.m1.4.4.1.cmml"><msup id="A1.E22.m1.4.4.1.3" xref="A1.E22.m1.4.4.1.3.cmml"><mi id="A1.E22.m1.4.4.1.3.2" xref="A1.E22.m1.4.4.1.3.2.cmml">σ</mi><mo id="A1.E22.m1.4.4.1.3.3" xref="A1.E22.m1.4.4.1.3.3.cmml">′</mo></msup><mo id="A1.E22.m1.4.4.1.2" xref="A1.E22.m1.4.4.1.2.cmml">⁢</mo><mrow id="A1.E22.m1.4.4.1.4.2" xref="A1.E22.m1.4.4.1.cmml"><mo id="A1.E22.m1.4.4.1.4.2.1" xref="A1.E22.m1.4.4.1.cmml">(</mo><mi id="A1.E22.m1.4.4.1.1" xref="A1.E22.m1.4.4.1.1.cmml">u</mi><mo id="A1.E22.m1.4.4.1.4.2.2" xref="A1.E22.m1.4.4.1.cmml">)</mo></mrow></mrow><mrow id="A1.E22.m1.5.5.2" xref="A1.E22.m1.5.5.2.cmml"><mi id="A1.E22.m1.5.5.2.3" xref="A1.E22.m1.5.5.2.3.cmml">σ</mi><mo id="A1.E22.m1.5.5.2.2" xref="A1.E22.m1.5.5.2.2.cmml">⁢</mo><mrow id="A1.E22.m1.5.5.2.4.2" xref="A1.E22.m1.5.5.2.cmml"><mo id="A1.E22.m1.5.5.2.4.2.1" xref="A1.E22.m1.5.5.2.cmml">(</mo><mi id="A1.E22.m1.5.5.2.1" xref="A1.E22.m1.5.5.2.1.cmml">u</mi><mo id="A1.E22.m1.5.5.2.4.2.2" xref="A1.E22.m1.5.5.2.cmml">)</mo></mrow></mrow></mfrac></mstyle><mo id="A1.E22.m1.7.7.1.1.3.1.1.1.1.2" lspace="0.167em" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.2.cmml"><msub id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.cmml"><mo id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.2" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.2.cmml">∇</mo><mi id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.3" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.3.cmml">θ</mi></msub><mrow id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.2" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.2.cmml"><mo id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.2.1" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.2.cmml">(</mo><mi id="A1.E22.m1.6.6" xref="A1.E22.m1.6.6.cmml">u</mi><mo id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.2.2" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="A1.E22.m1.7.7.1.1.3.1.1.1.3" xref="A1.E22.m1.7.7.1.1.3.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><mo id="A1.E22.m1.7.7.1.2" xref="A1.E22.m1.7.7.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.E22.m1.7b"><apply id="A1.E22.m1.7.7.1.1.cmml" xref="A1.E22.m1.7.7.1"><eq id="A1.E22.m1.7.7.1.1.4.cmml" xref="A1.E22.m1.7.7.1.1.4"></eq><apply id="A1.E22.m1.7.7.1.1.2.cmml" xref="A1.E22.m1.7.7.1.1.2"><times id="A1.E22.m1.7.7.1.1.2.3.cmml" xref="A1.E22.m1.7.7.1.1.2.3"></times><apply id="A1.E22.m1.7.7.1.1.2.4.cmml" xref="A1.E22.m1.7.7.1.1.2.4"><apply id="A1.E22.m1.7.7.1.1.2.4.1.cmml" xref="A1.E22.m1.7.7.1.1.2.4.1"><csymbol cd="ambiguous" id="A1.E22.m1.7.7.1.1.2.4.1.1.cmml" xref="A1.E22.m1.7.7.1.1.2.4.1">subscript</csymbol><ci id="A1.E22.m1.7.7.1.1.2.4.1.2.cmml" xref="A1.E22.m1.7.7.1.1.2.4.1.2">∇</ci><ci id="A1.E22.m1.7.7.1.1.2.4.1.3.cmml" xref="A1.E22.m1.7.7.1.1.2.4.1.3">𝜃</ci></apply><apply id="A1.E22.m1.7.7.1.1.2.4.2.cmml" xref="A1.E22.m1.7.7.1.1.2.4.2"><csymbol cd="ambiguous" id="A1.E22.m1.7.7.1.1.2.4.2.1.cmml" xref="A1.E22.m1.7.7.1.1.2.4.2">subscript</csymbol><ci id="A1.E22.m1.7.7.1.1.2.4.2.2.cmml" xref="A1.E22.m1.7.7.1.1.2.4.2.2">ℒ</ci><ci id="A1.E22.m1.7.7.1.1.2.4.2.3a.cmml" xref="A1.E22.m1.7.7.1.1.2.4.2.3"><mtext id="A1.E22.m1.7.7.1.1.2.4.2.3.cmml" mathsize="70%" xref="A1.E22.m1.7.7.1.1.2.4.2.3">DPO</mtext></ci></apply></apply><list id="A1.E22.m1.7.7.1.1.2.2.3.cmml" xref="A1.E22.m1.7.7.1.1.2.2.2"><apply id="A1.E22.m1.7.7.1.1.1.1.1.1.cmml" xref="A1.E22.m1.7.7.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E22.m1.7.7.1.1.1.1.1.1.1.cmml" xref="A1.E22.m1.7.7.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E22.m1.7.7.1.1.1.1.1.1.2.cmml" xref="A1.E22.m1.7.7.1.1.1.1.1.1.2">𝜋</ci><ci id="A1.E22.m1.7.7.1.1.1.1.1.1.3.cmml" xref="A1.E22.m1.7.7.1.1.1.1.1.1.3">𝜃</ci></apply><apply id="A1.E22.m1.7.7.1.1.2.2.2.2.cmml" xref="A1.E22.m1.7.7.1.1.2.2.2.2"><csymbol cd="ambiguous" id="A1.E22.m1.7.7.1.1.2.2.2.2.1.cmml" xref="A1.E22.m1.7.7.1.1.2.2.2.2">subscript</csymbol><ci id="A1.E22.m1.7.7.1.1.2.2.2.2.2.cmml" xref="A1.E22.m1.7.7.1.1.2.2.2.2.2">𝜋</ci><ci id="A1.E22.m1.7.7.1.1.2.2.2.2.3a.cmml" xref="A1.E22.m1.7.7.1.1.2.2.2.2.3"><mtext id="A1.E22.m1.7.7.1.1.2.2.2.2.3.cmml" mathsize="70%" xref="A1.E22.m1.7.7.1.1.2.2.2.2.3">ref</mtext></ci></apply></list></apply><apply id="A1.E22.m1.7.7.1.1.3.cmml" xref="A1.E22.m1.7.7.1.1.3"><minus id="A1.E22.m1.7.7.1.1.3.2.cmml" xref="A1.E22.m1.7.7.1.1.3"></minus><apply id="A1.E22.m1.7.7.1.1.3.1.cmml" xref="A1.E22.m1.7.7.1.1.3.1"><times id="A1.E22.m1.7.7.1.1.3.1.2.cmml" xref="A1.E22.m1.7.7.1.1.3.1.2"></times><apply id="A1.E22.m1.7.7.1.1.3.1.3.cmml" xref="A1.E22.m1.7.7.1.1.3.1.3"><csymbol cd="ambiguous" id="A1.E22.m1.7.7.1.1.3.1.3.1.cmml" xref="A1.E22.m1.7.7.1.1.3.1.3">subscript</csymbol><ci id="A1.E22.m1.7.7.1.1.3.1.3.2.cmml" xref="A1.E22.m1.7.7.1.1.3.1.3.2">𝔼</ci><apply id="A1.E22.m1.3.3.3.cmml" xref="A1.E22.m1.3.3.3"><csymbol cd="latexml" id="A1.E22.m1.3.3.3.4.cmml" xref="A1.E22.m1.3.3.3.4">similar-to</csymbol><vector id="A1.E22.m1.3.3.3.3.3.cmml" xref="A1.E22.m1.3.3.3.3.2"><ci id="A1.E22.m1.1.1.1.1.cmml" xref="A1.E22.m1.1.1.1.1">𝑥</ci><apply id="A1.E22.m1.2.2.2.2.1.1.cmml" xref="A1.E22.m1.2.2.2.2.1.1"><csymbol cd="ambiguous" id="A1.E22.m1.2.2.2.2.1.1.1.cmml" xref="A1.E22.m1.2.2.2.2.1.1">subscript</csymbol><ci id="A1.E22.m1.2.2.2.2.1.1.2.cmml" xref="A1.E22.m1.2.2.2.2.1.1.2">𝑦</ci><ci id="A1.E22.m1.2.2.2.2.1.1.3.cmml" xref="A1.E22.m1.2.2.2.2.1.1.3">𝑤</ci></apply><apply id="A1.E22.m1.3.3.3.3.2.2.cmml" xref="A1.E22.m1.3.3.3.3.2.2"><csymbol cd="ambiguous" id="A1.E22.m1.3.3.3.3.2.2.1.cmml" xref="A1.E22.m1.3.3.3.3.2.2">subscript</csymbol><ci id="A1.E22.m1.3.3.3.3.2.2.2.cmml" xref="A1.E22.m1.3.3.3.3.2.2.2">𝑦</ci><ci id="A1.E22.m1.3.3.3.3.2.2.3.cmml" xref="A1.E22.m1.3.3.3.3.2.2.3">𝑙</ci></apply></vector><ci id="A1.E22.m1.3.3.3.5.cmml" xref="A1.E22.m1.3.3.3.5">𝒟</ci></apply></apply><apply id="A1.E22.m1.7.7.1.1.3.1.1.2.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1"><csymbol cd="latexml" id="A1.E22.m1.7.7.1.1.3.1.1.2.1.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.2">delimited-[]</csymbol><apply id="A1.E22.m1.7.7.1.1.3.1.1.1.1.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1"><times id="A1.E22.m1.7.7.1.1.3.1.1.1.1.2.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.2"></times><apply id="A1.E22.m1.5.5.cmml" xref="A1.E22.m1.5.5"><divide id="A1.E22.m1.5.5.3.cmml" xref="A1.E22.m1.5.5"></divide><apply id="A1.E22.m1.4.4.1.cmml" xref="A1.E22.m1.4.4.1"><times id="A1.E22.m1.4.4.1.2.cmml" xref="A1.E22.m1.4.4.1.2"></times><apply id="A1.E22.m1.4.4.1.3.cmml" xref="A1.E22.m1.4.4.1.3"><csymbol cd="ambiguous" id="A1.E22.m1.4.4.1.3.1.cmml" xref="A1.E22.m1.4.4.1.3">superscript</csymbol><ci id="A1.E22.m1.4.4.1.3.2.cmml" xref="A1.E22.m1.4.4.1.3.2">𝜎</ci><ci id="A1.E22.m1.4.4.1.3.3.cmml" xref="A1.E22.m1.4.4.1.3.3">′</ci></apply><ci id="A1.E22.m1.4.4.1.1.cmml" xref="A1.E22.m1.4.4.1.1">𝑢</ci></apply><apply id="A1.E22.m1.5.5.2.cmml" xref="A1.E22.m1.5.5.2"><times id="A1.E22.m1.5.5.2.2.cmml" xref="A1.E22.m1.5.5.2.2"></times><ci id="A1.E22.m1.5.5.2.3.cmml" xref="A1.E22.m1.5.5.2.3">𝜎</ci><ci id="A1.E22.m1.5.5.2.1.cmml" xref="A1.E22.m1.5.5.2.1">𝑢</ci></apply></apply><apply id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.2.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1"><apply id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.1.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.2.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.2">∇</ci><ci id="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.3.cmml" xref="A1.E22.m1.7.7.1.1.3.1.1.1.1.1.1.1.3">𝜃</ci></apply><ci id="A1.E22.m1.6.6.cmml" xref="A1.E22.m1.6.6">𝑢</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E22.m1.7c">\displaystyle\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{%
ref}})=-\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\left[\frac{\sigma^{\prime}%
\left(u\right)}{\sigma\left(u\right)}\nabla_{\theta}\left(u\right)\right],</annotation><annotation encoding="application/x-llamapun" id="A1.E22.m1.7d">∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) = - blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT [ divide start_ARG italic_σ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_u ) end_ARG start_ARG italic_σ ( italic_u ) end_ARG ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_u ) ] ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(22)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS4.p2.1">where <math alttext="u=\beta\log\frac{\pi_{\theta}(y_{l}|x)}{\pi_{\text{ref}}(y_{l}|x)}-\beta\log%
\frac{\pi_{\theta}(y_{w}|x)}{\pi_{\text{ref}}(y_{w}|x)}" class="ltx_Math" display="inline" id="A1.SS4.p2.1.m1.4"><semantics id="A1.SS4.p2.1.m1.4a"><mrow id="A1.SS4.p2.1.m1.4.5" xref="A1.SS4.p2.1.m1.4.5.cmml"><mi id="A1.SS4.p2.1.m1.4.5.2" xref="A1.SS4.p2.1.m1.4.5.2.cmml">u</mi><mo id="A1.SS4.p2.1.m1.4.5.1" xref="A1.SS4.p2.1.m1.4.5.1.cmml">=</mo><mrow id="A1.SS4.p2.1.m1.4.5.3" xref="A1.SS4.p2.1.m1.4.5.3.cmml"><mrow id="A1.SS4.p2.1.m1.4.5.3.2" xref="A1.SS4.p2.1.m1.4.5.3.2.cmml"><mi id="A1.SS4.p2.1.m1.4.5.3.2.2" xref="A1.SS4.p2.1.m1.4.5.3.2.2.cmml">β</mi><mo id="A1.SS4.p2.1.m1.4.5.3.2.1" lspace="0.167em" xref="A1.SS4.p2.1.m1.4.5.3.2.1.cmml">⁢</mo><mrow id="A1.SS4.p2.1.m1.4.5.3.2.3" xref="A1.SS4.p2.1.m1.4.5.3.2.3.cmml"><mi id="A1.SS4.p2.1.m1.4.5.3.2.3.1" xref="A1.SS4.p2.1.m1.4.5.3.2.3.1.cmml">log</mi><mo id="A1.SS4.p2.1.m1.4.5.3.2.3a" lspace="0.167em" xref="A1.SS4.p2.1.m1.4.5.3.2.3.cmml">⁡</mo><mfrac id="A1.SS4.p2.1.m1.2.2" xref="A1.SS4.p2.1.m1.2.2.cmml"><mrow id="A1.SS4.p2.1.m1.1.1.1" xref="A1.SS4.p2.1.m1.1.1.1.cmml"><msub id="A1.SS4.p2.1.m1.1.1.1.3" xref="A1.SS4.p2.1.m1.1.1.1.3.cmml"><mi id="A1.SS4.p2.1.m1.1.1.1.3.2" xref="A1.SS4.p2.1.m1.1.1.1.3.2.cmml">π</mi><mi id="A1.SS4.p2.1.m1.1.1.1.3.3" xref="A1.SS4.p2.1.m1.1.1.1.3.3.cmml">θ</mi></msub><mo id="A1.SS4.p2.1.m1.1.1.1.2" xref="A1.SS4.p2.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS4.p2.1.m1.1.1.1.1.1" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.cmml"><mo id="A1.SS4.p2.1.m1.1.1.1.1.1.2" stretchy="false" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p2.1.m1.1.1.1.1.1.1" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.cmml"><msub id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.cmml"><mi id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.2" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.3" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A1.SS4.p2.1.m1.1.1.1.1.1.1.1" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p2.1.m1.1.1.1.1.1.1.3" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p2.1.m1.1.1.1.1.1.3" stretchy="false" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS4.p2.1.m1.2.2.2" xref="A1.SS4.p2.1.m1.2.2.2.cmml"><msub id="A1.SS4.p2.1.m1.2.2.2.3" xref="A1.SS4.p2.1.m1.2.2.2.3.cmml"><mi id="A1.SS4.p2.1.m1.2.2.2.3.2" xref="A1.SS4.p2.1.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.SS4.p2.1.m1.2.2.2.3.3" xref="A1.SS4.p2.1.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS4.p2.1.m1.2.2.2.2" xref="A1.SS4.p2.1.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.SS4.p2.1.m1.2.2.2.1.1" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.cmml"><mo id="A1.SS4.p2.1.m1.2.2.2.1.1.2" stretchy="false" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.SS4.p2.1.m1.2.2.2.1.1.1" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.cmml"><msub id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.cmml"><mi id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.2" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.3" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A1.SS4.p2.1.m1.2.2.2.1.1.1.1" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p2.1.m1.2.2.2.1.1.1.3" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p2.1.m1.2.2.2.1.1.3" stretchy="false" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.SS4.p2.1.m1.4.5.3.1" xref="A1.SS4.p2.1.m1.4.5.3.1.cmml">−</mo><mrow id="A1.SS4.p2.1.m1.4.5.3.3" xref="A1.SS4.p2.1.m1.4.5.3.3.cmml"><mi id="A1.SS4.p2.1.m1.4.5.3.3.2" xref="A1.SS4.p2.1.m1.4.5.3.3.2.cmml">β</mi><mo id="A1.SS4.p2.1.m1.4.5.3.3.1" lspace="0.167em" xref="A1.SS4.p2.1.m1.4.5.3.3.1.cmml">⁢</mo><mrow id="A1.SS4.p2.1.m1.4.5.3.3.3" xref="A1.SS4.p2.1.m1.4.5.3.3.3.cmml"><mi id="A1.SS4.p2.1.m1.4.5.3.3.3.1" xref="A1.SS4.p2.1.m1.4.5.3.3.3.1.cmml">log</mi><mo id="A1.SS4.p2.1.m1.4.5.3.3.3a" lspace="0.167em" xref="A1.SS4.p2.1.m1.4.5.3.3.3.cmml">⁡</mo><mfrac id="A1.SS4.p2.1.m1.4.4" xref="A1.SS4.p2.1.m1.4.4.cmml"><mrow id="A1.SS4.p2.1.m1.3.3.1" xref="A1.SS4.p2.1.m1.3.3.1.cmml"><msub id="A1.SS4.p2.1.m1.3.3.1.3" xref="A1.SS4.p2.1.m1.3.3.1.3.cmml"><mi id="A1.SS4.p2.1.m1.3.3.1.3.2" xref="A1.SS4.p2.1.m1.3.3.1.3.2.cmml">π</mi><mi id="A1.SS4.p2.1.m1.3.3.1.3.3" xref="A1.SS4.p2.1.m1.3.3.1.3.3.cmml">θ</mi></msub><mo id="A1.SS4.p2.1.m1.3.3.1.2" xref="A1.SS4.p2.1.m1.3.3.1.2.cmml">⁢</mo><mrow id="A1.SS4.p2.1.m1.3.3.1.1.1" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.cmml"><mo id="A1.SS4.p2.1.m1.3.3.1.1.1.2" stretchy="false" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p2.1.m1.3.3.1.1.1.1" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.cmml"><msub id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.cmml"><mi id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.2" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.3" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A1.SS4.p2.1.m1.3.3.1.1.1.1.1" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p2.1.m1.3.3.1.1.1.1.3" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p2.1.m1.3.3.1.1.1.3" stretchy="false" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS4.p2.1.m1.4.4.2" xref="A1.SS4.p2.1.m1.4.4.2.cmml"><msub id="A1.SS4.p2.1.m1.4.4.2.3" xref="A1.SS4.p2.1.m1.4.4.2.3.cmml"><mi id="A1.SS4.p2.1.m1.4.4.2.3.2" xref="A1.SS4.p2.1.m1.4.4.2.3.2.cmml">π</mi><mtext id="A1.SS4.p2.1.m1.4.4.2.3.3" xref="A1.SS4.p2.1.m1.4.4.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS4.p2.1.m1.4.4.2.2" xref="A1.SS4.p2.1.m1.4.4.2.2.cmml">⁢</mo><mrow id="A1.SS4.p2.1.m1.4.4.2.1.1" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.cmml"><mo id="A1.SS4.p2.1.m1.4.4.2.1.1.2" stretchy="false" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.cmml">(</mo><mrow id="A1.SS4.p2.1.m1.4.4.2.1.1.1" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.cmml"><msub id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.cmml"><mi id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.2" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.3" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A1.SS4.p2.1.m1.4.4.2.1.1.1.1" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p2.1.m1.4.4.2.1.1.1.3" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p2.1.m1.4.4.2.1.1.3" stretchy="false" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS4.p2.1.m1.4b"><apply id="A1.SS4.p2.1.m1.4.5.cmml" xref="A1.SS4.p2.1.m1.4.5"><eq id="A1.SS4.p2.1.m1.4.5.1.cmml" xref="A1.SS4.p2.1.m1.4.5.1"></eq><ci id="A1.SS4.p2.1.m1.4.5.2.cmml" xref="A1.SS4.p2.1.m1.4.5.2">𝑢</ci><apply id="A1.SS4.p2.1.m1.4.5.3.cmml" xref="A1.SS4.p2.1.m1.4.5.3"><minus id="A1.SS4.p2.1.m1.4.5.3.1.cmml" xref="A1.SS4.p2.1.m1.4.5.3.1"></minus><apply id="A1.SS4.p2.1.m1.4.5.3.2.cmml" xref="A1.SS4.p2.1.m1.4.5.3.2"><times id="A1.SS4.p2.1.m1.4.5.3.2.1.cmml" xref="A1.SS4.p2.1.m1.4.5.3.2.1"></times><ci id="A1.SS4.p2.1.m1.4.5.3.2.2.cmml" xref="A1.SS4.p2.1.m1.4.5.3.2.2">𝛽</ci><apply id="A1.SS4.p2.1.m1.4.5.3.2.3.cmml" xref="A1.SS4.p2.1.m1.4.5.3.2.3"><log id="A1.SS4.p2.1.m1.4.5.3.2.3.1.cmml" xref="A1.SS4.p2.1.m1.4.5.3.2.3.1"></log><apply id="A1.SS4.p2.1.m1.2.2.cmml" xref="A1.SS4.p2.1.m1.2.2"><divide id="A1.SS4.p2.1.m1.2.2.3.cmml" xref="A1.SS4.p2.1.m1.2.2"></divide><apply id="A1.SS4.p2.1.m1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.1.1.1"><times id="A1.SS4.p2.1.m1.1.1.1.2.cmml" xref="A1.SS4.p2.1.m1.1.1.1.2"></times><apply id="A1.SS4.p2.1.m1.1.1.1.3.cmml" xref="A1.SS4.p2.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.1.1.1.3.1.cmml" xref="A1.SS4.p2.1.m1.1.1.1.3">subscript</csymbol><ci id="A1.SS4.p2.1.m1.1.1.1.3.2.cmml" xref="A1.SS4.p2.1.m1.1.1.1.3.2">𝜋</ci><ci id="A1.SS4.p2.1.m1.1.1.1.3.3.cmml" xref="A1.SS4.p2.1.m1.1.1.1.3.3">𝜃</ci></apply><apply id="A1.SS4.p2.1.m1.1.1.1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS4.p2.1.m1.1.1.1.1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.1.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.2.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.3.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="A1.SS4.p2.1.m1.1.1.1.1.1.1.3.cmml" xref="A1.SS4.p2.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS4.p2.1.m1.2.2.2.cmml" xref="A1.SS4.p2.1.m1.2.2.2"><times id="A1.SS4.p2.1.m1.2.2.2.2.cmml" xref="A1.SS4.p2.1.m1.2.2.2.2"></times><apply id="A1.SS4.p2.1.m1.2.2.2.3.cmml" xref="A1.SS4.p2.1.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.2.2.2.3.1.cmml" xref="A1.SS4.p2.1.m1.2.2.2.3">subscript</csymbol><ci id="A1.SS4.p2.1.m1.2.2.2.3.2.cmml" xref="A1.SS4.p2.1.m1.2.2.2.3.2">𝜋</ci><ci id="A1.SS4.p2.1.m1.2.2.2.3.3a.cmml" xref="A1.SS4.p2.1.m1.2.2.2.3.3"><mtext id="A1.SS4.p2.1.m1.2.2.2.3.3.cmml" mathsize="50%" xref="A1.SS4.p2.1.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.SS4.p2.1.m1.2.2.2.1.1.1.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.SS4.p2.1.m1.2.2.2.1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.1.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.2.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.3.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.2.3">𝑙</ci></apply><ci id="A1.SS4.p2.1.m1.2.2.2.1.1.1.3.cmml" xref="A1.SS4.p2.1.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.SS4.p2.1.m1.4.5.3.3.cmml" xref="A1.SS4.p2.1.m1.4.5.3.3"><times id="A1.SS4.p2.1.m1.4.5.3.3.1.cmml" xref="A1.SS4.p2.1.m1.4.5.3.3.1"></times><ci id="A1.SS4.p2.1.m1.4.5.3.3.2.cmml" xref="A1.SS4.p2.1.m1.4.5.3.3.2">𝛽</ci><apply id="A1.SS4.p2.1.m1.4.5.3.3.3.cmml" xref="A1.SS4.p2.1.m1.4.5.3.3.3"><log id="A1.SS4.p2.1.m1.4.5.3.3.3.1.cmml" xref="A1.SS4.p2.1.m1.4.5.3.3.3.1"></log><apply id="A1.SS4.p2.1.m1.4.4.cmml" xref="A1.SS4.p2.1.m1.4.4"><divide id="A1.SS4.p2.1.m1.4.4.3.cmml" xref="A1.SS4.p2.1.m1.4.4"></divide><apply id="A1.SS4.p2.1.m1.3.3.1.cmml" xref="A1.SS4.p2.1.m1.3.3.1"><times id="A1.SS4.p2.1.m1.3.3.1.2.cmml" xref="A1.SS4.p2.1.m1.3.3.1.2"></times><apply id="A1.SS4.p2.1.m1.3.3.1.3.cmml" xref="A1.SS4.p2.1.m1.3.3.1.3"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.3.3.1.3.1.cmml" xref="A1.SS4.p2.1.m1.3.3.1.3">subscript</csymbol><ci id="A1.SS4.p2.1.m1.3.3.1.3.2.cmml" xref="A1.SS4.p2.1.m1.3.3.1.3.2">𝜋</ci><ci id="A1.SS4.p2.1.m1.3.3.1.3.3.cmml" xref="A1.SS4.p2.1.m1.3.3.1.3.3">𝜃</ci></apply><apply id="A1.SS4.p2.1.m1.3.3.1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1"><csymbol cd="latexml" id="A1.SS4.p2.1.m1.3.3.1.1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.1.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.2.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.3.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.2.3">𝑤</ci></apply><ci id="A1.SS4.p2.1.m1.3.3.1.1.1.1.3.cmml" xref="A1.SS4.p2.1.m1.3.3.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS4.p2.1.m1.4.4.2.cmml" xref="A1.SS4.p2.1.m1.4.4.2"><times id="A1.SS4.p2.1.m1.4.4.2.2.cmml" xref="A1.SS4.p2.1.m1.4.4.2.2"></times><apply id="A1.SS4.p2.1.m1.4.4.2.3.cmml" xref="A1.SS4.p2.1.m1.4.4.2.3"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.4.4.2.3.1.cmml" xref="A1.SS4.p2.1.m1.4.4.2.3">subscript</csymbol><ci id="A1.SS4.p2.1.m1.4.4.2.3.2.cmml" xref="A1.SS4.p2.1.m1.4.4.2.3.2">𝜋</ci><ci id="A1.SS4.p2.1.m1.4.4.2.3.3a.cmml" xref="A1.SS4.p2.1.m1.4.4.2.3.3"><mtext id="A1.SS4.p2.1.m1.4.4.2.3.3.cmml" mathsize="50%" xref="A1.SS4.p2.1.m1.4.4.2.3.3">ref</mtext></ci></apply><apply id="A1.SS4.p2.1.m1.4.4.2.1.1.1.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1"><csymbol cd="latexml" id="A1.SS4.p2.1.m1.4.4.2.1.1.1.1.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.1.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.2.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.3.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.2.3">𝑤</ci></apply><ci id="A1.SS4.p2.1.m1.4.4.2.1.1.1.3.cmml" xref="A1.SS4.p2.1.m1.4.4.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p2.1.m1.4c">u=\beta\log\frac{\pi_{\theta}(y_{l}|x)}{\pi_{\text{ref}}(y_{l}|x)}-\beta\log%
\frac{\pi_{\theta}(y_{w}|x)}{\pi_{\text{ref}}(y_{w}|x)}</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p2.1.m1.4d">italic_u = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x ) end_ARG</annotation></semantics></math>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="A1.SS4.p3">
<p class="ltx_p" id="A1.SS4.p3.2">Using the properties of sigmoid function <math alttext="\sigma^{\prime}(x)=\sigma(x)(1-\sigma(x))" class="ltx_Math" display="inline" id="A1.SS4.p3.1.m1.4"><semantics id="A1.SS4.p3.1.m1.4a"><mrow id="A1.SS4.p3.1.m1.4.4" xref="A1.SS4.p3.1.m1.4.4.cmml"><mrow id="A1.SS4.p3.1.m1.4.4.3" xref="A1.SS4.p3.1.m1.4.4.3.cmml"><msup id="A1.SS4.p3.1.m1.4.4.3.2" xref="A1.SS4.p3.1.m1.4.4.3.2.cmml"><mi id="A1.SS4.p3.1.m1.4.4.3.2.2" xref="A1.SS4.p3.1.m1.4.4.3.2.2.cmml">σ</mi><mo id="A1.SS4.p3.1.m1.4.4.3.2.3" xref="A1.SS4.p3.1.m1.4.4.3.2.3.cmml">′</mo></msup><mo id="A1.SS4.p3.1.m1.4.4.3.1" xref="A1.SS4.p3.1.m1.4.4.3.1.cmml">⁢</mo><mrow id="A1.SS4.p3.1.m1.4.4.3.3.2" xref="A1.SS4.p3.1.m1.4.4.3.cmml"><mo id="A1.SS4.p3.1.m1.4.4.3.3.2.1" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.3.cmml">(</mo><mi id="A1.SS4.p3.1.m1.1.1" xref="A1.SS4.p3.1.m1.1.1.cmml">x</mi><mo id="A1.SS4.p3.1.m1.4.4.3.3.2.2" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.3.cmml">)</mo></mrow></mrow><mo id="A1.SS4.p3.1.m1.4.4.2" xref="A1.SS4.p3.1.m1.4.4.2.cmml">=</mo><mrow id="A1.SS4.p3.1.m1.4.4.1" xref="A1.SS4.p3.1.m1.4.4.1.cmml"><mi id="A1.SS4.p3.1.m1.4.4.1.3" xref="A1.SS4.p3.1.m1.4.4.1.3.cmml">σ</mi><mo id="A1.SS4.p3.1.m1.4.4.1.2" xref="A1.SS4.p3.1.m1.4.4.1.2.cmml">⁢</mo><mrow id="A1.SS4.p3.1.m1.4.4.1.4.2" xref="A1.SS4.p3.1.m1.4.4.1.cmml"><mo id="A1.SS4.p3.1.m1.4.4.1.4.2.1" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.1.cmml">(</mo><mi id="A1.SS4.p3.1.m1.2.2" xref="A1.SS4.p3.1.m1.2.2.cmml">x</mi><mo id="A1.SS4.p3.1.m1.4.4.1.4.2.2" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.1.cmml">)</mo></mrow><mo id="A1.SS4.p3.1.m1.4.4.1.2a" xref="A1.SS4.p3.1.m1.4.4.1.2.cmml">⁢</mo><mrow id="A1.SS4.p3.1.m1.4.4.1.1.1" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.cmml"><mo id="A1.SS4.p3.1.m1.4.4.1.1.1.2" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.1.m1.4.4.1.1.1.1" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.cmml"><mn id="A1.SS4.p3.1.m1.4.4.1.1.1.1.2" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.2.cmml">1</mn><mo id="A1.SS4.p3.1.m1.4.4.1.1.1.1.1" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.1.cmml">−</mo><mrow id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.cmml"><mi id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.2" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.2.cmml">σ</mi><mo id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.1" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.3.2" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.cmml"><mo id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.3.2.1" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.cmml">(</mo><mi id="A1.SS4.p3.1.m1.3.3" xref="A1.SS4.p3.1.m1.3.3.cmml">x</mi><mo id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.3.2.2" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.SS4.p3.1.m1.4.4.1.1.1.3" stretchy="false" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS4.p3.1.m1.4b"><apply id="A1.SS4.p3.1.m1.4.4.cmml" xref="A1.SS4.p3.1.m1.4.4"><eq id="A1.SS4.p3.1.m1.4.4.2.cmml" xref="A1.SS4.p3.1.m1.4.4.2"></eq><apply id="A1.SS4.p3.1.m1.4.4.3.cmml" xref="A1.SS4.p3.1.m1.4.4.3"><times id="A1.SS4.p3.1.m1.4.4.3.1.cmml" xref="A1.SS4.p3.1.m1.4.4.3.1"></times><apply id="A1.SS4.p3.1.m1.4.4.3.2.cmml" xref="A1.SS4.p3.1.m1.4.4.3.2"><csymbol cd="ambiguous" id="A1.SS4.p3.1.m1.4.4.3.2.1.cmml" xref="A1.SS4.p3.1.m1.4.4.3.2">superscript</csymbol><ci id="A1.SS4.p3.1.m1.4.4.3.2.2.cmml" xref="A1.SS4.p3.1.m1.4.4.3.2.2">𝜎</ci><ci id="A1.SS4.p3.1.m1.4.4.3.2.3.cmml" xref="A1.SS4.p3.1.m1.4.4.3.2.3">′</ci></apply><ci id="A1.SS4.p3.1.m1.1.1.cmml" xref="A1.SS4.p3.1.m1.1.1">𝑥</ci></apply><apply id="A1.SS4.p3.1.m1.4.4.1.cmml" xref="A1.SS4.p3.1.m1.4.4.1"><times id="A1.SS4.p3.1.m1.4.4.1.2.cmml" xref="A1.SS4.p3.1.m1.4.4.1.2"></times><ci id="A1.SS4.p3.1.m1.4.4.1.3.cmml" xref="A1.SS4.p3.1.m1.4.4.1.3">𝜎</ci><ci id="A1.SS4.p3.1.m1.2.2.cmml" xref="A1.SS4.p3.1.m1.2.2">𝑥</ci><apply id="A1.SS4.p3.1.m1.4.4.1.1.1.1.cmml" xref="A1.SS4.p3.1.m1.4.4.1.1.1"><minus id="A1.SS4.p3.1.m1.4.4.1.1.1.1.1.cmml" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.1"></minus><cn id="A1.SS4.p3.1.m1.4.4.1.1.1.1.2.cmml" type="integer" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.2">1</cn><apply id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.cmml" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3"><times id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.1.cmml" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.1"></times><ci id="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.2.cmml" xref="A1.SS4.p3.1.m1.4.4.1.1.1.1.3.2">𝜎</ci><ci id="A1.SS4.p3.1.m1.3.3.cmml" xref="A1.SS4.p3.1.m1.3.3">𝑥</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p3.1.m1.4c">\sigma^{\prime}(x)=\sigma(x)(1-\sigma(x))</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p3.1.m1.4d">italic_σ start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x ) = italic_σ ( italic_x ) ( 1 - italic_σ ( italic_x ) )</annotation></semantics></math> and <math alttext="\sigma(-x)=1-\sigma(x)" class="ltx_Math" display="inline" id="A1.SS4.p3.2.m2.2"><semantics id="A1.SS4.p3.2.m2.2a"><mrow id="A1.SS4.p3.2.m2.2.2" xref="A1.SS4.p3.2.m2.2.2.cmml"><mrow id="A1.SS4.p3.2.m2.2.2.1" xref="A1.SS4.p3.2.m2.2.2.1.cmml"><mi id="A1.SS4.p3.2.m2.2.2.1.3" xref="A1.SS4.p3.2.m2.2.2.1.3.cmml">σ</mi><mo id="A1.SS4.p3.2.m2.2.2.1.2" xref="A1.SS4.p3.2.m2.2.2.1.2.cmml">⁢</mo><mrow id="A1.SS4.p3.2.m2.2.2.1.1.1" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.cmml"><mo id="A1.SS4.p3.2.m2.2.2.1.1.1.2" stretchy="false" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.2.m2.2.2.1.1.1.1" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.cmml"><mo id="A1.SS4.p3.2.m2.2.2.1.1.1.1a" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.cmml">−</mo><mi id="A1.SS4.p3.2.m2.2.2.1.1.1.1.2" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.2.cmml">x</mi></mrow><mo id="A1.SS4.p3.2.m2.2.2.1.1.1.3" stretchy="false" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS4.p3.2.m2.2.2.2" xref="A1.SS4.p3.2.m2.2.2.2.cmml">=</mo><mrow id="A1.SS4.p3.2.m2.2.2.3" xref="A1.SS4.p3.2.m2.2.2.3.cmml"><mn id="A1.SS4.p3.2.m2.2.2.3.2" xref="A1.SS4.p3.2.m2.2.2.3.2.cmml">1</mn><mo id="A1.SS4.p3.2.m2.2.2.3.1" xref="A1.SS4.p3.2.m2.2.2.3.1.cmml">−</mo><mrow id="A1.SS4.p3.2.m2.2.2.3.3" xref="A1.SS4.p3.2.m2.2.2.3.3.cmml"><mi id="A1.SS4.p3.2.m2.2.2.3.3.2" xref="A1.SS4.p3.2.m2.2.2.3.3.2.cmml">σ</mi><mo id="A1.SS4.p3.2.m2.2.2.3.3.1" xref="A1.SS4.p3.2.m2.2.2.3.3.1.cmml">⁢</mo><mrow id="A1.SS4.p3.2.m2.2.2.3.3.3.2" xref="A1.SS4.p3.2.m2.2.2.3.3.cmml"><mo id="A1.SS4.p3.2.m2.2.2.3.3.3.2.1" stretchy="false" xref="A1.SS4.p3.2.m2.2.2.3.3.cmml">(</mo><mi id="A1.SS4.p3.2.m2.1.1" xref="A1.SS4.p3.2.m2.1.1.cmml">x</mi><mo id="A1.SS4.p3.2.m2.2.2.3.3.3.2.2" stretchy="false" xref="A1.SS4.p3.2.m2.2.2.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS4.p3.2.m2.2b"><apply id="A1.SS4.p3.2.m2.2.2.cmml" xref="A1.SS4.p3.2.m2.2.2"><eq id="A1.SS4.p3.2.m2.2.2.2.cmml" xref="A1.SS4.p3.2.m2.2.2.2"></eq><apply id="A1.SS4.p3.2.m2.2.2.1.cmml" xref="A1.SS4.p3.2.m2.2.2.1"><times id="A1.SS4.p3.2.m2.2.2.1.2.cmml" xref="A1.SS4.p3.2.m2.2.2.1.2"></times><ci id="A1.SS4.p3.2.m2.2.2.1.3.cmml" xref="A1.SS4.p3.2.m2.2.2.1.3">𝜎</ci><apply id="A1.SS4.p3.2.m2.2.2.1.1.1.1.cmml" xref="A1.SS4.p3.2.m2.2.2.1.1.1"><minus id="A1.SS4.p3.2.m2.2.2.1.1.1.1.1.cmml" xref="A1.SS4.p3.2.m2.2.2.1.1.1"></minus><ci id="A1.SS4.p3.2.m2.2.2.1.1.1.1.2.cmml" xref="A1.SS4.p3.2.m2.2.2.1.1.1.1.2">𝑥</ci></apply></apply><apply id="A1.SS4.p3.2.m2.2.2.3.cmml" xref="A1.SS4.p3.2.m2.2.2.3"><minus id="A1.SS4.p3.2.m2.2.2.3.1.cmml" xref="A1.SS4.p3.2.m2.2.2.3.1"></minus><cn id="A1.SS4.p3.2.m2.2.2.3.2.cmml" type="integer" xref="A1.SS4.p3.2.m2.2.2.3.2">1</cn><apply id="A1.SS4.p3.2.m2.2.2.3.3.cmml" xref="A1.SS4.p3.2.m2.2.2.3.3"><times id="A1.SS4.p3.2.m2.2.2.3.3.1.cmml" xref="A1.SS4.p3.2.m2.2.2.3.3.1"></times><ci id="A1.SS4.p3.2.m2.2.2.3.3.2.cmml" xref="A1.SS4.p3.2.m2.2.2.3.3.2">𝜎</ci><ci id="A1.SS4.p3.2.m2.1.1.cmml" xref="A1.SS4.p3.2.m2.1.1">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p3.2.m2.2c">\sigma(-x)=1-\sigma(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p3.2.m2.2d">italic_σ ( - italic_x ) = 1 - italic_σ ( italic_x )</annotation></semantics></math>, we obtain the final gradient</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.SS4.p3.3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=\\
-\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\bigg{[}\beta\sigma\left(\beta\log%
\frac{\pi_{\theta}(y_{w}|x)}{\pi_{\text{ref}}(y_{w}|x)}-\beta\log\frac{\pi_{%
\theta}(y_{l}|x)}{\pi_{\text{ref}}(y_{l}|x)}\right)\bigg{[}\nabla_{\theta}\log%
\pi(y_{w}\mid x)-\nabla_{\theta}\log\pi(y_{l}\mid x)\bigg{]}\bigg{]}," class="ltx_Math" display="block" id="A1.SS4.p3.3.m1.56"><semantics id="A1.SS4.p3.3.m1.56a"><mtable displaystyle="true" id="A1.SS4.p3.3.m1.56.56.4" rowspacing="0pt"><mtr id="A1.SS4.p3.3.m1.56.56.4a"><mtd class="ltx_align_left" columnalign="left" id="A1.SS4.p3.3.m1.56.56.4b"><mrow id="A1.SS4.p3.3.m1.55.55.3.54.14.14"><mrow id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14"><mrow id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.4"><msub id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.4.1"><mo id="A1.SS4.p3.3.m1.1.1.1.1.1.1" xref="A1.SS4.p3.3.m1.1.1.1.1.1.1.cmml">∇</mo><mi id="A1.SS4.p3.3.m1.2.2.2.2.2.2.1" xref="A1.SS4.p3.3.m1.2.2.2.2.2.2.1.cmml">θ</mi></msub><msub id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.4.2"><mi class="ltx_font_mathcaligraphic" id="A1.SS4.p3.3.m1.3.3.3.3.3.3" xref="A1.SS4.p3.3.m1.3.3.3.3.3.3.cmml">ℒ</mi><mtext id="A1.SS4.p3.3.m1.4.4.4.4.4.4.1" xref="A1.SS4.p3.3.m1.4.4.4.4.4.4.1a.cmml">DPO</mtext></msub></mrow><mo id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.2.2"><mo id="A1.SS4.p3.3.m1.5.5.5.5.5.5" stretchy="false" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">(</mo><msub id="A1.SS4.p3.3.m1.54.54.2.53.13.13.13.1.1.1"><mi id="A1.SS4.p3.3.m1.6.6.6.6.6.6" xref="A1.SS4.p3.3.m1.6.6.6.6.6.6.cmml">π</mi><mi id="A1.SS4.p3.3.m1.7.7.7.7.7.7.1" xref="A1.SS4.p3.3.m1.7.7.7.7.7.7.1.cmml">θ</mi></msub><mo id="A1.SS4.p3.3.m1.8.8.8.8.8.8" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">;</mo><msub id="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.2.2.2"><mi id="A1.SS4.p3.3.m1.9.9.9.9.9.9" xref="A1.SS4.p3.3.m1.9.9.9.9.9.9.cmml">π</mi><mtext id="A1.SS4.p3.3.m1.10.10.10.10.10.10.1" xref="A1.SS4.p3.3.m1.10.10.10.10.10.10.1a.cmml">ref</mtext></msub><mo id="A1.SS4.p3.3.m1.11.11.11.11.11.11" stretchy="false" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS4.p3.3.m1.12.12.12.12.12.12" xref="A1.SS4.p3.3.m1.12.12.12.12.12.12.cmml">=</mo><mi id="A1.SS4.p3.3.m1.55.55.3.54.14.14.15" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml"></mi></mrow></mtd></mtr><mtr id="A1.SS4.p3.3.m1.56.56.4c"><mtd class="ltx_align_right" columnalign="right" id="A1.SS4.p3.3.m1.56.56.4d"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1"><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1a" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">−</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1"><msub id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.3"><mi id="A1.SS4.p3.3.m1.14.14.14.2.2.2" xref="A1.SS4.p3.3.m1.14.14.14.2.2.2.cmml">𝔼</mi><mrow id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.cmml"><mrow id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.3.cmml"><mo id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.3" stretchy="false" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.3.cmml">(</mo><mi id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.1" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.1.cmml">x</mi><mo id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.4" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.3.cmml">,</mo><msub id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.cmml"><mi id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.2" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.2.cmml">y</mi><mi id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.3" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.3.cmml">w</mi></msub><mo id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.5" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.3.cmml">,</mo><msub id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.cmml"><mi id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.2" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.2.cmml">y</mi><mi id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.3" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.3.cmml">l</mi></msub><mo id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.6" stretchy="false" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.3.cmml">)</mo></mrow><mo id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.4" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.4.cmml">∼</mo><mi class="ltx_font_mathcaligraphic" id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.5" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.5.cmml">𝒟</mi></mrow></msub><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.2" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1"><mo id="A1.SS4.p3.3.m1.16.16.16.4.4.4" maxsize="210%" minsize="210%" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">[</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1"><mi id="A1.SS4.p3.3.m1.17.17.17.5.5.5" xref="A1.SS4.p3.3.m1.17.17.17.5.5.5.cmml">β</mi><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.3" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mi id="A1.SS4.p3.3.m1.18.18.18.6.6.6" xref="A1.SS4.p3.3.m1.18.18.18.6.6.6.cmml">σ</mi><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.3a" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1"><mo id="A1.SS4.p3.3.m1.19.19.19.7.7.7" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.1"><mi id="A1.SS4.p3.3.m1.20.20.20.8.8.8" xref="A1.SS4.p3.3.m1.20.20.20.8.8.8.cmml">β</mi><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.1.1" lspace="0.167em" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.1.2"><mi id="A1.SS4.p3.3.m1.21.21.21.9.9.9" xref="A1.SS4.p3.3.m1.21.21.21.9.9.9.cmml">log</mi><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.1.2a" lspace="0.167em" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁡</mo><mfrac id="A1.SS4.p3.3.m1.22.22.22.10.10.10" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.cmml"><mrow id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.cmml"><msub id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.cmml"><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.2.cmml">π</mi><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.3.cmml">θ</mi></msub><mo id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.2.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.cmml"><mo id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.2" stretchy="false" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.cmml"><msub id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.cmml"><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.3" stretchy="false" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.cmml"><msub id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.cmml"><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.2.cmml">π</mi><mtext id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.2.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.cmml"><mo id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.2" stretchy="false" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.cmml"><msub id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.cmml"><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.2" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.1" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.3" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.3" stretchy="false" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.SS4.p3.3.m1.23.23.23.11.11.11" xref="A1.SS4.p3.3.m1.23.23.23.11.11.11.cmml">−</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.2"><mi id="A1.SS4.p3.3.m1.24.24.24.12.12.12" xref="A1.SS4.p3.3.m1.24.24.24.12.12.12.cmml">β</mi><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.2.1" lspace="0.167em" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.2.2"><mi id="A1.SS4.p3.3.m1.25.25.25.13.13.13" xref="A1.SS4.p3.3.m1.25.25.25.13.13.13.cmml">log</mi><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.1.1.1.2.2a" lspace="0.167em" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁡</mo><mfrac id="A1.SS4.p3.3.m1.26.26.26.14.14.14" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.cmml"><mrow id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.cmml"><msub id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.cmml"><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.2.cmml">π</mi><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.3.cmml">θ</mi></msub><mo id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.2.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.cmml"><mo id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.2" stretchy="false" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.cmml"><msub id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.cmml"><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.3" stretchy="false" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.cmml"><msub id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.cmml"><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.2.cmml">π</mi><mtext id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.2.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.cmml"><mo id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.2" stretchy="false" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.cmml"><msub id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.cmml"><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.2" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.2.cmml">y</mi><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.1" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.1.cmml">|</mo><mi id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.3" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.3" stretchy="false" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><mo id="A1.SS4.p3.3.m1.27.27.27.15.15.15" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">)</mo></mrow><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.3b" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1"><mo id="A1.SS4.p3.3.m1.28.28.28.16.16.16" maxsize="210%" minsize="210%" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">[</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.3"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.3.1"><msub id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.3.1.1"><mo id="A1.SS4.p3.3.m1.29.29.29.17.17.17" rspace="0.167em" xref="A1.SS4.p3.3.m1.29.29.29.17.17.17.cmml">∇</mo><mi id="A1.SS4.p3.3.m1.30.30.30.18.18.18.1" xref="A1.SS4.p3.3.m1.30.30.30.18.18.18.1.cmml">θ</mi></msub><mi id="A1.SS4.p3.3.m1.31.31.31.19.19.19" xref="A1.SS4.p3.3.m1.31.31.31.19.19.19.cmml">log</mi></mrow><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.3a" lspace="0.167em" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁡</mo><mi id="A1.SS4.p3.3.m1.32.32.32.20.20.20" xref="A1.SS4.p3.3.m1.32.32.32.20.20.20.cmml">π</mi></mrow><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.2" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.1.1"><mo id="A1.SS4.p3.3.m1.33.33.33.21.21.21" stretchy="false" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.1.1.1"><msub id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.1.1.1.1.1"><mi id="A1.SS4.p3.3.m1.34.34.34.22.22.22" xref="A1.SS4.p3.3.m1.34.34.34.22.22.22.cmml">y</mi><mi id="A1.SS4.p3.3.m1.35.35.35.23.23.23.1" xref="A1.SS4.p3.3.m1.35.35.35.23.23.23.1.cmml">w</mi></msub><mo id="A1.SS4.p3.3.m1.36.36.36.24.24.24" xref="A1.SS4.p3.3.m1.36.36.36.24.24.24.cmml">∣</mo><mi id="A1.SS4.p3.3.m1.37.37.37.25.25.25" xref="A1.SS4.p3.3.m1.37.37.37.25.25.25.cmml">x</mi></mrow><mo id="A1.SS4.p3.3.m1.38.38.38.26.26.26" stretchy="false" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS4.p3.3.m1.39.39.39.27.27.27" xref="A1.SS4.p3.3.m1.39.39.39.27.27.27.cmml">−</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.3"><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.3.1"><msub id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.3.1.1"><mo id="A1.SS4.p3.3.m1.40.40.40.28.28.28" rspace="0.167em" xref="A1.SS4.p3.3.m1.40.40.40.28.28.28.cmml">∇</mo><mi id="A1.SS4.p3.3.m1.41.41.41.29.29.29.1" xref="A1.SS4.p3.3.m1.41.41.41.29.29.29.1.cmml">θ</mi></msub><mi id="A1.SS4.p3.3.m1.42.42.42.30.30.30" xref="A1.SS4.p3.3.m1.42.42.42.30.30.30.cmml">log</mi></mrow><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.3a" lspace="0.167em" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁡</mo><mi id="A1.SS4.p3.3.m1.43.43.43.31.31.31" xref="A1.SS4.p3.3.m1.43.43.43.31.31.31.cmml">π</mi></mrow><mo id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.2" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">⁢</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.1.1"><mo id="A1.SS4.p3.3.m1.44.44.44.32.32.32" stretchy="false" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">(</mo><mrow id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.1.1.1"><msub id="A1.SS4.p3.3.m1.56.56.4.55.41.41.41.1.1.1.1.1.2.1.1.2.1.1.1.1"><mi id="A1.SS4.p3.3.m1.45.45.45.33.33.33" xref="A1.SS4.p3.3.m1.45.45.45.33.33.33.cmml">y</mi><mi id="A1.SS4.p3.3.m1.46.46.46.34.34.34.1" xref="A1.SS4.p3.3.m1.46.46.46.34.34.34.1.cmml">l</mi></msub><mo id="A1.SS4.p3.3.m1.47.47.47.35.35.35" xref="A1.SS4.p3.3.m1.47.47.47.35.35.35.cmml">∣</mo><mi id="A1.SS4.p3.3.m1.48.48.48.36.36.36" xref="A1.SS4.p3.3.m1.48.48.48.36.36.36.cmml">x</mi></mrow><mo id="A1.SS4.p3.3.m1.49.49.49.37.37.37" stretchy="false" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="A1.SS4.p3.3.m1.50.50.50.38.38.38" maxsize="210%" minsize="210%" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">]</mo></mrow></mrow><mo id="A1.SS4.p3.3.m1.51.51.51.39.39.39" maxsize="210%" minsize="210%" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">]</mo></mrow></mrow></mrow><mo id="A1.SS4.p3.3.m1.52.52.52.40.40.40" xref="A1.SS4.p3.3.m1.53.53.1.1.1.cmml">,</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="A1.SS4.p3.3.m1.56b"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><eq id="A1.SS4.p3.3.m1.12.12.12.12.12.12.cmml" xref="A1.SS4.p3.3.m1.12.12.12.12.12.12"></eq><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.2.4.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.2.4.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.2.4.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.1.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.1.1.1.1.1.1">∇</ci><ci id="A1.SS4.p3.3.m1.2.2.2.2.2.2.1.cmml" xref="A1.SS4.p3.3.m1.2.2.2.2.2.2.1">𝜃</ci></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.2.4.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.2.4.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.3.3.3.3.3.3.cmml" xref="A1.SS4.p3.3.m1.3.3.3.3.3.3">ℒ</ci><ci id="A1.SS4.p3.3.m1.4.4.4.4.4.4.1a.cmml" xref="A1.SS4.p3.3.m1.4.4.4.4.4.4.1"><mtext id="A1.SS4.p3.3.m1.4.4.4.4.4.4.1.cmml" mathsize="70%" xref="A1.SS4.p3.3.m1.4.4.4.4.4.4.1">DPO</mtext></ci></apply></apply><list id="A1.SS4.p3.3.m1.53.53.1.1.1.2.2.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.6.6.6.6.6.6.cmml" xref="A1.SS4.p3.3.m1.6.6.6.6.6.6">𝜋</ci><ci id="A1.SS4.p3.3.m1.7.7.7.7.7.7.1.cmml" xref="A1.SS4.p3.3.m1.7.7.7.7.7.7.1">𝜃</ci></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.2.2.2.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.2.2.2.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.9.9.9.9.9.9.cmml" xref="A1.SS4.p3.3.m1.9.9.9.9.9.9">𝜋</ci><ci id="A1.SS4.p3.3.m1.10.10.10.10.10.10.1a.cmml" xref="A1.SS4.p3.3.m1.10.10.10.10.10.10.1"><mtext id="A1.SS4.p3.3.m1.10.10.10.10.10.10.1.cmml" mathsize="70%" xref="A1.SS4.p3.3.m1.10.10.10.10.10.10.1">ref</mtext></ci></apply></list></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><minus id="A1.SS4.p3.3.m1.13.13.13.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></minus><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.3.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.14.14.14.2.2.2.cmml" xref="A1.SS4.p3.3.m1.14.14.14.2.2.2">𝔼</ci><apply id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.4.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.4">similar-to</csymbol><vector id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.3.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2"><ci id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.1.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.1">𝑥</ci><apply id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.1.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1">subscript</csymbol><ci id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.2.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.2">𝑦</ci><ci id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.3.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.2.1.1.3">𝑤</ci></apply><apply id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.1.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2">subscript</csymbol><ci id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.2.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.2">𝑦</ci><ci id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.3.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.3.2.2.3">𝑙</ci></apply></vector><ci id="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.5.cmml" xref="A1.SS4.p3.3.m1.15.15.15.3.3.3.1.5">𝒟</ci></apply></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">delimited-[]</csymbol><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><ci id="A1.SS4.p3.3.m1.17.17.17.5.5.5.cmml" xref="A1.SS4.p3.3.m1.17.17.17.5.5.5">𝛽</ci><ci id="A1.SS4.p3.3.m1.18.18.18.6.6.6.cmml" xref="A1.SS4.p3.3.m1.18.18.18.6.6.6">𝜎</ci><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><minus id="A1.SS4.p3.3.m1.23.23.23.11.11.11.cmml" xref="A1.SS4.p3.3.m1.23.23.23.11.11.11"></minus><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><ci id="A1.SS4.p3.3.m1.20.20.20.8.8.8.cmml" xref="A1.SS4.p3.3.m1.20.20.20.8.8.8">𝛽</ci><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><log id="A1.SS4.p3.3.m1.21.21.21.9.9.9.cmml" xref="A1.SS4.p3.3.m1.21.21.21.9.9.9"></log><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10"><divide id="A1.SS4.p3.3.m1.22.22.22.10.10.10.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10"></divide><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1"><times id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.2"></times><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.2">𝜋</ci><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.3.3">𝜃</ci></apply><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.2.3">𝑤</ci></apply><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2"><times id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.2"></times><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.2">𝜋</ci><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.3a.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.3"><mtext id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.3.cmml" mathsize="70%" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.3.3">ref</mtext></ci></apply><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.2.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.2.3">𝑤</ci></apply><ci id="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.22.22.22.10.10.10.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.3.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><ci id="A1.SS4.p3.3.m1.24.24.24.12.12.12.cmml" xref="A1.SS4.p3.3.m1.24.24.24.12.12.12">𝛽</ci><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.1.1.1.3.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><log id="A1.SS4.p3.3.m1.25.25.25.13.13.13.cmml" xref="A1.SS4.p3.3.m1.25.25.25.13.13.13"></log><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14"><divide id="A1.SS4.p3.3.m1.26.26.26.14.14.14.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14"></divide><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1"><times id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.2"></times><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.2">𝜋</ci><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.3.3">𝜃</ci></apply><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.2.3">𝑙</ci></apply><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2"><times id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.2"></times><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.2">𝜋</ci><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.3a.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.3"><mtext id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.3.cmml" mathsize="70%" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.3.3">ref</mtext></ci></apply><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.1">conditional</csymbol><apply id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2">subscript</csymbol><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.2.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.2">𝑦</ci><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.2.3">𝑙</ci></apply><ci id="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.26.26.26.14.14.14.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">delimited-[]</csymbol><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><minus id="A1.SS4.p3.3.m1.39.39.39.27.27.27.cmml" xref="A1.SS4.p3.3.m1.39.39.39.27.27.27"></minus><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.3.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.3.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.3.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.29.29.29.17.17.17.cmml" xref="A1.SS4.p3.3.m1.29.29.29.17.17.17">∇</ci><ci id="A1.SS4.p3.3.m1.30.30.30.18.18.18.1.cmml" xref="A1.SS4.p3.3.m1.30.30.30.18.18.18.1">𝜃</ci></apply><log id="A1.SS4.p3.3.m1.31.31.31.19.19.19.cmml" xref="A1.SS4.p3.3.m1.31.31.31.19.19.19"></log></apply><ci id="A1.SS4.p3.3.m1.32.32.32.20.20.20.cmml" xref="A1.SS4.p3.3.m1.32.32.32.20.20.20">𝜋</ci></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.36.36.36.24.24.24.cmml" xref="A1.SS4.p3.3.m1.36.36.36.24.24.24">conditional</csymbol><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.1.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.34.34.34.22.22.22.cmml" xref="A1.SS4.p3.3.m1.34.34.34.22.22.22">𝑦</ci><ci id="A1.SS4.p3.3.m1.35.35.35.23.23.23.1.cmml" xref="A1.SS4.p3.3.m1.35.35.35.23.23.23.1">𝑤</ci></apply><ci id="A1.SS4.p3.3.m1.37.37.37.25.25.25.cmml" xref="A1.SS4.p3.3.m1.37.37.37.25.25.25">𝑥</ci></apply></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><times id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"></times><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.3.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.3.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.3.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.3.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.40.40.40.28.28.28.cmml" xref="A1.SS4.p3.3.m1.40.40.40.28.28.28">∇</ci><ci id="A1.SS4.p3.3.m1.41.41.41.29.29.29.1.cmml" xref="A1.SS4.p3.3.m1.41.41.41.29.29.29.1">𝜃</ci></apply><log id="A1.SS4.p3.3.m1.42.42.42.30.30.30.cmml" xref="A1.SS4.p3.3.m1.42.42.42.30.30.30"></log></apply><ci id="A1.SS4.p3.3.m1.43.43.43.31.31.31.cmml" xref="A1.SS4.p3.3.m1.43.43.43.31.31.31">𝜋</ci></apply><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.1.1.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="latexml" id="A1.SS4.p3.3.m1.47.47.47.35.35.35.cmml" xref="A1.SS4.p3.3.m1.47.47.47.35.35.35">conditional</csymbol><apply id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.1.1.1.2.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3"><csymbol cd="ambiguous" id="A1.SS4.p3.3.m1.53.53.1.1.1.3.1.1.1.1.2.1.1.2.1.1.1.2.1.cmml" xref="A1.SS4.p3.3.m1.55.55.3.54.14.14.14.3">subscript</csymbol><ci id="A1.SS4.p3.3.m1.45.45.45.33.33.33.cmml" xref="A1.SS4.p3.3.m1.45.45.45.33.33.33">𝑦</ci><ci id="A1.SS4.p3.3.m1.46.46.46.34.34.34.1.cmml" xref="A1.SS4.p3.3.m1.46.46.46.34.34.34.1">𝑙</ci></apply><ci id="A1.SS4.p3.3.m1.48.48.48.36.36.36.cmml" xref="A1.SS4.p3.3.m1.48.48.48.36.36.36">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p3.3.m1.56c">\nabla_{\theta}\mathcal{L}_{\text{DPO}}(\pi_{\theta};\pi_{\text{ref}})=\\
-\mathbb{E}_{(x,y_{w},y_{l})\sim\mathcal{D}}\bigg{[}\beta\sigma\left(\beta\log%
\frac{\pi_{\theta}(y_{w}|x)}{\pi_{\text{ref}}(y_{w}|x)}-\beta\log\frac{\pi_{%
\theta}(y_{l}|x)}{\pi_{\text{ref}}(y_{l}|x)}\right)\bigg{[}\nabla_{\theta}\log%
\pi(y_{w}\mid x)-\nabla_{\theta}\log\pi(y_{l}\mid x)\bigg{]}\bigg{]},</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p3.3.m1.56d">start_ROW start_CELL ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L start_POSTSUBSCRIPT DPO end_POSTSUBSCRIPT ( italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ; italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ) = end_CELL end_ROW start_ROW start_CELL - blackboard_E start_POSTSUBSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ) ∼ caligraphic_D end_POSTSUBSCRIPT [ italic_β italic_σ ( italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x ) end_ARG - italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x ) end_ARG ) [ ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT roman_log italic_π ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT ∣ italic_x ) - ∇ start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT roman_log italic_π ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT ∣ italic_x ) ] ] , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS4.p4">
<p class="ltx_p" id="A1.SS4.p4.1">After using the reward substitution of <math alttext="\hat{r}_{\theta}(x,y)=\beta\log\frac{\pi_{\theta}(y\mid x)}{\pi_{\text{ref}}(y%
\mid x)}" class="ltx_Math" display="inline" id="A1.SS4.p4.1.m1.4"><semantics id="A1.SS4.p4.1.m1.4a"><mrow id="A1.SS4.p4.1.m1.4.5" xref="A1.SS4.p4.1.m1.4.5.cmml"><mrow id="A1.SS4.p4.1.m1.4.5.2" xref="A1.SS4.p4.1.m1.4.5.2.cmml"><msub id="A1.SS4.p4.1.m1.4.5.2.2" xref="A1.SS4.p4.1.m1.4.5.2.2.cmml"><mover accent="true" id="A1.SS4.p4.1.m1.4.5.2.2.2" xref="A1.SS4.p4.1.m1.4.5.2.2.2.cmml"><mi id="A1.SS4.p4.1.m1.4.5.2.2.2.2" xref="A1.SS4.p4.1.m1.4.5.2.2.2.2.cmml">r</mi><mo id="A1.SS4.p4.1.m1.4.5.2.2.2.1" xref="A1.SS4.p4.1.m1.4.5.2.2.2.1.cmml">^</mo></mover><mi id="A1.SS4.p4.1.m1.4.5.2.2.3" xref="A1.SS4.p4.1.m1.4.5.2.2.3.cmml">θ</mi></msub><mo id="A1.SS4.p4.1.m1.4.5.2.1" xref="A1.SS4.p4.1.m1.4.5.2.1.cmml">⁢</mo><mrow id="A1.SS4.p4.1.m1.4.5.2.3.2" xref="A1.SS4.p4.1.m1.4.5.2.3.1.cmml"><mo id="A1.SS4.p4.1.m1.4.5.2.3.2.1" stretchy="false" xref="A1.SS4.p4.1.m1.4.5.2.3.1.cmml">(</mo><mi id="A1.SS4.p4.1.m1.3.3" xref="A1.SS4.p4.1.m1.3.3.cmml">x</mi><mo id="A1.SS4.p4.1.m1.4.5.2.3.2.2" xref="A1.SS4.p4.1.m1.4.5.2.3.1.cmml">,</mo><mi id="A1.SS4.p4.1.m1.4.4" xref="A1.SS4.p4.1.m1.4.4.cmml">y</mi><mo id="A1.SS4.p4.1.m1.4.5.2.3.2.3" stretchy="false" xref="A1.SS4.p4.1.m1.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS4.p4.1.m1.4.5.1" xref="A1.SS4.p4.1.m1.4.5.1.cmml">=</mo><mrow id="A1.SS4.p4.1.m1.4.5.3" xref="A1.SS4.p4.1.m1.4.5.3.cmml"><mi id="A1.SS4.p4.1.m1.4.5.3.2" xref="A1.SS4.p4.1.m1.4.5.3.2.cmml">β</mi><mo id="A1.SS4.p4.1.m1.4.5.3.1" lspace="0.167em" xref="A1.SS4.p4.1.m1.4.5.3.1.cmml">⁢</mo><mrow id="A1.SS4.p4.1.m1.4.5.3.3" xref="A1.SS4.p4.1.m1.4.5.3.3.cmml"><mi id="A1.SS4.p4.1.m1.4.5.3.3.1" xref="A1.SS4.p4.1.m1.4.5.3.3.1.cmml">log</mi><mo id="A1.SS4.p4.1.m1.4.5.3.3a" lspace="0.167em" xref="A1.SS4.p4.1.m1.4.5.3.3.cmml">⁡</mo><mfrac id="A1.SS4.p4.1.m1.2.2" xref="A1.SS4.p4.1.m1.2.2.cmml"><mrow id="A1.SS4.p4.1.m1.1.1.1" xref="A1.SS4.p4.1.m1.1.1.1.cmml"><msub id="A1.SS4.p4.1.m1.1.1.1.3" xref="A1.SS4.p4.1.m1.1.1.1.3.cmml"><mi id="A1.SS4.p4.1.m1.1.1.1.3.2" xref="A1.SS4.p4.1.m1.1.1.1.3.2.cmml">π</mi><mi id="A1.SS4.p4.1.m1.1.1.1.3.3" xref="A1.SS4.p4.1.m1.1.1.1.3.3.cmml">θ</mi></msub><mo id="A1.SS4.p4.1.m1.1.1.1.2" xref="A1.SS4.p4.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS4.p4.1.m1.1.1.1.1.1" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.cmml"><mo id="A1.SS4.p4.1.m1.1.1.1.1.1.2" stretchy="false" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS4.p4.1.m1.1.1.1.1.1.1" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.cmml"><mi id="A1.SS4.p4.1.m1.1.1.1.1.1.1.2" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.2.cmml">y</mi><mo id="A1.SS4.p4.1.m1.1.1.1.1.1.1.1" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.1.cmml">∣</mo><mi id="A1.SS4.p4.1.m1.1.1.1.1.1.1.3" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p4.1.m1.1.1.1.1.1.3" stretchy="false" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS4.p4.1.m1.2.2.2" xref="A1.SS4.p4.1.m1.2.2.2.cmml"><msub id="A1.SS4.p4.1.m1.2.2.2.3" xref="A1.SS4.p4.1.m1.2.2.2.3.cmml"><mi id="A1.SS4.p4.1.m1.2.2.2.3.2" xref="A1.SS4.p4.1.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.SS4.p4.1.m1.2.2.2.3.3" xref="A1.SS4.p4.1.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS4.p4.1.m1.2.2.2.2" xref="A1.SS4.p4.1.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.SS4.p4.1.m1.2.2.2.1.1" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.cmml"><mo id="A1.SS4.p4.1.m1.2.2.2.1.1.2" stretchy="false" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.SS4.p4.1.m1.2.2.2.1.1.1" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.cmml"><mi id="A1.SS4.p4.1.m1.2.2.2.1.1.1.2" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.2.cmml">y</mi><mo id="A1.SS4.p4.1.m1.2.2.2.1.1.1.1" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.1.cmml">∣</mo><mi id="A1.SS4.p4.1.m1.2.2.2.1.1.1.3" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS4.p4.1.m1.2.2.2.1.1.3" stretchy="false" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS4.p4.1.m1.4b"><apply id="A1.SS4.p4.1.m1.4.5.cmml" xref="A1.SS4.p4.1.m1.4.5"><eq id="A1.SS4.p4.1.m1.4.5.1.cmml" xref="A1.SS4.p4.1.m1.4.5.1"></eq><apply id="A1.SS4.p4.1.m1.4.5.2.cmml" xref="A1.SS4.p4.1.m1.4.5.2"><times id="A1.SS4.p4.1.m1.4.5.2.1.cmml" xref="A1.SS4.p4.1.m1.4.5.2.1"></times><apply id="A1.SS4.p4.1.m1.4.5.2.2.cmml" xref="A1.SS4.p4.1.m1.4.5.2.2"><csymbol cd="ambiguous" id="A1.SS4.p4.1.m1.4.5.2.2.1.cmml" xref="A1.SS4.p4.1.m1.4.5.2.2">subscript</csymbol><apply id="A1.SS4.p4.1.m1.4.5.2.2.2.cmml" xref="A1.SS4.p4.1.m1.4.5.2.2.2"><ci id="A1.SS4.p4.1.m1.4.5.2.2.2.1.cmml" xref="A1.SS4.p4.1.m1.4.5.2.2.2.1">^</ci><ci id="A1.SS4.p4.1.m1.4.5.2.2.2.2.cmml" xref="A1.SS4.p4.1.m1.4.5.2.2.2.2">𝑟</ci></apply><ci id="A1.SS4.p4.1.m1.4.5.2.2.3.cmml" xref="A1.SS4.p4.1.m1.4.5.2.2.3">𝜃</ci></apply><interval closure="open" id="A1.SS4.p4.1.m1.4.5.2.3.1.cmml" xref="A1.SS4.p4.1.m1.4.5.2.3.2"><ci id="A1.SS4.p4.1.m1.3.3.cmml" xref="A1.SS4.p4.1.m1.3.3">𝑥</ci><ci id="A1.SS4.p4.1.m1.4.4.cmml" xref="A1.SS4.p4.1.m1.4.4">𝑦</ci></interval></apply><apply id="A1.SS4.p4.1.m1.4.5.3.cmml" xref="A1.SS4.p4.1.m1.4.5.3"><times id="A1.SS4.p4.1.m1.4.5.3.1.cmml" xref="A1.SS4.p4.1.m1.4.5.3.1"></times><ci id="A1.SS4.p4.1.m1.4.5.3.2.cmml" xref="A1.SS4.p4.1.m1.4.5.3.2">𝛽</ci><apply id="A1.SS4.p4.1.m1.4.5.3.3.cmml" xref="A1.SS4.p4.1.m1.4.5.3.3"><log id="A1.SS4.p4.1.m1.4.5.3.3.1.cmml" xref="A1.SS4.p4.1.m1.4.5.3.3.1"></log><apply id="A1.SS4.p4.1.m1.2.2.cmml" xref="A1.SS4.p4.1.m1.2.2"><divide id="A1.SS4.p4.1.m1.2.2.3.cmml" xref="A1.SS4.p4.1.m1.2.2"></divide><apply id="A1.SS4.p4.1.m1.1.1.1.cmml" xref="A1.SS4.p4.1.m1.1.1.1"><times id="A1.SS4.p4.1.m1.1.1.1.2.cmml" xref="A1.SS4.p4.1.m1.1.1.1.2"></times><apply id="A1.SS4.p4.1.m1.1.1.1.3.cmml" xref="A1.SS4.p4.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.SS4.p4.1.m1.1.1.1.3.1.cmml" xref="A1.SS4.p4.1.m1.1.1.1.3">subscript</csymbol><ci id="A1.SS4.p4.1.m1.1.1.1.3.2.cmml" xref="A1.SS4.p4.1.m1.1.1.1.3.2">𝜋</ci><ci id="A1.SS4.p4.1.m1.1.1.1.3.3.cmml" xref="A1.SS4.p4.1.m1.1.1.1.3.3">𝜃</ci></apply><apply id="A1.SS4.p4.1.m1.1.1.1.1.1.1.cmml" xref="A1.SS4.p4.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS4.p4.1.m1.1.1.1.1.1.1.1.cmml" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS4.p4.1.m1.1.1.1.1.1.1.2.cmml" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS4.p4.1.m1.1.1.1.1.1.1.3.cmml" xref="A1.SS4.p4.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS4.p4.1.m1.2.2.2.cmml" xref="A1.SS4.p4.1.m1.2.2.2"><times id="A1.SS4.p4.1.m1.2.2.2.2.cmml" xref="A1.SS4.p4.1.m1.2.2.2.2"></times><apply id="A1.SS4.p4.1.m1.2.2.2.3.cmml" xref="A1.SS4.p4.1.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.SS4.p4.1.m1.2.2.2.3.1.cmml" xref="A1.SS4.p4.1.m1.2.2.2.3">subscript</csymbol><ci id="A1.SS4.p4.1.m1.2.2.2.3.2.cmml" xref="A1.SS4.p4.1.m1.2.2.2.3.2">𝜋</ci><ci id="A1.SS4.p4.1.m1.2.2.2.3.3a.cmml" xref="A1.SS4.p4.1.m1.2.2.2.3.3"><mtext id="A1.SS4.p4.1.m1.2.2.2.3.3.cmml" mathsize="50%" xref="A1.SS4.p4.1.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.SS4.p4.1.m1.2.2.2.1.1.1.cmml" xref="A1.SS4.p4.1.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.SS4.p4.1.m1.2.2.2.1.1.1.1.cmml" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.SS4.p4.1.m1.2.2.2.1.1.1.2.cmml" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.SS4.p4.1.m1.2.2.2.1.1.1.3.cmml" xref="A1.SS4.p4.1.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p4.1.m1.4c">\hat{r}_{\theta}(x,y)=\beta\log\frac{\pi_{\theta}(y\mid x)}{\pi_{\text{ref}}(y%
\mid x)}</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p4.1.m1.4d">over^ start_ARG italic_r end_ARG start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y ∣ italic_x ) end_ARG</annotation></semantics></math> we obtain the final form of the gradient from Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4" title="4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="A1.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.5 </span>Proof of Lemma 1 and 2</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS5.p1">
<p class="ltx_p" id="A1.SS5.p1.1">In this section, we will prove the two lemmas from Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5" title="5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="A1.SS5.p2">
<p class="ltx_p" id="A1.SS5.p2.1"><span class="ltx_text ltx_font_bold" id="A1.SS5.p2.1.1">Lemma 1 Restated.</span><span class="ltx_text ltx_font_italic" id="A1.SS5.p2.1.2"> Under the Plackett-Luce preference framework, and in particular the Bradley-Terry framework, two reward functions from the same equivalence class induce the same preference distribution.
</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_proof" id="A1.SS5.1">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS5.1.p1">
<p class="ltx_p" id="A1.SS5.1.p1.10">We say that two reward functions <math alttext="r(x,y)" class="ltx_Math" display="inline" id="A1.SS5.1.p1.1.m1.2"><semantics id="A1.SS5.1.p1.1.m1.2a"><mrow id="A1.SS5.1.p1.1.m1.2.3" xref="A1.SS5.1.p1.1.m1.2.3.cmml"><mi id="A1.SS5.1.p1.1.m1.2.3.2" xref="A1.SS5.1.p1.1.m1.2.3.2.cmml">r</mi><mo id="A1.SS5.1.p1.1.m1.2.3.1" xref="A1.SS5.1.p1.1.m1.2.3.1.cmml">⁢</mo><mrow id="A1.SS5.1.p1.1.m1.2.3.3.2" xref="A1.SS5.1.p1.1.m1.2.3.3.1.cmml"><mo id="A1.SS5.1.p1.1.m1.2.3.3.2.1" stretchy="false" xref="A1.SS5.1.p1.1.m1.2.3.3.1.cmml">(</mo><mi id="A1.SS5.1.p1.1.m1.1.1" xref="A1.SS5.1.p1.1.m1.1.1.cmml">x</mi><mo id="A1.SS5.1.p1.1.m1.2.3.3.2.2" xref="A1.SS5.1.p1.1.m1.2.3.3.1.cmml">,</mo><mi id="A1.SS5.1.p1.1.m1.2.2" xref="A1.SS5.1.p1.1.m1.2.2.cmml">y</mi><mo id="A1.SS5.1.p1.1.m1.2.3.3.2.3" stretchy="false" xref="A1.SS5.1.p1.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.1.m1.2b"><apply id="A1.SS5.1.p1.1.m1.2.3.cmml" xref="A1.SS5.1.p1.1.m1.2.3"><times id="A1.SS5.1.p1.1.m1.2.3.1.cmml" xref="A1.SS5.1.p1.1.m1.2.3.1"></times><ci id="A1.SS5.1.p1.1.m1.2.3.2.cmml" xref="A1.SS5.1.p1.1.m1.2.3.2">𝑟</ci><interval closure="open" id="A1.SS5.1.p1.1.m1.2.3.3.1.cmml" xref="A1.SS5.1.p1.1.m1.2.3.3.2"><ci id="A1.SS5.1.p1.1.m1.1.1.cmml" xref="A1.SS5.1.p1.1.m1.1.1">𝑥</ci><ci id="A1.SS5.1.p1.1.m1.2.2.cmml" xref="A1.SS5.1.p1.1.m1.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.1.m1.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.1.m1.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math> and <math alttext="r^{\prime}(x,y)" class="ltx_Math" display="inline" id="A1.SS5.1.p1.2.m2.2"><semantics id="A1.SS5.1.p1.2.m2.2a"><mrow id="A1.SS5.1.p1.2.m2.2.3" xref="A1.SS5.1.p1.2.m2.2.3.cmml"><msup id="A1.SS5.1.p1.2.m2.2.3.2" xref="A1.SS5.1.p1.2.m2.2.3.2.cmml"><mi id="A1.SS5.1.p1.2.m2.2.3.2.2" xref="A1.SS5.1.p1.2.m2.2.3.2.2.cmml">r</mi><mo id="A1.SS5.1.p1.2.m2.2.3.2.3" xref="A1.SS5.1.p1.2.m2.2.3.2.3.cmml">′</mo></msup><mo id="A1.SS5.1.p1.2.m2.2.3.1" xref="A1.SS5.1.p1.2.m2.2.3.1.cmml">⁢</mo><mrow id="A1.SS5.1.p1.2.m2.2.3.3.2" xref="A1.SS5.1.p1.2.m2.2.3.3.1.cmml"><mo id="A1.SS5.1.p1.2.m2.2.3.3.2.1" stretchy="false" xref="A1.SS5.1.p1.2.m2.2.3.3.1.cmml">(</mo><mi id="A1.SS5.1.p1.2.m2.1.1" xref="A1.SS5.1.p1.2.m2.1.1.cmml">x</mi><mo id="A1.SS5.1.p1.2.m2.2.3.3.2.2" xref="A1.SS5.1.p1.2.m2.2.3.3.1.cmml">,</mo><mi id="A1.SS5.1.p1.2.m2.2.2" xref="A1.SS5.1.p1.2.m2.2.2.cmml">y</mi><mo id="A1.SS5.1.p1.2.m2.2.3.3.2.3" stretchy="false" xref="A1.SS5.1.p1.2.m2.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.2.m2.2b"><apply id="A1.SS5.1.p1.2.m2.2.3.cmml" xref="A1.SS5.1.p1.2.m2.2.3"><times id="A1.SS5.1.p1.2.m2.2.3.1.cmml" xref="A1.SS5.1.p1.2.m2.2.3.1"></times><apply id="A1.SS5.1.p1.2.m2.2.3.2.cmml" xref="A1.SS5.1.p1.2.m2.2.3.2"><csymbol cd="ambiguous" id="A1.SS5.1.p1.2.m2.2.3.2.1.cmml" xref="A1.SS5.1.p1.2.m2.2.3.2">superscript</csymbol><ci id="A1.SS5.1.p1.2.m2.2.3.2.2.cmml" xref="A1.SS5.1.p1.2.m2.2.3.2.2">𝑟</ci><ci id="A1.SS5.1.p1.2.m2.2.3.2.3.cmml" xref="A1.SS5.1.p1.2.m2.2.3.2.3">′</ci></apply><interval closure="open" id="A1.SS5.1.p1.2.m2.2.3.3.1.cmml" xref="A1.SS5.1.p1.2.m2.2.3.3.2"><ci id="A1.SS5.1.p1.2.m2.1.1.cmml" xref="A1.SS5.1.p1.2.m2.1.1">𝑥</ci><ci id="A1.SS5.1.p1.2.m2.2.2.cmml" xref="A1.SS5.1.p1.2.m2.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.2.m2.2c">r^{\prime}(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.2.m2.2d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y )</annotation></semantics></math> are from the same equivalence class if <math alttext="r^{\prime}(x,y)=r(x,y)+f(x)" class="ltx_Math" display="inline" id="A1.SS5.1.p1.3.m3.5"><semantics id="A1.SS5.1.p1.3.m3.5a"><mrow id="A1.SS5.1.p1.3.m3.5.6" xref="A1.SS5.1.p1.3.m3.5.6.cmml"><mrow id="A1.SS5.1.p1.3.m3.5.6.2" xref="A1.SS5.1.p1.3.m3.5.6.2.cmml"><msup id="A1.SS5.1.p1.3.m3.5.6.2.2" xref="A1.SS5.1.p1.3.m3.5.6.2.2.cmml"><mi id="A1.SS5.1.p1.3.m3.5.6.2.2.2" xref="A1.SS5.1.p1.3.m3.5.6.2.2.2.cmml">r</mi><mo id="A1.SS5.1.p1.3.m3.5.6.2.2.3" xref="A1.SS5.1.p1.3.m3.5.6.2.2.3.cmml">′</mo></msup><mo id="A1.SS5.1.p1.3.m3.5.6.2.1" xref="A1.SS5.1.p1.3.m3.5.6.2.1.cmml">⁢</mo><mrow id="A1.SS5.1.p1.3.m3.5.6.2.3.2" xref="A1.SS5.1.p1.3.m3.5.6.2.3.1.cmml"><mo id="A1.SS5.1.p1.3.m3.5.6.2.3.2.1" stretchy="false" xref="A1.SS5.1.p1.3.m3.5.6.2.3.1.cmml">(</mo><mi id="A1.SS5.1.p1.3.m3.1.1" xref="A1.SS5.1.p1.3.m3.1.1.cmml">x</mi><mo id="A1.SS5.1.p1.3.m3.5.6.2.3.2.2" xref="A1.SS5.1.p1.3.m3.5.6.2.3.1.cmml">,</mo><mi id="A1.SS5.1.p1.3.m3.2.2" xref="A1.SS5.1.p1.3.m3.2.2.cmml">y</mi><mo id="A1.SS5.1.p1.3.m3.5.6.2.3.2.3" stretchy="false" xref="A1.SS5.1.p1.3.m3.5.6.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS5.1.p1.3.m3.5.6.1" xref="A1.SS5.1.p1.3.m3.5.6.1.cmml">=</mo><mrow id="A1.SS5.1.p1.3.m3.5.6.3" xref="A1.SS5.1.p1.3.m3.5.6.3.cmml"><mrow id="A1.SS5.1.p1.3.m3.5.6.3.2" xref="A1.SS5.1.p1.3.m3.5.6.3.2.cmml"><mi id="A1.SS5.1.p1.3.m3.5.6.3.2.2" xref="A1.SS5.1.p1.3.m3.5.6.3.2.2.cmml">r</mi><mo id="A1.SS5.1.p1.3.m3.5.6.3.2.1" xref="A1.SS5.1.p1.3.m3.5.6.3.2.1.cmml">⁢</mo><mrow id="A1.SS5.1.p1.3.m3.5.6.3.2.3.2" xref="A1.SS5.1.p1.3.m3.5.6.3.2.3.1.cmml"><mo id="A1.SS5.1.p1.3.m3.5.6.3.2.3.2.1" stretchy="false" xref="A1.SS5.1.p1.3.m3.5.6.3.2.3.1.cmml">(</mo><mi id="A1.SS5.1.p1.3.m3.3.3" xref="A1.SS5.1.p1.3.m3.3.3.cmml">x</mi><mo id="A1.SS5.1.p1.3.m3.5.6.3.2.3.2.2" xref="A1.SS5.1.p1.3.m3.5.6.3.2.3.1.cmml">,</mo><mi id="A1.SS5.1.p1.3.m3.4.4" xref="A1.SS5.1.p1.3.m3.4.4.cmml">y</mi><mo id="A1.SS5.1.p1.3.m3.5.6.3.2.3.2.3" stretchy="false" xref="A1.SS5.1.p1.3.m3.5.6.3.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS5.1.p1.3.m3.5.6.3.1" xref="A1.SS5.1.p1.3.m3.5.6.3.1.cmml">+</mo><mrow id="A1.SS5.1.p1.3.m3.5.6.3.3" xref="A1.SS5.1.p1.3.m3.5.6.3.3.cmml"><mi id="A1.SS5.1.p1.3.m3.5.6.3.3.2" xref="A1.SS5.1.p1.3.m3.5.6.3.3.2.cmml">f</mi><mo id="A1.SS5.1.p1.3.m3.5.6.3.3.1" xref="A1.SS5.1.p1.3.m3.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.SS5.1.p1.3.m3.5.6.3.3.3.2" xref="A1.SS5.1.p1.3.m3.5.6.3.3.cmml"><mo id="A1.SS5.1.p1.3.m3.5.6.3.3.3.2.1" stretchy="false" xref="A1.SS5.1.p1.3.m3.5.6.3.3.cmml">(</mo><mi id="A1.SS5.1.p1.3.m3.5.5" xref="A1.SS5.1.p1.3.m3.5.5.cmml">x</mi><mo id="A1.SS5.1.p1.3.m3.5.6.3.3.3.2.2" stretchy="false" xref="A1.SS5.1.p1.3.m3.5.6.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.3.m3.5b"><apply id="A1.SS5.1.p1.3.m3.5.6.cmml" xref="A1.SS5.1.p1.3.m3.5.6"><eq id="A1.SS5.1.p1.3.m3.5.6.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.1"></eq><apply id="A1.SS5.1.p1.3.m3.5.6.2.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2"><times id="A1.SS5.1.p1.3.m3.5.6.2.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2.1"></times><apply id="A1.SS5.1.p1.3.m3.5.6.2.2.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2.2"><csymbol cd="ambiguous" id="A1.SS5.1.p1.3.m3.5.6.2.2.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2.2">superscript</csymbol><ci id="A1.SS5.1.p1.3.m3.5.6.2.2.2.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2.2.2">𝑟</ci><ci id="A1.SS5.1.p1.3.m3.5.6.2.2.3.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2.2.3">′</ci></apply><interval closure="open" id="A1.SS5.1.p1.3.m3.5.6.2.3.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.2.3.2"><ci id="A1.SS5.1.p1.3.m3.1.1.cmml" xref="A1.SS5.1.p1.3.m3.1.1">𝑥</ci><ci id="A1.SS5.1.p1.3.m3.2.2.cmml" xref="A1.SS5.1.p1.3.m3.2.2">𝑦</ci></interval></apply><apply id="A1.SS5.1.p1.3.m3.5.6.3.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3"><plus id="A1.SS5.1.p1.3.m3.5.6.3.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.1"></plus><apply id="A1.SS5.1.p1.3.m3.5.6.3.2.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.2"><times id="A1.SS5.1.p1.3.m3.5.6.3.2.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.2.1"></times><ci id="A1.SS5.1.p1.3.m3.5.6.3.2.2.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.2.2">𝑟</ci><interval closure="open" id="A1.SS5.1.p1.3.m3.5.6.3.2.3.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.2.3.2"><ci id="A1.SS5.1.p1.3.m3.3.3.cmml" xref="A1.SS5.1.p1.3.m3.3.3">𝑥</ci><ci id="A1.SS5.1.p1.3.m3.4.4.cmml" xref="A1.SS5.1.p1.3.m3.4.4">𝑦</ci></interval></apply><apply id="A1.SS5.1.p1.3.m3.5.6.3.3.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.3"><times id="A1.SS5.1.p1.3.m3.5.6.3.3.1.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.3.1"></times><ci id="A1.SS5.1.p1.3.m3.5.6.3.3.2.cmml" xref="A1.SS5.1.p1.3.m3.5.6.3.3.2">𝑓</ci><ci id="A1.SS5.1.p1.3.m3.5.5.cmml" xref="A1.SS5.1.p1.3.m3.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.3.m3.5c">r^{\prime}(x,y)=r(x,y)+f(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.3.m3.5d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_r ( italic_x , italic_y ) + italic_f ( italic_x )</annotation></semantics></math> for some function <math alttext="f" class="ltx_Math" display="inline" id="A1.SS5.1.p1.4.m4.1"><semantics id="A1.SS5.1.p1.4.m4.1a"><mi id="A1.SS5.1.p1.4.m4.1.1" xref="A1.SS5.1.p1.4.m4.1.1.cmml">f</mi><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.4.m4.1b"><ci id="A1.SS5.1.p1.4.m4.1.1.cmml" xref="A1.SS5.1.p1.4.m4.1.1">𝑓</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.4.m4.1c">f</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.4.m4.1d">italic_f</annotation></semantics></math>. We consider the general Plackett-Luce (with the Bradley-Terry model a special case for <math alttext="K=2" class="ltx_Math" display="inline" id="A1.SS5.1.p1.5.m5.1"><semantics id="A1.SS5.1.p1.5.m5.1a"><mrow id="A1.SS5.1.p1.5.m5.1.1" xref="A1.SS5.1.p1.5.m5.1.1.cmml"><mi id="A1.SS5.1.p1.5.m5.1.1.2" xref="A1.SS5.1.p1.5.m5.1.1.2.cmml">K</mi><mo id="A1.SS5.1.p1.5.m5.1.1.1" xref="A1.SS5.1.p1.5.m5.1.1.1.cmml">=</mo><mn id="A1.SS5.1.p1.5.m5.1.1.3" xref="A1.SS5.1.p1.5.m5.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.5.m5.1b"><apply id="A1.SS5.1.p1.5.m5.1.1.cmml" xref="A1.SS5.1.p1.5.m5.1.1"><eq id="A1.SS5.1.p1.5.m5.1.1.1.cmml" xref="A1.SS5.1.p1.5.m5.1.1.1"></eq><ci id="A1.SS5.1.p1.5.m5.1.1.2.cmml" xref="A1.SS5.1.p1.5.m5.1.1.2">𝐾</ci><cn id="A1.SS5.1.p1.5.m5.1.1.3.cmml" type="integer" xref="A1.SS5.1.p1.5.m5.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.5.m5.1c">K=2</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.5.m5.1d">italic_K = 2</annotation></semantics></math>) and denote the probability distribution over rankings induced by a particular reward function <math alttext="r(x,y)" class="ltx_Math" display="inline" id="A1.SS5.1.p1.6.m6.2"><semantics id="A1.SS5.1.p1.6.m6.2a"><mrow id="A1.SS5.1.p1.6.m6.2.3" xref="A1.SS5.1.p1.6.m6.2.3.cmml"><mi id="A1.SS5.1.p1.6.m6.2.3.2" xref="A1.SS5.1.p1.6.m6.2.3.2.cmml">r</mi><mo id="A1.SS5.1.p1.6.m6.2.3.1" xref="A1.SS5.1.p1.6.m6.2.3.1.cmml">⁢</mo><mrow id="A1.SS5.1.p1.6.m6.2.3.3.2" xref="A1.SS5.1.p1.6.m6.2.3.3.1.cmml"><mo id="A1.SS5.1.p1.6.m6.2.3.3.2.1" stretchy="false" xref="A1.SS5.1.p1.6.m6.2.3.3.1.cmml">(</mo><mi id="A1.SS5.1.p1.6.m6.1.1" xref="A1.SS5.1.p1.6.m6.1.1.cmml">x</mi><mo id="A1.SS5.1.p1.6.m6.2.3.3.2.2" xref="A1.SS5.1.p1.6.m6.2.3.3.1.cmml">,</mo><mi id="A1.SS5.1.p1.6.m6.2.2" xref="A1.SS5.1.p1.6.m6.2.2.cmml">y</mi><mo id="A1.SS5.1.p1.6.m6.2.3.3.2.3" stretchy="false" xref="A1.SS5.1.p1.6.m6.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.6.m6.2b"><apply id="A1.SS5.1.p1.6.m6.2.3.cmml" xref="A1.SS5.1.p1.6.m6.2.3"><times id="A1.SS5.1.p1.6.m6.2.3.1.cmml" xref="A1.SS5.1.p1.6.m6.2.3.1"></times><ci id="A1.SS5.1.p1.6.m6.2.3.2.cmml" xref="A1.SS5.1.p1.6.m6.2.3.2">𝑟</ci><interval closure="open" id="A1.SS5.1.p1.6.m6.2.3.3.1.cmml" xref="A1.SS5.1.p1.6.m6.2.3.3.2"><ci id="A1.SS5.1.p1.6.m6.1.1.cmml" xref="A1.SS5.1.p1.6.m6.1.1">𝑥</ci><ci id="A1.SS5.1.p1.6.m6.2.2.cmml" xref="A1.SS5.1.p1.6.m6.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.6.m6.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.6.m6.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math> as <math alttext="p_{r}" class="ltx_Math" display="inline" id="A1.SS5.1.p1.7.m7.1"><semantics id="A1.SS5.1.p1.7.m7.1a"><msub id="A1.SS5.1.p1.7.m7.1.1" xref="A1.SS5.1.p1.7.m7.1.1.cmml"><mi id="A1.SS5.1.p1.7.m7.1.1.2" xref="A1.SS5.1.p1.7.m7.1.1.2.cmml">p</mi><mi id="A1.SS5.1.p1.7.m7.1.1.3" xref="A1.SS5.1.p1.7.m7.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.7.m7.1b"><apply id="A1.SS5.1.p1.7.m7.1.1.cmml" xref="A1.SS5.1.p1.7.m7.1.1"><csymbol cd="ambiguous" id="A1.SS5.1.p1.7.m7.1.1.1.cmml" xref="A1.SS5.1.p1.7.m7.1.1">subscript</csymbol><ci id="A1.SS5.1.p1.7.m7.1.1.2.cmml" xref="A1.SS5.1.p1.7.m7.1.1.2">𝑝</ci><ci id="A1.SS5.1.p1.7.m7.1.1.3.cmml" xref="A1.SS5.1.p1.7.m7.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.7.m7.1c">p_{r}</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.7.m7.1d">italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math>. For any prompt <math alttext="x" class="ltx_Math" display="inline" id="A1.SS5.1.p1.8.m8.1"><semantics id="A1.SS5.1.p1.8.m8.1a"><mi id="A1.SS5.1.p1.8.m8.1.1" xref="A1.SS5.1.p1.8.m8.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.8.m8.1b"><ci id="A1.SS5.1.p1.8.m8.1.1.cmml" xref="A1.SS5.1.p1.8.m8.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.8.m8.1c">x</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.8.m8.1d">italic_x</annotation></semantics></math>, answers <math alttext="y_{1},\ldots,y_{K}" class="ltx_Math" display="inline" id="A1.SS5.1.p1.9.m9.3"><semantics id="A1.SS5.1.p1.9.m9.3a"><mrow id="A1.SS5.1.p1.9.m9.3.3.2" xref="A1.SS5.1.p1.9.m9.3.3.3.cmml"><msub id="A1.SS5.1.p1.9.m9.2.2.1.1" xref="A1.SS5.1.p1.9.m9.2.2.1.1.cmml"><mi id="A1.SS5.1.p1.9.m9.2.2.1.1.2" xref="A1.SS5.1.p1.9.m9.2.2.1.1.2.cmml">y</mi><mn id="A1.SS5.1.p1.9.m9.2.2.1.1.3" xref="A1.SS5.1.p1.9.m9.2.2.1.1.3.cmml">1</mn></msub><mo id="A1.SS5.1.p1.9.m9.3.3.2.3" xref="A1.SS5.1.p1.9.m9.3.3.3.cmml">,</mo><mi id="A1.SS5.1.p1.9.m9.1.1" mathvariant="normal" xref="A1.SS5.1.p1.9.m9.1.1.cmml">…</mi><mo id="A1.SS5.1.p1.9.m9.3.3.2.4" xref="A1.SS5.1.p1.9.m9.3.3.3.cmml">,</mo><msub id="A1.SS5.1.p1.9.m9.3.3.2.2" xref="A1.SS5.1.p1.9.m9.3.3.2.2.cmml"><mi id="A1.SS5.1.p1.9.m9.3.3.2.2.2" xref="A1.SS5.1.p1.9.m9.3.3.2.2.2.cmml">y</mi><mi id="A1.SS5.1.p1.9.m9.3.3.2.2.3" xref="A1.SS5.1.p1.9.m9.3.3.2.2.3.cmml">K</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.9.m9.3b"><list id="A1.SS5.1.p1.9.m9.3.3.3.cmml" xref="A1.SS5.1.p1.9.m9.3.3.2"><apply id="A1.SS5.1.p1.9.m9.2.2.1.1.cmml" xref="A1.SS5.1.p1.9.m9.2.2.1.1"><csymbol cd="ambiguous" id="A1.SS5.1.p1.9.m9.2.2.1.1.1.cmml" xref="A1.SS5.1.p1.9.m9.2.2.1.1">subscript</csymbol><ci id="A1.SS5.1.p1.9.m9.2.2.1.1.2.cmml" xref="A1.SS5.1.p1.9.m9.2.2.1.1.2">𝑦</ci><cn id="A1.SS5.1.p1.9.m9.2.2.1.1.3.cmml" type="integer" xref="A1.SS5.1.p1.9.m9.2.2.1.1.3">1</cn></apply><ci id="A1.SS5.1.p1.9.m9.1.1.cmml" xref="A1.SS5.1.p1.9.m9.1.1">…</ci><apply id="A1.SS5.1.p1.9.m9.3.3.2.2.cmml" xref="A1.SS5.1.p1.9.m9.3.3.2.2"><csymbol cd="ambiguous" id="A1.SS5.1.p1.9.m9.3.3.2.2.1.cmml" xref="A1.SS5.1.p1.9.m9.3.3.2.2">subscript</csymbol><ci id="A1.SS5.1.p1.9.m9.3.3.2.2.2.cmml" xref="A1.SS5.1.p1.9.m9.3.3.2.2.2">𝑦</ci><ci id="A1.SS5.1.p1.9.m9.3.3.2.2.3.cmml" xref="A1.SS5.1.p1.9.m9.3.3.2.2.3">𝐾</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.9.m9.3c">y_{1},\ldots,y_{K}</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.9.m9.3d">italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT</annotation></semantics></math> and ranking <math alttext="\tau" class="ltx_Math" display="inline" id="A1.SS5.1.p1.10.m10.1"><semantics id="A1.SS5.1.p1.10.m10.1a"><mi id="A1.SS5.1.p1.10.m10.1.1" xref="A1.SS5.1.p1.10.m10.1.1.cmml">τ</mi><annotation-xml encoding="MathML-Content" id="A1.SS5.1.p1.10.m10.1b"><ci id="A1.SS5.1.p1.10.m10.1.1.cmml" xref="A1.SS5.1.p1.10.m10.1.1">𝜏</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.1.p1.10.m10.1c">\tau</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.1.p1.10.m10.1d">italic_τ</annotation></semantics></math> we have:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx6">
<tbody id="A1.Ex9"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle p_{r^{\prime}}(\tau|y_{1},\ldots,y_{K},x)" class="ltx_Math" display="inline" id="A1.Ex9.m1.3"><semantics id="A1.Ex9.m1.3a"><mrow id="A1.Ex9.m1.3.3" xref="A1.Ex9.m1.3.3.cmml"><msub id="A1.Ex9.m1.3.3.3" xref="A1.Ex9.m1.3.3.3.cmml"><mi id="A1.Ex9.m1.3.3.3.2" xref="A1.Ex9.m1.3.3.3.2.cmml">p</mi><msup id="A1.Ex9.m1.3.3.3.3" xref="A1.Ex9.m1.3.3.3.3.cmml"><mi id="A1.Ex9.m1.3.3.3.3.2" xref="A1.Ex9.m1.3.3.3.3.2.cmml">r</mi><mo id="A1.Ex9.m1.3.3.3.3.3" xref="A1.Ex9.m1.3.3.3.3.3.cmml">′</mo></msup></msub><mo id="A1.Ex9.m1.3.3.2" xref="A1.Ex9.m1.3.3.2.cmml">⁢</mo><mrow id="A1.Ex9.m1.3.3.1.1" xref="A1.Ex9.m1.3.3.1.1.1.cmml"><mo id="A1.Ex9.m1.3.3.1.1.2" stretchy="false" xref="A1.Ex9.m1.3.3.1.1.1.cmml">(</mo><mrow id="A1.Ex9.m1.3.3.1.1.1" xref="A1.Ex9.m1.3.3.1.1.1.cmml"><mi id="A1.Ex9.m1.3.3.1.1.1.4" xref="A1.Ex9.m1.3.3.1.1.1.4.cmml">τ</mi><mo fence="false" id="A1.Ex9.m1.3.3.1.1.1.3" xref="A1.Ex9.m1.3.3.1.1.1.3.cmml">|</mo><mrow id="A1.Ex9.m1.3.3.1.1.1.2.2" xref="A1.Ex9.m1.3.3.1.1.1.2.3.cmml"><msub id="A1.Ex9.m1.3.3.1.1.1.1.1.1" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1.cmml"><mi id="A1.Ex9.m1.3.3.1.1.1.1.1.1.2" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.Ex9.m1.3.3.1.1.1.1.1.1.3" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.Ex9.m1.3.3.1.1.1.2.2.3" xref="A1.Ex9.m1.3.3.1.1.1.2.3.cmml">,</mo><mi id="A1.Ex9.m1.1.1" mathvariant="normal" xref="A1.Ex9.m1.1.1.cmml">…</mi><mo id="A1.Ex9.m1.3.3.1.1.1.2.2.4" xref="A1.Ex9.m1.3.3.1.1.1.2.3.cmml">,</mo><msub id="A1.Ex9.m1.3.3.1.1.1.2.2.2" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2.cmml"><mi id="A1.Ex9.m1.3.3.1.1.1.2.2.2.2" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2.2.cmml">y</mi><mi id="A1.Ex9.m1.3.3.1.1.1.2.2.2.3" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2.3.cmml">K</mi></msub><mo id="A1.Ex9.m1.3.3.1.1.1.2.2.5" xref="A1.Ex9.m1.3.3.1.1.1.2.3.cmml">,</mo><mi id="A1.Ex9.m1.2.2" xref="A1.Ex9.m1.2.2.cmml">x</mi></mrow></mrow><mo id="A1.Ex9.m1.3.3.1.1.3" stretchy="false" xref="A1.Ex9.m1.3.3.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex9.m1.3b"><apply id="A1.Ex9.m1.3.3.cmml" xref="A1.Ex9.m1.3.3"><times id="A1.Ex9.m1.3.3.2.cmml" xref="A1.Ex9.m1.3.3.2"></times><apply id="A1.Ex9.m1.3.3.3.cmml" xref="A1.Ex9.m1.3.3.3"><csymbol cd="ambiguous" id="A1.Ex9.m1.3.3.3.1.cmml" xref="A1.Ex9.m1.3.3.3">subscript</csymbol><ci id="A1.Ex9.m1.3.3.3.2.cmml" xref="A1.Ex9.m1.3.3.3.2">𝑝</ci><apply id="A1.Ex9.m1.3.3.3.3.cmml" xref="A1.Ex9.m1.3.3.3.3"><csymbol cd="ambiguous" id="A1.Ex9.m1.3.3.3.3.1.cmml" xref="A1.Ex9.m1.3.3.3.3">superscript</csymbol><ci id="A1.Ex9.m1.3.3.3.3.2.cmml" xref="A1.Ex9.m1.3.3.3.3.2">𝑟</ci><ci id="A1.Ex9.m1.3.3.3.3.3.cmml" xref="A1.Ex9.m1.3.3.3.3.3">′</ci></apply></apply><apply id="A1.Ex9.m1.3.3.1.1.1.cmml" xref="A1.Ex9.m1.3.3.1.1"><csymbol cd="latexml" id="A1.Ex9.m1.3.3.1.1.1.3.cmml" xref="A1.Ex9.m1.3.3.1.1.1.3">conditional</csymbol><ci id="A1.Ex9.m1.3.3.1.1.1.4.cmml" xref="A1.Ex9.m1.3.3.1.1.1.4">𝜏</ci><list id="A1.Ex9.m1.3.3.1.1.1.2.3.cmml" xref="A1.Ex9.m1.3.3.1.1.1.2.2"><apply id="A1.Ex9.m1.3.3.1.1.1.1.1.1.cmml" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex9.m1.3.3.1.1.1.1.1.1.1.cmml" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex9.m1.3.3.1.1.1.1.1.1.2.cmml" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.Ex9.m1.3.3.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.Ex9.m1.3.3.1.1.1.1.1.1.3">1</cn></apply><ci id="A1.Ex9.m1.1.1.cmml" xref="A1.Ex9.m1.1.1">…</ci><apply id="A1.Ex9.m1.3.3.1.1.1.2.2.2.cmml" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2"><csymbol cd="ambiguous" id="A1.Ex9.m1.3.3.1.1.1.2.2.2.1.cmml" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2">subscript</csymbol><ci id="A1.Ex9.m1.3.3.1.1.1.2.2.2.2.cmml" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2.2">𝑦</ci><ci id="A1.Ex9.m1.3.3.1.1.1.2.2.2.3.cmml" xref="A1.Ex9.m1.3.3.1.1.1.2.2.2.3">𝐾</ci></apply><ci id="A1.Ex9.m1.2.2.cmml" xref="A1.Ex9.m1.2.2">𝑥</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex9.m1.3c">\displaystyle p_{r^{\prime}}(\tau|y_{1},\ldots,y_{K},x)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex9.m1.3d">italic_p start_POSTSUBSCRIPT italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT ( italic_τ | italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_x )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\prod_{k=1}^{K}\frac{\exp(r^{\prime}(x,y_{\tau(k)}))}{\sum_{j=k}%
^{K}\exp(r^{\prime}(x,y_{\tau(j)}))}" class="ltx_Math" display="inline" id="A1.Ex9.m2.8"><semantics id="A1.Ex9.m2.8a"><mrow id="A1.Ex9.m2.8.9" xref="A1.Ex9.m2.8.9.cmml"><mi id="A1.Ex9.m2.8.9.2" xref="A1.Ex9.m2.8.9.2.cmml"></mi><mo id="A1.Ex9.m2.8.9.1" xref="A1.Ex9.m2.8.9.1.cmml">=</mo><mrow id="A1.Ex9.m2.8.9.3" xref="A1.Ex9.m2.8.9.3.cmml"><mstyle displaystyle="true" id="A1.Ex9.m2.8.9.3.1" xref="A1.Ex9.m2.8.9.3.1.cmml"><munderover id="A1.Ex9.m2.8.9.3.1a" xref="A1.Ex9.m2.8.9.3.1.cmml"><mo id="A1.Ex9.m2.8.9.3.1.2.2" movablelimits="false" xref="A1.Ex9.m2.8.9.3.1.2.2.cmml">∏</mo><mrow id="A1.Ex9.m2.8.9.3.1.2.3" xref="A1.Ex9.m2.8.9.3.1.2.3.cmml"><mi id="A1.Ex9.m2.8.9.3.1.2.3.2" xref="A1.Ex9.m2.8.9.3.1.2.3.2.cmml">k</mi><mo id="A1.Ex9.m2.8.9.3.1.2.3.1" xref="A1.Ex9.m2.8.9.3.1.2.3.1.cmml">=</mo><mn id="A1.Ex9.m2.8.9.3.1.2.3.3" xref="A1.Ex9.m2.8.9.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.Ex9.m2.8.9.3.1.3" xref="A1.Ex9.m2.8.9.3.1.3.cmml">K</mi></munderover></mstyle><mstyle displaystyle="true" id="A1.Ex9.m2.8.8" xref="A1.Ex9.m2.8.8.cmml"><mfrac id="A1.Ex9.m2.8.8a" xref="A1.Ex9.m2.8.8.cmml"><mrow id="A1.Ex9.m2.4.4.4.4" xref="A1.Ex9.m2.4.4.4.5.cmml"><mi id="A1.Ex9.m2.3.3.3.3" xref="A1.Ex9.m2.3.3.3.3.cmml">exp</mi><mo id="A1.Ex9.m2.4.4.4.4a" xref="A1.Ex9.m2.4.4.4.5.cmml">⁡</mo><mrow id="A1.Ex9.m2.4.4.4.4.1" xref="A1.Ex9.m2.4.4.4.5.cmml"><mo id="A1.Ex9.m2.4.4.4.4.1.2" stretchy="false" xref="A1.Ex9.m2.4.4.4.5.cmml">(</mo><mrow id="A1.Ex9.m2.4.4.4.4.1.1" xref="A1.Ex9.m2.4.4.4.4.1.1.cmml"><msup id="A1.Ex9.m2.4.4.4.4.1.1.3" xref="A1.Ex9.m2.4.4.4.4.1.1.3.cmml"><mi id="A1.Ex9.m2.4.4.4.4.1.1.3.2" xref="A1.Ex9.m2.4.4.4.4.1.1.3.2.cmml">r</mi><mo id="A1.Ex9.m2.4.4.4.4.1.1.3.3" xref="A1.Ex9.m2.4.4.4.4.1.1.3.3.cmml">′</mo></msup><mo id="A1.Ex9.m2.4.4.4.4.1.1.2" xref="A1.Ex9.m2.4.4.4.4.1.1.2.cmml">⁢</mo><mrow id="A1.Ex9.m2.4.4.4.4.1.1.1.1" xref="A1.Ex9.m2.4.4.4.4.1.1.1.2.cmml"><mo id="A1.Ex9.m2.4.4.4.4.1.1.1.1.2" stretchy="false" xref="A1.Ex9.m2.4.4.4.4.1.1.1.2.cmml">(</mo><mi id="A1.Ex9.m2.2.2.2.2" xref="A1.Ex9.m2.2.2.2.2.cmml">x</mi><mo id="A1.Ex9.m2.4.4.4.4.1.1.1.1.3" xref="A1.Ex9.m2.4.4.4.4.1.1.1.2.cmml">,</mo><msub id="A1.Ex9.m2.4.4.4.4.1.1.1.1.1" xref="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.cmml"><mi id="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.2" xref="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex9.m2.1.1.1.1.1" xref="A1.Ex9.m2.1.1.1.1.1.cmml"><mi id="A1.Ex9.m2.1.1.1.1.1.3" xref="A1.Ex9.m2.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.Ex9.m2.1.1.1.1.1.2" xref="A1.Ex9.m2.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex9.m2.1.1.1.1.1.4.2" xref="A1.Ex9.m2.1.1.1.1.1.cmml"><mo id="A1.Ex9.m2.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.Ex9.m2.1.1.1.1.1.cmml">(</mo><mi id="A1.Ex9.m2.1.1.1.1.1.1" xref="A1.Ex9.m2.1.1.1.1.1.1.cmml">k</mi><mo id="A1.Ex9.m2.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.Ex9.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex9.m2.4.4.4.4.1.1.1.1.4" stretchy="false" xref="A1.Ex9.m2.4.4.4.4.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex9.m2.4.4.4.4.1.3" stretchy="false" xref="A1.Ex9.m2.4.4.4.5.cmml">)</mo></mrow></mrow><mrow id="A1.Ex9.m2.8.8.8" xref="A1.Ex9.m2.8.8.8.cmml"><msubsup id="A1.Ex9.m2.8.8.8.5" xref="A1.Ex9.m2.8.8.8.5.cmml"><mo id="A1.Ex9.m2.8.8.8.5.2.2" xref="A1.Ex9.m2.8.8.8.5.2.2.cmml">∑</mo><mrow id="A1.Ex9.m2.8.8.8.5.2.3" xref="A1.Ex9.m2.8.8.8.5.2.3.cmml"><mi id="A1.Ex9.m2.8.8.8.5.2.3.2" xref="A1.Ex9.m2.8.8.8.5.2.3.2.cmml">j</mi><mo id="A1.Ex9.m2.8.8.8.5.2.3.1" xref="A1.Ex9.m2.8.8.8.5.2.3.1.cmml">=</mo><mi id="A1.Ex9.m2.8.8.8.5.2.3.3" xref="A1.Ex9.m2.8.8.8.5.2.3.3.cmml">k</mi></mrow><mi id="A1.Ex9.m2.8.8.8.5.3" xref="A1.Ex9.m2.8.8.8.5.3.cmml">K</mi></msubsup><mrow id="A1.Ex9.m2.8.8.8.4.1" xref="A1.Ex9.m2.8.8.8.4.2.cmml"><mi id="A1.Ex9.m2.7.7.7.3" xref="A1.Ex9.m2.7.7.7.3.cmml">exp</mi><mo id="A1.Ex9.m2.8.8.8.4.1a" xref="A1.Ex9.m2.8.8.8.4.2.cmml">⁡</mo><mrow id="A1.Ex9.m2.8.8.8.4.1.1" xref="A1.Ex9.m2.8.8.8.4.2.cmml"><mo id="A1.Ex9.m2.8.8.8.4.1.1.2" stretchy="false" xref="A1.Ex9.m2.8.8.8.4.2.cmml">(</mo><mrow id="A1.Ex9.m2.8.8.8.4.1.1.1" xref="A1.Ex9.m2.8.8.8.4.1.1.1.cmml"><msup id="A1.Ex9.m2.8.8.8.4.1.1.1.3" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3.cmml"><mi id="A1.Ex9.m2.8.8.8.4.1.1.1.3.2" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3.2.cmml">r</mi><mo id="A1.Ex9.m2.8.8.8.4.1.1.1.3.3" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3.3.cmml">′</mo></msup><mo id="A1.Ex9.m2.8.8.8.4.1.1.1.2" xref="A1.Ex9.m2.8.8.8.4.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.2.cmml"><mo id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.2" stretchy="false" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.2.cmml">(</mo><mi id="A1.Ex9.m2.6.6.6.2" xref="A1.Ex9.m2.6.6.6.2.cmml">x</mi><mo id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.3" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.2.cmml">,</mo><msub id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.cmml"><mi id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.2" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex9.m2.5.5.5.1.1" xref="A1.Ex9.m2.5.5.5.1.1.cmml"><mi id="A1.Ex9.m2.5.5.5.1.1.3" xref="A1.Ex9.m2.5.5.5.1.1.3.cmml">τ</mi><mo id="A1.Ex9.m2.5.5.5.1.1.2" xref="A1.Ex9.m2.5.5.5.1.1.2.cmml">⁢</mo><mrow id="A1.Ex9.m2.5.5.5.1.1.4.2" xref="A1.Ex9.m2.5.5.5.1.1.cmml"><mo id="A1.Ex9.m2.5.5.5.1.1.4.2.1" stretchy="false" xref="A1.Ex9.m2.5.5.5.1.1.cmml">(</mo><mi id="A1.Ex9.m2.5.5.5.1.1.1" xref="A1.Ex9.m2.5.5.5.1.1.1.cmml">j</mi><mo id="A1.Ex9.m2.5.5.5.1.1.4.2.2" stretchy="false" xref="A1.Ex9.m2.5.5.5.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.4" stretchy="false" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex9.m2.8.8.8.4.1.1.3" stretchy="false" xref="A1.Ex9.m2.8.8.8.4.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex9.m2.8b"><apply id="A1.Ex9.m2.8.9.cmml" xref="A1.Ex9.m2.8.9"><eq id="A1.Ex9.m2.8.9.1.cmml" xref="A1.Ex9.m2.8.9.1"></eq><csymbol cd="latexml" id="A1.Ex9.m2.8.9.2.cmml" xref="A1.Ex9.m2.8.9.2">absent</csymbol><apply id="A1.Ex9.m2.8.9.3.cmml" xref="A1.Ex9.m2.8.9.3"><apply id="A1.Ex9.m2.8.9.3.1.cmml" xref="A1.Ex9.m2.8.9.3.1"><csymbol cd="ambiguous" id="A1.Ex9.m2.8.9.3.1.1.cmml" xref="A1.Ex9.m2.8.9.3.1">superscript</csymbol><apply id="A1.Ex9.m2.8.9.3.1.2.cmml" xref="A1.Ex9.m2.8.9.3.1"><csymbol cd="ambiguous" id="A1.Ex9.m2.8.9.3.1.2.1.cmml" xref="A1.Ex9.m2.8.9.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.Ex9.m2.8.9.3.1.2.2.cmml" xref="A1.Ex9.m2.8.9.3.1.2.2">product</csymbol><apply id="A1.Ex9.m2.8.9.3.1.2.3.cmml" xref="A1.Ex9.m2.8.9.3.1.2.3"><eq id="A1.Ex9.m2.8.9.3.1.2.3.1.cmml" xref="A1.Ex9.m2.8.9.3.1.2.3.1"></eq><ci id="A1.Ex9.m2.8.9.3.1.2.3.2.cmml" xref="A1.Ex9.m2.8.9.3.1.2.3.2">𝑘</ci><cn id="A1.Ex9.m2.8.9.3.1.2.3.3.cmml" type="integer" xref="A1.Ex9.m2.8.9.3.1.2.3.3">1</cn></apply></apply><ci id="A1.Ex9.m2.8.9.3.1.3.cmml" xref="A1.Ex9.m2.8.9.3.1.3">𝐾</ci></apply><apply id="A1.Ex9.m2.8.8.cmml" xref="A1.Ex9.m2.8.8"><divide id="A1.Ex9.m2.8.8.9.cmml" xref="A1.Ex9.m2.8.8"></divide><apply id="A1.Ex9.m2.4.4.4.5.cmml" xref="A1.Ex9.m2.4.4.4.4"><exp id="A1.Ex9.m2.3.3.3.3.cmml" xref="A1.Ex9.m2.3.3.3.3"></exp><apply id="A1.Ex9.m2.4.4.4.4.1.1.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1"><times id="A1.Ex9.m2.4.4.4.4.1.1.2.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.2"></times><apply id="A1.Ex9.m2.4.4.4.4.1.1.3.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.3"><csymbol cd="ambiguous" id="A1.Ex9.m2.4.4.4.4.1.1.3.1.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.3">superscript</csymbol><ci id="A1.Ex9.m2.4.4.4.4.1.1.3.2.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.3.2">𝑟</ci><ci id="A1.Ex9.m2.4.4.4.4.1.1.3.3.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.3.3">′</ci></apply><interval closure="open" id="A1.Ex9.m2.4.4.4.4.1.1.1.2.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.1.1"><ci id="A1.Ex9.m2.2.2.2.2.cmml" xref="A1.Ex9.m2.2.2.2.2">𝑥</ci><apply id="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.1.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.2.cmml" xref="A1.Ex9.m2.4.4.4.4.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex9.m2.1.1.1.1.1.cmml" xref="A1.Ex9.m2.1.1.1.1.1"><times id="A1.Ex9.m2.1.1.1.1.1.2.cmml" xref="A1.Ex9.m2.1.1.1.1.1.2"></times><ci id="A1.Ex9.m2.1.1.1.1.1.3.cmml" xref="A1.Ex9.m2.1.1.1.1.1.3">𝜏</ci><ci id="A1.Ex9.m2.1.1.1.1.1.1.cmml" xref="A1.Ex9.m2.1.1.1.1.1.1">𝑘</ci></apply></apply></interval></apply></apply><apply id="A1.Ex9.m2.8.8.8.cmml" xref="A1.Ex9.m2.8.8.8"><apply id="A1.Ex9.m2.8.8.8.5.cmml" xref="A1.Ex9.m2.8.8.8.5"><csymbol cd="ambiguous" id="A1.Ex9.m2.8.8.8.5.1.cmml" xref="A1.Ex9.m2.8.8.8.5">superscript</csymbol><apply id="A1.Ex9.m2.8.8.8.5.2.cmml" xref="A1.Ex9.m2.8.8.8.5"><csymbol cd="ambiguous" id="A1.Ex9.m2.8.8.8.5.2.1.cmml" xref="A1.Ex9.m2.8.8.8.5">subscript</csymbol><sum id="A1.Ex9.m2.8.8.8.5.2.2.cmml" xref="A1.Ex9.m2.8.8.8.5.2.2"></sum><apply id="A1.Ex9.m2.8.8.8.5.2.3.cmml" xref="A1.Ex9.m2.8.8.8.5.2.3"><eq id="A1.Ex9.m2.8.8.8.5.2.3.1.cmml" xref="A1.Ex9.m2.8.8.8.5.2.3.1"></eq><ci id="A1.Ex9.m2.8.8.8.5.2.3.2.cmml" xref="A1.Ex9.m2.8.8.8.5.2.3.2">𝑗</ci><ci id="A1.Ex9.m2.8.8.8.5.2.3.3.cmml" xref="A1.Ex9.m2.8.8.8.5.2.3.3">𝑘</ci></apply></apply><ci id="A1.Ex9.m2.8.8.8.5.3.cmml" xref="A1.Ex9.m2.8.8.8.5.3">𝐾</ci></apply><apply id="A1.Ex9.m2.8.8.8.4.2.cmml" xref="A1.Ex9.m2.8.8.8.4.1"><exp id="A1.Ex9.m2.7.7.7.3.cmml" xref="A1.Ex9.m2.7.7.7.3"></exp><apply id="A1.Ex9.m2.8.8.8.4.1.1.1.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1"><times id="A1.Ex9.m2.8.8.8.4.1.1.1.2.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.2"></times><apply id="A1.Ex9.m2.8.8.8.4.1.1.1.3.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex9.m2.8.8.8.4.1.1.1.3.1.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3">superscript</csymbol><ci id="A1.Ex9.m2.8.8.8.4.1.1.1.3.2.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3.2">𝑟</ci><ci id="A1.Ex9.m2.8.8.8.4.1.1.1.3.3.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.3.3">′</ci></apply><interval closure="open" id="A1.Ex9.m2.8.8.8.4.1.1.1.1.2.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.1"><ci id="A1.Ex9.m2.6.6.6.2.cmml" xref="A1.Ex9.m2.6.6.6.2">𝑥</ci><apply id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.1.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.2.cmml" xref="A1.Ex9.m2.8.8.8.4.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex9.m2.5.5.5.1.1.cmml" xref="A1.Ex9.m2.5.5.5.1.1"><times id="A1.Ex9.m2.5.5.5.1.1.2.cmml" xref="A1.Ex9.m2.5.5.5.1.1.2"></times><ci id="A1.Ex9.m2.5.5.5.1.1.3.cmml" xref="A1.Ex9.m2.5.5.5.1.1.3">𝜏</ci><ci id="A1.Ex9.m2.5.5.5.1.1.1.cmml" xref="A1.Ex9.m2.5.5.5.1.1.1">𝑗</ci></apply></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex9.m2.8c">\displaystyle=\prod_{k=1}^{K}\frac{\exp(r^{\prime}(x,y_{\tau(k)}))}{\sum_{j=k}%
^{K}\exp(r^{\prime}(x,y_{\tau(j)}))}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex9.m2.8d">= ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT ) ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex10"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\prod_{k=1}^{K}\frac{\exp(r(x,y_{\tau(k)})+f(x))}{\sum_{j=k}^{K}%
\exp(r(x,y_{\tau(j)})+f(x))}" class="ltx_Math" display="inline" id="A1.Ex10.m1.10"><semantics id="A1.Ex10.m1.10a"><mrow id="A1.Ex10.m1.10.11" xref="A1.Ex10.m1.10.11.cmml"><mi id="A1.Ex10.m1.10.11.2" xref="A1.Ex10.m1.10.11.2.cmml"></mi><mo id="A1.Ex10.m1.10.11.1" xref="A1.Ex10.m1.10.11.1.cmml">=</mo><mrow id="A1.Ex10.m1.10.11.3" xref="A1.Ex10.m1.10.11.3.cmml"><mstyle displaystyle="true" id="A1.Ex10.m1.10.11.3.1" xref="A1.Ex10.m1.10.11.3.1.cmml"><munderover id="A1.Ex10.m1.10.11.3.1a" xref="A1.Ex10.m1.10.11.3.1.cmml"><mo id="A1.Ex10.m1.10.11.3.1.2.2" movablelimits="false" xref="A1.Ex10.m1.10.11.3.1.2.2.cmml">∏</mo><mrow id="A1.Ex10.m1.10.11.3.1.2.3" xref="A1.Ex10.m1.10.11.3.1.2.3.cmml"><mi id="A1.Ex10.m1.10.11.3.1.2.3.2" xref="A1.Ex10.m1.10.11.3.1.2.3.2.cmml">k</mi><mo id="A1.Ex10.m1.10.11.3.1.2.3.1" xref="A1.Ex10.m1.10.11.3.1.2.3.1.cmml">=</mo><mn id="A1.Ex10.m1.10.11.3.1.2.3.3" xref="A1.Ex10.m1.10.11.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.Ex10.m1.10.11.3.1.3" xref="A1.Ex10.m1.10.11.3.1.3.cmml">K</mi></munderover></mstyle><mstyle displaystyle="true" id="A1.Ex10.m1.10.10" xref="A1.Ex10.m1.10.10.cmml"><mfrac id="A1.Ex10.m1.10.10a" xref="A1.Ex10.m1.10.10.cmml"><mrow id="A1.Ex10.m1.5.5.5.5" xref="A1.Ex10.m1.5.5.5.6.cmml"><mi id="A1.Ex10.m1.4.4.4.4" xref="A1.Ex10.m1.4.4.4.4.cmml">exp</mi><mo id="A1.Ex10.m1.5.5.5.5a" xref="A1.Ex10.m1.5.5.5.6.cmml">⁡</mo><mrow id="A1.Ex10.m1.5.5.5.5.1" xref="A1.Ex10.m1.5.5.5.6.cmml"><mo id="A1.Ex10.m1.5.5.5.5.1.2" stretchy="false" xref="A1.Ex10.m1.5.5.5.6.cmml">(</mo><mrow id="A1.Ex10.m1.5.5.5.5.1.1" xref="A1.Ex10.m1.5.5.5.5.1.1.cmml"><mrow id="A1.Ex10.m1.5.5.5.5.1.1.1" xref="A1.Ex10.m1.5.5.5.5.1.1.1.cmml"><mi id="A1.Ex10.m1.5.5.5.5.1.1.1.3" xref="A1.Ex10.m1.5.5.5.5.1.1.1.3.cmml">r</mi><mo id="A1.Ex10.m1.5.5.5.5.1.1.1.2" xref="A1.Ex10.m1.5.5.5.5.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.2.cmml"><mo id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.2" stretchy="false" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.2.cmml">(</mo><mi id="A1.Ex10.m1.2.2.2.2" xref="A1.Ex10.m1.2.2.2.2.cmml">x</mi><mo id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.3" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.2.cmml">,</mo><msub id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.cmml"><mi id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.2" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex10.m1.1.1.1.1.1" xref="A1.Ex10.m1.1.1.1.1.1.cmml"><mi id="A1.Ex10.m1.1.1.1.1.1.3" xref="A1.Ex10.m1.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.Ex10.m1.1.1.1.1.1.2" xref="A1.Ex10.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex10.m1.1.1.1.1.1.4.2" xref="A1.Ex10.m1.1.1.1.1.1.cmml"><mo id="A1.Ex10.m1.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.Ex10.m1.1.1.1.1.1.cmml">(</mo><mi id="A1.Ex10.m1.1.1.1.1.1.1" xref="A1.Ex10.m1.1.1.1.1.1.1.cmml">k</mi><mo id="A1.Ex10.m1.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.Ex10.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.4" stretchy="false" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex10.m1.5.5.5.5.1.1.2" xref="A1.Ex10.m1.5.5.5.5.1.1.2.cmml">+</mo><mrow id="A1.Ex10.m1.5.5.5.5.1.1.3" xref="A1.Ex10.m1.5.5.5.5.1.1.3.cmml"><mi id="A1.Ex10.m1.5.5.5.5.1.1.3.2" xref="A1.Ex10.m1.5.5.5.5.1.1.3.2.cmml">f</mi><mo id="A1.Ex10.m1.5.5.5.5.1.1.3.1" xref="A1.Ex10.m1.5.5.5.5.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex10.m1.5.5.5.5.1.1.3.3.2" xref="A1.Ex10.m1.5.5.5.5.1.1.3.cmml"><mo id="A1.Ex10.m1.5.5.5.5.1.1.3.3.2.1" stretchy="false" xref="A1.Ex10.m1.5.5.5.5.1.1.3.cmml">(</mo><mi id="A1.Ex10.m1.3.3.3.3" xref="A1.Ex10.m1.3.3.3.3.cmml">x</mi><mo id="A1.Ex10.m1.5.5.5.5.1.1.3.3.2.2" stretchy="false" xref="A1.Ex10.m1.5.5.5.5.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex10.m1.5.5.5.5.1.3" stretchy="false" xref="A1.Ex10.m1.5.5.5.6.cmml">)</mo></mrow></mrow><mrow id="A1.Ex10.m1.10.10.10" xref="A1.Ex10.m1.10.10.10.cmml"><msubsup id="A1.Ex10.m1.10.10.10.6" xref="A1.Ex10.m1.10.10.10.6.cmml"><mo id="A1.Ex10.m1.10.10.10.6.2.2" xref="A1.Ex10.m1.10.10.10.6.2.2.cmml">∑</mo><mrow id="A1.Ex10.m1.10.10.10.6.2.3" xref="A1.Ex10.m1.10.10.10.6.2.3.cmml"><mi id="A1.Ex10.m1.10.10.10.6.2.3.2" xref="A1.Ex10.m1.10.10.10.6.2.3.2.cmml">j</mi><mo id="A1.Ex10.m1.10.10.10.6.2.3.1" xref="A1.Ex10.m1.10.10.10.6.2.3.1.cmml">=</mo><mi id="A1.Ex10.m1.10.10.10.6.2.3.3" xref="A1.Ex10.m1.10.10.10.6.2.3.3.cmml">k</mi></mrow><mi id="A1.Ex10.m1.10.10.10.6.3" xref="A1.Ex10.m1.10.10.10.6.3.cmml">K</mi></msubsup><mrow id="A1.Ex10.m1.10.10.10.5.1" xref="A1.Ex10.m1.10.10.10.5.2.cmml"><mi id="A1.Ex10.m1.9.9.9.4" xref="A1.Ex10.m1.9.9.9.4.cmml">exp</mi><mo id="A1.Ex10.m1.10.10.10.5.1a" xref="A1.Ex10.m1.10.10.10.5.2.cmml">⁡</mo><mrow id="A1.Ex10.m1.10.10.10.5.1.1" xref="A1.Ex10.m1.10.10.10.5.2.cmml"><mo id="A1.Ex10.m1.10.10.10.5.1.1.2" stretchy="false" xref="A1.Ex10.m1.10.10.10.5.2.cmml">(</mo><mrow id="A1.Ex10.m1.10.10.10.5.1.1.1" xref="A1.Ex10.m1.10.10.10.5.1.1.1.cmml"><mrow id="A1.Ex10.m1.10.10.10.5.1.1.1.1" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.cmml"><mi id="A1.Ex10.m1.10.10.10.5.1.1.1.1.3" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.3.cmml">r</mi><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.1.2" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.2.cmml"><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.2.cmml">(</mo><mi id="A1.Ex10.m1.7.7.7.2" xref="A1.Ex10.m1.7.7.7.2.cmml">x</mi><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.3" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.2.cmml">,</mo><msub id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.2" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex10.m1.6.6.6.1.1" xref="A1.Ex10.m1.6.6.6.1.1.cmml"><mi id="A1.Ex10.m1.6.6.6.1.1.3" xref="A1.Ex10.m1.6.6.6.1.1.3.cmml">τ</mi><mo id="A1.Ex10.m1.6.6.6.1.1.2" xref="A1.Ex10.m1.6.6.6.1.1.2.cmml">⁢</mo><mrow id="A1.Ex10.m1.6.6.6.1.1.4.2" xref="A1.Ex10.m1.6.6.6.1.1.cmml"><mo id="A1.Ex10.m1.6.6.6.1.1.4.2.1" stretchy="false" xref="A1.Ex10.m1.6.6.6.1.1.cmml">(</mo><mi id="A1.Ex10.m1.6.6.6.1.1.1" xref="A1.Ex10.m1.6.6.6.1.1.1.cmml">j</mi><mo id="A1.Ex10.m1.6.6.6.1.1.4.2.2" stretchy="false" xref="A1.Ex10.m1.6.6.6.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.4" stretchy="false" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.2" xref="A1.Ex10.m1.10.10.10.5.1.1.1.2.cmml">+</mo><mrow id="A1.Ex10.m1.10.10.10.5.1.1.1.3" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.cmml"><mi id="A1.Ex10.m1.10.10.10.5.1.1.1.3.2" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.2.cmml">f</mi><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.3.1" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex10.m1.10.10.10.5.1.1.1.3.3.2" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.cmml"><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.3.3.2.1" stretchy="false" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.cmml">(</mo><mi id="A1.Ex10.m1.8.8.8.3" xref="A1.Ex10.m1.8.8.8.3.cmml">x</mi><mo id="A1.Ex10.m1.10.10.10.5.1.1.1.3.3.2.2" stretchy="false" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex10.m1.10.10.10.5.1.1.3" stretchy="false" xref="A1.Ex10.m1.10.10.10.5.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex10.m1.10b"><apply id="A1.Ex10.m1.10.11.cmml" xref="A1.Ex10.m1.10.11"><eq id="A1.Ex10.m1.10.11.1.cmml" xref="A1.Ex10.m1.10.11.1"></eq><csymbol cd="latexml" id="A1.Ex10.m1.10.11.2.cmml" xref="A1.Ex10.m1.10.11.2">absent</csymbol><apply id="A1.Ex10.m1.10.11.3.cmml" xref="A1.Ex10.m1.10.11.3"><apply id="A1.Ex10.m1.10.11.3.1.cmml" xref="A1.Ex10.m1.10.11.3.1"><csymbol cd="ambiguous" id="A1.Ex10.m1.10.11.3.1.1.cmml" xref="A1.Ex10.m1.10.11.3.1">superscript</csymbol><apply id="A1.Ex10.m1.10.11.3.1.2.cmml" xref="A1.Ex10.m1.10.11.3.1"><csymbol cd="ambiguous" id="A1.Ex10.m1.10.11.3.1.2.1.cmml" xref="A1.Ex10.m1.10.11.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.Ex10.m1.10.11.3.1.2.2.cmml" xref="A1.Ex10.m1.10.11.3.1.2.2">product</csymbol><apply id="A1.Ex10.m1.10.11.3.1.2.3.cmml" xref="A1.Ex10.m1.10.11.3.1.2.3"><eq id="A1.Ex10.m1.10.11.3.1.2.3.1.cmml" xref="A1.Ex10.m1.10.11.3.1.2.3.1"></eq><ci id="A1.Ex10.m1.10.11.3.1.2.3.2.cmml" xref="A1.Ex10.m1.10.11.3.1.2.3.2">𝑘</ci><cn id="A1.Ex10.m1.10.11.3.1.2.3.3.cmml" type="integer" xref="A1.Ex10.m1.10.11.3.1.2.3.3">1</cn></apply></apply><ci id="A1.Ex10.m1.10.11.3.1.3.cmml" xref="A1.Ex10.m1.10.11.3.1.3">𝐾</ci></apply><apply id="A1.Ex10.m1.10.10.cmml" xref="A1.Ex10.m1.10.10"><divide id="A1.Ex10.m1.10.10.11.cmml" xref="A1.Ex10.m1.10.10"></divide><apply id="A1.Ex10.m1.5.5.5.6.cmml" xref="A1.Ex10.m1.5.5.5.5"><exp id="A1.Ex10.m1.4.4.4.4.cmml" xref="A1.Ex10.m1.4.4.4.4"></exp><apply id="A1.Ex10.m1.5.5.5.5.1.1.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1"><plus id="A1.Ex10.m1.5.5.5.5.1.1.2.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.2"></plus><apply id="A1.Ex10.m1.5.5.5.5.1.1.1.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1"><times id="A1.Ex10.m1.5.5.5.5.1.1.1.2.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1.2"></times><ci id="A1.Ex10.m1.5.5.5.5.1.1.1.3.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex10.m1.5.5.5.5.1.1.1.1.2.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.1"><ci id="A1.Ex10.m1.2.2.2.2.cmml" xref="A1.Ex10.m1.2.2.2.2">𝑥</ci><apply id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.1.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.2.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex10.m1.1.1.1.1.1.cmml" xref="A1.Ex10.m1.1.1.1.1.1"><times id="A1.Ex10.m1.1.1.1.1.1.2.cmml" xref="A1.Ex10.m1.1.1.1.1.1.2"></times><ci id="A1.Ex10.m1.1.1.1.1.1.3.cmml" xref="A1.Ex10.m1.1.1.1.1.1.3">𝜏</ci><ci id="A1.Ex10.m1.1.1.1.1.1.1.cmml" xref="A1.Ex10.m1.1.1.1.1.1.1">𝑘</ci></apply></apply></interval></apply><apply id="A1.Ex10.m1.5.5.5.5.1.1.3.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.3"><times id="A1.Ex10.m1.5.5.5.5.1.1.3.1.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.3.1"></times><ci id="A1.Ex10.m1.5.5.5.5.1.1.3.2.cmml" xref="A1.Ex10.m1.5.5.5.5.1.1.3.2">𝑓</ci><ci id="A1.Ex10.m1.3.3.3.3.cmml" xref="A1.Ex10.m1.3.3.3.3">𝑥</ci></apply></apply></apply><apply id="A1.Ex10.m1.10.10.10.cmml" xref="A1.Ex10.m1.10.10.10"><apply id="A1.Ex10.m1.10.10.10.6.cmml" xref="A1.Ex10.m1.10.10.10.6"><csymbol cd="ambiguous" id="A1.Ex10.m1.10.10.10.6.1.cmml" xref="A1.Ex10.m1.10.10.10.6">superscript</csymbol><apply id="A1.Ex10.m1.10.10.10.6.2.cmml" xref="A1.Ex10.m1.10.10.10.6"><csymbol cd="ambiguous" id="A1.Ex10.m1.10.10.10.6.2.1.cmml" xref="A1.Ex10.m1.10.10.10.6">subscript</csymbol><sum id="A1.Ex10.m1.10.10.10.6.2.2.cmml" xref="A1.Ex10.m1.10.10.10.6.2.2"></sum><apply id="A1.Ex10.m1.10.10.10.6.2.3.cmml" xref="A1.Ex10.m1.10.10.10.6.2.3"><eq id="A1.Ex10.m1.10.10.10.6.2.3.1.cmml" xref="A1.Ex10.m1.10.10.10.6.2.3.1"></eq><ci id="A1.Ex10.m1.10.10.10.6.2.3.2.cmml" xref="A1.Ex10.m1.10.10.10.6.2.3.2">𝑗</ci><ci id="A1.Ex10.m1.10.10.10.6.2.3.3.cmml" xref="A1.Ex10.m1.10.10.10.6.2.3.3">𝑘</ci></apply></apply><ci id="A1.Ex10.m1.10.10.10.6.3.cmml" xref="A1.Ex10.m1.10.10.10.6.3">𝐾</ci></apply><apply id="A1.Ex10.m1.10.10.10.5.2.cmml" xref="A1.Ex10.m1.10.10.10.5.1"><exp id="A1.Ex10.m1.9.9.9.4.cmml" xref="A1.Ex10.m1.9.9.9.4"></exp><apply id="A1.Ex10.m1.10.10.10.5.1.1.1.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1"><plus id="A1.Ex10.m1.10.10.10.5.1.1.1.2.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.2"></plus><apply id="A1.Ex10.m1.10.10.10.5.1.1.1.1.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1"><times id="A1.Ex10.m1.10.10.10.5.1.1.1.1.2.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.2"></times><ci id="A1.Ex10.m1.10.10.10.5.1.1.1.1.3.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.2.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1"><ci id="A1.Ex10.m1.7.7.7.2.cmml" xref="A1.Ex10.m1.7.7.7.2">𝑥</ci><apply id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex10.m1.6.6.6.1.1.cmml" xref="A1.Ex10.m1.6.6.6.1.1"><times id="A1.Ex10.m1.6.6.6.1.1.2.cmml" xref="A1.Ex10.m1.6.6.6.1.1.2"></times><ci id="A1.Ex10.m1.6.6.6.1.1.3.cmml" xref="A1.Ex10.m1.6.6.6.1.1.3">𝜏</ci><ci id="A1.Ex10.m1.6.6.6.1.1.1.cmml" xref="A1.Ex10.m1.6.6.6.1.1.1">𝑗</ci></apply></apply></interval></apply><apply id="A1.Ex10.m1.10.10.10.5.1.1.1.3.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3"><times id="A1.Ex10.m1.10.10.10.5.1.1.1.3.1.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.1"></times><ci id="A1.Ex10.m1.10.10.10.5.1.1.1.3.2.cmml" xref="A1.Ex10.m1.10.10.10.5.1.1.1.3.2">𝑓</ci><ci id="A1.Ex10.m1.8.8.8.3.cmml" xref="A1.Ex10.m1.8.8.8.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex10.m1.10c">\displaystyle=\prod_{k=1}^{K}\frac{\exp(r(x,y_{\tau(k)})+f(x))}{\sum_{j=k}^{K}%
\exp(r(x,y_{\tau(j)})+f(x))}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex10.m1.10d">= ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT ) + italic_f ( italic_x ) ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT ) + italic_f ( italic_x ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex11"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\prod_{k=1}^{K}\frac{\exp(f(x))\exp(r(x,y_{\tau(k)}))}{\exp(f(x)%
)\sum_{j=k}^{K}\exp(r(x,y_{\tau(j)}))}" class="ltx_Math" display="inline" id="A1.Ex11.m1.14"><semantics id="A1.Ex11.m1.14a"><mrow id="A1.Ex11.m1.14.15" xref="A1.Ex11.m1.14.15.cmml"><mi id="A1.Ex11.m1.14.15.2" xref="A1.Ex11.m1.14.15.2.cmml"></mi><mo id="A1.Ex11.m1.14.15.1" xref="A1.Ex11.m1.14.15.1.cmml">=</mo><mrow id="A1.Ex11.m1.14.15.3" xref="A1.Ex11.m1.14.15.3.cmml"><mstyle displaystyle="true" id="A1.Ex11.m1.14.15.3.1" xref="A1.Ex11.m1.14.15.3.1.cmml"><munderover id="A1.Ex11.m1.14.15.3.1a" xref="A1.Ex11.m1.14.15.3.1.cmml"><mo id="A1.Ex11.m1.14.15.3.1.2.2" movablelimits="false" xref="A1.Ex11.m1.14.15.3.1.2.2.cmml">∏</mo><mrow id="A1.Ex11.m1.14.15.3.1.2.3" xref="A1.Ex11.m1.14.15.3.1.2.3.cmml"><mi id="A1.Ex11.m1.14.15.3.1.2.3.2" xref="A1.Ex11.m1.14.15.3.1.2.3.2.cmml">k</mi><mo id="A1.Ex11.m1.14.15.3.1.2.3.1" xref="A1.Ex11.m1.14.15.3.1.2.3.1.cmml">=</mo><mn id="A1.Ex11.m1.14.15.3.1.2.3.3" xref="A1.Ex11.m1.14.15.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.Ex11.m1.14.15.3.1.3" xref="A1.Ex11.m1.14.15.3.1.3.cmml">K</mi></munderover></mstyle><mstyle displaystyle="true" id="A1.Ex11.m1.14.14" xref="A1.Ex11.m1.14.14.cmml"><mfrac id="A1.Ex11.m1.14.14a" xref="A1.Ex11.m1.14.14.cmml"><mrow id="A1.Ex11.m1.7.7.7" xref="A1.Ex11.m1.7.7.7.cmml"><mrow id="A1.Ex11.m1.6.6.6.6.1" xref="A1.Ex11.m1.6.6.6.6.2.cmml"><mi id="A1.Ex11.m1.3.3.3.3" xref="A1.Ex11.m1.3.3.3.3.cmml">exp</mi><mo id="A1.Ex11.m1.6.6.6.6.1a" xref="A1.Ex11.m1.6.6.6.6.2.cmml">⁡</mo><mrow id="A1.Ex11.m1.6.6.6.6.1.1" xref="A1.Ex11.m1.6.6.6.6.2.cmml"><mo id="A1.Ex11.m1.6.6.6.6.1.1.2" stretchy="false" xref="A1.Ex11.m1.6.6.6.6.2.cmml">(</mo><mrow id="A1.Ex11.m1.6.6.6.6.1.1.1" xref="A1.Ex11.m1.6.6.6.6.1.1.1.cmml"><mi id="A1.Ex11.m1.6.6.6.6.1.1.1.2" xref="A1.Ex11.m1.6.6.6.6.1.1.1.2.cmml">f</mi><mo id="A1.Ex11.m1.6.6.6.6.1.1.1.1" xref="A1.Ex11.m1.6.6.6.6.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex11.m1.6.6.6.6.1.1.1.3.2" xref="A1.Ex11.m1.6.6.6.6.1.1.1.cmml"><mo id="A1.Ex11.m1.6.6.6.6.1.1.1.3.2.1" stretchy="false" xref="A1.Ex11.m1.6.6.6.6.1.1.1.cmml">(</mo><mi id="A1.Ex11.m1.2.2.2.2" xref="A1.Ex11.m1.2.2.2.2.cmml">x</mi><mo id="A1.Ex11.m1.6.6.6.6.1.1.1.3.2.2" stretchy="false" xref="A1.Ex11.m1.6.6.6.6.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex11.m1.6.6.6.6.1.1.3" stretchy="false" xref="A1.Ex11.m1.6.6.6.6.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex11.m1.7.7.7.8" lspace="0.167em" xref="A1.Ex11.m1.7.7.7.8.cmml">⁢</mo><mrow id="A1.Ex11.m1.7.7.7.7.1" xref="A1.Ex11.m1.7.7.7.7.2.cmml"><mi id="A1.Ex11.m1.5.5.5.5" xref="A1.Ex11.m1.5.5.5.5.cmml">exp</mi><mo id="A1.Ex11.m1.7.7.7.7.1a" xref="A1.Ex11.m1.7.7.7.7.2.cmml">⁡</mo><mrow id="A1.Ex11.m1.7.7.7.7.1.1" xref="A1.Ex11.m1.7.7.7.7.2.cmml"><mo id="A1.Ex11.m1.7.7.7.7.1.1.2" stretchy="false" xref="A1.Ex11.m1.7.7.7.7.2.cmml">(</mo><mrow id="A1.Ex11.m1.7.7.7.7.1.1.1" xref="A1.Ex11.m1.7.7.7.7.1.1.1.cmml"><mi id="A1.Ex11.m1.7.7.7.7.1.1.1.3" xref="A1.Ex11.m1.7.7.7.7.1.1.1.3.cmml">r</mi><mo id="A1.Ex11.m1.7.7.7.7.1.1.1.2" xref="A1.Ex11.m1.7.7.7.7.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.2.cmml"><mo id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.2" stretchy="false" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.2.cmml">(</mo><mi id="A1.Ex11.m1.4.4.4.4" xref="A1.Ex11.m1.4.4.4.4.cmml">x</mi><mo id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.3" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.2.cmml">,</mo><msub id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.cmml"><mi id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.2" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex11.m1.1.1.1.1.1" xref="A1.Ex11.m1.1.1.1.1.1.cmml"><mi id="A1.Ex11.m1.1.1.1.1.1.3" xref="A1.Ex11.m1.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.Ex11.m1.1.1.1.1.1.2" xref="A1.Ex11.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex11.m1.1.1.1.1.1.4.2" xref="A1.Ex11.m1.1.1.1.1.1.cmml"><mo id="A1.Ex11.m1.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.Ex11.m1.1.1.1.1.1.cmml">(</mo><mi id="A1.Ex11.m1.1.1.1.1.1.1" xref="A1.Ex11.m1.1.1.1.1.1.1.cmml">k</mi><mo id="A1.Ex11.m1.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.Ex11.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.4" stretchy="false" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex11.m1.7.7.7.7.1.1.3" stretchy="false" xref="A1.Ex11.m1.7.7.7.7.2.cmml">)</mo></mrow></mrow></mrow><mrow id="A1.Ex11.m1.14.14.14" xref="A1.Ex11.m1.14.14.14.cmml"><mrow id="A1.Ex11.m1.13.13.13.6.1" xref="A1.Ex11.m1.13.13.13.6.2.cmml"><mi id="A1.Ex11.m1.10.10.10.3" xref="A1.Ex11.m1.10.10.10.3.cmml">exp</mi><mo id="A1.Ex11.m1.13.13.13.6.1a" xref="A1.Ex11.m1.13.13.13.6.2.cmml">⁡</mo><mrow id="A1.Ex11.m1.13.13.13.6.1.1" xref="A1.Ex11.m1.13.13.13.6.2.cmml"><mo id="A1.Ex11.m1.13.13.13.6.1.1.2" stretchy="false" xref="A1.Ex11.m1.13.13.13.6.2.cmml">(</mo><mrow id="A1.Ex11.m1.13.13.13.6.1.1.1" xref="A1.Ex11.m1.13.13.13.6.1.1.1.cmml"><mi id="A1.Ex11.m1.13.13.13.6.1.1.1.2" xref="A1.Ex11.m1.13.13.13.6.1.1.1.2.cmml">f</mi><mo id="A1.Ex11.m1.13.13.13.6.1.1.1.1" xref="A1.Ex11.m1.13.13.13.6.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex11.m1.13.13.13.6.1.1.1.3.2" xref="A1.Ex11.m1.13.13.13.6.1.1.1.cmml"><mo id="A1.Ex11.m1.13.13.13.6.1.1.1.3.2.1" stretchy="false" xref="A1.Ex11.m1.13.13.13.6.1.1.1.cmml">(</mo><mi id="A1.Ex11.m1.9.9.9.2" xref="A1.Ex11.m1.9.9.9.2.cmml">x</mi><mo id="A1.Ex11.m1.13.13.13.6.1.1.1.3.2.2" stretchy="false" xref="A1.Ex11.m1.13.13.13.6.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex11.m1.13.13.13.6.1.1.3" stretchy="false" xref="A1.Ex11.m1.13.13.13.6.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex11.m1.14.14.14.8" xref="A1.Ex11.m1.14.14.14.8.cmml">⁢</mo><mrow id="A1.Ex11.m1.14.14.14.7" xref="A1.Ex11.m1.14.14.14.7.cmml"><msubsup id="A1.Ex11.m1.14.14.14.7.2" xref="A1.Ex11.m1.14.14.14.7.2.cmml"><mo id="A1.Ex11.m1.14.14.14.7.2.2.2" xref="A1.Ex11.m1.14.14.14.7.2.2.2.cmml">∑</mo><mrow id="A1.Ex11.m1.14.14.14.7.2.2.3" xref="A1.Ex11.m1.14.14.14.7.2.2.3.cmml"><mi id="A1.Ex11.m1.14.14.14.7.2.2.3.2" xref="A1.Ex11.m1.14.14.14.7.2.2.3.2.cmml">j</mi><mo id="A1.Ex11.m1.14.14.14.7.2.2.3.1" xref="A1.Ex11.m1.14.14.14.7.2.2.3.1.cmml">=</mo><mi id="A1.Ex11.m1.14.14.14.7.2.2.3.3" xref="A1.Ex11.m1.14.14.14.7.2.2.3.3.cmml">k</mi></mrow><mi id="A1.Ex11.m1.14.14.14.7.2.3" xref="A1.Ex11.m1.14.14.14.7.2.3.cmml">K</mi></msubsup><mrow id="A1.Ex11.m1.14.14.14.7.1.1" xref="A1.Ex11.m1.14.14.14.7.1.2.cmml"><mi id="A1.Ex11.m1.12.12.12.5" xref="A1.Ex11.m1.12.12.12.5.cmml">exp</mi><mo id="A1.Ex11.m1.14.14.14.7.1.1a" xref="A1.Ex11.m1.14.14.14.7.1.2.cmml">⁡</mo><mrow id="A1.Ex11.m1.14.14.14.7.1.1.1" xref="A1.Ex11.m1.14.14.14.7.1.2.cmml"><mo id="A1.Ex11.m1.14.14.14.7.1.1.1.2" stretchy="false" xref="A1.Ex11.m1.14.14.14.7.1.2.cmml">(</mo><mrow id="A1.Ex11.m1.14.14.14.7.1.1.1.1" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.cmml"><mi id="A1.Ex11.m1.14.14.14.7.1.1.1.1.3" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.3.cmml">r</mi><mo id="A1.Ex11.m1.14.14.14.7.1.1.1.1.2" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.2.cmml"><mo id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.2.cmml">(</mo><mi id="A1.Ex11.m1.11.11.11.4" xref="A1.Ex11.m1.11.11.11.4.cmml">x</mi><mo id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.3" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.2.cmml">,</mo><msub id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.2" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex11.m1.8.8.8.1.1" xref="A1.Ex11.m1.8.8.8.1.1.cmml"><mi id="A1.Ex11.m1.8.8.8.1.1.3" xref="A1.Ex11.m1.8.8.8.1.1.3.cmml">τ</mi><mo id="A1.Ex11.m1.8.8.8.1.1.2" xref="A1.Ex11.m1.8.8.8.1.1.2.cmml">⁢</mo><mrow id="A1.Ex11.m1.8.8.8.1.1.4.2" xref="A1.Ex11.m1.8.8.8.1.1.cmml"><mo id="A1.Ex11.m1.8.8.8.1.1.4.2.1" stretchy="false" xref="A1.Ex11.m1.8.8.8.1.1.cmml">(</mo><mi id="A1.Ex11.m1.8.8.8.1.1.1" xref="A1.Ex11.m1.8.8.8.1.1.1.cmml">j</mi><mo id="A1.Ex11.m1.8.8.8.1.1.4.2.2" stretchy="false" xref="A1.Ex11.m1.8.8.8.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.4" stretchy="false" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex11.m1.14.14.14.7.1.1.1.3" stretchy="false" xref="A1.Ex11.m1.14.14.14.7.1.2.cmml">)</mo></mrow></mrow></mrow></mrow></mfrac></mstyle></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex11.m1.14b"><apply id="A1.Ex11.m1.14.15.cmml" xref="A1.Ex11.m1.14.15"><eq id="A1.Ex11.m1.14.15.1.cmml" xref="A1.Ex11.m1.14.15.1"></eq><csymbol cd="latexml" id="A1.Ex11.m1.14.15.2.cmml" xref="A1.Ex11.m1.14.15.2">absent</csymbol><apply id="A1.Ex11.m1.14.15.3.cmml" xref="A1.Ex11.m1.14.15.3"><apply id="A1.Ex11.m1.14.15.3.1.cmml" xref="A1.Ex11.m1.14.15.3.1"><csymbol cd="ambiguous" id="A1.Ex11.m1.14.15.3.1.1.cmml" xref="A1.Ex11.m1.14.15.3.1">superscript</csymbol><apply id="A1.Ex11.m1.14.15.3.1.2.cmml" xref="A1.Ex11.m1.14.15.3.1"><csymbol cd="ambiguous" id="A1.Ex11.m1.14.15.3.1.2.1.cmml" xref="A1.Ex11.m1.14.15.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.Ex11.m1.14.15.3.1.2.2.cmml" xref="A1.Ex11.m1.14.15.3.1.2.2">product</csymbol><apply id="A1.Ex11.m1.14.15.3.1.2.3.cmml" xref="A1.Ex11.m1.14.15.3.1.2.3"><eq id="A1.Ex11.m1.14.15.3.1.2.3.1.cmml" xref="A1.Ex11.m1.14.15.3.1.2.3.1"></eq><ci id="A1.Ex11.m1.14.15.3.1.2.3.2.cmml" xref="A1.Ex11.m1.14.15.3.1.2.3.2">𝑘</ci><cn id="A1.Ex11.m1.14.15.3.1.2.3.3.cmml" type="integer" xref="A1.Ex11.m1.14.15.3.1.2.3.3">1</cn></apply></apply><ci id="A1.Ex11.m1.14.15.3.1.3.cmml" xref="A1.Ex11.m1.14.15.3.1.3">𝐾</ci></apply><apply id="A1.Ex11.m1.14.14.cmml" xref="A1.Ex11.m1.14.14"><divide id="A1.Ex11.m1.14.14.15.cmml" xref="A1.Ex11.m1.14.14"></divide><apply id="A1.Ex11.m1.7.7.7.cmml" xref="A1.Ex11.m1.7.7.7"><times id="A1.Ex11.m1.7.7.7.8.cmml" xref="A1.Ex11.m1.7.7.7.8"></times><apply id="A1.Ex11.m1.6.6.6.6.2.cmml" xref="A1.Ex11.m1.6.6.6.6.1"><exp id="A1.Ex11.m1.3.3.3.3.cmml" xref="A1.Ex11.m1.3.3.3.3"></exp><apply id="A1.Ex11.m1.6.6.6.6.1.1.1.cmml" xref="A1.Ex11.m1.6.6.6.6.1.1.1"><times id="A1.Ex11.m1.6.6.6.6.1.1.1.1.cmml" xref="A1.Ex11.m1.6.6.6.6.1.1.1.1"></times><ci id="A1.Ex11.m1.6.6.6.6.1.1.1.2.cmml" xref="A1.Ex11.m1.6.6.6.6.1.1.1.2">𝑓</ci><ci id="A1.Ex11.m1.2.2.2.2.cmml" xref="A1.Ex11.m1.2.2.2.2">𝑥</ci></apply></apply><apply id="A1.Ex11.m1.7.7.7.7.2.cmml" xref="A1.Ex11.m1.7.7.7.7.1"><exp id="A1.Ex11.m1.5.5.5.5.cmml" xref="A1.Ex11.m1.5.5.5.5"></exp><apply id="A1.Ex11.m1.7.7.7.7.1.1.1.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1"><times id="A1.Ex11.m1.7.7.7.7.1.1.1.2.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1.2"></times><ci id="A1.Ex11.m1.7.7.7.7.1.1.1.3.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex11.m1.7.7.7.7.1.1.1.1.2.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.1"><ci id="A1.Ex11.m1.4.4.4.4.cmml" xref="A1.Ex11.m1.4.4.4.4">𝑥</ci><apply id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.1.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.2.cmml" xref="A1.Ex11.m1.7.7.7.7.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex11.m1.1.1.1.1.1.cmml" xref="A1.Ex11.m1.1.1.1.1.1"><times id="A1.Ex11.m1.1.1.1.1.1.2.cmml" xref="A1.Ex11.m1.1.1.1.1.1.2"></times><ci id="A1.Ex11.m1.1.1.1.1.1.3.cmml" xref="A1.Ex11.m1.1.1.1.1.1.3">𝜏</ci><ci id="A1.Ex11.m1.1.1.1.1.1.1.cmml" xref="A1.Ex11.m1.1.1.1.1.1.1">𝑘</ci></apply></apply></interval></apply></apply></apply><apply id="A1.Ex11.m1.14.14.14.cmml" xref="A1.Ex11.m1.14.14.14"><times id="A1.Ex11.m1.14.14.14.8.cmml" xref="A1.Ex11.m1.14.14.14.8"></times><apply id="A1.Ex11.m1.13.13.13.6.2.cmml" xref="A1.Ex11.m1.13.13.13.6.1"><exp id="A1.Ex11.m1.10.10.10.3.cmml" xref="A1.Ex11.m1.10.10.10.3"></exp><apply id="A1.Ex11.m1.13.13.13.6.1.1.1.cmml" xref="A1.Ex11.m1.13.13.13.6.1.1.1"><times id="A1.Ex11.m1.13.13.13.6.1.1.1.1.cmml" xref="A1.Ex11.m1.13.13.13.6.1.1.1.1"></times><ci id="A1.Ex11.m1.13.13.13.6.1.1.1.2.cmml" xref="A1.Ex11.m1.13.13.13.6.1.1.1.2">𝑓</ci><ci id="A1.Ex11.m1.9.9.9.2.cmml" xref="A1.Ex11.m1.9.9.9.2">𝑥</ci></apply></apply><apply id="A1.Ex11.m1.14.14.14.7.cmml" xref="A1.Ex11.m1.14.14.14.7"><apply id="A1.Ex11.m1.14.14.14.7.2.cmml" xref="A1.Ex11.m1.14.14.14.7.2"><csymbol cd="ambiguous" id="A1.Ex11.m1.14.14.14.7.2.1.cmml" xref="A1.Ex11.m1.14.14.14.7.2">superscript</csymbol><apply id="A1.Ex11.m1.14.14.14.7.2.2.cmml" xref="A1.Ex11.m1.14.14.14.7.2"><csymbol cd="ambiguous" id="A1.Ex11.m1.14.14.14.7.2.2.1.cmml" xref="A1.Ex11.m1.14.14.14.7.2">subscript</csymbol><sum id="A1.Ex11.m1.14.14.14.7.2.2.2.cmml" xref="A1.Ex11.m1.14.14.14.7.2.2.2"></sum><apply id="A1.Ex11.m1.14.14.14.7.2.2.3.cmml" xref="A1.Ex11.m1.14.14.14.7.2.2.3"><eq id="A1.Ex11.m1.14.14.14.7.2.2.3.1.cmml" xref="A1.Ex11.m1.14.14.14.7.2.2.3.1"></eq><ci id="A1.Ex11.m1.14.14.14.7.2.2.3.2.cmml" xref="A1.Ex11.m1.14.14.14.7.2.2.3.2">𝑗</ci><ci id="A1.Ex11.m1.14.14.14.7.2.2.3.3.cmml" xref="A1.Ex11.m1.14.14.14.7.2.2.3.3">𝑘</ci></apply></apply><ci id="A1.Ex11.m1.14.14.14.7.2.3.cmml" xref="A1.Ex11.m1.14.14.14.7.2.3">𝐾</ci></apply><apply id="A1.Ex11.m1.14.14.14.7.1.2.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1"><exp id="A1.Ex11.m1.12.12.12.5.cmml" xref="A1.Ex11.m1.12.12.12.5"></exp><apply id="A1.Ex11.m1.14.14.14.7.1.1.1.1.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1"><times id="A1.Ex11.m1.14.14.14.7.1.1.1.1.2.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.2"></times><ci id="A1.Ex11.m1.14.14.14.7.1.1.1.1.3.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.2.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1"><ci id="A1.Ex11.m1.11.11.11.4.cmml" xref="A1.Ex11.m1.11.11.11.4">𝑥</ci><apply id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex11.m1.14.14.14.7.1.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex11.m1.8.8.8.1.1.cmml" xref="A1.Ex11.m1.8.8.8.1.1"><times id="A1.Ex11.m1.8.8.8.1.1.2.cmml" xref="A1.Ex11.m1.8.8.8.1.1.2"></times><ci id="A1.Ex11.m1.8.8.8.1.1.3.cmml" xref="A1.Ex11.m1.8.8.8.1.1.3">𝜏</ci><ci id="A1.Ex11.m1.8.8.8.1.1.1.cmml" xref="A1.Ex11.m1.8.8.8.1.1.1">𝑗</ci></apply></apply></interval></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex11.m1.14c">\displaystyle=\prod_{k=1}^{K}\frac{\exp(f(x))\exp(r(x,y_{\tau(k)}))}{\exp(f(x)%
)\sum_{j=k}^{K}\exp(r(x,y_{\tau(j)}))}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex11.m1.14d">= ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_f ( italic_x ) ) roman_exp ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT ) ) end_ARG start_ARG roman_exp ( italic_f ( italic_x ) ) ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex12"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\prod_{k=1}^{K}\frac{\exp(r(x,y_{\tau(k)}))}{\sum_{j=k}^{K}\exp(%
r(x,y_{\tau(j)}))}" class="ltx_Math" display="inline" id="A1.Ex12.m1.8"><semantics id="A1.Ex12.m1.8a"><mrow id="A1.Ex12.m1.8.9" xref="A1.Ex12.m1.8.9.cmml"><mi id="A1.Ex12.m1.8.9.2" xref="A1.Ex12.m1.8.9.2.cmml"></mi><mo id="A1.Ex12.m1.8.9.1" xref="A1.Ex12.m1.8.9.1.cmml">=</mo><mrow id="A1.Ex12.m1.8.9.3" xref="A1.Ex12.m1.8.9.3.cmml"><mstyle displaystyle="true" id="A1.Ex12.m1.8.9.3.1" xref="A1.Ex12.m1.8.9.3.1.cmml"><munderover id="A1.Ex12.m1.8.9.3.1a" xref="A1.Ex12.m1.8.9.3.1.cmml"><mo id="A1.Ex12.m1.8.9.3.1.2.2" movablelimits="false" xref="A1.Ex12.m1.8.9.3.1.2.2.cmml">∏</mo><mrow id="A1.Ex12.m1.8.9.3.1.2.3" xref="A1.Ex12.m1.8.9.3.1.2.3.cmml"><mi id="A1.Ex12.m1.8.9.3.1.2.3.2" xref="A1.Ex12.m1.8.9.3.1.2.3.2.cmml">k</mi><mo id="A1.Ex12.m1.8.9.3.1.2.3.1" xref="A1.Ex12.m1.8.9.3.1.2.3.1.cmml">=</mo><mn id="A1.Ex12.m1.8.9.3.1.2.3.3" xref="A1.Ex12.m1.8.9.3.1.2.3.3.cmml">1</mn></mrow><mi id="A1.Ex12.m1.8.9.3.1.3" xref="A1.Ex12.m1.8.9.3.1.3.cmml">K</mi></munderover></mstyle><mstyle displaystyle="true" id="A1.Ex12.m1.8.8" xref="A1.Ex12.m1.8.8.cmml"><mfrac id="A1.Ex12.m1.8.8a" xref="A1.Ex12.m1.8.8.cmml"><mrow id="A1.Ex12.m1.4.4.4.4" xref="A1.Ex12.m1.4.4.4.5.cmml"><mi id="A1.Ex12.m1.3.3.3.3" xref="A1.Ex12.m1.3.3.3.3.cmml">exp</mi><mo id="A1.Ex12.m1.4.4.4.4a" xref="A1.Ex12.m1.4.4.4.5.cmml">⁡</mo><mrow id="A1.Ex12.m1.4.4.4.4.1" xref="A1.Ex12.m1.4.4.4.5.cmml"><mo id="A1.Ex12.m1.4.4.4.4.1.2" stretchy="false" xref="A1.Ex12.m1.4.4.4.5.cmml">(</mo><mrow id="A1.Ex12.m1.4.4.4.4.1.1" xref="A1.Ex12.m1.4.4.4.4.1.1.cmml"><mi id="A1.Ex12.m1.4.4.4.4.1.1.3" xref="A1.Ex12.m1.4.4.4.4.1.1.3.cmml">r</mi><mo id="A1.Ex12.m1.4.4.4.4.1.1.2" xref="A1.Ex12.m1.4.4.4.4.1.1.2.cmml">⁢</mo><mrow id="A1.Ex12.m1.4.4.4.4.1.1.1.1" xref="A1.Ex12.m1.4.4.4.4.1.1.1.2.cmml"><mo id="A1.Ex12.m1.4.4.4.4.1.1.1.1.2" stretchy="false" xref="A1.Ex12.m1.4.4.4.4.1.1.1.2.cmml">(</mo><mi id="A1.Ex12.m1.2.2.2.2" xref="A1.Ex12.m1.2.2.2.2.cmml">x</mi><mo id="A1.Ex12.m1.4.4.4.4.1.1.1.1.3" xref="A1.Ex12.m1.4.4.4.4.1.1.1.2.cmml">,</mo><msub id="A1.Ex12.m1.4.4.4.4.1.1.1.1.1" xref="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.cmml"><mi id="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.2" xref="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex12.m1.1.1.1.1.1" xref="A1.Ex12.m1.1.1.1.1.1.cmml"><mi id="A1.Ex12.m1.1.1.1.1.1.3" xref="A1.Ex12.m1.1.1.1.1.1.3.cmml">τ</mi><mo id="A1.Ex12.m1.1.1.1.1.1.2" xref="A1.Ex12.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex12.m1.1.1.1.1.1.4.2" xref="A1.Ex12.m1.1.1.1.1.1.cmml"><mo id="A1.Ex12.m1.1.1.1.1.1.4.2.1" stretchy="false" xref="A1.Ex12.m1.1.1.1.1.1.cmml">(</mo><mi id="A1.Ex12.m1.1.1.1.1.1.1" xref="A1.Ex12.m1.1.1.1.1.1.1.cmml">k</mi><mo id="A1.Ex12.m1.1.1.1.1.1.4.2.2" stretchy="false" xref="A1.Ex12.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex12.m1.4.4.4.4.1.1.1.1.4" stretchy="false" xref="A1.Ex12.m1.4.4.4.4.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex12.m1.4.4.4.4.1.3" stretchy="false" xref="A1.Ex12.m1.4.4.4.5.cmml">)</mo></mrow></mrow><mrow id="A1.Ex12.m1.8.8.8" xref="A1.Ex12.m1.8.8.8.cmml"><msubsup id="A1.Ex12.m1.8.8.8.5" xref="A1.Ex12.m1.8.8.8.5.cmml"><mo id="A1.Ex12.m1.8.8.8.5.2.2" xref="A1.Ex12.m1.8.8.8.5.2.2.cmml">∑</mo><mrow id="A1.Ex12.m1.8.8.8.5.2.3" xref="A1.Ex12.m1.8.8.8.5.2.3.cmml"><mi id="A1.Ex12.m1.8.8.8.5.2.3.2" xref="A1.Ex12.m1.8.8.8.5.2.3.2.cmml">j</mi><mo id="A1.Ex12.m1.8.8.8.5.2.3.1" xref="A1.Ex12.m1.8.8.8.5.2.3.1.cmml">=</mo><mi id="A1.Ex12.m1.8.8.8.5.2.3.3" xref="A1.Ex12.m1.8.8.8.5.2.3.3.cmml">k</mi></mrow><mi id="A1.Ex12.m1.8.8.8.5.3" xref="A1.Ex12.m1.8.8.8.5.3.cmml">K</mi></msubsup><mrow id="A1.Ex12.m1.8.8.8.4.1" xref="A1.Ex12.m1.8.8.8.4.2.cmml"><mi id="A1.Ex12.m1.7.7.7.3" xref="A1.Ex12.m1.7.7.7.3.cmml">exp</mi><mo id="A1.Ex12.m1.8.8.8.4.1a" xref="A1.Ex12.m1.8.8.8.4.2.cmml">⁡</mo><mrow id="A1.Ex12.m1.8.8.8.4.1.1" xref="A1.Ex12.m1.8.8.8.4.2.cmml"><mo id="A1.Ex12.m1.8.8.8.4.1.1.2" stretchy="false" xref="A1.Ex12.m1.8.8.8.4.2.cmml">(</mo><mrow id="A1.Ex12.m1.8.8.8.4.1.1.1" xref="A1.Ex12.m1.8.8.8.4.1.1.1.cmml"><mi id="A1.Ex12.m1.8.8.8.4.1.1.1.3" xref="A1.Ex12.m1.8.8.8.4.1.1.1.3.cmml">r</mi><mo id="A1.Ex12.m1.8.8.8.4.1.1.1.2" xref="A1.Ex12.m1.8.8.8.4.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.2.cmml"><mo id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.2" stretchy="false" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.2.cmml">(</mo><mi id="A1.Ex12.m1.6.6.6.2" xref="A1.Ex12.m1.6.6.6.2.cmml">x</mi><mo id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.3" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.2.cmml">,</mo><msub id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.cmml"><mi id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.2" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.2.cmml">y</mi><mrow id="A1.Ex12.m1.5.5.5.1.1" xref="A1.Ex12.m1.5.5.5.1.1.cmml"><mi id="A1.Ex12.m1.5.5.5.1.1.3" xref="A1.Ex12.m1.5.5.5.1.1.3.cmml">τ</mi><mo id="A1.Ex12.m1.5.5.5.1.1.2" xref="A1.Ex12.m1.5.5.5.1.1.2.cmml">⁢</mo><mrow id="A1.Ex12.m1.5.5.5.1.1.4.2" xref="A1.Ex12.m1.5.5.5.1.1.cmml"><mo id="A1.Ex12.m1.5.5.5.1.1.4.2.1" stretchy="false" xref="A1.Ex12.m1.5.5.5.1.1.cmml">(</mo><mi id="A1.Ex12.m1.5.5.5.1.1.1" xref="A1.Ex12.m1.5.5.5.1.1.1.cmml">j</mi><mo id="A1.Ex12.m1.5.5.5.1.1.4.2.2" stretchy="false" xref="A1.Ex12.m1.5.5.5.1.1.cmml">)</mo></mrow></mrow></msub><mo id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.4" stretchy="false" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex12.m1.8.8.8.4.1.1.3" stretchy="false" xref="A1.Ex12.m1.8.8.8.4.2.cmml">)</mo></mrow></mrow></mrow></mfrac></mstyle></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex12.m1.8b"><apply id="A1.Ex12.m1.8.9.cmml" xref="A1.Ex12.m1.8.9"><eq id="A1.Ex12.m1.8.9.1.cmml" xref="A1.Ex12.m1.8.9.1"></eq><csymbol cd="latexml" id="A1.Ex12.m1.8.9.2.cmml" xref="A1.Ex12.m1.8.9.2">absent</csymbol><apply id="A1.Ex12.m1.8.9.3.cmml" xref="A1.Ex12.m1.8.9.3"><apply id="A1.Ex12.m1.8.9.3.1.cmml" xref="A1.Ex12.m1.8.9.3.1"><csymbol cd="ambiguous" id="A1.Ex12.m1.8.9.3.1.1.cmml" xref="A1.Ex12.m1.8.9.3.1">superscript</csymbol><apply id="A1.Ex12.m1.8.9.3.1.2.cmml" xref="A1.Ex12.m1.8.9.3.1"><csymbol cd="ambiguous" id="A1.Ex12.m1.8.9.3.1.2.1.cmml" xref="A1.Ex12.m1.8.9.3.1">subscript</csymbol><csymbol cd="latexml" id="A1.Ex12.m1.8.9.3.1.2.2.cmml" xref="A1.Ex12.m1.8.9.3.1.2.2">product</csymbol><apply id="A1.Ex12.m1.8.9.3.1.2.3.cmml" xref="A1.Ex12.m1.8.9.3.1.2.3"><eq id="A1.Ex12.m1.8.9.3.1.2.3.1.cmml" xref="A1.Ex12.m1.8.9.3.1.2.3.1"></eq><ci id="A1.Ex12.m1.8.9.3.1.2.3.2.cmml" xref="A1.Ex12.m1.8.9.3.1.2.3.2">𝑘</ci><cn id="A1.Ex12.m1.8.9.3.1.2.3.3.cmml" type="integer" xref="A1.Ex12.m1.8.9.3.1.2.3.3">1</cn></apply></apply><ci id="A1.Ex12.m1.8.9.3.1.3.cmml" xref="A1.Ex12.m1.8.9.3.1.3">𝐾</ci></apply><apply id="A1.Ex12.m1.8.8.cmml" xref="A1.Ex12.m1.8.8"><divide id="A1.Ex12.m1.8.8.9.cmml" xref="A1.Ex12.m1.8.8"></divide><apply id="A1.Ex12.m1.4.4.4.5.cmml" xref="A1.Ex12.m1.4.4.4.4"><exp id="A1.Ex12.m1.3.3.3.3.cmml" xref="A1.Ex12.m1.3.3.3.3"></exp><apply id="A1.Ex12.m1.4.4.4.4.1.1.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1"><times id="A1.Ex12.m1.4.4.4.4.1.1.2.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1.2"></times><ci id="A1.Ex12.m1.4.4.4.4.1.1.3.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex12.m1.4.4.4.4.1.1.1.2.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1.1.1"><ci id="A1.Ex12.m1.2.2.2.2.cmml" xref="A1.Ex12.m1.2.2.2.2">𝑥</ci><apply id="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.1.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.2.cmml" xref="A1.Ex12.m1.4.4.4.4.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex12.m1.1.1.1.1.1.cmml" xref="A1.Ex12.m1.1.1.1.1.1"><times id="A1.Ex12.m1.1.1.1.1.1.2.cmml" xref="A1.Ex12.m1.1.1.1.1.1.2"></times><ci id="A1.Ex12.m1.1.1.1.1.1.3.cmml" xref="A1.Ex12.m1.1.1.1.1.1.3">𝜏</ci><ci id="A1.Ex12.m1.1.1.1.1.1.1.cmml" xref="A1.Ex12.m1.1.1.1.1.1.1">𝑘</ci></apply></apply></interval></apply></apply><apply id="A1.Ex12.m1.8.8.8.cmml" xref="A1.Ex12.m1.8.8.8"><apply id="A1.Ex12.m1.8.8.8.5.cmml" xref="A1.Ex12.m1.8.8.8.5"><csymbol cd="ambiguous" id="A1.Ex12.m1.8.8.8.5.1.cmml" xref="A1.Ex12.m1.8.8.8.5">superscript</csymbol><apply id="A1.Ex12.m1.8.8.8.5.2.cmml" xref="A1.Ex12.m1.8.8.8.5"><csymbol cd="ambiguous" id="A1.Ex12.m1.8.8.8.5.2.1.cmml" xref="A1.Ex12.m1.8.8.8.5">subscript</csymbol><sum id="A1.Ex12.m1.8.8.8.5.2.2.cmml" xref="A1.Ex12.m1.8.8.8.5.2.2"></sum><apply id="A1.Ex12.m1.8.8.8.5.2.3.cmml" xref="A1.Ex12.m1.8.8.8.5.2.3"><eq id="A1.Ex12.m1.8.8.8.5.2.3.1.cmml" xref="A1.Ex12.m1.8.8.8.5.2.3.1"></eq><ci id="A1.Ex12.m1.8.8.8.5.2.3.2.cmml" xref="A1.Ex12.m1.8.8.8.5.2.3.2">𝑗</ci><ci id="A1.Ex12.m1.8.8.8.5.2.3.3.cmml" xref="A1.Ex12.m1.8.8.8.5.2.3.3">𝑘</ci></apply></apply><ci id="A1.Ex12.m1.8.8.8.5.3.cmml" xref="A1.Ex12.m1.8.8.8.5.3">𝐾</ci></apply><apply id="A1.Ex12.m1.8.8.8.4.2.cmml" xref="A1.Ex12.m1.8.8.8.4.1"><exp id="A1.Ex12.m1.7.7.7.3.cmml" xref="A1.Ex12.m1.7.7.7.3"></exp><apply id="A1.Ex12.m1.8.8.8.4.1.1.1.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1"><times id="A1.Ex12.m1.8.8.8.4.1.1.1.2.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1.2"></times><ci id="A1.Ex12.m1.8.8.8.4.1.1.1.3.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex12.m1.8.8.8.4.1.1.1.1.2.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.1"><ci id="A1.Ex12.m1.6.6.6.2.cmml" xref="A1.Ex12.m1.6.6.6.2">𝑥</ci><apply id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.1.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.2.cmml" xref="A1.Ex12.m1.8.8.8.4.1.1.1.1.1.1.2">𝑦</ci><apply id="A1.Ex12.m1.5.5.5.1.1.cmml" xref="A1.Ex12.m1.5.5.5.1.1"><times id="A1.Ex12.m1.5.5.5.1.1.2.cmml" xref="A1.Ex12.m1.5.5.5.1.1.2"></times><ci id="A1.Ex12.m1.5.5.5.1.1.3.cmml" xref="A1.Ex12.m1.5.5.5.1.1.3">𝜏</ci><ci id="A1.Ex12.m1.5.5.5.1.1.1.cmml" xref="A1.Ex12.m1.5.5.5.1.1.1">𝑗</ci></apply></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex12.m1.8c">\displaystyle=\prod_{k=1}^{K}\frac{\exp(r(x,y_{\tau(k)}))}{\sum_{j=k}^{K}\exp(%
r(x,y_{\tau(j)}))}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex12.m1.8d">= ∏ start_POSTSUBSCRIPT italic_k = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT divide start_ARG roman_exp ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_k ) end_POSTSUBSCRIPT ) ) end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_j = italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_K end_POSTSUPERSCRIPT roman_exp ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_τ ( italic_j ) end_POSTSUBSCRIPT ) ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex13"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=p_{r}(\tau|y_{1},\ldots,y_{K},x)," class="ltx_Math" display="inline" id="A1.Ex13.m1.3"><semantics id="A1.Ex13.m1.3a"><mrow id="A1.Ex13.m1.3.3.1" xref="A1.Ex13.m1.3.3.1.1.cmml"><mrow id="A1.Ex13.m1.3.3.1.1" xref="A1.Ex13.m1.3.3.1.1.cmml"><mi id="A1.Ex13.m1.3.3.1.1.3" xref="A1.Ex13.m1.3.3.1.1.3.cmml"></mi><mo id="A1.Ex13.m1.3.3.1.1.2" xref="A1.Ex13.m1.3.3.1.1.2.cmml">=</mo><mrow id="A1.Ex13.m1.3.3.1.1.1" xref="A1.Ex13.m1.3.3.1.1.1.cmml"><msub id="A1.Ex13.m1.3.3.1.1.1.3" xref="A1.Ex13.m1.3.3.1.1.1.3.cmml"><mi id="A1.Ex13.m1.3.3.1.1.1.3.2" xref="A1.Ex13.m1.3.3.1.1.1.3.2.cmml">p</mi><mi id="A1.Ex13.m1.3.3.1.1.1.3.3" xref="A1.Ex13.m1.3.3.1.1.1.3.3.cmml">r</mi></msub><mo id="A1.Ex13.m1.3.3.1.1.1.2" xref="A1.Ex13.m1.3.3.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex13.m1.3.3.1.1.1.1.1" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.cmml"><mo id="A1.Ex13.m1.3.3.1.1.1.1.1.2" stretchy="false" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex13.m1.3.3.1.1.1.1.1.1" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.cmml"><mi id="A1.Ex13.m1.3.3.1.1.1.1.1.1.4" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.4.cmml">τ</mi><mo fence="false" id="A1.Ex13.m1.3.3.1.1.1.1.1.1.3" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.3.cmml">|</mo><mrow id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.3.cmml"><msub id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.2" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.3" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.3" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.3.cmml">,</mo><mi id="A1.Ex13.m1.1.1" mathvariant="normal" xref="A1.Ex13.m1.1.1.cmml">…</mi><mo id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.4" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.3.cmml">,</mo><msub id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.cmml"><mi id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.2" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.3" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.3.cmml">K</mi></msub><mo id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.5" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.3.cmml">,</mo><mi id="A1.Ex13.m1.2.2" xref="A1.Ex13.m1.2.2.cmml">x</mi></mrow></mrow><mo id="A1.Ex13.m1.3.3.1.1.1.1.1.3" stretchy="false" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex13.m1.3.3.1.2" xref="A1.Ex13.m1.3.3.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex13.m1.3b"><apply id="A1.Ex13.m1.3.3.1.1.cmml" xref="A1.Ex13.m1.3.3.1"><eq id="A1.Ex13.m1.3.3.1.1.2.cmml" xref="A1.Ex13.m1.3.3.1.1.2"></eq><csymbol cd="latexml" id="A1.Ex13.m1.3.3.1.1.3.cmml" xref="A1.Ex13.m1.3.3.1.1.3">absent</csymbol><apply id="A1.Ex13.m1.3.3.1.1.1.cmml" xref="A1.Ex13.m1.3.3.1.1.1"><times id="A1.Ex13.m1.3.3.1.1.1.2.cmml" xref="A1.Ex13.m1.3.3.1.1.1.2"></times><apply id="A1.Ex13.m1.3.3.1.1.1.3.cmml" xref="A1.Ex13.m1.3.3.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex13.m1.3.3.1.1.1.3.1.cmml" xref="A1.Ex13.m1.3.3.1.1.1.3">subscript</csymbol><ci id="A1.Ex13.m1.3.3.1.1.1.3.2.cmml" xref="A1.Ex13.m1.3.3.1.1.1.3.2">𝑝</ci><ci id="A1.Ex13.m1.3.3.1.1.1.3.3.cmml" xref="A1.Ex13.m1.3.3.1.1.1.3.3">𝑟</ci></apply><apply id="A1.Ex13.m1.3.3.1.1.1.1.1.1.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex13.m1.3.3.1.1.1.1.1.1.3.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.3">conditional</csymbol><ci id="A1.Ex13.m1.3.3.1.1.1.1.1.1.4.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.4">𝜏</ci><list id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.3.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2"><apply id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.1.1.1.3">1</cn></apply><ci id="A1.Ex13.m1.1.1.cmml" xref="A1.Ex13.m1.1.1">…</ci><apply id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.1.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.2.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.2">𝑦</ci><ci id="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.3.cmml" xref="A1.Ex13.m1.3.3.1.1.1.1.1.1.2.2.2.3">𝐾</ci></apply><ci id="A1.Ex13.m1.2.2.cmml" xref="A1.Ex13.m1.2.2">𝑥</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex13.m1.3c">\displaystyle=p_{r}(\tau|y_{1},\ldots,y_{K},x),</annotation><annotation encoding="application/x-llamapun" id="A1.Ex13.m1.3d">= italic_p start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_τ | italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_K end_POSTSUBSCRIPT , italic_x ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS5.1.p1.11">which completes the proof.
∎</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_para" id="A1.SS5.p3">
<p class="ltx_p" id="A1.SS5.p3.1"><span class="ltx_text ltx_font_bold" id="A1.SS5.p3.1.1">Lemma 2 Restated.</span><span class="ltx_text ltx_font_italic" id="A1.SS5.p3.1.2"> Two reward functions from the same equivalence class induce the same optimal policy under the constrained RL problem.
</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_proof" id="A1.SS5.2">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS5.2.p1">
<p class="ltx_p" id="A1.SS5.2.p1.4">Let us consider two reward functions from the same class, such that <math alttext="r^{\prime}(x,y)=r(x,y)+f(x)" class="ltx_Math" display="inline" id="A1.SS5.2.p1.1.m1.5"><semantics id="A1.SS5.2.p1.1.m1.5a"><mrow id="A1.SS5.2.p1.1.m1.5.6" xref="A1.SS5.2.p1.1.m1.5.6.cmml"><mrow id="A1.SS5.2.p1.1.m1.5.6.2" xref="A1.SS5.2.p1.1.m1.5.6.2.cmml"><msup id="A1.SS5.2.p1.1.m1.5.6.2.2" xref="A1.SS5.2.p1.1.m1.5.6.2.2.cmml"><mi id="A1.SS5.2.p1.1.m1.5.6.2.2.2" xref="A1.SS5.2.p1.1.m1.5.6.2.2.2.cmml">r</mi><mo id="A1.SS5.2.p1.1.m1.5.6.2.2.3" xref="A1.SS5.2.p1.1.m1.5.6.2.2.3.cmml">′</mo></msup><mo id="A1.SS5.2.p1.1.m1.5.6.2.1" xref="A1.SS5.2.p1.1.m1.5.6.2.1.cmml">⁢</mo><mrow id="A1.SS5.2.p1.1.m1.5.6.2.3.2" xref="A1.SS5.2.p1.1.m1.5.6.2.3.1.cmml"><mo id="A1.SS5.2.p1.1.m1.5.6.2.3.2.1" stretchy="false" xref="A1.SS5.2.p1.1.m1.5.6.2.3.1.cmml">(</mo><mi id="A1.SS5.2.p1.1.m1.1.1" xref="A1.SS5.2.p1.1.m1.1.1.cmml">x</mi><mo id="A1.SS5.2.p1.1.m1.5.6.2.3.2.2" xref="A1.SS5.2.p1.1.m1.5.6.2.3.1.cmml">,</mo><mi id="A1.SS5.2.p1.1.m1.2.2" xref="A1.SS5.2.p1.1.m1.2.2.cmml">y</mi><mo id="A1.SS5.2.p1.1.m1.5.6.2.3.2.3" stretchy="false" xref="A1.SS5.2.p1.1.m1.5.6.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS5.2.p1.1.m1.5.6.1" xref="A1.SS5.2.p1.1.m1.5.6.1.cmml">=</mo><mrow id="A1.SS5.2.p1.1.m1.5.6.3" xref="A1.SS5.2.p1.1.m1.5.6.3.cmml"><mrow id="A1.SS5.2.p1.1.m1.5.6.3.2" xref="A1.SS5.2.p1.1.m1.5.6.3.2.cmml"><mi id="A1.SS5.2.p1.1.m1.5.6.3.2.2" xref="A1.SS5.2.p1.1.m1.5.6.3.2.2.cmml">r</mi><mo id="A1.SS5.2.p1.1.m1.5.6.3.2.1" xref="A1.SS5.2.p1.1.m1.5.6.3.2.1.cmml">⁢</mo><mrow id="A1.SS5.2.p1.1.m1.5.6.3.2.3.2" xref="A1.SS5.2.p1.1.m1.5.6.3.2.3.1.cmml"><mo id="A1.SS5.2.p1.1.m1.5.6.3.2.3.2.1" stretchy="false" xref="A1.SS5.2.p1.1.m1.5.6.3.2.3.1.cmml">(</mo><mi id="A1.SS5.2.p1.1.m1.3.3" xref="A1.SS5.2.p1.1.m1.3.3.cmml">x</mi><mo id="A1.SS5.2.p1.1.m1.5.6.3.2.3.2.2" xref="A1.SS5.2.p1.1.m1.5.6.3.2.3.1.cmml">,</mo><mi id="A1.SS5.2.p1.1.m1.4.4" xref="A1.SS5.2.p1.1.m1.4.4.cmml">y</mi><mo id="A1.SS5.2.p1.1.m1.5.6.3.2.3.2.3" stretchy="false" xref="A1.SS5.2.p1.1.m1.5.6.3.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS5.2.p1.1.m1.5.6.3.1" xref="A1.SS5.2.p1.1.m1.5.6.3.1.cmml">+</mo><mrow id="A1.SS5.2.p1.1.m1.5.6.3.3" xref="A1.SS5.2.p1.1.m1.5.6.3.3.cmml"><mi id="A1.SS5.2.p1.1.m1.5.6.3.3.2" xref="A1.SS5.2.p1.1.m1.5.6.3.3.2.cmml">f</mi><mo id="A1.SS5.2.p1.1.m1.5.6.3.3.1" xref="A1.SS5.2.p1.1.m1.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.SS5.2.p1.1.m1.5.6.3.3.3.2" xref="A1.SS5.2.p1.1.m1.5.6.3.3.cmml"><mo id="A1.SS5.2.p1.1.m1.5.6.3.3.3.2.1" stretchy="false" xref="A1.SS5.2.p1.1.m1.5.6.3.3.cmml">(</mo><mi id="A1.SS5.2.p1.1.m1.5.5" xref="A1.SS5.2.p1.1.m1.5.5.cmml">x</mi><mo id="A1.SS5.2.p1.1.m1.5.6.3.3.3.2.2" stretchy="false" xref="A1.SS5.2.p1.1.m1.5.6.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.2.p1.1.m1.5b"><apply id="A1.SS5.2.p1.1.m1.5.6.cmml" xref="A1.SS5.2.p1.1.m1.5.6"><eq id="A1.SS5.2.p1.1.m1.5.6.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.1"></eq><apply id="A1.SS5.2.p1.1.m1.5.6.2.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2"><times id="A1.SS5.2.p1.1.m1.5.6.2.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2.1"></times><apply id="A1.SS5.2.p1.1.m1.5.6.2.2.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2.2"><csymbol cd="ambiguous" id="A1.SS5.2.p1.1.m1.5.6.2.2.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2.2">superscript</csymbol><ci id="A1.SS5.2.p1.1.m1.5.6.2.2.2.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2.2.2">𝑟</ci><ci id="A1.SS5.2.p1.1.m1.5.6.2.2.3.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2.2.3">′</ci></apply><interval closure="open" id="A1.SS5.2.p1.1.m1.5.6.2.3.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.2.3.2"><ci id="A1.SS5.2.p1.1.m1.1.1.cmml" xref="A1.SS5.2.p1.1.m1.1.1">𝑥</ci><ci id="A1.SS5.2.p1.1.m1.2.2.cmml" xref="A1.SS5.2.p1.1.m1.2.2">𝑦</ci></interval></apply><apply id="A1.SS5.2.p1.1.m1.5.6.3.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3"><plus id="A1.SS5.2.p1.1.m1.5.6.3.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.1"></plus><apply id="A1.SS5.2.p1.1.m1.5.6.3.2.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.2"><times id="A1.SS5.2.p1.1.m1.5.6.3.2.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.2.1"></times><ci id="A1.SS5.2.p1.1.m1.5.6.3.2.2.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.2.2">𝑟</ci><interval closure="open" id="A1.SS5.2.p1.1.m1.5.6.3.2.3.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.2.3.2"><ci id="A1.SS5.2.p1.1.m1.3.3.cmml" xref="A1.SS5.2.p1.1.m1.3.3">𝑥</ci><ci id="A1.SS5.2.p1.1.m1.4.4.cmml" xref="A1.SS5.2.p1.1.m1.4.4">𝑦</ci></interval></apply><apply id="A1.SS5.2.p1.1.m1.5.6.3.3.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.3"><times id="A1.SS5.2.p1.1.m1.5.6.3.3.1.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.3.1"></times><ci id="A1.SS5.2.p1.1.m1.5.6.3.3.2.cmml" xref="A1.SS5.2.p1.1.m1.5.6.3.3.2">𝑓</ci><ci id="A1.SS5.2.p1.1.m1.5.5.cmml" xref="A1.SS5.2.p1.1.m1.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.2.p1.1.m1.5c">r^{\prime}(x,y)=r(x,y)+f(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.2.p1.1.m1.5d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_r ( italic_x , italic_y ) + italic_f ( italic_x )</annotation></semantics></math> and, let us denote as <math alttext="\pi_{r}" class="ltx_Math" display="inline" id="A1.SS5.2.p1.2.m2.1"><semantics id="A1.SS5.2.p1.2.m2.1a"><msub id="A1.SS5.2.p1.2.m2.1.1" xref="A1.SS5.2.p1.2.m2.1.1.cmml"><mi id="A1.SS5.2.p1.2.m2.1.1.2" xref="A1.SS5.2.p1.2.m2.1.1.2.cmml">π</mi><mi id="A1.SS5.2.p1.2.m2.1.1.3" xref="A1.SS5.2.p1.2.m2.1.1.3.cmml">r</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS5.2.p1.2.m2.1b"><apply id="A1.SS5.2.p1.2.m2.1.1.cmml" xref="A1.SS5.2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS5.2.p1.2.m2.1.1.1.cmml" xref="A1.SS5.2.p1.2.m2.1.1">subscript</csymbol><ci id="A1.SS5.2.p1.2.m2.1.1.2.cmml" xref="A1.SS5.2.p1.2.m2.1.1.2">𝜋</ci><ci id="A1.SS5.2.p1.2.m2.1.1.3.cmml" xref="A1.SS5.2.p1.2.m2.1.1.3">𝑟</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.2.p1.2.m2.1c">\pi_{r}</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.2.p1.2.m2.1d">italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\pi_{r^{\prime}}" class="ltx_Math" display="inline" id="A1.SS5.2.p1.3.m3.1"><semantics id="A1.SS5.2.p1.3.m3.1a"><msub id="A1.SS5.2.p1.3.m3.1.1" xref="A1.SS5.2.p1.3.m3.1.1.cmml"><mi id="A1.SS5.2.p1.3.m3.1.1.2" xref="A1.SS5.2.p1.3.m3.1.1.2.cmml">π</mi><msup id="A1.SS5.2.p1.3.m3.1.1.3" xref="A1.SS5.2.p1.3.m3.1.1.3.cmml"><mi id="A1.SS5.2.p1.3.m3.1.1.3.2" xref="A1.SS5.2.p1.3.m3.1.1.3.2.cmml">r</mi><mo id="A1.SS5.2.p1.3.m3.1.1.3.3" xref="A1.SS5.2.p1.3.m3.1.1.3.3.cmml">′</mo></msup></msub><annotation-xml encoding="MathML-Content" id="A1.SS5.2.p1.3.m3.1b"><apply id="A1.SS5.2.p1.3.m3.1.1.cmml" xref="A1.SS5.2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="A1.SS5.2.p1.3.m3.1.1.1.cmml" xref="A1.SS5.2.p1.3.m3.1.1">subscript</csymbol><ci id="A1.SS5.2.p1.3.m3.1.1.2.cmml" xref="A1.SS5.2.p1.3.m3.1.1.2">𝜋</ci><apply id="A1.SS5.2.p1.3.m3.1.1.3.cmml" xref="A1.SS5.2.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="A1.SS5.2.p1.3.m3.1.1.3.1.cmml" xref="A1.SS5.2.p1.3.m3.1.1.3">superscript</csymbol><ci id="A1.SS5.2.p1.3.m3.1.1.3.2.cmml" xref="A1.SS5.2.p1.3.m3.1.1.3.2">𝑟</ci><ci id="A1.SS5.2.p1.3.m3.1.1.3.3.cmml" xref="A1.SS5.2.p1.3.m3.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.2.p1.3.m3.1c">\pi_{r^{\prime}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.2.p1.3.m3.1d">italic_π start_POSTSUBSCRIPT italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT</annotation></semantics></math> the corresponding optimal policies. By Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>, for all <math alttext="x,y" class="ltx_Math" display="inline" id="A1.SS5.2.p1.4.m4.2"><semantics id="A1.SS5.2.p1.4.m4.2a"><mrow id="A1.SS5.2.p1.4.m4.2.3.2" xref="A1.SS5.2.p1.4.m4.2.3.1.cmml"><mi id="A1.SS5.2.p1.4.m4.1.1" xref="A1.SS5.2.p1.4.m4.1.1.cmml">x</mi><mo id="A1.SS5.2.p1.4.m4.2.3.2.1" xref="A1.SS5.2.p1.4.m4.2.3.1.cmml">,</mo><mi id="A1.SS5.2.p1.4.m4.2.2" xref="A1.SS5.2.p1.4.m4.2.2.cmml">y</mi></mrow><annotation-xml encoding="MathML-Content" id="A1.SS5.2.p1.4.m4.2b"><list id="A1.SS5.2.p1.4.m4.2.3.1.cmml" xref="A1.SS5.2.p1.4.m4.2.3.2"><ci id="A1.SS5.2.p1.4.m4.1.1.cmml" xref="A1.SS5.2.p1.4.m4.1.1">𝑥</ci><ci id="A1.SS5.2.p1.4.m4.2.2.cmml" xref="A1.SS5.2.p1.4.m4.2.2">𝑦</ci></list></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.2.p1.4.m4.2c">x,y</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.2.p1.4.m4.2d">italic_x , italic_y</annotation></semantics></math> we have</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx7">
<tbody id="A1.Ex14"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle\pi_{r^{\prime}}(y|x)" class="ltx_Math" display="inline" id="A1.Ex14.m1.1"><semantics id="A1.Ex14.m1.1a"><mrow id="A1.Ex14.m1.1.1" xref="A1.Ex14.m1.1.1.cmml"><msub id="A1.Ex14.m1.1.1.3" xref="A1.Ex14.m1.1.1.3.cmml"><mi id="A1.Ex14.m1.1.1.3.2" xref="A1.Ex14.m1.1.1.3.2.cmml">π</mi><msup id="A1.Ex14.m1.1.1.3.3" xref="A1.Ex14.m1.1.1.3.3.cmml"><mi id="A1.Ex14.m1.1.1.3.3.2" xref="A1.Ex14.m1.1.1.3.3.2.cmml">r</mi><mo id="A1.Ex14.m1.1.1.3.3.3" xref="A1.Ex14.m1.1.1.3.3.3.cmml">′</mo></msup></msub><mo id="A1.Ex14.m1.1.1.2" xref="A1.Ex14.m1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex14.m1.1.1.1.1" xref="A1.Ex14.m1.1.1.1.1.1.cmml"><mo id="A1.Ex14.m1.1.1.1.1.2" stretchy="false" xref="A1.Ex14.m1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex14.m1.1.1.1.1.1" xref="A1.Ex14.m1.1.1.1.1.1.cmml"><mi id="A1.Ex14.m1.1.1.1.1.1.2" xref="A1.Ex14.m1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex14.m1.1.1.1.1.1.1" xref="A1.Ex14.m1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex14.m1.1.1.1.1.1.3" xref="A1.Ex14.m1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex14.m1.1.1.1.1.3" stretchy="false" xref="A1.Ex14.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex14.m1.1b"><apply id="A1.Ex14.m1.1.1.cmml" xref="A1.Ex14.m1.1.1"><times id="A1.Ex14.m1.1.1.2.cmml" xref="A1.Ex14.m1.1.1.2"></times><apply id="A1.Ex14.m1.1.1.3.cmml" xref="A1.Ex14.m1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex14.m1.1.1.3.1.cmml" xref="A1.Ex14.m1.1.1.3">subscript</csymbol><ci id="A1.Ex14.m1.1.1.3.2.cmml" xref="A1.Ex14.m1.1.1.3.2">𝜋</ci><apply id="A1.Ex14.m1.1.1.3.3.cmml" xref="A1.Ex14.m1.1.1.3.3"><csymbol cd="ambiguous" id="A1.Ex14.m1.1.1.3.3.1.cmml" xref="A1.Ex14.m1.1.1.3.3">superscript</csymbol><ci id="A1.Ex14.m1.1.1.3.3.2.cmml" xref="A1.Ex14.m1.1.1.3.3.2">𝑟</ci><ci id="A1.Ex14.m1.1.1.3.3.3.cmml" xref="A1.Ex14.m1.1.1.3.3.3">′</ci></apply></apply><apply id="A1.Ex14.m1.1.1.1.1.1.cmml" xref="A1.Ex14.m1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex14.m1.1.1.1.1.1.1.cmml" xref="A1.Ex14.m1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex14.m1.1.1.1.1.1.2.cmml" xref="A1.Ex14.m1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex14.m1.1.1.1.1.1.3.cmml" xref="A1.Ex14.m1.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex14.m1.1c">\displaystyle\pi_{r^{\prime}}(y|x)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex14.m1.1d">italic_π start_POSTSUBSCRIPT italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_POSTSUBSCRIPT ( italic_y | italic_x )</annotation></semantics></math></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{1}{\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r%
^{\prime}(x,y)\right)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r^{\prime}%
(x,y)\right)" class="ltx_Math" display="inline" id="A1.Ex14.m2.10"><semantics id="A1.Ex14.m2.10a"><mrow id="A1.Ex14.m2.10.10" xref="A1.Ex14.m2.10.10.cmml"><mi id="A1.Ex14.m2.10.10.4" xref="A1.Ex14.m2.10.10.4.cmml"></mi><mo id="A1.Ex14.m2.10.10.3" xref="A1.Ex14.m2.10.10.3.cmml">=</mo><mrow id="A1.Ex14.m2.10.10.2" xref="A1.Ex14.m2.10.10.2.cmml"><mstyle displaystyle="true" id="A1.Ex14.m2.5.5" xref="A1.Ex14.m2.5.5.cmml"><mfrac id="A1.Ex14.m2.5.5a" xref="A1.Ex14.m2.5.5.cmml"><mn id="A1.Ex14.m2.5.5.7" xref="A1.Ex14.m2.5.5.7.cmml">1</mn><mrow id="A1.Ex14.m2.5.5.5" xref="A1.Ex14.m2.5.5.5.cmml"><msub id="A1.Ex14.m2.5.5.5.6" xref="A1.Ex14.m2.5.5.5.6.cmml"><mo id="A1.Ex14.m2.5.5.5.6.2" xref="A1.Ex14.m2.5.5.5.6.2.cmml">∑</mo><mi id="A1.Ex14.m2.5.5.5.6.3" xref="A1.Ex14.m2.5.5.5.6.3.cmml">y</mi></msub><mrow id="A1.Ex14.m2.5.5.5.5" xref="A1.Ex14.m2.5.5.5.5.cmml"><msub id="A1.Ex14.m2.5.5.5.5.4" xref="A1.Ex14.m2.5.5.5.5.4.cmml"><mi id="A1.Ex14.m2.5.5.5.5.4.2" xref="A1.Ex14.m2.5.5.5.5.4.2.cmml">π</mi><mtext id="A1.Ex14.m2.5.5.5.5.4.3" xref="A1.Ex14.m2.5.5.5.5.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex14.m2.5.5.5.5.3" xref="A1.Ex14.m2.5.5.5.5.3.cmml">⁢</mo><mrow id="A1.Ex14.m2.4.4.4.4.1.1" xref="A1.Ex14.m2.4.4.4.4.1.1.1.cmml"><mo id="A1.Ex14.m2.4.4.4.4.1.1.2" stretchy="false" xref="A1.Ex14.m2.4.4.4.4.1.1.1.cmml">(</mo><mrow id="A1.Ex14.m2.4.4.4.4.1.1.1" xref="A1.Ex14.m2.4.4.4.4.1.1.1.cmml"><mi id="A1.Ex14.m2.4.4.4.4.1.1.1.2" xref="A1.Ex14.m2.4.4.4.4.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex14.m2.4.4.4.4.1.1.1.1" xref="A1.Ex14.m2.4.4.4.4.1.1.1.1.cmml">|</mo><mi id="A1.Ex14.m2.4.4.4.4.1.1.1.3" xref="A1.Ex14.m2.4.4.4.4.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex14.m2.4.4.4.4.1.1.3" stretchy="false" xref="A1.Ex14.m2.4.4.4.4.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex14.m2.5.5.5.5.3a" lspace="0.167em" xref="A1.Ex14.m2.5.5.5.5.3.cmml">⁢</mo><mrow id="A1.Ex14.m2.5.5.5.5.2.1" xref="A1.Ex14.m2.5.5.5.5.2.2.cmml"><mi id="A1.Ex14.m2.3.3.3.3" xref="A1.Ex14.m2.3.3.3.3.cmml">exp</mi><mo id="A1.Ex14.m2.5.5.5.5.2.1a" xref="A1.Ex14.m2.5.5.5.5.2.2.cmml">⁡</mo><mrow id="A1.Ex14.m2.5.5.5.5.2.1.1" xref="A1.Ex14.m2.5.5.5.5.2.2.cmml"><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.2" xref="A1.Ex14.m2.5.5.5.5.2.2.cmml">(</mo><mrow id="A1.Ex14.m2.5.5.5.5.2.1.1.1" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.cmml"><mfrac id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.cmml"><mn id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.2" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.3" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.1.1" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.1.cmml">⁢</mo><msup id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.cmml"><mi id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.2" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.2.cmml">r</mi><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.3" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.3.cmml">′</mo></msup><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.1.1a" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.2" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.1.cmml"><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex14.m2.1.1.1.1" xref="A1.Ex14.m2.1.1.1.1.cmml">x</mi><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.2.2" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex14.m2.2.2.2.2" xref="A1.Ex14.m2.2.2.2.2.cmml">y</mi><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex14.m2.5.5.5.5.2.1.1.3" xref="A1.Ex14.m2.5.5.5.5.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mfrac></mstyle><mo id="A1.Ex14.m2.10.10.2.3" xref="A1.Ex14.m2.10.10.2.3.cmml">⁢</mo><msub id="A1.Ex14.m2.10.10.2.4" xref="A1.Ex14.m2.10.10.2.4.cmml"><mi id="A1.Ex14.m2.10.10.2.4.2" xref="A1.Ex14.m2.10.10.2.4.2.cmml">π</mi><mtext id="A1.Ex14.m2.10.10.2.4.3" xref="A1.Ex14.m2.10.10.2.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex14.m2.10.10.2.3a" xref="A1.Ex14.m2.10.10.2.3.cmml">⁢</mo><mrow id="A1.Ex14.m2.9.9.1.1.1" xref="A1.Ex14.m2.9.9.1.1.1.1.cmml"><mo id="A1.Ex14.m2.9.9.1.1.1.2" stretchy="false" xref="A1.Ex14.m2.9.9.1.1.1.1.cmml">(</mo><mrow id="A1.Ex14.m2.9.9.1.1.1.1" xref="A1.Ex14.m2.9.9.1.1.1.1.cmml"><mi id="A1.Ex14.m2.9.9.1.1.1.1.2" xref="A1.Ex14.m2.9.9.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex14.m2.9.9.1.1.1.1.1" xref="A1.Ex14.m2.9.9.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex14.m2.9.9.1.1.1.1.3" xref="A1.Ex14.m2.9.9.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex14.m2.9.9.1.1.1.3" stretchy="false" xref="A1.Ex14.m2.9.9.1.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex14.m2.10.10.2.3b" lspace="0.167em" xref="A1.Ex14.m2.10.10.2.3.cmml">⁢</mo><mrow id="A1.Ex14.m2.10.10.2.2.1" xref="A1.Ex14.m2.10.10.2.2.2.cmml"><mi id="A1.Ex14.m2.8.8" xref="A1.Ex14.m2.8.8.cmml">exp</mi><mo id="A1.Ex14.m2.10.10.2.2.1a" xref="A1.Ex14.m2.10.10.2.2.2.cmml">⁡</mo><mrow id="A1.Ex14.m2.10.10.2.2.1.1" xref="A1.Ex14.m2.10.10.2.2.2.cmml"><mo id="A1.Ex14.m2.10.10.2.2.1.1.2" xref="A1.Ex14.m2.10.10.2.2.2.cmml">(</mo><mrow id="A1.Ex14.m2.10.10.2.2.1.1.1" xref="A1.Ex14.m2.10.10.2.2.1.1.1.cmml"><mstyle displaystyle="true" id="A1.Ex14.m2.10.10.2.2.1.1.1.2" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2.cmml"><mfrac id="A1.Ex14.m2.10.10.2.2.1.1.1.2a" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2.cmml"><mn id="A1.Ex14.m2.10.10.2.2.1.1.1.2.2" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex14.m2.10.10.2.2.1.1.1.2.3" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2.3.cmml">β</mi></mfrac></mstyle><mo id="A1.Ex14.m2.10.10.2.2.1.1.1.1" xref="A1.Ex14.m2.10.10.2.2.1.1.1.1.cmml">⁢</mo><msup id="A1.Ex14.m2.10.10.2.2.1.1.1.3" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3.cmml"><mi id="A1.Ex14.m2.10.10.2.2.1.1.1.3.2" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3.2.cmml">r</mi><mo id="A1.Ex14.m2.10.10.2.2.1.1.1.3.3" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3.3.cmml">′</mo></msup><mo id="A1.Ex14.m2.10.10.2.2.1.1.1.1a" xref="A1.Ex14.m2.10.10.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex14.m2.10.10.2.2.1.1.1.4.2" xref="A1.Ex14.m2.10.10.2.2.1.1.1.4.1.cmml"><mo id="A1.Ex14.m2.10.10.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex14.m2.10.10.2.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex14.m2.6.6" xref="A1.Ex14.m2.6.6.cmml">x</mi><mo id="A1.Ex14.m2.10.10.2.2.1.1.1.4.2.2" xref="A1.Ex14.m2.10.10.2.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex14.m2.7.7" xref="A1.Ex14.m2.7.7.cmml">y</mi><mo id="A1.Ex14.m2.10.10.2.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex14.m2.10.10.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex14.m2.10.10.2.2.1.1.3" xref="A1.Ex14.m2.10.10.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex14.m2.10b"><apply id="A1.Ex14.m2.10.10.cmml" xref="A1.Ex14.m2.10.10"><eq id="A1.Ex14.m2.10.10.3.cmml" xref="A1.Ex14.m2.10.10.3"></eq><csymbol cd="latexml" id="A1.Ex14.m2.10.10.4.cmml" xref="A1.Ex14.m2.10.10.4">absent</csymbol><apply id="A1.Ex14.m2.10.10.2.cmml" xref="A1.Ex14.m2.10.10.2"><times id="A1.Ex14.m2.10.10.2.3.cmml" xref="A1.Ex14.m2.10.10.2.3"></times><apply id="A1.Ex14.m2.5.5.cmml" xref="A1.Ex14.m2.5.5"><divide id="A1.Ex14.m2.5.5.6.cmml" xref="A1.Ex14.m2.5.5"></divide><cn id="A1.Ex14.m2.5.5.7.cmml" type="integer" xref="A1.Ex14.m2.5.5.7">1</cn><apply id="A1.Ex14.m2.5.5.5.cmml" xref="A1.Ex14.m2.5.5.5"><apply id="A1.Ex14.m2.5.5.5.6.cmml" xref="A1.Ex14.m2.5.5.5.6"><csymbol cd="ambiguous" id="A1.Ex14.m2.5.5.5.6.1.cmml" xref="A1.Ex14.m2.5.5.5.6">subscript</csymbol><sum id="A1.Ex14.m2.5.5.5.6.2.cmml" xref="A1.Ex14.m2.5.5.5.6.2"></sum><ci id="A1.Ex14.m2.5.5.5.6.3.cmml" xref="A1.Ex14.m2.5.5.5.6.3">𝑦</ci></apply><apply id="A1.Ex14.m2.5.5.5.5.cmml" xref="A1.Ex14.m2.5.5.5.5"><times id="A1.Ex14.m2.5.5.5.5.3.cmml" xref="A1.Ex14.m2.5.5.5.5.3"></times><apply id="A1.Ex14.m2.5.5.5.5.4.cmml" xref="A1.Ex14.m2.5.5.5.5.4"><csymbol cd="ambiguous" id="A1.Ex14.m2.5.5.5.5.4.1.cmml" xref="A1.Ex14.m2.5.5.5.5.4">subscript</csymbol><ci id="A1.Ex14.m2.5.5.5.5.4.2.cmml" xref="A1.Ex14.m2.5.5.5.5.4.2">𝜋</ci><ci id="A1.Ex14.m2.5.5.5.5.4.3a.cmml" xref="A1.Ex14.m2.5.5.5.5.4.3"><mtext id="A1.Ex14.m2.5.5.5.5.4.3.cmml" mathsize="70%" xref="A1.Ex14.m2.5.5.5.5.4.3">ref</mtext></ci></apply><apply id="A1.Ex14.m2.4.4.4.4.1.1.1.cmml" xref="A1.Ex14.m2.4.4.4.4.1.1"><csymbol cd="latexml" id="A1.Ex14.m2.4.4.4.4.1.1.1.1.cmml" xref="A1.Ex14.m2.4.4.4.4.1.1.1.1">conditional</csymbol><ci id="A1.Ex14.m2.4.4.4.4.1.1.1.2.cmml" xref="A1.Ex14.m2.4.4.4.4.1.1.1.2">𝑦</ci><ci id="A1.Ex14.m2.4.4.4.4.1.1.1.3.cmml" xref="A1.Ex14.m2.4.4.4.4.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex14.m2.5.5.5.5.2.2.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1"><exp id="A1.Ex14.m2.3.3.3.3.cmml" xref="A1.Ex14.m2.3.3.3.3"></exp><apply id="A1.Ex14.m2.5.5.5.5.2.1.1.1.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1"><times id="A1.Ex14.m2.5.5.5.5.2.1.1.1.1.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.1"></times><apply id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2"><divide id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.1.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2"></divide><cn id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.2">1</cn><ci id="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.3.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.2.3">𝛽</ci></apply><apply id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.1.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3">superscript</csymbol><ci id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.2.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.2">𝑟</ci><ci id="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.3.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.3.3">′</ci></apply><interval closure="open" id="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.1.cmml" xref="A1.Ex14.m2.5.5.5.5.2.1.1.1.4.2"><ci id="A1.Ex14.m2.1.1.1.1.cmml" xref="A1.Ex14.m2.1.1.1.1">𝑥</ci><ci id="A1.Ex14.m2.2.2.2.2.cmml" xref="A1.Ex14.m2.2.2.2.2">𝑦</ci></interval></apply></apply></apply></apply></apply><apply id="A1.Ex14.m2.10.10.2.4.cmml" xref="A1.Ex14.m2.10.10.2.4"><csymbol cd="ambiguous" id="A1.Ex14.m2.10.10.2.4.1.cmml" xref="A1.Ex14.m2.10.10.2.4">subscript</csymbol><ci id="A1.Ex14.m2.10.10.2.4.2.cmml" xref="A1.Ex14.m2.10.10.2.4.2">𝜋</ci><ci id="A1.Ex14.m2.10.10.2.4.3a.cmml" xref="A1.Ex14.m2.10.10.2.4.3"><mtext id="A1.Ex14.m2.10.10.2.4.3.cmml" mathsize="70%" xref="A1.Ex14.m2.10.10.2.4.3">ref</mtext></ci></apply><apply id="A1.Ex14.m2.9.9.1.1.1.1.cmml" xref="A1.Ex14.m2.9.9.1.1.1"><csymbol cd="latexml" id="A1.Ex14.m2.9.9.1.1.1.1.1.cmml" xref="A1.Ex14.m2.9.9.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex14.m2.9.9.1.1.1.1.2.cmml" xref="A1.Ex14.m2.9.9.1.1.1.1.2">𝑦</ci><ci id="A1.Ex14.m2.9.9.1.1.1.1.3.cmml" xref="A1.Ex14.m2.9.9.1.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex14.m2.10.10.2.2.2.cmml" xref="A1.Ex14.m2.10.10.2.2.1"><exp id="A1.Ex14.m2.8.8.cmml" xref="A1.Ex14.m2.8.8"></exp><apply id="A1.Ex14.m2.10.10.2.2.1.1.1.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1"><times id="A1.Ex14.m2.10.10.2.2.1.1.1.1.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.1"></times><apply id="A1.Ex14.m2.10.10.2.2.1.1.1.2.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2"><divide id="A1.Ex14.m2.10.10.2.2.1.1.1.2.1.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2"></divide><cn id="A1.Ex14.m2.10.10.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2.2">1</cn><ci id="A1.Ex14.m2.10.10.2.2.1.1.1.2.3.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.2.3">𝛽</ci></apply><apply id="A1.Ex14.m2.10.10.2.2.1.1.1.3.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex14.m2.10.10.2.2.1.1.1.3.1.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3">superscript</csymbol><ci id="A1.Ex14.m2.10.10.2.2.1.1.1.3.2.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3.2">𝑟</ci><ci id="A1.Ex14.m2.10.10.2.2.1.1.1.3.3.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.3.3">′</ci></apply><interval closure="open" id="A1.Ex14.m2.10.10.2.2.1.1.1.4.1.cmml" xref="A1.Ex14.m2.10.10.2.2.1.1.1.4.2"><ci id="A1.Ex14.m2.6.6.cmml" xref="A1.Ex14.m2.6.6">𝑥</ci><ci id="A1.Ex14.m2.7.7.cmml" xref="A1.Ex14.m2.7.7">𝑦</ci></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex14.m2.10c">\displaystyle=\frac{1}{\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r%
^{\prime}(x,y)\right)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r^{\prime}%
(x,y)\right)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex14.m2.10d">= divide start_ARG 1 end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex15"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{1}{\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}(%
r(x,y)+f(x))\right)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}(r(x,y)+f(x)%
)\right)" class="ltx_Math" display="inline" id="A1.Ex15.m1.12"><semantics id="A1.Ex15.m1.12a"><mrow id="A1.Ex15.m1.12.12" xref="A1.Ex15.m1.12.12.cmml"><mi id="A1.Ex15.m1.12.12.4" xref="A1.Ex15.m1.12.12.4.cmml"></mi><mo id="A1.Ex15.m1.12.12.3" xref="A1.Ex15.m1.12.12.3.cmml">=</mo><mrow id="A1.Ex15.m1.12.12.2" xref="A1.Ex15.m1.12.12.2.cmml"><mstyle displaystyle="true" id="A1.Ex15.m1.6.6" xref="A1.Ex15.m1.6.6.cmml"><mfrac id="A1.Ex15.m1.6.6a" xref="A1.Ex15.m1.6.6.cmml"><mn id="A1.Ex15.m1.6.6.8" xref="A1.Ex15.m1.6.6.8.cmml">1</mn><mrow id="A1.Ex15.m1.6.6.6" xref="A1.Ex15.m1.6.6.6.cmml"><msub id="A1.Ex15.m1.6.6.6.7" xref="A1.Ex15.m1.6.6.6.7.cmml"><mo id="A1.Ex15.m1.6.6.6.7.2" xref="A1.Ex15.m1.6.6.6.7.2.cmml">∑</mo><mi id="A1.Ex15.m1.6.6.6.7.3" xref="A1.Ex15.m1.6.6.6.7.3.cmml">y</mi></msub><mrow id="A1.Ex15.m1.6.6.6.6" xref="A1.Ex15.m1.6.6.6.6.cmml"><msub id="A1.Ex15.m1.6.6.6.6.4" xref="A1.Ex15.m1.6.6.6.6.4.cmml"><mi id="A1.Ex15.m1.6.6.6.6.4.2" xref="A1.Ex15.m1.6.6.6.6.4.2.cmml">π</mi><mtext id="A1.Ex15.m1.6.6.6.6.4.3" xref="A1.Ex15.m1.6.6.6.6.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex15.m1.6.6.6.6.3" xref="A1.Ex15.m1.6.6.6.6.3.cmml">⁢</mo><mrow id="A1.Ex15.m1.5.5.5.5.1.1" xref="A1.Ex15.m1.5.5.5.5.1.1.1.cmml"><mo id="A1.Ex15.m1.5.5.5.5.1.1.2" stretchy="false" xref="A1.Ex15.m1.5.5.5.5.1.1.1.cmml">(</mo><mrow id="A1.Ex15.m1.5.5.5.5.1.1.1" xref="A1.Ex15.m1.5.5.5.5.1.1.1.cmml"><mi id="A1.Ex15.m1.5.5.5.5.1.1.1.2" xref="A1.Ex15.m1.5.5.5.5.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex15.m1.5.5.5.5.1.1.1.1" xref="A1.Ex15.m1.5.5.5.5.1.1.1.1.cmml">|</mo><mi id="A1.Ex15.m1.5.5.5.5.1.1.1.3" xref="A1.Ex15.m1.5.5.5.5.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex15.m1.5.5.5.5.1.1.3" stretchy="false" xref="A1.Ex15.m1.5.5.5.5.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex15.m1.6.6.6.6.3a" lspace="0.167em" xref="A1.Ex15.m1.6.6.6.6.3.cmml">⁢</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1" xref="A1.Ex15.m1.6.6.6.6.2.2.cmml"><mi id="A1.Ex15.m1.4.4.4.4" xref="A1.Ex15.m1.4.4.4.4.cmml">exp</mi><mo id="A1.Ex15.m1.6.6.6.6.2.1a" xref="A1.Ex15.m1.6.6.6.6.2.2.cmml">⁡</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1" xref="A1.Ex15.m1.6.6.6.6.2.2.cmml"><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.2" xref="A1.Ex15.m1.6.6.6.6.2.2.cmml">(</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.cmml"><mfrac id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.cmml"><mn id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.2.cmml">1</mn><mi id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.3" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.3.cmml">β</mi></mfrac><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.cmml"><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.2" stretchy="false" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.cmml"><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.2.cmml">r</mi><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.1" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.1.cmml"><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.2.1" stretchy="false" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.1.cmml">(</mo><mi id="A1.Ex15.m1.1.1.1.1" xref="A1.Ex15.m1.1.1.1.1.cmml">x</mi><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.2.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.1.cmml">,</mo><mi id="A1.Ex15.m1.2.2.2.2" xref="A1.Ex15.m1.2.2.2.2.cmml">y</mi><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.2.3" stretchy="false" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.1" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.1.cmml">+</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.cmml"><mi id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.2.cmml">f</mi><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.1" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.3.2" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.cmml"><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.3.2.1" stretchy="false" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.cmml">(</mo><mi id="A1.Ex15.m1.3.3.3.3" xref="A1.Ex15.m1.3.3.3.3.cmml">x</mi><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.3.2.2" stretchy="false" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.3" stretchy="false" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex15.m1.6.6.6.6.2.1.1.3" xref="A1.Ex15.m1.6.6.6.6.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mfrac></mstyle><mo id="A1.Ex15.m1.12.12.2.3" xref="A1.Ex15.m1.12.12.2.3.cmml">⁢</mo><msub id="A1.Ex15.m1.12.12.2.4" xref="A1.Ex15.m1.12.12.2.4.cmml"><mi id="A1.Ex15.m1.12.12.2.4.2" xref="A1.Ex15.m1.12.12.2.4.2.cmml">π</mi><mtext id="A1.Ex15.m1.12.12.2.4.3" xref="A1.Ex15.m1.12.12.2.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex15.m1.12.12.2.3a" xref="A1.Ex15.m1.12.12.2.3.cmml">⁢</mo><mrow id="A1.Ex15.m1.11.11.1.1.1" xref="A1.Ex15.m1.11.11.1.1.1.1.cmml"><mo id="A1.Ex15.m1.11.11.1.1.1.2" stretchy="false" xref="A1.Ex15.m1.11.11.1.1.1.1.cmml">(</mo><mrow id="A1.Ex15.m1.11.11.1.1.1.1" xref="A1.Ex15.m1.11.11.1.1.1.1.cmml"><mi id="A1.Ex15.m1.11.11.1.1.1.1.2" xref="A1.Ex15.m1.11.11.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex15.m1.11.11.1.1.1.1.1" xref="A1.Ex15.m1.11.11.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex15.m1.11.11.1.1.1.1.3" xref="A1.Ex15.m1.11.11.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex15.m1.11.11.1.1.1.3" stretchy="false" xref="A1.Ex15.m1.11.11.1.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex15.m1.12.12.2.3b" lspace="0.167em" xref="A1.Ex15.m1.12.12.2.3.cmml">⁢</mo><mrow id="A1.Ex15.m1.12.12.2.2.1" xref="A1.Ex15.m1.12.12.2.2.2.cmml"><mi id="A1.Ex15.m1.10.10" xref="A1.Ex15.m1.10.10.cmml">exp</mi><mo id="A1.Ex15.m1.12.12.2.2.1a" xref="A1.Ex15.m1.12.12.2.2.2.cmml">⁡</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1" xref="A1.Ex15.m1.12.12.2.2.2.cmml"><mo id="A1.Ex15.m1.12.12.2.2.1.1.2" xref="A1.Ex15.m1.12.12.2.2.2.cmml">(</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1" xref="A1.Ex15.m1.12.12.2.2.1.1.1.cmml"><mstyle displaystyle="true" id="A1.Ex15.m1.12.12.2.2.1.1.1.3" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3.cmml"><mfrac id="A1.Ex15.m1.12.12.2.2.1.1.1.3a" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3.cmml"><mn id="A1.Ex15.m1.12.12.2.2.1.1.1.3.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3.2.cmml">1</mn><mi id="A1.Ex15.m1.12.12.2.2.1.1.1.3.3" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3.3.cmml">β</mi></mfrac></mstyle><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.cmml"><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.2" stretchy="false" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.cmml"><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.cmml"><mi id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.2.cmml">r</mi><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.1" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.1.cmml">⁢</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.1.cmml"><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.2.1" stretchy="false" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.1.cmml">(</mo><mi id="A1.Ex15.m1.7.7" xref="A1.Ex15.m1.7.7.cmml">x</mi><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.2.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.1.cmml">,</mo><mi id="A1.Ex15.m1.8.8" xref="A1.Ex15.m1.8.8.cmml">y</mi><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.2.3" stretchy="false" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.1" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.1.cmml">+</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.cmml"><mi id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.2.cmml">f</mi><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.1" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.3.2" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.cmml"><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.3.2.1" stretchy="false" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.cmml">(</mo><mi id="A1.Ex15.m1.9.9" xref="A1.Ex15.m1.9.9.cmml">x</mi><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.3.2.2" stretchy="false" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.3" stretchy="false" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex15.m1.12.12.2.2.1.1.3" xref="A1.Ex15.m1.12.12.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex15.m1.12b"><apply id="A1.Ex15.m1.12.12.cmml" xref="A1.Ex15.m1.12.12"><eq id="A1.Ex15.m1.12.12.3.cmml" xref="A1.Ex15.m1.12.12.3"></eq><csymbol cd="latexml" id="A1.Ex15.m1.12.12.4.cmml" xref="A1.Ex15.m1.12.12.4">absent</csymbol><apply id="A1.Ex15.m1.12.12.2.cmml" xref="A1.Ex15.m1.12.12.2"><times id="A1.Ex15.m1.12.12.2.3.cmml" xref="A1.Ex15.m1.12.12.2.3"></times><apply id="A1.Ex15.m1.6.6.cmml" xref="A1.Ex15.m1.6.6"><divide id="A1.Ex15.m1.6.6.7.cmml" xref="A1.Ex15.m1.6.6"></divide><cn id="A1.Ex15.m1.6.6.8.cmml" type="integer" xref="A1.Ex15.m1.6.6.8">1</cn><apply id="A1.Ex15.m1.6.6.6.cmml" xref="A1.Ex15.m1.6.6.6"><apply id="A1.Ex15.m1.6.6.6.7.cmml" xref="A1.Ex15.m1.6.6.6.7"><csymbol cd="ambiguous" id="A1.Ex15.m1.6.6.6.7.1.cmml" xref="A1.Ex15.m1.6.6.6.7">subscript</csymbol><sum id="A1.Ex15.m1.6.6.6.7.2.cmml" xref="A1.Ex15.m1.6.6.6.7.2"></sum><ci id="A1.Ex15.m1.6.6.6.7.3.cmml" xref="A1.Ex15.m1.6.6.6.7.3">𝑦</ci></apply><apply id="A1.Ex15.m1.6.6.6.6.cmml" xref="A1.Ex15.m1.6.6.6.6"><times id="A1.Ex15.m1.6.6.6.6.3.cmml" xref="A1.Ex15.m1.6.6.6.6.3"></times><apply id="A1.Ex15.m1.6.6.6.6.4.cmml" xref="A1.Ex15.m1.6.6.6.6.4"><csymbol cd="ambiguous" id="A1.Ex15.m1.6.6.6.6.4.1.cmml" xref="A1.Ex15.m1.6.6.6.6.4">subscript</csymbol><ci id="A1.Ex15.m1.6.6.6.6.4.2.cmml" xref="A1.Ex15.m1.6.6.6.6.4.2">𝜋</ci><ci id="A1.Ex15.m1.6.6.6.6.4.3a.cmml" xref="A1.Ex15.m1.6.6.6.6.4.3"><mtext id="A1.Ex15.m1.6.6.6.6.4.3.cmml" mathsize="70%" xref="A1.Ex15.m1.6.6.6.6.4.3">ref</mtext></ci></apply><apply id="A1.Ex15.m1.5.5.5.5.1.1.1.cmml" xref="A1.Ex15.m1.5.5.5.5.1.1"><csymbol cd="latexml" id="A1.Ex15.m1.5.5.5.5.1.1.1.1.cmml" xref="A1.Ex15.m1.5.5.5.5.1.1.1.1">conditional</csymbol><ci id="A1.Ex15.m1.5.5.5.5.1.1.1.2.cmml" xref="A1.Ex15.m1.5.5.5.5.1.1.1.2">𝑦</ci><ci id="A1.Ex15.m1.5.5.5.5.1.1.1.3.cmml" xref="A1.Ex15.m1.5.5.5.5.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex15.m1.6.6.6.6.2.2.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1"><exp id="A1.Ex15.m1.4.4.4.4.cmml" xref="A1.Ex15.m1.4.4.4.4"></exp><apply id="A1.Ex15.m1.6.6.6.6.2.1.1.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1"><times id="A1.Ex15.m1.6.6.6.6.2.1.1.1.2.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.2"></times><apply id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3"><divide id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3"></divide><cn id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.2.cmml" type="integer" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.2">1</cn><ci id="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.3.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.3.3">𝛽</ci></apply><apply id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1"><plus id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.1"></plus><apply id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2"><times id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.1"></times><ci id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.2">𝑟</ci><interval closure="open" id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.2.3.2"><ci id="A1.Ex15.m1.1.1.1.1.cmml" xref="A1.Ex15.m1.1.1.1.1">𝑥</ci><ci id="A1.Ex15.m1.2.2.2.2.cmml" xref="A1.Ex15.m1.2.2.2.2">𝑦</ci></interval></apply><apply id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3"><times id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.1.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.1"></times><ci id="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.2.cmml" xref="A1.Ex15.m1.6.6.6.6.2.1.1.1.1.1.1.3.2">𝑓</ci><ci id="A1.Ex15.m1.3.3.3.3.cmml" xref="A1.Ex15.m1.3.3.3.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply><apply id="A1.Ex15.m1.12.12.2.4.cmml" xref="A1.Ex15.m1.12.12.2.4"><csymbol cd="ambiguous" id="A1.Ex15.m1.12.12.2.4.1.cmml" xref="A1.Ex15.m1.12.12.2.4">subscript</csymbol><ci id="A1.Ex15.m1.12.12.2.4.2.cmml" xref="A1.Ex15.m1.12.12.2.4.2">𝜋</ci><ci id="A1.Ex15.m1.12.12.2.4.3a.cmml" xref="A1.Ex15.m1.12.12.2.4.3"><mtext id="A1.Ex15.m1.12.12.2.4.3.cmml" mathsize="70%" xref="A1.Ex15.m1.12.12.2.4.3">ref</mtext></ci></apply><apply id="A1.Ex15.m1.11.11.1.1.1.1.cmml" xref="A1.Ex15.m1.11.11.1.1.1"><csymbol cd="latexml" id="A1.Ex15.m1.11.11.1.1.1.1.1.cmml" xref="A1.Ex15.m1.11.11.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex15.m1.11.11.1.1.1.1.2.cmml" xref="A1.Ex15.m1.11.11.1.1.1.1.2">𝑦</ci><ci id="A1.Ex15.m1.11.11.1.1.1.1.3.cmml" xref="A1.Ex15.m1.11.11.1.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex15.m1.12.12.2.2.2.cmml" xref="A1.Ex15.m1.12.12.2.2.1"><exp id="A1.Ex15.m1.10.10.cmml" xref="A1.Ex15.m1.10.10"></exp><apply id="A1.Ex15.m1.12.12.2.2.1.1.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1"><times id="A1.Ex15.m1.12.12.2.2.1.1.1.2.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.2"></times><apply id="A1.Ex15.m1.12.12.2.2.1.1.1.3.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3"><divide id="A1.Ex15.m1.12.12.2.2.1.1.1.3.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3"></divide><cn id="A1.Ex15.m1.12.12.2.2.1.1.1.3.2.cmml" type="integer" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3.2">1</cn><ci id="A1.Ex15.m1.12.12.2.2.1.1.1.3.3.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.3.3">𝛽</ci></apply><apply id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1"><plus id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.1"></plus><apply id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2"><times id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.1"></times><ci id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.2.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.2">𝑟</ci><interval closure="open" id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.2.3.2"><ci id="A1.Ex15.m1.7.7.cmml" xref="A1.Ex15.m1.7.7">𝑥</ci><ci id="A1.Ex15.m1.8.8.cmml" xref="A1.Ex15.m1.8.8">𝑦</ci></interval></apply><apply id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3"><times id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.1.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.1"></times><ci id="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.2.cmml" xref="A1.Ex15.m1.12.12.2.2.1.1.1.1.1.1.3.2">𝑓</ci><ci id="A1.Ex15.m1.9.9.cmml" xref="A1.Ex15.m1.9.9">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex15.m1.12c">\displaystyle=\frac{1}{\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}(%
r(x,y)+f(x))\right)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}(r(x,y)+f(x)%
)\right)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex15.m1.12d">= divide start_ARG 1 end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG ( italic_r ( italic_x , italic_y ) + italic_f ( italic_x ) ) ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG ( italic_r ( italic_x , italic_y ) + italic_f ( italic_x ) ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex16"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{1}{\exp\left(\frac{1}{\beta}f(x)\right)\sum_{y}\pi_{\text{%
ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)}\pi_{\text{ref}}(y|x)\exp%
\left(\frac{1}{\beta}r(x,y)\right)\exp\left(\frac{1}{\beta}f(x)\right)" class="ltx_Math" display="inline" id="A1.Ex16.m1.16"><semantics id="A1.Ex16.m1.16a"><mrow id="A1.Ex16.m1.16.16" xref="A1.Ex16.m1.16.16.cmml"><mi id="A1.Ex16.m1.16.16.5" xref="A1.Ex16.m1.16.16.5.cmml"></mi><mo id="A1.Ex16.m1.16.16.4" xref="A1.Ex16.m1.16.16.4.cmml">=</mo><mrow id="A1.Ex16.m1.16.16.3" xref="A1.Ex16.m1.16.16.3.cmml"><mstyle displaystyle="true" id="A1.Ex16.m1.8.8" xref="A1.Ex16.m1.8.8.cmml"><mfrac id="A1.Ex16.m1.8.8a" xref="A1.Ex16.m1.8.8.cmml"><mn id="A1.Ex16.m1.8.8.10" xref="A1.Ex16.m1.8.8.10.cmml">1</mn><mrow id="A1.Ex16.m1.8.8.8" xref="A1.Ex16.m1.8.8.8.cmml"><mrow id="A1.Ex16.m1.6.6.6.6.1" xref="A1.Ex16.m1.6.6.6.6.2.cmml"><mi id="A1.Ex16.m1.2.2.2.2" xref="A1.Ex16.m1.2.2.2.2.cmml">exp</mi><mo id="A1.Ex16.m1.6.6.6.6.1a" xref="A1.Ex16.m1.6.6.6.6.2.cmml">⁡</mo><mrow id="A1.Ex16.m1.6.6.6.6.1.1" xref="A1.Ex16.m1.6.6.6.6.2.cmml"><mo id="A1.Ex16.m1.6.6.6.6.1.1.2" xref="A1.Ex16.m1.6.6.6.6.2.cmml">(</mo><mrow id="A1.Ex16.m1.6.6.6.6.1.1.1" xref="A1.Ex16.m1.6.6.6.6.1.1.1.cmml"><mfrac id="A1.Ex16.m1.6.6.6.6.1.1.1.2" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2.cmml"><mn id="A1.Ex16.m1.6.6.6.6.1.1.1.2.2" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex16.m1.6.6.6.6.1.1.1.2.3" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex16.m1.6.6.6.6.1.1.1.1" xref="A1.Ex16.m1.6.6.6.6.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex16.m1.6.6.6.6.1.1.1.3" xref="A1.Ex16.m1.6.6.6.6.1.1.1.3.cmml">f</mi><mo id="A1.Ex16.m1.6.6.6.6.1.1.1.1a" xref="A1.Ex16.m1.6.6.6.6.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex16.m1.6.6.6.6.1.1.1.4.2" xref="A1.Ex16.m1.6.6.6.6.1.1.1.cmml"><mo id="A1.Ex16.m1.6.6.6.6.1.1.1.4.2.1" stretchy="false" xref="A1.Ex16.m1.6.6.6.6.1.1.1.cmml">(</mo><mi id="A1.Ex16.m1.1.1.1.1" xref="A1.Ex16.m1.1.1.1.1.cmml">x</mi><mo id="A1.Ex16.m1.6.6.6.6.1.1.1.4.2.2" stretchy="false" xref="A1.Ex16.m1.6.6.6.6.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex16.m1.6.6.6.6.1.1.3" xref="A1.Ex16.m1.6.6.6.6.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex16.m1.8.8.8.9" xref="A1.Ex16.m1.8.8.8.9.cmml">⁢</mo><mrow id="A1.Ex16.m1.8.8.8.8" xref="A1.Ex16.m1.8.8.8.8.cmml"><msub id="A1.Ex16.m1.8.8.8.8.3" xref="A1.Ex16.m1.8.8.8.8.3.cmml"><mo id="A1.Ex16.m1.8.8.8.8.3.2" xref="A1.Ex16.m1.8.8.8.8.3.2.cmml">∑</mo><mi id="A1.Ex16.m1.8.8.8.8.3.3" xref="A1.Ex16.m1.8.8.8.8.3.3.cmml">y</mi></msub><mrow id="A1.Ex16.m1.8.8.8.8.2" xref="A1.Ex16.m1.8.8.8.8.2.cmml"><msub id="A1.Ex16.m1.8.8.8.8.2.4" xref="A1.Ex16.m1.8.8.8.8.2.4.cmml"><mi id="A1.Ex16.m1.8.8.8.8.2.4.2" xref="A1.Ex16.m1.8.8.8.8.2.4.2.cmml">π</mi><mtext id="A1.Ex16.m1.8.8.8.8.2.4.3" xref="A1.Ex16.m1.8.8.8.8.2.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex16.m1.8.8.8.8.2.3" xref="A1.Ex16.m1.8.8.8.8.2.3.cmml">⁢</mo><mrow id="A1.Ex16.m1.7.7.7.7.1.1.1" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.cmml"><mo id="A1.Ex16.m1.7.7.7.7.1.1.1.2" stretchy="false" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.cmml">(</mo><mrow id="A1.Ex16.m1.7.7.7.7.1.1.1.1" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.cmml"><mi id="A1.Ex16.m1.7.7.7.7.1.1.1.1.2" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex16.m1.7.7.7.7.1.1.1.1.1" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex16.m1.7.7.7.7.1.1.1.1.3" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex16.m1.7.7.7.7.1.1.1.3" stretchy="false" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex16.m1.8.8.8.8.2.3a" lspace="0.167em" xref="A1.Ex16.m1.8.8.8.8.2.3.cmml">⁢</mo><mrow id="A1.Ex16.m1.8.8.8.8.2.2.1" xref="A1.Ex16.m1.8.8.8.8.2.2.2.cmml"><mi id="A1.Ex16.m1.5.5.5.5" xref="A1.Ex16.m1.5.5.5.5.cmml">exp</mi><mo id="A1.Ex16.m1.8.8.8.8.2.2.1a" xref="A1.Ex16.m1.8.8.8.8.2.2.2.cmml">⁡</mo><mrow id="A1.Ex16.m1.8.8.8.8.2.2.1.1" xref="A1.Ex16.m1.8.8.8.8.2.2.2.cmml"><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.2" xref="A1.Ex16.m1.8.8.8.8.2.2.2.cmml">(</mo><mrow id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.cmml"><mfrac id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.cmml"><mn id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.2" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.3" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.1" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.3" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.3.cmml">r</mi><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.1a" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.2" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.1.cmml"><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex16.m1.3.3.3.3" xref="A1.Ex16.m1.3.3.3.3.cmml">x</mi><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.2.2" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex16.m1.4.4.4.4" xref="A1.Ex16.m1.4.4.4.4.cmml">y</mi><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex16.m1.8.8.8.8.2.2.1.1.3" xref="A1.Ex16.m1.8.8.8.8.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mfrac></mstyle><mo id="A1.Ex16.m1.16.16.3.4" xref="A1.Ex16.m1.16.16.3.4.cmml">⁢</mo><msub id="A1.Ex16.m1.16.16.3.5" xref="A1.Ex16.m1.16.16.3.5.cmml"><mi id="A1.Ex16.m1.16.16.3.5.2" xref="A1.Ex16.m1.16.16.3.5.2.cmml">π</mi><mtext id="A1.Ex16.m1.16.16.3.5.3" xref="A1.Ex16.m1.16.16.3.5.3a.cmml">ref</mtext></msub><mo id="A1.Ex16.m1.16.16.3.4a" xref="A1.Ex16.m1.16.16.3.4.cmml">⁢</mo><mrow id="A1.Ex16.m1.14.14.1.1.1" xref="A1.Ex16.m1.14.14.1.1.1.1.cmml"><mo id="A1.Ex16.m1.14.14.1.1.1.2" stretchy="false" xref="A1.Ex16.m1.14.14.1.1.1.1.cmml">(</mo><mrow id="A1.Ex16.m1.14.14.1.1.1.1" xref="A1.Ex16.m1.14.14.1.1.1.1.cmml"><mi id="A1.Ex16.m1.14.14.1.1.1.1.2" xref="A1.Ex16.m1.14.14.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex16.m1.14.14.1.1.1.1.1" xref="A1.Ex16.m1.14.14.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex16.m1.14.14.1.1.1.1.3" xref="A1.Ex16.m1.14.14.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex16.m1.14.14.1.1.1.3" stretchy="false" xref="A1.Ex16.m1.14.14.1.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex16.m1.16.16.3.4b" lspace="0.167em" xref="A1.Ex16.m1.16.16.3.4.cmml">⁢</mo><mrow id="A1.Ex16.m1.15.15.2.2.1" xref="A1.Ex16.m1.15.15.2.2.2.cmml"><mi id="A1.Ex16.m1.11.11" xref="A1.Ex16.m1.11.11.cmml">exp</mi><mo id="A1.Ex16.m1.15.15.2.2.1a" xref="A1.Ex16.m1.15.15.2.2.2.cmml">⁡</mo><mrow id="A1.Ex16.m1.15.15.2.2.1.1" xref="A1.Ex16.m1.15.15.2.2.2.cmml"><mo id="A1.Ex16.m1.15.15.2.2.1.1.2" xref="A1.Ex16.m1.15.15.2.2.2.cmml">(</mo><mrow id="A1.Ex16.m1.15.15.2.2.1.1.1" xref="A1.Ex16.m1.15.15.2.2.1.1.1.cmml"><mstyle displaystyle="true" id="A1.Ex16.m1.15.15.2.2.1.1.1.2" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2.cmml"><mfrac id="A1.Ex16.m1.15.15.2.2.1.1.1.2a" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2.cmml"><mn id="A1.Ex16.m1.15.15.2.2.1.1.1.2.2" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex16.m1.15.15.2.2.1.1.1.2.3" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2.3.cmml">β</mi></mfrac></mstyle><mo id="A1.Ex16.m1.15.15.2.2.1.1.1.1" xref="A1.Ex16.m1.15.15.2.2.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex16.m1.15.15.2.2.1.1.1.3" xref="A1.Ex16.m1.15.15.2.2.1.1.1.3.cmml">r</mi><mo id="A1.Ex16.m1.15.15.2.2.1.1.1.1a" xref="A1.Ex16.m1.15.15.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex16.m1.15.15.2.2.1.1.1.4.2" xref="A1.Ex16.m1.15.15.2.2.1.1.1.4.1.cmml"><mo id="A1.Ex16.m1.15.15.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex16.m1.15.15.2.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex16.m1.9.9" xref="A1.Ex16.m1.9.9.cmml">x</mi><mo id="A1.Ex16.m1.15.15.2.2.1.1.1.4.2.2" xref="A1.Ex16.m1.15.15.2.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex16.m1.10.10" xref="A1.Ex16.m1.10.10.cmml">y</mi><mo id="A1.Ex16.m1.15.15.2.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex16.m1.15.15.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex16.m1.15.15.2.2.1.1.3" xref="A1.Ex16.m1.15.15.2.2.2.cmml">)</mo></mrow></mrow><mo id="A1.Ex16.m1.16.16.3.4c" lspace="0.167em" xref="A1.Ex16.m1.16.16.3.4.cmml">⁢</mo><mrow id="A1.Ex16.m1.16.16.3.3.1" xref="A1.Ex16.m1.16.16.3.3.2.cmml"><mi id="A1.Ex16.m1.13.13" xref="A1.Ex16.m1.13.13.cmml">exp</mi><mo id="A1.Ex16.m1.16.16.3.3.1a" xref="A1.Ex16.m1.16.16.3.3.2.cmml">⁡</mo><mrow id="A1.Ex16.m1.16.16.3.3.1.1" xref="A1.Ex16.m1.16.16.3.3.2.cmml"><mo id="A1.Ex16.m1.16.16.3.3.1.1.2" xref="A1.Ex16.m1.16.16.3.3.2.cmml">(</mo><mrow id="A1.Ex16.m1.16.16.3.3.1.1.1" xref="A1.Ex16.m1.16.16.3.3.1.1.1.cmml"><mstyle displaystyle="true" id="A1.Ex16.m1.16.16.3.3.1.1.1.2" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2.cmml"><mfrac id="A1.Ex16.m1.16.16.3.3.1.1.1.2a" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2.cmml"><mn id="A1.Ex16.m1.16.16.3.3.1.1.1.2.2" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex16.m1.16.16.3.3.1.1.1.2.3" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2.3.cmml">β</mi></mfrac></mstyle><mo id="A1.Ex16.m1.16.16.3.3.1.1.1.1" xref="A1.Ex16.m1.16.16.3.3.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex16.m1.16.16.3.3.1.1.1.3" xref="A1.Ex16.m1.16.16.3.3.1.1.1.3.cmml">f</mi><mo id="A1.Ex16.m1.16.16.3.3.1.1.1.1a" xref="A1.Ex16.m1.16.16.3.3.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex16.m1.16.16.3.3.1.1.1.4.2" xref="A1.Ex16.m1.16.16.3.3.1.1.1.cmml"><mo id="A1.Ex16.m1.16.16.3.3.1.1.1.4.2.1" stretchy="false" xref="A1.Ex16.m1.16.16.3.3.1.1.1.cmml">(</mo><mi id="A1.Ex16.m1.12.12" xref="A1.Ex16.m1.12.12.cmml">x</mi><mo id="A1.Ex16.m1.16.16.3.3.1.1.1.4.2.2" stretchy="false" xref="A1.Ex16.m1.16.16.3.3.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex16.m1.16.16.3.3.1.1.3" xref="A1.Ex16.m1.16.16.3.3.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex16.m1.16b"><apply id="A1.Ex16.m1.16.16.cmml" xref="A1.Ex16.m1.16.16"><eq id="A1.Ex16.m1.16.16.4.cmml" xref="A1.Ex16.m1.16.16.4"></eq><csymbol cd="latexml" id="A1.Ex16.m1.16.16.5.cmml" xref="A1.Ex16.m1.16.16.5">absent</csymbol><apply id="A1.Ex16.m1.16.16.3.cmml" xref="A1.Ex16.m1.16.16.3"><times id="A1.Ex16.m1.16.16.3.4.cmml" xref="A1.Ex16.m1.16.16.3.4"></times><apply id="A1.Ex16.m1.8.8.cmml" xref="A1.Ex16.m1.8.8"><divide id="A1.Ex16.m1.8.8.9.cmml" xref="A1.Ex16.m1.8.8"></divide><cn id="A1.Ex16.m1.8.8.10.cmml" type="integer" xref="A1.Ex16.m1.8.8.10">1</cn><apply id="A1.Ex16.m1.8.8.8.cmml" xref="A1.Ex16.m1.8.8.8"><times id="A1.Ex16.m1.8.8.8.9.cmml" xref="A1.Ex16.m1.8.8.8.9"></times><apply id="A1.Ex16.m1.6.6.6.6.2.cmml" xref="A1.Ex16.m1.6.6.6.6.1"><exp id="A1.Ex16.m1.2.2.2.2.cmml" xref="A1.Ex16.m1.2.2.2.2"></exp><apply id="A1.Ex16.m1.6.6.6.6.1.1.1.cmml" xref="A1.Ex16.m1.6.6.6.6.1.1.1"><times id="A1.Ex16.m1.6.6.6.6.1.1.1.1.cmml" xref="A1.Ex16.m1.6.6.6.6.1.1.1.1"></times><apply id="A1.Ex16.m1.6.6.6.6.1.1.1.2.cmml" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2"><divide id="A1.Ex16.m1.6.6.6.6.1.1.1.2.1.cmml" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2"></divide><cn id="A1.Ex16.m1.6.6.6.6.1.1.1.2.2.cmml" type="integer" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2.2">1</cn><ci id="A1.Ex16.m1.6.6.6.6.1.1.1.2.3.cmml" xref="A1.Ex16.m1.6.6.6.6.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex16.m1.6.6.6.6.1.1.1.3.cmml" xref="A1.Ex16.m1.6.6.6.6.1.1.1.3">𝑓</ci><ci id="A1.Ex16.m1.1.1.1.1.cmml" xref="A1.Ex16.m1.1.1.1.1">𝑥</ci></apply></apply><apply id="A1.Ex16.m1.8.8.8.8.cmml" xref="A1.Ex16.m1.8.8.8.8"><apply id="A1.Ex16.m1.8.8.8.8.3.cmml" xref="A1.Ex16.m1.8.8.8.8.3"><csymbol cd="ambiguous" id="A1.Ex16.m1.8.8.8.8.3.1.cmml" xref="A1.Ex16.m1.8.8.8.8.3">subscript</csymbol><sum id="A1.Ex16.m1.8.8.8.8.3.2.cmml" xref="A1.Ex16.m1.8.8.8.8.3.2"></sum><ci id="A1.Ex16.m1.8.8.8.8.3.3.cmml" xref="A1.Ex16.m1.8.8.8.8.3.3">𝑦</ci></apply><apply id="A1.Ex16.m1.8.8.8.8.2.cmml" xref="A1.Ex16.m1.8.8.8.8.2"><times id="A1.Ex16.m1.8.8.8.8.2.3.cmml" xref="A1.Ex16.m1.8.8.8.8.2.3"></times><apply id="A1.Ex16.m1.8.8.8.8.2.4.cmml" xref="A1.Ex16.m1.8.8.8.8.2.4"><csymbol cd="ambiguous" id="A1.Ex16.m1.8.8.8.8.2.4.1.cmml" xref="A1.Ex16.m1.8.8.8.8.2.4">subscript</csymbol><ci id="A1.Ex16.m1.8.8.8.8.2.4.2.cmml" xref="A1.Ex16.m1.8.8.8.8.2.4.2">𝜋</ci><ci id="A1.Ex16.m1.8.8.8.8.2.4.3a.cmml" xref="A1.Ex16.m1.8.8.8.8.2.4.3"><mtext id="A1.Ex16.m1.8.8.8.8.2.4.3.cmml" mathsize="70%" xref="A1.Ex16.m1.8.8.8.8.2.4.3">ref</mtext></ci></apply><apply id="A1.Ex16.m1.7.7.7.7.1.1.1.1.cmml" xref="A1.Ex16.m1.7.7.7.7.1.1.1"><csymbol cd="latexml" id="A1.Ex16.m1.7.7.7.7.1.1.1.1.1.cmml" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex16.m1.7.7.7.7.1.1.1.1.2.cmml" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.2">𝑦</ci><ci id="A1.Ex16.m1.7.7.7.7.1.1.1.1.3.cmml" xref="A1.Ex16.m1.7.7.7.7.1.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex16.m1.8.8.8.8.2.2.2.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1"><exp id="A1.Ex16.m1.5.5.5.5.cmml" xref="A1.Ex16.m1.5.5.5.5"></exp><apply id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1"><times id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.1.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.1"></times><apply id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2"><divide id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.1.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2"></divide><cn id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.2">1</cn><ci id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.3.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.3.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.1.cmml" xref="A1.Ex16.m1.8.8.8.8.2.2.1.1.1.4.2"><ci id="A1.Ex16.m1.3.3.3.3.cmml" xref="A1.Ex16.m1.3.3.3.3">𝑥</ci><ci id="A1.Ex16.m1.4.4.4.4.cmml" xref="A1.Ex16.m1.4.4.4.4">𝑦</ci></interval></apply></apply></apply></apply></apply></apply><apply id="A1.Ex16.m1.16.16.3.5.cmml" xref="A1.Ex16.m1.16.16.3.5"><csymbol cd="ambiguous" id="A1.Ex16.m1.16.16.3.5.1.cmml" xref="A1.Ex16.m1.16.16.3.5">subscript</csymbol><ci id="A1.Ex16.m1.16.16.3.5.2.cmml" xref="A1.Ex16.m1.16.16.3.5.2">𝜋</ci><ci id="A1.Ex16.m1.16.16.3.5.3a.cmml" xref="A1.Ex16.m1.16.16.3.5.3"><mtext id="A1.Ex16.m1.16.16.3.5.3.cmml" mathsize="70%" xref="A1.Ex16.m1.16.16.3.5.3">ref</mtext></ci></apply><apply id="A1.Ex16.m1.14.14.1.1.1.1.cmml" xref="A1.Ex16.m1.14.14.1.1.1"><csymbol cd="latexml" id="A1.Ex16.m1.14.14.1.1.1.1.1.cmml" xref="A1.Ex16.m1.14.14.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex16.m1.14.14.1.1.1.1.2.cmml" xref="A1.Ex16.m1.14.14.1.1.1.1.2">𝑦</ci><ci id="A1.Ex16.m1.14.14.1.1.1.1.3.cmml" xref="A1.Ex16.m1.14.14.1.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex16.m1.15.15.2.2.2.cmml" xref="A1.Ex16.m1.15.15.2.2.1"><exp id="A1.Ex16.m1.11.11.cmml" xref="A1.Ex16.m1.11.11"></exp><apply id="A1.Ex16.m1.15.15.2.2.1.1.1.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1"><times id="A1.Ex16.m1.15.15.2.2.1.1.1.1.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1.1"></times><apply id="A1.Ex16.m1.15.15.2.2.1.1.1.2.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2"><divide id="A1.Ex16.m1.15.15.2.2.1.1.1.2.1.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2"></divide><cn id="A1.Ex16.m1.15.15.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2.2">1</cn><ci id="A1.Ex16.m1.15.15.2.2.1.1.1.2.3.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex16.m1.15.15.2.2.1.1.1.3.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex16.m1.15.15.2.2.1.1.1.4.1.cmml" xref="A1.Ex16.m1.15.15.2.2.1.1.1.4.2"><ci id="A1.Ex16.m1.9.9.cmml" xref="A1.Ex16.m1.9.9">𝑥</ci><ci id="A1.Ex16.m1.10.10.cmml" xref="A1.Ex16.m1.10.10">𝑦</ci></interval></apply></apply><apply id="A1.Ex16.m1.16.16.3.3.2.cmml" xref="A1.Ex16.m1.16.16.3.3.1"><exp id="A1.Ex16.m1.13.13.cmml" xref="A1.Ex16.m1.13.13"></exp><apply id="A1.Ex16.m1.16.16.3.3.1.1.1.cmml" xref="A1.Ex16.m1.16.16.3.3.1.1.1"><times id="A1.Ex16.m1.16.16.3.3.1.1.1.1.cmml" xref="A1.Ex16.m1.16.16.3.3.1.1.1.1"></times><apply id="A1.Ex16.m1.16.16.3.3.1.1.1.2.cmml" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2"><divide id="A1.Ex16.m1.16.16.3.3.1.1.1.2.1.cmml" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2"></divide><cn id="A1.Ex16.m1.16.16.3.3.1.1.1.2.2.cmml" type="integer" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2.2">1</cn><ci id="A1.Ex16.m1.16.16.3.3.1.1.1.2.3.cmml" xref="A1.Ex16.m1.16.16.3.3.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex16.m1.16.16.3.3.1.1.1.3.cmml" xref="A1.Ex16.m1.16.16.3.3.1.1.1.3">𝑓</ci><ci id="A1.Ex16.m1.12.12.cmml" xref="A1.Ex16.m1.12.12">𝑥</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex16.m1.16c">\displaystyle=\frac{1}{\exp\left(\frac{1}{\beta}f(x)\right)\sum_{y}\pi_{\text{%
ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)}\pi_{\text{ref}}(y|x)\exp%
\left(\frac{1}{\beta}r(x,y)\right)\exp\left(\frac{1}{\beta}f(x)\right)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex16.m1.16d">= divide start_ARG 1 end_ARG start_ARG roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_f ( italic_x ) ) ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_f ( italic_x ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex17"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\frac{1}{\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r%
(x,y)\right)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)" class="ltx_Math" display="inline" id="A1.Ex17.m1.10"><semantics id="A1.Ex17.m1.10a"><mrow id="A1.Ex17.m1.10.10" xref="A1.Ex17.m1.10.10.cmml"><mi id="A1.Ex17.m1.10.10.4" xref="A1.Ex17.m1.10.10.4.cmml"></mi><mo id="A1.Ex17.m1.10.10.3" xref="A1.Ex17.m1.10.10.3.cmml">=</mo><mrow id="A1.Ex17.m1.10.10.2" xref="A1.Ex17.m1.10.10.2.cmml"><mstyle displaystyle="true" id="A1.Ex17.m1.5.5" xref="A1.Ex17.m1.5.5.cmml"><mfrac id="A1.Ex17.m1.5.5a" xref="A1.Ex17.m1.5.5.cmml"><mn id="A1.Ex17.m1.5.5.7" xref="A1.Ex17.m1.5.5.7.cmml">1</mn><mrow id="A1.Ex17.m1.5.5.5" xref="A1.Ex17.m1.5.5.5.cmml"><msub id="A1.Ex17.m1.5.5.5.6" xref="A1.Ex17.m1.5.5.5.6.cmml"><mo id="A1.Ex17.m1.5.5.5.6.2" xref="A1.Ex17.m1.5.5.5.6.2.cmml">∑</mo><mi id="A1.Ex17.m1.5.5.5.6.3" xref="A1.Ex17.m1.5.5.5.6.3.cmml">y</mi></msub><mrow id="A1.Ex17.m1.5.5.5.5" xref="A1.Ex17.m1.5.5.5.5.cmml"><msub id="A1.Ex17.m1.5.5.5.5.4" xref="A1.Ex17.m1.5.5.5.5.4.cmml"><mi id="A1.Ex17.m1.5.5.5.5.4.2" xref="A1.Ex17.m1.5.5.5.5.4.2.cmml">π</mi><mtext id="A1.Ex17.m1.5.5.5.5.4.3" xref="A1.Ex17.m1.5.5.5.5.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex17.m1.5.5.5.5.3" xref="A1.Ex17.m1.5.5.5.5.3.cmml">⁢</mo><mrow id="A1.Ex17.m1.4.4.4.4.1.1" xref="A1.Ex17.m1.4.4.4.4.1.1.1.cmml"><mo id="A1.Ex17.m1.4.4.4.4.1.1.2" stretchy="false" xref="A1.Ex17.m1.4.4.4.4.1.1.1.cmml">(</mo><mrow id="A1.Ex17.m1.4.4.4.4.1.1.1" xref="A1.Ex17.m1.4.4.4.4.1.1.1.cmml"><mi id="A1.Ex17.m1.4.4.4.4.1.1.1.2" xref="A1.Ex17.m1.4.4.4.4.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex17.m1.4.4.4.4.1.1.1.1" xref="A1.Ex17.m1.4.4.4.4.1.1.1.1.cmml">|</mo><mi id="A1.Ex17.m1.4.4.4.4.1.1.1.3" xref="A1.Ex17.m1.4.4.4.4.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex17.m1.4.4.4.4.1.1.3" stretchy="false" xref="A1.Ex17.m1.4.4.4.4.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex17.m1.5.5.5.5.3a" lspace="0.167em" xref="A1.Ex17.m1.5.5.5.5.3.cmml">⁢</mo><mrow id="A1.Ex17.m1.5.5.5.5.2.1" xref="A1.Ex17.m1.5.5.5.5.2.2.cmml"><mi id="A1.Ex17.m1.3.3.3.3" xref="A1.Ex17.m1.3.3.3.3.cmml">exp</mi><mo id="A1.Ex17.m1.5.5.5.5.2.1a" xref="A1.Ex17.m1.5.5.5.5.2.2.cmml">⁡</mo><mrow id="A1.Ex17.m1.5.5.5.5.2.1.1" xref="A1.Ex17.m1.5.5.5.5.2.2.cmml"><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.2" xref="A1.Ex17.m1.5.5.5.5.2.2.cmml">(</mo><mrow id="A1.Ex17.m1.5.5.5.5.2.1.1.1" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.cmml"><mfrac id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.cmml"><mn id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.2" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.3" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.1.1" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex17.m1.5.5.5.5.2.1.1.1.3" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.3.cmml">r</mi><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.1.1a" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.2" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.1.cmml"><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex17.m1.1.1.1.1" xref="A1.Ex17.m1.1.1.1.1.cmml">x</mi><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.2.2" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex17.m1.2.2.2.2" xref="A1.Ex17.m1.2.2.2.2.cmml">y</mi><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex17.m1.5.5.5.5.2.1.1.3" xref="A1.Ex17.m1.5.5.5.5.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mfrac></mstyle><mo id="A1.Ex17.m1.10.10.2.3" xref="A1.Ex17.m1.10.10.2.3.cmml">⁢</mo><msub id="A1.Ex17.m1.10.10.2.4" xref="A1.Ex17.m1.10.10.2.4.cmml"><mi id="A1.Ex17.m1.10.10.2.4.2" xref="A1.Ex17.m1.10.10.2.4.2.cmml">π</mi><mtext id="A1.Ex17.m1.10.10.2.4.3" xref="A1.Ex17.m1.10.10.2.4.3a.cmml">ref</mtext></msub><mo id="A1.Ex17.m1.10.10.2.3a" xref="A1.Ex17.m1.10.10.2.3.cmml">⁢</mo><mrow id="A1.Ex17.m1.9.9.1.1.1" xref="A1.Ex17.m1.9.9.1.1.1.1.cmml"><mo id="A1.Ex17.m1.9.9.1.1.1.2" stretchy="false" xref="A1.Ex17.m1.9.9.1.1.1.1.cmml">(</mo><mrow id="A1.Ex17.m1.9.9.1.1.1.1" xref="A1.Ex17.m1.9.9.1.1.1.1.cmml"><mi id="A1.Ex17.m1.9.9.1.1.1.1.2" xref="A1.Ex17.m1.9.9.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex17.m1.9.9.1.1.1.1.1" xref="A1.Ex17.m1.9.9.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex17.m1.9.9.1.1.1.1.3" xref="A1.Ex17.m1.9.9.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex17.m1.9.9.1.1.1.3" stretchy="false" xref="A1.Ex17.m1.9.9.1.1.1.1.cmml">)</mo></mrow><mo id="A1.Ex17.m1.10.10.2.3b" lspace="0.167em" xref="A1.Ex17.m1.10.10.2.3.cmml">⁢</mo><mrow id="A1.Ex17.m1.10.10.2.2.1" xref="A1.Ex17.m1.10.10.2.2.2.cmml"><mi id="A1.Ex17.m1.8.8" xref="A1.Ex17.m1.8.8.cmml">exp</mi><mo id="A1.Ex17.m1.10.10.2.2.1a" xref="A1.Ex17.m1.10.10.2.2.2.cmml">⁡</mo><mrow id="A1.Ex17.m1.10.10.2.2.1.1" xref="A1.Ex17.m1.10.10.2.2.2.cmml"><mo id="A1.Ex17.m1.10.10.2.2.1.1.2" xref="A1.Ex17.m1.10.10.2.2.2.cmml">(</mo><mrow id="A1.Ex17.m1.10.10.2.2.1.1.1" xref="A1.Ex17.m1.10.10.2.2.1.1.1.cmml"><mstyle displaystyle="true" id="A1.Ex17.m1.10.10.2.2.1.1.1.2" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2.cmml"><mfrac id="A1.Ex17.m1.10.10.2.2.1.1.1.2a" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2.cmml"><mn id="A1.Ex17.m1.10.10.2.2.1.1.1.2.2" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex17.m1.10.10.2.2.1.1.1.2.3" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2.3.cmml">β</mi></mfrac></mstyle><mo id="A1.Ex17.m1.10.10.2.2.1.1.1.1" xref="A1.Ex17.m1.10.10.2.2.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex17.m1.10.10.2.2.1.1.1.3" xref="A1.Ex17.m1.10.10.2.2.1.1.1.3.cmml">r</mi><mo id="A1.Ex17.m1.10.10.2.2.1.1.1.1a" xref="A1.Ex17.m1.10.10.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex17.m1.10.10.2.2.1.1.1.4.2" xref="A1.Ex17.m1.10.10.2.2.1.1.1.4.1.cmml"><mo id="A1.Ex17.m1.10.10.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.Ex17.m1.10.10.2.2.1.1.1.4.1.cmml">(</mo><mi id="A1.Ex17.m1.6.6" xref="A1.Ex17.m1.6.6.cmml">x</mi><mo id="A1.Ex17.m1.10.10.2.2.1.1.1.4.2.2" xref="A1.Ex17.m1.10.10.2.2.1.1.1.4.1.cmml">,</mo><mi id="A1.Ex17.m1.7.7" xref="A1.Ex17.m1.7.7.cmml">y</mi><mo id="A1.Ex17.m1.10.10.2.2.1.1.1.4.2.3" stretchy="false" xref="A1.Ex17.m1.10.10.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex17.m1.10.10.2.2.1.1.3" xref="A1.Ex17.m1.10.10.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex17.m1.10b"><apply id="A1.Ex17.m1.10.10.cmml" xref="A1.Ex17.m1.10.10"><eq id="A1.Ex17.m1.10.10.3.cmml" xref="A1.Ex17.m1.10.10.3"></eq><csymbol cd="latexml" id="A1.Ex17.m1.10.10.4.cmml" xref="A1.Ex17.m1.10.10.4">absent</csymbol><apply id="A1.Ex17.m1.10.10.2.cmml" xref="A1.Ex17.m1.10.10.2"><times id="A1.Ex17.m1.10.10.2.3.cmml" xref="A1.Ex17.m1.10.10.2.3"></times><apply id="A1.Ex17.m1.5.5.cmml" xref="A1.Ex17.m1.5.5"><divide id="A1.Ex17.m1.5.5.6.cmml" xref="A1.Ex17.m1.5.5"></divide><cn id="A1.Ex17.m1.5.5.7.cmml" type="integer" xref="A1.Ex17.m1.5.5.7">1</cn><apply id="A1.Ex17.m1.5.5.5.cmml" xref="A1.Ex17.m1.5.5.5"><apply id="A1.Ex17.m1.5.5.5.6.cmml" xref="A1.Ex17.m1.5.5.5.6"><csymbol cd="ambiguous" id="A1.Ex17.m1.5.5.5.6.1.cmml" xref="A1.Ex17.m1.5.5.5.6">subscript</csymbol><sum id="A1.Ex17.m1.5.5.5.6.2.cmml" xref="A1.Ex17.m1.5.5.5.6.2"></sum><ci id="A1.Ex17.m1.5.5.5.6.3.cmml" xref="A1.Ex17.m1.5.5.5.6.3">𝑦</ci></apply><apply id="A1.Ex17.m1.5.5.5.5.cmml" xref="A1.Ex17.m1.5.5.5.5"><times id="A1.Ex17.m1.5.5.5.5.3.cmml" xref="A1.Ex17.m1.5.5.5.5.3"></times><apply id="A1.Ex17.m1.5.5.5.5.4.cmml" xref="A1.Ex17.m1.5.5.5.5.4"><csymbol cd="ambiguous" id="A1.Ex17.m1.5.5.5.5.4.1.cmml" xref="A1.Ex17.m1.5.5.5.5.4">subscript</csymbol><ci id="A1.Ex17.m1.5.5.5.5.4.2.cmml" xref="A1.Ex17.m1.5.5.5.5.4.2">𝜋</ci><ci id="A1.Ex17.m1.5.5.5.5.4.3a.cmml" xref="A1.Ex17.m1.5.5.5.5.4.3"><mtext id="A1.Ex17.m1.5.5.5.5.4.3.cmml" mathsize="70%" xref="A1.Ex17.m1.5.5.5.5.4.3">ref</mtext></ci></apply><apply id="A1.Ex17.m1.4.4.4.4.1.1.1.cmml" xref="A1.Ex17.m1.4.4.4.4.1.1"><csymbol cd="latexml" id="A1.Ex17.m1.4.4.4.4.1.1.1.1.cmml" xref="A1.Ex17.m1.4.4.4.4.1.1.1.1">conditional</csymbol><ci id="A1.Ex17.m1.4.4.4.4.1.1.1.2.cmml" xref="A1.Ex17.m1.4.4.4.4.1.1.1.2">𝑦</ci><ci id="A1.Ex17.m1.4.4.4.4.1.1.1.3.cmml" xref="A1.Ex17.m1.4.4.4.4.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex17.m1.5.5.5.5.2.2.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1"><exp id="A1.Ex17.m1.3.3.3.3.cmml" xref="A1.Ex17.m1.3.3.3.3"></exp><apply id="A1.Ex17.m1.5.5.5.5.2.1.1.1.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1"><times id="A1.Ex17.m1.5.5.5.5.2.1.1.1.1.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.1"></times><apply id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2"><divide id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.1.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2"></divide><cn id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.2">1</cn><ci id="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.3.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex17.m1.5.5.5.5.2.1.1.1.3.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.1.cmml" xref="A1.Ex17.m1.5.5.5.5.2.1.1.1.4.2"><ci id="A1.Ex17.m1.1.1.1.1.cmml" xref="A1.Ex17.m1.1.1.1.1">𝑥</ci><ci id="A1.Ex17.m1.2.2.2.2.cmml" xref="A1.Ex17.m1.2.2.2.2">𝑦</ci></interval></apply></apply></apply></apply></apply><apply id="A1.Ex17.m1.10.10.2.4.cmml" xref="A1.Ex17.m1.10.10.2.4"><csymbol cd="ambiguous" id="A1.Ex17.m1.10.10.2.4.1.cmml" xref="A1.Ex17.m1.10.10.2.4">subscript</csymbol><ci id="A1.Ex17.m1.10.10.2.4.2.cmml" xref="A1.Ex17.m1.10.10.2.4.2">𝜋</ci><ci id="A1.Ex17.m1.10.10.2.4.3a.cmml" xref="A1.Ex17.m1.10.10.2.4.3"><mtext id="A1.Ex17.m1.10.10.2.4.3.cmml" mathsize="70%" xref="A1.Ex17.m1.10.10.2.4.3">ref</mtext></ci></apply><apply id="A1.Ex17.m1.9.9.1.1.1.1.cmml" xref="A1.Ex17.m1.9.9.1.1.1"><csymbol cd="latexml" id="A1.Ex17.m1.9.9.1.1.1.1.1.cmml" xref="A1.Ex17.m1.9.9.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex17.m1.9.9.1.1.1.1.2.cmml" xref="A1.Ex17.m1.9.9.1.1.1.1.2">𝑦</ci><ci id="A1.Ex17.m1.9.9.1.1.1.1.3.cmml" xref="A1.Ex17.m1.9.9.1.1.1.1.3">𝑥</ci></apply><apply id="A1.Ex17.m1.10.10.2.2.2.cmml" xref="A1.Ex17.m1.10.10.2.2.1"><exp id="A1.Ex17.m1.8.8.cmml" xref="A1.Ex17.m1.8.8"></exp><apply id="A1.Ex17.m1.10.10.2.2.1.1.1.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1"><times id="A1.Ex17.m1.10.10.2.2.1.1.1.1.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1.1"></times><apply id="A1.Ex17.m1.10.10.2.2.1.1.1.2.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2"><divide id="A1.Ex17.m1.10.10.2.2.1.1.1.2.1.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2"></divide><cn id="A1.Ex17.m1.10.10.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2.2">1</cn><ci id="A1.Ex17.m1.10.10.2.2.1.1.1.2.3.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex17.m1.10.10.2.2.1.1.1.3.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.Ex17.m1.10.10.2.2.1.1.1.4.1.cmml" xref="A1.Ex17.m1.10.10.2.2.1.1.1.4.2"><ci id="A1.Ex17.m1.6.6.cmml" xref="A1.Ex17.m1.6.6">𝑥</ci><ci id="A1.Ex17.m1.7.7.cmml" xref="A1.Ex17.m1.7.7">𝑦</ci></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex17.m1.10c">\displaystyle=\frac{1}{\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r%
(x,y)\right)}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex17.m1.10d">= divide start_ARG 1 end_ARG start_ARG ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) ) end_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
<tbody id="A1.Ex18"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_eqn_cell"></td>
<td class="ltx_td ltx_align_left ltx_eqn_cell"><math alttext="\displaystyle=\pi_{r}(y|x)," class="ltx_Math" display="inline" id="A1.Ex18.m1.1"><semantics id="A1.Ex18.m1.1a"><mrow id="A1.Ex18.m1.1.1.1" xref="A1.Ex18.m1.1.1.1.1.cmml"><mrow id="A1.Ex18.m1.1.1.1.1" xref="A1.Ex18.m1.1.1.1.1.cmml"><mi id="A1.Ex18.m1.1.1.1.1.3" xref="A1.Ex18.m1.1.1.1.1.3.cmml"></mi><mo id="A1.Ex18.m1.1.1.1.1.2" xref="A1.Ex18.m1.1.1.1.1.2.cmml">=</mo><mrow id="A1.Ex18.m1.1.1.1.1.1" xref="A1.Ex18.m1.1.1.1.1.1.cmml"><msub id="A1.Ex18.m1.1.1.1.1.1.3" xref="A1.Ex18.m1.1.1.1.1.1.3.cmml"><mi id="A1.Ex18.m1.1.1.1.1.1.3.2" xref="A1.Ex18.m1.1.1.1.1.1.3.2.cmml">π</mi><mi id="A1.Ex18.m1.1.1.1.1.1.3.3" xref="A1.Ex18.m1.1.1.1.1.1.3.3.cmml">r</mi></msub><mo id="A1.Ex18.m1.1.1.1.1.1.2" xref="A1.Ex18.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex18.m1.1.1.1.1.1.1.1" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.cmml"><mo id="A1.Ex18.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex18.m1.1.1.1.1.1.1.1.1" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.cmml"><mi id="A1.Ex18.m1.1.1.1.1.1.1.1.1.2" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex18.m1.1.1.1.1.1.1.1.1.1" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex18.m1.1.1.1.1.1.1.1.1.3" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex18.m1.1.1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex18.m1.1.1.1.2" xref="A1.Ex18.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex18.m1.1b"><apply id="A1.Ex18.m1.1.1.1.1.cmml" xref="A1.Ex18.m1.1.1.1"><eq id="A1.Ex18.m1.1.1.1.1.2.cmml" xref="A1.Ex18.m1.1.1.1.1.2"></eq><csymbol cd="latexml" id="A1.Ex18.m1.1.1.1.1.3.cmml" xref="A1.Ex18.m1.1.1.1.1.3">absent</csymbol><apply id="A1.Ex18.m1.1.1.1.1.1.cmml" xref="A1.Ex18.m1.1.1.1.1.1"><times id="A1.Ex18.m1.1.1.1.1.1.2.cmml" xref="A1.Ex18.m1.1.1.1.1.1.2"></times><apply id="A1.Ex18.m1.1.1.1.1.1.3.cmml" xref="A1.Ex18.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex18.m1.1.1.1.1.1.3.1.cmml" xref="A1.Ex18.m1.1.1.1.1.1.3">subscript</csymbol><ci id="A1.Ex18.m1.1.1.1.1.1.3.2.cmml" xref="A1.Ex18.m1.1.1.1.1.1.3.2">𝜋</ci><ci id="A1.Ex18.m1.1.1.1.1.1.3.3.cmml" xref="A1.Ex18.m1.1.1.1.1.1.3.3">𝑟</ci></apply><apply id="A1.Ex18.m1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex18.m1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex18.m1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex18.m1.1.1.1.1.1.1.1.1.2.cmml" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex18.m1.1.1.1.1.1.1.1.1.3.cmml" xref="A1.Ex18.m1.1.1.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex18.m1.1c">\displaystyle=\pi_{r}(y|x),</annotation><annotation encoding="application/x-llamapun" id="A1.Ex18.m1.1d">= italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y | italic_x ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS5.2.p1.5">which completes the proof.
∎</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
</section>
<section class="ltx_subsection" id="A1.SS6">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.6 </span>Proof of Theorem 1</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS6.p1">
<p class="ltx_p" id="A1.SS6.p1.1">In this section, we will expand on the results of Theorem&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmtheorem1" title="Theorem 1. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_para" id="A1.SS6.p2">
<p class="ltx_p" id="A1.SS6.p2.6"><span class="ltx_text ltx_font_bold" id="A1.SS6.p2.6.7">Theorem 1 Restated.</span><span class="ltx_text ltx_font_italic" id="A1.SS6.p2.6.6">
Assume, we have a reference model, such that <math alttext="\pi_{\text{ref}}(y|x)>0" class="ltx_Math" display="inline" id="A1.SS6.p2.1.1.m1.1"><semantics id="A1.SS6.p2.1.1.m1.1a"><mrow id="A1.SS6.p2.1.1.m1.1.1" xref="A1.SS6.p2.1.1.m1.1.1.cmml"><mrow id="A1.SS6.p2.1.1.m1.1.1.1" xref="A1.SS6.p2.1.1.m1.1.1.1.cmml"><msub id="A1.SS6.p2.1.1.m1.1.1.1.3" xref="A1.SS6.p2.1.1.m1.1.1.1.3.cmml"><mi id="A1.SS6.p2.1.1.m1.1.1.1.3.2" xref="A1.SS6.p2.1.1.m1.1.1.1.3.2.cmml">π</mi><mtext id="A1.SS6.p2.1.1.m1.1.1.1.3.3" xref="A1.SS6.p2.1.1.m1.1.1.1.3.3a.cmml">𝑟𝑒𝑓</mtext></msub><mo id="A1.SS6.p2.1.1.m1.1.1.1.2" mathvariant="italic" xref="A1.SS6.p2.1.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.p2.1.1.m1.1.1.1.1.1" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.cmml"><mo id="A1.SS6.p2.1.1.m1.1.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.cmml"><mi id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.2" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.1" mathvariant="normal" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.3" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.p2.1.1.m1.1.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.p2.1.1.m1.1.1.2" mathvariant="normal" xref="A1.SS6.p2.1.1.m1.1.1.2.cmml">&gt;</mo><mn id="A1.SS6.p2.1.1.m1.1.1.3" mathvariant="normal" xref="A1.SS6.p2.1.1.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.p2.1.1.m1.1b"><apply id="A1.SS6.p2.1.1.m1.1.1.cmml" xref="A1.SS6.p2.1.1.m1.1.1"><gt id="A1.SS6.p2.1.1.m1.1.1.2.cmml" xref="A1.SS6.p2.1.1.m1.1.1.2"></gt><apply id="A1.SS6.p2.1.1.m1.1.1.1.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1"><times id="A1.SS6.p2.1.1.m1.1.1.1.2.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.2"></times><apply id="A1.SS6.p2.1.1.m1.1.1.1.3.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.SS6.p2.1.1.m1.1.1.1.3.1.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.3">subscript</csymbol><ci id="A1.SS6.p2.1.1.m1.1.1.1.3.2.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.3.2">𝜋</ci><ci id="A1.SS6.p2.1.1.m1.1.1.1.3.3a.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.3.3"><mtext id="A1.SS6.p2.1.1.m1.1.1.1.3.3.cmml" mathsize="70%" xref="A1.SS6.p2.1.1.m1.1.1.1.3.3">𝑟𝑒𝑓</mtext></ci></apply><apply id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.1.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.2.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.3.cmml" xref="A1.SS6.p2.1.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><cn id="A1.SS6.p2.1.1.m1.1.1.3.cmml" type="integer" xref="A1.SS6.p2.1.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p2.1.1.m1.1c">\pi_{\text{ref}}(y|x)&gt;0</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p2.1.1.m1.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) &gt; 0</annotation></semantics></math> for all pairs of prompts <math alttext="x" class="ltx_Math" display="inline" id="A1.SS6.p2.2.2.m2.1"><semantics id="A1.SS6.p2.2.2.m2.1a"><mi id="A1.SS6.p2.2.2.m2.1.1" xref="A1.SS6.p2.2.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.p2.2.2.m2.1b"><ci id="A1.SS6.p2.2.2.m2.1.1.cmml" xref="A1.SS6.p2.2.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p2.2.2.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p2.2.2.m2.1d">italic_x</annotation></semantics></math> and answers <math alttext="y" class="ltx_Math" display="inline" id="A1.SS6.p2.3.3.m3.1"><semantics id="A1.SS6.p2.3.3.m3.1a"><mi id="A1.SS6.p2.3.3.m3.1.1" xref="A1.SS6.p2.3.3.m3.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.p2.3.3.m3.1b"><ci id="A1.SS6.p2.3.3.m3.1.1.cmml" xref="A1.SS6.p2.3.3.m3.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p2.3.3.m3.1c">y</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p2.3.3.m3.1d">italic_y</annotation></semantics></math> and a parameter <math alttext="\beta>0" class="ltx_Math" display="inline" id="A1.SS6.p2.4.4.m4.1"><semantics id="A1.SS6.p2.4.4.m4.1a"><mrow id="A1.SS6.p2.4.4.m4.1.1" xref="A1.SS6.p2.4.4.m4.1.1.cmml"><mi id="A1.SS6.p2.4.4.m4.1.1.2" xref="A1.SS6.p2.4.4.m4.1.1.2.cmml">β</mi><mo id="A1.SS6.p2.4.4.m4.1.1.1" mathvariant="normal" xref="A1.SS6.p2.4.4.m4.1.1.1.cmml">&gt;</mo><mn id="A1.SS6.p2.4.4.m4.1.1.3" mathvariant="normal" xref="A1.SS6.p2.4.4.m4.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.p2.4.4.m4.1b"><apply id="A1.SS6.p2.4.4.m4.1.1.cmml" xref="A1.SS6.p2.4.4.m4.1.1"><gt id="A1.SS6.p2.4.4.m4.1.1.1.cmml" xref="A1.SS6.p2.4.4.m4.1.1.1"></gt><ci id="A1.SS6.p2.4.4.m4.1.1.2.cmml" xref="A1.SS6.p2.4.4.m4.1.1.2">𝛽</ci><cn id="A1.SS6.p2.4.4.m4.1.1.3.cmml" type="integer" xref="A1.SS6.p2.4.4.m4.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p2.4.4.m4.1c">\beta&gt;0</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p2.4.4.m4.1d">italic_β &gt; 0</annotation></semantics></math>. All reward equivalence classes, as defined in Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5" title="5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a> can be represented with the reparameterization <math alttext="r(x,y)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}" class="ltx_Math" display="inline" id="A1.SS6.p2.5.5.m5.4"><semantics id="A1.SS6.p2.5.5.m5.4a"><mrow id="A1.SS6.p2.5.5.m5.4.5" xref="A1.SS6.p2.5.5.m5.4.5.cmml"><mrow id="A1.SS6.p2.5.5.m5.4.5.2" xref="A1.SS6.p2.5.5.m5.4.5.2.cmml"><mi id="A1.SS6.p2.5.5.m5.4.5.2.2" xref="A1.SS6.p2.5.5.m5.4.5.2.2.cmml">r</mi><mo id="A1.SS6.p2.5.5.m5.4.5.2.1" mathvariant="italic" xref="A1.SS6.p2.5.5.m5.4.5.2.1.cmml">⁢</mo><mrow id="A1.SS6.p2.5.5.m5.4.5.2.3.2" xref="A1.SS6.p2.5.5.m5.4.5.2.3.1.cmml"><mo id="A1.SS6.p2.5.5.m5.4.5.2.3.2.1" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.5.5.m5.4.5.2.3.1.cmml">(</mo><mi id="A1.SS6.p2.5.5.m5.3.3" xref="A1.SS6.p2.5.5.m5.3.3.cmml">x</mi><mo id="A1.SS6.p2.5.5.m5.4.5.2.3.2.2" mathvariant="normal" xref="A1.SS6.p2.5.5.m5.4.5.2.3.1.cmml">,</mo><mi id="A1.SS6.p2.5.5.m5.4.4" xref="A1.SS6.p2.5.5.m5.4.4.cmml">y</mi><mo id="A1.SS6.p2.5.5.m5.4.5.2.3.2.3" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.5.5.m5.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.p2.5.5.m5.4.5.1" mathvariant="normal" xref="A1.SS6.p2.5.5.m5.4.5.1.cmml">=</mo><mrow id="A1.SS6.p2.5.5.m5.4.5.3" xref="A1.SS6.p2.5.5.m5.4.5.3.cmml"><mi id="A1.SS6.p2.5.5.m5.4.5.3.2" xref="A1.SS6.p2.5.5.m5.4.5.3.2.cmml">β</mi><mo id="A1.SS6.p2.5.5.m5.4.5.3.1" lspace="0.167em" mathvariant="italic" xref="A1.SS6.p2.5.5.m5.4.5.3.1.cmml">⁢</mo><mrow id="A1.SS6.p2.5.5.m5.4.5.3.3" xref="A1.SS6.p2.5.5.m5.4.5.3.3.cmml"><mi id="A1.SS6.p2.5.5.m5.4.5.3.3.1" mathvariant="normal" xref="A1.SS6.p2.5.5.m5.4.5.3.3.1.cmml">log</mi><mo id="A1.SS6.p2.5.5.m5.4.5.3.3a" lspace="0.167em" mathvariant="italic" xref="A1.SS6.p2.5.5.m5.4.5.3.3.cmml">⁡</mo><mfrac id="A1.SS6.p2.5.5.m5.2.2" xref="A1.SS6.p2.5.5.m5.2.2.cmml"><mrow id="A1.SS6.p2.5.5.m5.1.1.1" xref="A1.SS6.p2.5.5.m5.1.1.1.cmml"><mi id="A1.SS6.p2.5.5.m5.1.1.1.3" xref="A1.SS6.p2.5.5.m5.1.1.1.3.cmml">π</mi><mo id="A1.SS6.p2.5.5.m5.1.1.1.2" mathvariant="italic" xref="A1.SS6.p2.5.5.m5.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.p2.5.5.m5.1.1.1.1.1" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.cmml"><mo id="A1.SS6.p2.5.5.m5.1.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.cmml"><mi id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.2" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.1" mathvariant="normal" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.3" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.p2.5.5.m5.1.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS6.p2.5.5.m5.2.2.2" xref="A1.SS6.p2.5.5.m5.2.2.2.cmml"><msub id="A1.SS6.p2.5.5.m5.2.2.2.3" xref="A1.SS6.p2.5.5.m5.2.2.2.3.cmml"><mi id="A1.SS6.p2.5.5.m5.2.2.2.3.2" xref="A1.SS6.p2.5.5.m5.2.2.2.3.2.cmml">π</mi><mtext id="A1.SS6.p2.5.5.m5.2.2.2.3.3" xref="A1.SS6.p2.5.5.m5.2.2.2.3.3a.cmml">𝑟𝑒𝑓</mtext></msub><mo id="A1.SS6.p2.5.5.m5.2.2.2.2" mathvariant="italic" xref="A1.SS6.p2.5.5.m5.2.2.2.2.cmml">⁢</mo><mrow id="A1.SS6.p2.5.5.m5.2.2.2.1.1" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.cmml"><mo id="A1.SS6.p2.5.5.m5.2.2.2.1.1.2" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.cmml"><mi id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.2" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.1" mathvariant="normal" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.3" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.p2.5.5.m5.2.2.2.1.1.3" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.p2.5.5.m5.4b"><apply id="A1.SS6.p2.5.5.m5.4.5.cmml" xref="A1.SS6.p2.5.5.m5.4.5"><eq id="A1.SS6.p2.5.5.m5.4.5.1.cmml" xref="A1.SS6.p2.5.5.m5.4.5.1"></eq><apply id="A1.SS6.p2.5.5.m5.4.5.2.cmml" xref="A1.SS6.p2.5.5.m5.4.5.2"><times id="A1.SS6.p2.5.5.m5.4.5.2.1.cmml" xref="A1.SS6.p2.5.5.m5.4.5.2.1"></times><ci id="A1.SS6.p2.5.5.m5.4.5.2.2.cmml" xref="A1.SS6.p2.5.5.m5.4.5.2.2">𝑟</ci><interval closure="open" id="A1.SS6.p2.5.5.m5.4.5.2.3.1.cmml" xref="A1.SS6.p2.5.5.m5.4.5.2.3.2"><ci id="A1.SS6.p2.5.5.m5.3.3.cmml" xref="A1.SS6.p2.5.5.m5.3.3">𝑥</ci><ci id="A1.SS6.p2.5.5.m5.4.4.cmml" xref="A1.SS6.p2.5.5.m5.4.4">𝑦</ci></interval></apply><apply id="A1.SS6.p2.5.5.m5.4.5.3.cmml" xref="A1.SS6.p2.5.5.m5.4.5.3"><times id="A1.SS6.p2.5.5.m5.4.5.3.1.cmml" xref="A1.SS6.p2.5.5.m5.4.5.3.1"></times><ci id="A1.SS6.p2.5.5.m5.4.5.3.2.cmml" xref="A1.SS6.p2.5.5.m5.4.5.3.2">𝛽</ci><apply id="A1.SS6.p2.5.5.m5.4.5.3.3.cmml" xref="A1.SS6.p2.5.5.m5.4.5.3.3"><log id="A1.SS6.p2.5.5.m5.4.5.3.3.1.cmml" xref="A1.SS6.p2.5.5.m5.4.5.3.3.1"></log><apply id="A1.SS6.p2.5.5.m5.2.2.cmml" xref="A1.SS6.p2.5.5.m5.2.2"><divide id="A1.SS6.p2.5.5.m5.2.2.3.cmml" xref="A1.SS6.p2.5.5.m5.2.2"></divide><apply id="A1.SS6.p2.5.5.m5.1.1.1.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1"><times id="A1.SS6.p2.5.5.m5.1.1.1.2.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1.2"></times><ci id="A1.SS6.p2.5.5.m5.1.1.1.3.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1.3">𝜋</ci><apply id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.1.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.2.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.3.cmml" xref="A1.SS6.p2.5.5.m5.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS6.p2.5.5.m5.2.2.2.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2"><times id="A1.SS6.p2.5.5.m5.2.2.2.2.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.2"></times><apply id="A1.SS6.p2.5.5.m5.2.2.2.3.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.3"><csymbol cd="ambiguous" id="A1.SS6.p2.5.5.m5.2.2.2.3.1.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.3">subscript</csymbol><ci id="A1.SS6.p2.5.5.m5.2.2.2.3.2.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.3.2">𝜋</ci><ci id="A1.SS6.p2.5.5.m5.2.2.2.3.3a.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.3.3"><mtext id="A1.SS6.p2.5.5.m5.2.2.2.3.3.cmml" mathsize="50%" xref="A1.SS6.p2.5.5.m5.2.2.2.3.3">𝑟𝑒𝑓</mtext></ci></apply><apply id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1"><csymbol cd="latexml" id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.1.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.2.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.3.cmml" xref="A1.SS6.p2.5.5.m5.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p2.5.5.m5.4c">r(x,y)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p2.5.5.m5.4d">italic_r ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG</annotation></semantics></math> for some model <math alttext="\pi(y|x)" class="ltx_Math" display="inline" id="A1.SS6.p2.6.6.m6.1"><semantics id="A1.SS6.p2.6.6.m6.1a"><mrow id="A1.SS6.p2.6.6.m6.1.1" xref="A1.SS6.p2.6.6.m6.1.1.cmml"><mi id="A1.SS6.p2.6.6.m6.1.1.3" xref="A1.SS6.p2.6.6.m6.1.1.3.cmml">π</mi><mo id="A1.SS6.p2.6.6.m6.1.1.2" mathvariant="italic" xref="A1.SS6.p2.6.6.m6.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.p2.6.6.m6.1.1.1.1" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.cmml"><mo id="A1.SS6.p2.6.6.m6.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.p2.6.6.m6.1.1.1.1.1" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.cmml"><mi id="A1.SS6.p2.6.6.m6.1.1.1.1.1.2" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.p2.6.6.m6.1.1.1.1.1.1" mathvariant="normal" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.p2.6.6.m6.1.1.1.1.1.3" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.p2.6.6.m6.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.p2.6.6.m6.1b"><apply id="A1.SS6.p2.6.6.m6.1.1.cmml" xref="A1.SS6.p2.6.6.m6.1.1"><times id="A1.SS6.p2.6.6.m6.1.1.2.cmml" xref="A1.SS6.p2.6.6.m6.1.1.2"></times><ci id="A1.SS6.p2.6.6.m6.1.1.3.cmml" xref="A1.SS6.p2.6.6.m6.1.1.3">𝜋</ci><apply id="A1.SS6.p2.6.6.m6.1.1.1.1.1.cmml" xref="A1.SS6.p2.6.6.m6.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.p2.6.6.m6.1.1.1.1.1.1.cmml" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.p2.6.6.m6.1.1.1.1.1.2.cmml" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.p2.6.6.m6.1.1.1.1.1.3.cmml" xref="A1.SS6.p2.6.6.m6.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p2.6.6.m6.1c">\pi(y|x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p2.6.6.m6.1d">italic_π ( italic_y | italic_x )</annotation></semantics></math>.
</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_proof" id="A1.SS6.2">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS6.1.p1">
<p class="ltx_p" id="A1.SS6.1.p1.2">Consider any reward function <math alttext="r(x,y)" class="ltx_Math" display="inline" id="A1.SS6.1.p1.1.m1.2"><semantics id="A1.SS6.1.p1.1.m1.2a"><mrow id="A1.SS6.1.p1.1.m1.2.3" xref="A1.SS6.1.p1.1.m1.2.3.cmml"><mi id="A1.SS6.1.p1.1.m1.2.3.2" xref="A1.SS6.1.p1.1.m1.2.3.2.cmml">r</mi><mo id="A1.SS6.1.p1.1.m1.2.3.1" xref="A1.SS6.1.p1.1.m1.2.3.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.1.m1.2.3.3.2" xref="A1.SS6.1.p1.1.m1.2.3.3.1.cmml"><mo id="A1.SS6.1.p1.1.m1.2.3.3.2.1" stretchy="false" xref="A1.SS6.1.p1.1.m1.2.3.3.1.cmml">(</mo><mi id="A1.SS6.1.p1.1.m1.1.1" xref="A1.SS6.1.p1.1.m1.1.1.cmml">x</mi><mo id="A1.SS6.1.p1.1.m1.2.3.3.2.2" xref="A1.SS6.1.p1.1.m1.2.3.3.1.cmml">,</mo><mi id="A1.SS6.1.p1.1.m1.2.2" xref="A1.SS6.1.p1.1.m1.2.2.cmml">y</mi><mo id="A1.SS6.1.p1.1.m1.2.3.3.2.3" stretchy="false" xref="A1.SS6.1.p1.1.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.1.m1.2b"><apply id="A1.SS6.1.p1.1.m1.2.3.cmml" xref="A1.SS6.1.p1.1.m1.2.3"><times id="A1.SS6.1.p1.1.m1.2.3.1.cmml" xref="A1.SS6.1.p1.1.m1.2.3.1"></times><ci id="A1.SS6.1.p1.1.m1.2.3.2.cmml" xref="A1.SS6.1.p1.1.m1.2.3.2">𝑟</ci><interval closure="open" id="A1.SS6.1.p1.1.m1.2.3.3.1.cmml" xref="A1.SS6.1.p1.1.m1.2.3.3.2"><ci id="A1.SS6.1.p1.1.m1.1.1.cmml" xref="A1.SS6.1.p1.1.m1.1.1">𝑥</ci><ci id="A1.SS6.1.p1.1.m1.2.2.cmml" xref="A1.SS6.1.p1.1.m1.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.1.m1.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.1.m1.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math>, which induces an optimal model <math alttext="\pi_{r}(y|x)" class="ltx_Math" display="inline" id="A1.SS6.1.p1.2.m2.1"><semantics id="A1.SS6.1.p1.2.m2.1a"><mrow id="A1.SS6.1.p1.2.m2.1.1" xref="A1.SS6.1.p1.2.m2.1.1.cmml"><msub id="A1.SS6.1.p1.2.m2.1.1.3" xref="A1.SS6.1.p1.2.m2.1.1.3.cmml"><mi id="A1.SS6.1.p1.2.m2.1.1.3.2" xref="A1.SS6.1.p1.2.m2.1.1.3.2.cmml">π</mi><mi id="A1.SS6.1.p1.2.m2.1.1.3.3" xref="A1.SS6.1.p1.2.m2.1.1.3.3.cmml">r</mi></msub><mo id="A1.SS6.1.p1.2.m2.1.1.2" xref="A1.SS6.1.p1.2.m2.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.1.p1.2.m2.1.1.1.1" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.cmml"><mo id="A1.SS6.1.p1.2.m2.1.1.1.1.2" stretchy="false" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.1.p1.2.m2.1.1.1.1.1" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.cmml"><mi id="A1.SS6.1.p1.2.m2.1.1.1.1.1.2" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.1.p1.2.m2.1.1.1.1.1.1" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.1.p1.2.m2.1.1.1.1.1.3" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.1.p1.2.m2.1.1.1.1.3" stretchy="false" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.2.m2.1b"><apply id="A1.SS6.1.p1.2.m2.1.1.cmml" xref="A1.SS6.1.p1.2.m2.1.1"><times id="A1.SS6.1.p1.2.m2.1.1.2.cmml" xref="A1.SS6.1.p1.2.m2.1.1.2"></times><apply id="A1.SS6.1.p1.2.m2.1.1.3.cmml" xref="A1.SS6.1.p1.2.m2.1.1.3"><csymbol cd="ambiguous" id="A1.SS6.1.p1.2.m2.1.1.3.1.cmml" xref="A1.SS6.1.p1.2.m2.1.1.3">subscript</csymbol><ci id="A1.SS6.1.p1.2.m2.1.1.3.2.cmml" xref="A1.SS6.1.p1.2.m2.1.1.3.2">𝜋</ci><ci id="A1.SS6.1.p1.2.m2.1.1.3.3.cmml" xref="A1.SS6.1.p1.2.m2.1.1.3.3">𝑟</ci></apply><apply id="A1.SS6.1.p1.2.m2.1.1.1.1.1.cmml" xref="A1.SS6.1.p1.2.m2.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.1.p1.2.m2.1.1.1.1.1.1.cmml" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.1.p1.2.m2.1.1.1.1.1.2.cmml" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.1.p1.2.m2.1.1.1.1.1.3.cmml" xref="A1.SS6.1.p1.2.m2.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.2.m2.1c">\pi_{r}(y|x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.2.m2.1d">italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y | italic_x )</annotation></semantics></math> under the KL-constrained RL problem, with solution given by <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E4" title="4 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>. Following Eq. <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S4.E5" title="5 ‣ 4 Direct Preference Optimization ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a>, when we log-linearize both sides we obtain:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.Ex19">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="r(x,y)=\beta\log\frac{\pi_{r}(y|x)}{\pi_{\text{ref}}(y|x)}+\beta\log Z(x)" class="ltx_Math" display="block" id="A1.Ex19.m1.5"><semantics id="A1.Ex19.m1.5a"><mrow id="A1.Ex19.m1.5.6" xref="A1.Ex19.m1.5.6.cmml"><mrow id="A1.Ex19.m1.5.6.2" xref="A1.Ex19.m1.5.6.2.cmml"><mi id="A1.Ex19.m1.5.6.2.2" xref="A1.Ex19.m1.5.6.2.2.cmml">r</mi><mo id="A1.Ex19.m1.5.6.2.1" xref="A1.Ex19.m1.5.6.2.1.cmml">⁢</mo><mrow id="A1.Ex19.m1.5.6.2.3.2" xref="A1.Ex19.m1.5.6.2.3.1.cmml"><mo id="A1.Ex19.m1.5.6.2.3.2.1" stretchy="false" xref="A1.Ex19.m1.5.6.2.3.1.cmml">(</mo><mi id="A1.Ex19.m1.3.3" xref="A1.Ex19.m1.3.3.cmml">x</mi><mo id="A1.Ex19.m1.5.6.2.3.2.2" xref="A1.Ex19.m1.5.6.2.3.1.cmml">,</mo><mi id="A1.Ex19.m1.4.4" xref="A1.Ex19.m1.4.4.cmml">y</mi><mo id="A1.Ex19.m1.5.6.2.3.2.3" stretchy="false" xref="A1.Ex19.m1.5.6.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex19.m1.5.6.1" xref="A1.Ex19.m1.5.6.1.cmml">=</mo><mrow id="A1.Ex19.m1.5.6.3" xref="A1.Ex19.m1.5.6.3.cmml"><mrow id="A1.Ex19.m1.5.6.3.2" xref="A1.Ex19.m1.5.6.3.2.cmml"><mi id="A1.Ex19.m1.5.6.3.2.2" xref="A1.Ex19.m1.5.6.3.2.2.cmml">β</mi><mo id="A1.Ex19.m1.5.6.3.2.1" lspace="0.167em" xref="A1.Ex19.m1.5.6.3.2.1.cmml">⁢</mo><mrow id="A1.Ex19.m1.5.6.3.2.3" xref="A1.Ex19.m1.5.6.3.2.3.cmml"><mi id="A1.Ex19.m1.5.6.3.2.3.1" xref="A1.Ex19.m1.5.6.3.2.3.1.cmml">log</mi><mo id="A1.Ex19.m1.5.6.3.2.3a" lspace="0.167em" xref="A1.Ex19.m1.5.6.3.2.3.cmml">⁡</mo><mfrac id="A1.Ex19.m1.2.2" xref="A1.Ex19.m1.2.2.cmml"><mrow id="A1.Ex19.m1.1.1.1" xref="A1.Ex19.m1.1.1.1.cmml"><msub id="A1.Ex19.m1.1.1.1.3" xref="A1.Ex19.m1.1.1.1.3.cmml"><mi id="A1.Ex19.m1.1.1.1.3.2" xref="A1.Ex19.m1.1.1.1.3.2.cmml">π</mi><mi id="A1.Ex19.m1.1.1.1.3.3" xref="A1.Ex19.m1.1.1.1.3.3.cmml">r</mi></msub><mo id="A1.Ex19.m1.1.1.1.2" xref="A1.Ex19.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex19.m1.1.1.1.1.1" xref="A1.Ex19.m1.1.1.1.1.1.1.cmml"><mo id="A1.Ex19.m1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex19.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex19.m1.1.1.1.1.1.1" xref="A1.Ex19.m1.1.1.1.1.1.1.cmml"><mi id="A1.Ex19.m1.1.1.1.1.1.1.2" xref="A1.Ex19.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex19.m1.1.1.1.1.1.1.1" xref="A1.Ex19.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex19.m1.1.1.1.1.1.1.3" xref="A1.Ex19.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex19.m1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex19.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex19.m1.2.2.2" xref="A1.Ex19.m1.2.2.2.cmml"><msub id="A1.Ex19.m1.2.2.2.3" xref="A1.Ex19.m1.2.2.2.3.cmml"><mi id="A1.Ex19.m1.2.2.2.3.2" xref="A1.Ex19.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex19.m1.2.2.2.3.3" xref="A1.Ex19.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex19.m1.2.2.2.2" xref="A1.Ex19.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex19.m1.2.2.2.1.1" xref="A1.Ex19.m1.2.2.2.1.1.1.cmml"><mo id="A1.Ex19.m1.2.2.2.1.1.2" stretchy="false" xref="A1.Ex19.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex19.m1.2.2.2.1.1.1" xref="A1.Ex19.m1.2.2.2.1.1.1.cmml"><mi id="A1.Ex19.m1.2.2.2.1.1.1.2" xref="A1.Ex19.m1.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex19.m1.2.2.2.1.1.1.1" xref="A1.Ex19.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex19.m1.2.2.2.1.1.1.3" xref="A1.Ex19.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex19.m1.2.2.2.1.1.3" stretchy="false" xref="A1.Ex19.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex19.m1.5.6.3.1" xref="A1.Ex19.m1.5.6.3.1.cmml">+</mo><mrow id="A1.Ex19.m1.5.6.3.3" xref="A1.Ex19.m1.5.6.3.3.cmml"><mi id="A1.Ex19.m1.5.6.3.3.2" xref="A1.Ex19.m1.5.6.3.3.2.cmml">β</mi><mo id="A1.Ex19.m1.5.6.3.3.1" lspace="0.167em" xref="A1.Ex19.m1.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.Ex19.m1.5.6.3.3.3" xref="A1.Ex19.m1.5.6.3.3.3.cmml"><mi id="A1.Ex19.m1.5.6.3.3.3.1" xref="A1.Ex19.m1.5.6.3.3.3.1.cmml">log</mi><mo id="A1.Ex19.m1.5.6.3.3.3a" lspace="0.167em" xref="A1.Ex19.m1.5.6.3.3.3.cmml">⁡</mo><mi id="A1.Ex19.m1.5.6.3.3.3.2" xref="A1.Ex19.m1.5.6.3.3.3.2.cmml">Z</mi></mrow><mo id="A1.Ex19.m1.5.6.3.3.1a" xref="A1.Ex19.m1.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.Ex19.m1.5.6.3.3.4.2" xref="A1.Ex19.m1.5.6.3.3.cmml"><mo id="A1.Ex19.m1.5.6.3.3.4.2.1" stretchy="false" xref="A1.Ex19.m1.5.6.3.3.cmml">(</mo><mi id="A1.Ex19.m1.5.5" xref="A1.Ex19.m1.5.5.cmml">x</mi><mo id="A1.Ex19.m1.5.6.3.3.4.2.2" stretchy="false" xref="A1.Ex19.m1.5.6.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex19.m1.5b"><apply id="A1.Ex19.m1.5.6.cmml" xref="A1.Ex19.m1.5.6"><eq id="A1.Ex19.m1.5.6.1.cmml" xref="A1.Ex19.m1.5.6.1"></eq><apply id="A1.Ex19.m1.5.6.2.cmml" xref="A1.Ex19.m1.5.6.2"><times id="A1.Ex19.m1.5.6.2.1.cmml" xref="A1.Ex19.m1.5.6.2.1"></times><ci id="A1.Ex19.m1.5.6.2.2.cmml" xref="A1.Ex19.m1.5.6.2.2">𝑟</ci><interval closure="open" id="A1.Ex19.m1.5.6.2.3.1.cmml" xref="A1.Ex19.m1.5.6.2.3.2"><ci id="A1.Ex19.m1.3.3.cmml" xref="A1.Ex19.m1.3.3">𝑥</ci><ci id="A1.Ex19.m1.4.4.cmml" xref="A1.Ex19.m1.4.4">𝑦</ci></interval></apply><apply id="A1.Ex19.m1.5.6.3.cmml" xref="A1.Ex19.m1.5.6.3"><plus id="A1.Ex19.m1.5.6.3.1.cmml" xref="A1.Ex19.m1.5.6.3.1"></plus><apply id="A1.Ex19.m1.5.6.3.2.cmml" xref="A1.Ex19.m1.5.6.3.2"><times id="A1.Ex19.m1.5.6.3.2.1.cmml" xref="A1.Ex19.m1.5.6.3.2.1"></times><ci id="A1.Ex19.m1.5.6.3.2.2.cmml" xref="A1.Ex19.m1.5.6.3.2.2">𝛽</ci><apply id="A1.Ex19.m1.5.6.3.2.3.cmml" xref="A1.Ex19.m1.5.6.3.2.3"><log id="A1.Ex19.m1.5.6.3.2.3.1.cmml" xref="A1.Ex19.m1.5.6.3.2.3.1"></log><apply id="A1.Ex19.m1.2.2.cmml" xref="A1.Ex19.m1.2.2"><divide id="A1.Ex19.m1.2.2.3.cmml" xref="A1.Ex19.m1.2.2"></divide><apply id="A1.Ex19.m1.1.1.1.cmml" xref="A1.Ex19.m1.1.1.1"><times id="A1.Ex19.m1.1.1.1.2.cmml" xref="A1.Ex19.m1.1.1.1.2"></times><apply id="A1.Ex19.m1.1.1.1.3.cmml" xref="A1.Ex19.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex19.m1.1.1.1.3.1.cmml" xref="A1.Ex19.m1.1.1.1.3">subscript</csymbol><ci id="A1.Ex19.m1.1.1.1.3.2.cmml" xref="A1.Ex19.m1.1.1.1.3.2">𝜋</ci><ci id="A1.Ex19.m1.1.1.1.3.3.cmml" xref="A1.Ex19.m1.1.1.1.3.3">𝑟</ci></apply><apply id="A1.Ex19.m1.1.1.1.1.1.1.cmml" xref="A1.Ex19.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex19.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex19.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex19.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex19.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex19.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex19.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex19.m1.2.2.2.cmml" xref="A1.Ex19.m1.2.2.2"><times id="A1.Ex19.m1.2.2.2.2.cmml" xref="A1.Ex19.m1.2.2.2.2"></times><apply id="A1.Ex19.m1.2.2.2.3.cmml" xref="A1.Ex19.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex19.m1.2.2.2.3.1.cmml" xref="A1.Ex19.m1.2.2.2.3">subscript</csymbol><ci id="A1.Ex19.m1.2.2.2.3.2.cmml" xref="A1.Ex19.m1.2.2.2.3.2">𝜋</ci><ci id="A1.Ex19.m1.2.2.2.3.3a.cmml" xref="A1.Ex19.m1.2.2.2.3.3"><mtext id="A1.Ex19.m1.2.2.2.3.3.cmml" mathsize="70%" xref="A1.Ex19.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex19.m1.2.2.2.1.1.1.cmml" xref="A1.Ex19.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex19.m1.2.2.2.1.1.1.1.cmml" xref="A1.Ex19.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex19.m1.2.2.2.1.1.1.2.cmml" xref="A1.Ex19.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.Ex19.m1.2.2.2.1.1.1.3.cmml" xref="A1.Ex19.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex19.m1.5.6.3.3.cmml" xref="A1.Ex19.m1.5.6.3.3"><times id="A1.Ex19.m1.5.6.3.3.1.cmml" xref="A1.Ex19.m1.5.6.3.3.1"></times><ci id="A1.Ex19.m1.5.6.3.3.2.cmml" xref="A1.Ex19.m1.5.6.3.3.2">𝛽</ci><apply id="A1.Ex19.m1.5.6.3.3.3.cmml" xref="A1.Ex19.m1.5.6.3.3.3"><log id="A1.Ex19.m1.5.6.3.3.3.1.cmml" xref="A1.Ex19.m1.5.6.3.3.3.1"></log><ci id="A1.Ex19.m1.5.6.3.3.3.2.cmml" xref="A1.Ex19.m1.5.6.3.3.3.2">𝑍</ci></apply><ci id="A1.Ex19.m1.5.5.cmml" xref="A1.Ex19.m1.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex19.m1.5c">r(x,y)=\beta\log\frac{\pi_{r}(y|x)}{\pi_{\text{ref}}(y|x)}+\beta\log Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex19.m1.5d">italic_r ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG + italic_β roman_log italic_Z ( italic_x )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS6.1.p1.7">where <math alttext="Z(x)=\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)" class="ltx_Math" display="inline" id="A1.SS6.1.p1.3.m1.6"><semantics id="A1.SS6.1.p1.3.m1.6a"><mrow id="A1.SS6.1.p1.3.m1.6.6" xref="A1.SS6.1.p1.3.m1.6.6.cmml"><mrow id="A1.SS6.1.p1.3.m1.6.6.4" xref="A1.SS6.1.p1.3.m1.6.6.4.cmml"><mi id="A1.SS6.1.p1.3.m1.6.6.4.2" xref="A1.SS6.1.p1.3.m1.6.6.4.2.cmml">Z</mi><mo id="A1.SS6.1.p1.3.m1.6.6.4.1" xref="A1.SS6.1.p1.3.m1.6.6.4.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.3.m1.6.6.4.3.2" xref="A1.SS6.1.p1.3.m1.6.6.4.cmml"><mo id="A1.SS6.1.p1.3.m1.6.6.4.3.2.1" stretchy="false" xref="A1.SS6.1.p1.3.m1.6.6.4.cmml">(</mo><mi id="A1.SS6.1.p1.3.m1.1.1" xref="A1.SS6.1.p1.3.m1.1.1.cmml">x</mi><mo id="A1.SS6.1.p1.3.m1.6.6.4.3.2.2" stretchy="false" xref="A1.SS6.1.p1.3.m1.6.6.4.cmml">)</mo></mrow></mrow><mo id="A1.SS6.1.p1.3.m1.6.6.3" rspace="0.111em" xref="A1.SS6.1.p1.3.m1.6.6.3.cmml">=</mo><mrow id="A1.SS6.1.p1.3.m1.6.6.2" xref="A1.SS6.1.p1.3.m1.6.6.2.cmml"><msub id="A1.SS6.1.p1.3.m1.6.6.2.3" xref="A1.SS6.1.p1.3.m1.6.6.2.3.cmml"><mo id="A1.SS6.1.p1.3.m1.6.6.2.3.2" xref="A1.SS6.1.p1.3.m1.6.6.2.3.2.cmml">∑</mo><mi id="A1.SS6.1.p1.3.m1.6.6.2.3.3" xref="A1.SS6.1.p1.3.m1.6.6.2.3.3.cmml">y</mi></msub><mrow id="A1.SS6.1.p1.3.m1.6.6.2.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.cmml"><msub id="A1.SS6.1.p1.3.m1.6.6.2.2.4" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4.cmml"><mi id="A1.SS6.1.p1.3.m1.6.6.2.2.4.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4.2.cmml">π</mi><mtext id="A1.SS6.1.p1.3.m1.6.6.2.2.4.3" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4.3a.cmml">ref</mtext></msub><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.3" xref="A1.SS6.1.p1.3.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.cmml"><mo id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.2" stretchy="false" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.cmml"><mi id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.2" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.1" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.3" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.3" stretchy="false" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.cmml">)</mo></mrow><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.3a" lspace="0.167em" xref="A1.SS6.1.p1.3.m1.6.6.2.2.3.cmml">⁢</mo><mrow id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.2.cmml"><mi id="A1.SS6.1.p1.3.m1.4.4" xref="A1.SS6.1.p1.3.m1.4.4.cmml">exp</mi><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1a" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.2.cmml">⁡</mo><mrow id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.2.cmml"><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.2.cmml">(</mo><mrow id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.cmml"><mfrac id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.cmml"><mn id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.3" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.1" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.1.cmml">⁢</mo><mi id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.3" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.3.cmml">r</mi><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.1a" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.1.cmml"><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.1.cmml">(</mo><mi id="A1.SS6.1.p1.3.m1.2.2" xref="A1.SS6.1.p1.3.m1.2.2.cmml">x</mi><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.2.2" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.1.cmml">,</mo><mi id="A1.SS6.1.p1.3.m1.3.3" xref="A1.SS6.1.p1.3.m1.3.3.cmml">y</mi><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.2.3" stretchy="false" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.3" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.2.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.3.m1.6b"><apply id="A1.SS6.1.p1.3.m1.6.6.cmml" xref="A1.SS6.1.p1.3.m1.6.6"><eq id="A1.SS6.1.p1.3.m1.6.6.3.cmml" xref="A1.SS6.1.p1.3.m1.6.6.3"></eq><apply id="A1.SS6.1.p1.3.m1.6.6.4.cmml" xref="A1.SS6.1.p1.3.m1.6.6.4"><times id="A1.SS6.1.p1.3.m1.6.6.4.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.4.1"></times><ci id="A1.SS6.1.p1.3.m1.6.6.4.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.4.2">𝑍</ci><ci id="A1.SS6.1.p1.3.m1.1.1.cmml" xref="A1.SS6.1.p1.3.m1.1.1">𝑥</ci></apply><apply id="A1.SS6.1.p1.3.m1.6.6.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2"><apply id="A1.SS6.1.p1.3.m1.6.6.2.3.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.3"><csymbol cd="ambiguous" id="A1.SS6.1.p1.3.m1.6.6.2.3.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.3">subscript</csymbol><sum id="A1.SS6.1.p1.3.m1.6.6.2.3.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.3.2"></sum><ci id="A1.SS6.1.p1.3.m1.6.6.2.3.3.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.3.3">𝑦</ci></apply><apply id="A1.SS6.1.p1.3.m1.6.6.2.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2"><times id="A1.SS6.1.p1.3.m1.6.6.2.2.3.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.3"></times><apply id="A1.SS6.1.p1.3.m1.6.6.2.2.4.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4"><csymbol cd="ambiguous" id="A1.SS6.1.p1.3.m1.6.6.2.2.4.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4">subscript</csymbol><ci id="A1.SS6.1.p1.3.m1.6.6.2.2.4.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4.2">𝜋</ci><ci id="A1.SS6.1.p1.3.m1.6.6.2.2.4.3a.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4.3"><mtext id="A1.SS6.1.p1.3.m1.6.6.2.2.4.3.cmml" mathsize="70%" xref="A1.SS6.1.p1.3.m1.6.6.2.2.4.3">ref</mtext></ci></apply><apply id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.cmml" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.1.cmml" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.2.cmml" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.3.cmml" xref="A1.SS6.1.p1.3.m1.5.5.1.1.1.1.1.3">𝑥</ci></apply><apply id="A1.SS6.1.p1.3.m1.6.6.2.2.2.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1"><exp id="A1.SS6.1.p1.3.m1.4.4.cmml" xref="A1.SS6.1.p1.3.m1.4.4"></exp><apply id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1"><times id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.1"></times><apply id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2"><divide id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2"></divide><cn id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.2">1</cn><ci id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.3.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.3.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.3">𝑟</ci><interval closure="open" id="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.1.cmml" xref="A1.SS6.1.p1.3.m1.6.6.2.2.2.1.1.1.4.2"><ci id="A1.SS6.1.p1.3.m1.2.2.cmml" xref="A1.SS6.1.p1.3.m1.2.2">𝑥</ci><ci id="A1.SS6.1.p1.3.m1.3.3.cmml" xref="A1.SS6.1.p1.3.m1.3.3">𝑦</ci></interval></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.3.m1.6c">Z(x)=\sum_{y}\pi_{\text{ref}}(y|x)\exp\left(\frac{1}{\beta}r(x,y)\right)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.3.m1.6d">italic_Z ( italic_x ) = ∑ start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_r ( italic_x , italic_y ) )</annotation></semantics></math> (notice that <math alttext="Z(x)" class="ltx_Math" display="inline" id="A1.SS6.1.p1.4.m2.1"><semantics id="A1.SS6.1.p1.4.m2.1a"><mrow id="A1.SS6.1.p1.4.m2.1.2" xref="A1.SS6.1.p1.4.m2.1.2.cmml"><mi id="A1.SS6.1.p1.4.m2.1.2.2" xref="A1.SS6.1.p1.4.m2.1.2.2.cmml">Z</mi><mo id="A1.SS6.1.p1.4.m2.1.2.1" xref="A1.SS6.1.p1.4.m2.1.2.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.4.m2.1.2.3.2" xref="A1.SS6.1.p1.4.m2.1.2.cmml"><mo id="A1.SS6.1.p1.4.m2.1.2.3.2.1" stretchy="false" xref="A1.SS6.1.p1.4.m2.1.2.cmml">(</mo><mi id="A1.SS6.1.p1.4.m2.1.1" xref="A1.SS6.1.p1.4.m2.1.1.cmml">x</mi><mo id="A1.SS6.1.p1.4.m2.1.2.3.2.2" stretchy="false" xref="A1.SS6.1.p1.4.m2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.4.m2.1b"><apply id="A1.SS6.1.p1.4.m2.1.2.cmml" xref="A1.SS6.1.p1.4.m2.1.2"><times id="A1.SS6.1.p1.4.m2.1.2.1.cmml" xref="A1.SS6.1.p1.4.m2.1.2.1"></times><ci id="A1.SS6.1.p1.4.m2.1.2.2.cmml" xref="A1.SS6.1.p1.4.m2.1.2.2">𝑍</ci><ci id="A1.SS6.1.p1.4.m2.1.1.cmml" xref="A1.SS6.1.p1.4.m2.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.4.m2.1c">Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.4.m2.1d">italic_Z ( italic_x )</annotation></semantics></math> also depends on the reward function <math alttext="r" class="ltx_Math" display="inline" id="A1.SS6.1.p1.5.m3.1"><semantics id="A1.SS6.1.p1.5.m3.1a"><mi id="A1.SS6.1.p1.5.m3.1.1" xref="A1.SS6.1.p1.5.m3.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.5.m3.1b"><ci id="A1.SS6.1.p1.5.m3.1.1.cmml" xref="A1.SS6.1.p1.5.m3.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.5.m3.1c">r</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.5.m3.1d">italic_r</annotation></semantics></math>). Using the operator <math alttext="r^{\prime}(x,y)=f(r,\pi_{\text{ref}},\beta)(x,y)=r(x,y)-\beta\log Z(x)" class="ltx_Math" display="inline" id="A1.SS6.1.p1.6.m4.10"><semantics id="A1.SS6.1.p1.6.m4.10a"><mrow id="A1.SS6.1.p1.6.m4.10.10" xref="A1.SS6.1.p1.6.m4.10.10.cmml"><mrow id="A1.SS6.1.p1.6.m4.10.10.3" xref="A1.SS6.1.p1.6.m4.10.10.3.cmml"><msup id="A1.SS6.1.p1.6.m4.10.10.3.2" xref="A1.SS6.1.p1.6.m4.10.10.3.2.cmml"><mi id="A1.SS6.1.p1.6.m4.10.10.3.2.2" xref="A1.SS6.1.p1.6.m4.10.10.3.2.2.cmml">r</mi><mo id="A1.SS6.1.p1.6.m4.10.10.3.2.3" xref="A1.SS6.1.p1.6.m4.10.10.3.2.3.cmml">′</mo></msup><mo id="A1.SS6.1.p1.6.m4.10.10.3.1" xref="A1.SS6.1.p1.6.m4.10.10.3.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.3.3.2" xref="A1.SS6.1.p1.6.m4.10.10.3.3.1.cmml"><mo id="A1.SS6.1.p1.6.m4.10.10.3.3.2.1" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.3.3.1.cmml">(</mo><mi id="A1.SS6.1.p1.6.m4.1.1" xref="A1.SS6.1.p1.6.m4.1.1.cmml">x</mi><mo id="A1.SS6.1.p1.6.m4.10.10.3.3.2.2" xref="A1.SS6.1.p1.6.m4.10.10.3.3.1.cmml">,</mo><mi id="A1.SS6.1.p1.6.m4.2.2" xref="A1.SS6.1.p1.6.m4.2.2.cmml">y</mi><mo id="A1.SS6.1.p1.6.m4.10.10.3.3.2.3" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.3.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.1.p1.6.m4.10.10.4" xref="A1.SS6.1.p1.6.m4.10.10.4.cmml">=</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.1" xref="A1.SS6.1.p1.6.m4.10.10.1.cmml"><mi id="A1.SS6.1.p1.6.m4.10.10.1.3" xref="A1.SS6.1.p1.6.m4.10.10.1.3.cmml">f</mi><mo id="A1.SS6.1.p1.6.m4.10.10.1.2" xref="A1.SS6.1.p1.6.m4.10.10.1.2.cmml">⁢</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.1.1.1" xref="A1.SS6.1.p1.6.m4.10.10.1.1.2.cmml"><mo id="A1.SS6.1.p1.6.m4.10.10.1.1.1.2" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.1.1.2.cmml">(</mo><mi id="A1.SS6.1.p1.6.m4.3.3" xref="A1.SS6.1.p1.6.m4.3.3.cmml">r</mi><mo id="A1.SS6.1.p1.6.m4.10.10.1.1.1.3" xref="A1.SS6.1.p1.6.m4.10.10.1.1.2.cmml">,</mo><msub id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.cmml"><mi id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.2" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.2.cmml">π</mi><mtext id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.3" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.3a.cmml">ref</mtext></msub><mo id="A1.SS6.1.p1.6.m4.10.10.1.1.1.4" xref="A1.SS6.1.p1.6.m4.10.10.1.1.2.cmml">,</mo><mi id="A1.SS6.1.p1.6.m4.4.4" xref="A1.SS6.1.p1.6.m4.4.4.cmml">β</mi><mo id="A1.SS6.1.p1.6.m4.10.10.1.1.1.5" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.1.1.2.cmml">)</mo></mrow><mo id="A1.SS6.1.p1.6.m4.10.10.1.2a" xref="A1.SS6.1.p1.6.m4.10.10.1.2.cmml">⁢</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.1.4.2" xref="A1.SS6.1.p1.6.m4.10.10.1.4.1.cmml"><mo id="A1.SS6.1.p1.6.m4.10.10.1.4.2.1" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.1.4.1.cmml">(</mo><mi id="A1.SS6.1.p1.6.m4.5.5" xref="A1.SS6.1.p1.6.m4.5.5.cmml">x</mi><mo id="A1.SS6.1.p1.6.m4.10.10.1.4.2.2" xref="A1.SS6.1.p1.6.m4.10.10.1.4.1.cmml">,</mo><mi id="A1.SS6.1.p1.6.m4.6.6" xref="A1.SS6.1.p1.6.m4.6.6.cmml">y</mi><mo id="A1.SS6.1.p1.6.m4.10.10.1.4.2.3" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.1.p1.6.m4.10.10.5" xref="A1.SS6.1.p1.6.m4.10.10.5.cmml">=</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.6" xref="A1.SS6.1.p1.6.m4.10.10.6.cmml"><mrow id="A1.SS6.1.p1.6.m4.10.10.6.2" xref="A1.SS6.1.p1.6.m4.10.10.6.2.cmml"><mi id="A1.SS6.1.p1.6.m4.10.10.6.2.2" xref="A1.SS6.1.p1.6.m4.10.10.6.2.2.cmml">r</mi><mo id="A1.SS6.1.p1.6.m4.10.10.6.2.1" xref="A1.SS6.1.p1.6.m4.10.10.6.2.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.6.2.3.2" xref="A1.SS6.1.p1.6.m4.10.10.6.2.3.1.cmml"><mo id="A1.SS6.1.p1.6.m4.10.10.6.2.3.2.1" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.6.2.3.1.cmml">(</mo><mi id="A1.SS6.1.p1.6.m4.7.7" xref="A1.SS6.1.p1.6.m4.7.7.cmml">x</mi><mo id="A1.SS6.1.p1.6.m4.10.10.6.2.3.2.2" xref="A1.SS6.1.p1.6.m4.10.10.6.2.3.1.cmml">,</mo><mi id="A1.SS6.1.p1.6.m4.8.8" xref="A1.SS6.1.p1.6.m4.8.8.cmml">y</mi><mo id="A1.SS6.1.p1.6.m4.10.10.6.2.3.2.3" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.6.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.1.p1.6.m4.10.10.6.1" xref="A1.SS6.1.p1.6.m4.10.10.6.1.cmml">−</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.6.3" xref="A1.SS6.1.p1.6.m4.10.10.6.3.cmml"><mi id="A1.SS6.1.p1.6.m4.10.10.6.3.2" xref="A1.SS6.1.p1.6.m4.10.10.6.3.2.cmml">β</mi><mo id="A1.SS6.1.p1.6.m4.10.10.6.3.1" lspace="0.167em" xref="A1.SS6.1.p1.6.m4.10.10.6.3.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.6.3.3" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3.cmml"><mi id="A1.SS6.1.p1.6.m4.10.10.6.3.3.1" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3.1.cmml">log</mi><mo id="A1.SS6.1.p1.6.m4.10.10.6.3.3a" lspace="0.167em" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3.cmml">⁡</mo><mi id="A1.SS6.1.p1.6.m4.10.10.6.3.3.2" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3.2.cmml">Z</mi></mrow><mo id="A1.SS6.1.p1.6.m4.10.10.6.3.1a" xref="A1.SS6.1.p1.6.m4.10.10.6.3.1.cmml">⁢</mo><mrow id="A1.SS6.1.p1.6.m4.10.10.6.3.4.2" xref="A1.SS6.1.p1.6.m4.10.10.6.3.cmml"><mo id="A1.SS6.1.p1.6.m4.10.10.6.3.4.2.1" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.6.3.cmml">(</mo><mi id="A1.SS6.1.p1.6.m4.9.9" xref="A1.SS6.1.p1.6.m4.9.9.cmml">x</mi><mo id="A1.SS6.1.p1.6.m4.10.10.6.3.4.2.2" stretchy="false" xref="A1.SS6.1.p1.6.m4.10.10.6.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.6.m4.10b"><apply id="A1.SS6.1.p1.6.m4.10.10.cmml" xref="A1.SS6.1.p1.6.m4.10.10"><and id="A1.SS6.1.p1.6.m4.10.10a.cmml" xref="A1.SS6.1.p1.6.m4.10.10"></and><apply id="A1.SS6.1.p1.6.m4.10.10b.cmml" xref="A1.SS6.1.p1.6.m4.10.10"><eq id="A1.SS6.1.p1.6.m4.10.10.4.cmml" xref="A1.SS6.1.p1.6.m4.10.10.4"></eq><apply id="A1.SS6.1.p1.6.m4.10.10.3.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3"><times id="A1.SS6.1.p1.6.m4.10.10.3.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3.1"></times><apply id="A1.SS6.1.p1.6.m4.10.10.3.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3.2"><csymbol cd="ambiguous" id="A1.SS6.1.p1.6.m4.10.10.3.2.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3.2">superscript</csymbol><ci id="A1.SS6.1.p1.6.m4.10.10.3.2.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3.2.2">𝑟</ci><ci id="A1.SS6.1.p1.6.m4.10.10.3.2.3.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3.2.3">′</ci></apply><interval closure="open" id="A1.SS6.1.p1.6.m4.10.10.3.3.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.3.3.2"><ci id="A1.SS6.1.p1.6.m4.1.1.cmml" xref="A1.SS6.1.p1.6.m4.1.1">𝑥</ci><ci id="A1.SS6.1.p1.6.m4.2.2.cmml" xref="A1.SS6.1.p1.6.m4.2.2">𝑦</ci></interval></apply><apply id="A1.SS6.1.p1.6.m4.10.10.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1"><times id="A1.SS6.1.p1.6.m4.10.10.1.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.2"></times><ci id="A1.SS6.1.p1.6.m4.10.10.1.3.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.3">𝑓</ci><vector id="A1.SS6.1.p1.6.m4.10.10.1.1.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1"><ci id="A1.SS6.1.p1.6.m4.3.3.cmml" xref="A1.SS6.1.p1.6.m4.3.3">𝑟</ci><apply id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1"><csymbol cd="ambiguous" id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1">subscript</csymbol><ci id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.2">𝜋</ci><ci id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.3a.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.3"><mtext id="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.3.cmml" mathsize="70%" xref="A1.SS6.1.p1.6.m4.10.10.1.1.1.1.3">ref</mtext></ci></apply><ci id="A1.SS6.1.p1.6.m4.4.4.cmml" xref="A1.SS6.1.p1.6.m4.4.4">𝛽</ci></vector><interval closure="open" id="A1.SS6.1.p1.6.m4.10.10.1.4.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.1.4.2"><ci id="A1.SS6.1.p1.6.m4.5.5.cmml" xref="A1.SS6.1.p1.6.m4.5.5">𝑥</ci><ci id="A1.SS6.1.p1.6.m4.6.6.cmml" xref="A1.SS6.1.p1.6.m4.6.6">𝑦</ci></interval></apply></apply><apply id="A1.SS6.1.p1.6.m4.10.10c.cmml" xref="A1.SS6.1.p1.6.m4.10.10"><eq id="A1.SS6.1.p1.6.m4.10.10.5.cmml" xref="A1.SS6.1.p1.6.m4.10.10.5"></eq><share href="#A1.SS6.1.p1.6.m4.10.10.1.cmml" id="A1.SS6.1.p1.6.m4.10.10d.cmml" xref="A1.SS6.1.p1.6.m4.10.10"></share><apply id="A1.SS6.1.p1.6.m4.10.10.6.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6"><minus id="A1.SS6.1.p1.6.m4.10.10.6.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.1"></minus><apply id="A1.SS6.1.p1.6.m4.10.10.6.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.2"><times id="A1.SS6.1.p1.6.m4.10.10.6.2.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.2.1"></times><ci id="A1.SS6.1.p1.6.m4.10.10.6.2.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.2.2">𝑟</ci><interval closure="open" id="A1.SS6.1.p1.6.m4.10.10.6.2.3.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.2.3.2"><ci id="A1.SS6.1.p1.6.m4.7.7.cmml" xref="A1.SS6.1.p1.6.m4.7.7">𝑥</ci><ci id="A1.SS6.1.p1.6.m4.8.8.cmml" xref="A1.SS6.1.p1.6.m4.8.8">𝑦</ci></interval></apply><apply id="A1.SS6.1.p1.6.m4.10.10.6.3.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.3"><times id="A1.SS6.1.p1.6.m4.10.10.6.3.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.3.1"></times><ci id="A1.SS6.1.p1.6.m4.10.10.6.3.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.3.2">𝛽</ci><apply id="A1.SS6.1.p1.6.m4.10.10.6.3.3.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3"><log id="A1.SS6.1.p1.6.m4.10.10.6.3.3.1.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3.1"></log><ci id="A1.SS6.1.p1.6.m4.10.10.6.3.3.2.cmml" xref="A1.SS6.1.p1.6.m4.10.10.6.3.3.2">𝑍</ci></apply><ci id="A1.SS6.1.p1.6.m4.9.9.cmml" xref="A1.SS6.1.p1.6.m4.9.9">𝑥</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.6.m4.10c">r^{\prime}(x,y)=f(r,\pi_{\text{ref}},\beta)(x,y)=r(x,y)-\beta\log Z(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.6.m4.10d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_f ( italic_r , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) ( italic_x , italic_y ) = italic_r ( italic_x , italic_y ) - italic_β roman_log italic_Z ( italic_x )</annotation></semantics></math>, we see that this new reward function is within the equivalence class of <math alttext="r" class="ltx_Math" display="inline" id="A1.SS6.1.p1.7.m5.1"><semantics id="A1.SS6.1.p1.7.m5.1a"><mi id="A1.SS6.1.p1.7.m5.1.1" xref="A1.SS6.1.p1.7.m5.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.1.p1.7.m5.1b"><ci id="A1.SS6.1.p1.7.m5.1.1.cmml" xref="A1.SS6.1.p1.7.m5.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.1.p1.7.m5.1c">r</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.1.p1.7.m5.1d">italic_r</annotation></semantics></math> and, we have:
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.Ex20">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="r^{\prime}(x,y)=\beta\log\frac{\pi_{r}(y|x)}{\pi_{\text{ref}}(y|x)}" class="ltx_Math" display="block" id="A1.Ex20.m1.4"><semantics id="A1.Ex20.m1.4a"><mrow id="A1.Ex20.m1.4.5" xref="A1.Ex20.m1.4.5.cmml"><mrow id="A1.Ex20.m1.4.5.2" xref="A1.Ex20.m1.4.5.2.cmml"><msup id="A1.Ex20.m1.4.5.2.2" xref="A1.Ex20.m1.4.5.2.2.cmml"><mi id="A1.Ex20.m1.4.5.2.2.2" xref="A1.Ex20.m1.4.5.2.2.2.cmml">r</mi><mo id="A1.Ex20.m1.4.5.2.2.3" xref="A1.Ex20.m1.4.5.2.2.3.cmml">′</mo></msup><mo id="A1.Ex20.m1.4.5.2.1" xref="A1.Ex20.m1.4.5.2.1.cmml">⁢</mo><mrow id="A1.Ex20.m1.4.5.2.3.2" xref="A1.Ex20.m1.4.5.2.3.1.cmml"><mo id="A1.Ex20.m1.4.5.2.3.2.1" stretchy="false" xref="A1.Ex20.m1.4.5.2.3.1.cmml">(</mo><mi id="A1.Ex20.m1.3.3" xref="A1.Ex20.m1.3.3.cmml">x</mi><mo id="A1.Ex20.m1.4.5.2.3.2.2" xref="A1.Ex20.m1.4.5.2.3.1.cmml">,</mo><mi id="A1.Ex20.m1.4.4" xref="A1.Ex20.m1.4.4.cmml">y</mi><mo id="A1.Ex20.m1.4.5.2.3.2.3" stretchy="false" xref="A1.Ex20.m1.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex20.m1.4.5.1" xref="A1.Ex20.m1.4.5.1.cmml">=</mo><mrow id="A1.Ex20.m1.4.5.3" xref="A1.Ex20.m1.4.5.3.cmml"><mi id="A1.Ex20.m1.4.5.3.2" xref="A1.Ex20.m1.4.5.3.2.cmml">β</mi><mo id="A1.Ex20.m1.4.5.3.1" lspace="0.167em" xref="A1.Ex20.m1.4.5.3.1.cmml">⁢</mo><mrow id="A1.Ex20.m1.4.5.3.3" xref="A1.Ex20.m1.4.5.3.3.cmml"><mi id="A1.Ex20.m1.4.5.3.3.1" xref="A1.Ex20.m1.4.5.3.3.1.cmml">log</mi><mo id="A1.Ex20.m1.4.5.3.3a" lspace="0.167em" xref="A1.Ex20.m1.4.5.3.3.cmml">⁡</mo><mfrac id="A1.Ex20.m1.2.2" xref="A1.Ex20.m1.2.2.cmml"><mrow id="A1.Ex20.m1.1.1.1" xref="A1.Ex20.m1.1.1.1.cmml"><msub id="A1.Ex20.m1.1.1.1.3" xref="A1.Ex20.m1.1.1.1.3.cmml"><mi id="A1.Ex20.m1.1.1.1.3.2" xref="A1.Ex20.m1.1.1.1.3.2.cmml">π</mi><mi id="A1.Ex20.m1.1.1.1.3.3" xref="A1.Ex20.m1.1.1.1.3.3.cmml">r</mi></msub><mo id="A1.Ex20.m1.1.1.1.2" xref="A1.Ex20.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex20.m1.1.1.1.1.1" xref="A1.Ex20.m1.1.1.1.1.1.1.cmml"><mo id="A1.Ex20.m1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex20.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex20.m1.1.1.1.1.1.1" xref="A1.Ex20.m1.1.1.1.1.1.1.cmml"><mi id="A1.Ex20.m1.1.1.1.1.1.1.2" xref="A1.Ex20.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex20.m1.1.1.1.1.1.1.1" xref="A1.Ex20.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex20.m1.1.1.1.1.1.1.3" xref="A1.Ex20.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex20.m1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex20.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex20.m1.2.2.2" xref="A1.Ex20.m1.2.2.2.cmml"><msub id="A1.Ex20.m1.2.2.2.3" xref="A1.Ex20.m1.2.2.2.3.cmml"><mi id="A1.Ex20.m1.2.2.2.3.2" xref="A1.Ex20.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex20.m1.2.2.2.3.3" xref="A1.Ex20.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex20.m1.2.2.2.2" xref="A1.Ex20.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex20.m1.2.2.2.1.1" xref="A1.Ex20.m1.2.2.2.1.1.1.cmml"><mo id="A1.Ex20.m1.2.2.2.1.1.2" stretchy="false" xref="A1.Ex20.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex20.m1.2.2.2.1.1.1" xref="A1.Ex20.m1.2.2.2.1.1.1.cmml"><mi id="A1.Ex20.m1.2.2.2.1.1.1.2" xref="A1.Ex20.m1.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex20.m1.2.2.2.1.1.1.1" xref="A1.Ex20.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex20.m1.2.2.2.1.1.1.3" xref="A1.Ex20.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex20.m1.2.2.2.1.1.3" stretchy="false" xref="A1.Ex20.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex20.m1.4b"><apply id="A1.Ex20.m1.4.5.cmml" xref="A1.Ex20.m1.4.5"><eq id="A1.Ex20.m1.4.5.1.cmml" xref="A1.Ex20.m1.4.5.1"></eq><apply id="A1.Ex20.m1.4.5.2.cmml" xref="A1.Ex20.m1.4.5.2"><times id="A1.Ex20.m1.4.5.2.1.cmml" xref="A1.Ex20.m1.4.5.2.1"></times><apply id="A1.Ex20.m1.4.5.2.2.cmml" xref="A1.Ex20.m1.4.5.2.2"><csymbol cd="ambiguous" id="A1.Ex20.m1.4.5.2.2.1.cmml" xref="A1.Ex20.m1.4.5.2.2">superscript</csymbol><ci id="A1.Ex20.m1.4.5.2.2.2.cmml" xref="A1.Ex20.m1.4.5.2.2.2">𝑟</ci><ci id="A1.Ex20.m1.4.5.2.2.3.cmml" xref="A1.Ex20.m1.4.5.2.2.3">′</ci></apply><interval closure="open" id="A1.Ex20.m1.4.5.2.3.1.cmml" xref="A1.Ex20.m1.4.5.2.3.2"><ci id="A1.Ex20.m1.3.3.cmml" xref="A1.Ex20.m1.3.3">𝑥</ci><ci id="A1.Ex20.m1.4.4.cmml" xref="A1.Ex20.m1.4.4">𝑦</ci></interval></apply><apply id="A1.Ex20.m1.4.5.3.cmml" xref="A1.Ex20.m1.4.5.3"><times id="A1.Ex20.m1.4.5.3.1.cmml" xref="A1.Ex20.m1.4.5.3.1"></times><ci id="A1.Ex20.m1.4.5.3.2.cmml" xref="A1.Ex20.m1.4.5.3.2">𝛽</ci><apply id="A1.Ex20.m1.4.5.3.3.cmml" xref="A1.Ex20.m1.4.5.3.3"><log id="A1.Ex20.m1.4.5.3.3.1.cmml" xref="A1.Ex20.m1.4.5.3.3.1"></log><apply id="A1.Ex20.m1.2.2.cmml" xref="A1.Ex20.m1.2.2"><divide id="A1.Ex20.m1.2.2.3.cmml" xref="A1.Ex20.m1.2.2"></divide><apply id="A1.Ex20.m1.1.1.1.cmml" xref="A1.Ex20.m1.1.1.1"><times id="A1.Ex20.m1.1.1.1.2.cmml" xref="A1.Ex20.m1.1.1.1.2"></times><apply id="A1.Ex20.m1.1.1.1.3.cmml" xref="A1.Ex20.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex20.m1.1.1.1.3.1.cmml" xref="A1.Ex20.m1.1.1.1.3">subscript</csymbol><ci id="A1.Ex20.m1.1.1.1.3.2.cmml" xref="A1.Ex20.m1.1.1.1.3.2">𝜋</ci><ci id="A1.Ex20.m1.1.1.1.3.3.cmml" xref="A1.Ex20.m1.1.1.1.3.3">𝑟</ci></apply><apply id="A1.Ex20.m1.1.1.1.1.1.1.cmml" xref="A1.Ex20.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex20.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex20.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex20.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex20.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex20.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex20.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex20.m1.2.2.2.cmml" xref="A1.Ex20.m1.2.2.2"><times id="A1.Ex20.m1.2.2.2.2.cmml" xref="A1.Ex20.m1.2.2.2.2"></times><apply id="A1.Ex20.m1.2.2.2.3.cmml" xref="A1.Ex20.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex20.m1.2.2.2.3.1.cmml" xref="A1.Ex20.m1.2.2.2.3">subscript</csymbol><ci id="A1.Ex20.m1.2.2.2.3.2.cmml" xref="A1.Ex20.m1.2.2.2.3.2">𝜋</ci><ci id="A1.Ex20.m1.2.2.2.3.3a.cmml" xref="A1.Ex20.m1.2.2.2.3.3"><mtext id="A1.Ex20.m1.2.2.2.3.3.cmml" mathsize="70%" xref="A1.Ex20.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex20.m1.2.2.2.1.1.1.cmml" xref="A1.Ex20.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex20.m1.2.2.2.1.1.1.1.cmml" xref="A1.Ex20.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex20.m1.2.2.2.1.1.1.2.cmml" xref="A1.Ex20.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.Ex20.m1.2.2.2.1.1.1.3.cmml" xref="A1.Ex20.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex20.m1.4c">r^{\prime}(x,y)=\beta\log\frac{\pi_{r}(y|x)}{\pi_{\text{ref}}(y|x)}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex20.m1.4d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS6.2.p2">
<p class="ltx_p" id="A1.SS6.2.p2.1">which completes the proof.
∎</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_para" id="A1.SS6.p3">
<p class="ltx_p" id="A1.SS6.p3.2">We can further expand on these results. We can see that if <math alttext="r" class="ltx_Math" display="inline" id="A1.SS6.p3.1.m1.1"><semantics id="A1.SS6.p3.1.m1.1a"><mi id="A1.SS6.p3.1.m1.1.1" xref="A1.SS6.p3.1.m1.1.1.cmml">r</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.p3.1.m1.1b"><ci id="A1.SS6.p3.1.m1.1.1.cmml" xref="A1.SS6.p3.1.m1.1.1">𝑟</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p3.1.m1.1c">r</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p3.1.m1.1d">italic_r</annotation></semantics></math> and <math alttext="r^{\prime}" class="ltx_Math" display="inline" id="A1.SS6.p3.2.m2.1"><semantics id="A1.SS6.p3.2.m2.1a"><msup id="A1.SS6.p3.2.m2.1.1" xref="A1.SS6.p3.2.m2.1.1.cmml"><mi id="A1.SS6.p3.2.m2.1.1.2" xref="A1.SS6.p3.2.m2.1.1.2.cmml">r</mi><mo id="A1.SS6.p3.2.m2.1.1.3" xref="A1.SS6.p3.2.m2.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="A1.SS6.p3.2.m2.1b"><apply id="A1.SS6.p3.2.m2.1.1.cmml" xref="A1.SS6.p3.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS6.p3.2.m2.1.1.1.cmml" xref="A1.SS6.p3.2.m2.1.1">superscript</csymbol><ci id="A1.SS6.p3.2.m2.1.1.2.cmml" xref="A1.SS6.p3.2.m2.1.1.2">𝑟</ci><ci id="A1.SS6.p3.2.m2.1.1.3.cmml" xref="A1.SS6.p3.2.m2.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p3.2.m2.1c">r^{\prime}</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p3.2.m2.1d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> are two reward functions in the same class, then</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.Ex21">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f(r,\pi_{\text{ref}},\beta)(x,y)=\beta\log\frac{\pi_{r}(y|x)}{\pi_{\text{ref}}%
(y|x)}=\beta\log\frac{\pi_{r}^{\prime}(y|x)}{\pi_{\text{ref}}(y|x)}=f(r^{%
\prime},\pi_{\text{ref}},\beta)(x,y)" class="ltx_Math" display="block" id="A1.Ex21.m1.14"><semantics id="A1.Ex21.m1.14a"><mrow id="A1.Ex21.m1.14.14" xref="A1.Ex21.m1.14.14.cmml"><mrow id="A1.Ex21.m1.12.12.1" xref="A1.Ex21.m1.12.12.1.cmml"><mi id="A1.Ex21.m1.12.12.1.3" xref="A1.Ex21.m1.12.12.1.3.cmml">f</mi><mo id="A1.Ex21.m1.12.12.1.2" xref="A1.Ex21.m1.12.12.1.2.cmml">⁢</mo><mrow id="A1.Ex21.m1.12.12.1.1.1" xref="A1.Ex21.m1.12.12.1.1.2.cmml"><mo id="A1.Ex21.m1.12.12.1.1.1.2" stretchy="false" xref="A1.Ex21.m1.12.12.1.1.2.cmml">(</mo><mi id="A1.Ex21.m1.5.5" xref="A1.Ex21.m1.5.5.cmml">r</mi><mo id="A1.Ex21.m1.12.12.1.1.1.3" xref="A1.Ex21.m1.12.12.1.1.2.cmml">,</mo><msub id="A1.Ex21.m1.12.12.1.1.1.1" xref="A1.Ex21.m1.12.12.1.1.1.1.cmml"><mi id="A1.Ex21.m1.12.12.1.1.1.1.2" xref="A1.Ex21.m1.12.12.1.1.1.1.2.cmml">π</mi><mtext id="A1.Ex21.m1.12.12.1.1.1.1.3" xref="A1.Ex21.m1.12.12.1.1.1.1.3a.cmml">ref</mtext></msub><mo id="A1.Ex21.m1.12.12.1.1.1.4" xref="A1.Ex21.m1.12.12.1.1.2.cmml">,</mo><mi id="A1.Ex21.m1.6.6" xref="A1.Ex21.m1.6.6.cmml">β</mi><mo id="A1.Ex21.m1.12.12.1.1.1.5" stretchy="false" xref="A1.Ex21.m1.12.12.1.1.2.cmml">)</mo></mrow><mo id="A1.Ex21.m1.12.12.1.2a" xref="A1.Ex21.m1.12.12.1.2.cmml">⁢</mo><mrow id="A1.Ex21.m1.12.12.1.4.2" xref="A1.Ex21.m1.12.12.1.4.1.cmml"><mo id="A1.Ex21.m1.12.12.1.4.2.1" stretchy="false" xref="A1.Ex21.m1.12.12.1.4.1.cmml">(</mo><mi id="A1.Ex21.m1.7.7" xref="A1.Ex21.m1.7.7.cmml">x</mi><mo id="A1.Ex21.m1.12.12.1.4.2.2" xref="A1.Ex21.m1.12.12.1.4.1.cmml">,</mo><mi id="A1.Ex21.m1.8.8" xref="A1.Ex21.m1.8.8.cmml">y</mi><mo id="A1.Ex21.m1.12.12.1.4.2.3" stretchy="false" xref="A1.Ex21.m1.12.12.1.4.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex21.m1.14.14.5" xref="A1.Ex21.m1.14.14.5.cmml">=</mo><mrow id="A1.Ex21.m1.14.14.6" xref="A1.Ex21.m1.14.14.6.cmml"><mi id="A1.Ex21.m1.14.14.6.2" xref="A1.Ex21.m1.14.14.6.2.cmml">β</mi><mo id="A1.Ex21.m1.14.14.6.1" lspace="0.167em" xref="A1.Ex21.m1.14.14.6.1.cmml">⁢</mo><mrow id="A1.Ex21.m1.14.14.6.3" xref="A1.Ex21.m1.14.14.6.3.cmml"><mi id="A1.Ex21.m1.14.14.6.3.1" xref="A1.Ex21.m1.14.14.6.3.1.cmml">log</mi><mo id="A1.Ex21.m1.14.14.6.3a" lspace="0.167em" xref="A1.Ex21.m1.14.14.6.3.cmml">⁡</mo><mfrac id="A1.Ex21.m1.2.2" xref="A1.Ex21.m1.2.2.cmml"><mrow id="A1.Ex21.m1.1.1.1" xref="A1.Ex21.m1.1.1.1.cmml"><msub id="A1.Ex21.m1.1.1.1.3" xref="A1.Ex21.m1.1.1.1.3.cmml"><mi id="A1.Ex21.m1.1.1.1.3.2" xref="A1.Ex21.m1.1.1.1.3.2.cmml">π</mi><mi id="A1.Ex21.m1.1.1.1.3.3" xref="A1.Ex21.m1.1.1.1.3.3.cmml">r</mi></msub><mo id="A1.Ex21.m1.1.1.1.2" xref="A1.Ex21.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex21.m1.1.1.1.1.1" xref="A1.Ex21.m1.1.1.1.1.1.1.cmml"><mo id="A1.Ex21.m1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex21.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex21.m1.1.1.1.1.1.1" xref="A1.Ex21.m1.1.1.1.1.1.1.cmml"><mi id="A1.Ex21.m1.1.1.1.1.1.1.2" xref="A1.Ex21.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex21.m1.1.1.1.1.1.1.1" xref="A1.Ex21.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex21.m1.1.1.1.1.1.1.3" xref="A1.Ex21.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex21.m1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex21.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex21.m1.2.2.2" xref="A1.Ex21.m1.2.2.2.cmml"><msub id="A1.Ex21.m1.2.2.2.3" xref="A1.Ex21.m1.2.2.2.3.cmml"><mi id="A1.Ex21.m1.2.2.2.3.2" xref="A1.Ex21.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex21.m1.2.2.2.3.3" xref="A1.Ex21.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex21.m1.2.2.2.2" xref="A1.Ex21.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex21.m1.2.2.2.1.1" xref="A1.Ex21.m1.2.2.2.1.1.1.cmml"><mo id="A1.Ex21.m1.2.2.2.1.1.2" stretchy="false" xref="A1.Ex21.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex21.m1.2.2.2.1.1.1" xref="A1.Ex21.m1.2.2.2.1.1.1.cmml"><mi id="A1.Ex21.m1.2.2.2.1.1.1.2" xref="A1.Ex21.m1.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex21.m1.2.2.2.1.1.1.1" xref="A1.Ex21.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex21.m1.2.2.2.1.1.1.3" xref="A1.Ex21.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex21.m1.2.2.2.1.1.3" stretchy="false" xref="A1.Ex21.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex21.m1.14.14.7" xref="A1.Ex21.m1.14.14.7.cmml">=</mo><mrow id="A1.Ex21.m1.14.14.8" xref="A1.Ex21.m1.14.14.8.cmml"><mi id="A1.Ex21.m1.14.14.8.2" xref="A1.Ex21.m1.14.14.8.2.cmml">β</mi><mo id="A1.Ex21.m1.14.14.8.1" lspace="0.167em" xref="A1.Ex21.m1.14.14.8.1.cmml">⁢</mo><mrow id="A1.Ex21.m1.14.14.8.3" xref="A1.Ex21.m1.14.14.8.3.cmml"><mi id="A1.Ex21.m1.14.14.8.3.1" xref="A1.Ex21.m1.14.14.8.3.1.cmml">log</mi><mo id="A1.Ex21.m1.14.14.8.3a" lspace="0.167em" xref="A1.Ex21.m1.14.14.8.3.cmml">⁡</mo><mfrac id="A1.Ex21.m1.4.4" xref="A1.Ex21.m1.4.4.cmml"><mrow id="A1.Ex21.m1.3.3.1" xref="A1.Ex21.m1.3.3.1.cmml"><msubsup id="A1.Ex21.m1.3.3.1.3" xref="A1.Ex21.m1.3.3.1.3.cmml"><mi id="A1.Ex21.m1.3.3.1.3.2.2" xref="A1.Ex21.m1.3.3.1.3.2.2.cmml">π</mi><mi id="A1.Ex21.m1.3.3.1.3.2.3" xref="A1.Ex21.m1.3.3.1.3.2.3.cmml">r</mi><mo id="A1.Ex21.m1.3.3.1.3.3" xref="A1.Ex21.m1.3.3.1.3.3.cmml">′</mo></msubsup><mo id="A1.Ex21.m1.3.3.1.2" xref="A1.Ex21.m1.3.3.1.2.cmml">⁢</mo><mrow id="A1.Ex21.m1.3.3.1.1.1" xref="A1.Ex21.m1.3.3.1.1.1.1.cmml"><mo id="A1.Ex21.m1.3.3.1.1.1.2" stretchy="false" xref="A1.Ex21.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="A1.Ex21.m1.3.3.1.1.1.1" xref="A1.Ex21.m1.3.3.1.1.1.1.cmml"><mi id="A1.Ex21.m1.3.3.1.1.1.1.2" xref="A1.Ex21.m1.3.3.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex21.m1.3.3.1.1.1.1.1" xref="A1.Ex21.m1.3.3.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex21.m1.3.3.1.1.1.1.3" xref="A1.Ex21.m1.3.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex21.m1.3.3.1.1.1.3" stretchy="false" xref="A1.Ex21.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex21.m1.4.4.2" xref="A1.Ex21.m1.4.4.2.cmml"><msub id="A1.Ex21.m1.4.4.2.3" xref="A1.Ex21.m1.4.4.2.3.cmml"><mi id="A1.Ex21.m1.4.4.2.3.2" xref="A1.Ex21.m1.4.4.2.3.2.cmml">π</mi><mtext id="A1.Ex21.m1.4.4.2.3.3" xref="A1.Ex21.m1.4.4.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex21.m1.4.4.2.2" xref="A1.Ex21.m1.4.4.2.2.cmml">⁢</mo><mrow id="A1.Ex21.m1.4.4.2.1.1" xref="A1.Ex21.m1.4.4.2.1.1.1.cmml"><mo id="A1.Ex21.m1.4.4.2.1.1.2" stretchy="false" xref="A1.Ex21.m1.4.4.2.1.1.1.cmml">(</mo><mrow id="A1.Ex21.m1.4.4.2.1.1.1" xref="A1.Ex21.m1.4.4.2.1.1.1.cmml"><mi id="A1.Ex21.m1.4.4.2.1.1.1.2" xref="A1.Ex21.m1.4.4.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex21.m1.4.4.2.1.1.1.1" xref="A1.Ex21.m1.4.4.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex21.m1.4.4.2.1.1.1.3" xref="A1.Ex21.m1.4.4.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex21.m1.4.4.2.1.1.3" stretchy="false" xref="A1.Ex21.m1.4.4.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex21.m1.14.14.9" xref="A1.Ex21.m1.14.14.9.cmml">=</mo><mrow id="A1.Ex21.m1.14.14.3" xref="A1.Ex21.m1.14.14.3.cmml"><mi id="A1.Ex21.m1.14.14.3.4" xref="A1.Ex21.m1.14.14.3.4.cmml">f</mi><mo id="A1.Ex21.m1.14.14.3.3" xref="A1.Ex21.m1.14.14.3.3.cmml">⁢</mo><mrow id="A1.Ex21.m1.14.14.3.2.2" xref="A1.Ex21.m1.14.14.3.2.3.cmml"><mo id="A1.Ex21.m1.14.14.3.2.2.3" stretchy="false" xref="A1.Ex21.m1.14.14.3.2.3.cmml">(</mo><msup id="A1.Ex21.m1.13.13.2.1.1.1" xref="A1.Ex21.m1.13.13.2.1.1.1.cmml"><mi id="A1.Ex21.m1.13.13.2.1.1.1.2" xref="A1.Ex21.m1.13.13.2.1.1.1.2.cmml">r</mi><mo id="A1.Ex21.m1.13.13.2.1.1.1.3" xref="A1.Ex21.m1.13.13.2.1.1.1.3.cmml">′</mo></msup><mo id="A1.Ex21.m1.14.14.3.2.2.4" xref="A1.Ex21.m1.14.14.3.2.3.cmml">,</mo><msub id="A1.Ex21.m1.14.14.3.2.2.2" xref="A1.Ex21.m1.14.14.3.2.2.2.cmml"><mi id="A1.Ex21.m1.14.14.3.2.2.2.2" xref="A1.Ex21.m1.14.14.3.2.2.2.2.cmml">π</mi><mtext id="A1.Ex21.m1.14.14.3.2.2.2.3" xref="A1.Ex21.m1.14.14.3.2.2.2.3a.cmml">ref</mtext></msub><mo id="A1.Ex21.m1.14.14.3.2.2.5" xref="A1.Ex21.m1.14.14.3.2.3.cmml">,</mo><mi id="A1.Ex21.m1.9.9" xref="A1.Ex21.m1.9.9.cmml">β</mi><mo id="A1.Ex21.m1.14.14.3.2.2.6" stretchy="false" xref="A1.Ex21.m1.14.14.3.2.3.cmml">)</mo></mrow><mo id="A1.Ex21.m1.14.14.3.3a" xref="A1.Ex21.m1.14.14.3.3.cmml">⁢</mo><mrow id="A1.Ex21.m1.14.14.3.5.2" xref="A1.Ex21.m1.14.14.3.5.1.cmml"><mo id="A1.Ex21.m1.14.14.3.5.2.1" stretchy="false" xref="A1.Ex21.m1.14.14.3.5.1.cmml">(</mo><mi id="A1.Ex21.m1.10.10" xref="A1.Ex21.m1.10.10.cmml">x</mi><mo id="A1.Ex21.m1.14.14.3.5.2.2" xref="A1.Ex21.m1.14.14.3.5.1.cmml">,</mo><mi id="A1.Ex21.m1.11.11" xref="A1.Ex21.m1.11.11.cmml">y</mi><mo id="A1.Ex21.m1.14.14.3.5.2.3" stretchy="false" xref="A1.Ex21.m1.14.14.3.5.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex21.m1.14b"><apply id="A1.Ex21.m1.14.14.cmml" xref="A1.Ex21.m1.14.14"><and id="A1.Ex21.m1.14.14a.cmml" xref="A1.Ex21.m1.14.14"></and><apply id="A1.Ex21.m1.14.14b.cmml" xref="A1.Ex21.m1.14.14"><eq id="A1.Ex21.m1.14.14.5.cmml" xref="A1.Ex21.m1.14.14.5"></eq><apply id="A1.Ex21.m1.12.12.1.cmml" xref="A1.Ex21.m1.12.12.1"><times id="A1.Ex21.m1.12.12.1.2.cmml" xref="A1.Ex21.m1.12.12.1.2"></times><ci id="A1.Ex21.m1.12.12.1.3.cmml" xref="A1.Ex21.m1.12.12.1.3">𝑓</ci><vector id="A1.Ex21.m1.12.12.1.1.2.cmml" xref="A1.Ex21.m1.12.12.1.1.1"><ci id="A1.Ex21.m1.5.5.cmml" xref="A1.Ex21.m1.5.5">𝑟</ci><apply id="A1.Ex21.m1.12.12.1.1.1.1.cmml" xref="A1.Ex21.m1.12.12.1.1.1.1"><csymbol cd="ambiguous" id="A1.Ex21.m1.12.12.1.1.1.1.1.cmml" xref="A1.Ex21.m1.12.12.1.1.1.1">subscript</csymbol><ci id="A1.Ex21.m1.12.12.1.1.1.1.2.cmml" xref="A1.Ex21.m1.12.12.1.1.1.1.2">𝜋</ci><ci id="A1.Ex21.m1.12.12.1.1.1.1.3a.cmml" xref="A1.Ex21.m1.12.12.1.1.1.1.3"><mtext id="A1.Ex21.m1.12.12.1.1.1.1.3.cmml" mathsize="70%" xref="A1.Ex21.m1.12.12.1.1.1.1.3">ref</mtext></ci></apply><ci id="A1.Ex21.m1.6.6.cmml" xref="A1.Ex21.m1.6.6">𝛽</ci></vector><interval closure="open" id="A1.Ex21.m1.12.12.1.4.1.cmml" xref="A1.Ex21.m1.12.12.1.4.2"><ci id="A1.Ex21.m1.7.7.cmml" xref="A1.Ex21.m1.7.7">𝑥</ci><ci id="A1.Ex21.m1.8.8.cmml" xref="A1.Ex21.m1.8.8">𝑦</ci></interval></apply><apply id="A1.Ex21.m1.14.14.6.cmml" xref="A1.Ex21.m1.14.14.6"><times id="A1.Ex21.m1.14.14.6.1.cmml" xref="A1.Ex21.m1.14.14.6.1"></times><ci id="A1.Ex21.m1.14.14.6.2.cmml" xref="A1.Ex21.m1.14.14.6.2">𝛽</ci><apply id="A1.Ex21.m1.14.14.6.3.cmml" xref="A1.Ex21.m1.14.14.6.3"><log id="A1.Ex21.m1.14.14.6.3.1.cmml" xref="A1.Ex21.m1.14.14.6.3.1"></log><apply id="A1.Ex21.m1.2.2.cmml" xref="A1.Ex21.m1.2.2"><divide id="A1.Ex21.m1.2.2.3.cmml" xref="A1.Ex21.m1.2.2"></divide><apply id="A1.Ex21.m1.1.1.1.cmml" xref="A1.Ex21.m1.1.1.1"><times id="A1.Ex21.m1.1.1.1.2.cmml" xref="A1.Ex21.m1.1.1.1.2"></times><apply id="A1.Ex21.m1.1.1.1.3.cmml" xref="A1.Ex21.m1.1.1.1.3"><csymbol cd="ambiguous" id="A1.Ex21.m1.1.1.1.3.1.cmml" xref="A1.Ex21.m1.1.1.1.3">subscript</csymbol><ci id="A1.Ex21.m1.1.1.1.3.2.cmml" xref="A1.Ex21.m1.1.1.1.3.2">𝜋</ci><ci id="A1.Ex21.m1.1.1.1.3.3.cmml" xref="A1.Ex21.m1.1.1.1.3.3">𝑟</ci></apply><apply id="A1.Ex21.m1.1.1.1.1.1.1.cmml" xref="A1.Ex21.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex21.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex21.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex21.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex21.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex21.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex21.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex21.m1.2.2.2.cmml" xref="A1.Ex21.m1.2.2.2"><times id="A1.Ex21.m1.2.2.2.2.cmml" xref="A1.Ex21.m1.2.2.2.2"></times><apply id="A1.Ex21.m1.2.2.2.3.cmml" xref="A1.Ex21.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex21.m1.2.2.2.3.1.cmml" xref="A1.Ex21.m1.2.2.2.3">subscript</csymbol><ci id="A1.Ex21.m1.2.2.2.3.2.cmml" xref="A1.Ex21.m1.2.2.2.3.2">𝜋</ci><ci id="A1.Ex21.m1.2.2.2.3.3a.cmml" xref="A1.Ex21.m1.2.2.2.3.3"><mtext id="A1.Ex21.m1.2.2.2.3.3.cmml" mathsize="70%" xref="A1.Ex21.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex21.m1.2.2.2.1.1.1.cmml" xref="A1.Ex21.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex21.m1.2.2.2.1.1.1.1.cmml" xref="A1.Ex21.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex21.m1.2.2.2.1.1.1.2.cmml" xref="A1.Ex21.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.Ex21.m1.2.2.2.1.1.1.3.cmml" xref="A1.Ex21.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.Ex21.m1.14.14c.cmml" xref="A1.Ex21.m1.14.14"><eq id="A1.Ex21.m1.14.14.7.cmml" xref="A1.Ex21.m1.14.14.7"></eq><share href="#A1.Ex21.m1.14.14.6.cmml" id="A1.Ex21.m1.14.14d.cmml" xref="A1.Ex21.m1.14.14"></share><apply id="A1.Ex21.m1.14.14.8.cmml" xref="A1.Ex21.m1.14.14.8"><times id="A1.Ex21.m1.14.14.8.1.cmml" xref="A1.Ex21.m1.14.14.8.1"></times><ci id="A1.Ex21.m1.14.14.8.2.cmml" xref="A1.Ex21.m1.14.14.8.2">𝛽</ci><apply id="A1.Ex21.m1.14.14.8.3.cmml" xref="A1.Ex21.m1.14.14.8.3"><log id="A1.Ex21.m1.14.14.8.3.1.cmml" xref="A1.Ex21.m1.14.14.8.3.1"></log><apply id="A1.Ex21.m1.4.4.cmml" xref="A1.Ex21.m1.4.4"><divide id="A1.Ex21.m1.4.4.3.cmml" xref="A1.Ex21.m1.4.4"></divide><apply id="A1.Ex21.m1.3.3.1.cmml" xref="A1.Ex21.m1.3.3.1"><times id="A1.Ex21.m1.3.3.1.2.cmml" xref="A1.Ex21.m1.3.3.1.2"></times><apply id="A1.Ex21.m1.3.3.1.3.cmml" xref="A1.Ex21.m1.3.3.1.3"><csymbol cd="ambiguous" id="A1.Ex21.m1.3.3.1.3.1.cmml" xref="A1.Ex21.m1.3.3.1.3">superscript</csymbol><apply id="A1.Ex21.m1.3.3.1.3.2.cmml" xref="A1.Ex21.m1.3.3.1.3"><csymbol cd="ambiguous" id="A1.Ex21.m1.3.3.1.3.2.1.cmml" xref="A1.Ex21.m1.3.3.1.3">subscript</csymbol><ci id="A1.Ex21.m1.3.3.1.3.2.2.cmml" xref="A1.Ex21.m1.3.3.1.3.2.2">𝜋</ci><ci id="A1.Ex21.m1.3.3.1.3.2.3.cmml" xref="A1.Ex21.m1.3.3.1.3.2.3">𝑟</ci></apply><ci id="A1.Ex21.m1.3.3.1.3.3.cmml" xref="A1.Ex21.m1.3.3.1.3.3">′</ci></apply><apply id="A1.Ex21.m1.3.3.1.1.1.1.cmml" xref="A1.Ex21.m1.3.3.1.1.1"><csymbol cd="latexml" id="A1.Ex21.m1.3.3.1.1.1.1.1.cmml" xref="A1.Ex21.m1.3.3.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex21.m1.3.3.1.1.1.1.2.cmml" xref="A1.Ex21.m1.3.3.1.1.1.1.2">𝑦</ci><ci id="A1.Ex21.m1.3.3.1.1.1.1.3.cmml" xref="A1.Ex21.m1.3.3.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex21.m1.4.4.2.cmml" xref="A1.Ex21.m1.4.4.2"><times id="A1.Ex21.m1.4.4.2.2.cmml" xref="A1.Ex21.m1.4.4.2.2"></times><apply id="A1.Ex21.m1.4.4.2.3.cmml" xref="A1.Ex21.m1.4.4.2.3"><csymbol cd="ambiguous" id="A1.Ex21.m1.4.4.2.3.1.cmml" xref="A1.Ex21.m1.4.4.2.3">subscript</csymbol><ci id="A1.Ex21.m1.4.4.2.3.2.cmml" xref="A1.Ex21.m1.4.4.2.3.2">𝜋</ci><ci id="A1.Ex21.m1.4.4.2.3.3a.cmml" xref="A1.Ex21.m1.4.4.2.3.3"><mtext id="A1.Ex21.m1.4.4.2.3.3.cmml" mathsize="70%" xref="A1.Ex21.m1.4.4.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex21.m1.4.4.2.1.1.1.cmml" xref="A1.Ex21.m1.4.4.2.1.1"><csymbol cd="latexml" id="A1.Ex21.m1.4.4.2.1.1.1.1.cmml" xref="A1.Ex21.m1.4.4.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex21.m1.4.4.2.1.1.1.2.cmml" xref="A1.Ex21.m1.4.4.2.1.1.1.2">𝑦</ci><ci id="A1.Ex21.m1.4.4.2.1.1.1.3.cmml" xref="A1.Ex21.m1.4.4.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.Ex21.m1.14.14e.cmml" xref="A1.Ex21.m1.14.14"><eq id="A1.Ex21.m1.14.14.9.cmml" xref="A1.Ex21.m1.14.14.9"></eq><share href="#A1.Ex21.m1.14.14.8.cmml" id="A1.Ex21.m1.14.14f.cmml" xref="A1.Ex21.m1.14.14"></share><apply id="A1.Ex21.m1.14.14.3.cmml" xref="A1.Ex21.m1.14.14.3"><times id="A1.Ex21.m1.14.14.3.3.cmml" xref="A1.Ex21.m1.14.14.3.3"></times><ci id="A1.Ex21.m1.14.14.3.4.cmml" xref="A1.Ex21.m1.14.14.3.4">𝑓</ci><vector id="A1.Ex21.m1.14.14.3.2.3.cmml" xref="A1.Ex21.m1.14.14.3.2.2"><apply id="A1.Ex21.m1.13.13.2.1.1.1.cmml" xref="A1.Ex21.m1.13.13.2.1.1.1"><csymbol cd="ambiguous" id="A1.Ex21.m1.13.13.2.1.1.1.1.cmml" xref="A1.Ex21.m1.13.13.2.1.1.1">superscript</csymbol><ci id="A1.Ex21.m1.13.13.2.1.1.1.2.cmml" xref="A1.Ex21.m1.13.13.2.1.1.1.2">𝑟</ci><ci id="A1.Ex21.m1.13.13.2.1.1.1.3.cmml" xref="A1.Ex21.m1.13.13.2.1.1.1.3">′</ci></apply><apply id="A1.Ex21.m1.14.14.3.2.2.2.cmml" xref="A1.Ex21.m1.14.14.3.2.2.2"><csymbol cd="ambiguous" id="A1.Ex21.m1.14.14.3.2.2.2.1.cmml" xref="A1.Ex21.m1.14.14.3.2.2.2">subscript</csymbol><ci id="A1.Ex21.m1.14.14.3.2.2.2.2.cmml" xref="A1.Ex21.m1.14.14.3.2.2.2.2">𝜋</ci><ci id="A1.Ex21.m1.14.14.3.2.2.2.3a.cmml" xref="A1.Ex21.m1.14.14.3.2.2.2.3"><mtext id="A1.Ex21.m1.14.14.3.2.2.2.3.cmml" mathsize="70%" xref="A1.Ex21.m1.14.14.3.2.2.2.3">ref</mtext></ci></apply><ci id="A1.Ex21.m1.9.9.cmml" xref="A1.Ex21.m1.9.9">𝛽</ci></vector><interval closure="open" id="A1.Ex21.m1.14.14.3.5.1.cmml" xref="A1.Ex21.m1.14.14.3.5.2"><ci id="A1.Ex21.m1.10.10.cmml" xref="A1.Ex21.m1.10.10">𝑥</ci><ci id="A1.Ex21.m1.11.11.cmml" xref="A1.Ex21.m1.11.11">𝑦</ci></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex21.m1.14c">f(r,\pi_{\text{ref}},\beta)(x,y)=\beta\log\frac{\pi_{r}(y|x)}{\pi_{\text{ref}}%
(y|x)}=\beta\log\frac{\pi_{r}^{\prime}(y|x)}{\pi_{\text{ref}}(y|x)}=f(r^{%
\prime},\pi_{\text{ref}},\beta)(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.Ex21.m1.14d">italic_f ( italic_r , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG = italic_β roman_log divide start_ARG italic_π start_POSTSUBSCRIPT italic_r end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG = italic_f ( italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β ) ( italic_x , italic_y )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS6.p3.3">where the second equality follows from Lemma <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmlemma2" title="Lemma 2. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">2</span></a>. We have proven that the operator <math alttext="f" class="ltx_Math" display="inline" id="A1.SS6.p3.3.m1.1"><semantics id="A1.SS6.p3.3.m1.1a"><mi id="A1.SS6.p3.3.m1.1.1" xref="A1.SS6.p3.3.m1.1.1.cmml">f</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.p3.3.m1.1b"><ci id="A1.SS6.p3.3.m1.1.1.cmml" xref="A1.SS6.p3.3.m1.1.1">𝑓</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p3.3.m1.1c">f</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p3.3.m1.1d">italic_f</annotation></semantics></math> maps all reward functions from a particular equivalence class to the same reward function. Next, we show that for every equivalence class of reward functions, the reward function that has the reparameterization outlined in Theorem <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmtheorem1" title="Theorem 1. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a> is unique.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<div class="ltx_theorem ltx_theorem_proposition" id="Thmproposition1">
<h6 class="ltx_title ltx_runin ltx_title_theorem">
<span class="ltx_tag ltx_tag_theorem"><span class="ltx_text ltx_font_bold" id="Thmproposition1.1.1.1">Proposition 1</span></span><span class="ltx_text ltx_font_bold" id="Thmproposition1.2.2">.</span>
</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="Thmproposition1.p1">
<p class="ltx_p" id="Thmproposition1.p1.7"><span class="ltx_text ltx_font_italic" id="Thmproposition1.p1.7.7">Assume, we have a reference model, such that <math alttext="\pi_{\text{ref}}(y|x)>0" class="ltx_Math" display="inline" id="Thmproposition1.p1.1.1.m1.1"><semantics id="Thmproposition1.p1.1.1.m1.1a"><mrow id="Thmproposition1.p1.1.1.m1.1.1" xref="Thmproposition1.p1.1.1.m1.1.1.cmml"><mrow id="Thmproposition1.p1.1.1.m1.1.1.1" xref="Thmproposition1.p1.1.1.m1.1.1.1.cmml"><msub id="Thmproposition1.p1.1.1.m1.1.1.1.3" xref="Thmproposition1.p1.1.1.m1.1.1.1.3.cmml"><mi id="Thmproposition1.p1.1.1.m1.1.1.1.3.2" xref="Thmproposition1.p1.1.1.m1.1.1.1.3.2.cmml">π</mi><mtext id="Thmproposition1.p1.1.1.m1.1.1.1.3.3" xref="Thmproposition1.p1.1.1.m1.1.1.1.3.3a.cmml">𝑟𝑒𝑓</mtext></msub><mo id="Thmproposition1.p1.1.1.m1.1.1.1.2" mathvariant="italic" xref="Thmproposition1.p1.1.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="Thmproposition1.p1.1.1.m1.1.1.1.1.1" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.cmml"><mo id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.cmml"><mi id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.2" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.1" mathvariant="normal" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.3" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="Thmproposition1.p1.1.1.m1.1.1.2" mathvariant="normal" xref="Thmproposition1.p1.1.1.m1.1.1.2.cmml">&gt;</mo><mn id="Thmproposition1.p1.1.1.m1.1.1.3" mathvariant="normal" xref="Thmproposition1.p1.1.1.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.1.1.m1.1b"><apply id="Thmproposition1.p1.1.1.m1.1.1.cmml" xref="Thmproposition1.p1.1.1.m1.1.1"><gt id="Thmproposition1.p1.1.1.m1.1.1.2.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.2"></gt><apply id="Thmproposition1.p1.1.1.m1.1.1.1.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1"><times id="Thmproposition1.p1.1.1.m1.1.1.1.2.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.2"></times><apply id="Thmproposition1.p1.1.1.m1.1.1.1.3.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.3"><csymbol cd="ambiguous" id="Thmproposition1.p1.1.1.m1.1.1.1.3.1.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.3">subscript</csymbol><ci id="Thmproposition1.p1.1.1.m1.1.1.1.3.2.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.3.2">𝜋</ci><ci id="Thmproposition1.p1.1.1.m1.1.1.1.3.3a.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.3.3"><mtext id="Thmproposition1.p1.1.1.m1.1.1.1.3.3.cmml" mathsize="70%" xref="Thmproposition1.p1.1.1.m1.1.1.1.3.3">𝑟𝑒𝑓</mtext></ci></apply><apply id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.1.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.2.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.3.cmml" xref="Thmproposition1.p1.1.1.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><cn id="Thmproposition1.p1.1.1.m1.1.1.3.cmml" type="integer" xref="Thmproposition1.p1.1.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.1.1.m1.1c">\pi_{\text{ref}}(y|x)&gt;0</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.1.1.m1.1d">italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) &gt; 0</annotation></semantics></math> for all pairs of prompts <math alttext="x" class="ltx_Math" display="inline" id="Thmproposition1.p1.2.2.m2.1"><semantics id="Thmproposition1.p1.2.2.m2.1a"><mi id="Thmproposition1.p1.2.2.m2.1.1" xref="Thmproposition1.p1.2.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.2.2.m2.1b"><ci id="Thmproposition1.p1.2.2.m2.1.1.cmml" xref="Thmproposition1.p1.2.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.2.2.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.2.2.m2.1d">italic_x</annotation></semantics></math> and answers <math alttext="y" class="ltx_Math" display="inline" id="Thmproposition1.p1.3.3.m3.1"><semantics id="Thmproposition1.p1.3.3.m3.1a"><mi id="Thmproposition1.p1.3.3.m3.1.1" xref="Thmproposition1.p1.3.3.m3.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.3.3.m3.1b"><ci id="Thmproposition1.p1.3.3.m3.1.1.cmml" xref="Thmproposition1.p1.3.3.m3.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.3.3.m3.1c">y</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.3.3.m3.1d">italic_y</annotation></semantics></math> and a parameter <math alttext="\beta>0" class="ltx_Math" display="inline" id="Thmproposition1.p1.4.4.m4.1"><semantics id="Thmproposition1.p1.4.4.m4.1a"><mrow id="Thmproposition1.p1.4.4.m4.1.1" xref="Thmproposition1.p1.4.4.m4.1.1.cmml"><mi id="Thmproposition1.p1.4.4.m4.1.1.2" xref="Thmproposition1.p1.4.4.m4.1.1.2.cmml">β</mi><mo id="Thmproposition1.p1.4.4.m4.1.1.1" mathvariant="normal" xref="Thmproposition1.p1.4.4.m4.1.1.1.cmml">&gt;</mo><mn id="Thmproposition1.p1.4.4.m4.1.1.3" mathvariant="normal" xref="Thmproposition1.p1.4.4.m4.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.4.4.m4.1b"><apply id="Thmproposition1.p1.4.4.m4.1.1.cmml" xref="Thmproposition1.p1.4.4.m4.1.1"><gt id="Thmproposition1.p1.4.4.m4.1.1.1.cmml" xref="Thmproposition1.p1.4.4.m4.1.1.1"></gt><ci id="Thmproposition1.p1.4.4.m4.1.1.2.cmml" xref="Thmproposition1.p1.4.4.m4.1.1.2">𝛽</ci><cn id="Thmproposition1.p1.4.4.m4.1.1.3.cmml" type="integer" xref="Thmproposition1.p1.4.4.m4.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.4.4.m4.1c">\beta&gt;0</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.4.4.m4.1d">italic_β &gt; 0</annotation></semantics></math>. Then every equivalence class of reward functions, as defined in Section <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#S5" title="5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a>, has a unique reward function <math alttext="r(x,y)" class="ltx_Math" display="inline" id="Thmproposition1.p1.5.5.m5.2"><semantics id="Thmproposition1.p1.5.5.m5.2a"><mrow id="Thmproposition1.p1.5.5.m5.2.3" xref="Thmproposition1.p1.5.5.m5.2.3.cmml"><mi id="Thmproposition1.p1.5.5.m5.2.3.2" xref="Thmproposition1.p1.5.5.m5.2.3.2.cmml">r</mi><mo id="Thmproposition1.p1.5.5.m5.2.3.1" mathvariant="italic" xref="Thmproposition1.p1.5.5.m5.2.3.1.cmml">⁢</mo><mrow id="Thmproposition1.p1.5.5.m5.2.3.3.2" xref="Thmproposition1.p1.5.5.m5.2.3.3.1.cmml"><mo id="Thmproposition1.p1.5.5.m5.2.3.3.2.1" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.5.5.m5.2.3.3.1.cmml">(</mo><mi id="Thmproposition1.p1.5.5.m5.1.1" xref="Thmproposition1.p1.5.5.m5.1.1.cmml">x</mi><mo id="Thmproposition1.p1.5.5.m5.2.3.3.2.2" mathvariant="normal" xref="Thmproposition1.p1.5.5.m5.2.3.3.1.cmml">,</mo><mi id="Thmproposition1.p1.5.5.m5.2.2" xref="Thmproposition1.p1.5.5.m5.2.2.cmml">y</mi><mo id="Thmproposition1.p1.5.5.m5.2.3.3.2.3" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.5.5.m5.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.5.5.m5.2b"><apply id="Thmproposition1.p1.5.5.m5.2.3.cmml" xref="Thmproposition1.p1.5.5.m5.2.3"><times id="Thmproposition1.p1.5.5.m5.2.3.1.cmml" xref="Thmproposition1.p1.5.5.m5.2.3.1"></times><ci id="Thmproposition1.p1.5.5.m5.2.3.2.cmml" xref="Thmproposition1.p1.5.5.m5.2.3.2">𝑟</ci><interval closure="open" id="Thmproposition1.p1.5.5.m5.2.3.3.1.cmml" xref="Thmproposition1.p1.5.5.m5.2.3.3.2"><ci id="Thmproposition1.p1.5.5.m5.1.1.cmml" xref="Thmproposition1.p1.5.5.m5.1.1">𝑥</ci><ci id="Thmproposition1.p1.5.5.m5.2.2.cmml" xref="Thmproposition1.p1.5.5.m5.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.5.5.m5.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.5.5.m5.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math>, which can be reparameterized as <math alttext="r(x,y)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}" class="ltx_Math" display="inline" id="Thmproposition1.p1.6.6.m6.4"><semantics id="Thmproposition1.p1.6.6.m6.4a"><mrow id="Thmproposition1.p1.6.6.m6.4.5" xref="Thmproposition1.p1.6.6.m6.4.5.cmml"><mrow id="Thmproposition1.p1.6.6.m6.4.5.2" xref="Thmproposition1.p1.6.6.m6.4.5.2.cmml"><mi id="Thmproposition1.p1.6.6.m6.4.5.2.2" xref="Thmproposition1.p1.6.6.m6.4.5.2.2.cmml">r</mi><mo id="Thmproposition1.p1.6.6.m6.4.5.2.1" mathvariant="italic" xref="Thmproposition1.p1.6.6.m6.4.5.2.1.cmml">⁢</mo><mrow id="Thmproposition1.p1.6.6.m6.4.5.2.3.2" xref="Thmproposition1.p1.6.6.m6.4.5.2.3.1.cmml"><mo id="Thmproposition1.p1.6.6.m6.4.5.2.3.2.1" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.6.6.m6.4.5.2.3.1.cmml">(</mo><mi id="Thmproposition1.p1.6.6.m6.3.3" xref="Thmproposition1.p1.6.6.m6.3.3.cmml">x</mi><mo id="Thmproposition1.p1.6.6.m6.4.5.2.3.2.2" mathvariant="normal" xref="Thmproposition1.p1.6.6.m6.4.5.2.3.1.cmml">,</mo><mi id="Thmproposition1.p1.6.6.m6.4.4" xref="Thmproposition1.p1.6.6.m6.4.4.cmml">y</mi><mo id="Thmproposition1.p1.6.6.m6.4.5.2.3.2.3" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.6.6.m6.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="Thmproposition1.p1.6.6.m6.4.5.1" mathvariant="normal" xref="Thmproposition1.p1.6.6.m6.4.5.1.cmml">=</mo><mrow id="Thmproposition1.p1.6.6.m6.4.5.3" xref="Thmproposition1.p1.6.6.m6.4.5.3.cmml"><mi id="Thmproposition1.p1.6.6.m6.4.5.3.2" xref="Thmproposition1.p1.6.6.m6.4.5.3.2.cmml">β</mi><mo id="Thmproposition1.p1.6.6.m6.4.5.3.1" lspace="0.167em" mathvariant="italic" xref="Thmproposition1.p1.6.6.m6.4.5.3.1.cmml">⁢</mo><mrow id="Thmproposition1.p1.6.6.m6.4.5.3.3" xref="Thmproposition1.p1.6.6.m6.4.5.3.3.cmml"><mi id="Thmproposition1.p1.6.6.m6.4.5.3.3.1" mathvariant="normal" xref="Thmproposition1.p1.6.6.m6.4.5.3.3.1.cmml">log</mi><mo id="Thmproposition1.p1.6.6.m6.4.5.3.3a" lspace="0.167em" mathvariant="italic" xref="Thmproposition1.p1.6.6.m6.4.5.3.3.cmml">⁡</mo><mfrac id="Thmproposition1.p1.6.6.m6.2.2" xref="Thmproposition1.p1.6.6.m6.2.2.cmml"><mrow id="Thmproposition1.p1.6.6.m6.1.1.1" xref="Thmproposition1.p1.6.6.m6.1.1.1.cmml"><mi id="Thmproposition1.p1.6.6.m6.1.1.1.3" xref="Thmproposition1.p1.6.6.m6.1.1.1.3.cmml">π</mi><mo id="Thmproposition1.p1.6.6.m6.1.1.1.2" mathvariant="italic" xref="Thmproposition1.p1.6.6.m6.1.1.1.2.cmml">⁢</mo><mrow id="Thmproposition1.p1.6.6.m6.1.1.1.1.1" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.cmml"><mo id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.cmml">(</mo><mrow id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.cmml"><mi id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.2" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.1" mathvariant="normal" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.1.cmml">|</mo><mi id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.3" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="Thmproposition1.p1.6.6.m6.2.2.2" xref="Thmproposition1.p1.6.6.m6.2.2.2.cmml"><msub id="Thmproposition1.p1.6.6.m6.2.2.2.3" xref="Thmproposition1.p1.6.6.m6.2.2.2.3.cmml"><mi id="Thmproposition1.p1.6.6.m6.2.2.2.3.2" xref="Thmproposition1.p1.6.6.m6.2.2.2.3.2.cmml">π</mi><mtext id="Thmproposition1.p1.6.6.m6.2.2.2.3.3" xref="Thmproposition1.p1.6.6.m6.2.2.2.3.3a.cmml">𝑟𝑒𝑓</mtext></msub><mo id="Thmproposition1.p1.6.6.m6.2.2.2.2" mathvariant="italic" xref="Thmproposition1.p1.6.6.m6.2.2.2.2.cmml">⁢</mo><mrow id="Thmproposition1.p1.6.6.m6.2.2.2.1.1" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.cmml"><mo id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.2" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.cmml">(</mo><mrow id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.cmml"><mi id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.2" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.1" mathvariant="normal" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.1.cmml">|</mo><mi id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.3" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.3" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.6.6.m6.4b"><apply id="Thmproposition1.p1.6.6.m6.4.5.cmml" xref="Thmproposition1.p1.6.6.m6.4.5"><eq id="Thmproposition1.p1.6.6.m6.4.5.1.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.1"></eq><apply id="Thmproposition1.p1.6.6.m6.4.5.2.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.2"><times id="Thmproposition1.p1.6.6.m6.4.5.2.1.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.2.1"></times><ci id="Thmproposition1.p1.6.6.m6.4.5.2.2.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.2.2">𝑟</ci><interval closure="open" id="Thmproposition1.p1.6.6.m6.4.5.2.3.1.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.2.3.2"><ci id="Thmproposition1.p1.6.6.m6.3.3.cmml" xref="Thmproposition1.p1.6.6.m6.3.3">𝑥</ci><ci id="Thmproposition1.p1.6.6.m6.4.4.cmml" xref="Thmproposition1.p1.6.6.m6.4.4">𝑦</ci></interval></apply><apply id="Thmproposition1.p1.6.6.m6.4.5.3.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.3"><times id="Thmproposition1.p1.6.6.m6.4.5.3.1.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.3.1"></times><ci id="Thmproposition1.p1.6.6.m6.4.5.3.2.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.3.2">𝛽</ci><apply id="Thmproposition1.p1.6.6.m6.4.5.3.3.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.3.3"><log id="Thmproposition1.p1.6.6.m6.4.5.3.3.1.cmml" xref="Thmproposition1.p1.6.6.m6.4.5.3.3.1"></log><apply id="Thmproposition1.p1.6.6.m6.2.2.cmml" xref="Thmproposition1.p1.6.6.m6.2.2"><divide id="Thmproposition1.p1.6.6.m6.2.2.3.cmml" xref="Thmproposition1.p1.6.6.m6.2.2"></divide><apply id="Thmproposition1.p1.6.6.m6.1.1.1.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1"><times id="Thmproposition1.p1.6.6.m6.1.1.1.2.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1.2"></times><ci id="Thmproposition1.p1.6.6.m6.1.1.1.3.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1.3">𝜋</ci><apply id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1"><csymbol cd="latexml" id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.1.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.1">conditional</csymbol><ci id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.2.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.2">𝑦</ci><ci id="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.3.cmml" xref="Thmproposition1.p1.6.6.m6.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="Thmproposition1.p1.6.6.m6.2.2.2.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2"><times id="Thmproposition1.p1.6.6.m6.2.2.2.2.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.2"></times><apply id="Thmproposition1.p1.6.6.m6.2.2.2.3.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.3"><csymbol cd="ambiguous" id="Thmproposition1.p1.6.6.m6.2.2.2.3.1.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.3">subscript</csymbol><ci id="Thmproposition1.p1.6.6.m6.2.2.2.3.2.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.3.2">𝜋</ci><ci id="Thmproposition1.p1.6.6.m6.2.2.2.3.3a.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.3.3"><mtext id="Thmproposition1.p1.6.6.m6.2.2.2.3.3.cmml" mathsize="50%" xref="Thmproposition1.p1.6.6.m6.2.2.2.3.3">𝑟𝑒𝑓</mtext></ci></apply><apply id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1"><csymbol cd="latexml" id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.1.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.1">conditional</csymbol><ci id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.2.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.2">𝑦</ci><ci id="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.3.cmml" xref="Thmproposition1.p1.6.6.m6.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.6.6.m6.4c">r(x,y)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.6.6.m6.4d">italic_r ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG</annotation></semantics></math> for some model <math alttext="\pi(y|x)" class="ltx_Math" display="inline" id="Thmproposition1.p1.7.7.m7.1"><semantics id="Thmproposition1.p1.7.7.m7.1a"><mrow id="Thmproposition1.p1.7.7.m7.1.1" xref="Thmproposition1.p1.7.7.m7.1.1.cmml"><mi id="Thmproposition1.p1.7.7.m7.1.1.3" xref="Thmproposition1.p1.7.7.m7.1.1.3.cmml">π</mi><mo id="Thmproposition1.p1.7.7.m7.1.1.2" mathvariant="italic" xref="Thmproposition1.p1.7.7.m7.1.1.2.cmml">⁢</mo><mrow id="Thmproposition1.p1.7.7.m7.1.1.1.1" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.cmml"><mo id="Thmproposition1.p1.7.7.m7.1.1.1.1.2" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.cmml">(</mo><mrow id="Thmproposition1.p1.7.7.m7.1.1.1.1.1" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.cmml"><mi id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.2" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.1" mathvariant="normal" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.1.cmml">|</mo><mi id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.3" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="Thmproposition1.p1.7.7.m7.1.1.1.1.3" mathvariant="normal" stretchy="false" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="Thmproposition1.p1.7.7.m7.1b"><apply id="Thmproposition1.p1.7.7.m7.1.1.cmml" xref="Thmproposition1.p1.7.7.m7.1.1"><times id="Thmproposition1.p1.7.7.m7.1.1.2.cmml" xref="Thmproposition1.p1.7.7.m7.1.1.2"></times><ci id="Thmproposition1.p1.7.7.m7.1.1.3.cmml" xref="Thmproposition1.p1.7.7.m7.1.1.3">𝜋</ci><apply id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.cmml" xref="Thmproposition1.p1.7.7.m7.1.1.1.1"><csymbol cd="latexml" id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.1.cmml" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.1">conditional</csymbol><ci id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.2.cmml" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.2">𝑦</ci><ci id="Thmproposition1.p1.7.7.m7.1.1.1.1.1.3.cmml" xref="Thmproposition1.p1.7.7.m7.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="Thmproposition1.p1.7.7.m7.1c">\pi(y|x)</annotation><annotation encoding="application/x-llamapun" id="Thmproposition1.p1.7.7.m7.1d">italic_π ( italic_y | italic_x )</annotation></semantics></math>.</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_proof" id="A1.SS6.4">
<h6 class="ltx_title ltx_runin ltx_font_italic ltx_title_proof">Proof.</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A1.SS6.3.p1">
<p class="ltx_p" id="A1.SS6.3.p1.6">We will proceed using proof by contradiction. Assume we have two reward functions from the same class, such that <math alttext="r^{\prime}(x,y)=r(x,y)+f(x)" class="ltx_Math" display="inline" id="A1.SS6.3.p1.1.m1.5"><semantics id="A1.SS6.3.p1.1.m1.5a"><mrow id="A1.SS6.3.p1.1.m1.5.6" xref="A1.SS6.3.p1.1.m1.5.6.cmml"><mrow id="A1.SS6.3.p1.1.m1.5.6.2" xref="A1.SS6.3.p1.1.m1.5.6.2.cmml"><msup id="A1.SS6.3.p1.1.m1.5.6.2.2" xref="A1.SS6.3.p1.1.m1.5.6.2.2.cmml"><mi id="A1.SS6.3.p1.1.m1.5.6.2.2.2" xref="A1.SS6.3.p1.1.m1.5.6.2.2.2.cmml">r</mi><mo id="A1.SS6.3.p1.1.m1.5.6.2.2.3" xref="A1.SS6.3.p1.1.m1.5.6.2.2.3.cmml">′</mo></msup><mo id="A1.SS6.3.p1.1.m1.5.6.2.1" xref="A1.SS6.3.p1.1.m1.5.6.2.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.1.m1.5.6.2.3.2" xref="A1.SS6.3.p1.1.m1.5.6.2.3.1.cmml"><mo id="A1.SS6.3.p1.1.m1.5.6.2.3.2.1" stretchy="false" xref="A1.SS6.3.p1.1.m1.5.6.2.3.1.cmml">(</mo><mi id="A1.SS6.3.p1.1.m1.1.1" xref="A1.SS6.3.p1.1.m1.1.1.cmml">x</mi><mo id="A1.SS6.3.p1.1.m1.5.6.2.3.2.2" xref="A1.SS6.3.p1.1.m1.5.6.2.3.1.cmml">,</mo><mi id="A1.SS6.3.p1.1.m1.2.2" xref="A1.SS6.3.p1.1.m1.2.2.cmml">y</mi><mo id="A1.SS6.3.p1.1.m1.5.6.2.3.2.3" stretchy="false" xref="A1.SS6.3.p1.1.m1.5.6.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.3.p1.1.m1.5.6.1" xref="A1.SS6.3.p1.1.m1.5.6.1.cmml">=</mo><mrow id="A1.SS6.3.p1.1.m1.5.6.3" xref="A1.SS6.3.p1.1.m1.5.6.3.cmml"><mrow id="A1.SS6.3.p1.1.m1.5.6.3.2" xref="A1.SS6.3.p1.1.m1.5.6.3.2.cmml"><mi id="A1.SS6.3.p1.1.m1.5.6.3.2.2" xref="A1.SS6.3.p1.1.m1.5.6.3.2.2.cmml">r</mi><mo id="A1.SS6.3.p1.1.m1.5.6.3.2.1" xref="A1.SS6.3.p1.1.m1.5.6.3.2.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.1.m1.5.6.3.2.3.2" xref="A1.SS6.3.p1.1.m1.5.6.3.2.3.1.cmml"><mo id="A1.SS6.3.p1.1.m1.5.6.3.2.3.2.1" stretchy="false" xref="A1.SS6.3.p1.1.m1.5.6.3.2.3.1.cmml">(</mo><mi id="A1.SS6.3.p1.1.m1.3.3" xref="A1.SS6.3.p1.1.m1.3.3.cmml">x</mi><mo id="A1.SS6.3.p1.1.m1.5.6.3.2.3.2.2" xref="A1.SS6.3.p1.1.m1.5.6.3.2.3.1.cmml">,</mo><mi id="A1.SS6.3.p1.1.m1.4.4" xref="A1.SS6.3.p1.1.m1.4.4.cmml">y</mi><mo id="A1.SS6.3.p1.1.m1.5.6.3.2.3.2.3" stretchy="false" xref="A1.SS6.3.p1.1.m1.5.6.3.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.3.p1.1.m1.5.6.3.1" xref="A1.SS6.3.p1.1.m1.5.6.3.1.cmml">+</mo><mrow id="A1.SS6.3.p1.1.m1.5.6.3.3" xref="A1.SS6.3.p1.1.m1.5.6.3.3.cmml"><mi id="A1.SS6.3.p1.1.m1.5.6.3.3.2" xref="A1.SS6.3.p1.1.m1.5.6.3.3.2.cmml">f</mi><mo id="A1.SS6.3.p1.1.m1.5.6.3.3.1" xref="A1.SS6.3.p1.1.m1.5.6.3.3.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.1.m1.5.6.3.3.3.2" xref="A1.SS6.3.p1.1.m1.5.6.3.3.cmml"><mo id="A1.SS6.3.p1.1.m1.5.6.3.3.3.2.1" stretchy="false" xref="A1.SS6.3.p1.1.m1.5.6.3.3.cmml">(</mo><mi id="A1.SS6.3.p1.1.m1.5.5" xref="A1.SS6.3.p1.1.m1.5.5.cmml">x</mi><mo id="A1.SS6.3.p1.1.m1.5.6.3.3.3.2.2" stretchy="false" xref="A1.SS6.3.p1.1.m1.5.6.3.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.3.p1.1.m1.5b"><apply id="A1.SS6.3.p1.1.m1.5.6.cmml" xref="A1.SS6.3.p1.1.m1.5.6"><eq id="A1.SS6.3.p1.1.m1.5.6.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.1"></eq><apply id="A1.SS6.3.p1.1.m1.5.6.2.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2"><times id="A1.SS6.3.p1.1.m1.5.6.2.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2.1"></times><apply id="A1.SS6.3.p1.1.m1.5.6.2.2.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2.2"><csymbol cd="ambiguous" id="A1.SS6.3.p1.1.m1.5.6.2.2.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2.2">superscript</csymbol><ci id="A1.SS6.3.p1.1.m1.5.6.2.2.2.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2.2.2">𝑟</ci><ci id="A1.SS6.3.p1.1.m1.5.6.2.2.3.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2.2.3">′</ci></apply><interval closure="open" id="A1.SS6.3.p1.1.m1.5.6.2.3.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.2.3.2"><ci id="A1.SS6.3.p1.1.m1.1.1.cmml" xref="A1.SS6.3.p1.1.m1.1.1">𝑥</ci><ci id="A1.SS6.3.p1.1.m1.2.2.cmml" xref="A1.SS6.3.p1.1.m1.2.2">𝑦</ci></interval></apply><apply id="A1.SS6.3.p1.1.m1.5.6.3.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3"><plus id="A1.SS6.3.p1.1.m1.5.6.3.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.1"></plus><apply id="A1.SS6.3.p1.1.m1.5.6.3.2.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.2"><times id="A1.SS6.3.p1.1.m1.5.6.3.2.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.2.1"></times><ci id="A1.SS6.3.p1.1.m1.5.6.3.2.2.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.2.2">𝑟</ci><interval closure="open" id="A1.SS6.3.p1.1.m1.5.6.3.2.3.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.2.3.2"><ci id="A1.SS6.3.p1.1.m1.3.3.cmml" xref="A1.SS6.3.p1.1.m1.3.3">𝑥</ci><ci id="A1.SS6.3.p1.1.m1.4.4.cmml" xref="A1.SS6.3.p1.1.m1.4.4">𝑦</ci></interval></apply><apply id="A1.SS6.3.p1.1.m1.5.6.3.3.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.3"><times id="A1.SS6.3.p1.1.m1.5.6.3.3.1.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.3.1"></times><ci id="A1.SS6.3.p1.1.m1.5.6.3.3.2.cmml" xref="A1.SS6.3.p1.1.m1.5.6.3.3.2">𝑓</ci><ci id="A1.SS6.3.p1.1.m1.5.5.cmml" xref="A1.SS6.3.p1.1.m1.5.5">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.3.p1.1.m1.5c">r^{\prime}(x,y)=r(x,y)+f(x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.3.p1.1.m1.5d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_r ( italic_x , italic_y ) + italic_f ( italic_x )</annotation></semantics></math>. Moreover, assume that <math alttext="r^{\prime}(x,y)=\beta\log\frac{\pi^{\prime}(y|x)}{\pi_{\text{ref}}(y|x)}" class="ltx_Math" display="inline" id="A1.SS6.3.p1.2.m2.4"><semantics id="A1.SS6.3.p1.2.m2.4a"><mrow id="A1.SS6.3.p1.2.m2.4.5" xref="A1.SS6.3.p1.2.m2.4.5.cmml"><mrow id="A1.SS6.3.p1.2.m2.4.5.2" xref="A1.SS6.3.p1.2.m2.4.5.2.cmml"><msup id="A1.SS6.3.p1.2.m2.4.5.2.2" xref="A1.SS6.3.p1.2.m2.4.5.2.2.cmml"><mi id="A1.SS6.3.p1.2.m2.4.5.2.2.2" xref="A1.SS6.3.p1.2.m2.4.5.2.2.2.cmml">r</mi><mo id="A1.SS6.3.p1.2.m2.4.5.2.2.3" xref="A1.SS6.3.p1.2.m2.4.5.2.2.3.cmml">′</mo></msup><mo id="A1.SS6.3.p1.2.m2.4.5.2.1" xref="A1.SS6.3.p1.2.m2.4.5.2.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.2.m2.4.5.2.3.2" xref="A1.SS6.3.p1.2.m2.4.5.2.3.1.cmml"><mo id="A1.SS6.3.p1.2.m2.4.5.2.3.2.1" stretchy="false" xref="A1.SS6.3.p1.2.m2.4.5.2.3.1.cmml">(</mo><mi id="A1.SS6.3.p1.2.m2.3.3" xref="A1.SS6.3.p1.2.m2.3.3.cmml">x</mi><mo id="A1.SS6.3.p1.2.m2.4.5.2.3.2.2" xref="A1.SS6.3.p1.2.m2.4.5.2.3.1.cmml">,</mo><mi id="A1.SS6.3.p1.2.m2.4.4" xref="A1.SS6.3.p1.2.m2.4.4.cmml">y</mi><mo id="A1.SS6.3.p1.2.m2.4.5.2.3.2.3" stretchy="false" xref="A1.SS6.3.p1.2.m2.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.3.p1.2.m2.4.5.1" xref="A1.SS6.3.p1.2.m2.4.5.1.cmml">=</mo><mrow id="A1.SS6.3.p1.2.m2.4.5.3" xref="A1.SS6.3.p1.2.m2.4.5.3.cmml"><mi id="A1.SS6.3.p1.2.m2.4.5.3.2" xref="A1.SS6.3.p1.2.m2.4.5.3.2.cmml">β</mi><mo id="A1.SS6.3.p1.2.m2.4.5.3.1" lspace="0.167em" xref="A1.SS6.3.p1.2.m2.4.5.3.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.2.m2.4.5.3.3" xref="A1.SS6.3.p1.2.m2.4.5.3.3.cmml"><mi id="A1.SS6.3.p1.2.m2.4.5.3.3.1" xref="A1.SS6.3.p1.2.m2.4.5.3.3.1.cmml">log</mi><mo id="A1.SS6.3.p1.2.m2.4.5.3.3a" lspace="0.167em" xref="A1.SS6.3.p1.2.m2.4.5.3.3.cmml">⁡</mo><mfrac id="A1.SS6.3.p1.2.m2.2.2" xref="A1.SS6.3.p1.2.m2.2.2.cmml"><mrow id="A1.SS6.3.p1.2.m2.1.1.1" xref="A1.SS6.3.p1.2.m2.1.1.1.cmml"><msup id="A1.SS6.3.p1.2.m2.1.1.1.3" xref="A1.SS6.3.p1.2.m2.1.1.1.3.cmml"><mi id="A1.SS6.3.p1.2.m2.1.1.1.3.2" xref="A1.SS6.3.p1.2.m2.1.1.1.3.2.cmml">π</mi><mo id="A1.SS6.3.p1.2.m2.1.1.1.3.3" xref="A1.SS6.3.p1.2.m2.1.1.1.3.3.cmml">′</mo></msup><mo id="A1.SS6.3.p1.2.m2.1.1.1.2" xref="A1.SS6.3.p1.2.m2.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.3.p1.2.m2.1.1.1.1.1" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.cmml"><mo id="A1.SS6.3.p1.2.m2.1.1.1.1.1.2" stretchy="false" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.cmml"><mi id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.2" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.1" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.3" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.3.p1.2.m2.1.1.1.1.1.3" stretchy="false" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS6.3.p1.2.m2.2.2.2" xref="A1.SS6.3.p1.2.m2.2.2.2.cmml"><msub id="A1.SS6.3.p1.2.m2.2.2.2.3" xref="A1.SS6.3.p1.2.m2.2.2.2.3.cmml"><mi id="A1.SS6.3.p1.2.m2.2.2.2.3.2" xref="A1.SS6.3.p1.2.m2.2.2.2.3.2.cmml">π</mi><mtext id="A1.SS6.3.p1.2.m2.2.2.2.3.3" xref="A1.SS6.3.p1.2.m2.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS6.3.p1.2.m2.2.2.2.2" xref="A1.SS6.3.p1.2.m2.2.2.2.2.cmml">⁢</mo><mrow id="A1.SS6.3.p1.2.m2.2.2.2.1.1" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.cmml"><mo id="A1.SS6.3.p1.2.m2.2.2.2.1.1.2" stretchy="false" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.cmml"><mi id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.2" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.1" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.3" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.3.p1.2.m2.2.2.2.1.1.3" stretchy="false" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.3.p1.2.m2.4b"><apply id="A1.SS6.3.p1.2.m2.4.5.cmml" xref="A1.SS6.3.p1.2.m2.4.5"><eq id="A1.SS6.3.p1.2.m2.4.5.1.cmml" xref="A1.SS6.3.p1.2.m2.4.5.1"></eq><apply id="A1.SS6.3.p1.2.m2.4.5.2.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2"><times id="A1.SS6.3.p1.2.m2.4.5.2.1.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2.1"></times><apply id="A1.SS6.3.p1.2.m2.4.5.2.2.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2.2"><csymbol cd="ambiguous" id="A1.SS6.3.p1.2.m2.4.5.2.2.1.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2.2">superscript</csymbol><ci id="A1.SS6.3.p1.2.m2.4.5.2.2.2.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2.2.2">𝑟</ci><ci id="A1.SS6.3.p1.2.m2.4.5.2.2.3.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2.2.3">′</ci></apply><interval closure="open" id="A1.SS6.3.p1.2.m2.4.5.2.3.1.cmml" xref="A1.SS6.3.p1.2.m2.4.5.2.3.2"><ci id="A1.SS6.3.p1.2.m2.3.3.cmml" xref="A1.SS6.3.p1.2.m2.3.3">𝑥</ci><ci id="A1.SS6.3.p1.2.m2.4.4.cmml" xref="A1.SS6.3.p1.2.m2.4.4">𝑦</ci></interval></apply><apply id="A1.SS6.3.p1.2.m2.4.5.3.cmml" xref="A1.SS6.3.p1.2.m2.4.5.3"><times id="A1.SS6.3.p1.2.m2.4.5.3.1.cmml" xref="A1.SS6.3.p1.2.m2.4.5.3.1"></times><ci id="A1.SS6.3.p1.2.m2.4.5.3.2.cmml" xref="A1.SS6.3.p1.2.m2.4.5.3.2">𝛽</ci><apply id="A1.SS6.3.p1.2.m2.4.5.3.3.cmml" xref="A1.SS6.3.p1.2.m2.4.5.3.3"><log id="A1.SS6.3.p1.2.m2.4.5.3.3.1.cmml" xref="A1.SS6.3.p1.2.m2.4.5.3.3.1"></log><apply id="A1.SS6.3.p1.2.m2.2.2.cmml" xref="A1.SS6.3.p1.2.m2.2.2"><divide id="A1.SS6.3.p1.2.m2.2.2.3.cmml" xref="A1.SS6.3.p1.2.m2.2.2"></divide><apply id="A1.SS6.3.p1.2.m2.1.1.1.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1"><times id="A1.SS6.3.p1.2.m2.1.1.1.2.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.2"></times><apply id="A1.SS6.3.p1.2.m2.1.1.1.3.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.3"><csymbol cd="ambiguous" id="A1.SS6.3.p1.2.m2.1.1.1.3.1.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.3">superscript</csymbol><ci id="A1.SS6.3.p1.2.m2.1.1.1.3.2.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.3.2">𝜋</ci><ci id="A1.SS6.3.p1.2.m2.1.1.1.3.3.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.3.3">′</ci></apply><apply id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.2.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.3.cmml" xref="A1.SS6.3.p1.2.m2.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS6.3.p1.2.m2.2.2.2.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2"><times id="A1.SS6.3.p1.2.m2.2.2.2.2.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.2"></times><apply id="A1.SS6.3.p1.2.m2.2.2.2.3.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.3"><csymbol cd="ambiguous" id="A1.SS6.3.p1.2.m2.2.2.2.3.1.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.3">subscript</csymbol><ci id="A1.SS6.3.p1.2.m2.2.2.2.3.2.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.3.2">𝜋</ci><ci id="A1.SS6.3.p1.2.m2.2.2.2.3.3a.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.3.3"><mtext id="A1.SS6.3.p1.2.m2.2.2.2.3.3.cmml" mathsize="50%" xref="A1.SS6.3.p1.2.m2.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1"><csymbol cd="latexml" id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.1.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.2.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.3.cmml" xref="A1.SS6.3.p1.2.m2.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.3.p1.2.m2.4c">r^{\prime}(x,y)=\beta\log\frac{\pi^{\prime}(y|x)}{\pi_{\text{ref}}(y|x)}</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.3.p1.2.m2.4d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG</annotation></semantics></math> for some model <math alttext="\pi^{\prime}(y|x)" class="ltx_Math" display="inline" id="A1.SS6.3.p1.3.m3.1"><semantics id="A1.SS6.3.p1.3.m3.1a"><mrow id="A1.SS6.3.p1.3.m3.1.1" xref="A1.SS6.3.p1.3.m3.1.1.cmml"><msup id="A1.SS6.3.p1.3.m3.1.1.3" xref="A1.SS6.3.p1.3.m3.1.1.3.cmml"><mi id="A1.SS6.3.p1.3.m3.1.1.3.2" xref="A1.SS6.3.p1.3.m3.1.1.3.2.cmml">π</mi><mo id="A1.SS6.3.p1.3.m3.1.1.3.3" xref="A1.SS6.3.p1.3.m3.1.1.3.3.cmml">′</mo></msup><mo id="A1.SS6.3.p1.3.m3.1.1.2" xref="A1.SS6.3.p1.3.m3.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.3.p1.3.m3.1.1.1.1" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.cmml"><mo id="A1.SS6.3.p1.3.m3.1.1.1.1.2" stretchy="false" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.3.p1.3.m3.1.1.1.1.1" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.cmml"><mi id="A1.SS6.3.p1.3.m3.1.1.1.1.1.2" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.3.p1.3.m3.1.1.1.1.1.1" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.3.p1.3.m3.1.1.1.1.1.3" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.3.p1.3.m3.1.1.1.1.3" stretchy="false" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.3.p1.3.m3.1b"><apply id="A1.SS6.3.p1.3.m3.1.1.cmml" xref="A1.SS6.3.p1.3.m3.1.1"><times id="A1.SS6.3.p1.3.m3.1.1.2.cmml" xref="A1.SS6.3.p1.3.m3.1.1.2"></times><apply id="A1.SS6.3.p1.3.m3.1.1.3.cmml" xref="A1.SS6.3.p1.3.m3.1.1.3"><csymbol cd="ambiguous" id="A1.SS6.3.p1.3.m3.1.1.3.1.cmml" xref="A1.SS6.3.p1.3.m3.1.1.3">superscript</csymbol><ci id="A1.SS6.3.p1.3.m3.1.1.3.2.cmml" xref="A1.SS6.3.p1.3.m3.1.1.3.2">𝜋</ci><ci id="A1.SS6.3.p1.3.m3.1.1.3.3.cmml" xref="A1.SS6.3.p1.3.m3.1.1.3.3">′</ci></apply><apply id="A1.SS6.3.p1.3.m3.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.3.m3.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.3.p1.3.m3.1.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.3.p1.3.m3.1.1.1.1.1.2.cmml" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.3.p1.3.m3.1.1.1.1.1.3.cmml" xref="A1.SS6.3.p1.3.m3.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.3.p1.3.m3.1c">\pi^{\prime}(y|x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.3.p1.3.m3.1d">italic_π start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_y | italic_x )</annotation></semantics></math> and <math alttext="r(x,y)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}" class="ltx_Math" display="inline" id="A1.SS6.3.p1.4.m4.4"><semantics id="A1.SS6.3.p1.4.m4.4a"><mrow id="A1.SS6.3.p1.4.m4.4.5" xref="A1.SS6.3.p1.4.m4.4.5.cmml"><mrow id="A1.SS6.3.p1.4.m4.4.5.2" xref="A1.SS6.3.p1.4.m4.4.5.2.cmml"><mi id="A1.SS6.3.p1.4.m4.4.5.2.2" xref="A1.SS6.3.p1.4.m4.4.5.2.2.cmml">r</mi><mo id="A1.SS6.3.p1.4.m4.4.5.2.1" xref="A1.SS6.3.p1.4.m4.4.5.2.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.4.m4.4.5.2.3.2" xref="A1.SS6.3.p1.4.m4.4.5.2.3.1.cmml"><mo id="A1.SS6.3.p1.4.m4.4.5.2.3.2.1" stretchy="false" xref="A1.SS6.3.p1.4.m4.4.5.2.3.1.cmml">(</mo><mi id="A1.SS6.3.p1.4.m4.3.3" xref="A1.SS6.3.p1.4.m4.3.3.cmml">x</mi><mo id="A1.SS6.3.p1.4.m4.4.5.2.3.2.2" xref="A1.SS6.3.p1.4.m4.4.5.2.3.1.cmml">,</mo><mi id="A1.SS6.3.p1.4.m4.4.4" xref="A1.SS6.3.p1.4.m4.4.4.cmml">y</mi><mo id="A1.SS6.3.p1.4.m4.4.5.2.3.2.3" stretchy="false" xref="A1.SS6.3.p1.4.m4.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.3.p1.4.m4.4.5.1" xref="A1.SS6.3.p1.4.m4.4.5.1.cmml">=</mo><mrow id="A1.SS6.3.p1.4.m4.4.5.3" xref="A1.SS6.3.p1.4.m4.4.5.3.cmml"><mi id="A1.SS6.3.p1.4.m4.4.5.3.2" xref="A1.SS6.3.p1.4.m4.4.5.3.2.cmml">β</mi><mo id="A1.SS6.3.p1.4.m4.4.5.3.1" lspace="0.167em" xref="A1.SS6.3.p1.4.m4.4.5.3.1.cmml">⁢</mo><mrow id="A1.SS6.3.p1.4.m4.4.5.3.3" xref="A1.SS6.3.p1.4.m4.4.5.3.3.cmml"><mi id="A1.SS6.3.p1.4.m4.4.5.3.3.1" xref="A1.SS6.3.p1.4.m4.4.5.3.3.1.cmml">log</mi><mo id="A1.SS6.3.p1.4.m4.4.5.3.3a" lspace="0.167em" xref="A1.SS6.3.p1.4.m4.4.5.3.3.cmml">⁡</mo><mfrac id="A1.SS6.3.p1.4.m4.2.2" xref="A1.SS6.3.p1.4.m4.2.2.cmml"><mrow id="A1.SS6.3.p1.4.m4.1.1.1" xref="A1.SS6.3.p1.4.m4.1.1.1.cmml"><mi id="A1.SS6.3.p1.4.m4.1.1.1.3" xref="A1.SS6.3.p1.4.m4.1.1.1.3.cmml">π</mi><mo id="A1.SS6.3.p1.4.m4.1.1.1.2" xref="A1.SS6.3.p1.4.m4.1.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.3.p1.4.m4.1.1.1.1.1" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.cmml"><mo id="A1.SS6.3.p1.4.m4.1.1.1.1.1.2" stretchy="false" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.cmml"><mi id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.2" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.1" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.3" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.3.p1.4.m4.1.1.1.1.1.3" stretchy="false" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.SS6.3.p1.4.m4.2.2.2" xref="A1.SS6.3.p1.4.m4.2.2.2.cmml"><msub id="A1.SS6.3.p1.4.m4.2.2.2.3" xref="A1.SS6.3.p1.4.m4.2.2.2.3.cmml"><mi id="A1.SS6.3.p1.4.m4.2.2.2.3.2" xref="A1.SS6.3.p1.4.m4.2.2.2.3.2.cmml">π</mi><mtext id="A1.SS6.3.p1.4.m4.2.2.2.3.3" xref="A1.SS6.3.p1.4.m4.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.SS6.3.p1.4.m4.2.2.2.2" xref="A1.SS6.3.p1.4.m4.2.2.2.2.cmml">⁢</mo><mrow id="A1.SS6.3.p1.4.m4.2.2.2.1.1" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.cmml"><mo id="A1.SS6.3.p1.4.m4.2.2.2.1.1.2" stretchy="false" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.cmml"><mi id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.2" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.1" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.3" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.3.p1.4.m4.2.2.2.1.1.3" stretchy="false" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.3.p1.4.m4.4b"><apply id="A1.SS6.3.p1.4.m4.4.5.cmml" xref="A1.SS6.3.p1.4.m4.4.5"><eq id="A1.SS6.3.p1.4.m4.4.5.1.cmml" xref="A1.SS6.3.p1.4.m4.4.5.1"></eq><apply id="A1.SS6.3.p1.4.m4.4.5.2.cmml" xref="A1.SS6.3.p1.4.m4.4.5.2"><times id="A1.SS6.3.p1.4.m4.4.5.2.1.cmml" xref="A1.SS6.3.p1.4.m4.4.5.2.1"></times><ci id="A1.SS6.3.p1.4.m4.4.5.2.2.cmml" xref="A1.SS6.3.p1.4.m4.4.5.2.2">𝑟</ci><interval closure="open" id="A1.SS6.3.p1.4.m4.4.5.2.3.1.cmml" xref="A1.SS6.3.p1.4.m4.4.5.2.3.2"><ci id="A1.SS6.3.p1.4.m4.3.3.cmml" xref="A1.SS6.3.p1.4.m4.3.3">𝑥</ci><ci id="A1.SS6.3.p1.4.m4.4.4.cmml" xref="A1.SS6.3.p1.4.m4.4.4">𝑦</ci></interval></apply><apply id="A1.SS6.3.p1.4.m4.4.5.3.cmml" xref="A1.SS6.3.p1.4.m4.4.5.3"><times id="A1.SS6.3.p1.4.m4.4.5.3.1.cmml" xref="A1.SS6.3.p1.4.m4.4.5.3.1"></times><ci id="A1.SS6.3.p1.4.m4.4.5.3.2.cmml" xref="A1.SS6.3.p1.4.m4.4.5.3.2">𝛽</ci><apply id="A1.SS6.3.p1.4.m4.4.5.3.3.cmml" xref="A1.SS6.3.p1.4.m4.4.5.3.3"><log id="A1.SS6.3.p1.4.m4.4.5.3.3.1.cmml" xref="A1.SS6.3.p1.4.m4.4.5.3.3.1"></log><apply id="A1.SS6.3.p1.4.m4.2.2.cmml" xref="A1.SS6.3.p1.4.m4.2.2"><divide id="A1.SS6.3.p1.4.m4.2.2.3.cmml" xref="A1.SS6.3.p1.4.m4.2.2"></divide><apply id="A1.SS6.3.p1.4.m4.1.1.1.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1"><times id="A1.SS6.3.p1.4.m4.1.1.1.2.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1.2"></times><ci id="A1.SS6.3.p1.4.m4.1.1.1.3.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1.3">𝜋</ci><apply id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.2.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.3.cmml" xref="A1.SS6.3.p1.4.m4.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.SS6.3.p1.4.m4.2.2.2.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2"><times id="A1.SS6.3.p1.4.m4.2.2.2.2.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.2"></times><apply id="A1.SS6.3.p1.4.m4.2.2.2.3.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.3"><csymbol cd="ambiguous" id="A1.SS6.3.p1.4.m4.2.2.2.3.1.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.3">subscript</csymbol><ci id="A1.SS6.3.p1.4.m4.2.2.2.3.2.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.3.2">𝜋</ci><ci id="A1.SS6.3.p1.4.m4.2.2.2.3.3a.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.3.3"><mtext id="A1.SS6.3.p1.4.m4.2.2.2.3.3.cmml" mathsize="50%" xref="A1.SS6.3.p1.4.m4.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1"><csymbol cd="latexml" id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.1.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.2.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.3.cmml" xref="A1.SS6.3.p1.4.m4.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.3.p1.4.m4.4c">r(x,y)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.3.p1.4.m4.4d">italic_r ( italic_x , italic_y ) = italic_β roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG</annotation></semantics></math> for some model <math alttext="\pi(y|x)" class="ltx_Math" display="inline" id="A1.SS6.3.p1.5.m5.1"><semantics id="A1.SS6.3.p1.5.m5.1a"><mrow id="A1.SS6.3.p1.5.m5.1.1" xref="A1.SS6.3.p1.5.m5.1.1.cmml"><mi id="A1.SS6.3.p1.5.m5.1.1.3" xref="A1.SS6.3.p1.5.m5.1.1.3.cmml">π</mi><mo id="A1.SS6.3.p1.5.m5.1.1.2" xref="A1.SS6.3.p1.5.m5.1.1.2.cmml">⁢</mo><mrow id="A1.SS6.3.p1.5.m5.1.1.1.1" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.cmml"><mo id="A1.SS6.3.p1.5.m5.1.1.1.1.2" stretchy="false" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.3.p1.5.m5.1.1.1.1.1" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.cmml"><mi id="A1.SS6.3.p1.5.m5.1.1.1.1.1.2" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.3.p1.5.m5.1.1.1.1.1.1" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.3.p1.5.m5.1.1.1.1.1.3" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.3.p1.5.m5.1.1.1.1.3" stretchy="false" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.3.p1.5.m5.1b"><apply id="A1.SS6.3.p1.5.m5.1.1.cmml" xref="A1.SS6.3.p1.5.m5.1.1"><times id="A1.SS6.3.p1.5.m5.1.1.2.cmml" xref="A1.SS6.3.p1.5.m5.1.1.2"></times><ci id="A1.SS6.3.p1.5.m5.1.1.3.cmml" xref="A1.SS6.3.p1.5.m5.1.1.3">𝜋</ci><apply id="A1.SS6.3.p1.5.m5.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.5.m5.1.1.1.1"><csymbol cd="latexml" id="A1.SS6.3.p1.5.m5.1.1.1.1.1.1.cmml" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.3.p1.5.m5.1.1.1.1.1.2.cmml" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.3.p1.5.m5.1.1.1.1.1.3.cmml" xref="A1.SS6.3.p1.5.m5.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.3.p1.5.m5.1c">\pi(y|x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.3.p1.5.m5.1d">italic_π ( italic_y | italic_x )</annotation></semantics></math>, such that <math alttext="\pi\neq\pi^{\prime}" class="ltx_Math" display="inline" id="A1.SS6.3.p1.6.m6.1"><semantics id="A1.SS6.3.p1.6.m6.1a"><mrow id="A1.SS6.3.p1.6.m6.1.1" xref="A1.SS6.3.p1.6.m6.1.1.cmml"><mi id="A1.SS6.3.p1.6.m6.1.1.2" xref="A1.SS6.3.p1.6.m6.1.1.2.cmml">π</mi><mo id="A1.SS6.3.p1.6.m6.1.1.1" xref="A1.SS6.3.p1.6.m6.1.1.1.cmml">≠</mo><msup id="A1.SS6.3.p1.6.m6.1.1.3" xref="A1.SS6.3.p1.6.m6.1.1.3.cmml"><mi id="A1.SS6.3.p1.6.m6.1.1.3.2" xref="A1.SS6.3.p1.6.m6.1.1.3.2.cmml">π</mi><mo id="A1.SS6.3.p1.6.m6.1.1.3.3" xref="A1.SS6.3.p1.6.m6.1.1.3.3.cmml">′</mo></msup></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.3.p1.6.m6.1b"><apply id="A1.SS6.3.p1.6.m6.1.1.cmml" xref="A1.SS6.3.p1.6.m6.1.1"><neq id="A1.SS6.3.p1.6.m6.1.1.1.cmml" xref="A1.SS6.3.p1.6.m6.1.1.1"></neq><ci id="A1.SS6.3.p1.6.m6.1.1.2.cmml" xref="A1.SS6.3.p1.6.m6.1.1.2">𝜋</ci><apply id="A1.SS6.3.p1.6.m6.1.1.3.cmml" xref="A1.SS6.3.p1.6.m6.1.1.3"><csymbol cd="ambiguous" id="A1.SS6.3.p1.6.m6.1.1.3.1.cmml" xref="A1.SS6.3.p1.6.m6.1.1.3">superscript</csymbol><ci id="A1.SS6.3.p1.6.m6.1.1.3.2.cmml" xref="A1.SS6.3.p1.6.m6.1.1.3.2">𝜋</ci><ci id="A1.SS6.3.p1.6.m6.1.1.3.3.cmml" xref="A1.SS6.3.p1.6.m6.1.1.3.3">′</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.3.p1.6.m6.1c">\pi\neq\pi^{\prime}</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.3.p1.6.m6.1d">italic_π ≠ italic_π start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>. We then have</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<table class="ltx_equation ltx_eqn_table" id="A1.Ex22">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="r^{\prime}(x,y)=r(x,y)+f(x)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}+f(%
x)=\beta\log\frac{\pi(y|x)\exp(\frac{1}{\beta}f(x))}{\pi_{\text{ref}}(y|x)}=%
\beta\log\frac{\pi^{\prime}(y|x)}{\pi_{\text{ref}}(y|x)}" class="ltx_Math" display="block" id="A1.Ex22.m1.15"><semantics id="A1.Ex22.m1.15a"><mrow id="A1.Ex22.m1.15.16" xref="A1.Ex22.m1.15.16.cmml"><mrow id="A1.Ex22.m1.15.16.2" xref="A1.Ex22.m1.15.16.2.cmml"><msup id="A1.Ex22.m1.15.16.2.2" xref="A1.Ex22.m1.15.16.2.2.cmml"><mi id="A1.Ex22.m1.15.16.2.2.2" xref="A1.Ex22.m1.15.16.2.2.2.cmml">r</mi><mo id="A1.Ex22.m1.15.16.2.2.3" xref="A1.Ex22.m1.15.16.2.2.3.cmml">′</mo></msup><mo id="A1.Ex22.m1.15.16.2.1" xref="A1.Ex22.m1.15.16.2.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.2.3.2" xref="A1.Ex22.m1.15.16.2.3.1.cmml"><mo id="A1.Ex22.m1.15.16.2.3.2.1" stretchy="false" xref="A1.Ex22.m1.15.16.2.3.1.cmml">(</mo><mi id="A1.Ex22.m1.10.10" xref="A1.Ex22.m1.10.10.cmml">x</mi><mo id="A1.Ex22.m1.15.16.2.3.2.2" xref="A1.Ex22.m1.15.16.2.3.1.cmml">,</mo><mi id="A1.Ex22.m1.11.11" xref="A1.Ex22.m1.11.11.cmml">y</mi><mo id="A1.Ex22.m1.15.16.2.3.2.3" stretchy="false" xref="A1.Ex22.m1.15.16.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex22.m1.15.16.3" xref="A1.Ex22.m1.15.16.3.cmml">=</mo><mrow id="A1.Ex22.m1.15.16.4" xref="A1.Ex22.m1.15.16.4.cmml"><mrow id="A1.Ex22.m1.15.16.4.2" xref="A1.Ex22.m1.15.16.4.2.cmml"><mi id="A1.Ex22.m1.15.16.4.2.2" xref="A1.Ex22.m1.15.16.4.2.2.cmml">r</mi><mo id="A1.Ex22.m1.15.16.4.2.1" xref="A1.Ex22.m1.15.16.4.2.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.4.2.3.2" xref="A1.Ex22.m1.15.16.4.2.3.1.cmml"><mo id="A1.Ex22.m1.15.16.4.2.3.2.1" stretchy="false" xref="A1.Ex22.m1.15.16.4.2.3.1.cmml">(</mo><mi id="A1.Ex22.m1.12.12" xref="A1.Ex22.m1.12.12.cmml">x</mi><mo id="A1.Ex22.m1.15.16.4.2.3.2.2" xref="A1.Ex22.m1.15.16.4.2.3.1.cmml">,</mo><mi id="A1.Ex22.m1.13.13" xref="A1.Ex22.m1.13.13.cmml">y</mi><mo id="A1.Ex22.m1.15.16.4.2.3.2.3" stretchy="false" xref="A1.Ex22.m1.15.16.4.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex22.m1.15.16.4.1" xref="A1.Ex22.m1.15.16.4.1.cmml">+</mo><mrow id="A1.Ex22.m1.15.16.4.3" xref="A1.Ex22.m1.15.16.4.3.cmml"><mi id="A1.Ex22.m1.15.16.4.3.2" xref="A1.Ex22.m1.15.16.4.3.2.cmml">f</mi><mo id="A1.Ex22.m1.15.16.4.3.1" xref="A1.Ex22.m1.15.16.4.3.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.4.3.3.2" xref="A1.Ex22.m1.15.16.4.3.cmml"><mo id="A1.Ex22.m1.15.16.4.3.3.2.1" stretchy="false" xref="A1.Ex22.m1.15.16.4.3.cmml">(</mo><mi id="A1.Ex22.m1.14.14" xref="A1.Ex22.m1.14.14.cmml">x</mi><mo id="A1.Ex22.m1.15.16.4.3.3.2.2" stretchy="false" xref="A1.Ex22.m1.15.16.4.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex22.m1.15.16.5" xref="A1.Ex22.m1.15.16.5.cmml">=</mo><mrow id="A1.Ex22.m1.15.16.6" xref="A1.Ex22.m1.15.16.6.cmml"><mrow id="A1.Ex22.m1.15.16.6.2" xref="A1.Ex22.m1.15.16.6.2.cmml"><mi id="A1.Ex22.m1.15.16.6.2.2" xref="A1.Ex22.m1.15.16.6.2.2.cmml">β</mi><mo id="A1.Ex22.m1.15.16.6.2.1" lspace="0.167em" xref="A1.Ex22.m1.15.16.6.2.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.6.2.3" xref="A1.Ex22.m1.15.16.6.2.3.cmml"><mi id="A1.Ex22.m1.15.16.6.2.3.1" xref="A1.Ex22.m1.15.16.6.2.3.1.cmml">log</mi><mo id="A1.Ex22.m1.15.16.6.2.3a" lspace="0.167em" xref="A1.Ex22.m1.15.16.6.2.3.cmml">⁡</mo><mfrac id="A1.Ex22.m1.2.2" xref="A1.Ex22.m1.2.2.cmml"><mrow id="A1.Ex22.m1.1.1.1" xref="A1.Ex22.m1.1.1.1.cmml"><mi id="A1.Ex22.m1.1.1.1.3" xref="A1.Ex22.m1.1.1.1.3.cmml">π</mi><mo id="A1.Ex22.m1.1.1.1.2" xref="A1.Ex22.m1.1.1.1.2.cmml">⁢</mo><mrow id="A1.Ex22.m1.1.1.1.1.1" xref="A1.Ex22.m1.1.1.1.1.1.1.cmml"><mo id="A1.Ex22.m1.1.1.1.1.1.2" stretchy="false" xref="A1.Ex22.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.Ex22.m1.1.1.1.1.1.1" xref="A1.Ex22.m1.1.1.1.1.1.1.cmml"><mi id="A1.Ex22.m1.1.1.1.1.1.1.2" xref="A1.Ex22.m1.1.1.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex22.m1.1.1.1.1.1.1.1" xref="A1.Ex22.m1.1.1.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex22.m1.1.1.1.1.1.1.3" xref="A1.Ex22.m1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex22.m1.1.1.1.1.1.3" stretchy="false" xref="A1.Ex22.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex22.m1.2.2.2" xref="A1.Ex22.m1.2.2.2.cmml"><msub id="A1.Ex22.m1.2.2.2.3" xref="A1.Ex22.m1.2.2.2.3.cmml"><mi id="A1.Ex22.m1.2.2.2.3.2" xref="A1.Ex22.m1.2.2.2.3.2.cmml">π</mi><mtext id="A1.Ex22.m1.2.2.2.3.3" xref="A1.Ex22.m1.2.2.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex22.m1.2.2.2.2" xref="A1.Ex22.m1.2.2.2.2.cmml">⁢</mo><mrow id="A1.Ex22.m1.2.2.2.1.1" xref="A1.Ex22.m1.2.2.2.1.1.1.cmml"><mo id="A1.Ex22.m1.2.2.2.1.1.2" stretchy="false" xref="A1.Ex22.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="A1.Ex22.m1.2.2.2.1.1.1" xref="A1.Ex22.m1.2.2.2.1.1.1.cmml"><mi id="A1.Ex22.m1.2.2.2.1.1.1.2" xref="A1.Ex22.m1.2.2.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex22.m1.2.2.2.1.1.1.1" xref="A1.Ex22.m1.2.2.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex22.m1.2.2.2.1.1.1.3" xref="A1.Ex22.m1.2.2.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex22.m1.2.2.2.1.1.3" stretchy="false" xref="A1.Ex22.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex22.m1.15.16.6.1" xref="A1.Ex22.m1.15.16.6.1.cmml">+</mo><mrow id="A1.Ex22.m1.15.16.6.3" xref="A1.Ex22.m1.15.16.6.3.cmml"><mi id="A1.Ex22.m1.15.16.6.3.2" xref="A1.Ex22.m1.15.16.6.3.2.cmml">f</mi><mo id="A1.Ex22.m1.15.16.6.3.1" xref="A1.Ex22.m1.15.16.6.3.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.6.3.3.2" xref="A1.Ex22.m1.15.16.6.3.cmml"><mo id="A1.Ex22.m1.15.16.6.3.3.2.1" stretchy="false" xref="A1.Ex22.m1.15.16.6.3.cmml">(</mo><mi id="A1.Ex22.m1.15.15" xref="A1.Ex22.m1.15.15.cmml">x</mi><mo id="A1.Ex22.m1.15.16.6.3.3.2.2" stretchy="false" xref="A1.Ex22.m1.15.16.6.3.cmml">)</mo></mrow></mrow></mrow><mo id="A1.Ex22.m1.15.16.7" xref="A1.Ex22.m1.15.16.7.cmml">=</mo><mrow id="A1.Ex22.m1.15.16.8" xref="A1.Ex22.m1.15.16.8.cmml"><mi id="A1.Ex22.m1.15.16.8.2" xref="A1.Ex22.m1.15.16.8.2.cmml">β</mi><mo id="A1.Ex22.m1.15.16.8.1" lspace="0.167em" xref="A1.Ex22.m1.15.16.8.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.8.3" xref="A1.Ex22.m1.15.16.8.3.cmml"><mi id="A1.Ex22.m1.15.16.8.3.1" xref="A1.Ex22.m1.15.16.8.3.1.cmml">log</mi><mo id="A1.Ex22.m1.15.16.8.3a" lspace="0.167em" xref="A1.Ex22.m1.15.16.8.3.cmml">⁡</mo><mfrac id="A1.Ex22.m1.7.7" xref="A1.Ex22.m1.7.7.cmml"><mrow id="A1.Ex22.m1.6.6.4" xref="A1.Ex22.m1.6.6.4.cmml"><mi id="A1.Ex22.m1.6.6.4.6" xref="A1.Ex22.m1.6.6.4.6.cmml">π</mi><mo id="A1.Ex22.m1.6.6.4.5" xref="A1.Ex22.m1.6.6.4.5.cmml">⁢</mo><mrow id="A1.Ex22.m1.5.5.3.3.1" xref="A1.Ex22.m1.5.5.3.3.1.1.cmml"><mo id="A1.Ex22.m1.5.5.3.3.1.2" stretchy="false" xref="A1.Ex22.m1.5.5.3.3.1.1.cmml">(</mo><mrow id="A1.Ex22.m1.5.5.3.3.1.1" xref="A1.Ex22.m1.5.5.3.3.1.1.cmml"><mi id="A1.Ex22.m1.5.5.3.3.1.1.2" xref="A1.Ex22.m1.5.5.3.3.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex22.m1.5.5.3.3.1.1.1" xref="A1.Ex22.m1.5.5.3.3.1.1.1.cmml">|</mo><mi id="A1.Ex22.m1.5.5.3.3.1.1.3" xref="A1.Ex22.m1.5.5.3.3.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex22.m1.5.5.3.3.1.3" stretchy="false" xref="A1.Ex22.m1.5.5.3.3.1.1.cmml">)</mo></mrow><mo id="A1.Ex22.m1.6.6.4.5a" lspace="0.167em" xref="A1.Ex22.m1.6.6.4.5.cmml">⁢</mo><mrow id="A1.Ex22.m1.6.6.4.4.1" xref="A1.Ex22.m1.6.6.4.4.2.cmml"><mi id="A1.Ex22.m1.4.4.2.2" xref="A1.Ex22.m1.4.4.2.2.cmml">exp</mi><mo id="A1.Ex22.m1.6.6.4.4.1a" xref="A1.Ex22.m1.6.6.4.4.2.cmml">⁡</mo><mrow id="A1.Ex22.m1.6.6.4.4.1.1" xref="A1.Ex22.m1.6.6.4.4.2.cmml"><mo id="A1.Ex22.m1.6.6.4.4.1.1.2" stretchy="false" xref="A1.Ex22.m1.6.6.4.4.2.cmml">(</mo><mrow id="A1.Ex22.m1.6.6.4.4.1.1.1" xref="A1.Ex22.m1.6.6.4.4.1.1.1.cmml"><mfrac id="A1.Ex22.m1.6.6.4.4.1.1.1.2" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2.cmml"><mn id="A1.Ex22.m1.6.6.4.4.1.1.1.2.2" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2.2.cmml">1</mn><mi id="A1.Ex22.m1.6.6.4.4.1.1.1.2.3" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.Ex22.m1.6.6.4.4.1.1.1.1" xref="A1.Ex22.m1.6.6.4.4.1.1.1.1.cmml">⁢</mo><mi id="A1.Ex22.m1.6.6.4.4.1.1.1.3" xref="A1.Ex22.m1.6.6.4.4.1.1.1.3.cmml">f</mi><mo id="A1.Ex22.m1.6.6.4.4.1.1.1.1a" xref="A1.Ex22.m1.6.6.4.4.1.1.1.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.6.6.4.4.1.1.1.4.2" xref="A1.Ex22.m1.6.6.4.4.1.1.1.cmml"><mo id="A1.Ex22.m1.6.6.4.4.1.1.1.4.2.1" stretchy="false" xref="A1.Ex22.m1.6.6.4.4.1.1.1.cmml">(</mo><mi id="A1.Ex22.m1.3.3.1.1" xref="A1.Ex22.m1.3.3.1.1.cmml">x</mi><mo id="A1.Ex22.m1.6.6.4.4.1.1.1.4.2.2" stretchy="false" xref="A1.Ex22.m1.6.6.4.4.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.Ex22.m1.6.6.4.4.1.1.3" stretchy="false" xref="A1.Ex22.m1.6.6.4.4.2.cmml">)</mo></mrow></mrow></mrow><mrow id="A1.Ex22.m1.7.7.5" xref="A1.Ex22.m1.7.7.5.cmml"><msub id="A1.Ex22.m1.7.7.5.3" xref="A1.Ex22.m1.7.7.5.3.cmml"><mi id="A1.Ex22.m1.7.7.5.3.2" xref="A1.Ex22.m1.7.7.5.3.2.cmml">π</mi><mtext id="A1.Ex22.m1.7.7.5.3.3" xref="A1.Ex22.m1.7.7.5.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex22.m1.7.7.5.2" xref="A1.Ex22.m1.7.7.5.2.cmml">⁢</mo><mrow id="A1.Ex22.m1.7.7.5.1.1" xref="A1.Ex22.m1.7.7.5.1.1.1.cmml"><mo id="A1.Ex22.m1.7.7.5.1.1.2" stretchy="false" xref="A1.Ex22.m1.7.7.5.1.1.1.cmml">(</mo><mrow id="A1.Ex22.m1.7.7.5.1.1.1" xref="A1.Ex22.m1.7.7.5.1.1.1.cmml"><mi id="A1.Ex22.m1.7.7.5.1.1.1.2" xref="A1.Ex22.m1.7.7.5.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex22.m1.7.7.5.1.1.1.1" xref="A1.Ex22.m1.7.7.5.1.1.1.1.cmml">|</mo><mi id="A1.Ex22.m1.7.7.5.1.1.1.3" xref="A1.Ex22.m1.7.7.5.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex22.m1.7.7.5.1.1.3" stretchy="false" xref="A1.Ex22.m1.7.7.5.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow><mo id="A1.Ex22.m1.15.16.9" xref="A1.Ex22.m1.15.16.9.cmml">=</mo><mrow id="A1.Ex22.m1.15.16.10" xref="A1.Ex22.m1.15.16.10.cmml"><mi id="A1.Ex22.m1.15.16.10.2" xref="A1.Ex22.m1.15.16.10.2.cmml">β</mi><mo id="A1.Ex22.m1.15.16.10.1" lspace="0.167em" xref="A1.Ex22.m1.15.16.10.1.cmml">⁢</mo><mrow id="A1.Ex22.m1.15.16.10.3" xref="A1.Ex22.m1.15.16.10.3.cmml"><mi id="A1.Ex22.m1.15.16.10.3.1" xref="A1.Ex22.m1.15.16.10.3.1.cmml">log</mi><mo id="A1.Ex22.m1.15.16.10.3a" lspace="0.167em" xref="A1.Ex22.m1.15.16.10.3.cmml">⁡</mo><mfrac id="A1.Ex22.m1.9.9" xref="A1.Ex22.m1.9.9.cmml"><mrow id="A1.Ex22.m1.8.8.1" xref="A1.Ex22.m1.8.8.1.cmml"><msup id="A1.Ex22.m1.8.8.1.3" xref="A1.Ex22.m1.8.8.1.3.cmml"><mi id="A1.Ex22.m1.8.8.1.3.2" xref="A1.Ex22.m1.8.8.1.3.2.cmml">π</mi><mo id="A1.Ex22.m1.8.8.1.3.3" xref="A1.Ex22.m1.8.8.1.3.3.cmml">′</mo></msup><mo id="A1.Ex22.m1.8.8.1.2" xref="A1.Ex22.m1.8.8.1.2.cmml">⁢</mo><mrow id="A1.Ex22.m1.8.8.1.1.1" xref="A1.Ex22.m1.8.8.1.1.1.1.cmml"><mo id="A1.Ex22.m1.8.8.1.1.1.2" stretchy="false" xref="A1.Ex22.m1.8.8.1.1.1.1.cmml">(</mo><mrow id="A1.Ex22.m1.8.8.1.1.1.1" xref="A1.Ex22.m1.8.8.1.1.1.1.cmml"><mi id="A1.Ex22.m1.8.8.1.1.1.1.2" xref="A1.Ex22.m1.8.8.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex22.m1.8.8.1.1.1.1.1" xref="A1.Ex22.m1.8.8.1.1.1.1.1.cmml">|</mo><mi id="A1.Ex22.m1.8.8.1.1.1.1.3" xref="A1.Ex22.m1.8.8.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex22.m1.8.8.1.1.1.3" stretchy="false" xref="A1.Ex22.m1.8.8.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="A1.Ex22.m1.9.9.2" xref="A1.Ex22.m1.9.9.2.cmml"><msub id="A1.Ex22.m1.9.9.2.3" xref="A1.Ex22.m1.9.9.2.3.cmml"><mi id="A1.Ex22.m1.9.9.2.3.2" xref="A1.Ex22.m1.9.9.2.3.2.cmml">π</mi><mtext id="A1.Ex22.m1.9.9.2.3.3" xref="A1.Ex22.m1.9.9.2.3.3a.cmml">ref</mtext></msub><mo id="A1.Ex22.m1.9.9.2.2" xref="A1.Ex22.m1.9.9.2.2.cmml">⁢</mo><mrow id="A1.Ex22.m1.9.9.2.1.1" xref="A1.Ex22.m1.9.9.2.1.1.1.cmml"><mo id="A1.Ex22.m1.9.9.2.1.1.2" stretchy="false" xref="A1.Ex22.m1.9.9.2.1.1.1.cmml">(</mo><mrow id="A1.Ex22.m1.9.9.2.1.1.1" xref="A1.Ex22.m1.9.9.2.1.1.1.cmml"><mi id="A1.Ex22.m1.9.9.2.1.1.1.2" xref="A1.Ex22.m1.9.9.2.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.Ex22.m1.9.9.2.1.1.1.1" xref="A1.Ex22.m1.9.9.2.1.1.1.1.cmml">|</mo><mi id="A1.Ex22.m1.9.9.2.1.1.1.3" xref="A1.Ex22.m1.9.9.2.1.1.1.3.cmml">x</mi></mrow><mo id="A1.Ex22.m1.9.9.2.1.1.3" stretchy="false" xref="A1.Ex22.m1.9.9.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.Ex22.m1.15b"><apply id="A1.Ex22.m1.15.16.cmml" xref="A1.Ex22.m1.15.16"><and id="A1.Ex22.m1.15.16a.cmml" xref="A1.Ex22.m1.15.16"></and><apply id="A1.Ex22.m1.15.16b.cmml" xref="A1.Ex22.m1.15.16"><eq id="A1.Ex22.m1.15.16.3.cmml" xref="A1.Ex22.m1.15.16.3"></eq><apply id="A1.Ex22.m1.15.16.2.cmml" xref="A1.Ex22.m1.15.16.2"><times id="A1.Ex22.m1.15.16.2.1.cmml" xref="A1.Ex22.m1.15.16.2.1"></times><apply id="A1.Ex22.m1.15.16.2.2.cmml" xref="A1.Ex22.m1.15.16.2.2"><csymbol cd="ambiguous" id="A1.Ex22.m1.15.16.2.2.1.cmml" xref="A1.Ex22.m1.15.16.2.2">superscript</csymbol><ci id="A1.Ex22.m1.15.16.2.2.2.cmml" xref="A1.Ex22.m1.15.16.2.2.2">𝑟</ci><ci id="A1.Ex22.m1.15.16.2.2.3.cmml" xref="A1.Ex22.m1.15.16.2.2.3">′</ci></apply><interval closure="open" id="A1.Ex22.m1.15.16.2.3.1.cmml" xref="A1.Ex22.m1.15.16.2.3.2"><ci id="A1.Ex22.m1.10.10.cmml" xref="A1.Ex22.m1.10.10">𝑥</ci><ci id="A1.Ex22.m1.11.11.cmml" xref="A1.Ex22.m1.11.11">𝑦</ci></interval></apply><apply id="A1.Ex22.m1.15.16.4.cmml" xref="A1.Ex22.m1.15.16.4"><plus id="A1.Ex22.m1.15.16.4.1.cmml" xref="A1.Ex22.m1.15.16.4.1"></plus><apply id="A1.Ex22.m1.15.16.4.2.cmml" xref="A1.Ex22.m1.15.16.4.2"><times id="A1.Ex22.m1.15.16.4.2.1.cmml" xref="A1.Ex22.m1.15.16.4.2.1"></times><ci id="A1.Ex22.m1.15.16.4.2.2.cmml" xref="A1.Ex22.m1.15.16.4.2.2">𝑟</ci><interval closure="open" id="A1.Ex22.m1.15.16.4.2.3.1.cmml" xref="A1.Ex22.m1.15.16.4.2.3.2"><ci id="A1.Ex22.m1.12.12.cmml" xref="A1.Ex22.m1.12.12">𝑥</ci><ci id="A1.Ex22.m1.13.13.cmml" xref="A1.Ex22.m1.13.13">𝑦</ci></interval></apply><apply id="A1.Ex22.m1.15.16.4.3.cmml" xref="A1.Ex22.m1.15.16.4.3"><times id="A1.Ex22.m1.15.16.4.3.1.cmml" xref="A1.Ex22.m1.15.16.4.3.1"></times><ci id="A1.Ex22.m1.15.16.4.3.2.cmml" xref="A1.Ex22.m1.15.16.4.3.2">𝑓</ci><ci id="A1.Ex22.m1.14.14.cmml" xref="A1.Ex22.m1.14.14">𝑥</ci></apply></apply></apply><apply id="A1.Ex22.m1.15.16c.cmml" xref="A1.Ex22.m1.15.16"><eq id="A1.Ex22.m1.15.16.5.cmml" xref="A1.Ex22.m1.15.16.5"></eq><share href="#A1.Ex22.m1.15.16.4.cmml" id="A1.Ex22.m1.15.16d.cmml" xref="A1.Ex22.m1.15.16"></share><apply id="A1.Ex22.m1.15.16.6.cmml" xref="A1.Ex22.m1.15.16.6"><plus id="A1.Ex22.m1.15.16.6.1.cmml" xref="A1.Ex22.m1.15.16.6.1"></plus><apply id="A1.Ex22.m1.15.16.6.2.cmml" xref="A1.Ex22.m1.15.16.6.2"><times id="A1.Ex22.m1.15.16.6.2.1.cmml" xref="A1.Ex22.m1.15.16.6.2.1"></times><ci id="A1.Ex22.m1.15.16.6.2.2.cmml" xref="A1.Ex22.m1.15.16.6.2.2">𝛽</ci><apply id="A1.Ex22.m1.15.16.6.2.3.cmml" xref="A1.Ex22.m1.15.16.6.2.3"><log id="A1.Ex22.m1.15.16.6.2.3.1.cmml" xref="A1.Ex22.m1.15.16.6.2.3.1"></log><apply id="A1.Ex22.m1.2.2.cmml" xref="A1.Ex22.m1.2.2"><divide id="A1.Ex22.m1.2.2.3.cmml" xref="A1.Ex22.m1.2.2"></divide><apply id="A1.Ex22.m1.1.1.1.cmml" xref="A1.Ex22.m1.1.1.1"><times id="A1.Ex22.m1.1.1.1.2.cmml" xref="A1.Ex22.m1.1.1.1.2"></times><ci id="A1.Ex22.m1.1.1.1.3.cmml" xref="A1.Ex22.m1.1.1.1.3">𝜋</ci><apply id="A1.Ex22.m1.1.1.1.1.1.1.cmml" xref="A1.Ex22.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.Ex22.m1.1.1.1.1.1.1.1.cmml" xref="A1.Ex22.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex22.m1.1.1.1.1.1.1.2.cmml" xref="A1.Ex22.m1.1.1.1.1.1.1.2">𝑦</ci><ci id="A1.Ex22.m1.1.1.1.1.1.1.3.cmml" xref="A1.Ex22.m1.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex22.m1.2.2.2.cmml" xref="A1.Ex22.m1.2.2.2"><times id="A1.Ex22.m1.2.2.2.2.cmml" xref="A1.Ex22.m1.2.2.2.2"></times><apply id="A1.Ex22.m1.2.2.2.3.cmml" xref="A1.Ex22.m1.2.2.2.3"><csymbol cd="ambiguous" id="A1.Ex22.m1.2.2.2.3.1.cmml" xref="A1.Ex22.m1.2.2.2.3">subscript</csymbol><ci id="A1.Ex22.m1.2.2.2.3.2.cmml" xref="A1.Ex22.m1.2.2.2.3.2">𝜋</ci><ci id="A1.Ex22.m1.2.2.2.3.3a.cmml" xref="A1.Ex22.m1.2.2.2.3.3"><mtext id="A1.Ex22.m1.2.2.2.3.3.cmml" mathsize="70%" xref="A1.Ex22.m1.2.2.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex22.m1.2.2.2.1.1.1.cmml" xref="A1.Ex22.m1.2.2.2.1.1"><csymbol cd="latexml" id="A1.Ex22.m1.2.2.2.1.1.1.1.cmml" xref="A1.Ex22.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex22.m1.2.2.2.1.1.1.2.cmml" xref="A1.Ex22.m1.2.2.2.1.1.1.2">𝑦</ci><ci id="A1.Ex22.m1.2.2.2.1.1.1.3.cmml" xref="A1.Ex22.m1.2.2.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply><apply id="A1.Ex22.m1.15.16.6.3.cmml" xref="A1.Ex22.m1.15.16.6.3"><times id="A1.Ex22.m1.15.16.6.3.1.cmml" xref="A1.Ex22.m1.15.16.6.3.1"></times><ci id="A1.Ex22.m1.15.16.6.3.2.cmml" xref="A1.Ex22.m1.15.16.6.3.2">𝑓</ci><ci id="A1.Ex22.m1.15.15.cmml" xref="A1.Ex22.m1.15.15">𝑥</ci></apply></apply></apply><apply id="A1.Ex22.m1.15.16e.cmml" xref="A1.Ex22.m1.15.16"><eq id="A1.Ex22.m1.15.16.7.cmml" xref="A1.Ex22.m1.15.16.7"></eq><share href="#A1.Ex22.m1.15.16.6.cmml" id="A1.Ex22.m1.15.16f.cmml" xref="A1.Ex22.m1.15.16"></share><apply id="A1.Ex22.m1.15.16.8.cmml" xref="A1.Ex22.m1.15.16.8"><times id="A1.Ex22.m1.15.16.8.1.cmml" xref="A1.Ex22.m1.15.16.8.1"></times><ci id="A1.Ex22.m1.15.16.8.2.cmml" xref="A1.Ex22.m1.15.16.8.2">𝛽</ci><apply id="A1.Ex22.m1.15.16.8.3.cmml" xref="A1.Ex22.m1.15.16.8.3"><log id="A1.Ex22.m1.15.16.8.3.1.cmml" xref="A1.Ex22.m1.15.16.8.3.1"></log><apply id="A1.Ex22.m1.7.7.cmml" xref="A1.Ex22.m1.7.7"><divide id="A1.Ex22.m1.7.7.6.cmml" xref="A1.Ex22.m1.7.7"></divide><apply id="A1.Ex22.m1.6.6.4.cmml" xref="A1.Ex22.m1.6.6.4"><times id="A1.Ex22.m1.6.6.4.5.cmml" xref="A1.Ex22.m1.6.6.4.5"></times><ci id="A1.Ex22.m1.6.6.4.6.cmml" xref="A1.Ex22.m1.6.6.4.6">𝜋</ci><apply id="A1.Ex22.m1.5.5.3.3.1.1.cmml" xref="A1.Ex22.m1.5.5.3.3.1"><csymbol cd="latexml" id="A1.Ex22.m1.5.5.3.3.1.1.1.cmml" xref="A1.Ex22.m1.5.5.3.3.1.1.1">conditional</csymbol><ci id="A1.Ex22.m1.5.5.3.3.1.1.2.cmml" xref="A1.Ex22.m1.5.5.3.3.1.1.2">𝑦</ci><ci id="A1.Ex22.m1.5.5.3.3.1.1.3.cmml" xref="A1.Ex22.m1.5.5.3.3.1.1.3">𝑥</ci></apply><apply id="A1.Ex22.m1.6.6.4.4.2.cmml" xref="A1.Ex22.m1.6.6.4.4.1"><exp id="A1.Ex22.m1.4.4.2.2.cmml" xref="A1.Ex22.m1.4.4.2.2"></exp><apply id="A1.Ex22.m1.6.6.4.4.1.1.1.cmml" xref="A1.Ex22.m1.6.6.4.4.1.1.1"><times id="A1.Ex22.m1.6.6.4.4.1.1.1.1.cmml" xref="A1.Ex22.m1.6.6.4.4.1.1.1.1"></times><apply id="A1.Ex22.m1.6.6.4.4.1.1.1.2.cmml" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2"><divide id="A1.Ex22.m1.6.6.4.4.1.1.1.2.1.cmml" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2"></divide><cn id="A1.Ex22.m1.6.6.4.4.1.1.1.2.2.cmml" type="integer" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2.2">1</cn><ci id="A1.Ex22.m1.6.6.4.4.1.1.1.2.3.cmml" xref="A1.Ex22.m1.6.6.4.4.1.1.1.2.3">𝛽</ci></apply><ci id="A1.Ex22.m1.6.6.4.4.1.1.1.3.cmml" xref="A1.Ex22.m1.6.6.4.4.1.1.1.3">𝑓</ci><ci id="A1.Ex22.m1.3.3.1.1.cmml" xref="A1.Ex22.m1.3.3.1.1">𝑥</ci></apply></apply></apply><apply id="A1.Ex22.m1.7.7.5.cmml" xref="A1.Ex22.m1.7.7.5"><times id="A1.Ex22.m1.7.7.5.2.cmml" xref="A1.Ex22.m1.7.7.5.2"></times><apply id="A1.Ex22.m1.7.7.5.3.cmml" xref="A1.Ex22.m1.7.7.5.3"><csymbol cd="ambiguous" id="A1.Ex22.m1.7.7.5.3.1.cmml" xref="A1.Ex22.m1.7.7.5.3">subscript</csymbol><ci id="A1.Ex22.m1.7.7.5.3.2.cmml" xref="A1.Ex22.m1.7.7.5.3.2">𝜋</ci><ci id="A1.Ex22.m1.7.7.5.3.3a.cmml" xref="A1.Ex22.m1.7.7.5.3.3"><mtext id="A1.Ex22.m1.7.7.5.3.3.cmml" mathsize="70%" xref="A1.Ex22.m1.7.7.5.3.3">ref</mtext></ci></apply><apply id="A1.Ex22.m1.7.7.5.1.1.1.cmml" xref="A1.Ex22.m1.7.7.5.1.1"><csymbol cd="latexml" id="A1.Ex22.m1.7.7.5.1.1.1.1.cmml" xref="A1.Ex22.m1.7.7.5.1.1.1.1">conditional</csymbol><ci id="A1.Ex22.m1.7.7.5.1.1.1.2.cmml" xref="A1.Ex22.m1.7.7.5.1.1.1.2">𝑦</ci><ci id="A1.Ex22.m1.7.7.5.1.1.1.3.cmml" xref="A1.Ex22.m1.7.7.5.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply><apply id="A1.Ex22.m1.15.16g.cmml" xref="A1.Ex22.m1.15.16"><eq id="A1.Ex22.m1.15.16.9.cmml" xref="A1.Ex22.m1.15.16.9"></eq><share href="#A1.Ex22.m1.15.16.8.cmml" id="A1.Ex22.m1.15.16h.cmml" xref="A1.Ex22.m1.15.16"></share><apply id="A1.Ex22.m1.15.16.10.cmml" xref="A1.Ex22.m1.15.16.10"><times id="A1.Ex22.m1.15.16.10.1.cmml" xref="A1.Ex22.m1.15.16.10.1"></times><ci id="A1.Ex22.m1.15.16.10.2.cmml" xref="A1.Ex22.m1.15.16.10.2">𝛽</ci><apply id="A1.Ex22.m1.15.16.10.3.cmml" xref="A1.Ex22.m1.15.16.10.3"><log id="A1.Ex22.m1.15.16.10.3.1.cmml" xref="A1.Ex22.m1.15.16.10.3.1"></log><apply id="A1.Ex22.m1.9.9.cmml" xref="A1.Ex22.m1.9.9"><divide id="A1.Ex22.m1.9.9.3.cmml" xref="A1.Ex22.m1.9.9"></divide><apply id="A1.Ex22.m1.8.8.1.cmml" xref="A1.Ex22.m1.8.8.1"><times id="A1.Ex22.m1.8.8.1.2.cmml" xref="A1.Ex22.m1.8.8.1.2"></times><apply id="A1.Ex22.m1.8.8.1.3.cmml" xref="A1.Ex22.m1.8.8.1.3"><csymbol cd="ambiguous" id="A1.Ex22.m1.8.8.1.3.1.cmml" xref="A1.Ex22.m1.8.8.1.3">superscript</csymbol><ci id="A1.Ex22.m1.8.8.1.3.2.cmml" xref="A1.Ex22.m1.8.8.1.3.2">𝜋</ci><ci id="A1.Ex22.m1.8.8.1.3.3.cmml" xref="A1.Ex22.m1.8.8.1.3.3">′</ci></apply><apply id="A1.Ex22.m1.8.8.1.1.1.1.cmml" xref="A1.Ex22.m1.8.8.1.1.1"><csymbol cd="latexml" id="A1.Ex22.m1.8.8.1.1.1.1.1.cmml" xref="A1.Ex22.m1.8.8.1.1.1.1.1">conditional</csymbol><ci id="A1.Ex22.m1.8.8.1.1.1.1.2.cmml" xref="A1.Ex22.m1.8.8.1.1.1.1.2">𝑦</ci><ci id="A1.Ex22.m1.8.8.1.1.1.1.3.cmml" xref="A1.Ex22.m1.8.8.1.1.1.1.3">𝑥</ci></apply></apply><apply id="A1.Ex22.m1.9.9.2.cmml" xref="A1.Ex22.m1.9.9.2"><times id="A1.Ex22.m1.9.9.2.2.cmml" xref="A1.Ex22.m1.9.9.2.2"></times><apply id="A1.Ex22.m1.9.9.2.3.cmml" xref="A1.Ex22.m1.9.9.2.3"><csymbol cd="ambiguous" id="A1.Ex22.m1.9.9.2.3.1.cmml" xref="A1.Ex22.m1.9.9.2.3">subscript</csymbol><ci id="A1.Ex22.m1.9.9.2.3.2.cmml" xref="A1.Ex22.m1.9.9.2.3.2">𝜋</ci><ci id="A1.Ex22.m1.9.9.2.3.3a.cmml" xref="A1.Ex22.m1.9.9.2.3.3"><mtext id="A1.Ex22.m1.9.9.2.3.3.cmml" mathsize="70%" xref="A1.Ex22.m1.9.9.2.3.3">ref</mtext></ci></apply><apply id="A1.Ex22.m1.9.9.2.1.1.1.cmml" xref="A1.Ex22.m1.9.9.2.1.1"><csymbol cd="latexml" id="A1.Ex22.m1.9.9.2.1.1.1.1.cmml" xref="A1.Ex22.m1.9.9.2.1.1.1.1">conditional</csymbol><ci id="A1.Ex22.m1.9.9.2.1.1.1.2.cmml" xref="A1.Ex22.m1.9.9.2.1.1.1.2">𝑦</ci><ci id="A1.Ex22.m1.9.9.2.1.1.1.3.cmml" xref="A1.Ex22.m1.9.9.2.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.Ex22.m1.15c">r^{\prime}(x,y)=r(x,y)+f(x)=\beta\log\frac{\pi(y|x)}{\pi_{\text{ref}}(y|x)}+f(%
x)=\beta\log\frac{\pi(y|x)\exp(\frac{1}{\beta}f(x))}{\pi_{\text{ref}}(y|x)}=%
\beta\log\frac{\pi^{\prime}(y|x)}{\pi_{\text{ref}}(y|x)}</annotation><annotation encoding="application/x-llamapun" id="A1.Ex22.m1.15d">italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y ) = italic_r ( italic_x , italic_y ) + italic_f ( italic_x ) = italic_β roman_log divide start_ARG italic_π ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG + italic_f ( italic_x ) = italic_β roman_log divide start_ARG italic_π ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_f ( italic_x ) ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG = italic_β roman_log divide start_ARG italic_π start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_y | italic_x ) end_ARG start_ARG italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT ( italic_y | italic_x ) end_ARG</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para" id="A1.SS6.4.p2">
<p class="ltx_p" id="A1.SS6.4.p2.9">for all prompts <math alttext="x" class="ltx_Math" display="inline" id="A1.SS6.4.p2.1.m1.1"><semantics id="A1.SS6.4.p2.1.m1.1a"><mi id="A1.SS6.4.p2.1.m1.1.1" xref="A1.SS6.4.p2.1.m1.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.1.m1.1b"><ci id="A1.SS6.4.p2.1.m1.1.1.cmml" xref="A1.SS6.4.p2.1.m1.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.1.m1.1c">x</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.1.m1.1d">italic_x</annotation></semantics></math> and completions <math alttext="y" class="ltx_Math" display="inline" id="A1.SS6.4.p2.2.m2.1"><semantics id="A1.SS6.4.p2.2.m2.1a"><mi id="A1.SS6.4.p2.2.m2.1.1" xref="A1.SS6.4.p2.2.m2.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.2.m2.1b"><ci id="A1.SS6.4.p2.2.m2.1.1.cmml" xref="A1.SS6.4.p2.2.m2.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.2.m2.1c">y</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.2.m2.1d">italic_y</annotation></semantics></math>. Then we must have <math alttext="\pi(y|x)\exp(\frac{1}{\beta}f(x))=\pi^{\prime}(y|x)" class="ltx_Math" display="inline" id="A1.SS6.4.p2.3.m3.5"><semantics id="A1.SS6.4.p2.3.m3.5a"><mrow id="A1.SS6.4.p2.3.m3.5.5" xref="A1.SS6.4.p2.3.m3.5.5.cmml"><mrow id="A1.SS6.4.p2.3.m3.4.4.2" xref="A1.SS6.4.p2.3.m3.4.4.2.cmml"><mi id="A1.SS6.4.p2.3.m3.4.4.2.4" xref="A1.SS6.4.p2.3.m3.4.4.2.4.cmml">π</mi><mo id="A1.SS6.4.p2.3.m3.4.4.2.3" xref="A1.SS6.4.p2.3.m3.4.4.2.3.cmml">⁢</mo><mrow id="A1.SS6.4.p2.3.m3.3.3.1.1.1" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.cmml"><mo id="A1.SS6.4.p2.3.m3.3.3.1.1.1.2" stretchy="false" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.cmml">(</mo><mrow id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.cmml"><mi id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.2" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.1" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.1.cmml">|</mo><mi id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.3" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.4.p2.3.m3.3.3.1.1.1.3" stretchy="false" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.cmml">)</mo></mrow><mo id="A1.SS6.4.p2.3.m3.4.4.2.3a" lspace="0.167em" xref="A1.SS6.4.p2.3.m3.4.4.2.3.cmml">⁢</mo><mrow id="A1.SS6.4.p2.3.m3.4.4.2.2.1" xref="A1.SS6.4.p2.3.m3.4.4.2.2.2.cmml"><mi id="A1.SS6.4.p2.3.m3.2.2" xref="A1.SS6.4.p2.3.m3.2.2.cmml">exp</mi><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1a" xref="A1.SS6.4.p2.3.m3.4.4.2.2.2.cmml">⁡</mo><mrow id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1" xref="A1.SS6.4.p2.3.m3.4.4.2.2.2.cmml"><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.2" stretchy="false" xref="A1.SS6.4.p2.3.m3.4.4.2.2.2.cmml">(</mo><mrow id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.cmml"><mfrac id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.cmml"><mn id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.2" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.2.cmml">1</mn><mi id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.3" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.1" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.1.cmml">⁢</mo><mi id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.3" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.3.cmml">f</mi><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.1a" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.1.cmml">⁢</mo><mrow id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.4.2" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.cmml"><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.4.2.1" stretchy="false" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.cmml">(</mo><mi id="A1.SS6.4.p2.3.m3.1.1" xref="A1.SS6.4.p2.3.m3.1.1.cmml">x</mi><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.4.2.2" stretchy="false" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.3" stretchy="false" xref="A1.SS6.4.p2.3.m3.4.4.2.2.2.cmml">)</mo></mrow></mrow></mrow><mo id="A1.SS6.4.p2.3.m3.5.5.4" xref="A1.SS6.4.p2.3.m3.5.5.4.cmml">=</mo><mrow id="A1.SS6.4.p2.3.m3.5.5.3" xref="A1.SS6.4.p2.3.m3.5.5.3.cmml"><msup id="A1.SS6.4.p2.3.m3.5.5.3.3" xref="A1.SS6.4.p2.3.m3.5.5.3.3.cmml"><mi id="A1.SS6.4.p2.3.m3.5.5.3.3.2" xref="A1.SS6.4.p2.3.m3.5.5.3.3.2.cmml">π</mi><mo id="A1.SS6.4.p2.3.m3.5.5.3.3.3" xref="A1.SS6.4.p2.3.m3.5.5.3.3.3.cmml">′</mo></msup><mo id="A1.SS6.4.p2.3.m3.5.5.3.2" xref="A1.SS6.4.p2.3.m3.5.5.3.2.cmml">⁢</mo><mrow id="A1.SS6.4.p2.3.m3.5.5.3.1.1" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.cmml"><mo id="A1.SS6.4.p2.3.m3.5.5.3.1.1.2" stretchy="false" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.cmml">(</mo><mrow id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.cmml"><mi id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.2" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.2.cmml">y</mi><mo fence="false" id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.1" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.1.cmml">|</mo><mi id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.3" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.3.cmml">x</mi></mrow><mo id="A1.SS6.4.p2.3.m3.5.5.3.1.1.3" stretchy="false" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.3.m3.5b"><apply id="A1.SS6.4.p2.3.m3.5.5.cmml" xref="A1.SS6.4.p2.3.m3.5.5"><eq id="A1.SS6.4.p2.3.m3.5.5.4.cmml" xref="A1.SS6.4.p2.3.m3.5.5.4"></eq><apply id="A1.SS6.4.p2.3.m3.4.4.2.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2"><times id="A1.SS6.4.p2.3.m3.4.4.2.3.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.3"></times><ci id="A1.SS6.4.p2.3.m3.4.4.2.4.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.4">𝜋</ci><apply id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.cmml" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1"><csymbol cd="latexml" id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.1.cmml" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.1">conditional</csymbol><ci id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.2.cmml" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.2">𝑦</ci><ci id="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.3.cmml" xref="A1.SS6.4.p2.3.m3.3.3.1.1.1.1.3">𝑥</ci></apply><apply id="A1.SS6.4.p2.3.m3.4.4.2.2.2.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1"><exp id="A1.SS6.4.p2.3.m3.2.2.cmml" xref="A1.SS6.4.p2.3.m3.2.2"></exp><apply id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1"><times id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.1.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.1"></times><apply id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2"><divide id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.1.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2"></divide><cn id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.2.cmml" type="integer" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.2">1</cn><ci id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.3.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.2.3">𝛽</ci></apply><ci id="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.3.cmml" xref="A1.SS6.4.p2.3.m3.4.4.2.2.1.1.1.3">𝑓</ci><ci id="A1.SS6.4.p2.3.m3.1.1.cmml" xref="A1.SS6.4.p2.3.m3.1.1">𝑥</ci></apply></apply></apply><apply id="A1.SS6.4.p2.3.m3.5.5.3.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3"><times id="A1.SS6.4.p2.3.m3.5.5.3.2.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.2"></times><apply id="A1.SS6.4.p2.3.m3.5.5.3.3.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.3"><csymbol cd="ambiguous" id="A1.SS6.4.p2.3.m3.5.5.3.3.1.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.3">superscript</csymbol><ci id="A1.SS6.4.p2.3.m3.5.5.3.3.2.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.3.2">𝜋</ci><ci id="A1.SS6.4.p2.3.m3.5.5.3.3.3.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.3.3">′</ci></apply><apply id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1"><csymbol cd="latexml" id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.1.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.1">conditional</csymbol><ci id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.2.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.2">𝑦</ci><ci id="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.3.cmml" xref="A1.SS6.4.p2.3.m3.5.5.3.1.1.1.3">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.3.m3.5c">\pi(y|x)\exp(\frac{1}{\beta}f(x))=\pi^{\prime}(y|x)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.3.m3.5d">italic_π ( italic_y | italic_x ) roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_f ( italic_x ) ) = italic_π start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_y | italic_x )</annotation></semantics></math>. Since these are distributions, summing over <math alttext="y" class="ltx_Math" display="inline" id="A1.SS6.4.p2.4.m4.1"><semantics id="A1.SS6.4.p2.4.m4.1a"><mi id="A1.SS6.4.p2.4.m4.1.1" xref="A1.SS6.4.p2.4.m4.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.4.m4.1b"><ci id="A1.SS6.4.p2.4.m4.1.1.cmml" xref="A1.SS6.4.p2.4.m4.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.4.m4.1c">y</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.4.m4.1d">italic_y</annotation></semantics></math> on both sides, we obtain that <math alttext="\exp(\frac{1}{\beta}f(x))=1" class="ltx_Math" display="inline" id="A1.SS6.4.p2.5.m5.3"><semantics id="A1.SS6.4.p2.5.m5.3a"><mrow id="A1.SS6.4.p2.5.m5.3.3" xref="A1.SS6.4.p2.5.m5.3.3.cmml"><mrow id="A1.SS6.4.p2.5.m5.3.3.1.1" xref="A1.SS6.4.p2.5.m5.3.3.1.2.cmml"><mi id="A1.SS6.4.p2.5.m5.2.2" xref="A1.SS6.4.p2.5.m5.2.2.cmml">exp</mi><mo id="A1.SS6.4.p2.5.m5.3.3.1.1a" xref="A1.SS6.4.p2.5.m5.3.3.1.2.cmml">⁡</mo><mrow id="A1.SS6.4.p2.5.m5.3.3.1.1.1" xref="A1.SS6.4.p2.5.m5.3.3.1.2.cmml"><mo id="A1.SS6.4.p2.5.m5.3.3.1.1.1.2" stretchy="false" xref="A1.SS6.4.p2.5.m5.3.3.1.2.cmml">(</mo><mrow id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.cmml"><mfrac id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.cmml"><mn id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.2" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.2.cmml">1</mn><mi id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.3" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.3.cmml">β</mi></mfrac><mo id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.1" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.1.cmml">⁢</mo><mi id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.3" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.3.cmml">f</mi><mo id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.1a" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.1.cmml">⁢</mo><mrow id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.4.2" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.cmml"><mo id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.4.2.1" stretchy="false" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.cmml">(</mo><mi id="A1.SS6.4.p2.5.m5.1.1" xref="A1.SS6.4.p2.5.m5.1.1.cmml">x</mi><mo id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.4.2.2" stretchy="false" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.4.p2.5.m5.3.3.1.1.1.3" stretchy="false" xref="A1.SS6.4.p2.5.m5.3.3.1.2.cmml">)</mo></mrow></mrow><mo id="A1.SS6.4.p2.5.m5.3.3.2" xref="A1.SS6.4.p2.5.m5.3.3.2.cmml">=</mo><mn id="A1.SS6.4.p2.5.m5.3.3.3" xref="A1.SS6.4.p2.5.m5.3.3.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.5.m5.3b"><apply id="A1.SS6.4.p2.5.m5.3.3.cmml" xref="A1.SS6.4.p2.5.m5.3.3"><eq id="A1.SS6.4.p2.5.m5.3.3.2.cmml" xref="A1.SS6.4.p2.5.m5.3.3.2"></eq><apply id="A1.SS6.4.p2.5.m5.3.3.1.2.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1"><exp id="A1.SS6.4.p2.5.m5.2.2.cmml" xref="A1.SS6.4.p2.5.m5.2.2"></exp><apply id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1"><times id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.1.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.1"></times><apply id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2"><divide id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.1.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2"></divide><cn id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.2.cmml" type="integer" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.2">1</cn><ci id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.3.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.2.3">𝛽</ci></apply><ci id="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.3.cmml" xref="A1.SS6.4.p2.5.m5.3.3.1.1.1.1.3">𝑓</ci><ci id="A1.SS6.4.p2.5.m5.1.1.cmml" xref="A1.SS6.4.p2.5.m5.1.1">𝑥</ci></apply></apply><cn id="A1.SS6.4.p2.5.m5.3.3.3.cmml" type="integer" xref="A1.SS6.4.p2.5.m5.3.3.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.5.m5.3c">\exp(\frac{1}{\beta}f(x))=1</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.5.m5.3d">roman_exp ( divide start_ARG 1 end_ARG start_ARG italic_β end_ARG italic_f ( italic_x ) ) = 1</annotation></semantics></math> and since <math alttext="\beta>0" class="ltx_Math" display="inline" id="A1.SS6.4.p2.6.m6.1"><semantics id="A1.SS6.4.p2.6.m6.1a"><mrow id="A1.SS6.4.p2.6.m6.1.1" xref="A1.SS6.4.p2.6.m6.1.1.cmml"><mi id="A1.SS6.4.p2.6.m6.1.1.2" xref="A1.SS6.4.p2.6.m6.1.1.2.cmml">β</mi><mo id="A1.SS6.4.p2.6.m6.1.1.1" xref="A1.SS6.4.p2.6.m6.1.1.1.cmml">&gt;</mo><mn id="A1.SS6.4.p2.6.m6.1.1.3" xref="A1.SS6.4.p2.6.m6.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.6.m6.1b"><apply id="A1.SS6.4.p2.6.m6.1.1.cmml" xref="A1.SS6.4.p2.6.m6.1.1"><gt id="A1.SS6.4.p2.6.m6.1.1.1.cmml" xref="A1.SS6.4.p2.6.m6.1.1.1"></gt><ci id="A1.SS6.4.p2.6.m6.1.1.2.cmml" xref="A1.SS6.4.p2.6.m6.1.1.2">𝛽</ci><cn id="A1.SS6.4.p2.6.m6.1.1.3.cmml" type="integer" xref="A1.SS6.4.p2.6.m6.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.6.m6.1c">\beta&gt;0</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.6.m6.1d">italic_β &gt; 0</annotation></semantics></math>, we must have <math alttext="f(x)=0" class="ltx_Math" display="inline" id="A1.SS6.4.p2.7.m7.1"><semantics id="A1.SS6.4.p2.7.m7.1a"><mrow id="A1.SS6.4.p2.7.m7.1.2" xref="A1.SS6.4.p2.7.m7.1.2.cmml"><mrow id="A1.SS6.4.p2.7.m7.1.2.2" xref="A1.SS6.4.p2.7.m7.1.2.2.cmml"><mi id="A1.SS6.4.p2.7.m7.1.2.2.2" xref="A1.SS6.4.p2.7.m7.1.2.2.2.cmml">f</mi><mo id="A1.SS6.4.p2.7.m7.1.2.2.1" xref="A1.SS6.4.p2.7.m7.1.2.2.1.cmml">⁢</mo><mrow id="A1.SS6.4.p2.7.m7.1.2.2.3.2" xref="A1.SS6.4.p2.7.m7.1.2.2.cmml"><mo id="A1.SS6.4.p2.7.m7.1.2.2.3.2.1" stretchy="false" xref="A1.SS6.4.p2.7.m7.1.2.2.cmml">(</mo><mi id="A1.SS6.4.p2.7.m7.1.1" xref="A1.SS6.4.p2.7.m7.1.1.cmml">x</mi><mo id="A1.SS6.4.p2.7.m7.1.2.2.3.2.2" stretchy="false" xref="A1.SS6.4.p2.7.m7.1.2.2.cmml">)</mo></mrow></mrow><mo id="A1.SS6.4.p2.7.m7.1.2.1" xref="A1.SS6.4.p2.7.m7.1.2.1.cmml">=</mo><mn id="A1.SS6.4.p2.7.m7.1.2.3" xref="A1.SS6.4.p2.7.m7.1.2.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.7.m7.1b"><apply id="A1.SS6.4.p2.7.m7.1.2.cmml" xref="A1.SS6.4.p2.7.m7.1.2"><eq id="A1.SS6.4.p2.7.m7.1.2.1.cmml" xref="A1.SS6.4.p2.7.m7.1.2.1"></eq><apply id="A1.SS6.4.p2.7.m7.1.2.2.cmml" xref="A1.SS6.4.p2.7.m7.1.2.2"><times id="A1.SS6.4.p2.7.m7.1.2.2.1.cmml" xref="A1.SS6.4.p2.7.m7.1.2.2.1"></times><ci id="A1.SS6.4.p2.7.m7.1.2.2.2.cmml" xref="A1.SS6.4.p2.7.m7.1.2.2.2">𝑓</ci><ci id="A1.SS6.4.p2.7.m7.1.1.cmml" xref="A1.SS6.4.p2.7.m7.1.1">𝑥</ci></apply><cn id="A1.SS6.4.p2.7.m7.1.2.3.cmml" type="integer" xref="A1.SS6.4.p2.7.m7.1.2.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.7.m7.1c">f(x)=0</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.7.m7.1d">italic_f ( italic_x ) = 0</annotation></semantics></math> for all <math alttext="x" class="ltx_Math" display="inline" id="A1.SS6.4.p2.8.m8.1"><semantics id="A1.SS6.4.p2.8.m8.1a"><mi id="A1.SS6.4.p2.8.m8.1.1" xref="A1.SS6.4.p2.8.m8.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.8.m8.1b"><ci id="A1.SS6.4.p2.8.m8.1.1.cmml" xref="A1.SS6.4.p2.8.m8.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.8.m8.1c">x</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.8.m8.1d">italic_x</annotation></semantics></math>. Therefore <math alttext="r(x,y)=r^{\prime}(x,y)" class="ltx_Math" display="inline" id="A1.SS6.4.p2.9.m9.4"><semantics id="A1.SS6.4.p2.9.m9.4a"><mrow id="A1.SS6.4.p2.9.m9.4.5" xref="A1.SS6.4.p2.9.m9.4.5.cmml"><mrow id="A1.SS6.4.p2.9.m9.4.5.2" xref="A1.SS6.4.p2.9.m9.4.5.2.cmml"><mi id="A1.SS6.4.p2.9.m9.4.5.2.2" xref="A1.SS6.4.p2.9.m9.4.5.2.2.cmml">r</mi><mo id="A1.SS6.4.p2.9.m9.4.5.2.1" xref="A1.SS6.4.p2.9.m9.4.5.2.1.cmml">⁢</mo><mrow id="A1.SS6.4.p2.9.m9.4.5.2.3.2" xref="A1.SS6.4.p2.9.m9.4.5.2.3.1.cmml"><mo id="A1.SS6.4.p2.9.m9.4.5.2.3.2.1" stretchy="false" xref="A1.SS6.4.p2.9.m9.4.5.2.3.1.cmml">(</mo><mi id="A1.SS6.4.p2.9.m9.1.1" xref="A1.SS6.4.p2.9.m9.1.1.cmml">x</mi><mo id="A1.SS6.4.p2.9.m9.4.5.2.3.2.2" xref="A1.SS6.4.p2.9.m9.4.5.2.3.1.cmml">,</mo><mi id="A1.SS6.4.p2.9.m9.2.2" xref="A1.SS6.4.p2.9.m9.2.2.cmml">y</mi><mo id="A1.SS6.4.p2.9.m9.4.5.2.3.2.3" stretchy="false" xref="A1.SS6.4.p2.9.m9.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="A1.SS6.4.p2.9.m9.4.5.1" xref="A1.SS6.4.p2.9.m9.4.5.1.cmml">=</mo><mrow id="A1.SS6.4.p2.9.m9.4.5.3" xref="A1.SS6.4.p2.9.m9.4.5.3.cmml"><msup id="A1.SS6.4.p2.9.m9.4.5.3.2" xref="A1.SS6.4.p2.9.m9.4.5.3.2.cmml"><mi id="A1.SS6.4.p2.9.m9.4.5.3.2.2" xref="A1.SS6.4.p2.9.m9.4.5.3.2.2.cmml">r</mi><mo id="A1.SS6.4.p2.9.m9.4.5.3.2.3" xref="A1.SS6.4.p2.9.m9.4.5.3.2.3.cmml">′</mo></msup><mo id="A1.SS6.4.p2.9.m9.4.5.3.1" xref="A1.SS6.4.p2.9.m9.4.5.3.1.cmml">⁢</mo><mrow id="A1.SS6.4.p2.9.m9.4.5.3.3.2" xref="A1.SS6.4.p2.9.m9.4.5.3.3.1.cmml"><mo id="A1.SS6.4.p2.9.m9.4.5.3.3.2.1" stretchy="false" xref="A1.SS6.4.p2.9.m9.4.5.3.3.1.cmml">(</mo><mi id="A1.SS6.4.p2.9.m9.3.3" xref="A1.SS6.4.p2.9.m9.3.3.cmml">x</mi><mo id="A1.SS6.4.p2.9.m9.4.5.3.3.2.2" xref="A1.SS6.4.p2.9.m9.4.5.3.3.1.cmml">,</mo><mi id="A1.SS6.4.p2.9.m9.4.4" xref="A1.SS6.4.p2.9.m9.4.4.cmml">y</mi><mo id="A1.SS6.4.p2.9.m9.4.5.3.3.2.3" stretchy="false" xref="A1.SS6.4.p2.9.m9.4.5.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.4.p2.9.m9.4b"><apply id="A1.SS6.4.p2.9.m9.4.5.cmml" xref="A1.SS6.4.p2.9.m9.4.5"><eq id="A1.SS6.4.p2.9.m9.4.5.1.cmml" xref="A1.SS6.4.p2.9.m9.4.5.1"></eq><apply id="A1.SS6.4.p2.9.m9.4.5.2.cmml" xref="A1.SS6.4.p2.9.m9.4.5.2"><times id="A1.SS6.4.p2.9.m9.4.5.2.1.cmml" xref="A1.SS6.4.p2.9.m9.4.5.2.1"></times><ci id="A1.SS6.4.p2.9.m9.4.5.2.2.cmml" xref="A1.SS6.4.p2.9.m9.4.5.2.2">𝑟</ci><interval closure="open" id="A1.SS6.4.p2.9.m9.4.5.2.3.1.cmml" xref="A1.SS6.4.p2.9.m9.4.5.2.3.2"><ci id="A1.SS6.4.p2.9.m9.1.1.cmml" xref="A1.SS6.4.p2.9.m9.1.1">𝑥</ci><ci id="A1.SS6.4.p2.9.m9.2.2.cmml" xref="A1.SS6.4.p2.9.m9.2.2">𝑦</ci></interval></apply><apply id="A1.SS6.4.p2.9.m9.4.5.3.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3"><times id="A1.SS6.4.p2.9.m9.4.5.3.1.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3.1"></times><apply id="A1.SS6.4.p2.9.m9.4.5.3.2.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3.2"><csymbol cd="ambiguous" id="A1.SS6.4.p2.9.m9.4.5.3.2.1.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3.2">superscript</csymbol><ci id="A1.SS6.4.p2.9.m9.4.5.3.2.2.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3.2.2">𝑟</ci><ci id="A1.SS6.4.p2.9.m9.4.5.3.2.3.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3.2.3">′</ci></apply><interval closure="open" id="A1.SS6.4.p2.9.m9.4.5.3.3.1.cmml" xref="A1.SS6.4.p2.9.m9.4.5.3.3.2"><ci id="A1.SS6.4.p2.9.m9.3.3.cmml" xref="A1.SS6.4.p2.9.m9.3.3">𝑥</ci><ci id="A1.SS6.4.p2.9.m9.4.4.cmml" xref="A1.SS6.4.p2.9.m9.4.4">𝑦</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.4.p2.9.m9.4c">r(x,y)=r^{\prime}(x,y)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.4.p2.9.m9.4d">italic_r ( italic_x , italic_y ) = italic_r start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT ( italic_x , italic_y )</annotation></semantics></math>. This completes the proof.
∎</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</div>
<div class="ltx_para" id="A1.SS6.p4">
<p class="ltx_p" id="A1.SS6.p4.1">We have now shown that every reward class has a unique reward function that can be represented as outlined in Theorem&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#Thmtheorem1" title="Theorem 1. ‣ 5.1 Your Language Model Is Secretly a Reward Model ‣ 5 Theoretical Analysis of DPO ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">1</span></a>, which is given by <math alttext="f(r,\pi_{\text{ref}},\beta)" class="ltx_Math" display="inline" id="A1.SS6.p4.1.m1.3"><semantics id="A1.SS6.p4.1.m1.3a"><mrow id="A1.SS6.p4.1.m1.3.3" xref="A1.SS6.p4.1.m1.3.3.cmml"><mi id="A1.SS6.p4.1.m1.3.3.3" xref="A1.SS6.p4.1.m1.3.3.3.cmml">f</mi><mo id="A1.SS6.p4.1.m1.3.3.2" xref="A1.SS6.p4.1.m1.3.3.2.cmml">⁢</mo><mrow id="A1.SS6.p4.1.m1.3.3.1.1" xref="A1.SS6.p4.1.m1.3.3.1.2.cmml"><mo id="A1.SS6.p4.1.m1.3.3.1.1.2" stretchy="false" xref="A1.SS6.p4.1.m1.3.3.1.2.cmml">(</mo><mi id="A1.SS6.p4.1.m1.1.1" xref="A1.SS6.p4.1.m1.1.1.cmml">r</mi><mo id="A1.SS6.p4.1.m1.3.3.1.1.3" xref="A1.SS6.p4.1.m1.3.3.1.2.cmml">,</mo><msub id="A1.SS6.p4.1.m1.3.3.1.1.1" xref="A1.SS6.p4.1.m1.3.3.1.1.1.cmml"><mi id="A1.SS6.p4.1.m1.3.3.1.1.1.2" xref="A1.SS6.p4.1.m1.3.3.1.1.1.2.cmml">π</mi><mtext id="A1.SS6.p4.1.m1.3.3.1.1.1.3" xref="A1.SS6.p4.1.m1.3.3.1.1.1.3a.cmml">ref</mtext></msub><mo id="A1.SS6.p4.1.m1.3.3.1.1.4" xref="A1.SS6.p4.1.m1.3.3.1.2.cmml">,</mo><mi id="A1.SS6.p4.1.m1.2.2" xref="A1.SS6.p4.1.m1.2.2.cmml">β</mi><mo id="A1.SS6.p4.1.m1.3.3.1.1.5" stretchy="false" xref="A1.SS6.p4.1.m1.3.3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS6.p4.1.m1.3b"><apply id="A1.SS6.p4.1.m1.3.3.cmml" xref="A1.SS6.p4.1.m1.3.3"><times id="A1.SS6.p4.1.m1.3.3.2.cmml" xref="A1.SS6.p4.1.m1.3.3.2"></times><ci id="A1.SS6.p4.1.m1.3.3.3.cmml" xref="A1.SS6.p4.1.m1.3.3.3">𝑓</ci><vector id="A1.SS6.p4.1.m1.3.3.1.2.cmml" xref="A1.SS6.p4.1.m1.3.3.1.1"><ci id="A1.SS6.p4.1.m1.1.1.cmml" xref="A1.SS6.p4.1.m1.1.1">𝑟</ci><apply id="A1.SS6.p4.1.m1.3.3.1.1.1.cmml" xref="A1.SS6.p4.1.m1.3.3.1.1.1"><csymbol cd="ambiguous" id="A1.SS6.p4.1.m1.3.3.1.1.1.1.cmml" xref="A1.SS6.p4.1.m1.3.3.1.1.1">subscript</csymbol><ci id="A1.SS6.p4.1.m1.3.3.1.1.1.2.cmml" xref="A1.SS6.p4.1.m1.3.3.1.1.1.2">𝜋</ci><ci id="A1.SS6.p4.1.m1.3.3.1.1.1.3a.cmml" xref="A1.SS6.p4.1.m1.3.3.1.1.1.3"><mtext id="A1.SS6.p4.1.m1.3.3.1.1.1.3.cmml" mathsize="70%" xref="A1.SS6.p4.1.m1.3.3.1.1.1.3">ref</mtext></ci></apply><ci id="A1.SS6.p4.1.m1.2.2.cmml" xref="A1.SS6.p4.1.m1.2.2">𝛽</ci></vector></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS6.p4.1.m1.3c">f(r,\pi_{\text{ref}},\beta)</annotation><annotation encoding="application/x-llamapun" id="A1.SS6.p4.1.m1.3d">italic_f ( italic_r , italic_π start_POSTSUBSCRIPT ref end_POSTSUBSCRIPT , italic_β )</annotation></semantics></math> for any reward function in that class.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>DPO Implementation Details and Hyperparameters</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A2.p1">
<p class="ltx_p" id="A2.p1.1">DPO is relatively straightforward to implement; PyTorch code for the DPO loss is provided below:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_pagination ltx_role_newpage"></div>
<pre class="ltx_verbatim ltx_font_typewriter" id="A2.p1.2">import torch.nn.functional as F

def dpo_loss(pi_logps, ref_logps, yw_idxs, yl_idxs, beta):
    """
    pi_logps: policy logprobs, shape (B,)
    ref_logps: reference model logprobs, shape (B,)
    yw_idxs: preferred completion indices in [0, B-1], shape (T,)
    yl_idxs: dispreferred completion indices in [0, B-1], shape (T,)
    beta: temperature controlling strength of KL penalty

    Each pair of (yw_idxs[i], yl_idxs[i]) represents the
      indices of a single preference pair.
    """

    pi_yw_logps,  pi_yl_logps =  pi_logps[yw_idxs],  pi_logps[yl_idxs]
    ref_yw_logps, ref_yl_logps = ref_logps[yw_idxs], ref_logps[yl_idxs]

    pi_logratios  = pi_yw_logps - pi_yl_logps
    ref_logratios = ref_yw_logps - ref_yl_logps

    losses = -F.logsigmoid(beta * (pi_logratios - ref_logratios))
    rewards = beta * (pi_logps - ref_logps).detach()

    return losses, rewards
</pre>
</div>
<div class="ltx_para" id="A2.p2">
<p class="ltx_p" id="A2.p2.2">Unless noted otherwise, we use a <math alttext="\beta=0.1" class="ltx_Math" display="inline" id="A2.p2.1.m1.1"><semantics id="A2.p2.1.m1.1a"><mrow id="A2.p2.1.m1.1.1" xref="A2.p2.1.m1.1.1.cmml"><mi id="A2.p2.1.m1.1.1.2" xref="A2.p2.1.m1.1.1.2.cmml">β</mi><mo id="A2.p2.1.m1.1.1.1" xref="A2.p2.1.m1.1.1.1.cmml">=</mo><mn id="A2.p2.1.m1.1.1.3" xref="A2.p2.1.m1.1.1.3.cmml">0.1</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.p2.1.m1.1b"><apply id="A2.p2.1.m1.1.1.cmml" xref="A2.p2.1.m1.1.1"><eq id="A2.p2.1.m1.1.1.1.cmml" xref="A2.p2.1.m1.1.1.1"></eq><ci id="A2.p2.1.m1.1.1.2.cmml" xref="A2.p2.1.m1.1.1.2">𝛽</ci><cn id="A2.p2.1.m1.1.1.3.cmml" type="float" xref="A2.p2.1.m1.1.1.3">0.1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.p2.1.m1.1c">\beta=0.1</annotation><annotation encoding="application/x-llamapun" id="A2.p2.1.m1.1d">italic_β = 0.1</annotation></semantics></math>, batch size of <span class="ltx_text ltx_font_typewriter" id="A2.p2.2.1">64</span> and the RMSprop optimizer with a learning rate of <span class="ltx_text ltx_font_typewriter" id="A2.p2.2.2">1e-6</span> by default. We linearly warmup the learning rate from <span class="ltx_text ltx_font_typewriter" id="A2.p2.2.3">0</span> to <span class="ltx_text ltx_font_typewriter" id="A2.p2.2.4">1e-6</span> over <span class="ltx_text ltx_font_typewriter" id="A2.p2.2.5">150</span> steps. For TL;DR summarization, we use <math alttext="\beta=0.5" class="ltx_Math" display="inline" id="A2.p2.2.m2.1"><semantics id="A2.p2.2.m2.1a"><mrow id="A2.p2.2.m2.1.1" xref="A2.p2.2.m2.1.1.cmml"><mi id="A2.p2.2.m2.1.1.2" xref="A2.p2.2.m2.1.1.2.cmml">β</mi><mo id="A2.p2.2.m2.1.1.1" xref="A2.p2.2.m2.1.1.1.cmml">=</mo><mn id="A2.p2.2.m2.1.1.3" xref="A2.p2.2.m2.1.1.3.cmml">0.5</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.p2.2.m2.1b"><apply id="A2.p2.2.m2.1.1.cmml" xref="A2.p2.2.m2.1.1"><eq id="A2.p2.2.m2.1.1.1.cmml" xref="A2.p2.2.m2.1.1.1"></eq><ci id="A2.p2.2.m2.1.1.2.cmml" xref="A2.p2.2.m2.1.1.2">𝛽</ci><cn id="A2.p2.2.m2.1.1.3.cmml" type="float" xref="A2.p2.2.m2.1.1.3">0.5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.p2.2.m2.1c">\beta=0.5</annotation><annotation encoding="application/x-llamapun" id="A2.p2.2.m2.1d">italic_β = 0.5</annotation></semantics></math>, while rest of the parameters remain the same.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_appendix" id="A3">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>Further Details on the Experimental Set-Up</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A3.p1">
<p class="ltx_p" id="A3.p1.1">In this section, we include additional details relevant to our experimental design.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<section class="ltx_subsection" id="A3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">C.1 </span>IMDb Sentiment Experiment and Baseline Details</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A3.SS1.p1">
<p class="ltx_p" id="A3.SS1.p1.1">The prompts are prefixes from the IMDB dataset of length 2-8 tokens. We use the pre-trained sentiment classifier <span class="ltx_text ltx_font_typewriter" id="A3.SS1.p1.1.1">siebert/sentiment-roberta-large-english</span> as a ground-truth reward model and <span class="ltx_text ltx_font_typewriter" id="A3.SS1.p1.1.2">gpt2-large</span> as a base model. We use these larger models as we found the default ones to generate low-quality text and rewards to be somewhat inaccurate. We first use supervised fine-tuning on a subset of the IMDB data for 1 epoch. We then use this model to sample 4 completions for 25000 prefixes and create 6 preference pairs for each prefix using the ground-truth reward model. The RLHF reward model is initialized from the <span class="ltx_text ltx_font_typewriter" id="A3.SS1.p1.1.3">gpt2-large</span> model and trained for 3 epochs on the preference datasets, and we take the checkpoint with the highest validation set accuracy. The “TRL” run uses the hyper-parameters in the TRL library. Our implementation uses larger batch samples of 1024 per PPO step.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</section>
<section class="ltx_subsection" id="A3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">C.2 </span>GPT-4 prompts for computing summarization and dialogue win rates</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A3.SS2.p1">
<p class="ltx_p" id="A3.SS2.p1.1">A key component of our experimental setup is GPT-4 win rate judgments. In this section, we include the prompts used to generate win rates for the summarization and dialogue experiments. We use <span class="ltx_text ltx_font_typewriter" id="A3.SS2.p1.1.1">gpt-4-0314</span> for all our experiments. The order of summaries or responses are randomly chosen for every evaluation.
<br class="ltx_break">
<span class="ltx_text ltx_font_bold" id="A3.SS2.p1.1.2">Summarization GPT-4 win rate prompt (S).</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<pre class="ltx_verbatim ltx_font_typewriter" id="A3.SS2.p1.2">Which of the following summaries does a better job of summarizing the most \
important points in the given forum post?

Post:
&lt;post&gt;

Summary A:
&lt;Summary A&gt;

Summary B:
&lt;Summary B&gt;

FIRST provide a one-sentence comparison of the two summaries, explaining which \
you prefer and why. SECOND, on a new line, state only "A" or "B" to indicate your \
choice. Your response should use the format:
Comparison: &lt;one-sentence comparison and explanation&gt;
Preferred: &lt;"A" or "B"&gt;
</pre>
</div>
<div class="ltx_para" id="A3.SS2.p2">
<p class="ltx_p" id="A3.SS2.p2.1"><span class="ltx_text ltx_font_bold" id="A3.SS2.p2.1.1">Summarization GPT-4 win rate prompt (C).</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<pre class="ltx_verbatim ltx_font_typewriter" id="A3.SS2.p2.2">Which of the following summaries does a better job of summarizing the most \
important points in the given forum post, without including unimportant or \
irrelevant details? A good summary is both precise and concise.

Post:
&lt;post&gt;

Summary A:
&lt;Summary A&gt;

Summary B:
&lt;Summary B&gt;

FIRST provide a one-sentence comparison of the two summaries, explaining which \
you prefer and why. SECOND, on a new line, state only "A" or "B" to indicate your \
choice. Your response should use the format:
Comparison: &lt;one-sentence comparison and explanation&gt;
Preferred: &lt;"A" or "B"&gt;
</pre>
</div>
<div class="ltx_para" id="A3.SS2.p3">
<p class="ltx_p" id="A3.SS2.p3.1"><span class="ltx_text ltx_font_bold" id="A3.SS2.p3.1.1">Dialogue GPT-4 win rate prompt.</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<pre class="ltx_verbatim ltx_font_typewriter" id="A3.SS2.p3.2">For the following query to a chatbot, which response is more helpful?

Query: &lt;the user query&gt;

Response A:
&lt;either the test method or baseline&gt;

Response B:
&lt;the other response&gt;

FIRST provide a one-sentence comparison of the two responses and explain \
which you feel is more helpful. SECOND, on a new line, state only "A" or \
"B" to indicate which response is more helpful. Your response should use \
the format:
Comparison: &lt;one-sentence comparison and explanation&gt;
More helpful: &lt;"A" or "B"&gt;
</pre>
</div>
</section>
<section class="ltx_subsection" id="A3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">C.3 </span>Unlikelihood baseline</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A3.SS3.p1">
<p class="ltx_p" id="A3.SS3.p1.2">While we include the unlikelihood baseline&nbsp;<cite class="ltx_cite ltx_citemacro_citep">[Welleck et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#bib.bib44" title="">2019</a>]</cite> (simply maximizing <math alttext="\log p(y_{w}|x)" class="ltx_Math" display="inline" id="A3.SS3.p1.1.m1.1"><semantics id="A3.SS3.p1.1.m1.1a"><mrow id="A3.SS3.p1.1.m1.1.1" xref="A3.SS3.p1.1.m1.1.1.cmml"><mrow id="A3.SS3.p1.1.m1.1.1.3" xref="A3.SS3.p1.1.m1.1.1.3.cmml"><mi id="A3.SS3.p1.1.m1.1.1.3.1" xref="A3.SS3.p1.1.m1.1.1.3.1.cmml">log</mi><mo id="A3.SS3.p1.1.m1.1.1.3a" lspace="0.167em" xref="A3.SS3.p1.1.m1.1.1.3.cmml">⁡</mo><mi id="A3.SS3.p1.1.m1.1.1.3.2" xref="A3.SS3.p1.1.m1.1.1.3.2.cmml">p</mi></mrow><mo id="A3.SS3.p1.1.m1.1.1.2" xref="A3.SS3.p1.1.m1.1.1.2.cmml">⁢</mo><mrow id="A3.SS3.p1.1.m1.1.1.1.1" xref="A3.SS3.p1.1.m1.1.1.1.1.1.cmml"><mo id="A3.SS3.p1.1.m1.1.1.1.1.2" stretchy="false" xref="A3.SS3.p1.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="A3.SS3.p1.1.m1.1.1.1.1.1" xref="A3.SS3.p1.1.m1.1.1.1.1.1.cmml"><msub id="A3.SS3.p1.1.m1.1.1.1.1.1.2" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2.cmml"><mi id="A3.SS3.p1.1.m1.1.1.1.1.1.2.2" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2.2.cmml">y</mi><mi id="A3.SS3.p1.1.m1.1.1.1.1.1.2.3" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2.3.cmml">w</mi></msub><mo fence="false" id="A3.SS3.p1.1.m1.1.1.1.1.1.1" xref="A3.SS3.p1.1.m1.1.1.1.1.1.1.cmml">|</mo><mi id="A3.SS3.p1.1.m1.1.1.1.1.1.3" xref="A3.SS3.p1.1.m1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A3.SS3.p1.1.m1.1.1.1.1.3" stretchy="false" xref="A3.SS3.p1.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A3.SS3.p1.1.m1.1b"><apply id="A3.SS3.p1.1.m1.1.1.cmml" xref="A3.SS3.p1.1.m1.1.1"><times id="A3.SS3.p1.1.m1.1.1.2.cmml" xref="A3.SS3.p1.1.m1.1.1.2"></times><apply id="A3.SS3.p1.1.m1.1.1.3.cmml" xref="A3.SS3.p1.1.m1.1.1.3"><log id="A3.SS3.p1.1.m1.1.1.3.1.cmml" xref="A3.SS3.p1.1.m1.1.1.3.1"></log><ci id="A3.SS3.p1.1.m1.1.1.3.2.cmml" xref="A3.SS3.p1.1.m1.1.1.3.2">𝑝</ci></apply><apply id="A3.SS3.p1.1.m1.1.1.1.1.1.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1"><csymbol cd="latexml" id="A3.SS3.p1.1.m1.1.1.1.1.1.1.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1.1.1">conditional</csymbol><apply id="A3.SS3.p1.1.m1.1.1.1.1.1.2.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A3.SS3.p1.1.m1.1.1.1.1.1.2.1.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2">subscript</csymbol><ci id="A3.SS3.p1.1.m1.1.1.1.1.1.2.2.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2.2">𝑦</ci><ci id="A3.SS3.p1.1.m1.1.1.1.1.1.2.3.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1.1.2.3">𝑤</ci></apply><ci id="A3.SS3.p1.1.m1.1.1.1.1.1.3.cmml" xref="A3.SS3.p1.1.m1.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS3.p1.1.m1.1c">\log p(y_{w}|x)</annotation><annotation encoding="application/x-llamapun" id="A3.SS3.p1.1.m1.1d">roman_log italic_p ( italic_y start_POSTSUBSCRIPT italic_w end_POSTSUBSCRIPT | italic_x )</annotation></semantics></math>, the log probability of the preferred response, while minimizing <math alttext="\log p(y_{l}|x)" class="ltx_Math" display="inline" id="A3.SS3.p1.2.m2.1"><semantics id="A3.SS3.p1.2.m2.1a"><mrow id="A3.SS3.p1.2.m2.1.1" xref="A3.SS3.p1.2.m2.1.1.cmml"><mrow id="A3.SS3.p1.2.m2.1.1.3" xref="A3.SS3.p1.2.m2.1.1.3.cmml"><mi id="A3.SS3.p1.2.m2.1.1.3.1" xref="A3.SS3.p1.2.m2.1.1.3.1.cmml">log</mi><mo id="A3.SS3.p1.2.m2.1.1.3a" lspace="0.167em" xref="A3.SS3.p1.2.m2.1.1.3.cmml">⁡</mo><mi id="A3.SS3.p1.2.m2.1.1.3.2" xref="A3.SS3.p1.2.m2.1.1.3.2.cmml">p</mi></mrow><mo id="A3.SS3.p1.2.m2.1.1.2" xref="A3.SS3.p1.2.m2.1.1.2.cmml">⁢</mo><mrow id="A3.SS3.p1.2.m2.1.1.1.1" xref="A3.SS3.p1.2.m2.1.1.1.1.1.cmml"><mo id="A3.SS3.p1.2.m2.1.1.1.1.2" stretchy="false" xref="A3.SS3.p1.2.m2.1.1.1.1.1.cmml">(</mo><mrow id="A3.SS3.p1.2.m2.1.1.1.1.1" xref="A3.SS3.p1.2.m2.1.1.1.1.1.cmml"><msub id="A3.SS3.p1.2.m2.1.1.1.1.1.2" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2.cmml"><mi id="A3.SS3.p1.2.m2.1.1.1.1.1.2.2" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2.2.cmml">y</mi><mi id="A3.SS3.p1.2.m2.1.1.1.1.1.2.3" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2.3.cmml">l</mi></msub><mo fence="false" id="A3.SS3.p1.2.m2.1.1.1.1.1.1" xref="A3.SS3.p1.2.m2.1.1.1.1.1.1.cmml">|</mo><mi id="A3.SS3.p1.2.m2.1.1.1.1.1.3" xref="A3.SS3.p1.2.m2.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="A3.SS3.p1.2.m2.1.1.1.1.3" stretchy="false" xref="A3.SS3.p1.2.m2.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A3.SS3.p1.2.m2.1b"><apply id="A3.SS3.p1.2.m2.1.1.cmml" xref="A3.SS3.p1.2.m2.1.1"><times id="A3.SS3.p1.2.m2.1.1.2.cmml" xref="A3.SS3.p1.2.m2.1.1.2"></times><apply id="A3.SS3.p1.2.m2.1.1.3.cmml" xref="A3.SS3.p1.2.m2.1.1.3"><log id="A3.SS3.p1.2.m2.1.1.3.1.cmml" xref="A3.SS3.p1.2.m2.1.1.3.1"></log><ci id="A3.SS3.p1.2.m2.1.1.3.2.cmml" xref="A3.SS3.p1.2.m2.1.1.3.2">𝑝</ci></apply><apply id="A3.SS3.p1.2.m2.1.1.1.1.1.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1"><csymbol cd="latexml" id="A3.SS3.p1.2.m2.1.1.1.1.1.1.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1.1.1">conditional</csymbol><apply id="A3.SS3.p1.2.m2.1.1.1.1.1.2.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A3.SS3.p1.2.m2.1.1.1.1.1.2.1.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2">subscript</csymbol><ci id="A3.SS3.p1.2.m2.1.1.1.1.1.2.2.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2.2">𝑦</ci><ci id="A3.SS3.p1.2.m2.1.1.1.1.1.2.3.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="A3.SS3.p1.2.m2.1.1.1.1.1.3.cmml" xref="A3.SS3.p1.2.m2.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.SS3.p1.2.m2.1c">\log p(y_{l}|x)</annotation><annotation encoding="application/x-llamapun" id="A3.SS3.p1.2.m2.1d">roman_log italic_p ( italic_y start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT | italic_x )</annotation></semantics></math>, the log probability of the dispreferred response) in our sentiment experiments, we do not include it as a baseline in either the summarization or dialogue experiment because it produces generally meaningless responses, which we believe is a result of unconstrained likelihood <span class="ltx_text ltx_font_italic" id="A3.SS3.p1.2.1">minimization</span>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_table" id="A3.T3">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T3.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A3.T3.1.1.1">
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A3.T3.1.1.1.1" style="width:184.9pt;"><span class="ltx_text ltx_font_bold ltx_align_top" id="A3.T3.1.1.1.1.1">Prompt</span></th>
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A3.T3.1.1.1.2" style="width:184.9pt;"><span class="ltx_text ltx_font_bold ltx_align_top" id="A3.T3.1.1.1.2.1">Response</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T3.1.2.1">
<td class="ltx_td ltx_align_justify ltx_border_t" id="A3.T3.1.2.1.1" style="width:184.9pt;">
<p class="ltx_p ltx_align_top" id="A3.T3.1.2.1.1.1">SUBREDDIT: r/relationships 
<br class="ltx_break">TITLE: The girl [26 F] I [22 M] have been seeing for a month didn’t respond to me at all yesterday while hanging out with a friend [&nbsp;30? M]. 
<br class="ltx_break">POST: She gets terrible service while at her house, but I texted her 3 times yesterday, 4-5 hours apart. She didn’t call me until early this morning and left a voicemail that she was busy all day with a friend who showed up out of the blue. 
<br class="ltx_break">I saw that she posted a picture of the two of them out of her dead zone house on facebook before I texted her the last time. 
<br class="ltx_break">I don’t mind that she hangs out with friends, and I know it’s pretty early […]
TL;DR:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A3.T3.1.2.1.2" style="width:184.9pt;">
<p class="ltx_p ltx_align_top" id="A3.T3.1.2.1.2.1">girl when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when whenUB when when when when whenUB when when when whenUB</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A3.T3.1.3.2">
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A3.T3.1.3.2.1" style="width:184.9pt;">
<p class="ltx_p ltx_align_top" id="A3.T3.1.3.2.1.1">SUBREDDIT: r/tifu 
<br class="ltx_break">TITLE: TIFU by accidently kicking an old woman 
<br class="ltx_break">POST: So this didn’t happen today but actually about a year or two ago. 
<br class="ltx_break">I was at my granddads funeral so of course it was all very sad and full of lots of crying old people. After the ceremony everyone walks outside the building and onto the other side of the small road the hearses drive down. Now the road is important because obviously if there’s a road, there’s a curb onto the sidewalk, so most of us are on the other side of the road, besides a few older people walking a lot slower. 
<br class="ltx_break">As one of the old woman goes to walk up the curb […] TL;DR:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A3.T3.1.3.2.2" style="width:184.9pt;">
<p class="ltx_p ltx_align_top" id="A3.T3.1.3.2.2.1">when an old woman was tripping the when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when when</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>Unlikelihood samples from TL;DR prompts sampled at temperature 1.0. In general, we find unlikelihood fails to generate meaningful responses for more complex problems such as summarization and dialogue.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
</section>
<section class="ltx_appendix" id="A4">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix D </span>Additional Empirical Results</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_subsection" id="A4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">D.1 </span>Performance of Best of <math alttext="N" class="ltx_Math" display="inline" id="A4.SS1.1.m1.1"><semantics id="A4.SS1.1.m1.1b"><mi id="A4.SS1.1.m1.1.1" xref="A4.SS1.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="A4.SS1.1.m1.1c"><ci id="A4.SS1.1.m1.1.1.cmml" xref="A4.SS1.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.SS1.1.m1.1d">N</annotation><annotation encoding="application/x-llamapun" id="A4.SS1.1.m1.1e">italic_N</annotation></semantics></math> baseline for Various <math alttext="N" class="ltx_Math" display="inline" id="A4.SS1.2.m2.1"><semantics id="A4.SS1.2.m2.1b"><mi id="A4.SS1.2.m2.1.1" xref="A4.SS1.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="A4.SS1.2.m2.1c"><ci id="A4.SS1.2.m2.1.1.cmml" xref="A4.SS1.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.SS1.2.m2.1d">N</annotation><annotation encoding="application/x-llamapun" id="A4.SS1.2.m2.1e">italic_N</annotation></semantics></math>
</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A4.SS1.p1">
<p class="ltx_p" id="A4.SS1.p1.3">We find that the Best of <math alttext="N" class="ltx_Math" display="inline" id="A4.SS1.p1.1.m1.1"><semantics id="A4.SS1.p1.1.m1.1a"><mi id="A4.SS1.p1.1.m1.1.1" xref="A4.SS1.p1.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="A4.SS1.p1.1.m1.1b"><ci id="A4.SS1.p1.1.m1.1.1.cmml" xref="A4.SS1.p1.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.SS1.p1.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="A4.SS1.p1.1.m1.1d">italic_N</annotation></semantics></math> baseline is a strong (although computationally expensive, requiring sampling many times) baseline in our experiments. We include an evaluation of the Best of <math alttext="N" class="ltx_Math" display="inline" id="A4.SS1.p1.2.m2.1"><semantics id="A4.SS1.p1.2.m2.1a"><mi id="A4.SS1.p1.2.m2.1.1" xref="A4.SS1.p1.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="A4.SS1.p1.2.m2.1b"><ci id="A4.SS1.p1.2.m2.1.1.cmml" xref="A4.SS1.p1.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.SS1.p1.2.m2.1c">N</annotation><annotation encoding="application/x-llamapun" id="A4.SS1.p1.2.m2.1d">italic_N</annotation></semantics></math> baseline for various <math alttext="N" class="ltx_Math" display="inline" id="A4.SS1.p1.3.m3.1"><semantics id="A4.SS1.p1.3.m3.1a"><mi id="A4.SS1.p1.3.m3.1.1" xref="A4.SS1.p1.3.m3.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="A4.SS1.p1.3.m3.1b"><ci id="A4.SS1.p1.3.m3.1.1.cmml" xref="A4.SS1.p1.3.m3.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.SS1.p1.3.m3.1c">N</annotation><annotation encoding="application/x-llamapun" id="A4.SS1.p1.3.m3.1d">italic_N</annotation></semantics></math> for the Anthropic-HH dialogue and TL;DR summarization; the results are shown in Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.F4" title="Figure 4 ‣ D.1 Performance of Best of 𝑁 baseline for Various 𝑁 ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_figure" id="A4.F4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="305" id="A4.F4.g1" src="x5.png" width="407"></div>
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="305" id="A4.F4.g2" src="x6.png" width="407"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>Best of <math alttext="N" class="ltx_Math" display="inline" id="A4.F4.3.m1.1"><semantics id="A4.F4.3.m1.1b"><mi id="A4.F4.3.m1.1.1" xref="A4.F4.3.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="A4.F4.3.m1.1c"><ci id="A4.F4.3.m1.1.1.cmml" xref="A4.F4.3.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.F4.3.m1.1d">N</annotation><annotation encoding="application/x-llamapun" id="A4.F4.3.m1.1e">italic_N</annotation></semantics></math> baseline for <math alttext="N=\{1,4,16,64,128\}" class="ltx_Math" display="inline" id="A4.F4.4.m2.5"><semantics id="A4.F4.4.m2.5b"><mrow id="A4.F4.4.m2.5.6" xref="A4.F4.4.m2.5.6.cmml"><mi id="A4.F4.4.m2.5.6.2" xref="A4.F4.4.m2.5.6.2.cmml">N</mi><mo id="A4.F4.4.m2.5.6.1" xref="A4.F4.4.m2.5.6.1.cmml">=</mo><mrow id="A4.F4.4.m2.5.6.3.2" xref="A4.F4.4.m2.5.6.3.1.cmml"><mo id="A4.F4.4.m2.5.6.3.2.1" stretchy="false" xref="A4.F4.4.m2.5.6.3.1.cmml">{</mo><mn id="A4.F4.4.m2.1.1" xref="A4.F4.4.m2.1.1.cmml">1</mn><mo id="A4.F4.4.m2.5.6.3.2.2" xref="A4.F4.4.m2.5.6.3.1.cmml">,</mo><mn id="A4.F4.4.m2.2.2" xref="A4.F4.4.m2.2.2.cmml">4</mn><mo id="A4.F4.4.m2.5.6.3.2.3" xref="A4.F4.4.m2.5.6.3.1.cmml">,</mo><mn id="A4.F4.4.m2.3.3" xref="A4.F4.4.m2.3.3.cmml">16</mn><mo id="A4.F4.4.m2.5.6.3.2.4" xref="A4.F4.4.m2.5.6.3.1.cmml">,</mo><mn id="A4.F4.4.m2.4.4" xref="A4.F4.4.m2.4.4.cmml">64</mn><mo id="A4.F4.4.m2.5.6.3.2.5" xref="A4.F4.4.m2.5.6.3.1.cmml">,</mo><mn id="A4.F4.4.m2.5.5" xref="A4.F4.4.m2.5.5.cmml">128</mn><mo id="A4.F4.4.m2.5.6.3.2.6" stretchy="false" xref="A4.F4.4.m2.5.6.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.F4.4.m2.5c"><apply id="A4.F4.4.m2.5.6.cmml" xref="A4.F4.4.m2.5.6"><eq id="A4.F4.4.m2.5.6.1.cmml" xref="A4.F4.4.m2.5.6.1"></eq><ci id="A4.F4.4.m2.5.6.2.cmml" xref="A4.F4.4.m2.5.6.2">𝑁</ci><set id="A4.F4.4.m2.5.6.3.1.cmml" xref="A4.F4.4.m2.5.6.3.2"><cn id="A4.F4.4.m2.1.1.cmml" type="integer" xref="A4.F4.4.m2.1.1">1</cn><cn id="A4.F4.4.m2.2.2.cmml" type="integer" xref="A4.F4.4.m2.2.2">4</cn><cn id="A4.F4.4.m2.3.3.cmml" type="integer" xref="A4.F4.4.m2.3.3">16</cn><cn id="A4.F4.4.m2.4.4.cmml" type="integer" xref="A4.F4.4.m2.4.4">64</cn><cn id="A4.F4.4.m2.5.5.cmml" type="integer" xref="A4.F4.4.m2.5.5">128</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.F4.4.m2.5d">N=\{1,4,16,64,128\}</annotation><annotation encoding="application/x-llamapun" id="A4.F4.4.m2.5e">italic_N = { 1 , 4 , 16 , 64 , 128 }</annotation></semantics></math>. Performance plateaus after roughly 64-128 samples.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_subsection" id="A4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">D.2 </span>Sample Responses and GPT-4 Judgments</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A4.SS2.p1">
<p class="ltx_p" id="A4.SS2.p1.1">In this section, we present examples of comparisons between DPO and the baseline (PPO temp 0. for summarization, and the ground truth chosen response for dialogue). See Tables&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.T4" title="Table 4 ‣ D.2 Sample Responses and GPT-4 Judgments ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">4</span></a>-<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.T6" title="Table 6 ‣ D.2 Sample Responses and GPT-4 Judgments ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">6</span></a> for summarization examples, and Tables&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.T7" title="Table 7 ‣ D.2 Sample Responses and GPT-4 Judgments ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">7</span></a>-<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.T10" title="Table 10 ‣ D.2 Sample Responses and GPT-4 Judgments ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">10</span></a> for dialogue examples.
</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_table" id="A4.T4">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T4.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T4.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A4.T4.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T4.1.1.1.1.1">Prompt</span></th>
<td class="ltx_td ltx_align_justify ltx_border_tt" id="A4.T4.1.1.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T4.1.1.1.2.1">SUBREDDIT: r/AskReddit
TITLE: I’ve been ungrateful to parents who have wanted only the best for me for the longest time. I am so lucky to have the life I have but I squandered it, this isn’t a humblebrag about my "wicked life" just tell me, what can I do to make it up to them after this.
POST: I’m 17, leaving for University, and I’ve had epiphany after epiphany of how shitty i’ve beent to them, or how all the nice things they do I ruin with moods etc., I know there isn’t a quick fix, but I want to do something nice. I’ve always thanked them and apologized where it is due (in earlier years not so much) but as they say, actions speak louder than words, so I was wondering what can I do now, before I go, to just make them happy. What can I keep doing, I know all the little things, doing chores, keeping my room clean, cleaning up after myself, helping around the house, but what’s a big thing, for say christmas, or their birthdays, that I can do to make them happy?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T4.1.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T4.1.2.2.1"><span class="ltx_text ltx_font_bold" id="A4.T4.1.2.2.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T4.1.2.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T4.1.2.2.2.1">TL;DR: I’ve been a shitty child and I want to make up for it, what can I do for my parents on their birthdays and christmas to show them how much I love them?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T4.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T4.1.3.3.1"><span class="ltx_text ltx_font_bold" id="A4.T4.1.3.3.1.1">PPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T4.1.3.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T4.1.3.3.2.1">TL;DR: I’ve been a shitty person to my parents, what can I do to make it up to them, before I go, and what can I do after university to make them happy, and what can I do to make them happy after university (if that is the case)</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T4.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T4.1.4.4.1"><span class="ltx_text ltx_font_bold" id="A4.T4.1.4.4.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T4.1.4.4.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T4.1.4.4.2.1">Summary B <span class="ltx_text ltx_font_bold" id="A4.T4.1.4.4.2.1.1">[DPO]</span> more effectively captures the main points of the post by focusing on making the parents happy through gestures on special occasions, while Summary A seems repetitive and less clear.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span>Sample summaries to a post from the TL;DR test set. <span class="ltx_text ltx_font_bold" id="A4.T4.5.1">DPO</span> sample generated with a temperature 0.25; <span class="ltx_text ltx_font_bold" id="A4.T4.6.2">PPO</span> sample generated at a temperature of 0. The order in which summaries are presented in randomized when evaluating with GPT-4, so the order in the Judgment may not correspond to the order in the table. For clarity, post-hoc annotations are included in bold, formatted as <span class="ltx_text ltx_font_bold" id="A4.T4.7.3">[annotation]</span>. These annotations are not part of the model generations.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="A4.T5">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T5.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T5.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A4.T5.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T5.1.1.1.1.1">Prompt</span></th>
<td class="ltx_td ltx_align_justify ltx_border_tt" id="A4.T5.1.1.1.2" style="width:327.2pt;">
<div class="ltx_block ltx_align_top" id="A4.T5.1.1.1.2.1">
<p class="ltx_p" id="A4.T5.1.1.1.2.1.1">SUBREDDIT: r/relationships
TITLE: I [22 M] am about to propose to my girlfriend [22F] of almost 2 years, and I can’t calm myself down
POST: Alright, so I am preparing to propose to my girlfriend of almost 2 years
(we were friends for double that beforehand) in a couple days and I am starting to get EXTREMELY anxious/nervous. We have talked about this for months, and I know she will say yes, but I can’t seem to relax.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T5.1.1.1.2.1.2">The other day I bought the ring, which I fell in love with myself and know she will too. And then two days ago, I asked her dad’s blessing. Everything has gone great so far, but now leading up to it I can’t think about anything else. I can’t sleep. I am anxious as hell, and all I want to do is pop the question now, but I have to wait since I don’t see her until Thursday.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T5.1.1.1.2.1.3">I know how I am going to do it. I have thoroughly planned it out and I am more than prepared. But, at the same time, I am freaking out. I asked my best friend for advice since he just got married recently, and all he could say was "It will feel 10x worse right before you do ask."</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T5.1.1.1.2.1.4">Any suggestions on how to relax leading up to it? I would like to be able to sleep…</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</td>
</tr>
<tr class="ltx_tr" id="A4.T5.1.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T5.1.2.2.1"><span class="ltx_text ltx_font_bold" id="A4.T5.1.2.2.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T5.1.2.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T5.1.2.2.2.1">TL;DR: About to propose to my girlfriend of almost 2 years, but I am extremely anxious and can’t sleep. How can I relax?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T5.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T5.1.3.3.1"><span class="ltx_text ltx_font_bold" id="A4.T5.1.3.3.1.1">PPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T5.1.3.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T5.1.3.3.2.1">TL;DR: I am about to ask my girlfriend of almost 2 years to marry me, and I can’t calm myself down. Any tips on how to relax? I would like to be able to sleep tonight (and the night before)………………………………………………………………………………………………………………</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T5.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T5.1.4.4.1"><span class="ltx_text ltx_font_bold" id="A4.T5.1.4.4.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T5.1.4.4.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T5.1.4.4.2.1">Summary A <span class="ltx_text ltx_font_bold" id="A4.T5.1.4.4.2.1.1">[DPO]</span> more effectively summarizes the main points of the post, concisely conveying the asker’s anxiety and goal of finding ways to relax.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 5: </span>Sample summaries to a post from the TL;DR test set. <span class="ltx_text ltx_font_bold" id="A4.T5.5.1">DPO</span> sample generated with a temperature 0.25; <span class="ltx_text ltx_font_bold" id="A4.T5.6.2">PPO</span> sample generated at a temperature of 0. The order in which summaries are presented in randomized when evaluating with GPT-4, so the order in the Judgment may not correspond to the order in the table. For clarity, post-hoc annotations are included in bold, formatted as <span class="ltx_text ltx_font_bold" id="A4.T5.7.3">[annotation]</span>. These annotations are not part of the model generations.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="A4.T6">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T6.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A4.T6.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A4.T6.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T6.1.1.1.1.1">Prompt</span></th>
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A4.T6.1.1.1.2" style="width:327.2pt;">
<div class="ltx_block ltx_align_top" id="A4.T6.1.1.1.2.1">
<p class="ltx_p" id="A4.T6.1.1.1.2.1.1">SUBREDDIT: r/loseit
TITLE: Is It Bullshit?: Fiber Gourmet Pasta
POST: I was looking for low-cal alternatives to pasta, because I love pasta and it’s easy to make and I eat it several times a week. I find that whole grain pasta has a weird taste/texture, and I’m not a big fan of it.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T6.1.1.1.2.1.2">I was doing some research into spaghetti squash (which is on my grocery list for next time), but I also heard someone rave about some high-fiber pasta brand so I looked into it.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T6.1.1.1.2.1.3">What sorcery is this? It has all the trappings of regular pasta (and the reviews I’ve read say it tastes the same too) but a little over half the calories. My mind boggles over how much extra pasta I could eat! I can’t believe this hasn’t taken the world by storm, which makes me wonder what the catch is.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T6.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T6.1.2.1.1"><span class="ltx_text ltx_font_bold" id="A4.T6.1.2.1.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T6.1.2.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T6.1.2.1.2.1">TL;DR: I’m trying to cut back on calories and pasta is one of my main sources. Found a high-fiber pasta that has all the trappings of regular pasta and seems like it would be a good substitute. Is it bullshit?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T6.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T6.1.3.2.1"><span class="ltx_text ltx_font_bold" id="A4.T6.1.3.2.1.1">PPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T6.1.3.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T6.1.3.2.2.1">TL;DR: I want to lose weight, but I love pasta and don’t want to give it up. Is there a high-fiber pasta that I can eat more of and lose weight with, or is it all bullshit?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T6.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T6.1.4.3.1"><span class="ltx_text ltx_font_bold" id="A4.T6.1.4.3.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T6.1.4.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T6.1.4.3.2.1">Summary B <span class="ltx_text ltx_font_bold" id="A4.T6.1.4.3.2.1.1">[DPO]</span> more accurately captures the intent to find a low-calorie pasta alternative, without assuming the need for weight loss.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 6: </span>Sample summaries to a post from the TL;DR test set. <span class="ltx_text ltx_font_bold" id="A4.T6.5.1">DPO</span> sample generated with a temperature 0.25; <span class="ltx_text ltx_font_bold" id="A4.T6.6.2">PPO</span> sample generated at a temperature of 0. The order in which summaries are presented in randomized when evaluating with GPT-4, so the order in the Judgment may not correspond to the order in the table. For clarity, post-hoc annotations are included in bold, formatted as <span class="ltx_text ltx_font_bold" id="A4.T6.7.3">[annotation]</span>. These annotations are not part of the model generations.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="A4.T7">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T7.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A4.T7.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A4.T7.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T7.1.1.1.1.1">Prompt</span></th>
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A4.T7.1.1.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T7.1.1.1.2.1">Can you help me write an essay on the Civil Rights Movement?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T7.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T7.1.2.1.1"><span class="ltx_text ltx_font_bold" id="A4.T7.1.2.1.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T7.1.2.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T7.1.2.1.2.1">The Civil Rights Movement was a series of social and political movements that took place between the 1950s and the 1980s, leading to the integration of public spaces, higher education, employment, and voting rights. The movement is often credited with the end of legal segregation in the United States, and it was a major catalyst for the Civil Rights Act of 1964. The Movement also played a large role in the rise of the Black Power and Civil Rights Movements, which focused on economic equality and racial justice. The Movement focused on the rights of African Americans, who were then the dominant racial and ethnic group in the United States, but it also highlighted the rights of other minority groups, such as women, immigrants, and LGBT people. The Movement is often considered one of the most important social movements of the 20th century, and it played a significant role in the advancement of civil rights for all Americans. I’ll be happy to write an essay on this topic for you. What kind of essay would you like? A paper on the history of the Civil Rights Movement? A paper on the causes of the Civil Rights Movement? Or a paper on the effects of the Civil Rights Movement? Any ideas? I’ll be happy to <span class="ltx_text ltx_font_bold" id="A4.T7.1.2.1.2.1.1">[maximum generation length reached]</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T7.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T7.1.3.2.1"><span class="ltx_text ltx_font_bold" id="A4.T7.1.3.2.1.1">GT</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T7.1.3.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T7.1.3.2.2.1">Oh, I’m not sure if I can actually write an essay, but I can at least help you think through the process. First, can you tell me what you’re trying to write about? In other words, what are the main points or questions you want to address?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T7.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T7.1.4.3.1"><span class="ltx_text ltx_font_bold" id="A4.T7.1.4.3.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T7.1.4.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T7.1.4.3.2.1">Response B <span class="ltx_text ltx_font_bold" id="A4.T7.1.4.3.2.1.1">[DPO]</span> provides more detailed information about the Civil Rights Movement and offers specific suggestions for essay topics, making it more helpful for someone writing an essay.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span>GPT-4 chooses DPO over GT. Sample responses to a prompt from the Anthropic-HH test set. <span class="ltx_text ltx_font_bold" id="A4.T7.5.1">DPO</span> sample generated with temperature 0.7; <span class="ltx_text ltx_font_bold" id="A4.T7.6.2">GT</span> is the chosen completion in the dataset of preferences. For clarity, post-hoc annotations are included in bold, formatted as <span class="ltx_text ltx_font_bold" id="A4.T7.7.3">[annotation]</span>. These annotations are not part of the model generations.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="A4.T8">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T8.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A4.T8.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A4.T8.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T8.1.1.1.1.1">Prompt</span></th>
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A4.T8.1.1.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T8.1.1.1.2.1">I am trying to locate the residential address for J.B. Pritzker, an hier <span class="ltx_text ltx_font_bold" id="A4.T8.1.1.1.2.1.1">[sic]</span> to the Hyatt Hotel fortune.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T8.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T8.1.2.1.1"><span class="ltx_text ltx_font_bold" id="A4.T8.1.2.1.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T8.1.2.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T8.1.2.1.2.1">I am not able to assist you in this matter. It’s unlawful and irresponsible to locate private information on people without their consent, and I’m not aware of any way you could do this for human. Please stop this activity.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T8.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T8.1.3.2.1"><span class="ltx_text ltx_font_bold" id="A4.T8.1.3.2.1.1">GT</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T8.1.3.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T8.1.3.2.2.1">J.B. Pritzker is one of the co-founders and investors in Hyatt. He and his family have been listed in the Forbes 400, and the family also maintains a 4,000-acre ranch in Colorado.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T8.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T8.1.4.3.1"><span class="ltx_text ltx_font_bold" id="A4.T8.1.4.3.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T8.1.4.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T8.1.4.3.2.1">Response A <span class="ltx_text ltx_font_bold" id="A4.T8.1.4.3.2.1.1">[DPO]</span> emphasizes the importance of privacy and laws, while Response B gives background information on J.B. Pritzker without providing his address.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 8: </span>GPT-4 chooses DPO over GT. Sample responses to a prompt from the Anthropic-HH test set. <span class="ltx_text ltx_font_bold" id="A4.T8.5.1">DPO</span> sample generated with temperature 1.0; <span class="ltx_text ltx_font_bold" id="A4.T8.6.2">GT</span> is the chosen completion in the dataset of preferences. For clarity, post-hoc annotations are included in bold, formatted as <span class="ltx_text ltx_font_bold" id="A4.T8.7.3">[annotation]</span>. These annotations are not part of the model generations.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="A4.T9">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T9.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A4.T9.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A4.T9.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T9.1.1.1.1.1">Prompt</span></th>
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A4.T9.1.1.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T9.1.1.1.2.1">Can you tell me what got the USA involved in World War II?</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T9.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T9.1.2.1.1"><span class="ltx_text ltx_font_bold" id="A4.T9.1.2.1.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T9.1.2.1.2" style="width:327.2pt;">
<div class="ltx_block ltx_align_top" id="A4.T9.1.2.1.2.1">
<p class="ltx_p" id="A4.T9.1.2.1.2.1.1">In the 1930s, the United States found itself at the center of a growing political and economic crisis that threatened the world’s stability. The Great Depression had brought many other countries to the brink, including many European ones, and the United States found itself in a very precarious position. The Great Depression had left the government and the economy on the edge of collapse, it faced severe international indebtedness, and it faced the threat of a foreign default on its loans. When Japan attacked China in October 1937, the United States found itself in an especially dangerous military position, as the United States was the largest creditor.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T9.1.2.1.2.1.2">The United States found itself desperately seeking ways to avoid a complete collapse, and two main strategies emerged: both involved creating an alliance of nations to protect American economic security and stability, as well as ensuring that the United States remained politically relevant. The first strategy was to create a “coalition of the willing”, a network of international alliances to counteract the isolation and vulnerability of countries like Japan. The second strategy was to form an “all-inclusive association”, a group of nations that the United States would be the most powerful member of, and which would protect the prosperity of the United States and protect it from other powers <span class="ltx_text ltx_font_bold" id="A4.T9.1.2.1.2.1.2.1">[maximum generation length reached]</span></p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</td>
</tr>
<tr class="ltx_tr" id="A4.T9.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T9.1.3.2.1"><span class="ltx_text ltx_font_bold" id="A4.T9.1.3.2.1.1">GT</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T9.1.3.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T9.1.3.2.2.1">The United States entered the war against Japan in response to the Japanese attack on Pearl Harbor, Hawaii, on December 7, 1941. This was a full month before the United States officially entered the war. At this point, the German Axis powers controlled France, Belgium, Norway, and other parts of Europe, and held significant military influence in much of Asia. President Roosevelt officially asked Congress for a declaration of war against Japan after the bombing of Pearl Harbor.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T9.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T9.1.4.3.1"><span class="ltx_text ltx_font_bold" id="A4.T9.1.4.3.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T9.1.4.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T9.1.4.3.2.1">Response B <span class="ltx_text ltx_font_bold" id="A4.T9.1.4.3.2.1.1">[GT]</span> provides a direct and accurate answer to the question, while Response A is overly complicated and doesn’t provide the correct answer.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 9: </span>GPT-4 chooses GT over DPO. DPO’s response is verbose and plausible, but contains factually incorrect information (the ‘coalition of the willing’ does not refer to events of WWII; the ‘all-inclusive association’ is not a real organization).</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="A4.T10">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T10.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A4.T10.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A4.T10.1.1.1.1"><span class="ltx_text ltx_font_bold" id="A4.T10.1.1.1.1.1">Prompt</span></th>
<th class="ltx_td ltx_align_justify ltx_th ltx_th_column ltx_border_tt" id="A4.T10.1.1.1.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T10.1.1.1.2.1">what is 7 plus 2</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T10.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T10.1.2.1.1"><span class="ltx_text ltx_font_bold" id="A4.T10.1.2.1.1.1">DPO</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T10.1.2.1.2" style="width:327.2pt;">
<div class="ltx_block ltx_align_top" id="A4.T10.1.2.1.2.1">
<p class="ltx_p" id="A4.T10.1.2.1.2.1.1">Hm, let me see… seven plus two is nine, I’m pretty sure. I’ll be happy to read the input aloud and double check if I’ve got it right. Let me try:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T10.1.2.1.2.1.2">"7 + 2"</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T10.1.2.1.2.1.3">I’ve got that right! I think our input was meant to be seven, plus two. You can try it yourself:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T10.1.2.1.2.1.4">"7 + 2"</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T10.1.2.1.2.1.5">"9"</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T10.1.2.1.2.1.6">I’ve got that right! Now, what I’m wondering is if you want to learn this formula for yourself, or if you want me to help you practice it. The formula is called the “arithmetic-prefix method”, and it’s a great way to memorize numbers – and in fact I personally learned to count by memorizing the arithmatic prefixes!
I’ll give you a refresher on arithmatic prefixes: you can think of them as an abbreviated way of describing a number by its first two significant digits. There are three arithmatic prefixes:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="A4.T10.1.2.1.2.1.7">The “1-arithmatic prefix” (1-A)
The “2-arithmatic prefix” (2-A)</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
</td>
</tr>
<tr class="ltx_tr" id="A4.T10.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A4.T10.1.3.2.1"><span class="ltx_text ltx_font_bold" id="A4.T10.1.3.2.1.1">GT</span></th>
<td class="ltx_td ltx_align_justify ltx_border_t" id="A4.T10.1.3.2.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T10.1.3.2.2.1">11</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
<tr class="ltx_tr" id="A4.T10.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A4.T10.1.4.3.1"><span class="ltx_text ltx_font_bold" id="A4.T10.1.4.3.1.1">Judgment</span></th>
<td class="ltx_td ltx_align_justify ltx_border_bb ltx_border_t" id="A4.T10.1.4.3.2" style="width:327.2pt;">
<p class="ltx_p ltx_align_top" id="A4.T10.1.4.3.2.1">Response B <span class="ltx_text ltx_font_bold" id="A4.T10.1.4.3.2.1.1">[GT]</span> provides a direct and accurate answer to the question, while Response A is overly complicated and doesn’t provide the correct answer.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 10: </span>GPT-4 chooses GT over DPO. GPT-4 incorrectly states that the ground truth is correct while DPO’s (more verbose) output is wrong.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_subsection" id="A4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">D.3 </span>Human study details</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_figure ltx_align_floatright" id="A4.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="405" id="A4.F5.g1" src="extracted/5293438/figures/results/survey.png" width="341">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5: </span>Layout of the survey in SurveyMonkey. Each respondent completed 25 similarly-formatted judgments.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A4.SS3.p1">
<p class="ltx_p" id="A4.SS3.p1.1">In order to validate the usage of GPT-4 for computing win rates, our human study collects human preference data for several matchups in the TL;DR summarization setting. We select three different algorithmic matchups, evaluating DPO (temp. 0.25), SFT (temp. 0.25), and PPO (temp 1.0) compared to the reference algorithm PPO (temp 0.). By selecting matchups for three unique algorithms as well as algorithms with a wide range of win rates vs the reference, we capture the similarity of human and GPT-4 win rates across the response quality spectrum. We sample 150 random comparisons of DPO vs PPO-0 and 100 random comparisons PPO-1 vs PPO-0, assigning two humans to each comparison, producing 275 judgments for DPO-PPO<span class="ltx_note ltx_role_footnote" id="footnote6"><sup class="ltx_note_mark">6</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">6</sup><span class="ltx_tag ltx_tag_note">6</span>One volunteer did not respond for the DPO-PPO comparison.</span></span></span> and 200 judgments for PPO-PPO. We sample 125 SFT comparisons, assigning a single human to each. We ignore judgments that humans labeled as ties (which amount to only about 1% of judgments), and measure the raw agreement percentage between human A and human B (for comparisons where we have two human annotators, i.e., not SFT) as well as between each human and GPT-4.</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<section class="ltx_paragraph" id="A4.SS3.SSS0.Px1">
<h4 class="ltx_title ltx_title_paragraph">Participants.</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="A4.SS3.SSS0.Px1.p1">
<p class="ltx_p" id="A4.SS3.SSS0.Px1.p1.1">We have 25 volunteer human raters in total, each comparing 25 summaries (one volunteer completed the survey late and was not included in the final analysis, but is listed here). The raters were Stanford students (from undergrad through Ph.D.), or recent Stanford graduates or visitors, with a STEM (mainly CS) focus. See Figure&nbsp;<a class="ltx_ref" href="https://arxiv.org/html/2305.18290v2#A4.F5" title="Figure 5 ‣ D.3 Human study details ‣ Appendix D Additional Empirical Results ‣ Direct Preference Optimization: Your Language Model is Secretly a Reward Model"><span class="ltx_text ltx_ref_tag">5</span></a> for a screenshot of the survey interface. We gratefully acknowledge the contribution of each of our volunteers, listed in random order:</p><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</div>
<figure class="ltx_table" id="A4.SS3.SSS0.Px1.tab1">
<table class="ltx_tabular ltx_align_middle" id="A4.SS3.SSS0.Px1.tab1.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.1.1">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.1.1.1">1. Gordon Chi</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.1.1.2">2. Virginia Adams</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.1.1.3">3. Max Du</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.1.1.4">4. Kaili Huang</td>
</tr>
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.2.2">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.2.2.1">5. Ben Prystawski</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.2.2.2">6. Ioanna Vavelidou</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.2.2.3">7. Victor Kolev</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.2.2.4">8. Karel D’Oosterlinck</td>
</tr>
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.3.3">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.3.3.1">9. Ananth Agarwal</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.3.3.2">10. Tyler Lum</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.3.3.3">11. Mike Hardy</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.3.3.4">12. Niveditha Iyer</td>
</tr>
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.4.4">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.4.4.1">13. Helena Vasconcelos</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.4.4.2">14. Katherine Li</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.4.4.3">15. Chenchen Gu</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.4.4.4">16. Moritz Stephan</td>
</tr>
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.5.5">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.5.5.1">17. Swee Kiat Lim</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.5.5.2">18. Ethan Chi</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.5.5.3">19. Kaien Yang</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.5.5.4">20. Ryan Chi</td>
</tr>
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.6.6">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.6.6.1">21. Joy Yun</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.6.6.2">22. Abhay Singhal</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.6.6.3">23. Siyan Li</td>
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.6.6.4">24. Amelia Hardy</td>
</tr>
<tr class="ltx_tr" id="A4.SS3.SSS0.Px1.tab1.1.7.7">
<td class="ltx_td ltx_align_left" id="A4.SS3.SSS0.Px1.tab1.1.7.7.1">25. Zhengxuan Wu</td>
<td class="ltx_td" id="A4.SS3.SSS0.Px1.tab1.1.7.7.2"></td>
<td class="ltx_td" id="A4.SS3.SSS0.Px1.tab1.1.7.7.3"></td>
<td class="ltx_td" id="A4.SS3.SSS0.Px1.tab1.1.7.7.4"></td>
</tr>
</tbody>
</table>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
</section>
</section>
</article>
</div>

</div>


<div class="ltx_page_footer">
        <div class="ltx_page_logo">
            Generated on Wed Dec 14 18:01:44 2022 by
            <a href="https://math.nist.gov/~BMiller/LaTeXML/" class="ltx_LaTeXML_logo">
                <span style="letter-spacing: -0.2em; margin-right: 0.1em;">
                    L
                    <span style="font-size: 70%; position: relative; bottom: 2.2pt;">A</span>
                    T
                    <span style="position: relative; bottom: -0.4ex;">E</span>
                </span>
                <span class="ltx_font_smallcaps">xml</span>
                <img alt="[LOGO]" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==">
            </a>
        </div></div><footer id="footer" class="ltx_document">
        <div class="keyboard-glossary">
            <h2>Instructions for reporting errors</h2>
            <p>We are continuing to improve HTML versions of papers, and your feedback helps enhance accessibility and mobile support. To report errors in the HTML that will help us improve conversion and rendering, choose any of the methods listed below:</p>
            <ul>
                <li>Click the "Report Issue" button.</li>
                <li>Open a report feedback form via keyboard, use "<strong>Ctrl + ?</strong>".</li>
                <li>Make a text selection and click the "Report Issue for Selection" button near your cursor.</li>
                <li class="sr-only">You can use Alt+Y to toggle on and Alt+Shift+Y to toggle off accessible reporting links at each section.</li>
            </ul>
            <p>Our team has already identified <a class="ltx_ref" href="https://github.com/arXiv/html_feedback/issues" target="_blank">the following issues</a>. We appreciate your time reviewing and reporting rendering errors we may not have found yet. Your efforts will help us improve the HTML versions for all readers, because disability should not be a barrier to accessing research. Thank you for your continued support in championing open access for all.</p>
            <p>Have a free development cycle? Help support accessibility at arXiv! Our collaborators at LaTeXML maintain a <a class="ltx_ref" href="https://github.com/brucemiller/LaTeXML/wiki/Porting-LaTeX-packages-for-LaTeXML" target="_blank">list of packages that need conversion</a>, and welcome <a class="ltx_ref" href="https://github.com/brucemiller/LaTeXML/issues" target="_blank">developer contributions</a>.</p>
        </div>
    </footer><button type="button" class="btn btn-primary hover-rp-button" id="openForm">Report Issue</button><div class="modal" id="myForm" role="dialog" aria-labelledby="modal-title"><div class="modal-dialog"><form class="modal-content" id="myFormContent" enctype="multipart/form-data"><div class="modal-header" id="modal-header"><h5 class="modal-title">Report Github Issue</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><label for="form_title" id="modalTitle">Title:</label><input class="form-control" id="form_title" name="form_title" required="required" placeholder="Enter title"><label for="description" id="selectedTextModalDescription" style="display: none;">Content selection saved. Describe the issue below:</label><label for="description" id="nomralModalDescription">Description:</label><textarea class="form-control" id="description" name="description" required="required" style="height: 80px;" maxlength="500" placeholder="500 characters maximum"></textarea></div><div class="modal-footer d-flex justify-content-end"><button type="submit" class="sr-only button" id="modal-submit-sr">Submit without Github</button><button type="submit" class="btn btn-primary" id="modal-submit">Submit in Github</button></div></form></div></div><button id="small-report-button" type="button" class="btn btn-secondary btn-sm" style="background-color: rgb(179, 27, 27); position: fixed;">Report Issue for Selection</button></body></html>