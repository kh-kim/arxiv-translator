<html lang="en" data-theme="light"><head>
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<title>Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM</title>
<!--Generated on Tue Mar 12 16:56:50 2024 by LaTeXML (version 0.8.7) http://dlmf.nist.gov/LaTeXML/.-->
<!--Document created on March 12, 2024.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="https://arxiv.org/static/browse/0.3.4/css/ar5iv_0.7.4.min.css" rel="stylesheet" type="text/css">
<link href="https://arxiv.org/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="https://arxiv.org/static/browse/0.3.4/js/addons.js"></script>
<script src="https://arxiv.org/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="https://arxiv.org/html/2403.07816v1/"><link rel="stylesheet" href="https://use.typekit.net/rwr5zpx.css"><link rel="icon" type="image/png" href="https://static.arxiv.org/static/browse/0.3.4/images/icons/favicon-16x16.png" sizes="16x16"><link rel="icon" type="image/png" href="https://static.arxiv.org/static/browse/0.3.4/images/icons/favicon-32x32.png" sizes="32x32"></head>
<body><header class="mob_header">
    <div class="html-header-logo">
      <a href="https://arxiv.org/">
        <img alt="logo" class="logomark" role="presentation" width="100" src="https://services.dev.arxiv.org/html/static/arxiv-logomark-small-white.svg">
        <span class="sr-only">Back to arXiv</span>
      </a>
    </div>

    <!--TOC, dark mode, links-->
    <div class="html-header-nav">
      <!--back to abstract-->
      
        <a class="nav-link ar5iv-footer-button hover-effect" aria-label="Back to abstract page" href="https://arxiv.org/abs/2403.07816v1">
        <svg xmlns="http://www.w3.org/2000/svg" height="1.25em" viewBox="0 0 512 512" fill="#ffffff" aria-hidden="true">
            <path d="M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 192 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l210.7 0-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128zM160 96c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 32C43 32 0 75 0 128L0 384c0 53 43 96 96 96l64 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-64 0c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l64 0z"></path>
        </svg>
        </a>
      <!--dark mode-->
      <a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle dark/light mode">
        <span class="color-scheme-icon" aria-label="Light mode"></span>
      </a>
      <!--nav-->
      <button class="navbar-toggler ar5iv-footer-button" type="button" data-bs-theme="dark" data-bs-toggle="collapse" aria-expanded="false" data-bs-target=".ltx_page_main >.ltx_TOC.mobile" aria-controls="navbarSupportedContent" aria-label="Toggle navigation" style="border:none; margin-right: 0em;">
        <svg xmlns="http://www.w3.org/2000/svg" height="1.25em" viewBox="0 0 448 512" aria-hidden="true" role="img" fill="#ffffff"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"></path></svg>
      </button>
    </div>
    </header><header class="desktop_header">
    <div class="html-header-logo">
      <a href="https://arxiv.org/">
          <img alt="logo" class="logo" role="presentation" width="100" src="https://services.dev.arxiv.org/html/static/arxiv-logo-one-color-white.svg">
          <span class="sr-only">Back to arXiv</span>
      </a>
    </div>
    <div class="html-header-message" role="banner">
        <p>This is <strong>experimental HTML</strong> to improve accessibility. We invite you to report rendering errors. <span class="sr-only">Use Alt+Y to toggle on accessible reporting links and Alt+Shift+Y to toggle off.</span> Learn more <a href="https://info.arxiv.org/about/accessible_HTML.html" target="_blank">about this project</a> and <a href="https://info.arxiv.org/help/submit_latex_best_practices.html" target="_blank">help improve conversions</a>.
        </p>
    </div>
    <nav class="html-header-nav">
      <a class="ar5iv-footer-button hover-effect" href="https://info.arxiv.org/about/accessible_HTML.html" target="_blank">Why HTML?</a>
      <a class="ar5iv-footer-button hover-effect" target="_blank" href="#myForm" onclick="event.preventDefault(); var modal = document.getElementById('myForm'); modal.style.display = 'block'; bugReportState.setInitiateWay('Header');">Report Issue</a>
      <a class="ar5iv-footer-button hover-effect" href="https://arxiv.org/abs/2403.07816v1">Back to Abstract</a>
      <a class="ar5iv-footer-button hover-effect" href="https://arxiv.org/pdf/2403.07816v1" target="_blank">Download PDF</a>
      <a class="ar5iv-toggle-color-scheme" href="javascript:toggleColorScheme()" title="Toggle dark/light mode">
          <span class="color-scheme-icon"></span>
      </a>
    </nav></header>

<div class="ltx_page_main" id="main">
<nav class="ltx_TOC mobile collapse" aria-labelledby="toc_header"><h2 id="toc_header" class="sr-only">Table of Contents</h2>

      <div id="listIcon" type="button" class="hide">
          <svg width="17px" height="17px" viewBox="0 0 512 512" style="pointer-events: none;">
          <path d="M40 48C26.7 48 16 58.7 16 72v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V72c0-13.3-10.7-24-24-24H40zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32H480c17.7 0 32-14.3 32-32s-14.3-32-32-32H192zM16 232v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V232c0-13.3-10.7-24-24-24H40c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24H88c13.3 0 24-10.7 24-24V392c0-13.3-10.7-24-24-24H40z"></path>
          </svg>
      </div>
      <div id="arrowIcon" type="button">
          <svg width="17px" height="17px" viewBox="0 0 448 512" style="pointer-events: none;">
          <path d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"></path>
          </svg>
      </div><ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S1" title="1 Introduction ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S2" title="2 Related Work ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S2.SS0.SSS0.Px1" title="Asynchronous parallel training ‣ 2 Related Work ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Asynchronous parallel training</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S2.SS0.SSS0.Px2" title="Mixture-of-Experts ‣ 2 Related Work ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Mixture-of-Experts</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S2.SS0.SSS0.Px3" title="Continual learning ‣ 2 Related Work ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Continual learning</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3" title="3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Branch-Train-MiX</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS1" title="3.1 Branch &amp; Train: Embarrassingly Parallel Expert Training ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Branch &amp; Train: Embarrassingly Parallel Expert Training</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS2" title="3.2 MiX: Combining Separate Experts to be a Mixture-of-Experts ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>MiX: Combining Separate Experts to be a Mixture-of-Experts</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS3" title="3.3 Variations ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Variations</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS3.SSS0.Px1" title="Load balancing ‣ 3.3 Variations ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Load balancing</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS3.SSS0.Px2" title="Routing method ‣ 3.3 Variations ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Routing method</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS3.SSS0.Px3" title="Splitting Experts ‣ 3.3 Variations ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Splitting Experts</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS3.SSS0.Px4" title="Blending Experts ‣ 3.3 Variations ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Blending Experts</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4" title="4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS1" title="4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Experimental Setup</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS1.SSS1" title="4.1.1 BTX Training ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.1 </span>BTX Training</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS1.SSS2" title="4.1.2 Baselines ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.2 </span>Baselines</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS1.SSS3" title="4.1.3 Evaluation ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1.3 </span>Evaluation</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2" title="4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Main Results</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2.SSS1" title="4.2.1 Overall Performance ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2.1 </span>Overall Performance</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2.SSS1.Px1" title="Domain experts excel at their respective tasks. ‣ 4.2.1 Overall Performance ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Domain experts excel at their respective tasks.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2.SSS1.Px2" title="BTX improves all tasks where experts specialize. ‣ 4.2.1 Overall Performance ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">BTX improves all tasks where experts specialize.</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsubsection">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2.SSS2" title="4.2.2 Better compute-performance tradeoff ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2.2 </span>Better compute-performance tradeoff</span></a>
<ol class="ltx_toclist ltx_toclist_subsubsection">
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2.SSS2.Px1" title="Better performance than dense and BTM. ‣ 4.2.2 Better compute-performance tradeoff ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">Better performance than dense and BTM.</span></a></li>
<li class="ltx_tocentry ltx_tocentry_paragraph"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS2.SSS2.Px2" title="More efficient than sparse upcycling. ‣ 4.2.2 Better compute-performance tradeoff ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title">More efficient than sparse upcycling.</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_subsection">
<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS3" title="4.3 Ablations &amp; Analysis ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Ablations &amp; Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_subsection">
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS3.SSS1" title="4.3.1 Ablations of BTX training ‣ 4.3 Ablations &amp; Analysis ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3.1 </span>Ablations of BTX training</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsubsection"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS3.SSS2" title="4.3.2 Routing Analysis ‣ 4.3 Ablations &amp; Analysis ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3.2 </span>Routing Analysis</span></a></li>
</ol>
</li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S5" title="5 Conclusion ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S6" title="6 Limitations &amp; Future Work ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Limitations &amp; Future Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S7" title="7 Acknowledgements ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Acknowledgements</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S8" title="8 Data mixture ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">8 </span>Data mixture</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S9" title="9 Evaluation ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">9 </span>Evaluation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S10" title="10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">10 </span>Routing analysis</span></a></li>
</ol></nav>

<div class="ltx_page_content"><div class="section" id="target-section"><div id="license-tr">License: arXiv.org perpetual non-exclusive license</div><div id="watermark-tr">arXiv:2403.07816v1 [cs.CL] 12 Mar 2024</div></div>
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Branch-Train-MiX: 
<br class="ltx_break">Mixing Expert LLMs into a Mixture-of-Experts LLM
</h1><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Sainbayar Sukhbaatar
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Olga Golovneva
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Vasu Sharma
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Hu Xu
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Xi Victoria Lin
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Baptiste Rozière
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Jacob Kahn
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Daniel Li
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Wen-tau Yih
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Jason Weston
</span></span>
<span class="ltx_author_before">  </span><span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Xian Li
</span><span class="ltx_author_notes">
<span class="ltx_contact ltx_role_affiliation">FAIR at Meta
</span></span></span>
</div><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_dates">(March 12, 2024)</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<p class="ltx_p" id="id1.id1">우리는 코딩, 수학 추론 및 세계 지식과 같은 여러 전문 영역에서 능력을 보유하기 위해 대규모 언어 모델(LLM)을 훈련하는 효율적인 방법을 조사한다. 브랜치-트레인-MiX(Branch-Train-MiX, BTX)는 시드 모델로부터 시작되며, 이는 높은 처리율과 감소된 통신 비용으로 당혹스러울 정도로 병렬 방식으로 전문가를 훈련시키기 위해 분기된다. 개별 전문가가 비동기식으로 훈련된 후 BTX는 MoE(Mixture-of-Expert) 계층에서 전문가로서 피드포워드 매개변수를 모으고 나머지 매개변수를 평균한 다음 MoE-파이너닝 단계를 거쳐 토큰 수준 라우팅을 학습한다. BTX는 라우팅 학습을 위한 MoE 미세조정 단계가 없는 Branch-Train-Merge 방식과 전문가를 비동기적으로 훈련하는 단계를 생략한 희소 업사이클링이라는 두 가지 특수한 경우를 일반화하고 있다. 대안적 접근법과 비교하여 BTX는 최상의 정확성-효율성 트레이드오프를 달성한다.</p>
</div>
<span class="ltx_ERROR undefined" id="id1">\correspondence</span>
<div class="ltx_para" id="p1">
<p class="ltx_p" id="p1.1">{sainbar,xianl}@meta.com <span class="ltx_text" id="p1.1.1" lang="en"></span></p>
</div>
<section class="ltx_section" id="S1" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">최근 LLM(Large Language Models)은 코드 생성 <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib28" title="">2022b</a>; Rozière et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib31" title="">2023</a>)</cite>, 수학 문제 해결 <cite class="ltx_cite ltx_citemacro_citep">(Azerbayev et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib5" title="">2023</a>)</cite>, 다중 언어성 <cite class="ltx_cite ltx_citemacro_citep">(Zhao et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib42" title="">2024</a>)</cite> 등의 광범위한 과제 <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib7" title="">2020</a>; Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib37" title="">2023</a>; Achiam et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib1" title="">2023</a>)</cite>에서 인상적인 성능을 보이고 있다. 이러한 LLM을 학습하려면 수천 개의 GPU 및 수조 개의 토큰을 초과하는 많은 양의 컴퓨팅 및 데이터가 필요합니다. 훈련 병렬화는 일반적으로 모델의 여러 복사본을 서로 다른 GPU에 유지하고 각 가중치 업데이트 후에 동기화 상태를 유지함으로써 수행된다. 이 빈번한 통신 비용은 교육을 더 많은 GPU로 확장하는 데 있어 주요 병목 현상입니다. 이 문제 외에도 동기화된 훈련은 단일 장애 GPU로 인해 전체 훈련이 <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib41" title="">2022</a>; Gemini Team, <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib14" title="">2023</a>)</cite>를 중단할 수 있기 때문에 하드웨어 장애에 더 취약합니다.</p>
</div>
<div class="ltx_para" id="S1.p2">
<p class="ltx_p" id="S1.p2.1"><cite class="ltx_cite ltx_citemacro_cite">Li et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib27" title="">2022a</a>)</cite>에 의한 최근 연구는 사전 훈련의 처리량을 향상시키기 위한 동기화 없이 LLM의 당황스러운 병렬 훈련을 위한 Branch-Train-Merge (BTM) 방법을 제안하였다. 시드 LLM의 여러 복사본을 만든 다음 각 복사본을 서로 다른 데이터 하위 집합에 개별적으로 교육하는 것으로 시작합니다. 이로 인해 매개 변수를 공유하지 않는 여러 개의 독립적인 LLM이 생성되며 각 LLM은 지식 도메인, 언어 또는 모달리티와 같은 자체 데이터 배포를 전문으로 하는 전문가이다. 테스트 시, 입력 프롬프트가 하나 이상의 도메인으로 분류되고, 그 다음 최종 출력들이 다음 토큰을 예측하기 위해 조합되는 대응하는 전문가 모델들로부터 형성된다. 이 방법은 훈련의 효율성을 높이지만, 단일 모델의 부재로 인해 더 이상의 감독된 미세 조정(supervised finetuning, SFT)이나 인간 피드백으로부터의 강화 학습(reinforcement learning from human feedback,RLHF) 미세 조정 <cite class="ltx_cite ltx_citemacro_citep">(Ouyang et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib29" title="">2022</a>)</cite>를 수행할 수 없다는 것이 주요 단점으로, 둘 다 성능을 더 높일 수 있으며 정렬된 LLM을 구축하는 데 중요한 단계이다.</p>
</div>
<div class="ltx_para" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">LLM의 계산 공간을 줄이기 위한 별도의 작업 라인은 MoE(Mixture-of-Experts) 접근법 <cite class="ltx_cite ltx_citemacro_citep">(Jacobs et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib19" title="">1991</a>; Shazeer et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib36" title="">2017</a>)</cite>이며, 여기서 매개 변수의 하위 집합만 특정 시간에 활성화된다. 특히, MoE는 Transformers <cite class="ltx_cite ltx_citemacro_citep">(Fedus et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib13" title="">2022</a>; Roller et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib30" title="">2021</a>; Lewis et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib26" title="">2021</a>)</cite>의 피드포워드 서브레이어에 적용되어 추가적인 계산 없이 전체 파라미터 수가 성장할 수 있다. 이러한 방식으로 스케일링된 LLM들은 다운스트림 태스크들 <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib21" title="">2024</a>; Xue et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib39" title="">2024</a>)</cite>에서 인상적인 성능을 보여주었다. Mixture-of-Experts는 Branch-Train-Merge와 달리 완전 동기화된 방식으로 훈련되는 경우가 많으며, 전체 대 전체 통신으로 인해 전문가 수에 따라 통신 비용이 증가한다.</p>
</div>
<div class="ltx_para" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">본 논문에서는 브랜치-트레인-머지(Branch-Train-Merge)와 믹서-오브-전문가(Mixture-of-Experts)의 장점을 결합하여 두 세계 모두의 장점을 지향하면서도 단점을 완화하고자 한다. 이를 위해 브랜치-트레인-머지 방법과 같이 여러 개의 전문가 LLM을 개별적으로 훈련시킨 후 MoE 아키텍처를 사용하여 해당 전문가를 단일 모델로 결합한다. 보다 구체적으로, 모든 전문가 LLM들로부터의 피드포워드 하위 계층들은 각각의 계층에서 단일 MoE 모듈로 통합되고, 라우터 네트워크는 모든 토큰에서 어떤 피드포워드 전문가를 사용할지를 선택한다. 우리는 단순히 가중치를 평균하여 자체 주의 계층을 포함한 전문가 LLM의 다른 모듈을 병합한다. 그런 다음, 라우터가 전문가 피드포워드(FF) 모듈을 혼합하는 것을 학습할 수 있도록 지속적인 훈련을 통해 결합된 모든 데이터에 대해 결과 모델을 MoE-파인튜닝한다. <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Figure 1</span></a>는 이 방법의 개요를 보여주며, 우리는 <em class="ltx_emph ltx_font_italic" id="S1.p4.1.1">Branch-Train-MiX</em> (BTX)라고 부른다.</p>
</div>
<div class="ltx_para" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">MoE에 비해 BTX의 주요 장점은 전문가 훈련이 당황스러울 정도로 병렬적이고 비동기적이어서 통신 비용을 줄이고 훈련 처리량을 증가시킨다는 것이다. Branch-Train-Merge와 비교하여 최종 BTX 모델은 다른 표준 LLM과 같이 미세 조정되거나 사용될 수 있는 통합된 신경망이다. 최종 BTX 모델은 훨씬 더 많은 수의 파라미터를 가짐에도 불구하고 희박하게 활성화되기 때문에 시드 모델에 비해 추론 FLOP를 크게 증가시키지 않을 것이다.</p>
</div>
<div class="ltx_para" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">우리는 <span class="ltx_text ltx_font_smallcaps" id="S1.p6.1.1">Llama-2 7B</span> <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib37" title="">2023</a>)</cite>를 시드 모델로 사용하여 실험을 수행하고 수학, 코드 및 위키피디아의 도메인에 해당하는 데이터의 서로 다른 하위 집합에 대해 전문가 LLM을 훈련한다. 네 번째 전문가로 추가된 원래 <span class="ltx_text ltx_font_smallcaps" id="S1.p6.1.2">Llama-2 7B</span> 가중치를 사용하여 사전 훈련 프로세스에 비해 상대적으로 짧은 기간 동안 결합된 MoE 모델을 미세 조정한다. 결과 BTX 모델은 다양한 도메인에 걸쳐 태스크에 대한 시드 모델보다 상당한 개선을 가져오며, 특히 수학 및 코드 관련 태스크에 대한 특수 모델과의 격차를 해소하는 동시에 특수 모델이 치명적인 망각으로 고통받는 원래 기능에 대한 성능을 유지한다. BTX는 MoE finetuning을 통해 학습된 라우팅의 이점을 보여주는 모든 태스크에서 BTM보다 우수하다. 희소 업사이클링과 같은 순전히 MoE 트레이닝과 비교하여, BTX는 상이한 도메인들에서 태스크들에 걸쳐 더 높은 트레이닝 처리량 및 더 균형 잡힌 성능으로 더 컴퓨팅 효율적이다.</p>
</div>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="231" id="S1.F1.g1" src="https://arxiv.org/html/2403.07816v1/x1.png" width="664">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text ltx_font_medium" id="S1.F1.7.2.1">The Branch-Train-MiX (BTX) method<span class="ltx_text ltx_font_medium" id="S1.F1.7.2.1">The Branch-Train-MiX (BTX) method<span class="ltx_text ltx_font_medium" id="S1.F1.7.2.1">The Branch-Train-MiX (BTX) method<span class="ltx_text ltx_font_medium" id="S1.F1.7.2.1">The Branch-Train-MiX (BTX) method<span class="ltx_text ltx_font_medium" id="S1.F1.7.2.1">The Branch-Train-MiX (BTX) method<span class="ltx_ </span></span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_section" id="S2" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px1">
<h5 class="ltx_title ltx_title_paragraph">Asynchronous parallel training</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S2.SS0.SSS0.Px1.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px1.p1.1">계산 효율성을 위해 훈련 작업자 간의 의사 소통을 줄이는 것은 딥러닝 시스템 훈련을 위한 주요 연구 주제이다. <cite class="ltx_cite ltx_citemacro_cite">Zhang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib40" title="">2015</a>)</cite>는 서로 다른 작업자에 대한 모델 인스턴스가 서로 발산할 수 있도록 하여 동기화의 지속적인 필요성을 제거하는 방법을 도입하였다. 대신에, 작업자들은 때때로 탄성 평균화를 사용하여 마스터 가중치에 느슨하게 동기화된다. <cite class="ltx_cite ltx_citemacro_citet">Douillard et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib12" title="">2023</a>)</cite>의 최근 연구는 체중 변화를 평균화하고 Nesterov 모멘텀을 적용하여 분기된 작업자의 덜 빈번한 동기화가 LLM 훈련을 위한 실제에서 잘 작동한다는 것을 보여주었다. Branch-Train-Merge 방법 <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib27" title="">2022a</a>; Gururangan et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib16" title="">2023</a>)</cite>는 여러 훈련 과정을 완전히 독립적으로 실행함으로써 극단으로 병렬 훈련을 취한다. 각각의 트레이닝 프로세스는 특정 도메인 데이터를 사용하고, 따라서 대응하는 모델은 그 도메인의 전문가가 된다. 마지막으로, 이러한 전문가 모델의 출력 분포를 평균하여 다음 토큰 예측을 수행한다. 어느 전문가가 평균을 낼지는 입력을 하나 이상의 영역으로 분류하여 결정한다. <cite class="ltx_cite ltx_citemacro_citet">Wortsman et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib38" title="">2022</a>)</cite>는 개별적으로 훈련된 모델의 매개변수를 단순히 평균화하는 것으로 성능이 향상되지만 모델은 하이퍼파라미터만 다르다.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px2">
<h5 class="ltx_title ltx_title_paragraph">Mixture-of-Experts</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S2.SS0.SSS0.Px2.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px2.p1.1">MoE는 간단한 Top-K 라우팅 방식을 사용하여 <cite class="ltx_cite ltx_citemacro_cite">Shazeer et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib36" title="">2017</a>)</cite>에서 심층 네트워크를 확장하는 데 사용됩니다. 라우팅 결정들은 이산적이고 따라서 경사 하강에 의해 트레이닝될 수 없기 때문에, Transformer 아키텍처 <cite class="ltx_cite ltx_citemacro_citep">(Fedus et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib13" title="">2022</a>; Lewis et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib26" title="">2021</a>)</cite>에 대해 다양한 트레이닝 방법들이 탐색되었다. 놀랍게도 <cite class="ltx_cite ltx_citemacro_cite">Roller et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib30" title="">2021</a>)</cite>는 입력 토큰을 기반으로 랜덤 매핑을 통해 라우팅이 수행되면 아무런 학습 없이 고정된 라우팅 방식도 잘 작동한다는 것을 보여주었다. 최근 LLM을 사용한 대규모 실험에서 <cite class="ltx_cite ltx_citemacro_cite">Jiang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib21" title="">2024</a>)</cite>는 MoE 접근법이 훨씬 적은 수의 활성 매개변수를 사용하여 조밀한 LLM 대응물의 성능과 일치할 수 있음을 보여주었다. <cite class="ltx_cite ltx_citemacro_cite">Dai et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib11" title="">2024</a>)</cite>의 연구는 더 세밀한 전문가와 항상 활동적인 공유 전문가의 장점을 보여주었다. 우리의 작업과 더 유사하게 <cite class="ltx_cite ltx_citemacro_cite">Gururangan et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib15" title="">2021</a>)</cite>는 피드포워드 계층의 전문가를 도메인 조건 고정 라우팅을 사용하여 특정 도메인에 전문적으로 만들지만 접근 방식의 비동기적 훈련이 부족하다.</p>
</div>
</section>
<section class="ltx_paragraph" id="S2.SS0.SSS0.Px3">
<h5 class="ltx_title ltx_title_paragraph">Continual learning</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S2.SS0.SSS0.Px3.p1">
<p class="ltx_p" id="S2.SS0.SSS0.Px3.p1.1">이 방법은 도메인 전문가가 시드 모델을 학습하기 위해 사용된 초기 데이터와 다른 분포를 가진 데이터 세트에 대해 훈련되기 때문에 분기 후 지속적인 훈련으로 구현되기 때문에 지속적인 학습 <cite class="ltx_cite ltx_citemacro_citep">(Awasthi and Sarawagi, <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib4" title="">2019</a>)</cite>에 관한 것이다. 구체적으로, 우리의 접근법은 서로 다른 도메인에 대해 서로 다른 매개변수를 갖기 때문에 매개변수 분리 방법 <cite class="ltx_cite ltx_citemacro_citep">(Lange et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib25" title="">2019</a>)</cite>와 관련이 있다. <cite class="ltx_cite ltx_citemacro_citet">Aljundi et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib2" title="">2016</a>)</cite>도 각 도메인에서 훈련할 모델의 새 복사본을 만듭니다. <cite class="ltx_cite ltx_citemacro_citet">Rusu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib32" title="">2016</a>)</cite>는 새로운 도메인을 가진 새로운 모델을 추가하되, 이전 모델들과 연결하여 이전에 학습된 특징들을 사용할 수 있도록 한다. <cite class="ltx_cite ltx_citemacro_citet">Rozière et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib31" title="">2023</a>)</cite>는 코드의 특정 도메인에서 시드 LLM을 지속적으로 훈련하면 강력한 도메인 전문가 모델을 생성할 수 있으며, 이는 처음부터 시작하는 것보다 훨씬 빠르게 수렴한다. 수학 전문가 양성을 위해 일반적인 LLM이 아닌 코드 전문가부터 시작하는 것이 <cite class="ltx_cite ltx_citemacro_citep">(Shao et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib35" title="">2024</a>; Azerbayev et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib5" title="">2023</a>)</cite>에 더 유익한 것으로 나타났다.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Branch-Train-MiX</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.p1">
<p class="ltx_p" id="S3.p1.3">기존의 LLM <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.p1.1.m1.1"><semantics id="S3.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.p1.1.m1.1.1" xref="S3.p1.1.m1.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S3.p1.1.m1.1b"><ci id="S3.p1.1.m1.1.1.cmml" xref="S3.p1.1.m1.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.1.m1.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.1.m1.1d">caligraphic_M</annotation></semantics></math>는 매우 다양한 주제를 다루는 대규모 코퍼스에 대해 사전 훈련되어 왔기 때문에, 우리는 전문 분야인 <math alttext="N" class="ltx_Math" display="inline" id="S3.p1.2.m2.1"><semantics id="S3.p1.2.m2.1a"><mi id="S3.p1.2.m2.1.1" xref="S3.p1.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.p1.2.m2.1b"><ci id="S3.p1.2.m2.1.1.cmml" xref="S3.p1.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.2.m2.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.p1.2.m2.1d">italic_N</annotation></semantics></math>에 대한 성능을 향상시키는 것을 목표로 한다. 이것은 각각 수학, 코드 등과 같은 특정 지식 도메인에 관련된 대응하는 트레이닝 데이터세트 <math alttext="\mathcal{D}\coloneqq\{D_{1},\ldots,D_{N}\}" class="ltx_Math" display="inline" id="S3.p1.3.m3.3"><semantics id="S3.p1.3.m3.3a"><mrow id="S3.p1.3.m3.3.3" xref="S3.p1.3.m3.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.p1.3.m3.3.3.4" xref="S3.p1.3.m3.3.3.4.cmml">𝒟</mi><mo id="S3.p1.3.m3.3.3.3" xref="S3.p1.3.m3.3.3.3.cmml">≔</mo><mrow id="S3.p1.3.m3.3.3.2.2" xref="S3.p1.3.m3.3.3.2.3.cmml"><mo id="S3.p1.3.m3.3.3.2.2.3" stretchy="false" xref="S3.p1.3.m3.3.3.2.3.cmml">{</mo><msub id="S3.p1.3.m3.2.2.1.1.1" xref="S3.p1.3.m3.2.2.1.1.1.cmml"><mi id="S3.p1.3.m3.2.2.1.1.1.2" xref="S3.p1.3.m3.2.2.1.1.1.2.cmml">D</mi><mn id="S3.p1.3.m3.2.2.1.1.1.3" xref="S3.p1.3.m3.2.2.1.1.1.3.cmml">1</mn></msub><mo id="S3.p1.3.m3.3.3.2.2.4" xref="S3.p1.3.m3.3.3.2.3.cmml">,</mo><mi id="S3.p1.3.m3.1.1" mathvariant="normal" xref="S3.p1.3.m3.1.1.cmml">…</mi><mo id="S3.p1.3.m3.3.3.2.2.5" xref="S3.p1.3.m3.3.3.2.3.cmml">,</mo><msub id="S3.p1.3.m3.3.3.2.2.2" xref="S3.p1.3.m3.3.3.2.2.2.cmml"><mi id="S3.p1.3.m3.3.3.2.2.2.2" xref="S3.p1.3.m3.3.3.2.2.2.2.cmml">D</mi><mi id="S3.p1.3.m3.3.3.2.2.2.3" xref="S3.p1.3.m3.3.3.2.2.2.3.cmml">N</mi></msub><mo id="S3.p1.3.m3.3.3.2.2.6" stretchy="false" xref="S3.p1.3.m3.3.3.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.3.m3.3b"><apply id="S3.p1.3.m3.3.3.cmml" xref="S3.p1.3.m3.3.3"><ci id="S3.p1.3.m3.3.3.3.cmml" xref="S3.p1.3.m3.3.3.3">≔</ci><ci id="S3.p1.3.m3.3.3.4.cmml" xref="S3.p1.3.m3.3.3.4">𝒟</ci><set id="S3.p1.3.m3.3.3.2.3.cmml" xref="S3.p1.3.m3.3.3.2.2"><apply id="S3.p1.3.m3.2.2.1.1.1.cmml" xref="S3.p1.3.m3.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.p1.3.m3.2.2.1.1.1.1.cmml" xref="S3.p1.3.m3.2.2.1.1.1">subscript</csymbol><ci id="S3.p1.3.m3.2.2.1.1.1.2.cmml" xref="S3.p1.3.m3.2.2.1.1.1.2">𝐷</ci><cn id="S3.p1.3.m3.2.2.1.1.1.3.cmml" type="integer" xref="S3.p1.3.m3.2.2.1.1.1.3">1</cn></apply><ci id="S3.p1.3.m3.1.1.cmml" xref="S3.p1.3.m3.1.1">…</ci><apply id="S3.p1.3.m3.3.3.2.2.2.cmml" xref="S3.p1.3.m3.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.p1.3.m3.3.3.2.2.2.1.cmml" xref="S3.p1.3.m3.3.3.2.2.2">subscript</csymbol><ci id="S3.p1.3.m3.3.3.2.2.2.2.cmml" xref="S3.p1.3.m3.3.3.2.2.2.2">𝐷</ci><ci id="S3.p1.3.m3.3.3.2.2.2.3.cmml" xref="S3.p1.3.m3.3.3.2.2.2.3">𝑁</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.3.m3.3c">\mathcal{D}\coloneqq\{D_{1},\ldots,D_{N}\}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.3.m3.3d">caligraphic_D ≔ { italic_D start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_D start_POSTSUBSCRIPT italic_N end_POSTSUBSCRIPT }</annotation></semantics></math>로 계속된 사전 트레이닝에 의해 달성된다. 제안된 방법은 분기, 열차, MiX의 세 단계로 구성된다.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Branch &amp; Train: Embarrassingly Parallel Expert Training</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.8">시드 모델 <math alttext="\mathcal{M}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml">ℳ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><ci id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">ℳ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">\mathcal{M}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">caligraphic_M</annotation></semantics></math>, <math alttext="N" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><mi id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><ci id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">italic_N</annotation></semantics></math> 전문가 LLMs <math alttext="\{\mathcal{M}_{1},\ldots,\mathcal{M}_{N}\}" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.3"><semantics id="S3.SS1.p1.3.m3.3a"><mrow id="S3.SS1.p1.3.m3.3.3.2" xref="S3.SS1.p1.3.m3.3.3.3.cmml"><mo id="S3.SS1.p1.3.m3.3.3.2.3" stretchy="false" xref="S3.SS1.p1.3.m3.3.3.3.cmml">{</mo><msub id="S3.SS1.p1.3.m3.2.2.1.1" xref="S3.SS1.p1.3.m3.2.2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.3.m3.2.2.1.1.2" xref="S3.SS1.p1.3.m3.2.2.1.1.2.cmml">ℳ</mi><mn id="S3.SS1.p1.3.m3.2.2.1.1.3" xref="S3.SS1.p1.3.m3.2.2.1.1.3.cmml">1</mn></msub><mo id="S3.SS1.p1.3.m3.3.3.2.4" xref="S3.SS1.p1.3.m3.3.3.3.cmml">,</mo><mi id="S3.SS1.p1.3.m3.1.1" mathvariant="normal" xref="S3.SS1.p1.3.m3.1.1.cmml">…</mi><mo id="S3.SS1.p1.3.m3.3.3.2.5" xref="S3.SS1.p1.3.m3.3.3.3.cmml">,</mo><msub id="S3.SS1.p1.3.m3.3.3.2.2" xref="S3.SS1.p1.3.m3.3.3.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.3.m3.3.3.2.2.2" xref="S3.SS1.p1.3.m3.3.3.2.2.2.cmml">ℳ</mi><mi id="S3.SS1.p1.3.m3.3.3.2.2.3" xref="S3.SS1.p1.3.m3.3.3.2.2.3.cmml">N</mi></msub><mo id="S3.SS1.p1.3.m3.3.3.2.6" stretchy="false" xref="S3.SS1.p1.3.m3.3.3.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.3b"><set id="S3.SS1.p1.3.m3.3.3.3.cmml" xref="S3.SS1.p1.3.m3.3.3.2"><apply id="S3.SS1.p1.3.m3.2.2.1.1.cmml" xref="S3.SS1.p1.3.m3.2.2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.2.2.1.1.1.cmml" xref="S3.SS1.p1.3.m3.2.2.1.1">subscript</csymbol><ci id="S3.SS1.p1.3.m3.2.2.1.1.2.cmml" xref="S3.SS1.p1.3.m3.2.2.1.1.2">ℳ</ci><cn id="S3.SS1.p1.3.m3.2.2.1.1.3.cmml" type="integer" xref="S3.SS1.p1.3.m3.2.2.1.1.3">1</cn></apply><ci id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">…</ci><apply id="S3.SS1.p1.3.m3.3.3.2.2.cmml" xref="S3.SS1.p1.3.m3.3.3.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.3.3.2.2.1.cmml" xref="S3.SS1.p1.3.m3.3.3.2.2">subscript</csymbol><ci id="S3.SS1.p1.3.m3.3.3.2.2.2.cmml" xref="S3.SS1.p1.3.m3.3.3.2.2.2">ℳ</ci><ci id="S3.SS1.p1.3.m3.3.3.2.2.3.cmml" xref="S3.SS1.p1.3.m3.3.3.2.2.3">𝑁</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.3c">\{\mathcal{M}_{1},\ldots,\mathcal{M}_{N}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.3d">{ caligraphic_M start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , caligraphic_M start_POSTSUBSCRIPT italic_N end_POSTSUBSCRIPT }</annotation></semantics></math>, 각 모델 <math alttext="\mathcal{M}_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><msub id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.4.m4.1.1.2" xref="S3.SS1.p1.4.m4.1.1.2.cmml">ℳ</mi><mi id="S3.SS1.p1.4.m4.1.1.3" xref="S3.SS1.p1.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><apply id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.2">ℳ</ci><ci id="S3.SS1.p1.4.m4.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">\mathcal{M}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">caligraphic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>가 해당 데이터셋 <math alttext="D_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.1"><semantics id="S3.SS1.p1.5.m5.1a"><msub id="S3.SS1.p1.5.m5.1.1" xref="S3.SS1.p1.5.m5.1.1.cmml"><mi id="S3.SS1.p1.5.m5.1.1.2" xref="S3.SS1.p1.5.m5.1.1.2.cmml">D</mi><mi id="S3.SS1.p1.5.m5.1.1.3" xref="S3.SS1.p1.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.1b"><apply id="S3.SS1.p1.5.m5.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.1.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1">subscript</csymbol><ci id="S3.SS1.p1.5.m5.1.1.2.cmml" xref="S3.SS1.p1.5.m5.1.1.2">𝐷</ci><ci id="S3.SS1.p1.5.m5.1.1.3.cmml" xref="S3.SS1.p1.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.1c">D_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.1d">italic_D start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>에 대해 훈련되고, 통상적인 언어 모델링 목적을 사용하여 사전 훈련하는 동안과 동일한 방식으로 훈련한다. 각 전문가 모델 <math alttext="\mathcal{M}_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.1"><semantics id="S3.SS1.p1.6.m6.1a"><msub id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.6.m6.1.1.2" xref="S3.SS1.p1.6.m6.1.1.2.cmml">ℳ</mi><mi id="S3.SS1.p1.6.m6.1.1.3" xref="S3.SS1.p1.6.m6.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.1b"><apply id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.6.m6.1.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1">subscript</csymbol><ci id="S3.SS1.p1.6.m6.1.1.2.cmml" xref="S3.SS1.p1.6.m6.1.1.2">ℳ</ci><ci id="S3.SS1.p1.6.m6.1.1.3.cmml" xref="S3.SS1.p1.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.1c">\mathcal{M}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.1d">caligraphic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>는 다른 것들과의 완전한 분리로 훈련될 수 있기 때문에, 전체 훈련 과정은 <math alttext="N" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m7.1"><semantics id="S3.SS1.p1.7.m7.1a"><mi id="S3.SS1.p1.7.m7.1.1" xref="S3.SS1.p1.7.m7.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m7.1b"><ci id="S3.SS1.p1.7.m7.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m7.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m7.1d">italic_N</annotation></semantics></math>-way embarrassingly parallel이 된다. 이 훈련 패러다임은 대규모 분산 훈련에서 몇 가지 이점이 있다. 이는 컴퓨팅의 크기를 스케일링할 때 전체 트레이닝 처리량의 선형 스케일링을 허용하는 반면, 조인트 트레이닝은 종종 배치 크기를 증가시킴으로써 불확실한 성능에 직면한다. 전체 통신 비용이 저렴합니다. 또한 단일 훈련 실패가 전체 훈련을 중단하는 대신 <math alttext="N" class="ltx_Math" display="inline" id="S3.SS1.p1.8.m8.1"><semantics id="S3.SS1.p1.8.m8.1a"><mi id="S3.SS1.p1.8.m8.1.1" xref="S3.SS1.p1.8.m8.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.8.m8.1b"><ci id="S3.SS1.p1.8.m8.1.1.cmml" xref="S3.SS1.p1.8.m8.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.8.m8.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.8.m8.1d">italic_N</annotation></semantics></math> 훈련 프로세스 중 하나에만 영향을 미치기 때문에 더 탄력적입니다.</p>
</div>
<div class="ltx_para" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.1">모든 전문가 교육이 끝나면, 우리는 각각 특정 분포를 전문으로 하는 <math alttext="N" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mi id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><ci id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">italic_N</annotation></semantics></math> 다른 LLM으로 끝날 것이다. 이때 Branch-Train-Merge 방식 <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib27" title="">2022a</a>; Gururangan et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib16" title="">2023</a>)</cite>는 이러한 도메인 전문가들을 그대로 사용하며, 추론 시점에 입력이 어느 도메인에 속하는지를 판단하여 어떤 전문가를 사용할 것인지를 선택한다. 일반적으로 여러 전문가를 선택하고 최종 출력 분포를 단순히 평균화하여 다음 토큰을 생성합니다. 대조적으로, 우리의 BTX 접근법은 다음 섹션에서 설명할 것처럼 이러한 도메인 전문가를 다시 미세 조정되는 단일 LLM으로 병합한다.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>MiX: Combining Separate Experts to be a Mixture-of-Experts</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.8">도메인 전문가 모델 <math alttext="\mathcal{M}_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><msub id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">ℳ</mi><mi id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2">ℳ</ci><ci id="S3.SS2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">\mathcal{M}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">caligraphic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>를 결합하기 위해 Mixture-of-Experts 접근법을 사용한다. 그러나 <math alttext="\mathcal{M}_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><msub id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.p1.2.m2.1.1.2" xref="S3.SS2.p1.2.m2.1.1.2.cmml">ℳ</mi><mi id="S3.SS2.p1.2.m2.1.1.3" xref="S3.SS2.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.p1.2.m2.1.1.2">ℳ</ci><ci id="S3.SS2.p1.2.m2.1.1.3.cmml" xref="S3.SS2.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">\mathcal{M}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">caligraphic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>의 최종 출력을 혼합하는 고전적인 절차를 사용하는 대신 Transformer의 각 계층 내에서 MoE를 수행하여 보다 세밀한 혼합을 수행한다. 특히, 도메인 전문가의 다른 피드포워드 하위 계층을 단일 MoE 하위 계층으로 결합한다. <math alttext="\mathtt{FF}_{i}^{l}(x)" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><mrow id="S3.SS2.p1.3.m3.1.2" xref="S3.SS2.p1.3.m3.1.2.cmml"><msubsup id="S3.SS2.p1.3.m3.1.2.2" xref="S3.SS2.p1.3.m3.1.2.2.cmml"><mi id="S3.SS2.p1.3.m3.1.2.2.2.2" xref="S3.SS2.p1.3.m3.1.2.2.2.2.cmml">𝙵𝙵</mi><mi id="S3.SS2.p1.3.m3.1.2.2.2.3" xref="S3.SS2.p1.3.m3.1.2.2.2.3.cmml">i</mi><mi id="S3.SS2.p1.3.m3.1.2.2.3" xref="S3.SS2.p1.3.m3.1.2.2.3.cmml">l</mi></msubsup><mo id="S3.SS2.p1.3.m3.1.2.1" xref="S3.SS2.p1.3.m3.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p1.3.m3.1.2.3.2" xref="S3.SS2.p1.3.m3.1.2.cmml"><mo id="S3.SS2.p1.3.m3.1.2.3.2.1" stretchy="false" xref="S3.SS2.p1.3.m3.1.2.cmml">(</mo><mi id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml">x</mi><mo id="S3.SS2.p1.3.m3.1.2.3.2.2" stretchy="false" xref="S3.SS2.p1.3.m3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><apply id="S3.SS2.p1.3.m3.1.2.cmml" xref="S3.SS2.p1.3.m3.1.2"><times id="S3.SS2.p1.3.m3.1.2.1.cmml" xref="S3.SS2.p1.3.m3.1.2.1"></times><apply id="S3.SS2.p1.3.m3.1.2.2.cmml" xref="S3.SS2.p1.3.m3.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.2.2.1.cmml" xref="S3.SS2.p1.3.m3.1.2.2">superscript</csymbol><apply id="S3.SS2.p1.3.m3.1.2.2.2.cmml" xref="S3.SS2.p1.3.m3.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.2.2.2.1.cmml" xref="S3.SS2.p1.3.m3.1.2.2">subscript</csymbol><ci id="S3.SS2.p1.3.m3.1.2.2.2.2.cmml" xref="S3.SS2.p1.3.m3.1.2.2.2.2">𝙵𝙵</ci><ci id="S3.SS2.p1.3.m3.1.2.2.2.3.cmml" xref="S3.SS2.p1.3.m3.1.2.2.2.3">𝑖</ci></apply><ci id="S3.SS2.p1.3.m3.1.2.2.3.cmml" xref="S3.SS2.p1.3.m3.1.2.2.3">𝑙</ci></apply><ci id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">\mathtt{FF}_{i}^{l}(x)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">typewriter_FF start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ( italic_x )</annotation></semantics></math>가 <math alttext="l" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><mi id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><ci id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">l</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">italic_l</annotation></semantics></math>-th layer of the <math alttext="i" class="ltx_Math" display="inline" id="S3.SS2.p1.5.m5.1"><semantics id="S3.SS2.p1.5.m5.1a"><mi id="S3.SS2.p1.5.m5.1.1" xref="S3.SS2.p1.5.m5.1.1.cmml">i</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.5.m5.1b"><ci id="S3.SS2.p1.5.m5.1.1.cmml" xref="S3.SS2.p1.5.m5.1.1">𝑖</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.5.m5.1c">i</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.5.m5.1d">italic_i</annotation></semantics></math>-th domain expert <math alttext="\mathcal{M}_{i}" class="ltx_Math" display="inline" id="S3.SS2.p1.6.m6.1"><semantics id="S3.SS2.p1.6.m6.1a"><msub id="S3.SS2.p1.6.m6.1.1" xref="S3.SS2.p1.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS2.p1.6.m6.1.1.2" xref="S3.SS2.p1.6.m6.1.1.2.cmml">ℳ</mi><mi id="S3.SS2.p1.6.m6.1.1.3" xref="S3.SS2.p1.6.m6.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.6.m6.1b"><apply id="S3.SS2.p1.6.m6.1.1.cmml" xref="S3.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.6.m6.1.1.1.cmml" xref="S3.SS2.p1.6.m6.1.1">subscript</csymbol><ci id="S3.SS2.p1.6.m6.1.1.2.cmml" xref="S3.SS2.p1.6.m6.1.1.2">ℳ</ci><ci id="S3.SS2.p1.6.m6.1.1.3.cmml" xref="S3.SS2.p1.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.6.m6.1c">\mathcal{M}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.6.m6.1d">caligraphic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, then the combined MoE layer for input representation <math alttext="x" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m7.1"><semantics id="S3.SS2.p1.7.m7.1a"><mi id="S3.SS2.p1.7.m7.1.1" xref="S3.SS2.p1.7.m7.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m7.1b"><ci id="S3.SS2.p1.7.m7.1.1.cmml" xref="S3.SS2.p1.7.m7.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.7.m7.1c">x</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.7.m7.1d">italic_x</annotation></semantics></math> at layer <math alttext="l" class="ltx_Math" display="inline" id="S3.SS2.p1.8.m8.1"><semantics id="S3.SS2.p1.8.m8.1a"><mi id="S3.SS2.p1.8.m8.1.1" xref="S3.SS2.p1.8.m8.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.8.m8.1b"><ci id="S3.SS2.p1.8.m8.1.1.cmml" xref="S3.SS2.p1.8.m8.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.8.m8.1c">l</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.8.m8.1d">italic_l</annotation></semantics></math> compute:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathtt{FF}_{\text{MoE}}^{l}(x)=\sum_{i=1}^{N}g_{i}(W_{l}x)\mathtt{FF}_{i}^{l}%
(x)." class="ltx_Math" display="block" id="S3.Ex1.m1.3"><semantics id="S3.Ex1.m1.3a"><mrow id="S3.Ex1.m1.3.3.1" xref="S3.Ex1.m1.3.3.1.1.cmml"><mrow id="S3.Ex1.m1.3.3.1.1" xref="S3.Ex1.m1.3.3.1.1.cmml"><mrow id="S3.Ex1.m1.3.3.1.1.3" xref="S3.Ex1.m1.3.3.1.1.3.cmml"><msubsup id="S3.Ex1.m1.3.3.1.1.3.2" xref="S3.Ex1.m1.3.3.1.1.3.2.cmml"><mi id="S3.Ex1.m1.3.3.1.1.3.2.2.2" xref="S3.Ex1.m1.3.3.1.1.3.2.2.2.cmml">𝙵𝙵</mi><mtext id="S3.Ex1.m1.3.3.1.1.3.2.2.3" xref="S3.Ex1.m1.3.3.1.1.3.2.2.3a.cmml">MoE</mtext><mi id="S3.Ex1.m1.3.3.1.1.3.2.3" xref="S3.Ex1.m1.3.3.1.1.3.2.3.cmml">l</mi></msubsup><mo id="S3.Ex1.m1.3.3.1.1.3.1" xref="S3.Ex1.m1.3.3.1.1.3.1.cmml">⁢</mo><mrow id="S3.Ex1.m1.3.3.1.1.3.3.2" xref="S3.Ex1.m1.3.3.1.1.3.cmml"><mo id="S3.Ex1.m1.3.3.1.1.3.3.2.1" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.3.cmml">(</mo><mi id="S3.Ex1.m1.1.1" xref="S3.Ex1.m1.1.1.cmml">x</mi><mo id="S3.Ex1.m1.3.3.1.1.3.3.2.2" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.3.cmml">)</mo></mrow></mrow><mo id="S3.Ex1.m1.3.3.1.1.2" rspace="0.111em" xref="S3.Ex1.m1.3.3.1.1.2.cmml">=</mo><mrow id="S3.Ex1.m1.3.3.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.cmml"><munderover id="S3.Ex1.m1.3.3.1.1.1.2" xref="S3.Ex1.m1.3.3.1.1.1.2.cmml"><mo id="S3.Ex1.m1.3.3.1.1.1.2.2.2" movablelimits="false" xref="S3.Ex1.m1.3.3.1.1.1.2.2.2.cmml">∑</mo><mrow id="S3.Ex1.m1.3.3.1.1.1.2.2.3" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.cmml"><mi id="S3.Ex1.m1.3.3.1.1.1.2.2.3.2" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.2.cmml">i</mi><mo id="S3.Ex1.m1.3.3.1.1.1.2.2.3.1" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.1.cmml">=</mo><mn id="S3.Ex1.m1.3.3.1.1.1.2.2.3.3" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.3.cmml">1</mn></mrow><mi id="S3.Ex1.m1.3.3.1.1.1.2.3" xref="S3.Ex1.m1.3.3.1.1.1.2.3.cmml">N</mi></munderover><mrow id="S3.Ex1.m1.3.3.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.1.cmml"><msub id="S3.Ex1.m1.3.3.1.1.1.1.3" xref="S3.Ex1.m1.3.3.1.1.1.1.3.cmml"><mi id="S3.Ex1.m1.3.3.1.1.1.1.3.2" xref="S3.Ex1.m1.3.3.1.1.1.1.3.2.cmml">g</mi><mi id="S3.Ex1.m1.3.3.1.1.1.1.3.3" xref="S3.Ex1.m1.3.3.1.1.1.1.3.3.cmml">i</mi></msub><mo id="S3.Ex1.m1.3.3.1.1.1.1.2" xref="S3.Ex1.m1.3.3.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex1.m1.3.3.1.1.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml"><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml"><msub id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.cmml"><mi id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.cmml">W</mi><mi id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.1" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.Ex1.m1.3.3.1.1.1.1.1.1.3" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.Ex1.m1.3.3.1.1.1.1.2a" xref="S3.Ex1.m1.3.3.1.1.1.1.2.cmml">⁢</mo><msubsup id="S3.Ex1.m1.3.3.1.1.1.1.4" xref="S3.Ex1.m1.3.3.1.1.1.1.4.cmml"><mi id="S3.Ex1.m1.3.3.1.1.1.1.4.2.2" xref="S3.Ex1.m1.3.3.1.1.1.1.4.2.2.cmml">𝙵𝙵</mi><mi id="S3.Ex1.m1.3.3.1.1.1.1.4.2.3" xref="S3.Ex1.m1.3.3.1.1.1.1.4.2.3.cmml">i</mi><mi id="S3.Ex1.m1.3.3.1.1.1.1.4.3" xref="S3.Ex1.m1.3.3.1.1.1.1.4.3.cmml">l</mi></msubsup><mo id="S3.Ex1.m1.3.3.1.1.1.1.2b" xref="S3.Ex1.m1.3.3.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex1.m1.3.3.1.1.1.1.5.2" xref="S3.Ex1.m1.3.3.1.1.1.1.cmml"><mo id="S3.Ex1.m1.3.3.1.1.1.1.5.2.1" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.cmml">(</mo><mi id="S3.Ex1.m1.2.2" xref="S3.Ex1.m1.2.2.cmml">x</mi><mo id="S3.Ex1.m1.3.3.1.1.1.1.5.2.2" stretchy="false" xref="S3.Ex1.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.Ex1.m1.3.3.1.2" lspace="0em" xref="S3.Ex1.m1.3.3.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m1.3b"><apply id="S3.Ex1.m1.3.3.1.1.cmml" xref="S3.Ex1.m1.3.3.1"><eq id="S3.Ex1.m1.3.3.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.2"></eq><apply id="S3.Ex1.m1.3.3.1.1.3.cmml" xref="S3.Ex1.m1.3.3.1.1.3"><times id="S3.Ex1.m1.3.3.1.1.3.1.cmml" xref="S3.Ex1.m1.3.3.1.1.3.1"></times><apply id="S3.Ex1.m1.3.3.1.1.3.2.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.3.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2">superscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.3.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.3.2.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2">subscript</csymbol><ci id="S3.Ex1.m1.3.3.1.1.3.2.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2.2.2">𝙵𝙵</ci><ci id="S3.Ex1.m1.3.3.1.1.3.2.2.3a.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2.2.3"><mtext id="S3.Ex1.m1.3.3.1.1.3.2.2.3.cmml" mathsize="70%" xref="S3.Ex1.m1.3.3.1.1.3.2.2.3">MoE</mtext></ci></apply><ci id="S3.Ex1.m1.3.3.1.1.3.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.3.2.3">𝑙</ci></apply><ci id="S3.Ex1.m1.1.1.cmml" xref="S3.Ex1.m1.1.1">𝑥</ci></apply><apply id="S3.Ex1.m1.3.3.1.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1"><apply id="S3.Ex1.m1.3.3.1.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2">superscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.1.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.2.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2">subscript</csymbol><sum id="S3.Ex1.m1.3.3.1.1.1.2.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2.2.2"></sum><apply id="S3.Ex1.m1.3.3.1.1.1.2.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3"><eq id="S3.Ex1.m1.3.3.1.1.1.2.2.3.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.1"></eq><ci id="S3.Ex1.m1.3.3.1.1.1.2.2.3.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.2">𝑖</ci><cn id="S3.Ex1.m1.3.3.1.1.1.2.2.3.3.cmml" type="integer" xref="S3.Ex1.m1.3.3.1.1.1.2.2.3.3">1</cn></apply></apply><ci id="S3.Ex1.m1.3.3.1.1.1.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.2.3">𝑁</ci></apply><apply id="S3.Ex1.m1.3.3.1.1.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1"><times id="S3.Ex1.m1.3.3.1.1.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.2"></times><apply id="S3.Ex1.m1.3.3.1.1.1.1.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.1.3.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.3">subscript</csymbol><ci id="S3.Ex1.m1.3.3.1.1.1.1.3.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.3.2">𝑔</ci><ci id="S3.Ex1.m1.3.3.1.1.1.1.3.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.3.3">𝑖</ci></apply><apply id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1"><times id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.1"></times><apply id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.2">𝑊</ci><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.1.1.1.3">𝑥</ci></apply><apply id="S3.Ex1.m1.3.3.1.1.1.1.4.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.1.4.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4">superscript</csymbol><apply id="S3.Ex1.m1.3.3.1.1.1.1.4.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4"><csymbol cd="ambiguous" id="S3.Ex1.m1.3.3.1.1.1.1.4.2.1.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4">subscript</csymbol><ci id="S3.Ex1.m1.3.3.1.1.1.1.4.2.2.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4.2.2">𝙵𝙵</ci><ci id="S3.Ex1.m1.3.3.1.1.1.1.4.2.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4.2.3">𝑖</ci></apply><ci id="S3.Ex1.m1.3.3.1.1.1.1.4.3.cmml" xref="S3.Ex1.m1.3.3.1.1.1.1.4.3">𝑙</ci></apply><ci id="S3.Ex1.m1.2.2.cmml" xref="S3.Ex1.m1.2.2">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m1.3c">\mathtt{FF}_{\text{MoE}}^{l}(x)=\sum_{i=1}^{N}g_{i}(W_{l}x)\mathtt{FF}_{i}^{l}%
(x).</annotation><annotation encoding="application/x-llamapun" id="S3.Ex1.m1.3d">typewriter_FF start_POSTSUBSCRIPT MoE end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ( italic_x ) = ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT italic_g start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_x ) typewriter_FF start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ( italic_x ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.13">여기서, <math alttext="W_{l}" class="ltx_Math" display="inline" id="S3.SS2.p1.9.m1.1"><semantics id="S3.SS2.p1.9.m1.1a"><msub id="S3.SS2.p1.9.m1.1.1" xref="S3.SS2.p1.9.m1.1.1.cmml"><mi id="S3.SS2.p1.9.m1.1.1.2" xref="S3.SS2.p1.9.m1.1.1.2.cmml">W</mi><mi id="S3.SS2.p1.9.m1.1.1.3" xref="S3.SS2.p1.9.m1.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.9.m1.1b"><apply id="S3.SS2.p1.9.m1.1.1.cmml" xref="S3.SS2.p1.9.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.9.m1.1.1.1.cmml" xref="S3.SS2.p1.9.m1.1.1">subscript</csymbol><ci id="S3.SS2.p1.9.m1.1.1.2.cmml" xref="S3.SS2.p1.9.m1.1.1.2">𝑊</ci><ci id="S3.SS2.p1.9.m1.1.1.3.cmml" xref="S3.SS2.p1.9.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.9.m1.1c">W_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.9.m1.1d">italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>는 선형 변환이고, <math alttext="g" class="ltx_Math" display="inline" id="S3.SS2.p1.10.m2.1"><semantics id="S3.SS2.p1.10.m2.1a"><mi id="S3.SS2.p1.10.m2.1.1" xref="S3.SS2.p1.10.m2.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.10.m2.1b"><ci id="S3.SS2.p1.10.m2.1.1.cmml" xref="S3.SS2.p1.10.m2.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.10.m2.1c">g</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.10.m2.1d">italic_g</annotation></semantics></math>는 라우팅 함수로서, 일반적으로 희소 출력을 가지므로 일부 전문가만 스위칭한다. 해당 라우터 출력이 0이면 <math alttext="\mathtt{FF}_{i}^{l}(x)" class="ltx_Math" display="inline" id="S3.SS2.p1.11.m3.1"><semantics id="S3.SS2.p1.11.m3.1a"><mrow id="S3.SS2.p1.11.m3.1.2" xref="S3.SS2.p1.11.m3.1.2.cmml"><msubsup id="S3.SS2.p1.11.m3.1.2.2" xref="S3.SS2.p1.11.m3.1.2.2.cmml"><mi id="S3.SS2.p1.11.m3.1.2.2.2.2" xref="S3.SS2.p1.11.m3.1.2.2.2.2.cmml">𝙵𝙵</mi><mi id="S3.SS2.p1.11.m3.1.2.2.2.3" xref="S3.SS2.p1.11.m3.1.2.2.2.3.cmml">i</mi><mi id="S3.SS2.p1.11.m3.1.2.2.3" xref="S3.SS2.p1.11.m3.1.2.2.3.cmml">l</mi></msubsup><mo id="S3.SS2.p1.11.m3.1.2.1" xref="S3.SS2.p1.11.m3.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p1.11.m3.1.2.3.2" xref="S3.SS2.p1.11.m3.1.2.cmml"><mo id="S3.SS2.p1.11.m3.1.2.3.2.1" stretchy="false" xref="S3.SS2.p1.11.m3.1.2.cmml">(</mo><mi id="S3.SS2.p1.11.m3.1.1" xref="S3.SS2.p1.11.m3.1.1.cmml">x</mi><mo id="S3.SS2.p1.11.m3.1.2.3.2.2" stretchy="false" xref="S3.SS2.p1.11.m3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.11.m3.1b"><apply id="S3.SS2.p1.11.m3.1.2.cmml" xref="S3.SS2.p1.11.m3.1.2"><times id="S3.SS2.p1.11.m3.1.2.1.cmml" xref="S3.SS2.p1.11.m3.1.2.1"></times><apply id="S3.SS2.p1.11.m3.1.2.2.cmml" xref="S3.SS2.p1.11.m3.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p1.11.m3.1.2.2.1.cmml" xref="S3.SS2.p1.11.m3.1.2.2">superscript</csymbol><apply id="S3.SS2.p1.11.m3.1.2.2.2.cmml" xref="S3.SS2.p1.11.m3.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p1.11.m3.1.2.2.2.1.cmml" xref="S3.SS2.p1.11.m3.1.2.2">subscript</csymbol><ci id="S3.SS2.p1.11.m3.1.2.2.2.2.cmml" xref="S3.SS2.p1.11.m3.1.2.2.2.2">𝙵𝙵</ci><ci id="S3.SS2.p1.11.m3.1.2.2.2.3.cmml" xref="S3.SS2.p1.11.m3.1.2.2.2.3">𝑖</ci></apply><ci id="S3.SS2.p1.11.m3.1.2.2.3.cmml" xref="S3.SS2.p1.11.m3.1.2.2.3">𝑙</ci></apply><ci id="S3.SS2.p1.11.m3.1.1.cmml" xref="S3.SS2.p1.11.m3.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.11.m3.1c">\mathtt{FF}_{i}^{l}(x)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.11.m3.1d">typewriter_FF start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ( italic_x )</annotation></semantics></math> 계산을 건너뛸 수 있으므로, <math alttext="\mathtt{FF}_{\text{MoE}}^{l}(x)" class="ltx_Math" display="inline" id="S3.SS2.p1.12.m4.1"><semantics id="S3.SS2.p1.12.m4.1a"><mrow id="S3.SS2.p1.12.m4.1.2" xref="S3.SS2.p1.12.m4.1.2.cmml"><msubsup id="S3.SS2.p1.12.m4.1.2.2" xref="S3.SS2.p1.12.m4.1.2.2.cmml"><mi id="S3.SS2.p1.12.m4.1.2.2.2.2" xref="S3.SS2.p1.12.m4.1.2.2.2.2.cmml">𝙵𝙵</mi><mtext id="S3.SS2.p1.12.m4.1.2.2.2.3" xref="S3.SS2.p1.12.m4.1.2.2.2.3a.cmml">MoE</mtext><mi id="S3.SS2.p1.12.m4.1.2.2.3" xref="S3.SS2.p1.12.m4.1.2.2.3.cmml">l</mi></msubsup><mo id="S3.SS2.p1.12.m4.1.2.1" xref="S3.SS2.p1.12.m4.1.2.1.cmml">⁢</mo><mrow id="S3.SS2.p1.12.m4.1.2.3.2" xref="S3.SS2.p1.12.m4.1.2.cmml"><mo id="S3.SS2.p1.12.m4.1.2.3.2.1" stretchy="false" xref="S3.SS2.p1.12.m4.1.2.cmml">(</mo><mi id="S3.SS2.p1.12.m4.1.1" xref="S3.SS2.p1.12.m4.1.1.cmml">x</mi><mo id="S3.SS2.p1.12.m4.1.2.3.2.2" stretchy="false" xref="S3.SS2.p1.12.m4.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.12.m4.1b"><apply id="S3.SS2.p1.12.m4.1.2.cmml" xref="S3.SS2.p1.12.m4.1.2"><times id="S3.SS2.p1.12.m4.1.2.1.cmml" xref="S3.SS2.p1.12.m4.1.2.1"></times><apply id="S3.SS2.p1.12.m4.1.2.2.cmml" xref="S3.SS2.p1.12.m4.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p1.12.m4.1.2.2.1.cmml" xref="S3.SS2.p1.12.m4.1.2.2">superscript</csymbol><apply id="S3.SS2.p1.12.m4.1.2.2.2.cmml" xref="S3.SS2.p1.12.m4.1.2.2"><csymbol cd="ambiguous" id="S3.SS2.p1.12.m4.1.2.2.2.1.cmml" xref="S3.SS2.p1.12.m4.1.2.2">subscript</csymbol><ci id="S3.SS2.p1.12.m4.1.2.2.2.2.cmml" xref="S3.SS2.p1.12.m4.1.2.2.2.2">𝙵𝙵</ci><ci id="S3.SS2.p1.12.m4.1.2.2.2.3a.cmml" xref="S3.SS2.p1.12.m4.1.2.2.2.3"><mtext id="S3.SS2.p1.12.m4.1.2.2.2.3.cmml" mathsize="70%" xref="S3.SS2.p1.12.m4.1.2.2.2.3">MoE</mtext></ci></apply><ci id="S3.SS2.p1.12.m4.1.2.2.3.cmml" xref="S3.SS2.p1.12.m4.1.2.2.3">𝑙</ci></apply><ci id="S3.SS2.p1.12.m4.1.1.cmml" xref="S3.SS2.p1.12.m4.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.12.m4.1c">\mathtt{FF}_{\text{MoE}}^{l}(x)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.12.m4.1d">typewriter_FF start_POSTSUBSCRIPT MoE end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ( italic_x )</annotation></semantics></math>의 실제 계산은 모든 도메인 전문가를 계산하는 것보다 훨씬 효율적일 것이다. 그러나, 라우팅 결정은 토큰에서 토큰으로 변경될 수 있으므로, 하나의 입력 시퀀스는 임의의 주어진 토큰에서 단지 소수만이 액세스되는 경우에도 필요한 경우 모든 도메인 전문가 FF 계층을 채용할 수 있다. 우리의 실험에서, 달리 명시되지 않는 한, 우리는 <math alttext="g(W_{l}x)=\text{SoftMax}(\text{TopK}(W_{l}x))" class="ltx_Math" display="inline" id="S3.SS2.p1.13.m5.2"><semantics id="S3.SS2.p1.13.m5.2a"><mrow id="S3.SS2.p1.13.m5.2.2" xref="S3.SS2.p1.13.m5.2.2.cmml"><mrow id="S3.SS2.p1.13.m5.1.1.1" xref="S3.SS2.p1.13.m5.1.1.1.cmml"><mi id="S3.SS2.p1.13.m5.1.1.1.3" xref="S3.SS2.p1.13.m5.1.1.1.3.cmml">g</mi><mo id="S3.SS2.p1.13.m5.1.1.1.2" xref="S3.SS2.p1.13.m5.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.p1.13.m5.1.1.1.1.1" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.cmml"><mo id="S3.SS2.p1.13.m5.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.p1.13.m5.1.1.1.1.1.1" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.cmml"><msub id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.cmml"><mi id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.2" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.2.cmml">W</mi><mi id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.3" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S3.SS2.p1.13.m5.1.1.1.1.1.1.1" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p1.13.m5.1.1.1.1.1.1.3" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.SS2.p1.13.m5.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.p1.13.m5.2.2.3" xref="S3.SS2.p1.13.m5.2.2.3.cmml">=</mo><mrow id="S3.SS2.p1.13.m5.2.2.2" xref="S3.SS2.p1.13.m5.2.2.2.cmml"><mtext id="S3.SS2.p1.13.m5.2.2.2.3" xref="S3.SS2.p1.13.m5.2.2.2.3a.cmml">SoftMax</mtext><mo id="S3.SS2.p1.13.m5.2.2.2.2" xref="S3.SS2.p1.13.m5.2.2.2.2.cmml">⁢</mo><mrow id="S3.SS2.p1.13.m5.2.2.2.1.1" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.cmml"><mo id="S3.SS2.p1.13.m5.2.2.2.1.1.2" stretchy="false" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.SS2.p1.13.m5.2.2.2.1.1.1" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.cmml"><mtext id="S3.SS2.p1.13.m5.2.2.2.1.1.1.3" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.3a.cmml">TopK</mtext><mo id="S3.SS2.p1.13.m5.2.2.2.1.1.1.2" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.cmml"><mo id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.cmml"><msub id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.cmml"><mi id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.2" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.2.cmml">W</mi><mi id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.3" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.1" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.3" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS2.p1.13.m5.2.2.2.1.1.3" stretchy="false" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.13.m5.2b"><apply id="S3.SS2.p1.13.m5.2.2.cmml" xref="S3.SS2.p1.13.m5.2.2"><eq id="S3.SS2.p1.13.m5.2.2.3.cmml" xref="S3.SS2.p1.13.m5.2.2.3"></eq><apply id="S3.SS2.p1.13.m5.1.1.1.cmml" xref="S3.SS2.p1.13.m5.1.1.1"><times id="S3.SS2.p1.13.m5.1.1.1.2.cmml" xref="S3.SS2.p1.13.m5.1.1.1.2"></times><ci id="S3.SS2.p1.13.m5.1.1.1.3.cmml" xref="S3.SS2.p1.13.m5.1.1.1.3">𝑔</ci><apply id="S3.SS2.p1.13.m5.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1"><times id="S3.SS2.p1.13.m5.1.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.1"></times><apply id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.2">𝑊</ci><ci id="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="S3.SS2.p1.13.m5.1.1.1.1.1.1.3.cmml" xref="S3.SS2.p1.13.m5.1.1.1.1.1.1.3">𝑥</ci></apply></apply><apply id="S3.SS2.p1.13.m5.2.2.2.cmml" xref="S3.SS2.p1.13.m5.2.2.2"><times id="S3.SS2.p1.13.m5.2.2.2.2.cmml" xref="S3.SS2.p1.13.m5.2.2.2.2"></times><ci id="S3.SS2.p1.13.m5.2.2.2.3a.cmml" xref="S3.SS2.p1.13.m5.2.2.2.3"><mtext id="S3.SS2.p1.13.m5.2.2.2.3.cmml" xref="S3.SS2.p1.13.m5.2.2.2.3">SoftMax</mtext></ci><apply id="S3.SS2.p1.13.m5.2.2.2.1.1.1.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1"><times id="S3.SS2.p1.13.m5.2.2.2.1.1.1.2.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.2"></times><ci id="S3.SS2.p1.13.m5.2.2.2.1.1.1.3a.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.3"><mtext id="S3.SS2.p1.13.m5.2.2.2.1.1.1.3.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.3">TopK</mtext></ci><apply id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1"><times id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.1"></times><apply id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.2">𝑊</ci><ci id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.3.cmml" xref="S3.SS2.p1.13.m5.2.2.2.1.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.13.m5.2c">g(W_{l}x)=\text{SoftMax}(\text{TopK}(W_{l}x))</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.13.m5.2d">italic_g ( italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_x ) = SoftMax ( TopK ( italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_x ) )</annotation></semantics></math>인 Top-k(k=2) 라우팅을 사용한다.</p>
</div>
<div class="ltx_para" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.1">자기 주의 하위 계층의 경우 가중치를 평균하여 서로 다른 도메인 전문가를 결합한다. 이 배경의 동기는 자기 주의 계층이 피드포워드 계층보다 덜 전문화된 영역이라는 가정이다. 나머지 파라미터(임베딩 등)에 대해서도 동일한 평균화를 수행한다.</p>
</div>
<div class="ltx_para" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.2">우리가 소개하는 유일한 새로운 매개변수는 라우터의 변환 매개변수 <math alttext="W_{l}" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><msub id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml"><mi id="S3.SS2.p3.1.m1.1.1.2" xref="S3.SS2.p3.1.m1.1.1.2.cmml">W</mi><mi id="S3.SS2.p3.1.m1.1.1.3" xref="S3.SS2.p3.1.m1.1.1.3.cmml">l</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><apply id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.1.m1.1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p3.1.m1.1.1.2.cmml" xref="S3.SS2.p3.1.m1.1.1.2">𝑊</ci><ci id="S3.SS2.p3.1.m1.1.1.3.cmml" xref="S3.SS2.p3.1.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">W_{l}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT</annotation></semantics></math>이며, 이는 네트워크의 나머지 부분에 비해 크기가 무시할 수 있다. 그럼에도 불구하고, 이러한 새로운 파라미터들은 미세 조정될 필요가 있으며, 따라서 라우터는 어떤 도메인 <math alttext="\mathtt{FF}_{i}" class="ltx_Math" display="inline" id="S3.SS2.p3.2.m2.1"><semantics id="S3.SS2.p3.2.m2.1a"><msub id="S3.SS2.p3.2.m2.1.1" xref="S3.SS2.p3.2.m2.1.1.cmml"><mi id="S3.SS2.p3.2.m2.1.1.2" xref="S3.SS2.p3.2.m2.1.1.2.cmml">𝙵𝙵</mi><mi id="S3.SS2.p3.2.m2.1.1.3" xref="S3.SS2.p3.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.2.m2.1b"><apply id="S3.SS2.p3.2.m2.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.2.m2.1.1.1.cmml" xref="S3.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p3.2.m2.1.1.2.cmml" xref="S3.SS2.p3.2.m2.1.1.2">𝙵𝙵</ci><ci id="S3.SS2.p3.2.m2.1.1.3.cmml" xref="S3.SS2.p3.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.2.m2.1c">\mathtt{FF}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.2.m2.1d">typewriter_FF start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>를 사용할지를 선택함에 있어서 최적의 결정을 내릴 수 있다. 또한, 펀튜닝은 평균화에 의해 자기 주의 가중치가 구성되고, 최적이 아닐 가능성이 높기 때문에 도움이 된다. 전반적으로 전체 시스템은 당황스러울 정도로 병렬적인 훈련 프레임워크에서 함께 작업하는 데 전혀 최적화되지 않았지만, 우리의 가설은 소량의 결합된 미세 조정도 큰 개선을 가져올 수 있다는 것이다.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Variations</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.1">또한 본 논문에서 제안한 방법을 여러 가지 방법으로 실험하였다.</p>
</div>
<section class="ltx_paragraph" id="S3.SS3.SSS0.Px1">
<h5 class="ltx_title ltx_title_paragraph">Load balancing</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS3.SSS0.Px1.p1">
<p class="ltx_p" id="S3.SS3.SSS0.Px1.p1.3">MoE의 공통적인 문제는 라우터에 의해 전혀 활성화되지 않는 죽은 전문가의 출현이다. Top-k와 같은 일반적인 라우팅 방법은 죽은 전문가가 Top-k 선택에 있지 않으므로 훈련 신호를 받지 않기 때문에 그러한 상황에서 벗어날 가능성이 낮다. 부하 분산은 전문가가 동등하게 활용되도록 권장하는 추가 손실 항을 추가하여 간단한 솔루션을 제공합니다. <cite class="ltx_cite ltx_citemacro_citep">(Fedus et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib13" title="">2022</a>)</cite>와 유사한 손실 용어를 사용한다:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\mathcal{L}_{\text{LB}}=\alpha N\sum_{i=1}^{N}u_{i}p_{i}\quad\text{where}\ u_{%
i}=\frac{1}{|\mathcal{B}|}\sum_{x\in\mathcal{B}}g_{i}(W_{l}x)\ \text{and}\ p_{%
i}=\frac{1}{|\mathcal{B}|}\sum_{x\in\mathcal{B}}\text{SoftMax}_{i}(W_{l}x)." class="ltx_Math" display="block" id="S3.Ex2.m1.3"><semantics id="S3.Ex2.m1.3a"><mrow id="S3.Ex2.m1.3.3.1"><mrow id="S3.Ex2.m1.3.3.1.1.2" xref="S3.Ex2.m1.3.3.1.1.3.cmml"><mrow id="S3.Ex2.m1.3.3.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.1.1.cmml"><msub id="S3.Ex2.m1.3.3.1.1.1.1.2" xref="S3.Ex2.m1.3.3.1.1.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex2.m1.3.3.1.1.1.1.2.2" xref="S3.Ex2.m1.3.3.1.1.1.1.2.2.cmml">ℒ</mi><mtext id="S3.Ex2.m1.3.3.1.1.1.1.2.3" xref="S3.Ex2.m1.3.3.1.1.1.1.2.3a.cmml">LB</mtext></msub><mo id="S3.Ex2.m1.3.3.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.1.1.1.cmml">=</mo><mrow id="S3.Ex2.m1.3.3.1.1.1.1.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.2" xref="S3.Ex2.m1.3.3.1.1.1.1.3.2.cmml">α</mi><mo id="S3.Ex2.m1.3.3.1.1.1.1.3.1" xref="S3.Ex2.m1.3.3.1.1.1.1.3.1.cmml">⁢</mo><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.3.cmml">N</mi><mo id="S3.Ex2.m1.3.3.1.1.1.1.3.1a" xref="S3.Ex2.m1.3.3.1.1.1.1.3.1.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.1.1.3.4" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.cmml"><munderover id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.cmml"><mo id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.2" movablelimits="false" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.2.cmml">∑</mo><mrow id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.2" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.2.cmml">i</mi><mo id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.1" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.1.cmml">=</mo><mn id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.3.cmml">1</mn></mrow><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.3.cmml">N</mi></munderover><mrow id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.cmml"><msub id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.cmml"><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.2" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.2.cmml">u</mi><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.3.cmml">i</mi></msub><mo id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.1" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.1.cmml">⁢</mo><msub id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.2" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.2.cmml">p</mi><mi id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.3" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.3.cmml">i</mi></msub></mrow></mrow></mrow></mrow><mspace id="S3.Ex2.m1.3.3.1.1.2.3" width="1em" xref="S3.Ex2.m1.3.3.1.1.3a.cmml"></mspace><mrow id="S3.Ex2.m1.3.3.1.1.2.2" xref="S3.Ex2.m1.3.3.1.1.2.2.cmml"><mrow id="S3.Ex2.m1.3.3.1.1.2.2.4" xref="S3.Ex2.m1.3.3.1.1.2.2.4.cmml"><mtext id="S3.Ex2.m1.3.3.1.1.2.2.4.2" xref="S3.Ex2.m1.3.3.1.1.2.2.4.2a.cmml">where</mtext><mo id="S3.Ex2.m1.3.3.1.1.2.2.4.1" lspace="0.500em" xref="S3.Ex2.m1.3.3.1.1.2.2.4.1.cmml">⁢</mo><msub id="S3.Ex2.m1.3.3.1.1.2.2.4.3" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.4.3.2" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3.2.cmml">u</mi><mi id="S3.Ex2.m1.3.3.1.1.2.2.4.3.3" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3.3.cmml">i</mi></msub></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.2.5" xref="S3.Ex2.m1.3.3.1.1.2.2.5.cmml">=</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.cmml"><mfrac id="S3.Ex2.m1.1.1" xref="S3.Ex2.m1.1.1.cmml"><mn id="S3.Ex2.m1.1.1.3" xref="S3.Ex2.m1.1.1.3.cmml">1</mn><mrow id="S3.Ex2.m1.1.1.1.3" xref="S3.Ex2.m1.1.1.1.2.cmml"><mo id="S3.Ex2.m1.1.1.1.3.1" stretchy="false" xref="S3.Ex2.m1.1.1.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.Ex2.m1.1.1.1.1" xref="S3.Ex2.m1.1.1.1.1.cmml">ℬ</mi><mo id="S3.Ex2.m1.1.1.1.3.2" stretchy="false" xref="S3.Ex2.m1.1.1.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.2.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.cmml"><munder id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.cmml"><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.2" movablelimits="false" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.2.cmml">∑</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.2.cmml">x</mi><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.3.cmml">ℬ</mi></mrow></munder><mrow id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.cmml"><msub id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.2.cmml">g</mi><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.3.cmml">i</mi></msub><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.cmml"><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.2" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.cmml"><msub id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.2.cmml">W</mi><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.1.cmml">⁢</mo><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.3" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2a" lspace="0.500em" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2.cmml">⁢</mo><mtext id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.4" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.4a.cmml">and</mtext><mo id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2b" lspace="0.500em" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2.cmml">⁢</mo><msub id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.2" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.2.cmml">p</mi><mi id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.3" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.3.cmml">i</mi></msub></mrow></mrow></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.2.6" xref="S3.Ex2.m1.3.3.1.1.2.2.6.cmml">=</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.cmml"><mfrac id="S3.Ex2.m1.2.2" xref="S3.Ex2.m1.2.2.cmml"><mn id="S3.Ex2.m1.2.2.3" xref="S3.Ex2.m1.2.2.3.cmml">1</mn><mrow id="S3.Ex2.m1.2.2.1.3" xref="S3.Ex2.m1.2.2.1.2.cmml"><mo id="S3.Ex2.m1.2.2.1.3.1" stretchy="false" xref="S3.Ex2.m1.2.2.1.2.1.cmml">|</mo><mi class="ltx_font_mathcaligraphic" id="S3.Ex2.m1.2.2.1.1" xref="S3.Ex2.m1.2.2.1.1.cmml">ℬ</mi><mo id="S3.Ex2.m1.2.2.1.3.2" stretchy="false" xref="S3.Ex2.m1.2.2.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.2.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.2.1" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.cmml"><munder id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.cmml"><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.2" movablelimits="false" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.2.cmml">∑</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.2.cmml">x</mi><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.1" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.1.cmml">∈</mo><mi class="ltx_font_mathcaligraphic" id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.3" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.3.cmml">ℬ</mi></mrow></munder><mrow id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.cmml"><msub id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.cmml"><mtext id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.2a.cmml">SoftMax</mtext><mi id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.3" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.3.cmml">i</mi></msub><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.2.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.cmml"><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.2" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.cmml"><msub id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.2" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.2.cmml">W</mi><mi id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.3" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.3.cmml">l</mi></msub><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.cmml">⁢</mo><mi id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.3" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.3" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow><mo id="S3.Ex2.m1.3.3.1.2" lspace="0em">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex2.m1.3b"><apply id="S3.Ex2.m1.3.3.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.3a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.3">formulae-sequence</csymbol><apply id="S3.Ex2.m1.3.3.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1"><eq id="S3.Ex2.m1.3.3.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.1"></eq><apply id="S3.Ex2.m1.3.3.1.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.1.1.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.1.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.2.2">ℒ</ci><ci id="S3.Ex2.m1.3.3.1.1.1.1.2.3a.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.2.3"><mtext id="S3.Ex2.m1.3.3.1.1.1.1.2.3.cmml" mathsize="70%" xref="S3.Ex2.m1.3.3.1.1.1.1.2.3">LB</mtext></ci></apply><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3"><times id="S3.Ex2.m1.3.3.1.1.1.1.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.1"></times><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.2">𝛼</ci><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.3">𝑁</ci><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4"><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1">superscript</csymbol><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1">subscript</csymbol><sum id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.2"></sum><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3"><eq id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.1"></eq><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.2">𝑖</ci><cn id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.3.cmml" type="integer" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.2.3.3">1</cn></apply></apply><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.1.3">𝑁</ci></apply><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2"><times id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.1"></times><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.2">𝑢</ci><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.2.3">𝑖</ci></apply><apply id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.2">𝑝</ci><ci id="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.3.4.2.3.3">𝑖</ci></apply></apply></apply></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2"><and id="S3.Ex2.m1.3.3.1.1.2.2a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2"></and><apply id="S3.Ex2.m1.3.3.1.1.2.2b.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2"><eq id="S3.Ex2.m1.3.3.1.1.2.2.5.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.5"></eq><apply id="S3.Ex2.m1.3.3.1.1.2.2.4.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4"><times id="S3.Ex2.m1.3.3.1.1.2.2.4.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.1"></times><ci id="S3.Ex2.m1.3.3.1.1.2.2.4.2a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.2"><mtext id="S3.Ex2.m1.3.3.1.1.2.2.4.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.2">where</mtext></ci><apply id="S3.Ex2.m1.3.3.1.1.2.2.4.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.4.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.2.4.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3.2">𝑢</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.4.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.4.3.3">𝑖</ci></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1"><times id="S3.Ex2.m1.3.3.1.1.2.2.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.2"></times><apply id="S3.Ex2.m1.1.1.cmml" xref="S3.Ex2.m1.1.1"><divide id="S3.Ex2.m1.1.1.2.cmml" xref="S3.Ex2.m1.1.1"></divide><cn id="S3.Ex2.m1.1.1.3.cmml" type="integer" xref="S3.Ex2.m1.1.1.3">1</cn><apply id="S3.Ex2.m1.1.1.1.2.cmml" xref="S3.Ex2.m1.1.1.1.3"><abs id="S3.Ex2.m1.1.1.1.2.1.cmml" xref="S3.Ex2.m1.1.1.1.3.1"></abs><ci id="S3.Ex2.m1.1.1.1.1.cmml" xref="S3.Ex2.m1.1.1.1.1">ℬ</ci></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1"><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2">subscript</csymbol><sum id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.2"></sum><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3"><in id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.1"></in><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.2">𝑥</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.2.3.3">ℬ</ci></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1"><times id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.2"></times><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.2">𝑔</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.3.3">𝑖</ci></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1"><times id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.1"></times><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.2">𝑊</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.1.1.1.3">𝑥</ci></apply><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.4a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.4"><mtext id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.4.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.4">and</mtext></ci><apply id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.2">𝑝</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.1.1.1.5.3">𝑖</ci></apply></apply></apply></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2c.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2"><eq id="S3.Ex2.m1.3.3.1.1.2.2.6.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.6"></eq><share href="#S3.Ex2.m1.3.3.1.1.2.2.1.cmml" id="S3.Ex2.m1.3.3.1.1.2.2d.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2"></share><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2"><times id="S3.Ex2.m1.3.3.1.1.2.2.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.2"></times><apply id="S3.Ex2.m1.2.2.cmml" xref="S3.Ex2.m1.2.2"><divide id="S3.Ex2.m1.2.2.2.cmml" xref="S3.Ex2.m1.2.2"></divide><cn id="S3.Ex2.m1.2.2.3.cmml" type="integer" xref="S3.Ex2.m1.2.2.3">1</cn><apply id="S3.Ex2.m1.2.2.1.2.cmml" xref="S3.Ex2.m1.2.2.1.3"><abs id="S3.Ex2.m1.2.2.1.2.1.cmml" xref="S3.Ex2.m1.2.2.1.3.1"></abs><ci id="S3.Ex2.m1.2.2.1.1.cmml" xref="S3.Ex2.m1.2.2.1.1">ℬ</ci></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1"><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2">subscript</csymbol><sum id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.2"></sum><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3"><in id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.1"></in><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.2">𝑥</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.2.3.3">ℬ</ci></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1"><times id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.2"></times><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.2a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.2"><mtext id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.2">SoftMax</mtext></ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.3.3">𝑖</ci></apply><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1"><times id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.1"></times><apply id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2">subscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.2">𝑊</ci><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.2.3">𝑙</ci></apply><ci id="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.2.2.1.1.1.1.1.3">𝑥</ci></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex2.m1.3c">\mathcal{L}_{\text{LB}}=\alpha N\sum_{i=1}^{N}u_{i}p_{i}\quad\text{where}\ u_{%
i}=\frac{1}{|\mathcal{B}|}\sum_{x\in\mathcal{B}}g_{i}(W_{l}x)\ \text{and}\ p_{%
i}=\frac{1}{|\mathcal{B}|}\sum_{x\in\mathcal{B}}\text{SoftMax}_{i}(W_{l}x).</annotation><annotation encoding="application/x-llamapun" id="S3.Ex2.m1.3d">caligraphic_L start_POSTSUBSCRIPT LB end_POSTSUBSCRIPT = italic_α italic_N ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT italic_u start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_p start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT where italic_u start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = divide start_ARG 1 end_ARG start_ARG | caligraphic_B | end_ARG ∑ start_POSTSUBSCRIPT italic_x ∈ caligraphic_B end_POSTSUBSCRIPT italic_g start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_x ) and italic_p start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = divide start_ARG 1 end_ARG start_ARG | caligraphic_B | end_ARG ∑ start_POSTSUBSCRIPT italic_x ∈ caligraphic_B end_POSTSUBSCRIPT SoftMax start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( italic_W start_POSTSUBSCRIPT italic_l end_POSTSUBSCRIPT italic_x ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.SSS0.Px1.p1.2">여기서 <math alttext="\mathcal{B}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p1.1.m1.1"><semantics id="S3.SS3.SSS0.Px1.p1.1.m1.1a"><mi class="ltx_font_mathcaligraphic" id="S3.SS3.SSS0.Px1.p1.1.m1.1.1" xref="S3.SS3.SSS0.Px1.p1.1.m1.1.1.cmml">ℬ</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p1.1.m1.1b"><ci id="S3.SS3.SSS0.Px1.p1.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px1.p1.1.m1.1.1">ℬ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p1.1.m1.1c">\mathcal{B}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p1.1.m1.1d">caligraphic_B</annotation></semantics></math>는 현재 데이터 배치이고, <math alttext="\alpha" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px1.p1.2.m2.1"><semantics id="S3.SS3.SSS0.Px1.p1.2.m2.1a"><mi id="S3.SS3.SSS0.Px1.p1.2.m2.1.1" xref="S3.SS3.SSS0.Px1.p1.2.m2.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px1.p1.2.m2.1b"><ci id="S3.SS3.SSS0.Px1.p1.2.m2.1.1.cmml" xref="S3.SS3.SSS0.Px1.p1.2.m2.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px1.p1.2.m2.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px1.p1.2.m2.1d">italic_α</annotation></semantics></math>는 하이퍼파라미터이다. 이 손실은 각 층에서 계산되고 NLL 손실에 추가된다.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS0.Px2">
<h5 class="ltx_title ltx_title_paragraph">Routing method</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS3.SSS0.Px2.p1">
<p class="ltx_p" id="S3.SS3.SSS0.Px2.p1.1">Top-k 라우팅 외에도 다른 라우팅 방법을 실험한다.</p>
<ul class="ltx_itemize" id="S3.I1">
<li class="ltx_item" id="S3.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i1.p1">
<p class="ltx_p" id="S3.I1.i1.p1.1">Switch: <cite class="ltx_cite ltx_citemacro_citet">Fedus et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib13" title="">2022</a>)</cite>에서 제안한 Top-1 라우팅 방식이다.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i2.p1">
<p class="ltx_p" id="S3.I1.i2.p1.1">소프트 라우팅: 라우팅 함수 <math alttext="g" class="ltx_Math" display="inline" id="S3.I1.i2.p1.1.m1.1"><semantics id="S3.I1.i2.p1.1.m1.1a"><mi id="S3.I1.i2.p1.1.m1.1.1" xref="S3.I1.i2.p1.1.m1.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i2.p1.1.m1.1b"><ci id="S3.I1.i2.p1.1.m1.1.1.cmml" xref="S3.I1.i2.p1.1.m1.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i2.p1.1.m1.1c">g</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i2.p1.1.m1.1d">italic_g</annotation></semantics></math>로 softmax를 사용하므로 모든 전문가가 훈련과 추론 중에 모두 활성화된다. 최상의 성능을 제공할 수 있지만 컴퓨팅 증가를 희생해야 합니다.</p>
</div>
</li>
<li class="ltx_item" id="S3.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S3.I1.i3.p1">
<p class="ltx_p" id="S3.I1.i3.p1.1">샘플 Top-1: <math alttext="g" class="ltx_Math" display="inline" id="S3.I1.i3.p1.1.m1.1"><semantics id="S3.I1.i3.p1.1.m1.1a"><mi id="S3.I1.i3.p1.1.m1.1.1" xref="S3.I1.i3.p1.1.m1.1.1.cmml">g</mi><annotation-xml encoding="MathML-Content" id="S3.I1.i3.p1.1.m1.1b"><ci id="S3.I1.i3.p1.1.m1.1.1.cmml" xref="S3.I1.i3.p1.1.m1.1.1">𝑔</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.I1.i3.p1.1.m1.1c">g</annotation><annotation encoding="application/x-llamapun" id="S3.I1.i3.p1.1.m1.1d">italic_g</annotation></semantics></math>에 gumbel softmax <cite class="ltx_cite ltx_citemacro_citep">(Jang et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib20" title="">2016</a>)</cite>를 사용한다. 훈련 시간에는 검벨 소프트맥스로부터 소프트 샘플을 생성하지만 가장 큰 값을 제외한 모든 값을 0으로 제거한다. 그런 다음 다른 전문가 계산을 생략하고 이 가장 큰 값에 해당하는 하나의 전문가만 계산합니다. 추론할 때, 우리는 단순히 하드 샘플링을 한다. 우리는 훈련과 추론 사이의 불일치를 점진적으로 줄이기 위해 훈련의 끝에서 온도를 날카로운 분포로 가열냉각한다.</p>
</div>
</li>
</ul>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS0.Px3">
<h5 class="ltx_title ltx_title_paragraph">Splitting Experts</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS3.SSS0.Px3.p1">
<p class="ltx_p" id="S3.SS3.SSS0.Px3.p1.5">MoE 계층의 모듈 수는 각 모듈이 하나의 도메인에 해당하기 때문에 우리가 훈련하는 도메인의 수와 일치한다. 그러나, 각 도메인 FF 하위 계층을 여러 개의 청크로 분할함으로써 간단한 방법으로 모듈의 수를 증가시킬 수 있다. <math alttext="N" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px3.p1.1.m1.1"><semantics id="S3.SS3.SSS0.Px3.p1.1.m1.1a"><mi id="S3.SS3.SSS0.Px3.p1.1.m1.1.1" xref="S3.SS3.SSS0.Px3.p1.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px3.p1.1.m1.1b"><ci id="S3.SS3.SSS0.Px3.p1.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px3.p1.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px3.p1.1.m1.1d">italic_N</annotation></semantics></math> 도메인과 <math alttext="d_{\text{FF}}" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px3.p1.2.m2.1"><semantics id="S3.SS3.SSS0.Px3.p1.2.m2.1a"><msub id="S3.SS3.SSS0.Px3.p1.2.m2.1.1" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1.cmml"><mi id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.2" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1.2.cmml">d</mi><mtext id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.3" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1.3a.cmml">FF</mtext></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px3.p1.2.m2.1b"><apply id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1.2">𝑑</ci><ci id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.3a.cmml" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1.3"><mtext id="S3.SS3.SSS0.Px3.p1.2.m2.1.1.3.cmml" mathsize="70%" xref="S3.SS3.SSS0.Px3.p1.2.m2.1.1.3">FF</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px3.p1.2.m2.1c">d_{\text{FF}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px3.p1.2.m2.1d">italic_d start_POSTSUBSCRIPT FF end_POSTSUBSCRIPT</annotation></semantics></math>의 FF 활성화 크기가 주어지면, 각 FF 레이어를 <math alttext="C" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px3.p1.3.m3.1"><semantics id="S3.SS3.SSS0.Px3.p1.3.m3.1a"><mi id="S3.SS3.SSS0.Px3.p1.3.m3.1.1" xref="S3.SS3.SSS0.Px3.p1.3.m3.1.1.cmml">C</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px3.p1.3.m3.1b"><ci id="S3.SS3.SSS0.Px3.p1.3.m3.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.3.m3.1.1">𝐶</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px3.p1.3.m3.1c">C</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px3.p1.3.m3.1d">italic_C</annotation></semantics></math> 청크로 나누어 <math alttext="d_{\text{FF}}/C" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px3.p1.4.m4.1"><semantics id="S3.SS3.SSS0.Px3.p1.4.m4.1a"><mrow id="S3.SS3.SSS0.Px3.p1.4.m4.1.1" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.cmml"><msub id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.cmml"><mi id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.2" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.2.cmml">d</mi><mtext id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.3" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.3a.cmml">FF</mtext></msub><mo id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.1" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.1.cmml">/</mo><mi id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.3" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px3.p1.4.m4.1b"><apply id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1"><divide id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.1"></divide><apply id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.1.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2">subscript</csymbol><ci id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.2.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.2">𝑑</ci><ci id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.3a.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.3"><mtext id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.3.cmml" mathsize="70%" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.2.3">FF</mtext></ci></apply><ci id="S3.SS3.SSS0.Px3.p1.4.m4.1.1.3.cmml" xref="S3.SS3.SSS0.Px3.p1.4.m4.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px3.p1.4.m4.1c">d_{\text{FF}}/C</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px3.p1.4.m4.1d">italic_d start_POSTSUBSCRIPT FF end_POSTSUBSCRIPT / italic_C</annotation></semantics></math>의 차원을 갖는다. 결과적으로, 최종 MoE 층은 <math alttext="MC" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px3.p1.5.m5.1"><semantics id="S3.SS3.SSS0.Px3.p1.5.m5.1a"><mrow id="S3.SS3.SSS0.Px3.p1.5.m5.1.1" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.cmml"><mi id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.2" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.2.cmml">M</mi><mo id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.1" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.1.cmml">⁢</mo><mi id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.3" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.3.cmml">C</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px3.p1.5.m5.1b"><apply id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1"><times id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.1.cmml" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.1"></times><ci id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.2.cmml" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.2">𝑀</ci><ci id="S3.SS3.SSS0.Px3.p1.5.m5.1.1.3.cmml" xref="S3.SS3.SSS0.Px3.p1.5.m5.1.1.3">𝐶</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px3.p1.5.m5.1c">MC</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px3.p1.5.m5.1d">italic_M italic_C</annotation></semantics></math> 모듈을 가질 것이다.</p>
</div>
</section>
<section class="ltx_paragraph" id="S3.SS3.SSS0.Px4">
<h5 class="ltx_title ltx_title_paragraph">Blending Experts</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S3.SS3.SSS0.Px4.p1">
<p class="ltx_p" id="S3.SS3.SSS0.Px4.p1.3">도메인 전문가로부터 MoE 전문가를 일대일 방식으로 직접 초기화하는 대신 각 MoE 전문가에 모든 도메인을 포함시키기도 한다. 이에 대한 동기는 표준 방식으로 훈련된 MoE 전문가들이 도메인 전문화를 보여주지 않고, 오히려 상이한 도메인들 <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib21" title="">2024</a>)</cite>에 걸쳐 균일하게 활성화된다는 관찰이다. 대조적으로, 우리의 도메인 전문가들은 그들의 훈련 데이터를 통해 특정 도메인에 특화되어 있다. 이 도메인 전문화를 깨기 위해 각 도메인 전문가의 FF 계층을 <math alttext="N" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px4.p1.1.m1.1"><semantics id="S3.SS3.SSS0.Px4.p1.1.m1.1a"><mi id="S3.SS3.SSS0.Px4.p1.1.m1.1.1" xref="S3.SS3.SSS0.Px4.p1.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px4.p1.1.m1.1b"><ci id="S3.SS3.SSS0.Px4.p1.1.m1.1.1.cmml" xref="S3.SS3.SSS0.Px4.p1.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px4.p1.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px4.p1.1.m1.1d">italic_N</annotation></semantics></math> 청크로 분할한 다음 모든 도메인의 <math alttext="n" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px4.p1.2.m2.1"><semantics id="S3.SS3.SSS0.Px4.p1.2.m2.1a"><mi id="S3.SS3.SSS0.Px4.p1.2.m2.1.1" xref="S3.SS3.SSS0.Px4.p1.2.m2.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px4.p1.2.m2.1b"><ci id="S3.SS3.SSS0.Px4.p1.2.m2.1.1.cmml" xref="S3.SS3.SSS0.Px4.p1.2.m2.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px4.p1.2.m2.1c">n</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px4.p1.2.m2.1d">italic_n</annotation></semantics></math>번째 청크를 병합하여 <math alttext="n" class="ltx_Math" display="inline" id="S3.SS3.SSS0.Px4.p1.3.m3.1"><semantics id="S3.SS3.SSS0.Px4.p1.3.m3.1a"><mi id="S3.SS3.SSS0.Px4.p1.3.m3.1.1" xref="S3.SS3.SSS0.Px4.p1.3.m3.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.SSS0.Px4.p1.3.m3.1b"><ci id="S3.SS3.SSS0.Px4.p1.3.m3.1.1.cmml" xref="S3.SS3.SSS0.Px4.p1.3.m3.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.SSS0.Px4.p1.3.m3.1c">n</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.SSS0.Px4.p1.3.m3.1d">italic_n</annotation></semantics></math>번째 MoE 전문가를 구축한다. 이러한 방식으로, 각각의 MoE 전문가는 모든 도메인으로부터 동일한 양의 파라미터를 포함한다.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S4" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Experimental Setup</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1"><span class="ltx_text ltx_font_smallcaps" id="S4.SS1.p1.1.1">Llama-2</span> pretraining <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib37" title="">2023</a>)</cite>에 사용된 설정을 기반으로 실험을 진행합니다. 특히 <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.p1.1.2">Llama-2</span> 7B 모델을 시드 모델로 사용합니다.</p>
</div>
<section class="ltx_subsubsection" id="S4.SS1.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.1 </span>BTX Training</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS1.SSS1.p1">
<p class="ltx_p" id="S4.SS1.SSS1.p1.1">우리는 시드 모델로 7B 매개변수와 함께 사전 훈련된 Llama-2 <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib37" title="">2023</a>)</cite>를 사용한다. 시드 모델 <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS1.p1.1.1">Llama-2 7B</span>의 세 개의 복사본을 만든 후 다음 도메인 데이터 세트에 대해 계속 학습하여 세 개의 도메인 전문가를 도출합니다.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p2">
<ul class="ltx_itemize" id="S4.I1">
<li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i1.p1">
<p class="ltx_p" id="S4.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i1.p1.1.1">Math:</span> Llemma <cite class="ltx_cite ltx_citemacro_citep">(Azerbayev et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib5" title="">2023</a>)</cite> 모델 훈련에서 사용된 동일한 데이터 소스 및 혼합물입니다. 릴레마와 견줄 수 있도록 동일한 양의 데이터, 즉 총 201B 토큰이 있는 48k 단계를 교육한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i2.p1">
<p class="ltx_p" id="S4.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i2.p1.1.1">Code:</span> <span class="ltx_text ltx_font_smallcaps" id="S4.I1.i2.p1.1.2">CodeLlama</span> pretraining <cite class="ltx_cite ltx_citemacro_citep">(Rozière et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib31" title="">2023</a>)</cite>에서 사용된 코드 데이터의 동일한 데이터 소스 및 혼합물입니다. 코드 전문가 LLM은 수학 전문가와 비교할 수 있도록 총 210B 토큰으로 50k 단계에 대해 훈련된다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i3.p1">
<p class="ltx_p" id="S4.I1.i3.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i3.p1.1.1">Wikipedia:</span> Wikipedia documents extracted between June to August 2022. The data was preprocessed to remove hyperlinks, comments and other formatting boilerplate. 이것은 더 작은 데이터 세트이기 때문에 우리는 총 42B 토큰을 훈련한다.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S4.SS1.SSS1.p3">
<p class="ltx_p" id="S4.SS1.SSS1.p3.5">이 세 가지 도메인 전문가로만 진행할 수 있지만, 원래 시드 LLM을 "일반주의자" 전문가로 포함하여 일반 지식이 최종 모델로 전달되도록 한다. 따라서 이 네 가지 전문가 모델을 <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS2" title="3.2 MiX: Combining Separate Experts to be a Mixture-of-Experts ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Section</span> <span class="ltx_text ltx_ref_tag">3.2</span></a>에 설명된 대로 단일 MoE 모델로 혼합한다. 그런 다음 4명의 전문가(원본 <span class="ltx_text ltx_font_smallcaps" id="S4.SS1.SSS1.p3.5.1">Llama-2 7B</span> 일반 전문가용 사전 훈련 데이터 포함)를 훈련하고 다른 80B 토큰에 대해 훈련하는 데 사용되는 모든 데이터 원본에서 이 MoE 모델을 미세 조정합니다. 각 도메인뿐만 아니라 도메인 전체의 데이터 세트에 대한 자세한 샘플링 비율은 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S8" title="8 Data mixture ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Section 8</span></a>에 설명되어 있다. 기본 Top-2 라우팅이 있는 BTX의 경우 달리 명시되지 않는 한 <math alttext="\alpha=0.01" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p3.1.m1.1"><semantics id="S4.SS1.SSS1.p3.1.m1.1a"><mrow id="S4.SS1.SSS1.p3.1.m1.1.1" xref="S4.SS1.SSS1.p3.1.m1.1.1.cmml"><mi id="S4.SS1.SSS1.p3.1.m1.1.1.2" xref="S4.SS1.SSS1.p3.1.m1.1.1.2.cmml">α</mi><mo id="S4.SS1.SSS1.p3.1.m1.1.1.1" xref="S4.SS1.SSS1.p3.1.m1.1.1.1.cmml">=</mo><mn id="S4.SS1.SSS1.p3.1.m1.1.1.3" xref="S4.SS1.SSS1.p3.1.m1.1.1.3.cmml">0.01</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p3.1.m1.1b"><apply id="S4.SS1.SSS1.p3.1.m1.1.1.cmml" xref="S4.SS1.SSS1.p3.1.m1.1.1"><eq id="S4.SS1.SSS1.p3.1.m1.1.1.1.cmml" xref="S4.SS1.SSS1.p3.1.m1.1.1.1"></eq><ci id="S4.SS1.SSS1.p3.1.m1.1.1.2.cmml" xref="S4.SS1.SSS1.p3.1.m1.1.1.2">𝛼</ci><cn id="S4.SS1.SSS1.p3.1.m1.1.1.3.cmml" type="float" xref="S4.SS1.SSS1.p3.1.m1.1.1.3">0.01</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p3.1.m1.1c">\alpha=0.01</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p3.1.m1.1d">italic_α = 0.01</annotation></semantics></math>와 부하 균형을 사용합니다. 샘플 Top-1 라우팅의 경우, <math alttext="\tau" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p3.2.m2.1"><semantics id="S4.SS1.SSS1.p3.2.m2.1a"><mi id="S4.SS1.SSS1.p3.2.m2.1.1" xref="S4.SS1.SSS1.p3.2.m2.1.1.cmml">τ</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p3.2.m2.1b"><ci id="S4.SS1.SSS1.p3.2.m2.1.1.cmml" xref="S4.SS1.SSS1.p3.2.m2.1.1">𝜏</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p3.2.m2.1c">\tau</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p3.2.m2.1d">italic_τ</annotation></semantics></math>=max(<math alttext="0.5,-rt" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p3.3.m3.2"><semantics id="S4.SS1.SSS1.p3.3.m3.2a"><mrow id="S4.SS1.SSS1.p3.3.m3.2.2.1" xref="S4.SS1.SSS1.p3.3.m3.2.2.2.cmml"><mn id="S4.SS1.SSS1.p3.3.m3.1.1" xref="S4.SS1.SSS1.p3.3.m3.1.1.cmml">0.5</mn><mo id="S4.SS1.SSS1.p3.3.m3.2.2.1.2" xref="S4.SS1.SSS1.p3.3.m3.2.2.2.cmml">,</mo><mrow id="S4.SS1.SSS1.p3.3.m3.2.2.1.1" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.cmml"><mo id="S4.SS1.SSS1.p3.3.m3.2.2.1.1a" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.cmml">−</mo><mrow id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.cmml"><mi id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.2" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.2.cmml">r</mi><mo id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.1" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.1.cmml">⁢</mo><mi id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.3" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.3.cmml">t</mi></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p3.3.m3.2b"><list id="S4.SS1.SSS1.p3.3.m3.2.2.2.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1"><cn id="S4.SS1.SSS1.p3.3.m3.1.1.cmml" type="float" xref="S4.SS1.SSS1.p3.3.m3.1.1">0.5</cn><apply id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1"><minus id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.1.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1"></minus><apply id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2"><times id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.1.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.1"></times><ci id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.2.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.2">𝑟</ci><ci id="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.3.cmml" xref="S4.SS1.SSS1.p3.3.m3.2.2.1.1.2.3">𝑡</ci></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p3.3.m3.2c">0.5,-rt</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p3.3.m3.2d">0.5 , - italic_r italic_t</annotation></semantics></math>)를 <cite class="ltx_cite ltx_citemacro_cite">Jang et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib20" title="">2016</a>)</cite>에서 <math alttext="r=1e-4" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p3.4.m4.1"><semantics id="S4.SS1.SSS1.p3.4.m4.1a"><mrow id="S4.SS1.SSS1.p3.4.m4.1.1" xref="S4.SS1.SSS1.p3.4.m4.1.1.cmml"><mi id="S4.SS1.SSS1.p3.4.m4.1.1.2" xref="S4.SS1.SSS1.p3.4.m4.1.1.2.cmml">r</mi><mo id="S4.SS1.SSS1.p3.4.m4.1.1.1" xref="S4.SS1.SSS1.p3.4.m4.1.1.1.cmml">=</mo><mrow id="S4.SS1.SSS1.p3.4.m4.1.1.3" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.cmml"><mrow id="S4.SS1.SSS1.p3.4.m4.1.1.3.2" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.cmml"><mn id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.2" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.2.cmml">1</mn><mo id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.1" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.1.cmml">⁢</mo><mi id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.3" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.3.cmml">e</mi></mrow><mo id="S4.SS1.SSS1.p3.4.m4.1.1.3.1" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.1.cmml">−</mo><mn id="S4.SS1.SSS1.p3.4.m4.1.1.3.3" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.3.cmml">4</mn></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p3.4.m4.1b"><apply id="S4.SS1.SSS1.p3.4.m4.1.1.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1"><eq id="S4.SS1.SSS1.p3.4.m4.1.1.1.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.1"></eq><ci id="S4.SS1.SSS1.p3.4.m4.1.1.2.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.2">𝑟</ci><apply id="S4.SS1.SSS1.p3.4.m4.1.1.3.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.3"><minus id="S4.SS1.SSS1.p3.4.m4.1.1.3.1.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.1"></minus><apply id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2"><times id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.1.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.1"></times><cn id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.2.cmml" type="integer" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.2">1</cn><ci id="S4.SS1.SSS1.p3.4.m4.1.1.3.2.3.cmml" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.2.3">𝑒</ci></apply><cn id="S4.SS1.SSS1.p3.4.m4.1.1.3.3.cmml" type="integer" xref="S4.SS1.SSS1.p3.4.m4.1.1.3.3">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p3.4.m4.1c">r=1e-4</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p3.4.m4.1d">italic_r = 1 italic_e - 4</annotation></semantics></math>로 사용하고, 여기서 <math alttext="t" class="ltx_Math" display="inline" id="S4.SS1.SSS1.p3.5.m5.1"><semantics id="S4.SS1.SSS1.p3.5.m5.1a"><mi id="S4.SS1.SSS1.p3.5.m5.1.1" xref="S4.SS1.SSS1.p3.5.m5.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS1.p3.5.m5.1b"><ci id="S4.SS1.SSS1.p3.5.m5.1.1.cmml" xref="S4.SS1.SSS1.p3.5.m5.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS1.p3.5.m5.1c">t</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS1.p3.5.m5.1d">italic_t</annotation></semantics></math>는 훈련 단계의 수이다. 첫 번째 레이어에 대해서만 소프트 라우팅을 대신 사용했습니다. 샘플 Top-1 훈련은 Top-2보다 효율적이기 때문에 동일한 컴퓨팅 예산으로 160B 토큰을 훈련할 수 있습니다.</p>
</div>
<figure class="ltx_table" id="S4.T1">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T1.2">
<tbody><tr class="ltx_tr" id="S4.T1.2.1">
<td class="ltx_td ltx_border_tt" id="S4.T1.2.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T1.2.1.2"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.2.1" style="font-size:90%;">Math</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T1.2.1.3"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.3.1" style="font-size:90%;">Code</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="3" id="S4.T1.2.1.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.1.4.1" style="font-size:90%;">General knowledge</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.2">
<td class="ltx_td" id="S4.T1.2.2.1"></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.2"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.2.1" style="font-size:90%;">GSM8K</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.3"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.3.1" style="font-size:90%;">MATH</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.4.1" style="font-size:90%;">Human</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.5"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.5.1" style="font-size:90%;">MBPP</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.6"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.6.1" style="font-size:90%;">Natural</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.7"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.7.1" style="font-size:90%;">Trivia</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.2.8"><span class="ltx_text ltx_font_bold" id="S4.T1.2.2.8.1" style="font-size:90%;">MMLU</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.3">
<td class="ltx_td" id="S4.T1.2.3.1"></td>
<td class="ltx_td" id="S4.T1.2.3.2"></td>
<td class="ltx_td" id="S4.T1.2.3.3"></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.3.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.3.4.1" style="font-size:90%;">Eval</span></td>
<td class="ltx_td" id="S4.T1.2.3.5"></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.3.6"><span class="ltx_text ltx_font_bold" id="S4.T1.2.3.6.1" style="font-size:90%;">Questions</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.3.7"><span class="ltx_text ltx_font_bold" id="S4.T1.2.3.7.1" style="font-size:90%;">QA</span></td>
<td class="ltx_td" id="S4.T1.2.3.8"></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T1.2.4.1"><span class="ltx_text ltx_font_smallcaps" id="S4.T1.2.4.1.1" style="font-size:90%;">Llama-2 7B</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.2"><span class="ltx_text" id="S4.T1.2.4.2.1" style="font-size:90%;">14.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.3"><span class="ltx_text" id="S4.T1.2.4.3.1" style="font-size:90%;">2.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.4"><span class="ltx_text" id="S4.T1.2.4.4.1" style="font-size:90%;">12.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.5"><span class="ltx_text" id="S4.T1.2.4.5.1" style="font-size:90%;">20.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.6"><span class="ltx_text" id="S4.T1.2.4.6.1" style="font-size:90%;">16.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.7"><span class="ltx_text ltx_font_bold" id="S4.T1.2.4.7.1" style="font-size:90%;">58.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T1.2.4.8"><span class="ltx_text" id="S4.T1.2.4.8.1" style="font-size:90%;">46.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.5">
<td class="ltx_td ltx_align_left" id="S4.T1.2.5.1"><span class="ltx_text" id="S4.T1.2.5.1.1" style="font-size:90%;">Math expert</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.2"><span class="ltx_text ltx_font_bold" id="S4.T1.2.5.2.1" style="font-size:90%;">39.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.3"><span class="ltx_text ltx_font_bold" id="S4.T1.2.5.3.1" style="font-size:90%;">18.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.4"><span class="ltx_text" id="S4.T1.2.5.4.1" style="font-size:90%;">25.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.5"><span class="ltx_text" id="S4.T1.2.5.5.1" style="font-size:90%;">33.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.6"><span class="ltx_text" id="S4.T1.2.5.6.1" style="font-size:90%;">14.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.7"><span class="ltx_text" id="S4.T1.2.5.7.1" style="font-size:90%;">37.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.5.8"><span class="ltx_text ltx_font_bold" id="S4.T1.2.5.8.1" style="font-size:90%;">52.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.6">
<td class="ltx_td ltx_align_left" id="S4.T1.2.6.1"><span class="ltx_text" id="S4.T1.2.6.1.1" style="font-size:90%;">Code expert</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.2"><span class="ltx_text" id="S4.T1.2.6.2.1" style="font-size:90%;">12.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.3"><span class="ltx_text" id="S4.T1.2.6.3.1" style="font-size:90%;">4.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.4"><span class="ltx_text ltx_font_bold" id="S4.T1.2.6.4.1" style="font-size:90%;">31.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.5"><span class="ltx_text ltx_font_bold" id="S4.T1.2.6.5.1" style="font-size:90%;">40.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.6"><span class="ltx_text" id="S4.T1.2.6.6.1" style="font-size:90%;">11.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.7"><span class="ltx_text" id="S4.T1.2.6.7.1" style="font-size:90%;">29.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T1.2.6.8"><span class="ltx_text" id="S4.T1.2.6.8.1" style="font-size:90%;">39.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.2.7">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T1.2.7.1"><span class="ltx_text" id="S4.T1.2.7.1.1" style="font-size:90%;">Wikipedia expert</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.2"><span class="ltx_text" id="S4.T1.2.7.2.1" style="font-size:90%;">11.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.3"><span class="ltx_text" id="S4.T1.2.7.3.1" style="font-size:90%;">3.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.4"><span class="ltx_text" id="S4.T1.2.7.4.1" style="font-size:90%;">11.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.5"><span class="ltx_text" id="S4.T1.2.7.5.1" style="font-size:90%;">15.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.6"><span class="ltx_text ltx_font_bold" id="S4.T1.2.7.6.1" style="font-size:90%;">21.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.7"><span class="ltx_text" id="S4.T1.2.7.7.1" style="font-size:90%;">57.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T1.2.7.8"><span class="ltx_text" id="S4.T1.2.7.8.1" style="font-size:90%;">43.1</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">표 1:</span> 대표 태스크에 대한 개별 도메인 전문가 LLM 성능 시드 모델 <span class="ltx_text ltx_font_smallcaps" id="S4.T1.11.1">Llama-2 7B</span>과 비교. 예상대로 코드와 수학 전문가는 해당 도메인 과제에 탁월합니다.</figcaption>
The Wikipedia expert performs better on Natural Questions, but the math expert has the best score on MMLU.
This could be because MMLU contains many math subjects and math training is shown to help on this task <cite class="ltx_cite ltx_citemacro_citep">(Shao et&nbsp;al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib35" title="">2024</a>)</cite>.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.2 </span>Baselines</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS1.SSS2.p1">
<p class="ltx_p" id="S4.SS1.SSS2.p1.1">다음 기준선과 비교합니다.</p>
</div>
<div class="ltx_para" id="S4.SS1.SSS2.p2">
<ul class="ltx_itemize" id="S4.I2">
<li class="ltx_item" id="S4.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i1.p1">
<p class="ltx_p" id="S4.I2.i1.p1.1"><span class="ltx_text ltx_font_smallcaps" id="S4.I2.i1.p1.1.1.1">Llama-2</span><span class="ltx_text ltx_font_bold" id="S4.I2.i1.p1.1.2">:</span> 우리는 시드 모델로 사용하는 원본 <span class="ltx_text ltx_font_smallcaps" id="S4.I2.i1.p1.1.3">Llama-2 7B</span> 뿐만 아니라 <span class="ltx_text ltx_font_smallcaps" id="S4.I2.i1.p1.1.4">Llama-2 13B</span>과 비교합니다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i2.p1">
<p class="ltx_p" id="S4.I2.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i2.p1.1.1">Dense:</span> 다른 도메인 데이터 세트에서 별도의 LLM을 훈련하는 대신 조밀한 기준선은 모든 데이터로 시드 LLM을 계속 훈련합니다. 우리는 BTX와 정확히 동일한 훈련 데이터를 사용하며, 먼저 전문가 훈련 단계에서 사용되는 새로운 도메인 특정 데이터에 대한 훈련을 수행한 다음, MoE 미세 조정 단계에서 <span class="ltx_text ltx_font_smallcaps" id="S4.I2.i2.p1.1.2">Llama-2</span> 사전 훈련 데이터를 포함하는 동일한 데이터 혼합물을 사용한다. 이 비교를 <em class="ltx_emph ltx_font_italic" id="S4.I2.i2.p1.1.3">data-matching</em> (DM)이라고 합니다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i3.p1">
<p class="ltx_p" id="S4.I2.i3.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i3.p1.1.1">Sparse upcycling:</span> This baseline <cite class="ltx_cite ltx_citemacro_citep">(Komatsuzaki et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib23" title="">2022</a>)</cite>는 전문가로서 feedforward 모듈의 4개의 동일한 복사본을 만들어 시드 모델로부터 MoE 모델을 초기화한다. 우리는 무작위로 초기화된 <math alttext="W_{i}" class="ltx_Math" display="inline" id="S4.I2.i3.p1.1.m1.1"><semantics id="S4.I2.i3.p1.1.m1.1a"><msub id="S4.I2.i3.p1.1.m1.1.1" xref="S4.I2.i3.p1.1.m1.1.1.cmml"><mi id="S4.I2.i3.p1.1.m1.1.1.2" xref="S4.I2.i3.p1.1.m1.1.1.2.cmml">W</mi><mi id="S4.I2.i3.p1.1.m1.1.1.3" xref="S4.I2.i3.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.I2.i3.p1.1.m1.1b"><apply id="S4.I2.i3.p1.1.m1.1.1.cmml" xref="S4.I2.i3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.I2.i3.p1.1.m1.1.1.1.cmml" xref="S4.I2.i3.p1.1.m1.1.1">subscript</csymbol><ci id="S4.I2.i3.p1.1.m1.1.1.2.cmml" xref="S4.I2.i3.p1.1.m1.1.1.2">𝑊</ci><ci id="S4.I2.i3.p1.1.m1.1.1.3.cmml" xref="S4.I2.i3.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i3.p1.1.m1.1c">W_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i3.p1.1.m1.1d">italic_W start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> 파라미터를 갖는 Top-2 라우터를 사용한다. BTX 및 조밀 베이스라인에서 사용되는 것과 동일한 데이터로 데이터 매칭 베이스라인을 트레이닝하는 것 외에도, 트레이닝 전체에 걸쳐 MoE 미세튜닝 데이터 혼합물을 사용하여 동일한 양의 GPU-일, 즉 컴퓨팅-매칭(CM)으로 희소 업사이클링 베이스라인을 트레이닝한다. 이는 당혹스러울 정도로 병렬적인 전문가 훈련을 포함하지 않는 BTX의 특수한 경우에 해당한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i4.p1">
<p class="ltx_p" id="S4.I2.i4.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i4.p1.1.1">Branch-Train-Merge (BTM):</span> This baseline <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib27" title="">2022a</a>)</cite>는 BTX와 동일한 전문가 LLMs(원본 시드 모델 포함)를 사용하지만 MoE 모델을 구축하지 않고 직접 사용한다. 주어진 컨텍스트(입력)에 대해 컨텍스트와 전문가의 훈련 데이터 간의 유사성을 기반으로 Top-k 전문가 LLM을 선택한다. <cite class="ltx_cite ltx_citemacro_citet">Gururangan et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib16" title="">2023</a>)</cite>에서 사용한 효율적인 추론 방법에 이어 문맥과 전문가의 학습 데이터를 모두 tf-idf를 통해 임베딩한다. 각 전문가의 평균 tf-idf 임베딩에 대한 코사인 유사도를 기반으로 Top-k 전문가를 선정한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i5" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i5.p1">
<p class="ltx_p" id="S4.I2.i5.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i5.p1.1.1">CodeLlama 7B:</span> 코드 데이터에 동일한 시드 모델 <span class="ltx_text ltx_font_smallcaps" id="S4.I2.i5.p1.1.2">Llama-2 7B</span>의 지속적인 훈련에 의해 코드 <cite class="ltx_cite ltx_citemacro_citep">(Rozière et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib31" title="">2023</a>)</cite>를 전문으로 하는 언어 모델입니다. 또한 긴 컨텍스트 및 충전과 같은 다른 기능도 있습니다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i6" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I2.i6.p1">
<p class="ltx_p" id="S4.I2.i6.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i6.p1.1.1">Llemma 7B:</span> 수학 데이터에 대한 CodeLlama 7B의 지속적인 훈련에 의한 수학 <cite class="ltx_cite ltx_citemacro_citep">(Azerbayev et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib5" title="">2023</a>)</cite>를 전문으로 하는 언어 모델.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para" id="S4.SS1.SSS2.p3">
<p class="ltx_p" id="S4.SS1.SSS2.p3.2">기준선, 전문가 모델 및 MoE 모델의 훈련에 동일한 최적화 하이퍼파라미터를 사용한다. 무게감쇠가 0.1인 AdamW 최적화기를 사용하여 100단계의 웜업으로 <math alttext="1e-4" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.1.m1.1"><semantics id="S4.SS1.SSS2.p3.1.m1.1a"><mrow id="S4.SS1.SSS2.p3.1.m1.1.1" xref="S4.SS1.SSS2.p3.1.m1.1.1.cmml"><mrow id="S4.SS1.SSS2.p3.1.m1.1.1.2" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.cmml"><mn id="S4.SS1.SSS2.p3.1.m1.1.1.2.2" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.2.cmml">1</mn><mo id="S4.SS1.SSS2.p3.1.m1.1.1.2.1" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.1.cmml">⁢</mo><mi id="S4.SS1.SSS2.p3.1.m1.1.1.2.3" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.3.cmml">e</mi></mrow><mo id="S4.SS1.SSS2.p3.1.m1.1.1.1" xref="S4.SS1.SSS2.p3.1.m1.1.1.1.cmml">−</mo><mn id="S4.SS1.SSS2.p3.1.m1.1.1.3" xref="S4.SS1.SSS2.p3.1.m1.1.1.3.cmml">4</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.1.m1.1b"><apply id="S4.SS1.SSS2.p3.1.m1.1.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1"><minus id="S4.SS1.SSS2.p3.1.m1.1.1.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1.1"></minus><apply id="S4.SS1.SSS2.p3.1.m1.1.1.2.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1.2"><times id="S4.SS1.SSS2.p3.1.m1.1.1.2.1.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.1"></times><cn id="S4.SS1.SSS2.p3.1.m1.1.1.2.2.cmml" type="integer" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.2">1</cn><ci id="S4.SS1.SSS2.p3.1.m1.1.1.2.3.cmml" xref="S4.SS1.SSS2.p3.1.m1.1.1.2.3">𝑒</ci></apply><cn id="S4.SS1.SSS2.p3.1.m1.1.1.3.cmml" type="integer" xref="S4.SS1.SSS2.p3.1.m1.1.1.3">4</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.1.m1.1c">1e-4</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.1.m1.1d">1 italic_e - 4</annotation></semantics></math>의 피크로 학습률을 어닐링하고 코사인 스케줄로 피크의 <math alttext="10\%" class="ltx_Math" display="inline" id="S4.SS1.SSS2.p3.2.m2.1"><semantics id="S4.SS1.SSS2.p3.2.m2.1a"><mrow id="S4.SS1.SSS2.p3.2.m2.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.cmml"><mn id="S4.SS1.SSS2.p3.2.m2.1.1.2" xref="S4.SS1.SSS2.p3.2.m2.1.1.2.cmml">10</mn><mo id="S4.SS1.SSS2.p3.2.m2.1.1.1" xref="S4.SS1.SSS2.p3.2.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSS2.p3.2.m2.1b"><apply id="S4.SS1.SSS2.p3.2.m2.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1"><csymbol cd="latexml" id="S4.SS1.SSS2.p3.2.m2.1.1.1.cmml" xref="S4.SS1.SSS2.p3.2.m2.1.1.1">percent</csymbol><cn id="S4.SS1.SSS2.p3.2.m2.1.1.2.cmml" type="integer" xref="S4.SS1.SSS2.p3.2.m2.1.1.2">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSS2.p3.2.m2.1c">10\%</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSS2.p3.2.m2.1d">10 %</annotation></semantics></math>로 감쇠한다. 우리는 시퀀스 길이가 4096인 4M 토큰의 배치 크기를 사용한다.</p>
</div>
<figure class="ltx_table" id="S4.T2">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T2.2">
<tbody><tr class="ltx_tr" id="S4.T2.2.1">
<td class="ltx_td ltx_border_tt" id="S4.T2.2.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.2.1.2"><span class="ltx_text ltx_font_bold" id="S4.T2.2.1.2.1" style="font-size:90%;">Math</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.2.1.3"><span class="ltx_text ltx_font_bold" id="S4.T2.2.1.3.1" style="font-size:90%;">Code</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.2.1.4"><span class="ltx_text ltx_font_bold" id="S4.T2.2.1.4.1" style="font-size:90%;">Knowledge</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.2.1.5"><span class="ltx_text ltx_font_bold" id="S4.T2.2.1.5.1" style="font-size:90%;">Reasoning</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.2.1.6"><span class="ltx_text ltx_font_bold" id="S4.T2.2.1.6.1" style="font-size:90%;">MMLU</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T2.2.1.7"><span class="ltx_text ltx_font_bold" id="S4.T2.2.1.7.1" style="font-size:90%;">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.2">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T2.2.2.1"><span class="ltx_text ltx_font_italic" id="S4.T2.2.2.1.1" style="font-size:80%;">Specialized LLMs</span></td>
<td class="ltx_td ltx_border_tt" id="S4.T2.2.2.2"></td>
<td class="ltx_td ltx_border_tt" id="S4.T2.2.2.3"></td>
<td class="ltx_td ltx_border_tt" id="S4.T2.2.2.4"></td>
<td class="ltx_td ltx_border_tt" id="S4.T2.2.2.5"></td>
<td class="ltx_td ltx_border_tt" id="S4.T2.2.2.6"></td>
<td class="ltx_td ltx_border_tt" id="S4.T2.2.2.7"></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.3">
<td class="ltx_td ltx_align_left" id="S4.T2.2.3.1"><span class="ltx_text ltx_font_smallcaps" id="S4.T2.2.3.1.1" style="font-size:90%;">CodeLlama 7B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.3.2">
<span class="ltx_text ltx_phantom" id="S4.T2.2.3.2.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T2.2.3.2.2" style="font-size:90%;">8.1</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.3.3"><span class="ltx_text" id="S4.T2.2.3.3.1" style="font-size:90%;">36.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.3.4"><span class="ltx_text" id="S4.T2.2.3.4.1" style="font-size:90%;">22.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.3.5"><span class="ltx_text" id="S4.T2.2.3.5.1" style="font-size:90%;">56.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.3.6"><span class="ltx_text" id="S4.T2.2.3.6.1" style="font-size:90%;">38.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.3.7"><span class="ltx_text" id="S4.T2.2.3.7.1" style="font-size:90%;">37.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.4">
<td class="ltx_td ltx_align_left" id="S4.T2.2.4.1"><span class="ltx_text ltx_font_smallcaps" id="S4.T2.2.4.1.1" style="font-size:90%;">Llemma 7B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.4.2"><span class="ltx_text" id="S4.T2.2.4.2.1" style="font-size:90%;">28.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.4.3"><span class="ltx_text" id="S4.T2.2.4.3.1" style="font-size:90%;">33.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.4.4"><span class="ltx_text" id="S4.T2.2.4.4.1" style="font-size:90%;">17.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.4.5"><span class="ltx_text" id="S4.T2.2.4.5.1" style="font-size:90%;">38.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.4.6"><span class="ltx_text" id="S4.T2.2.4.6.1" style="font-size:90%;">33.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.4.7"><span class="ltx_text" id="S4.T2.2.4.7.1" style="font-size:90%;">32.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.5">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T2.2.5.1"><span class="ltx_text ltx_font_italic" id="S4.T2.2.5.1.1" style="font-size:80%;">Generalist LLMs</span></td>
<td class="ltx_td ltx_border_t" id="S4.T2.2.5.2"></td>
<td class="ltx_td ltx_border_t" id="S4.T2.2.5.3"></td>
<td class="ltx_td ltx_border_t" id="S4.T2.2.5.4"></td>
<td class="ltx_td ltx_border_t" id="S4.T2.2.5.5"></td>
<td class="ltx_td ltx_border_t" id="S4.T2.2.5.6"></td>
<td class="ltx_td ltx_border_t" id="S4.T2.2.5.7"></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.6">
<td class="ltx_td ltx_align_left" id="S4.T2.2.6.1"><span class="ltx_text ltx_font_smallcaps" id="S4.T2.2.6.1.1" style="font-size:90%;">Llama-2 7B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.6.2">
<span class="ltx_text ltx_phantom" id="S4.T2.2.6.2.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T2.2.6.2.2" style="font-size:90%;">8.6</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.6.3"><span class="ltx_text" id="S4.T2.2.6.3.1" style="font-size:90%;">16.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.6.4"><span class="ltx_text" id="S4.T2.2.6.4.1" style="font-size:90%;">37.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.6.5"><span class="ltx_text" id="S4.T2.2.6.5.1" style="font-size:90%;">63.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.6.6"><span class="ltx_text" id="S4.T2.2.6.6.1" style="font-size:90%;">46.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.6.7"><span class="ltx_text" id="S4.T2.2.6.7.1" style="font-size:90%;">40.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.7">
<td class="ltx_td ltx_align_left" id="S4.T2.2.7.1"><span class="ltx_text ltx_font_smallcaps" id="S4.T2.2.7.1.1" style="font-size:90%;">Llama-2 13B</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.7.2"><span class="ltx_text" id="S4.T2.2.7.2.1" style="font-size:90%;">16.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.7.3"><span class="ltx_text" id="S4.T2.2.7.3.1" style="font-size:90%;">24.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.7.4"><span class="ltx_text" id="S4.T2.2.7.4.1" style="font-size:90%;">40.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.7.5"><span class="ltx_text ltx_font_bold" id="S4.T2.2.7.5.1" style="font-size:90%;">66.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.7.6"><span class="ltx_text" id="S4.T2.2.7.6.1" style="font-size:90%;">52.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.7.7"><span class="ltx_text" id="S4.T2.2.7.7.1" style="font-size:90%;">45.4</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.8">
<td class="ltx_td ltx_align_left" id="S4.T2.2.8.1"><span class="ltx_text" id="S4.T2.2.8.1.1" style="font-size:90%;">Dense (DM)</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.8.2"><span class="ltx_text" id="S4.T2.2.8.2.1" style="font-size:90%;">18.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.8.3"><span class="ltx_text" id="S4.T2.2.8.3.1" style="font-size:90%;">25.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.8.4"><span class="ltx_text" id="S4.T2.2.8.4.1" style="font-size:90%;">39.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.8.5"><span class="ltx_text" id="S4.T2.2.8.5.1" style="font-size:90%;">63.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.8.6"><span class="ltx_text" id="S4.T2.2.8.6.1" style="font-size:90%;">49.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.8.7"><span class="ltx_text" id="S4.T2.2.8.7.1" style="font-size:90%;">44.5</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.9">
<td class="ltx_td ltx_align_left" id="S4.T2.2.9.1"><span class="ltx_text" id="S4.T2.2.9.1.1" style="font-size:90%;">Sparse upcycling (DM), Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.9.2"><span class="ltx_text ltx_font_bold" id="S4.T2.2.9.2.1" style="font-size:90%;">28.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.9.3"><span class="ltx_text" id="S4.T2.2.9.3.1" style="font-size:90%;">34.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.9.4"><span class="ltx_text" id="S4.T2.2.9.4.1" style="font-size:90%;">34.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.9.5"><span class="ltx_text" id="S4.T2.2.9.5.1" style="font-size:90%;">62.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.9.6"><span class="ltx_text" id="S4.T2.2.9.6.1" style="font-size:90%;">51.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.9.7"><span class="ltx_text" id="S4.T2.2.9.7.1" style="font-size:90%;">46.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.10">
<td class="ltx_td ltx_align_left" id="S4.T2.2.10.1"><span class="ltx_text" id="S4.T2.2.10.1.1" style="font-size:90%;">BTM, Top-1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.10.2"><span class="ltx_text" id="S4.T2.2.10.2.1" style="font-size:90%;">21.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.10.3"><span class="ltx_text" id="S4.T2.2.10.3.1" style="font-size:90%;">36.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.10.4"><span class="ltx_text" id="S4.T2.2.10.4.1" style="font-size:90%;">26.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.10.5"><span class="ltx_text" id="S4.T2.2.10.5.1" style="font-size:90%;">61.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.10.6"><span class="ltx_text" id="S4.T2.2.10.6.1" style="font-size:90%;">44.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.10.7"><span class="ltx_text" id="S4.T2.2.10.7.1" style="font-size:90%;">43.1</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.11">
<td class="ltx_td ltx_align_left" id="S4.T2.2.11.1"><span class="ltx_text" id="S4.T2.2.11.1.1" style="font-size:90%;">
BTM, Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.11.2"><span class="ltx_text" id="S4.T2.2.11.2.1" style="font-size:90%;">21.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.11.3"><span class="ltx_text ltx_font_bold" id="S4.T2.2.11.3.1" style="font-size:90%;">36.6</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.11.4"><span class="ltx_text" id="S4.T2.2.11.4.1" style="font-size:90%;">26.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.11.5"><span class="ltx_text" id="S4.T2.2.11.5.1" style="font-size:90%;">61.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.11.6"><span class="ltx_text" id="S4.T2.2.11.6.1" style="font-size:90%;">44.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.11.7"><span class="ltx_text" id="S4.T2.2.11.7.1" style="font-size:90%;">43.4</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.12">
<td class="ltx_td ltx_align_left" id="S4.T2.2.12.1"><span class="ltx_text" id="S4.T2.2.12.1.1" style="font-size:90%;">BTX, Sample Top-1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.12.2"><span class="ltx_text" id="S4.T2.2.12.2.1" style="font-size:90%;">26.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.12.3"><span class="ltx_text" id="S4.T2.2.12.3.1" style="font-size:90%;">31.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.12.4"><span class="ltx_text" id="S4.T2.2.12.4.1" style="font-size:90%;">40.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.12.5"><span class="ltx_text" id="S4.T2.2.12.5.1" style="font-size:90%;">63.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.12.6"><span class="ltx_text ltx_font_bold" id="S4.T2.2.12.6.1" style="font-size:90%;">53.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T2.2.12.7"><span class="ltx_text" id="S4.T2.2.12.7.1" style="font-size:90%;">47.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T2.2.13">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T2.2.13.1"><span class="ltx_text" id="S4.T2.2.13.1.1" style="font-size:90%;">BTX, Top-2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.2.13.2"><span class="ltx_text" id="S4.T2.2.13.2.1" style="font-size:90%;">27.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.2.13.3"><span class="ltx_text" id="S4.T2.2.13.3.1" style="font-size:90%;">34.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.2.13.4"><span class="ltx_text ltx_font_bold" id="S4.T2.2.13.4.1" style="font-size:90%;">41.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.2.13.5"><span class="ltx_text" id="S4.T2.2.13.5.1" style="font-size:90%;">63.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.2.13.6"><span class="ltx_text" id="S4.T2.2.13.6.1" style="font-size:90%;">52.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T2.2.13.7"><span class="ltx_text ltx_font_bold" id="S4.T2.2.13.7.1" style="font-size:90%;">47.9</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">표 2: </span>일반 및 특수 사전 트레이닝 모델 모두를 포함하는 다양한 기준선에 대해 비교된 BTX의 집계된 성능은 인기 있는 벤치마크에 걸쳐 집계된 다양한 능력에 대해 테스트되었다. 치밀하고 희박한 업사이클링, BTM 및 BTX는 BTM이 미세 조정 단계를 갖지 않는 것을 제외하고는 정확히 동일한 양과 데이터의 혼합물에 대해 훈련된다.</figcaption>
</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSS3">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.1.3 </span>Evaluation</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS1.SSS3.p1">
<p class="ltx_p" id="S4.SS1.SSS3.p1.1">평가를 위해 서로 다른 기술을 테스트하는 여러 벤치마크에서 제로 샷 및 소수 샷 성능을 사용합니다.</p>
<ul class="ltx_itemize" id="S4.I3">
<li class="ltx_item" id="S4.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I3.i1.p1">
<p class="ltx_p" id="S4.I3.i1.p1.1">수학: 수학 추론을 위해 GSM8K(8 shot) <cite class="ltx_cite ltx_citemacro_citep">(Cobbe et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib10" title="">2021</a>)</cite>와 MATH(4 shot) <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib18" title="">2021b</a>)</cite>에 대한 평균 성능을 보고한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I3.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I3.i2.p1">
<p class="ltx_p" id="S4.I3.i2.p1.1">코드: 코드 생성을 위한 HumanEval(0 shot) <cite class="ltx_cite ltx_citemacro_citep">(Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib8" title="">2021</a>)</cite>와 MBPP(3 shot) <cite class="ltx_cite ltx_citemacro_citep">(Austin et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib3" title="">2021</a>)</cite>의 평균 성능을 보고한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I3.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I3.i3.p1">
<p class="ltx_p" id="S4.I3.i3.p1.1">세계 지식: 우리는 Natural Questions (5 shot) <cite class="ltx_cite ltx_citemacro_citep">(Kwiatkowski et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib24" title="">2019</a>)</cite>와 TriviaQA (5 shot) <cite class="ltx_cite ltx_citemacro_citep">(Joshi et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib22" title="">2017</a>)</cite>의 평균 성능을 보고한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I3.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I3.i4.p1">
<p class="ltx_p" id="S4.I3.i4.p1.1">추론: ARC-Easy 및 ARC-Challenge <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib9" title="">2018</a>)</cite>, SIQA <cite class="ltx_cite ltx_citemacro_citep">(Sap et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib34" title="">2019</a>)</cite>, PIQA <cite class="ltx_cite ltx_citemacro_citep">(Bisk et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib6" title="">2020</a>)</cite> 및 WinoGrande <cite class="ltx_cite ltx_citemacro_citep">(Sakaguchi et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib33" title="">2021</a>)</cite>의 평균 0-shot 성능을 보고한다.</p>
</div>
</li>
<li class="ltx_item" id="S4.I3.i5" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I3.i5.p1">
<p class="ltx_p" id="S4.I3.i5.p1.1">General: 우리는 다중 도메인을 다루는 MMLU (5 shot) <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib17" title="">2021a</a>)</cite>에 대한 성능을 보고한다.</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_figure" id="S4.F2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_landscape" height="373" id="S4.F2.g1" src="https://arxiv.org/html/2403.07816v1/x2.png" width="491"></div>
<div class="ltx_flex_cell ltx_flex_size_2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_2 ltx_img_square" height="342" id="S4.F2.g2" src="https://arxiv.org/html/2403.07816v1/x3.png" width="327"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F2.2.1.1" style="font-size:90%;">Figure 2</span>: </span><span class="ltx_text" id="S4.F2.3.2" style="font-size:90%;">
<span class="ltx_text ltx_font_bold" id="S4.F2.3.2.1">Left:</span> The average performance vs training budget of BTX compared to various baselines, with different active parameters at inference time indicated by circle size. All the models except <span class="ltx_text ltx_font_smallcaps" id="S4.F2.3.2.2">Llama-2</span> 13B are trained starting from <span class="ltx_text ltx_font_smallcaps" id="S4.F2.3.2.3">Llama-2</span> 7B using the datasets described in <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS1.SSS1" title="4.1.1 BTX Training ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Section</span>&nbsp;<span class="ltx_text ltx_ref_tag">4.1.1</span></a>. The X-axis shows the total training compute starting from the seed model measured in GPU days<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note"><span class="ltx_text" id="footnote1.1.1.1" style="font-size:111%;">1</span></span>The GPU days of Llama-2 13B is an approximate measurement, calculated by doubling the training compute of a 7B model trained with the same amount of pretraining data (according to <cite class="ltx_cite ltx_citemacro_citet">Touvron et&nbsp;al. <span class="ltx_text" id="footnote1.9.1.1.1" style="font-size:111%;">(</span><a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib37" title="">2023</a><span class="ltx_text" id="footnote1.10.2.2.1" style="font-size:111%;">)</span></cite> Table 2). Since Llama-2 13B is not trained from the seed model, we simply report their difference in GPU days.
</span></span></span>, and the Y-axis is the average score over all the tasks (as computed in <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T2" title="Table 2 ‣ 4.1.2 Baselines ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table&nbsp;2</span></a>). The BTX models outperform the baselines that started from the same seed model, as well as <span class="ltx_text ltx_font_smallcaps" id="S4.F2.3.2.4">Llama-2 13B</span>.
<span class="ltx_text ltx_font_bold" id="S4.F2.3.2.5">Right:</span> The normalized performance over different domains where the scores are divided by the highest one. We see large improvements for BTX in code (which matches the specialized model) and math tasks compared to the seed model <span class="ltx_text ltx_font_smallcaps" id="S4.F2.3.2.6">Llama-2 7B</span>, even outperforming the <span class="ltx_text ltx_font_smallcaps" id="S4.F2.3.2.7">Llama-2 13B</span> model.
</span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Main Results</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_subsubsection" id="S4.SS2.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.1 </span>Overall Performance</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_paragraph" id="S4.SS2.SSS1.Px1">
<h5 class="ltx_title ltx_title_paragraph">Domain experts excel at their respective tasks.</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS2.SSS1.Px1.p1">
<p class="ltx_p" id="S4.SS2.SSS1.Px1.p1.1">먼저 전문가 LLM이 특정 도메인에 전문화하는 방법을 분석한다. 결과는 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T1" title="Table 1 ‣ 4.1.1 BTX Training ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 1</span></a>로 요약된다. 예상대로 개별 전문가 LLM은 수학 및 코드 도메인이 특히 큰 개선을 보이는 각 도메인에서 최상의 성능을 달성한다. 게다가, 몇 가지 흥미로운 관찰이 있다. 수학 전문가 훈련이 코드 성능도 향상되어 이러한 영역의 밀접한 관계가 있음을 알 수 있다. 그러나 이러한 단일 도메인 연속 훈련은 다른 도메인의 일부 작업에서 상당한 성능 저하와 함께 치명적인 망각으로 어려움을 겪는다. 예를 들어, 수학 및 코드 전문가는 시드 모델보다 트리비아QA에서 훨씬 더 나쁘다.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS2.SSS1.Px2">
<h5 class="ltx_title ltx_title_paragraph">BTX improves all tasks where experts specialize.</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS2.SSS1.Px2.p1">
<p class="ltx_p" id="S4.SS2.SSS1.Px2.p1.1"><a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T2" title="Table 2 ‣ 4.1.2 Baselines ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 2</span></a> 및 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#footnote1" title="footnote 1 ‣ Figure 2 ‣ 4.1.3 Evaluation ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag"><span class="ltx_text" style="font-size:111%;">footnote 1</span></span></a>(오른쪽)는 여러 도메인에 걸쳐 집계된 성능을 보여줍니다. 더 자세한 작업별 결과는 부록의 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S9.T8" title="Table 8 ‣ 9 Evaluation ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 8</span></a>에 보고되어 있다. 시드 모델 <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS1.Px2.p1.1.1">Llama-2 7B</span>과 비교하여 BTX 모델(서로 다른 수의 활성 매개변수에 해당하는 샘플 Top-1 및 Top-2 모두)은 수학, 코딩 및 세계 지식과 같은 모든 전문가 도메인에서 커먼센스 추론과 같은 다른 작업에서 회귀하지 않고 개선된다. Top-2 전문가(기본값)를 가진 BTX는 또한 수학 및 코딩 도메인에서 특수 모델 <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS1.Px2.p1.1.2">Llemma 7B</span> 및 <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS1.Px2.p1.1.3">CodeLlama 7B</span>의 최상의 성능에 접근하면서 세계 지식 및 상식 추론과 같은 특수성이 아닌 도메인에서 이러한 모델을 크게 개선한다. 조밀하고 희박한 업사이클링과 같은 지속적인 사전 훈련을 위한 대체 데이터 매칭(DM) 방법에 비해 BTX는 수학 및 코딩 도메인에서 작은 갭으로 평균적으로 더 나은 성능을 달성한다. BTX는 평균적으로 BTM보다 큰 마진만큼 우수한 성능을 보이며, 이는 토큰 레벨 라우팅을 학습하기 위한 MoE 미세 조정이 유익하다는 것을 나타낸다. 전반적으로, 결과는 BTX가 다중 태스크 학습으로부터 태스크 간섭에 강건한 연속 프리트레이닝을 위한 보다 계산 효율적인 방법임을 입증한다. BTX는 또한 추론을 제외한 모든 태스크에서 <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS1.Px2.p1.1.4">Llama-2 13B</span>보다 성능이 우수하지만, <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS1.Px2.p1.1.5">Llama-2 13B</span>은 훨씬 더 많은 트레이닝 컴퓨팅을 사용하고 약간 더 많은 활성 파라미터를 갖는다.</p>
</div>
<figure class="ltx_table" id="S4.T3">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T3.2">
<tbody><tr class="ltx_tr" id="S4.T3.2.1">
<td class="ltx_td ltx_border_tt" id="S4.T3.2.1.1" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.2" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.2.1" style="font-size:80%;">MoE</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.3" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.3.1" style="font-size:80%;">Training</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.4" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.4.1" style="font-size:80%;">Total compute</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_tt" id="S4.T3.2.1.5" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.5.1" style="font-size:80%;">#tokens</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.6" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.6.1" style="font-size:80%;">Math</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.7" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.7.1" style="font-size:80%;">Code</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.8" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.8.1" style="font-size:80%;">Knowledge</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.9" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.9.1" style="font-size:80%;">Reasoning</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.10" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.10.1" style="font-size:80%;">MMLU</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T3.2.1.11" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.1.11.1" style="font-size:80%;">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.2.2">
<td class="ltx_td" id="S4.T3.2.2.1" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.2" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.2.2.1" style="font-size:80%;">compute</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.3" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.2.3.1" style="font-size:80%;">time (days)</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.2.2.4" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.2.4.1" style="font-size:80%;">(GPU-days)</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S4.T3.2.2.5" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.2.5.1" style="font-size:80%;">(B)</span></td>
<td class="ltx_td" id="S4.T3.2.2.6" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td" id="S4.T3.2.2.7" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td" id="S4.T3.2.2.8" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td" id="S4.T3.2.2.9" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td" id="S4.T3.2.2.10" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
<td class="ltx_td" id="S4.T3.2.2.11" style="padding-left:2.0pt;padding-right:2.0pt;"></td>
</tr>
<tr class="ltx_tr" id="S4.T3.2.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T3.2.3.1" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.1.1" style="font-size:80%;">BTX</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.2" style="padding-left:2.0pt;padding-right:2.0pt;">
<span class="ltx_text ltx_phantom" id="S4.T3.2.3.2.1" style="font-size:80%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T3.2.3.2.2" style="font-size:80%;">23%</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.3" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.3.1" style="font-size:80%;">7.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.4" style="padding-left:2.0pt;padding-right:2.0pt;">
<span class="ltx_text ltx_phantom" id="S4.T3.2.3.4.1" style="font-size:80%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T3.2.3.4.2" style="font-size:80%;">926.1</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T3.2.3.5" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.5.1" style="font-size:80%;">533</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.6" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.6.1" style="font-size:80%;">27.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.7" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.7.1" style="font-size:80%;">34.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.8" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.8.1" style="font-size:80%;">41.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.9" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.9.1" style="font-size:80%;">63.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.10" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.10.1" style="font-size:80%;">52.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.2.3.11" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.3.11.1" style="font-size:80%;">47.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.2.4">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T3.2.4.1" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.1.1" style="font-size:80%;">Sparse upcycling (CM)</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.2" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.2.1" style="font-size:80%;">100%</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.3" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.3.1" style="font-size:80%;">7.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.4" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.4.1" style="font-size:80%;">1007.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_r" id="S4.T3.2.4.5" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.5.1" style="font-size:80%;">252</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.6" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.6.1" style="font-size:80%;">28.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.7" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.7.1" style="font-size:80%;">30.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.8" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.8.1" style="font-size:80%;">41.3</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.9" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.9.1" style="font-size:80%;">62.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.10" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.10.1" style="font-size:80%;">52.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.2.4.11" style="padding-left:2.0pt;padding-right:2.0pt;"><span class="ltx_text" id="S4.T3.2.4.11.1" style="font-size:80%;">47.3</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption ltx_centering" style="font-size:80%;"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S4.T3.5.1.1" style="font-size:113%;">Table 3</span>:</span><span class="ltx_text" id="S4.T3.6.2" style="font-size:113%;">Comparison between BTX and Sparse upcycling with compute-matching (CM) is a special case of BTX without the expert training stage is shown as 100% of compute is spent on MoE training. 또한 총 훈련 시간, 계산 및 훈련 토큰 수를 보고합니다. 평균뿐만 아니라 개별 도메인에 대한 두 성능을 비교하면 BTX가 더 높은 처리량 외에도 더 균형 잡힌 성능을 가짐을 알 수 있다. </span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS2.SSS1.Px2.p2">
<p class="ltx_p" id="S4.SS2.SSS1.Px2.p2.1">우리는 컴퓨트 매칭(compute-matching, CM) 시나리오에서 BTX를 희소 업사이클링 베이스라인과 추가로 비교한다. 두 가지 모두 MoE 단계 동안 동일한 데이터 혼합물에서 훈련하지만 MoE 훈련에 사용된 컴퓨팅의 백분율 측면에서 다르다. 희박 사이클링이 BTX 뒤에 가깝게 수행되는 동안, 전문가의 병렬 트레이닝은 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T3" title="Table 3 ‣ BTX improves all tasks where experts specialize. ‣ 4.2.1 Overall Performance ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 3</span></a>에 도시된 바와 같이 BTX의 트레이닝 처리량을 증가시킨다. 결과적으로 BTX는 동일한 훈련 컴퓨팅 예산이 주어진 순수한 MoE보다 <math alttext="2\times" class="ltx_math_unparsed" display="inline" id="S4.SS2.SSS1.Px2.p2.1.m1.1"><semantics id="S4.SS2.SSS1.Px2.p2.1.m1.1a"><mrow id="S4.SS2.SSS1.Px2.p2.1.m1.1b"><mn id="S4.SS2.SSS1.Px2.p2.1.m1.1.1">2</mn><mo id="S4.SS2.SSS1.Px2.p2.1.m1.1.2" lspace="0.222em">×</mo></mrow><annotation encoding="application/x-tex" id="S4.SS2.SSS1.Px2.p2.1.m1.1c">2\times</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.SSS1.Px2.p2.1.m1.1d">2 ×</annotation></semantics></math> 이상의 데이터로 훈련할 수 있으며 모든 도메인에서 약간 더 높은 평균 성능을 달성한다.</p>
</div>
<figure class="ltx_table" id="S4.T4">
<table class="ltx_tabular ltx_align_middle" id="S4.T4.2">
<tbody><tr class="ltx_tr" id="S4.T4.2.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T4.2.1.1" rowspan="2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.1.1.1" style="font-size:90%;">Routing method</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T4.2.1.2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.1.2.1" style="font-size:90%;">Active parameters (B)</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.2.1.3" rowspan="2"><span class="ltx_text ltx_font_bold ltx_align_center" id="S4.T4.2.1.3.1" style="font-size:90%;">MoE Finetune tokens (B)</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.2.1.4" rowspan="2"><span class="ltx_text ltx_font_bold ltx_align_center" id="S4.T4.2.1.4.1" style="font-size:90%;">Average score</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.2">
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.2.1"><span class="ltx_text ltx_font_bold" id="S4.T4.2.2.1.1" style="font-size:90%;">Training</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.2.2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.2.2.1" style="font-size:90%;">Inference</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.3">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T4.2.3.1"><span class="ltx_text" id="S4.T4.2.3.1.1" style="font-size:90%;">Switch Top-1</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.2.3.2">
<span class="ltx_text ltx_phantom" id="S4.T4.2.3.2.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.3.2.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.2.3.3">
<span class="ltx_text ltx_phantom" id="S4.T4.2.3.3.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.3.3.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.2.3.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.3.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.3.4.2" style="font-size:90%;">10</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T4.2.3.5"><span class="ltx_text" id="S4.T4.2.3.5.1" style="font-size:90%;">24.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.4">
<td class="ltx_td ltx_align_left" id="S4.T4.2.4.1"><span class="ltx_text" id="S4.T4.2.4.1.1" style="font-size:90%;">Sample Top-1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.4.2">
<span class="ltx_text ltx_phantom" id="S4.T4.2.4.2.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.4.2.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.4.3">
<span class="ltx_text ltx_phantom" id="S4.T4.2.4.3.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.4.3.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.4.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.4.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.4.4.2" style="font-size:90%;">10</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.4.5"><span class="ltx_text" id="S4.T4.2.4.5.1" style="font-size:90%;">33.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.5">
<td class="ltx_td ltx_align_left" id="S4.T4.2.5.1"><span class="ltx_text" id="S4.T4.2.5.1.1" style="font-size:90%;">Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.2"><span class="ltx_text" id="S4.T4.2.5.2.1" style="font-size:90%;">11.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.3"><span class="ltx_text" id="S4.T4.2.5.3.1" style="font-size:90%;">11.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.5.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.5.4.2" style="font-size:90%;">10</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5"><span class="ltx_text" id="S4.T4.2.5.5.1" style="font-size:90%;">34.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.6">
<td class="ltx_td ltx_align_left" id="S4.T4.2.6.1"><span class="ltx_text" id="S4.T4.2.6.1.1" style="font-size:90%;">Soft routing</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.6.2"><span class="ltx_text" id="S4.T4.2.6.2.1" style="font-size:90%;">19.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.6.3"><span class="ltx_text" id="S4.T4.2.6.3.1" style="font-size:90%;">19.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.6.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.6.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.6.4.2" style="font-size:90%;">10</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.6.5"><span class="ltx_text" id="S4.T4.2.6.5.1" style="font-size:90%;">35.8</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.7">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.2.7.1"><span class="ltx_text" id="S4.T4.2.7.1.1" style="font-size:90%;">Sample Top-1</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.7.2">
<span class="ltx_text ltx_phantom" id="S4.T4.2.7.2.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.7.2.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.7.3">
<span class="ltx_text ltx_phantom" id="S4.T4.2.7.3.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.7.3.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.7.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.7.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.7.4.2" style="font-size:90%;">40</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.7.5"><span class="ltx_text" id="S4.T4.2.7.5.1" style="font-size:90%;">35.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.8">
<td class="ltx_td ltx_align_left" id="S4.T4.2.8.1"><span class="ltx_text" id="S4.T4.2.8.1.1" style="font-size:90%;">Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.8.2"><span class="ltx_text" id="S4.T4.2.8.2.1" style="font-size:90%;">11.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.8.3"><span class="ltx_text" id="S4.T4.2.8.3.1" style="font-size:90%;">11.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.8.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.8.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.8.4.2" style="font-size:90%;">40</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.8.5"><span class="ltx_text" id="S4.T4.2.8.5.1" style="font-size:90%;">35.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.9">
<td class="ltx_td ltx_align_left" id="S4.T4.2.9.1"><span class="ltx_text" id="S4.T4.2.9.1.1" style="font-size:90%;">Soft routing</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.2"><span class="ltx_text" id="S4.T4.2.9.2.1" style="font-size:90%;">19.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.3"><span class="ltx_text" id="S4.T4.2.9.3.1" style="font-size:90%;">19.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.9.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.9.4.2" style="font-size:90%;">40</span>
</td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.5"><span class="ltx_text" id="S4.T4.2.9.5.1" style="font-size:90%;">37.3</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.10">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T4.2.10.1"><span class="ltx_text" id="S4.T4.2.10.1.1" style="font-size:90%;">Sample Top-1</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.2">
<span class="ltx_text ltx_phantom" id="S4.T4.2.10.2.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.10.2.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.3">
<span class="ltx_text ltx_phantom" id="S4.T4.2.10.3.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.10.3.2" style="font-size:90%;">6.7</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.4"><span class="ltx_text" id="S4.T4.2.10.4.1" style="font-size:90%;">160</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.5"><span class="ltx_text" id="S4.T4.2.10.5.1" style="font-size:90%;">36.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.11">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T4.2.11.1"><span class="ltx_text" id="S4.T4.2.11.1.1" style="font-size:90%;">Top-2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.2"><span class="ltx_text" id="S4.T4.2.11.2.1" style="font-size:90%;">11.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.3"><span class="ltx_text" id="S4.T4.2.11.3.1" style="font-size:90%;">11.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.4">
<span class="ltx_text ltx_phantom" id="S4.T4.2.11.4.1" style="font-size:90%;"><span style="visibility:hidden">0</span></span><span class="ltx_text" id="S4.T4.2.11.4.2" style="font-size:90%;">80</span>
</td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.5"><span class="ltx_text" id="S4.T4.2.11.5.1" style="font-size:90%;">37.3</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">표 4:</span>Ablations on different routing methods during BTX training. 평균 점수는 GSM8K, HumanEval, Natural Questions, ARC Challenge 및 MMLU를 포함한 대표적인 작업에 대한 성능을 기반으로 한다.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_table" id="S4.T5">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S4.T5.2">
<tbody><tr class="ltx_tr" id="S4.T5.2.1">
<td class="ltx_td ltx_border_tt" id="S4.T5.2.1.1"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.1.2"><span class="ltx_text ltx_font_bold" id="S4.T5.2.1.2.1" style="font-size:90%;">GSM8K</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.1.3"><span class="ltx_text ltx_font_bold" id="S4.T5.2.1.3.1" style="font-size:90%;">Human</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.1.4"><span class="ltx_text ltx_font_bold" id="S4.T5.2.1.4.1" style="font-size:90%;">Natural</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.1.5"><span class="ltx_text ltx_font_bold" id="S4.T5.2.1.5.1" style="font-size:90%;">ARC</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.1.6"><span class="ltx_text ltx_font_bold" id="S4.T5.2.1.6.1" style="font-size:90%;">MMLU</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.1.7"><span class="ltx_text ltx_font_bold" id="S4.T5.2.1.7.1" style="font-size:90%;">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.2">
<td class="ltx_td" id="S4.T5.2.2.1"></td>
<td class="ltx_td" id="S4.T5.2.2.2"></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.2.3"><span class="ltx_text ltx_font_bold" id="S4.T5.2.2.3.1" style="font-size:90%;">Eval</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.2.4"><span class="ltx_text ltx_font_bold" id="S4.T5.2.2.4.1" style="font-size:90%;">Questions</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.2.5"><span class="ltx_text ltx_font_bold" id="S4.T5.2.2.5.1" style="font-size:90%;">Challenge</span></td>
<td class="ltx_td" id="S4.T5.2.2.6"></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.2.7"><span class="ltx_text ltx_font_bold" id="S4.T5.2.2.7.1" style="font-size:90%;">Score</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.3">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T5.2.3.1"><span class="ltx_text" id="S4.T5.2.3.1.1" style="font-size:90%;">BTX</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.3.2"><span class="ltx_text" id="S4.T5.2.3.2.1" style="font-size:90%;">29.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.3.3"><span class="ltx_text" id="S4.T5.2.3.3.1" style="font-size:90%;">27.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.3.4"><span class="ltx_text" id="S4.T5.2.3.4.1" style="font-size:90%;">23.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.3.5"><span class="ltx_text" id="S4.T5.2.3.5.1" style="font-size:90%;">43.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.3.6"><span class="ltx_text" id="S4.T5.2.3.6.1" style="font-size:90%;">50.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S4.T5.2.3.7"><span class="ltx_text" id="S4.T5.2.3.7.1" style="font-size:90%;">34.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T5.2.4.1"><span class="ltx_text" id="S4.T5.2.4.1.1" style="font-size:90%;">no load-balancing (LB)</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.2.4.2"><span class="ltx_text" id="S4.T5.2.4.2.1" style="font-size:90%;">34.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.2.4.3"><span class="ltx_text" id="S4.T5.2.4.3.1" style="font-size:90%;">19.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.2.4.4"><span class="ltx_text" id="S4.T5.2.4.4.1" style="font-size:90%;">23.2</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.2.4.5"><span class="ltx_text" id="S4.T5.2.4.5.1" style="font-size:90%;">44.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.2.4.6"><span class="ltx_text" id="S4.T5.2.4.6.1" style="font-size:90%;">51.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.2.4.7"><span class="ltx_text" id="S4.T5.2.4.7.1" style="font-size:90%;">34.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.5">
<td class="ltx_td ltx_align_left" id="S4.T5.2.5.1"><span class="ltx_text" id="S4.T5.2.5.1.1" style="font-size:90%;">no LB &amp; freeze experts</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.5.2"><span class="ltx_text" id="S4.T5.2.5.2.1" style="font-size:90%;">34.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.5.3"><span class="ltx_text" id="S4.T5.2.5.3.1" style="font-size:90%;">18.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.5.4"><span class="ltx_text" id="S4.T5.2.5.4.1" style="font-size:90%;">24.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.5.5"><span class="ltx_text" id="S4.T5.2.5.5.1" style="font-size:90%;">44.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.5.6"><span class="ltx_text" id="S4.T5.2.5.6.1" style="font-size:90%;">51.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.5.7"><span class="ltx_text" id="S4.T5.2.5.7.1" style="font-size:90%;">34.7</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.6">
<td class="ltx_td ltx_align_left" id="S4.T5.2.6.1"><span class="ltx_text" id="S4.T5.2.6.1.1" style="font-size:90%;">blending experts</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.6.2"><span class="ltx_text" id="S4.T5.2.6.2.1" style="font-size:90%;">13.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.6.3"><span class="ltx_text" id="S4.T5.2.6.3.1" style="font-size:90%;">17.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.6.4"><span class="ltx_text" id="S4.T5.2.6.4.1" style="font-size:90%;">9.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.6.5"><span class="ltx_text" id="S4.T5.2.6.5.1" style="font-size:90%;">34.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.6.6"><span class="ltx_text" id="S4.T5.2.6.6.1" style="font-size:90%;">36.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.6.7"><span class="ltx_text" id="S4.T5.2.6.7.1" style="font-size:90%;">22.2</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.7">
<td class="ltx_td ltx_align_left" id="S4.T5.2.7.1"><span class="ltx_text" id="S4.T5.2.7.1.1" style="font-size:90%;">split experts, top-2 of 8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.7.2"><span class="ltx_text" id="S4.T5.2.7.2.1" style="font-size:90%;">22.0</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.7.3"><span class="ltx_text" id="S4.T5.2.7.3.1" style="font-size:90%;">20.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.7.4"><span class="ltx_text" id="S4.T5.2.7.4.1" style="font-size:90%;">16.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.7.5"><span class="ltx_text" id="S4.T5.2.7.5.1" style="font-size:90%;">39.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.7.6"><span class="ltx_text" id="S4.T5.2.7.6.1" style="font-size:90%;">41.8</span></td>
<td class="ltx_td ltx_align_center" id="S4.T5.2.7.7"><span class="ltx_text" id="S4.T5.2.7.7.1" style="font-size:90%;">28.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.2.8">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S4.T5.2.8.1"><span class="ltx_text" id="S4.T5.2.8.1.1" style="font-size:90%;">split experts, top-4 of 8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.2.8.2"><span class="ltx_text" id="S4.T5.2.8.2.1" style="font-size:90%;">29.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.2.8.3"><span class="ltx_text" id="S4.T5.2.8.3.1" style="font-size:90%;">26.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.2.8.4"><span class="ltx_text" id="S4.T5.2.8.4.1" style="font-size:90%;">22.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.2.8.5"><span class="ltx_text" id="S4.T5.2.8.5.1" style="font-size:90%;">44.0</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.2.8.6"><span class="ltx_text" id="S4.T5.2.8.6.1" style="font-size:90%;">49.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.2.8.7"><span class="ltx_text" id="S4.T5.2.8.7.1" style="font-size:90%;">34.5</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">표 5:</span>Ablations on different BTX training strategies. 모든 변형은 동일한 전문가로부터 초기화되고 MoE 미세조정 동안 총 10B 토큰에 대해 훈련된다.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
</section>
<section class="ltx_subsubsection" id="S4.SS2.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.2.2 </span>Better compute-performance tradeoff</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS2.SSS2.p1">
<p class="ltx_p" id="S4.SS2.SSS2.p1.1"><a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#footnote1" title="footnote 1 ‣ Figure 2 ‣ 4.1.3 Evaluation ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag"><span class="ltx_text" style="font-size:111%;">footnote 1</span></span></a> (left)의 계산 효율 측면에서 BTX를 기준선과 비교한다. X-축은 GPU 일 단위로 측정된 시드 모델에서 시작하여 MoE 모델의 도메인 전문가 훈련 및 미세 조정을 포함하는 총 훈련 계산을 보여준다. Y축은 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T2" title="Table 2 ‣ 4.1.2 Baselines ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 2</span></a>에서 보고된 전체 성능을 측정한다.</p>
</div>
<section class="ltx_paragraph" id="S4.SS2.SSS2.Px1">
<h5 class="ltx_title ltx_title_paragraph">Better performance than dense and BTM.</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS2.SSS2.Px1.p1">
<p class="ltx_p" id="S4.SS2.SSS2.Px1.p1.1">MoE 훈련 단계가 사전 훈련에서 총 훈련 예산의 일부를 사용함에도 불구하고(예를 들어, <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS2.Px1.p1.1.1">Llama-2</span> 사전 훈련은 2T 토큰을 사용함), BTX는 밀집 모델의 다중 작업 학습 및 Branch-Train-Merge와 같은 대안적인 연속 사전 훈련 접근법과 비교하여 일반적인 능력에 대한 가파른 개선을 가져온다.</p>
</div>
</section>
<section class="ltx_paragraph" id="S4.SS2.SSS2.Px2">
<h5 class="ltx_title ltx_title_paragraph">More efficient than sparse upcycling.</h5><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS2.SSS2.Px2.p1">
<p class="ltx_p" id="S4.SS2.SSS2.Px2.p1.1">BTX의 특별한 경우, 전문가 훈련이 없는 희소 업사이클링은 동일하거나 더 큰 컴퓨팅 예산을 고려할 때 조밀하고 BTM보다 우수하지만 BTX는 그렇지 않다. BTX의 계산 효율 향상은 MoE 미세 조정 전에 전문가의 당황스러울 정도로 병렬 훈련에서 비롯된다.</p>
</div>
<div class="ltx_para" id="S4.SS2.SSS2.Px2.p2">
<p class="ltx_p" id="S4.SS2.SSS2.Px2.p2.1">매개 변수의 활성 수(<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#footnote1" title="footnote 1 ‣ Figure 2 ‣ 4.1.3 Evaluation ‣ 4.1 Experimental Setup ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag"><span class="ltx_text" style="font-size:111%;">1</span></span></a>(left)에서 원 크기로 표시됨) 측면에서 MoE 모델은 <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS2.Px2.p2.1.1">Llama-2 13B</span> 모델과 유사하다. BTX는 <span class="ltx_text ltx_font_smallcaps" id="S4.SS2.SSS2.Px2.p2.1.2">Llama-2 13B</span>에 비해 추가 훈련 계산의 절반 미만을 사용하지만 전문가 도메인(수학, 코드 및 지식)에서 향상된 성능을 보여주고 전체 성능을 더 잘 달성합니다. 이는 BTX의 훈련이 사전 훈련 전체에 걸쳐 동일한 훈련 프로토콜을 사용하는 것보다 사전 훈련의 후기 단계에 더 효과적임을 나타낸다.</p>
</div>
</section>
</section>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Ablations &amp; Analysis</h3><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<section class="ltx_subsubsection" id="S4.SS3.SSS1">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.3.1 </span>Ablations of BTX training</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS3.SSS1.p1">
<p class="ltx_p" id="S4.SS3.SSS1.p1.1">먼저, 서로 다른 양의 핀튜닝에 대해 서로 다른 양의 활성 파라미터와 서로 다른 라우팅 방법을 비교한다. 공정한 비교를 위해 부하 분산은 그 중 어느 것에도 사용되지 않습니다. 결과는 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T4" title="Table 4 ‣ BTX improves all tasks where experts specialize. ‣ 4.2.1 Overall Performance ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 4</span></a>에 나와 있다. 스위치 라우팅의 경우 용량 계수를 1.5로 설정합니다(라우팅된 토큰이 삭제되는 하드 제한). 스위치 라우터가 평균 성능에서 저수준임을 발견했습니다. 소프트 라우팅은 가장 좋은 성능을 보이지만 희소성이 부족하고 활성 파라미터의 수가 가장 많기 때문에 예상된다. 전반적으로 Top-2 라우팅은 성능과 효율성 사이에서 좋은 균형을 제공합니다.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p2">
<p class="ltx_p" id="S4.SS3.SSS1.p2.1">또한 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T5" title="Table 5 ‣ BTX improves all tasks where experts specialize. ‣ 4.2.1 Overall Performance ‣ 4.2 Main Results ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 5</span></a>에 요약된 결과를 통해 BTX의 추가 디자인 선택을 삭제한다. 부하 분산이 없는 MoE 훈련은 코딩 작업(HumanEval)에서 더 나쁜 성능을 보이지만 수학(GSM8k) 정확도는 더 높다는 것을 발견했다. 다음 섹션의 라우팅 분석은 이러한 트레이드오프에 대한 더 많은 통찰력을 제공할 것이다. 다음으로 각 전문가로부터 초기화된 피드포워드 모듈을 동결하고 나머지 MoE 모델만을 훈련시키는 것은 모든 작업에서 성능에 거의 영향을 미치지 않는다. 이는 개별 전문가가 브랜치-트레인 단계에서 이미 충분한 도메인 지식을 얻은 반면, 믹스(MoE finetuning) 단계는 주로 자기 주의의 평균 가중치 및 라우터 변환 <math alttext="W_{i}" class="ltx_Math" display="inline" id="S4.SS3.SSS1.p2.1.m1.1"><semantics id="S4.SS3.SSS1.p2.1.m1.1a"><msub id="S4.SS3.SSS1.p2.1.m1.1.1" xref="S4.SS3.SSS1.p2.1.m1.1.1.cmml"><mi id="S4.SS3.SSS1.p2.1.m1.1.1.2" xref="S4.SS3.SSS1.p2.1.m1.1.1.2.cmml">W</mi><mi id="S4.SS3.SSS1.p2.1.m1.1.1.3" xref="S4.SS3.SSS1.p2.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS1.p2.1.m1.1b"><apply id="S4.SS3.SSS1.p2.1.m1.1.1.cmml" xref="S4.SS3.SSS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSS1.p2.1.m1.1.1.1.cmml" xref="S4.SS3.SSS1.p2.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.SSS1.p2.1.m1.1.1.2.cmml" xref="S4.SS3.SSS1.p2.1.m1.1.1.2">𝑊</ci><ci id="S4.SS3.SSS1.p2.1.m1.1.1.3.cmml" xref="S4.SS3.SSS1.p2.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p2.1.m1.1c">W_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p2.1.m1.1d">italic_W start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>와 같은 다른 매개변수를 훈련시킨다는 것을 시사한다.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS1.p3">
<p class="ltx_p" id="S4.SS3.SSS1.p3.1">또한 <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S3.SS3" title="3.3 Variations ‣ 3 Branch-Train-MiX ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Section</span> <span class="ltx_text ltx_ref_tag">3.3</span></a>에 설명된 혼합 및 분할 기술을 테스트한다. 모든 작업에 걸친 성능은 전문가가 혼합될 때 떨어졌으며, 이는 도메인 FF 계층이 이러한 방식으로 혼합될 수 없음을 시사한다. MoE 계층에서 8개의 모듈을 얻기 위해 각 도메인 FF를 <math alttext="C=2" class="ltx_Math" display="inline" id="S4.SS3.SSS1.p3.1.m1.1"><semantics id="S4.SS3.SSS1.p3.1.m1.1a"><mrow id="S4.SS3.SSS1.p3.1.m1.1.1" xref="S4.SS3.SSS1.p3.1.m1.1.1.cmml"><mi id="S4.SS3.SSS1.p3.1.m1.1.1.2" xref="S4.SS3.SSS1.p3.1.m1.1.1.2.cmml">C</mi><mo id="S4.SS3.SSS1.p3.1.m1.1.1.1" xref="S4.SS3.SSS1.p3.1.m1.1.1.1.cmml">=</mo><mn id="S4.SS3.SSS1.p3.1.m1.1.1.3" xref="S4.SS3.SSS1.p3.1.m1.1.1.3.cmml">2</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS3.SSS1.p3.1.m1.1b"><apply id="S4.SS3.SSS1.p3.1.m1.1.1.cmml" xref="S4.SS3.SSS1.p3.1.m1.1.1"><eq id="S4.SS3.SSS1.p3.1.m1.1.1.1.cmml" xref="S4.SS3.SSS1.p3.1.m1.1.1.1"></eq><ci id="S4.SS3.SSS1.p3.1.m1.1.1.2.cmml" xref="S4.SS3.SSS1.p3.1.m1.1.1.2">𝐶</ci><cn id="S4.SS3.SSS1.p3.1.m1.1.1.3.cmml" type="integer" xref="S4.SS3.SSS1.p3.1.m1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSS1.p3.1.m1.1c">C=2</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSS1.p3.1.m1.1d">italic_C = 2</annotation></semantics></math> 청크로 분할해도 Top-4 라우팅이 활성 파라미터 수와 일치하는데 사용되더라도 성능이 향상되지 않는다.</p>
</div>
<figure class="ltx_figure" id="S4.F3">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="198" id="S4.F3.g1" src="https://arxiv.org/html/2403.07816v1/x4.png" width="788"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="211" id="S4.F3.g2" src="https://arxiv.org/html/2403.07816v1/x5.png" width="788"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S4.F3.3.1.1" style="font-size:90%;">그림 3</span>:</span><span class="ltx_text" id="S4.F3.4.2" style="font-size:90%;">BTX routing decisions of the tokens at various layers to different experts (Wiki, Math, Code, <span class="ltx_text ltx_font_smallcaps" id="S4.F3.4.2.1">LLaMa-2 7B</span>) for different downstream tasks. 작업은 코드(인간 평가, MBPP), 수학(GSM8K, MATH), 세계 지식(자연 질문, 트리비아QA) 및 추론(ARC-Easy, ARC-Challenge, SIQA, PIQA 및 WinoGrande) 도메인별로 집계됩니다. 부하 균형(상단)을 갖는 Top-2 라우팅은 부하 균형(하단)을 갖지 않는 Top-2에 비해 전문가들 사이의 부하를 보다 균일하게 분배하는 것을 관찰한다. </span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_subsubsection" id="S4.SS3.SSS2">
<h4 class="ltx_title ltx_title_subsubsection">
<span class="ltx_tag ltx_tag_subsubsection">4.3.2 </span>Routing Analysis</h4><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S4.SS3.SSS2.p1">
<p class="ltx_p" id="S4.SS3.SSS2.p1.1">BTX의 성능을 심층적으로 이해하기 위해 다운스트림 태스크에 대한 모델 평가를 실행하고 전문가 간의 라우팅 결정을 검토한다. 결과는 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.F3" title="Figure 3 ‣ 4.3.1 Ablations of BTX training ‣ 4.3 Ablations &amp; Analysis ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Figure 3</span></a>에 요약되어 있으며, 또한 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S10" title="10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Section 10</span></a>에서 서로 다른 BTX 설정에 대한 자세한 절제 결과를 보고한다. 로드 밸런싱을 적용한 Top-2 라우팅은 다른 라우팅 방법에 비해 전문가 간 로드의 균일한 분산을 보장한다. 토큰 확률 분포를 분석하면 부하 분산이 있는 모든 전문가에서 낮은 확률 점수로의 이동이 관찰되며, 특히 모델의 최종 계층에 더 가깝고 이는 공정한 라우팅에 기여한다. 흥미롭게도 부하 균형이 없는 모든 모델은 다른 전문가, 특히 코드 전문가의 전체 기여도가 낮은 수학 전문가에 크게 의존한다. 데드 코드 전문가는 훈련에 도입된 부하 분산과 함께 "다시 살아나기"를 한다. 실제로 가시화될 뿐만 아니라 수학과 코드 영역의 지배적인 전문가가 된다.</p>
</div>
<div class="ltx_para" id="S4.SS3.SSS2.p2">
<p class="ltx_p" id="S4.SS3.SSS2.p2.1">부하 분산이 있는 Top-2에 대한 라우팅 결정의 예는 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S4.T6" title="Table 6 ‣ 4.3.2 Routing Analysis ‣ 4.3 Ablations &amp; Analysis ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 6</span></a>에서 찾을 수 있다. 수학 도메인 작업 전반에 걸쳐 토큰은 종종 코드 및 <span class="ltx_text ltx_font_smallcaps" id="S4.SS3.SSS2.p2.1.1">Llama-2 7B</span> 전문가로 라우팅됩니다. 보다 상세한 토큰 분포(<a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S10" title="10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Section 10</span></a>, <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S10.F6" title="Figure 6 ‣ 10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Figure 6</span></a>)를 살펴보면, GSM8K 태스크가 Code와 <span class="ltx_text ltx_font_smallcaps" id="S4.SS3.SSS2.p2.1.2">Llama-2</span> 전문가를 선호하는 반면, MATH 태스크는 도메인 내 Math 전문가에 더 많이 의존한다. 우리는 GSM8K 데이터 세트가 상식 지식과 기본적인 산술 연산이 필요한 초등학교 수학 문제로 구성되어 있기 때문에 이러한 일이 발생한다고 가정한다. 코드 및 세계 지식 작업 모두 대부분 도메인 내 코드 및 위키피디아 전문가로 이동한다. 앞서 섹션 <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S4.SS3.SSS1" title="4.3.1 Ablations of BTX training ‣ 4.3 Ablations &amp; Analysis ‣ 4 Experiments ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">4.3.1</span></a>에서 관찰된 바와 같이, 로드 밸런싱이 도입될 때, 코딩 과제는 개선되지만 수학 과제는 열화가 있으며, 이는 도메인 전문가 라우팅의 이러한 변화로 설명될 수 있다. 대조적으로 추론 과제는 유사한 행동을 나타내며 수학 및 일반론자인 LLM의 전문성에 동등하게 의존한다.</p>
</div>
<figure class="ltx_table" id="S4.T6">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T6.2" style="width:412.4pt;height:366.5pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-51.6pt,45.8pt) scale(0.8,0.8) ;">
<table class="ltx_tabular ltx_align_middle" id="S4.T6.2.1">
<tbody><tr class="ltx_tr" id="S4.T6.2.1.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T6.2.1.1.1">Task</td>
<td class="ltx_td ltx_align_left ltx_border_tt" id="S4.T6.2.1.1.2">Question and generation</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.1.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.1.2.1">GSM8K</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.1.2.2">
<span class="ltx_text" id="S4.T6.2.1.2.2.1"></span><span class="ltx_text" id="S4.T6.2.1.2.2.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T6.2.1.2.2.2.1">
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.1">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.1.1">Q: <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.1" style="color:#0000FF;">Jan<span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.1.1" style="color:#FF00FF;">et</span>’</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2" style="color:#FF8000;">s <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.1" style="color:#FF00FF;">ducks lay</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2.2" style="color:#FF00FF;"> </span>1<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.3" style="color:#FF00FF;">6 eggs <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2.3.1" style="color:#0000FF;">per </span>day</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2.4" style="color:#00FFFF;">. <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.4.1" style="color:#0000FF;">She e</span></span>ats <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.5" style="color:#FF00FF;">three for breakfast</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2.6" style="color:#FF00FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2.6.1" style="color:#00FFFF;">every <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.6.1.1" style="color:#FF00FF;">morning</span></span> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.1.1.2.6.2" style="color:#00FFFF;">and <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.6.2.1" style="color:#FF00FF;">bakes muff</span></span></span>ins <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.1.1.2.7" style="color:#0000FF;">for</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.2">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.2.1"><span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.2.1.1" style="color:#0000FF;">her <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.1.1" style="color:#FF00FF;">friends </span>every <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.1.2" style="color:#FF00FF;">day</span></span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.2" style="color:#FF00FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.2.1" style="color:#00FFFF;">with <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.2.1.2.1.1" style="color:#FF00FF;">four. <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.2.1.1.1" style="color:#0000FF;">She s</span>ells the remainder <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.2.1.1.2" style="color:#0000FF;">at </span>the farmers’ market</span></span> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.2.2" style="color:#00FFFF;">daily for <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.2.1.2.2.1" style="color:#FF00FF;">$</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.2.1.2.2.2" style="color:#FF8000;">2 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.2.1.2.2.2.1" style="color:#FF00FF;">per fresh</span></span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.3">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.3.1"><span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.3.1.1" style="color:#FF00FF;">du</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2" style="color:#FF8000;">ck <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.3.1.2.1" style="color:#FF00FF;">egg</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.2" style="color:#FF0000;">. <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.3.1.2.2.1" style="color:#00FFFF;">How</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.2.2" style="color:#00FFFF;"> </span></span>much <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.3.1.2.3" style="color:#FF00FF;">in dollars <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.3.1" style="color:#0000FF;">does she <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.3.1.1" style="color:#008080;">make </span>every</span></span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.4" style="color:#0000FF;"> </span>day <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.3.1.2.5" style="color:#0000FF;">at the <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.5.1" style="color:#FF00FF;">far</span></span>mers’ market<span class="ltx_text" id="S4.T6.2.1.2.2.2.1.3.1.2.6" style="color:#00FFFF;">?</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.4">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.4.1">A: <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.1" style="color:#0000FF;">Jan</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2" style="color:#FF8000;">et<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.1" style="color:#FF00FF;">’</span>s <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.2" style="color:#FF00FF;">du</span>cks <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.3" style="color:#FF00FF;">lay</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.4" style="color:#FF00FF;"> </span>16 eggs <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.5" style="color:#FF0000;">per </span>day. <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.6" style="color:#0000FF;">She e</span>ats <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.7" style="color:#FF00FF;">three</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.8" style="color:#FF00FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.8.1" style="color:#FF0000;">for </span></span>breakfast <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.9" style="color:#FF0000;">every </span>morning<span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.10" style="color:#00FFFF;">. <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.10.1" style="color:#0000FF;">So she has</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.10.2" style="color:#0000FF;"> </span></span>1<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.11" style="color:#FF00FF;">6 <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.11.1" style="color:#008080;">-</span></span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.4.1.2.12" style="color:#008080;"> </span>3 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.4.1.2.13" style="color:#FF00FF;">=</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.5">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.5.1"><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1" style="color:#FF8000;">13 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.1" style="color:#FF00FF;">eggs <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.1.1" style="color:#0000FF;">left. She </span>b</span>akes <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.2" style="color:#FF0000;">m</span>uffins <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.3" style="color:#0000FF;">for</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.4" style="color:#0000FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.4.1" style="color:#FF0000;">her <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.4.1.1" style="color:#FF00FF;">friends</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.4.1.2" style="color:#FF00FF;"> </span>every </span></span>day <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.5" style="color:#008080;">with </span>4<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.6" style="color:#FF00FF;">.</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.7" style="color:#FF00FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.7.1" style="color:#FF0000;">So she <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.7.1.1" style="color:#008080;">has </span></span></span>13 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.8" style="color:#008080;">-</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.9" style="color:#008080;"> </span>4 = 9 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.10" style="color:#FF00FF;">eggs</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.11" style="color:#FF00FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.5.1.1.11.1" style="color:#FF0000;">left. <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.5.1.1.11.1.1" style="color:#0000FF;">She</span></span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.6">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.6.1"><span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.1" style="color:#008080;">s</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2" style="color:#FF8000;">ells <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.1" style="color:#0000FF;">the</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.2" style="color:#0000FF;"> </span>remainder <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.3" style="color:#FF0000;">at the <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.3.1" style="color:#FF00FF;">far</span></span>mers’ <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.4" style="color:#008080;">market</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.5" style="color:#008080;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.5.1" style="color:#FF0000;">daily <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.5.1.1" style="color:#00FFFF;">for <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.5.1.1.1" style="color:#008080;">$</span></span></span></span>2 per fresh duck egg<span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.6" style="color:#FF0000;">. <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.6.1" style="color:#0000FF;">So she has</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.6.2" style="color:#0000FF;"> </span></span>9 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.7" style="color:#008080;">*</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.8" style="color:#008080;"> </span>2 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.9" style="color:#FF00FF;">=</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.10" style="color:#FF00FF;"> </span>18 <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.6.1.2.11" style="color:#FF00FF;">dollars<span class="ltx_text" id="S4.T6.2.1.2.2.2.1.6.1.2.11.1" style="color:#0000FF;">.</span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.2.2.2.1.7">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.2.2.2.1.7.1"><span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.2.2.2.1.7.1.1" style="color:#0000FF;">The</span><span class="ltx_text" id="S4.T6.2.1.2.2.2.1.7.1.2" style="color:#0000FF;"> <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.7.1.2.1" style="color:#FF8000;">answer <span class="ltx_text" id="S4.T6.2.1.2.2.2.1.7.1.2.1.1" style="color:#00FFFF;">is </span>18.</span></span></span></span>
</span></span> <span class="ltx_text" id="S4.T6.2.1.2.2.3"></span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.1.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.1.3.1">Human Eval</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S4.T6.2.1.3.2">
<span class="ltx_text" id="S4.T6.2.1.3.2.1"></span><span class="ltx_text" id="S4.T6.2.1.3.2.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T6.2.1.3.2.2.1">
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.1">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.1.1">Q: <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.1.1.1" style="color:#FF0000;">from typing import <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.1.1.1.1" style="color:#0000FF;">List</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.2">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.2.1"><span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.2.1.1" style="color:#008080;">def has_close<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.2.1.1.1" style="color:#FF8000;">_</span>elements(numbers: List[float<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.2.1.1.2" style="color:#FF8000;">], </span>threshold: <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.2.1.1.3" style="color:#00FFFF;">float<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.2.1.1.3.1" style="color:#FF8000;">)</span></span>-&gt; bool<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.2.1.1.4" style="color:#FF8000;">:</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.3">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.3.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.3.1.1" style="color:#008080;">""" Check if in given list</span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.3.1.2" style="color:#008080;"> <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.3.1.2.1" style="color:#0000FF;">of <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.3.1.2.1.1" style="color:#008080;">numbers</span>, <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.3.1.2.1.2" style="color:#008080;">are any</span></span> <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.3.1.2.2" style="color:#FF00FF;">two <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.3.1.2.2.1" style="color:#008080;">numbers closer</span></span> <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.3.1.2.3" style="color:#0000FF;">to <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.3.1.2.3.1" style="color:#FF00FF;">each <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.3.1.2.3.1.1" style="color:#FF0000;">other </span></span>than</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.4">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.4.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.4.1.1" style="color:#008080;">given threshold.</span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.5">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.5.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.5.1.1" style="color:#008080;">&gt; &gt; &gt; has</span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.5.1.2" style="color:#FF0000;">_close_<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.5.1.2.1" style="color:#0000FF;">elements<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.5.1.2.1.1" style="color:#008080;">([1.0<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.5.1.2.1.1.1" style="color:#FF8000;">, </span>2<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.5.1.2.1.1.2" style="color:#FF8000;">.0, 3.0], </span>0<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.5.1.2.1.1.3" style="color:#FF8000;">.</span>5)</span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.6">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.6.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.6.1.1" style="color:#008080;">False</span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.7">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.7.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.7.1.1" style="color:#008080;">&gt; &gt; &gt; has<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.1.1" style="color:#00FFFF;">_close</span></span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2" style="color:#FF0000;">_<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.7.1.2.1" style="color:#00FFFF;">elements<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1" style="color:#FF8000;">([<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.1" style="color:#008080;">1</span>.0, <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.2" style="color:#008080;">2</span>.8<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.3" style="color:#008080;">, 3</span>.<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.4" style="color:#008080;">0</span>, <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.5" style="color:#008080;">4</span>.<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.6" style="color:#008080;">0, </span>5.0<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.7" style="color:#008080;">, </span>2<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.8" style="color:#008080;">.</span>0<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.1.1.9" style="color:#008080;">],</span></span></span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.2" style="color:#008080;"> </span>0<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.7.1.2.3" style="color:#008080;">.<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.7.1.2.3.1" style="color:#FF8000;">3)</span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.8">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.8.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.8.1.1" style="color:#FF8000;">True</span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.9">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.9.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.9.1.1" style="color:#FF8000;">"""</span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.10">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.10.1">A: <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.10.1.1" style="color:#008080;">for i in</span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.10.1.2" style="color:#008080;"> <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.10.1.2.1" style="color:#FF0000;">range<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.10.1.2.1.1" style="color:#FF8000;">(<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.10.1.2.1.1.1" style="color:#008080;">len</span>(</span>numbers<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.10.1.2.1.2" style="color:#008080;">) - <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.10.1.2.1.2.1" style="color:#FF8000;">1):</span></span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.11">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.11.1"> <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.11.1.1" style="color:#008080;">for j <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.11.1.1.1" style="color:#FF8000;">in <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.11.1.1.1.1" style="color:#0000FF;">range</span>(</span>i +</span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.11.1.2" style="color:#008080;"> <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.11.1.2.1" style="color:#FF0000;">1<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.11.1.2.1.1" style="color:#FF8000;">, <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.11.1.2.1.1.1" style="color:#008080;">len</span>(</span><span class="ltx_text" id="S4.T6.2.1.3.2.2.1.11.1.2.1.2" style="color:#0000FF;">numbers<span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.11.1.2.1.2.1" style="color:#008080;">)):</span></span></span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.12">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.12.1">  <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.12.1.1" style="color:#008080;">if abs(numbers<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.12.1.1.1" style="color:#FF8000;">[i] - numbers<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.12.1.1.1.1" style="color:#00FFFF;">[j]</span>) </span>&lt; threshold<span class="ltx_text" id="S4.T6.2.1.3.2.2.1.12.1.1.2" style="color:#FF8000;">:</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.13">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.13.1">   <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.13.1.1" style="color:#008080;">return <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.13.1.1.1" style="color:#00FFFF;">True</span></span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.3.2.2.1.14">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.3.2.2.1.14.1"><span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.3.2.2.1.14.1.1" style="color:#008080;">return <span class="ltx_text" id="S4.T6.2.1.3.2.2.1.14.1.1.1" style="color:#00FFFF;">False</span></span></span></span>
</span></span> <span class="ltx_text" id="S4.T6.2.1.3.2.3"></span>
</td>
</tr>
<tr class="ltx_tr" id="S4.T6.2.1.4">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T6.2.1.4.1">
<span class="ltx_text" id="S4.T6.2.1.4.1.1"></span><span class="ltx_text" id="S4.T6.2.1.4.1.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T6.2.1.4.1.2.1">
<span class="ltx_tr" id="S4.T6.2.1.4.1.2.1.1">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.4.1.2.1.1.1">Natural</span></span>
<span class="ltx_tr" id="S4.T6.2.1.4.1.2.1.2">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.4.1.2.1.2.1">Questions</span></span>
</span></span> <span class="ltx_text" id="S4.T6.2.1.4.1.3"></span>
</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S4.T6.2.1.4.2">
<span class="ltx_text" id="S4.T6.2.1.4.2.1"></span><span class="ltx_text" id="S4.T6.2.1.4.2.2">
<span class="ltx_tabular ltx_align_middle" id="S4.T6.2.1.4.2.2.1">
<span class="ltx_tr" id="S4.T6.2.1.4.2.2.1.1">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.4.2.2.1.1.1">Q: <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.4.2.2.1.1.1.1" style="color:#00FFFF;">who <span class="ltx_text" id="S4.T6.2.1.4.2.2.1.1.1.1.1" style="color:#0000FF;">got <span class="ltx_text" id="S4.T6.2.1.4.2.2.1.1.1.1.1.1" style="color:#FF0000;">the first no</span></span></span><span class="ltx_text" id="S4.T6.2.1.4.2.2.1.1.1.2" style="color:#FF00FF;">bel prize <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.4.2.2.1.1.1.2.1" style="color:#0000FF;">in</span><span class="ltx_text" id="S4.T6.2.1.4.2.2.1.1.1.2.2" style="color:#0000FF;"> </span>physics</span></span></span>
<span class="ltx_tr" id="S4.T6.2.1.4.2.2.1.2">
<span class="ltx_td ltx_align_left" id="S4.T6.2.1.4.2.2.1.2.1">A: <span class="ltx_text ltx_framed_underline" id="S4.T6.2.1.4.2.2.1.2.1.1" style="color:#FF0000;">Max</span><span class="ltx_text" id="S4.T6.2.1.4.2.2.1.2.1.2" style="color:#FF0000;"> <span class="ltx_text" id="S4.T6.2.1.4.2.2.1.2.1.2.1" style="color:#FF00FF;">Plan<span class="ltx_text" id="S4.T6.2.1.4.2.2.1.2.1.2.1.1" style="color:#FF8000;">ck</span></span></span></span></span>
</span></span> <span class="ltx_text" id="S4.T6.2.1.4.2.3"></span>
</td>
</tr>
</tbody></table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S4.T6.4.1.1" style="font-size:90%;">Table 6</span>:</span><span class="ltx_text" id="S4.T6.5.2" style="font-size:90%;">Examples of the token routing decisions for the Top-2 routing with load balancing in the math (GSM8K), code (Human Eval), and knowledge (Natural Questions) domains. 강조된 토큰은 다음 전문가로 라우팅됩니다. <span class="ltx_text" id="S4.T6.5.2.1" 스타일="color:#FF0000;">Wikipedia and <span class="ltx_text ltx_font_smallcaps" id="S4.T6.5.2.1.2.1.1">LLaMa-2 7B</span>, <span class="ltx_text" id="S4.T6.5.2.1.2.2" 스타일="color:#FF00FF;">Math and <span class="ltx_text ltx_font_smallcaps" id="S4.T6.5.2.1.2.1" style="color:#FF8000;">Math and <span class="ltx_text ltx_font_smallcaps" id="S4.T6.5.2.1.2.1" style="color:#FF8000;">Math and <span class="ltx_text ltx_ <span class="ltx_text" id="S4.T6.5.2.1.2.2.2.1.1.1" style="color:#000000;">Tokens that were routed to the in-domain expert is underlined. </span></span></span></span></span></span></span></span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
</section>
</section>
<section class="ltx_section" id="S5" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Conclusion</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">우리는 LLM의 능력을 향상시키기 위해 간단한 연속 사전 훈련 방법인 브랜치-트레인-MiX(BTX)를 도입했다. 종자 LLM의 여러 사본을 비동기 및 병렬 방식으로 여러 도메인에 전문화하도록 훈련하고 나중에 미세 조정을 통해 단일 혼합 전문가(MoE) 모델로 다시 병합한다. 초기 병렬 훈련 단계가 더 높은 훈련 처리량과 확장성을 가져오는 반면, 두 번째 MoE 미세 조정 단계는 최종 LLM을 더 성능 있게 만든다. 우리의 실험은 일반적인 LLM의 성능이 우리의 방법을 사용하여 전문 지식과 기술을 가진 데이터 세트에 대한 지속적인 훈련에 의해 향상될 수 있음을 시사한다. 우리는 BTX 접근법이 더 큰 일반 LLM 또는 여러 별도로 특수화된 LLM을 훈련하는 것보다 계산 효율이 더 높다는 것을 발견했다. 이러한 통찰력은 강력한 일반화 모델을 달성하기 위해 늦은 사전 훈련에서 컴퓨팅을 할당하는 방법을 알려줄 수 있다.</p>
</div>
</section>
<section class="ltx_section" id="S6" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Limitations &amp; Future Work</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">BTX에 대한 우리의 실험 결과는 유망하지만 이 논문에서 그 잠재력을 완전히 탐구하지는 못했다. 계산 한계로 인해 본 논문에서는 3개의 도메인과 4명의 전문가만을 대상으로 실험하였다. 감독되지 않은 도메인 발견을 사용하는 것과 같은 더 많은 도메인에 대한 훈련 <cite class="ltx_cite ltx_citemacro_citep">(Gururangan et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib16" title="">2023</a>)</cite>는 전문가 훈련의 병렬화의 이점을 증폭시켜야 한다. 더 많은 전문가를 두는 것도 최종 MoE 모델을 더 효율적으로 만들 것이다. 왜냐하면 활동적인 전문가의 수는 그대로 유지될 수 있지만 전체 용량은 증가하기 때문이다. 실험에서는 MoE의 간단한 구현을 사용했으며 다른 전문가를 다른 GPU에 배치하여 병렬로 실행하는 것과 같은 더 복잡한 기술을 사용하여 MoE를 최적화하지 않았다. 이러한 효율적인 MoE 구현은 BTX의 훈련 시간을 단축시킬 수 있으며, 드문드문 업사이클링 베이스라인도 단축시킬 수 있다.</p>
</div>
<div class="ltx_para" id="S6.p2">
<p class="ltx_p" id="S6.p2.1">BTX는 BTM과 비교하여 결합된 전문가를 미세 조정하는 접근법을 제공하며, 이는 명령어 미세 조정 또는 RLHF 절차에서 직접 적용될 수 있다. 그러나, 우리는 이 논문에서 사전 훈련 단계에 초점을 맞추었기 때문에 그것을 향후 작업으로 남겨둔다.</p>
</div>
<div class="ltx_para" id="S6.p3">
<p class="ltx_p" id="S6.p3.1">MoE의 전문가들이 특정 영역을 전문화하는 것이 더 나은지 여부에 대한 질문은 추가 조사가 필요한 흥미로운 질문이다. 우리의 접근법은 전문가를 특정 도메인에 명시적으로 묶었지만 이러한 전문화는 MoE 훈련 <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib21" title="">2024</a>)</cite> 동안 자연스럽게 나타나지 않는 것 같다. 일부 전문가가 해당 도메인 작업에 더 많이 사용되는 것을 관찰하여 MoE 미세 조정 후에도 도메인 전문화가 부분적으로 남아 있음을 보여준다.</p>
</div>
<div class="ltx_para" id="S6.p4">
<p class="ltx_p" id="S6.p4.1">BTX를 전문가 훈련에 할당된 100% 컴퓨팅과 MoE 미세 조정에 할당된 0% 컴퓨팅을 사용하는 BTM과 전문가 훈련에 할당된 0% 컴퓨팅과 MoE 미세 조정에 할당된 100% 컴퓨팅을 사용하는 희소 업사이클링이라는 두 가지 특수 변형과 비교했다. 향후 작업은 전문가 훈련과 MoE 훈련 사이의 컴퓨팅 할당 비율을 철저히 스윕할 수 있다. 또한 균일한 샘플링 이외의 MoE 미세 조정을 위해 다른 데이터 혼합물로 실험을 수행하지 않았다.</p>
</div>
</section>
<section class="ltx_section" id="S7" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Acknowledgements</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S7.p1">
<p class="ltx_p" id="S7.p1.1">우리는 마가렛 리, 쿠샬 티루말라, 루크 제틀모예르, 아르티도로 파그노니, 수친 구루랑간, 마이크 루이스와 에밀리 디난, 훈련 시행에 도움을 준 앤드류 코헨과 아룬 바부에게 감사드린다.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_bibliography" id="bib" lang="en">
<h2 class="ltx_title ltx_title_bibliography">References</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Achiam et&nbsp;al. (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Josh Achiam, Steven Adler, Sandhini Agarwal, Lama Ahmad, Ilge Akkaya, Florencia&nbsp;Leoni Aleman, Diogo Almeida, Janko Altenschmidt, Sam Altman, Shyamal Anadkat, et&nbsp;al.

</span>
<span class="ltx_bibblock">Gpt-4 technical report.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">arXiv preprint arXiv:2303.08774</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Aljundi et&nbsp;al. (2016)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Rahaf Aljundi, Punarjay Chakravarty, and Tinne Tuytelaars.

</span>
<span class="ltx_bibblock">Expert gate: Lifelong learning with a network of experts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">2017 IEEE Conference on Computer Vision and Pattern Recognition (CVPR)</em>, pages 7120–7129, 2016.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:914027" title="">https://api.semanticscholar.org/CorpusID:914027</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Austin et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Jacob Austin, Augustus Odena, Maxwell Nye, Maarten Bosma, Henryk Michalewski, David Dohan, Ellen Jiang, Carrie&nbsp;J. Cai, Michael Terry, Quoc&nbsp;V. Le, and Charles Sutton.

</span>
<span class="ltx_bibblock">Program synthesis with large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">ArXiv</em>, abs/2108.07732, 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:237142385" title="">https://api.semanticscholar.org/CorpusID:237142385</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Awasthi and Sarawagi (2019)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Abhijeet Awasthi and Sunita Sarawagi.

</span>
<span class="ltx_bibblock">Continual learning with neural networks: A review.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">Proceedings of the ACM India Joint International Conference on Data Science and Management of Data</em>, pages 362–365, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Azerbayev et&nbsp;al. (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Zhangir Azerbayev, Hailey Schoelkopf, Keiran Paster, Marco&nbsp;Dos Santos, Stephen McAleer, Albert&nbsp;Q. Jiang, Jia Deng, Stella Biderman, and Sean Welleck.

</span>
<span class="ltx_bibblock">Llemma: An open language model for mathematics.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">ArXiv</em>, abs/2310.10631, 2023.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:264172303" title="">https://api.semanticscholar.org/CorpusID:264172303</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bisk et&nbsp;al. (2020)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Yonatan Bisk, Rowan Zellers, Jianfeng Gao, Yejin Choi, et&nbsp;al.

</span>
<span class="ltx_bibblock">Piqa: Reasoning about physical commonsense in natural language.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Proceedings of the AAAI conference on artificial intelligence</em>, volume&nbsp;34, pages 7432–7439, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et&nbsp;al. (2020)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Tom&nbsp;B. Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, Sandhini Agarwal, Ariel Herbert-Voss, Gretchen Krueger, T.&nbsp;J. Henighan, Rewon Child, Aditya Ramesh, Daniel&nbsp;M. Ziegler, Jeff Wu, Clemens Winter, Christopher Hesse, Mark Chen, Eric Sigler, Mateusz Litwin, Scott Gray, Benjamin Chess, Jack Clark, Christopher Berner, Sam McCandlish, Alec Radford, Ilya Sutskever, and Dario Amodei.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">ArXiv</em>, abs/2005.14165, 2020.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:218971783" title="">https://api.semanticscholar.org/CorpusID:218971783</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Mark Chen, Jerry Tworek, Heewoo Jun, Qiming Yuan, Henrique Ponde, Jared Kaplan, Harrison Edwards, Yura Burda, Nicholas Joseph, Greg Brockman, Alex Ray, Raul Puri, Gretchen Krueger, Michael Petrov, Heidy Khlaaf, Girish Sastry, Pamela Mishkin, Brooke Chan, Scott Gray, Nick Ryder, Mikhail Pavlov, Alethea Power, Lukasz Kaiser, Mohammad Bavarian, Clemens Winter, Philippe Tillet, Felipe&nbsp;Petroski Such, David&nbsp;W. Cummings, Matthias Plappert, Fotios Chantzis, Elizabeth Barnes, Ariel Herbert-Voss, William&nbsp;H. Guss, Alex Nichol, Igor Babuschkin, Suchir Balaji, Shantanu Jain, Andrew Carr, Jan Leike, Joshua Achiam, Vedant Misra, Evan Morikawa, Alec Radford, Matthew&nbsp;M. Knight, Miles Brundage, Mira Murati, Katie Mayer, Peter Welinder, Bob McGrew, Dario Amodei, Sam McCandlish, Ilya Sutskever, and Wojciech Zaremba.

</span>
<span class="ltx_bibblock">Evaluating large language models trained on code.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">ArXiv</em>, abs/2107.03374, 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:235755472" title="">https://api.semanticscholar.org/CorpusID:235755472</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et&nbsp;al. (2018)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Peter Clark, Isaac Cowhey, Oren Etzioni, Tushar Khot, Ashish Sabharwal, Carissa Schoenick, and Oyvind Tafjord.

</span>
<span class="ltx_bibblock">Think you have solved question answering? Try ARC, the AI2 reasoning challenge.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">arXiv preprint arXiv:1803.05457</em>, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cobbe et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Karl Cobbe, Vineet Kosaraju, Mohammad Bavarian, Mark Chen, Heewoo Jun, Lukasz Kaiser, Matthias Plappert, Jerry Tworek, Jacob Hilton, Reiichiro Nakano, Christopher Hesse, and John Schulman.

</span>
<span class="ltx_bibblock">Training verifiers to solve math word problems.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">arXiv preprint arXiv:2110.14168</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dai et&nbsp;al. (2024)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Damai Dai, Chengqi Deng, Chenggang Zhao, R.&nbsp;X. Xu, Huazuo Gao, Deli Chen, Jiashi Li, Wangding Zeng, Xingkai Yu, Y.&nbsp;Wu, Zhenda Xie, Y.&nbsp;K. Li, Panpan Huang, Fuli Luo, Chong Ruan, Zhifang Sui, and Wenfeng Liang.

</span>
<span class="ltx_bibblock">Deepseekmoe: Towards ultimate expert specialization in mixture-of-experts language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">ArXiv</em>, abs/2401.06066, 2024.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:266933338" title="">https://api.semanticscholar.org/CorpusID:266933338</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Douillard et&nbsp;al. (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Arthur Douillard, Qixuang Feng, Andrei&nbsp;A. Rusu, Rachita Chhaparia, Yani Donchev, Adhiguna Kuncoro, Marc’Aurelio Ranzato, Arthur Szlam, and Jiajun Shen.

</span>
<span class="ltx_bibblock">Diloco: Distributed low-communication training of language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">ArXiv</em>, abs/2311.08105, 2023.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:265158012" title="">https://api.semanticscholar.org/CorpusID:265158012</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fedus et&nbsp;al. (2022)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
William Fedus, Barret Zoph, and Noam Shazeer.

</span>
<span class="ltx_bibblock">Switch transformers: Scaling to trillion parameter models with simple and efficient sparsity.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">The Journal of Machine Learning Research</em>, 23(1):5232–5270, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gemini Team (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Gemini Team.

</span>
<span class="ltx_bibblock">Gemini: a family of highly capable multimodal models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2312.11805</em>, 2023.

</span>
<span class="ltx_bibblock">Team, Gemini and Anil, Rohan and Borgeaud, Sebastian and Wu, Yonghui and Alayrac, Jean-Baptiste and Yu, Jiahui and Soricut, Radu and Schalkwyk, Johan and Dai, Andrew M and Hauth, Anja and others.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gururangan et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Suchin Gururangan, Michael Lewis, Ari Holtzman, Noah&nbsp;A. Smith, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Demix layers: Disentangling domains for modular language modeling.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">North American Chapter of the Association for Computational Linguistics</em>, 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:236976189" title="">https://api.semanticscholar.org/CorpusID:236976189</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gururangan et&nbsp;al. (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Suchin Gururangan, Margaret Li, Mike Lewis, Weijia Shi, Tim Althoff, Noah&nbsp;A Smith, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Scaling expert language models with unsupervised domain discovery.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">arXiv preprint arXiv:2303.14177</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et&nbsp;al. (2021a)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn Song, and Jacob Steinhardt.

</span>
<span class="ltx_bibblock">Measuring massive multitask language understanding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">9th International Conference on Learning Representations, ICLR 2021, Virtual Event, Austria, May 3-7, 2021</em>. OpenReview.net, 2021a.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=d7KBjmI3GmQ" title="">https://openreview.net/forum?id=d7KBjmI3GmQ</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et&nbsp;al. (2021b)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Dan Hendrycks, Collin Burns, Saurav Kadavath, Akul Arora, Steven Basart, Eric Tang, Dawn&nbsp;Xiaodong Song, and Jacob Steinhardt.

</span>
<span class="ltx_bibblock">Measuring mathematical problem solving with the math dataset.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">ArXiv</em>, abs/2103.03874, 2021b.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:232134851" title="">https://api.semanticscholar.org/CorpusID:232134851</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jacobs et&nbsp;al. (1991)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Robert&nbsp;A. Jacobs, Michael&nbsp;I. Jordan, Steven&nbsp;J. Nowlan, and Geoffrey&nbsp;E. Hinton.

</span>
<span class="ltx_bibblock">Adaptive mixtures of local experts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">Neural Computation</em>, 3:79–87, 1991.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:572361" title="">https://api.semanticscholar.org/CorpusID:572361</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jang et&nbsp;al. (2016)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Eric Jang, Shixiang Gu, and Ben Poole.

</span>
<span class="ltx_bibblock">Categorical reparameterization with gumbel-softmax.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">arXiv preprint arXiv:1611.01144</em>, 2016.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et&nbsp;al. (2024)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Albert&nbsp;Q. Jiang, Alexandre Sablayrolles, Antoine Roux, Arthur Mensch, Blanche Savary, Chris Bamford, Devendra&nbsp;Singh Chaplot, Diego de&nbsp;Las&nbsp;Casas, Emma&nbsp;Bou Hanna, Florian Bressand, Gianna Lengyel, Guillaume Bour, Guillaume Lample, L’elio&nbsp;Renard Lavaud, Lucile Saulnier, Marie-Anne Lachaux, Pierre Stock, Sandeep Subramanian, Sophia Yang, Szymon Antoniak, Teven&nbsp;Le Scao, Théophile Gervet, Thibaut Lavril, Thomas Wang, Timothée Lacroix, and William&nbsp;El Sayed.

</span>
<span class="ltx_bibblock">Mixtral of experts.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">ArXiv</em>, abs/2401.04088, 2024.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:266844877" title="">https://api.semanticscholar.org/CorpusID:266844877</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Joshi et&nbsp;al. (2017)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Mandar Joshi, Eunsol Choi, Daniel&nbsp;S. Weld, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Triviaqa: A large scale distantly supervised challenge dataset for reading comprehension.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">ArXiv</em>, abs/1705.03551, 2017.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:26501419" title="">https://api.semanticscholar.org/CorpusID:26501419</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Komatsuzaki et&nbsp;al. (2022)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Aran Komatsuzaki, Joan Puigcerver, James Lee-Thorp, Carlos&nbsp;Riquelme Ruiz, Basil Mustafa, Joshua Ainslie, Yi&nbsp;Tay, Mostafa Dehghani, and Neil Houlsby.

</span>
<span class="ltx_bibblock">Sparse upcycling: Training mixture-of-experts from dense checkpoints.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">ArXiv</em>, abs/2212.05055, 2022.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:254535822" title="">https://api.semanticscholar.org/CorpusID:254535822</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kwiatkowski et&nbsp;al. (2019)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Tom Kwiatkowski, Jennimaria Palomaki, Olivia Redfield, Michael Collins, Ankur Parikh, Chris Alberti, Danielle Epstein, Illia Polosukhin, Matthew Kelcey, Jacob Devlin, Kenton Lee, Kristina&nbsp;N. Toutanova, Llion Jones, Ming-Wei Chang, Andrew Dai, Jakob Uszkoreit, Quoc Le, and Slav Petrov.

</span>
<span class="ltx_bibblock">Natural questions: a benchmark for question answering research.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Transactions of the Association of Computational Linguistics</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lange et&nbsp;al. (2019)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Matthias&nbsp;De Lange, Rahaf Aljundi, Marc Masana, Sarah Parisot, Xu&nbsp;Jia, Aleš Leonardis, Gregory&nbsp;G. Slabaugh, and Tinne Tuytelaars.

</span>
<span class="ltx_bibblock">A continual learning survey: Defying forgetting in classification tasks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">IEEE Transactions on Pattern Analysis and Machine Intelligence</em>, 44:3366–3385, 2019.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:218889912" title="">https://api.semanticscholar.org/CorpusID:218889912</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Mike Lewis, Shruti Bhosale, Tim Dettmers, Naman Goyal, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Base layers: Simplifying training of large, sparse models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">International Conference on Machine Learning</em>, 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:232428341" title="">https://api.semanticscholar.org/CorpusID:232428341</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et&nbsp;al. (2022a)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Margaret Li, Suchin Gururangan, Tim Dettmers, Mike Lewis, Tim Althoff, Noah&nbsp;A. Smith, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Branch-train-merge: Embarrassingly parallel training of expert language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">ArXiv</em>, abs/2208.03306, 2022a.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:251371375" title="">https://api.semanticscholar.org/CorpusID:251371375</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et&nbsp;al. (2022b)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Yujia Li, David&nbsp;H. Choi, Junyoung Chung, Nate Kushman, Julian Schrittwieser, Rémi Leblond, Tom, Eccles, James Keeling, Felix Gimeno, Agustin&nbsp;Dal Lago, Thomas Hubert, Peter Choy, Cyprien de, Masson d’Autume, Igor Babuschkin, Xinyun Chen, Po-Sen Huang, Johannes Welbl, Sven Gowal, Alexey, Cherepanov, James Molloy, Daniel&nbsp;Jaymin Mankowitz, Esme&nbsp;Sutherland Robson, Pushmeet Kohli, Nando de, Freitas, Koray Kavukcuoglu, and Oriol Vinyals.

</span>
<span class="ltx_bibblock">Competition-level code generation with alphacode.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Science</em>, 378:1092 – 1097, 2022b.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:246527904" title="">https://api.semanticscholar.org/CorpusID:246527904</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ouyang et&nbsp;al. (2022)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Long Ouyang, Jeff Wu, Xu&nbsp;Jiang, Diogo Almeida, Carroll&nbsp;L. Wainwright, Pamela Mishkin, Chong Zhang, Sandhini Agarwal, Katarina Slama, Alex Ray, John Schulman, Jacob Hilton, Fraser Kelton, Luke&nbsp;E. Miller, Maddie Simens, Amanda Askell, Peter Welinder, Paul&nbsp;Francis Christiano, Jan Leike, and Ryan&nbsp;J. Lowe.

</span>
<span class="ltx_bibblock">Training language models to follow instructions with human feedback.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib29.1.1">ArXiv</em>, abs/2203.02155, 2022.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:246426909" title="">https://api.semanticscholar.org/CorpusID:246426909</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Roller et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Stephen Roller, Sainbayar Sukhbaatar, Arthur Szlam, and Jason Weston.

</span>
<span class="ltx_bibblock">Hash layers for large sparse models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">Neural Information Processing Systems</em>, 2021.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:235367626" title="">https://api.semanticscholar.org/CorpusID:235367626</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rozière et&nbsp;al. (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Baptiste Rozière, Jonas Gehring, Fabian Gloeckle, Sten Sootla, Itai Gat, Xiaoqing Tan, Yossi Adi, Jingyu Liu, Tal Remez, Jérémy Rapin, Artyom Kozhevnikov, I.&nbsp;Evtimov, Joanna Bitton, Manish&nbsp;P Bhatt, Cristian&nbsp;Cantón Ferrer, Aaron Grattafiori, Wenhan Xiong, Alexandre D’efossez, Jade Copet, Faisal Azhar, Hugo Touvron, Louis Martin, Nicolas Usunier, Thomas Scialom, and Gabriel Synnaeve.

</span>
<span class="ltx_bibblock">Code llama: Open foundation models for code.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib31.1.1">ArXiv</em>, abs/2308.12950, 2023.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:261100919" title="">https://api.semanticscholar.org/CorpusID:261100919</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rusu et&nbsp;al. (2016)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Andrei&nbsp;A. Rusu, Neil&nbsp;C. Rabinowitz, Guillaume Desjardins, Hubert Soyer, James Kirkpatrick, Koray Kavukcuoglu, Razvan Pascanu, and Raia Hadsell.

</span>
<span class="ltx_bibblock">Progressive neural networks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">ArXiv</em>, abs/1606.04671, 2016.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:15350923" title="">https://api.semanticscholar.org/CorpusID:15350923</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sakaguchi et&nbsp;al. (2021)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Keisuke Sakaguchi, Ronan&nbsp;Le Bras, Chandra Bhagavatula, and Yejin Choi.

</span>
<span class="ltx_bibblock">Winogrande: An adversarial winograd schema challenge at scale.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">Communications of the ACM</em>, 64(9):99–106, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sap et&nbsp;al. (2019)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Maarten Sap, Hannah Rashkin, Derek Chen, Ronan LeBras, and Yejin Choi.

</span>
<span class="ltx_bibblock">Socialiqa: Commonsense reasoning about social interactions.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:1904.09728</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shao et&nbsp;al. (2024)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Zhihong Shao, Peiyi Wang, Qihao Zhu, R.&nbsp;X. Xu, Jun-Mei Song, Mingchuan Zhang, Y.&nbsp;K. Li, Yu&nbsp;Wu, and Daya Guo.

</span>
<span class="ltx_bibblock">Deepseekmath: Pushing the limits of mathematical reasoning in open language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">ArXiv</em>, abs/2402.03300, 2024.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:267412607" title="">https://api.semanticscholar.org/CorpusID:267412607</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shazeer et&nbsp;al. (2017)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Noam&nbsp;M. Shazeer, Azalia Mirhoseini, Krzysztof Maziarz, Andy Davis, Quoc&nbsp;V. Le, Geoffrey&nbsp;E. Hinton, and Jeff Dean.

</span>
<span class="ltx_bibblock">Outrageously large neural networks: The sparsely-gated mixture-of-experts layer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">ArXiv</em>, abs/1701.06538, 2017.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:12462234" title="">https://api.semanticscholar.org/CorpusID:12462234</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et&nbsp;al. (2023)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, Dan Bikel, Lukas Blecher, Cristian&nbsp;Canton Ferrer, Moya Chen, Guillem Cucurull, David Esiobu, Jude Fernandes, Jeremy Fu, Wenyin Fu, Brian Fuller, Cynthia Gao, Vedanuj Goswami, Naman Goyal, Anthony Hartshorn, Saghar Hosseini, Rui Hou, Hakan Inan, Marcin Kardas, Viktor Kerkez, Madian Khabsa, Isabel Kloumann, Artem Korenev, Punit&nbsp;Singh Koura, Marie-Anne Lachaux, Thibaut Lavril, Jenya Lee, Diana Liskovich, Yinghai Lu, Yuning Mao, Xavier Martinet, Todor Mihaylov, Pushkar Mishra, Igor Molybog, Yixin Nie, Andrew Poulton, Jeremy Reizenstein, Rashi Rungta, Kalyan Saladi, Alan Schelten, Ruan Silva, Eric&nbsp;Michael Smith, Ranjan Subramanian, Xiaoqing&nbsp;Ellen Tan, Binh Tang, Ross Taylor, Adina Williams, Jian&nbsp;Xiang Kuan, Puxin Xu, Zheng Yan, Iliyan Zarov, Yuchen Zhang, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien Rodriguez, Robert Stojnic, Sergey Edunov, and Thomas
Scialom.

</span>
<span class="ltx_bibblock">Llama 2: Open foundation and fine-tuned chat models, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wortsman et&nbsp;al. (2022)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Mitchell Wortsman, Gabriel Ilharco, Samir&nbsp;Yitzhak Gadre, Rebecca Roelofs, Raphael Gontijo-Lopes, Ari&nbsp;S. Morcos, Hongseok Namkoong, Ali Farhadi, Yair Carmon, Simon Kornblith, and Ludwig Schmidt.

</span>
<span class="ltx_bibblock">Model soups: averaging weights of multiple fine-tuned models improves accuracy without increasing inference time.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib38.1.1">ArXiv</em>, abs/2203.05482, 2022.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:247362886" title="">https://api.semanticscholar.org/CorpusID:247362886</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xue et&nbsp;al. (2024)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Fuzhao Xue, Zian Zheng, Yao Fu, Jinjie Ni, Zangwei Zheng, Wangchunshu Zhou, and Yang You.

</span>
<span class="ltx_bibblock">Openmoe: An early effort on open mixture-of-experts language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">arXiv preprint arXiv:2402.01739</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et&nbsp;al. (2015)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Sixin Zhang, Anna&nbsp;E Choromanska, and Yann LeCun.

</span>
<span class="ltx_bibblock">Deep learning with elastic averaging sgd.

</span>
<span class="ltx_bibblock">In C.&nbsp;Cortes, N.&nbsp;Lawrence, D.&nbsp;Lee, M.&nbsp;Sugiyama, and R.&nbsp;Garnett, editors, <em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">Advances in Neural Information Processing Systems</em>, volume&nbsp;28. Curran Associates, Inc., 2015.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2015/file/d18f655c3fce66ca401d5f38b48c89af-Paper.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2015/file/d18f655c3fce66ca401d5f38b48c89af-Paper.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et&nbsp;al. (2022)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Susan Zhang, Stephen Roller, Naman Goyal, Mikel Artetxe, Moya Chen, Shuohui Chen, Christopher Dewan, Mona&nbsp;T. Diab, Xian Li, Xi&nbsp;Victoria Lin, Todor Mihaylov, Myle Ott, Sam Shleifer, Kurt Shuster, Daniel Simig, Punit&nbsp;Singh Koura, Anjali Sridhar, Tianlu Wang, and Luke Zettlemoyer.

</span>
<span class="ltx_bibblock">Opt: Open pre-trained transformer language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">ArXiv</em>, abs/2205.01068, 2022.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="https://api.semanticscholar.org/CorpusID:248496292" title="">https://api.semanticscholar.org/CorpusID:248496292</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhao et&nbsp;al. (2024)<button class="back-to-reference-btn" aria-label="Back to the article">↑</button></span>
<span class="ltx_bibblock">
Jun Zhao, Zhihao Zhang, Qi&nbsp;Zhang, Tao Gui, and Xuanjing Huang.

</span>
<span class="ltx_bibblock">Llama beyond english: An empirical study on language capability transfer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib42.1.1">arXiv preprint arXiv:2401.01055</em>, 2024.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<div class="ltx_pagination ltx_role_newpage"></div>
<span class="ltx_ERROR undefined" id="id2" lang="en">\beginappendix</span>
<section class="ltx_section" id="S8" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">8 </span>Data mixture</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S8.p1">
<p class="ltx_p" id="S8.p1.1"><a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S8.T7" title="Table 7 ‣ 8 Data mixture ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 7</span></a>는 각 도메인 전문가를 훈련시키는 데 사용되는 정확한 데이터 혼합 비율을 보여준다. MoE 모델을 미세 조정하기 위해 수학 전문가, 코드 전문가, 위키피디아 전문가 및 원본 <span class="ltx_text ltx_font_smallcaps" id="S8.p1.1.1">Llama-2 7B</span>을 훈련하는 데 사용된 데이터 세트를 샘플링했으며 확률은 30.16%, 40.31%, 10.30% 및 19.23%이다.</p>
</div>
<figure class="ltx_table" id="S8.T7">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S8.T7.2">
<tbody><tr class="ltx_tr" id="S8.T7.2.1">
<td class="ltx_td ltx_align_left ltx_border_tt" id="S8.T7.2.1.1"><span class="ltx_text" id="S8.T7.2.1.1.1" style="font-size:90%;">Domain</span></td>
<td class="ltx_td ltx_align_left ltx_border_tt" id="S8.T7.2.1.2"><span class="ltx_text" id="S8.T7.2.1.2.1" style="font-size:90%;">Dataset</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S8.T7.2.1.3"><span class="ltx_text" id="S8.T7.2.1.3.1" style="font-size:90%;">Sampling ratio (%)</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="S8.T7.2.2.1" rowspan="5"><span class="ltx_text" id="S8.T7.2.2.1.1" style="font-size:90%;">Math</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S8.T7.2.2.2"><span class="ltx_text" id="S8.T7.2.2.2.1" style="font-size:90%;">AlgebraicStack</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S8.T7.2.2.3"><span class="ltx_text" id="S8.T7.2.2.3.1" style="font-size:90%;">13.57</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.3">
<td class="ltx_td ltx_align_left" id="S8.T7.2.3.1"><span class="ltx_text" id="S8.T7.2.3.1.1" style="font-size:90%;">OpenWebMath</span></td>
<td class="ltx_td ltx_align_center" id="S8.T7.2.3.2"><span class="ltx_text" id="S8.T7.2.3.2.1" style="font-size:90%;">54.27</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.4">
<td class="ltx_td ltx_align_left" id="S8.T7.2.4.1"><span class="ltx_text" id="S8.T7.2.4.1.1" style="font-size:90%;">Arxiv</span></td>
<td class="ltx_td ltx_align_center" id="S8.T7.2.4.2"><span class="ltx_text" id="S8.T7.2.4.2.1" style="font-size:90%;">27.14</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.5">
<td class="ltx_td ltx_align_left" id="S8.T7.2.5.1"><span class="ltx_text" id="S8.T7.2.5.1.1" style="font-size:90%;">Github</span></td>
<td class="ltx_td ltx_align_center" id="S8.T7.2.5.2"><span class="ltx_text" id="S8.T7.2.5.2.1" style="font-size:90%;">2.99</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.6">
<td class="ltx_td ltx_align_left" id="S8.T7.2.6.1"><span class="ltx_text" id="S8.T7.2.6.1.1" style="font-size:90%;">Commoncrawl</span></td>
<td class="ltx_td ltx_align_center" id="S8.T7.2.6.2"><span class="ltx_text" id="S8.T7.2.6.2.1" style="font-size:90%;">5.01</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.7">
<td class="ltx_td ltx_align_left ltx_border_t" id="S8.T7.2.7.1" rowspan="3"><span class="ltx_text" id="S8.T7.2.7.1.1" style="font-size:90%;">Code</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S8.T7.2.7.2"><span class="ltx_text" id="S8.T7.2.7.2.1" style="font-size:90%;">Code</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S8.T7.2.7.3"><span class="ltx_text" id="S8.T7.2.7.3.1" style="font-size:90%;">82.18</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.8">
<td class="ltx_td ltx_align_left" id="S8.T7.2.8.1"><span class="ltx_text" id="S8.T7.2.8.1.1" style="font-size:90%;">Natural language related to code</span></td>
<td class="ltx_td ltx_align_center" id="S8.T7.2.8.2"><span class="ltx_text" id="S8.T7.2.8.2.1" style="font-size:90%;">9.90</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.9">
<td class="ltx_td ltx_align_left" id="S8.T7.2.9.1"><span class="ltx_text" id="S8.T7.2.9.1.1" style="font-size:90%;">Natural language</span></td>
<td class="ltx_td ltx_align_center" id="S8.T7.2.9.2"><span class="ltx_text" id="S8.T7.2.9.2.1" style="font-size:90%;">6.93</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.10">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="S8.T7.2.10.1" rowspan="2"><span class="ltx_text" id="S8.T7.2.10.1.1" style="font-size:90%;">Wikipedia</span></td>
<td class="ltx_td ltx_align_left ltx_border_t" id="S8.T7.2.10.2"><span class="ltx_text" id="S8.T7.2.10.2.1" style="font-size:90%;">Wikipedia</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S8.T7.2.10.3"><span class="ltx_text" id="S8.T7.2.10.3.1" style="font-size:90%;">90.91</span></td>
</tr>
<tr class="ltx_tr" id="S8.T7.2.11">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S8.T7.2.11.1"><span class="ltx_text" id="S8.T7.2.11.1.1" style="font-size:90%;">Commoncrawl</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S8.T7.2.11.2"><span class="ltx_text" id="S8.T7.2.11.2.1" style="font-size:90%;">9.09</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption ltx_centering" style="font-size:90%;"><span class="ltx_tag ltx_tag_table">표 7:</span>도메인 전문가에 대한 데이터 소스 및 가중치.</figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_section" id="S9" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">9 </span>Evaluation</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S9.p1">
<p class="ltx_p" id="S9.p1.1">우리는 <cite class="ltx_cite ltx_citemacro_cite">Touvron et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib37" title="">2023</a>)</cite> 및 <cite class="ltx_cite ltx_citemacro_cite">Rozière et al. (<a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#bib.bib31" title="">2023</a>)</cite>: 코드 태스크(HumanEval and MBPP)에 대해 pass@1을 보고하고, 수학 태스크(GSM8k and MATH) 및 지식 태스크(Natural Questions and TriviaQA)에 대해 정확한 일치를 보고하고, MMLU 및 ARC에 대해 정확성을 보고한다. 우리는 모든 세대에 대해 탐욕스러운 디코딩을 사용한다. 모든 작업에 대한 자세한 결과는 <a class="ltx_ref ltx_refmacro_autoref" href="https://arxiv.org/html/2403.07816v1#S9.T8" title="Table 8 ‣ 9 Evaluation ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">Table 8</span></a>에 보고되어 있다.</p>
</div>
<figure class="ltx_table" id="S9.T8">
<table class="ltx_tabular ltx_centering ltx_align_middle" id="S9.T8.2">
<tbody><tr class="ltx_tr" id="S9.T8.2.1">
<td class="ltx_td ltx_border_tt" id="S9.T8.2.1.1" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.2.1" style="font-size:80%;">GSM8K</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.3.1" style="font-size:80%;">MATH</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.4.1" style="font-size:80%;">Human</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.5.1" style="font-size:80%;">MBPP</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.6.1" style="font-size:80%;">Natural</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.7.1" style="font-size:80%;">Trivia</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.8.1" style="font-size:80%;">ARC-e</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.9.1" style="font-size:80%;">ARC-c</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.10.1" style="font-size:80%;">Wino</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.11.1" style="font-size:80%;">SIQA</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.12.1" style="font-size:80%;">PIQA</span></td>
<td class="ltx_td ltx_align_center ltx_border_tt" id="S9.T8.2.1.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.1.13.1" style="font-size:80%;">MMLU</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.2">
<td class="ltx_td" id="S9.T8.2.2.1" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.2" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.3" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.2.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.2.4.1" style="font-size:80%;">Eval</span></td>
<td class="ltx_td" id="S9.T8.2.2.5" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.2.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.2.6.1" style="font-size:80%;">Questions</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.2.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.2.7.1" style="font-size:80%;">QA</span></td>
<td class="ltx_td" id="S9.T8.2.2.8" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.9" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.10" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.11" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.12" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td" id="S9.T8.2.2.13" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.3">
<td class="ltx_td ltx_align_left ltx_border_t" id="S9.T8.2.3.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_italic" id="S9.T8.2.3.1.1" style="font-size:80%;">Specialized LLMs</span></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.2" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.3" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.4" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.5" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.6" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.7" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.8" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.9" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.10" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.11" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.12" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.3.13" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.4">
<td class="ltx_td ltx_align_left" id="S9.T8.2.4.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_smallcaps" id="S9.T8.2.4.1.1" style="font-size:80%;">CodeLlama 7B</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.2.1" style="font-size:80%;">13.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.3.1" style="font-size:80%;">3.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.4.1" style="font-size:80%;">31.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.5.1" style="font-size:80%;">41.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.6.1" style="font-size:80%;">11.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.7.1" style="font-size:80%;">32.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.8.1" style="font-size:80%;">67.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.9.1" style="font-size:80%;">34.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.10.1" style="font-size:80%;">62.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.11.1" style="font-size:80%;">46.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.12.1" style="font-size:80%;">72.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.4.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.4.13.1" style="font-size:80%;">38.6</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.5">
<td class="ltx_td ltx_align_left" id="S9.T8.2.5.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_smallcaps" id="S9.T8.2.5.1.1" style="font-size:80%;">Llemma 7B</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.2.1" style="font-size:80%;">39.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.3.1" style="font-size:80%;">16.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.4.1" style="font-size:80%;">25.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.5.1" style="font-size:80%;">41.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.6.1" style="font-size:80%;">9.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.7.1" style="font-size:80%;">24.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.8.1" style="font-size:80%;">28.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.9.1" style="font-size:80%;">26.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.10.1" style="font-size:80%;">50.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.11.1" style="font-size:80%;">37.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.12.1" style="font-size:80%;">51.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.5.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.5.13.1" style="font-size:80%;">33.5</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.6">
<td class="ltx_td ltx_align_left ltx_border_t" id="S9.T8.2.6.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_italic" id="S9.T8.2.6.1.1" style="font-size:80%;">Generalist LLMs</span></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.2" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.3" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.4" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.5" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.6" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.7" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.8" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.9" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.10" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.11" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.12" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="S9.T8.2.6.13" style="padding-left:2.8pt;padding-right:2.8pt;"></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.7">
<td class="ltx_td ltx_align_left" id="S9.T8.2.7.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_smallcaps" id="S9.T8.2.7.1.1" style="font-size:80%;">Llama-2 7B</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.2.1" style="font-size:80%;">14.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.3.1" style="font-size:80%;">2.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.4.1" style="font-size:80%;">12.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.5.1" style="font-size:80%;">20.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.6.1" style="font-size:80%;">16.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.7.1" style="font-size:80%;">58.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.8.1" style="font-size:80%;">76.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.9.1" style="font-size:80%;">43.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.10.1" style="font-size:80%;">69.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.11.1" style="font-size:80%;">48.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.12.1" style="font-size:80%;">78.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.7.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.7.13.1" style="font-size:80%;">46.1</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.8">
<td class="ltx_td ltx_align_left" id="S9.T8.2.8.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_smallcaps" id="S9.T8.2.8.1.1" style="font-size:80%;">Llama-2 13B</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.2.1" style="font-size:80%;">28.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.3.1" style="font-size:80%;">3.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.4.1" style="font-size:80%;">18.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.5.1" style="font-size:80%;">30.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.6.1" style="font-size:80%;">16.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.7.1" style="font-size:80%;">63.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.8.1" style="font-size:80%;">77.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.9.1" style="font-size:80%;">49.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.10.1" style="font-size:80%;">73.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.11.1" style="font-size:80%;">50.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.12.1" style="font-size:80%;">80.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.8.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.8.13.1" style="font-size:80%;">52.8</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.9">
<td class="ltx_td ltx_align_left" id="S9.T8.2.9.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.1.1" style="font-size:80%;">Dense (DM)</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.2.1" style="font-size:80%;">26.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.3.1" style="font-size:80%;">9.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.4.1" style="font-size:80%;">20.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.5.1" style="font-size:80%;">30.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.6.1" style="font-size:80%;">24.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.7.1" style="font-size:80%;">55.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.8.1" style="font-size:80%;">76.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.9.1" style="font-size:80%;">44.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.10.1" style="font-size:80%;">68.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.11.1" style="font-size:80%;">48.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.12.1" style="font-size:80%;">78.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.9.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.9.13.1" style="font-size:80%;">49.8</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.10">
<td class="ltx_td ltx_align_left" id="S9.T8.2.10.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.1.1" style="font-size:80%;">Sparse upcycling (DM), Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.2.1" style="font-size:80%;">37.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.3.1" style="font-size:80%;">18.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.4.1" style="font-size:80%;">29.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.5.1" style="font-size:80%;">40.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.6.1" style="font-size:80%;">18.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.7.1" style="font-size:80%;">49.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.8.1" style="font-size:80%;">76.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.9.1" style="font-size:80%;">43.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.10.1" style="font-size:80%;">66.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.11.1" style="font-size:80%;">47.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.12.1" style="font-size:80%;">77.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.10.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.10.13.1" style="font-size:80%;">51.1</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.11">
<td class="ltx_td ltx_align_left" id="S9.T8.2.11.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.1.1" style="font-size:80%;">Sparse upcycling (CM), Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.2.1" style="font-size:80%;">40.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.3.1" style="font-size:80%;">16.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.4.1" style="font-size:80%;">26.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.5.1" style="font-size:80%;">35.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.6.1" style="font-size:80%;">24.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.7.1" style="font-size:80%;">58.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.8.1" style="font-size:80%;">75.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.9.1" style="font-size:80%;">44.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.10.1" style="font-size:80%;">69.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.11.1" style="font-size:80%;">47.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.12.1" style="font-size:80%;">78.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.11.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.11.13.1" style="font-size:80%;">52.1</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.12">
<td class="ltx_td ltx_align_left" id="S9.T8.2.12.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.1.1" style="font-size:80%;">BTM, Top-1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.2.1" style="font-size:80%;">27.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.3.1" style="font-size:80%;">15.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.4.1" style="font-size:80%;">30.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.5.1" style="font-size:80%;">41.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.6.1" style="font-size:80%;">15.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.7.1" style="font-size:80%;">38.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.8.1" style="font-size:80%;">72.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.9.1" style="font-size:80%;">38.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.10.1" style="font-size:80%;">68.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.11.1" style="font-size:80%;">47.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.12.1" style="font-size:80%;">77.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.12.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.12.13.1" style="font-size:80%;">44.3</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.13">
<td class="ltx_td ltx_align_left" id="S9.T8.2.13.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.1.1" style="font-size:80%;">BTM, Top-2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.2.1" style="font-size:80%;">27.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.3.1" style="font-size:80%;">15.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.4.1" style="font-size:80%;">30.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.5.1" style="font-size:80%;">42.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.6.1" style="font-size:80%;">15.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.7.1" style="font-size:80%;">38.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.8.1" style="font-size:80%;">73.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.9.1" style="font-size:80%;">38.5</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.10.1" style="font-size:80%;">68.3</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.11.1" style="font-size:80%;">48.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.12.1" style="font-size:80%;">78.1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.13.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.13.13.1" style="font-size:80%;">44.3</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.14">
<td class="ltx_td ltx_align_left" id="S9.T8.2.14.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.1.1" style="font-size:80%;">BTX, sample Top-1</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.2.1" style="font-size:80%;">36.9</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.3.1" style="font-size:80%;">15.8</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.4.1" style="font-size:80%;">25.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.5.1" style="font-size:80%;">37.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.6.1" style="font-size:80%;">23.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.7.1" style="font-size:80%;">56.4</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.8.1" style="font-size:80%;">76.7</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.9.1" style="font-size:80%;">45.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.10.1" style="font-size:80%;">70.6</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.11.1" style="font-size:80%;">48.0</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.12.1" style="font-size:80%;">78.2</span></td>
<td class="ltx_td ltx_align_center" id="S9.T8.2.14.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.14.13.1" style="font-size:80%;">53.2</span></td>
</tr>
<tr class="ltx_tr" id="S9.T8.2.15">
<td class="ltx_td ltx_align_left ltx_border_bb" id="S9.T8.2.15.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.1.1" style="font-size:80%;">BTX, Top-2</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.2.1" style="font-size:80%;">37.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.3.1" style="font-size:80%;">17.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.4.1" style="font-size:80%;">28.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.5.1" style="font-size:80%;">39.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.6.1" style="font-size:80%;">24.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.7.1" style="font-size:80%;">57.1</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.8.1" style="font-size:80%;">76.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.9.1" style="font-size:80%;">45.6</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.10.1" style="font-size:80%;">67.9</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.11.1" style="font-size:80%;">48.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.12" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.12.1" style="font-size:80%;">78.7</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S9.T8.2.15.13" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text" id="S9.T8.2.15.13.1" style="font-size:80%;">52.5</span></td>
</tr>
</tbody></table>
<figcaption class="ltx_caption ltx_centering" style="font-size:80%;"><span class="ltx_tag ltx_tag_table"><span class="ltx_text" id="S9.T8.5.1.1" style="font-size:113%;">Table 8</span>:</span><span class="ltx_text" id="S9.T8.6.2" style="font-size:113%;">BTX 및 Baselines의 개별 작업 성능. </span></figcaption>
</span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
</section>
<section class="ltx_section" id="S10" lang="en">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">10 </span>Routing analysis</h2><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_para" id="S10.p1">
<p class="ltx_p" id="S10.p1.1">다른 라우터 설계 및 태스크 도메인별로 집계된 다운스트림 태스크에 대한 라우팅 결정의 계층별 비교는 그림 <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S10.F4" title="Figure 4 ‣ 10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">4</span></a>와 같다. 라우팅 분포는 처음 몇 개의 계층에서 약간 다르지만 계층마다 빠르게 구별할 수 없게 된다. 한 가지 예외는 스위치 라우팅에서 수학 전문가가 마지막 모델 계층에서 작업 전반에 걸쳐 우세하게 되는 것입니다.</p>
</div>
<div class="ltx_para" id="S10.p2">
<p class="ltx_p" id="S10.p2.1">로드 밸런싱을 고려한 Top-2 라우팅에서 코드 전문가가 코드 도메인에서 지배적인 힘임을 알 수 있다. 부하 분산이 추가되지 않고 수학 전문가가 도메인 전체에서 우세한 다른 모델과의 차이점에 주목하십시오. 코드 도메인을 자세히 살펴보고 그림 <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S10.F5" title="Figure 5 ‣ 10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">5</span></a>에서 부하 분산이 있는 모델과 없는 모델에 대한 라우팅 확률 분포를 비교합니다. 그림의 아래 세 그래프에서 코드 전문가로의 라우팅 확률이 <math alttext="0" class="ltx_Math" display="inline" id="S10.p2.1.m1.1"><semantics id="S10.p2.1.m1.1a"><mn id="S10.p2.1.m1.1.1" xref="S10.p2.1.m1.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S10.p2.1.m1.1b"><cn id="S10.p2.1.m1.1.1.cmml" type="integer" xref="S10.p2.1.m1.1.1">0</cn></annotation-xml></semantics></math>로 이동한 죽은 전문가의 현상을 관찰할 수 있으며, 로드 밸런싱을 추가하면 전문가 간의 확률 분포가 더 유사해 보이며 코드 전문가에 대한 기대치가 약간 더 높다.</p>
</div>
<div class="ltx_para" id="S10.p3">
<p class="ltx_p" id="S10.p3.1">전문가가 다른 영역을 전문으로 하는지 이해하기 위해 작업별 분포를 자세히 살펴본다. Math 및 Reasoning 도메인에서 토큰의 라우팅 결정은 그림 <a class="ltx_ref" href="https://arxiv.org/html/2403.07816v1#S10.F6" title="Figure 6 ‣ 10 Routing analysis ‣ Branch-Train-MiX: Mixing Expert LLMs into a Mixture-of-Experts LLM"><span class="ltx_text ltx_ref_tag">6</span></a>와 같다. GSM8K 태스크는 코드와 <span class="ltx_text ltx_font_smallcaps" id="S10.p3.1.1">Llama-2</span> 전문가를 선호하는 반면, Math 태스크는 도메인 내 전문가에 더 많이 의존한다. GSM8K 데이터 세트는 상식 지식과 기본 사칙 연산이 필요한 초등학교 수학 단어 문제로 구성된 반면, 수학 과제는 대학 수준의 수학 지식이 필요하고 수학 전문가의 훈련 데이터와 더 일치하기 때문에 이러한 현상이 발생한다고 가정한다. 추론 영역에서 모든 과제는 유사한 행동을 보이며 수학 및 일반론자인 LLM의 전문성에 동등하게 의존한다.</p>
</div>
<figure class="ltx_figure" id="S10.2">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="[Uncaptioned image]" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="345" id="S10.1.g1" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/top2_lb_all.png" width="568"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="[Uncaptioned image]" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="345" id="S10.2.g2" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/top2_all.png" width="568"></div>
</div>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_figure" id="S10.F4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="345" id="S10.F4.g1" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/soft_top1_all.png" width="568"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="343" id="S10.F4.g2" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/swith_all.png" width="568"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S10.F4.3.1.1" style="font-size:90%;">그림 4</span>:</span><span class="ltx_text" id="S10.F4.4.2" style="font-size:90%;">BTX routing decisions of the tokens at various layers to different experts (Wiki, Math, Code, <span class="ltx_text ltx_font_smallcaps" id="S10.F4.4.2.1">LLaMa-2 7B</span>) for different downstream tasks. 작업은 코드(인간 평가, MBPP), 수학(GSM8K, MATH), 세계 지식(자연 질문, 트리비아QA) 및 추론(ARC-Easy, ARC-Challenge, SIQA, PIQA 및 WinoGrande) 도메인별로 집계됩니다. 로드 밸런싱을 이용한 Top-2 라우팅은 모든 계층에서 다른 라우팅 방법에 비해 전문가들 간의 로드의 균일한 분배를 보장한다. </span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_figure" id="S10.F5">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="120" id="S10.F5.g1" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/top2_lb_hist_0.png" width="479"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="120" id="S10.F5.g2" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/top2_lb_hist_15.png" width="479"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="120" id="S10.F5.g3" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/top2_lb_hist_31.png" width="479"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="120" id="S10.F5.g4" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/BTX_top2_cs_hist_0.png" width="479"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="120" id="S10.F5.g5" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/BTX_top2_cs_hist_15.png" width="479"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="120" id="S10.F5.g6" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/BTX_top2_cs_hist_31.png" width="479"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S10.F5.2.1.1" style="font-size:90%;">Figure 5</span>:</span><span class="ltx_text" id="S10.F5.3.2" style="font-size:90%;">Routing probabilities per expert across different layers for Human Eval task. 상단-2 라우팅을 (좌측)과 부하 분산 없이 (우측) 비교한다. </span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<figure class="ltx_figure" id="S10.F6">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="167" id="S10.F6.g1" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/BTX_top2_math_3.png" width="479"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_flex_size_1 ltx_img_landscape" height="170" id="S10.F6.g2" src="https://arxiv.org/html/2403.07816v1/extracted/5463999/figs/BTX_top2_reasoning_3.png" width="479"></div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure"><span class="ltx_text" id="S10.F6.4.1.1" style="font-size:90%;">Figure 6</span>:</span><span class="ltx_text" id="S10.F6.5.2" style="font-size:90%;">Routing decision of the tokens in Math and Reasoning domains. GSM8K 태스크는 코드와 <span class="ltx_text ltx_font_smallcaps" id="S10.F6.5.2.1">Llama-2</span> 전문가를 선호하지만 MATH 태스크는 도메인 내 전문가에 더 많이 의존한다. 추론 도메인에서 로드는 Math와 <span class="ltx_text ltx_font_smallcaps" id="S10.F6.5.2.2">LLaMa-2 7B</span> 전문가 간에 분산 됩니다. </span></figcaption>
</figure><button class="sr-only button" style="display: none;">Report issue for preceding element</button>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</article>
</div>

</div>


<div class="ltx_page_footer">
        <div class="ltx_page_logo">
            Generated on Wed Dec 14 18:01:44 2022 by
            <a href="https://math.nist.gov/~BMiller/LaTeXML/" class="ltx_LaTeXML_logo">
                <span style="letter-spacing: -0.2em; margin-right: 0.1em;">
                    L
                    <span style="font-size: 70%; position: relative; bottom: 2.2pt;">A</span>
                    T
                    <span style="position: relative; bottom: -0.4ex;">E</span>
                </span>
                <span class="ltx_font_smallcaps">xml</span>
                <img alt="[LOGO]" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg==">
            </a>
        </div></div><footer id="footer" class="ltx_document">
        <div class="keyboard-glossary">
            <h2>Instructions for reporting errors</h2>
            <p>We are continuing to improve HTML versions of papers, and your feedback helps enhance accessibility and mobile support. To report errors in the HTML that will help us improve conversion and rendering, choose any of the methods listed below:</p>
            <ul>
                <li>Click the "Report Issue" button.</li>
                <li>Open a report feedback form via keyboard, use "<strong>Ctrl + ?</strong>".</li>
                <li>Make a text selection and click the "Report Issue for Selection" button near your cursor.</li>
                <li class="sr-only">You can use Alt+Y to toggle on and Alt+Shift+Y to toggle off accessible reporting links at each section.</li>
            </ul>
            <p>Our team has already identified <a class="ltx_ref" href="https://github.com/arXiv/html_feedback/issues" target="_blank">the following issues</a>. We appreciate your time reviewing and reporting rendering errors we may not have found yet. Your efforts will help us improve the HTML versions for all readers, because disability should not be a barrier to accessing research. Thank you for your continued support in championing open access for all.</p>
            <p>Have a free development cycle? Help support accessibility at arXiv! Our collaborators at LaTeXML maintain a <a class="ltx_ref" href="https://github.com/brucemiller/LaTeXML/wiki/Porting-LaTeX-packages-for-LaTeXML" target="_blank">list of packages that need conversion</a>, and welcome <a class="ltx_ref" href="https://github.com/brucemiller/LaTeXML/issues" target="_blank">developer contributions</a>.</p>
        </div>
    </footer><button type="button" class="btn btn-primary hover-rp-button" id="openForm">Report Issue</button><div class="modal" id="myForm" role="dialog" aria-labelledby="modal-title"><div class="modal-dialog"><form class="modal-content" id="myFormContent" enctype="multipart/form-data"><div class="modal-header" id="modal-header"><h5 class="modal-title">Report Github Issue</h5><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"><label for="form_title" id="modalTitle">Title:</label><input class="form-control" id="form_title" name="form_title" required="required" placeholder="Enter title"><label for="description" id="selectedTextModalDescription" style="display: none;">Content selection saved. Describe the issue below:</label><label for="description" id="nomralModalDescription">Description:</label><textarea class="form-control" id="description" name="description" required="required" style="height: 80px;" maxlength="500" placeholder="500 characters maximum"></textarea></div><div class="modal-footer d-flex justify-content-end"><button type="submit" class="sr-only button" id="modal-submit-sr">Submit without Github</button><button type="submit" class="btn btn-primary" id="modal-submit">Submit in Github</button></div></form></div></div><button id="small-report-button" type="button" class="btn btn-secondary btn-sm" style="background-color: rgb(179, 27, 27); position: fixed;">Report Issue for Selection</button></body></html>